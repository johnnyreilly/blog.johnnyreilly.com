<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.0">
<title data-rh="true">ASP.NET Core: Proxying HTTP Requests with an AllowList | johnnyreilly</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://johnnyreilly.com/aspnet-core-allowlist-proxying-http-requests"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" name="robots" content="max-image-preview:large"><meta data-rh="true" name="monetization" content="$ilp.uphold.com/LwQQhXdpwxeJ"><meta data-rh="true" property="og:title" content="ASP.NET Core: Proxying HTTP Requests with an AllowList | johnnyreilly"><meta data-rh="true" name="description" content="ASP.NET Core can proxy HTTP requests selectively, allowing only acceptable traffic via a middleware for specified paths."><meta data-rh="true" property="og:description" content="ASP.NET Core can proxy HTTP requests selectively, allowing only acceptable traffic via a middleware for specified paths."><meta data-rh="true" property="og:image" content="https://res.cloudinary.com/priou/image/fetch/f_auto,q_auto,w_auto,dpr_auto/https://johnnyreilly.com/assets/images/hang-on-lads-ive-got-a-great-idea-1f149b8af4aa7df5f8b7f66965781ceb.webp"><meta data-rh="true" name="twitter:image" content="https://res.cloudinary.com/priou/image/fetch/f_auto,q_auto,w_auto,dpr_auto/https://johnnyreilly.com/assets/images/hang-on-lads-ive-got-a-great-idea-1f149b8af4aa7df5f8b7f66965781ceb.webp"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2019-02-22T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://johnnyreilly.com/about"><meta data-rh="true" property="article:tag" content="asp.net"><link data-rh="true" rel="icon" href="/favicon.ico"><link data-rh="true" rel="canonical" href="https://johnnyreilly.com/aspnet-core-allowlist-proxying-http-requests"><link data-rh="true" rel="alternate" href="https://johnnyreilly.com/aspnet-core-allowlist-proxying-http-requests" hreflang="en"><link data-rh="true" rel="alternate" href="https://johnnyreilly.com/aspnet-core-allowlist-proxying-http-requests" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://J3MYR1INLT-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/rss.xml" title="I CAN MAKE THIS WORK RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="I CAN MAKE THIS WORK Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="johnnyreilly" href="/opensearch.xml">

<link rel="icon" href="/img/profile-64x64.jpg">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#3578e5">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#000">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
<link rel="preload" href="https://johnnyreilly.com/fonts/Poppins-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://johnnyreilly.com/fonts/Poppins-Bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preconnect" href="https://res.cloudinary.com">
<link rel="monetization" href="https://ilp.uphold.com/LwQQhXdpwxeJ">
<script type="application/ld+json">{"@context":"https://schema.org","@graph":[{"@id":"https://johnnyreilly.com","@type":"WebSite","url":"https://johnnyreilly.com","name":"johnnyreilly","description":"This is John Reilly's blog. John is an Open Source Software Engineer working on TypeScript, Azure, React, Node.js, .NET and more.","copyrightHolder":{"@id":"https://johnnyreilly.com/about"},"publisher":{"@id":"https://johnnyreilly.com/about"},"potentialAction":{"@type":"SearchAction","target":{"@type":"EntryPoint","urlTemplate":"https://johnnyreilly.com/search?q={search_term_string}"},"query-input":"required name=search_term_string"},"inLanguage":"en-UK"},{"@id":"https://johnnyreilly.com/about","@type":"Person","name":"John Reilly","alternateName":"Johnny Reilly","image":{"@type":"ImageObject","inLanguage":"en-UK","@id":"https://johnnyreilly.com/about#image","url":"https://johnnyreilly.com/img/profile.jpg","contentUrl":"https://johnnyreilly.com/img/profile.jpg","width":200,"height":200,"caption":"John Reilly"},"description":"John is an Open Source Software Engineer working on TypeScript, Azure, React, Node.js, .NET and more. As well as writing code, John is a speaker at meetups, one of the founders of the TS Congress conference, and the author of the history of Definitely Typed, which he worked on in the early days of TypeScript.","url":"https://johnnyreilly.com","address":{"@type":"PostalAddress","streetAddress":"Twickenham","addressLocality":"London","addressCountry":"United Kingdom"},"email":"johnny_reilly@hotmail.com","birthPlace":"Bristol","sameAs":["https://github.com/johnnyreilly","https://fosstodon.org/@johnny_reilly","https://twitter.com/johnny_reilly","https://dev.to/johnnyreilly","https://app.daily.dev/johnnyreilly","https://stackoverflow.com/users/761388/john-reilly","https://blog.logrocket.com/author/johnreilly/","https://www.reddit.com/user/johnny_reilly","https://uk.linkedin.com/in/johnnyreilly"]},{"@id":"https://johnnyreilly.com/about#organization","@type":["Organization","Brand"],"url":"https://johnnyreilly.com","name":"johnnyreilly","description":"This is John Reilly's blog. John is an Open Source Software Engineer working on TypeScript, Azure, React, Node.js, .NET and more.","logo":{"@type":"ImageObject","inLanguage":"en-UK","@id":"https://johnnyreilly.com/#logo","url":"https://johnnyreilly.com/img/profile.jpg","contentUrl":"https://johnnyreilly.com/img/profile.jpg","width":200,"height":200,"caption":"John Reilly"},"image":{"@id":"https://johnnyreilly.com/#logo"},"sameAs":["https://github.com/johnnyreilly","https://fosstodon.org/@johnny_reilly","https://twitter.com/johnny_reilly","https://dev.to/johnnyreilly","https://app.daily.dev/johnnyreilly","https://stackoverflow.com/users/761388/john-reilly","https://blog.logrocket.com/author/johnreilly/","https://www.reddit.com/user/johnny_reilly","https://uk.linkedin.com/in/johnnyreilly"]}]}</script>
<link rel="webmention" href="https://webmention.io/johnnyreilly.com/webmention"><link rel="stylesheet" href="/assets/css/styles.06f8963f.css">
<script src="/assets/js/runtime~main.0edd3254.js" defer="defer"></script>
<script src="/assets/js/main.53964582.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><script type="application/ld+json">[{"@context":"https://schema.org","@type":"BreadcrumbList","@id":"/aspnet-core-allowlist-proxying-http-requests#breadcrumb","name":"Blog breadcrumb","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https://johnnyreilly.com"},{"@type":"ListItem","position":2,"name":"Blog","item":"https://johnnyreilly.com/blog"},{"@type":"ListItem","position":3,"name":"ASP.NET Core: Proxying HTTP Requests with an AllowList"}]}]</script><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/profile-64x64.jpg" alt="Profile picture of John Reilly" class="themedComponent_mlkZ themedComponent--light_NVdE" height="32" width="32"><img src="/img/profile-64x64.jpg" alt="Profile picture of John Reilly" class="themedComponent_mlkZ themedComponent--dark_xIcU" height="32" width="32"></div><b class="navbar__title text--truncate">John Reilly</b></a><a class="navbar__item navbar__link" href="/about">About</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/talks">Talks</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/johnnyreilly" target="_blank" rel="me" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://twitter.com/johnny_reilly" target="_blank" rel="me" class="navbar__item navbar__link">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://fosstodon.org/@johnny_reilly" target="_blank" rel="me" class="navbar__item navbar__link">Mastodon<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/using-bun-in-azure-pipelines">Using Bun in Azure Pipelines</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/bicep-lint-azure-pipelines-github-actions">Bicep lint with Azure Pipelines and GitHub Actions</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/schemar-github-action-to-validate-structured-data">Schemar: a GitHub Action to validate structured data</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/snapshot-log-tests-dotnet">Snapshot log tests in .NET</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/bun-overview">Overview of Bun, a JavaScript runtime</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/how-we-fixed-my-seo">How we fixed my SEO</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/graph-api-ad-users-group-name-ids-csharp-sdk">Graph API: getting users Active Directory group names and ids with the C# SDK</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/migrating-azure-functions-node-js-v4-typescript">Migrating to v4 Azure Functions Node.js with TypeScript</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="https://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="ASP.NET Core can proxy HTTP requests selectively, allowing only acceptable traffic via a middleware for specified paths."><link itemprop="image" href="https://johnnyreilly.com/assets/images/hang-on-lads-ive-got-a-great-idea-1f149b8af4aa7df5f8b7f66965781ceb.webp"><header><h1 class="title_f1Hy" itemprop="headline">ASP.NET Core: Proxying HTTP Requests with an AllowList</h1><div class="container_mt6G margin-vert--md"><time datetime="2019-02-22T00:00:00.000Z" itemprop="datePublished">February 22, 2019</time> · <!-- -->7 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://johnnyreilly.com/about" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://johnnyreilly.com/img/profile.jpg" alt="John Reilly" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://johnnyreilly.com/about" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">John Reilly</span></a></div><small class="avatar__subtitle" itemprop="description">OSS Engineer - TypeScript, Azure, React, Node.js, .NET</small></div></div></div></div></header><div id="__blog-post-container" class="markdown" itemprop="articleBody"><p>This post demonstrates a mechanism for proxying HTTP requests in ASP.NET Core. It doesn&#x27;t proxy all requests; it only proxies requests that match entries on an &quot;allowlist&quot; - so we only proxy the traffic that we&#x27;ve actively decided is acceptable as determined by taking the form of an expected URL and HTTP verb (GET / POST etc).</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="why-do-we-need-to-proxy">Why do we need to proxy?<a href="#why-do-we-need-to-proxy" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h2>
<p>Once upon a time there lived a young team who were building a product. They were ready to go live with their beta and so they set off on a journey to a mystical land they had heard tales of. This magical kingdom was called &quot;Production&quot;. However, Production was a land with walls and but one gate. That gate was jealously guarded by a defender named &quot;InfoSec&quot;. InfoSec was there to make sure that only the the right people, noble of thought and pure of deed were allowed into the promised land. InfoSec would ask questions like &quot;are you serving over HTTPS&quot; and &quot;what are you doing about cross site scripting&quot;?</p>
<p>The team felt they had good answers to InfoSec&#x27;s questions. However, just as they were about to step through the gate, InfoSec held up their hand and said &quot;your application wants to access a database... database access needs to take place on our own internal network. Not over the publicly accessible internet.&quot;</p>
<p>The team, with one foot in the air, paused. They swallowed and said &quot;can you give us five minutes?&quot;</p>
<p><img loading="eager" alt="image taken from the end of the classic movie &amp;quot;The Italian Job&amp;quot; of the bus hanging half off a mountainside" src="/assets/images/hang-on-lads-ive-got-a-great-idea-1f149b8af4aa7df5f8b7f66965781ceb.webp" width="640" height="271" fetchpriority="high" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-proxy-regroup">The Proxy Regroup<a href="#the-proxy-regroup" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h2>
<p>And so it came to pass that the teams product (which took the form of ASP.Net Core web application) had to be changed. Where once there had been a single application, there would now be two; one that lived on the internet (the <em>web</em> app) and one that lived on the companies private network (the <em>API</em> app). The API app would do all the database access. In fact the product team opted to move all significant operations into the API as well. This left the web app with two purposes:</p>
<ol>
<li>the straightforward serving of HTML, CSS, JS and images</li>
<li>the proxying of API calls through to the API app</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="proxy-part-1">Proxy Part 1<a href="#proxy-part-1" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h2>
<p>In the early days of this proxying the team reached for <a href="https://github.com/twitchax/AspNetCore.Proxy" target="_blank" rel="noopener noreferrer"><code>AspNetCore.Proxy</code></a>. It&#x27;s a great open source project that allows you to proxy HTTP requests. It gives you complete control over the construction of proxy requests, so that you can have a request come into your API and end up proxying it to a URL with a completely different path on the proxy server.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="proxy-part-2">Proxy Part 2<a href="#proxy-part-2" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h2>
<p>The approach offered by <code>AspNetCore.Proxy</code> is fantastically powerful in terms of control. However, we didn&#x27;t actually need that level of configurability. In fact, it resulted in us writing a great deal of boilerplate code. You see in our case we&#x27;d opted to proxy path for path, changing only the server name on each proxied request. So if a GET request came in going to <a href="https://web.app.com/api/version" target="_blank" rel="noopener noreferrer">https://web.app.com/api/version</a> then we would want to proxy it to a GET request to <a href="https://api.app.com/api/version" target="_blank" rel="noopener noreferrer">https://api.app.com/api/version</a>. You see? All we did was swap <a href="https://web.app.com" target="_blank" rel="noopener noreferrer">https://web.app.com</a> for <a href="https://api.app.com" target="_blank" rel="noopener noreferrer">https://api.app.com</a>. Nothing more. We did that as a rule. We knew we <em>always</em> wanted to do just this.</p>
<p>So we ended up spinning up our own solution which allowed just the specification of paths we wanted to proxy with their corresponding HTTP verbs. Let&#x27;s talk through it. Usage of our approach ended up as a middleware within our web app&#x27;s <code>Startup.cs</code>:</p>
<div class="language-cs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cs codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">public</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:#66d9ef">void</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">Configure</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token class-name" style="color:#e6db74">IApplicationBuilder</span><span class="token plain"> app</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#8292a2;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    app</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">UseProxyAllowList</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token comment" style="color:#8292a2;font-style:italic">// where ServerToProxyToBaseUrl is the server you want requests to be proxied to</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token comment" style="color:#8292a2;font-style:italic">// eg &quot;https://the-server-we-proxy-to&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        proxyAddressTweaker</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">requestPath</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=&gt;</span><span class="token plain"> </span><span class="token interpolation-string string" style="color:#a6e22e">$&quot;</span><span class="token interpolation-string interpolation punctuation" style="color:#f8f8f2">{</span><span class="token interpolation-string interpolation expression language-csharp">ServerToProxyToBaseUrl</span><span class="token interpolation-string interpolation punctuation" style="color:#f8f8f2">}</span><span class="token interpolation-string interpolation punctuation" style="color:#f8f8f2">{</span><span class="token interpolation-string interpolation expression language-csharp">requestPath</span><span class="token interpolation-string interpolation punctuation" style="color:#f8f8f2">}</span><span class="token interpolation-string string" style="color:#a6e22e">&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token named-parameter punctuation" style="color:#f8f8f2">allowListProxyRoutes</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">new</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token comment" style="color:#8292a2;font-style:italic">// An anonymous request</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            AllowListProxy</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">AnonymousRoute</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&quot;api/version&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> HttpMethod</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Get</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token comment" style="color:#8292a2;font-style:italic">// An authenticated request; to send this we must know who the user is</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            AllowListProxy</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Route</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&quot;api/account/{accountId:int}/all-the-secret-info&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> HttpMethod</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Get</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> HttpMethod</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Post</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    app</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">UseMvc</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#8292a2;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If you look at the code above you can see that we are proxing requests to a single server: <code>ServerToProxyToBaseUrl</code>. We&#x27;re also only proxying requests which match an entry on our allowlist (as represented by <code>allowListProxyRoutes</code>). So in this case we&#x27;re proxying two different requests:</p>
<ol>
<li><code>GET</code> requests to <code>api/version</code> are proxied through as <em>anonymous</em><code>GET</code> requests.</li>
<li><code>GET</code> and <code>POST</code> requests to <code>api/account/{accountId:int}/all-the-secret-info</code> are proxied through as <code>GET</code> and <code>POST</code> requests. These requests require that a user be authenticated first.</li>
</ol>
<p>The <code>AllowListProxy</code> proxy class we&#x27;ve been using looks like this:</p>
<div class="language-cs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cs codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">using</span><span class="token plain"> </span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">System</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">using</span><span class="token plain"> </span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">System</span><span class="token namespace punctuation" style="color:#f8f8f2;opacity:0.7">.</span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">Collections</span><span class="token namespace punctuation" style="color:#f8f8f2;opacity:0.7">.</span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">Generic</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">using</span><span class="token plain"> </span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">System</span><span class="token namespace punctuation" style="color:#f8f8f2;opacity:0.7">.</span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">Net</span><span class="token namespace punctuation" style="color:#f8f8f2;opacity:0.7">.</span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">Http</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">namespace</span><span class="token plain"> </span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">My</span><span class="token namespace punctuation" style="color:#f8f8f2;opacity:0.7">.</span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">Web</span><span class="token namespace punctuation" style="color:#f8f8f2;opacity:0.7">.</span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">Proxy</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">public</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">class</span><span class="token plain"> </span><span class="token class-name" style="color:#e6db74">AllowListProxy</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">public</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:#66d9ef">string</span><span class="token plain"> Path </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">get</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">set</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">public</span><span class="token plain"> </span><span class="token return-type class-name" style="color:#e6db74">IEnumerable</span><span class="token return-type class-name punctuation" style="color:#f8f8f2">&lt;</span><span class="token return-type class-name" style="color:#e6db74">HttpMethod</span><span class="token return-type class-name punctuation" style="color:#f8f8f2">&gt;</span><span class="token plain"> Methods </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">get</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">set</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">public</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:#66d9ef">bool</span><span class="token plain"> IsAnonymous </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">get</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">set</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">private</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">AllowListProxy</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token class-name keyword" style="color:#66d9ef">string</span><span class="token plain"> path</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token class-name keyword" style="color:#66d9ef">bool</span><span class="token plain"> isAnonymous</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">params</span><span class="token plain"> </span><span class="token class-name" style="color:#e6db74">HttpMethod</span><span class="token class-name punctuation" style="color:#f8f8f2">[</span><span class="token class-name punctuation" style="color:#f8f8f2">]</span><span class="token plain"> methods</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">methods </span><span class="token operator" style="color:#66d9ef">==</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">null</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">||</span><span class="token plain"> methods</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Length </span><span class="token operator" style="color:#66d9ef">==</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                </span><span class="token keyword" style="color:#66d9ef">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name" style="color:#e6db74">ArgumentException</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token interpolation-string string" style="color:#a6e22e">$&quot;You need at least a single HttpMethod to be specified for </span><span class="token interpolation-string interpolation punctuation" style="color:#f8f8f2">{</span><span class="token interpolation-string interpolation expression language-csharp">path</span><span class="token interpolation-string interpolation punctuation" style="color:#f8f8f2">}</span><span class="token interpolation-string string" style="color:#a6e22e">&quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            Path </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> path</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            IsAnonymous </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> isAnonymous</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            Methods </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> methods</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">public</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">static</span><span class="token plain"> </span><span class="token return-type class-name" style="color:#e6db74">AllowListProxy</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">Route</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token class-name keyword" style="color:#66d9ef">string</span><span class="token plain"> path</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">params</span><span class="token plain"> </span><span class="token class-name" style="color:#e6db74">HttpMethod</span><span class="token class-name punctuation" style="color:#f8f8f2">[</span><span class="token class-name punctuation" style="color:#f8f8f2">]</span><span class="token plain"> methods</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token keyword" style="color:#66d9ef">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name" style="color:#e6db74">AllowListProxy</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">path</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token named-parameter punctuation" style="color:#f8f8f2">isAnonymous</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token boolean" style="color:#ae81ff">false</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token named-parameter punctuation" style="color:#f8f8f2">methods</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> methods</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">public</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">static</span><span class="token plain"> </span><span class="token return-type class-name" style="color:#e6db74">AllowListProxy</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">AnonymousRoute</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token class-name keyword" style="color:#66d9ef">string</span><span class="token plain"> path</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">params</span><span class="token plain"> </span><span class="token class-name" style="color:#e6db74">HttpMethod</span><span class="token class-name punctuation" style="color:#f8f8f2">[</span><span class="token class-name punctuation" style="color:#f8f8f2">]</span><span class="token plain"> methods</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token keyword" style="color:#66d9ef">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name" style="color:#e6db74">AllowListProxy</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">path</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token named-parameter punctuation" style="color:#f8f8f2">isAnonymous</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token boolean" style="color:#ae81ff">true</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token named-parameter punctuation" style="color:#f8f8f2">methods</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> methods</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The middleware for proxying (our <code>UseProxyAllowList</code>) looks like this:</p>
<div class="language-cs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cs codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">using</span><span class="token plain"> </span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">System</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">using</span><span class="token plain"> </span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">System</span><span class="token namespace punctuation" style="color:#f8f8f2;opacity:0.7">.</span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">Collections</span><span class="token namespace punctuation" style="color:#f8f8f2;opacity:0.7">.</span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">Generic</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">using</span><span class="token plain"> </span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">System</span><span class="token namespace punctuation" style="color:#f8f8f2;opacity:0.7">.</span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">ComponentModel</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">using</span><span class="token plain"> </span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">System</span><span class="token namespace punctuation" style="color:#f8f8f2;opacity:0.7">.</span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">Linq</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">using</span><span class="token plain"> </span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">System</span><span class="token namespace punctuation" style="color:#f8f8f2;opacity:0.7">.</span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">Net</span><span class="token namespace punctuation" style="color:#f8f8f2;opacity:0.7">.</span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">Http</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">using</span><span class="token plain"> </span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">System</span><span class="token namespace punctuation" style="color:#f8f8f2;opacity:0.7">.</span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">Reflection</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">using</span><span class="token plain"> </span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">System</span><span class="token namespace punctuation" style="color:#f8f8f2;opacity:0.7">.</span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">Threading</span><span class="token namespace punctuation" style="color:#f8f8f2;opacity:0.7">.</span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">Tasks</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">using</span><span class="token plain"> </span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">Microsoft</span><span class="token namespace punctuation" style="color:#f8f8f2;opacity:0.7">.</span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">AspNetCore</span><span class="token namespace punctuation" style="color:#f8f8f2;opacity:0.7">.</span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">Authentication</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">using</span><span class="token plain"> </span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">Microsoft</span><span class="token namespace punctuation" style="color:#f8f8f2;opacity:0.7">.</span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">AspNetCore</span><span class="token namespace punctuation" style="color:#f8f8f2;opacity:0.7">.</span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">Builder</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">using</span><span class="token plain"> </span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">Microsoft</span><span class="token namespace punctuation" style="color:#f8f8f2;opacity:0.7">.</span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">AspNetCore</span><span class="token namespace punctuation" style="color:#f8f8f2;opacity:0.7">.</span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">Http</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">using</span><span class="token plain"> </span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">Microsoft</span><span class="token namespace punctuation" style="color:#f8f8f2;opacity:0.7">.</span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">AspNetCore</span><span class="token namespace punctuation" style="color:#f8f8f2;opacity:0.7">.</span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">Routing</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">using</span><span class="token plain"> </span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">Microsoft</span><span class="token namespace punctuation" style="color:#f8f8f2;opacity:0.7">.</span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">Extensions</span><span class="token namespace punctuation" style="color:#f8f8f2;opacity:0.7">.</span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">DependencyModel</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">using</span><span class="token plain"> </span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">Microsoft</span><span class="token namespace punctuation" style="color:#f8f8f2;opacity:0.7">.</span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">Extensions</span><span class="token namespace punctuation" style="color:#f8f8f2;opacity:0.7">.</span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">DependencyInjection</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">using</span><span class="token plain"> </span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">Serilog</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">namespace</span><span class="token plain"> </span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">My</span><span class="token namespace punctuation" style="color:#f8f8f2;opacity:0.7">.</span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">Web</span><span class="token namespace punctuation" style="color:#f8f8f2;opacity:0.7">.</span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">Proxy</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">public</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">static</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">class</span><span class="token plain"> </span><span class="token class-name" style="color:#e6db74">ProxyRouteExtensions</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token comment" style="color:#8292a2;font-style:italic">/// &lt;summary&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token comment" style="color:#8292a2;font-style:italic">/// Middleware which proxies the supplied allowlist routes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token comment" style="color:#8292a2;font-style:italic">/// &lt;/summary&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">public</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">static</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:#66d9ef">void</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">UseProxyAllowList</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token keyword" style="color:#66d9ef">this</span><span class="token plain"> </span><span class="token class-name" style="color:#e6db74">IApplicationBuilder</span><span class="token plain"> app</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token class-name" style="color:#e6db74">Func</span><span class="token class-name punctuation" style="color:#f8f8f2">&lt;</span><span class="token class-name keyword" style="color:#66d9ef">string</span><span class="token class-name punctuation" style="color:#f8f8f2">,</span><span class="token class-name" style="color:#e6db74"> </span><span class="token class-name keyword" style="color:#66d9ef">string</span><span class="token class-name punctuation" style="color:#f8f8f2">&gt;</span><span class="token plain"> proxyAddressTweaker</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token class-name" style="color:#e6db74">Action</span><span class="token class-name punctuation" style="color:#f8f8f2">&lt;</span><span class="token class-name" style="color:#e6db74">HttpContext</span><span class="token class-name punctuation" style="color:#f8f8f2">,</span><span class="token class-name" style="color:#e6db74"> HttpRequestMessage</span><span class="token class-name punctuation" style="color:#f8f8f2">&gt;</span><span class="token plain"> preSendProxyRequestAction</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token class-name" style="color:#e6db74">IEnumerable</span><span class="token class-name punctuation" style="color:#f8f8f2">&lt;</span><span class="token class-name" style="color:#e6db74">AllowListProxy</span><span class="token class-name punctuation" style="color:#f8f8f2">&gt;</span><span class="token plain"> allowListProxyRoutes</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            app</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">UseRouter</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">builder </span><span class="token operator" style="color:#66d9ef">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                </span><span class="token keyword" style="color:#66d9ef">foreach</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token class-name keyword" style="color:#66d9ef">var</span><span class="token plain"> allowListProxy </span><span class="token keyword" style="color:#66d9ef">in</span><span class="token plain"> allowListProxyRoutes</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                    </span><span class="token keyword" style="color:#66d9ef">foreach</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token class-name keyword" style="color:#66d9ef">var</span><span class="token plain"> method </span><span class="token keyword" style="color:#66d9ef">in</span><span class="token plain"> allowListProxy</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Methods</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                        builder</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">MapMiddlewareVerb</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">method</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">ToString</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> allowListProxy</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Path</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> proxyApp </span><span class="token operator" style="color:#66d9ef">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                            proxyApp</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">UseProxy_Challenge</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">allowListProxy</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">IsAnonymous</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                            proxyApp</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">UseProxy_Run</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">proxyAddressTweaker</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> preSendProxyRequestAction</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                        </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">private</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">static</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:#66d9ef">void</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">UseProxy_Challenge</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token keyword" style="color:#66d9ef">this</span><span class="token plain"> </span><span class="token class-name" style="color:#e6db74">IApplicationBuilder</span><span class="token plain"> app</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token class-name keyword" style="color:#66d9ef">bool</span><span class="token plain"> allowAnonymous</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            app</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Use</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">context</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> next</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                </span><span class="token class-name keyword" style="color:#66d9ef">var</span><span class="token plain"> routePath </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> context</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Request</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Path</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Value</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                </span><span class="token class-name keyword" style="color:#66d9ef">var</span><span class="token plain"> weAreAuthenticatedOrWeDontNeedToBe </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                    context</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">User</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Identity</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">IsAuthenticated </span><span class="token operator" style="color:#66d9ef">||</span><span class="token plain"> allowAnonymous</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">weAreAuthenticatedOrWeDontNeedToBe</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                    </span><span class="token keyword" style="color:#66d9ef">return</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">next</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                </span><span class="token keyword" style="color:#66d9ef">return</span><span class="token plain"> context</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">ChallengeAsync</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">private</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">static</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:#66d9ef">void</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">UseProxy_Run</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token keyword" style="color:#66d9ef">this</span><span class="token plain"> </span><span class="token class-name" style="color:#e6db74">IApplicationBuilder</span><span class="token plain"> app</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token class-name" style="color:#e6db74">Func</span><span class="token class-name punctuation" style="color:#f8f8f2">&lt;</span><span class="token class-name keyword" style="color:#66d9ef">string</span><span class="token class-name punctuation" style="color:#f8f8f2">,</span><span class="token class-name" style="color:#e6db74"> </span><span class="token class-name keyword" style="color:#66d9ef">string</span><span class="token class-name punctuation" style="color:#f8f8f2">&gt;</span><span class="token plain"> proxyAddressTweaker</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token class-name" style="color:#e6db74">Action</span><span class="token class-name punctuation" style="color:#f8f8f2">&lt;</span><span class="token class-name" style="color:#e6db74">HttpContext</span><span class="token class-name punctuation" style="color:#f8f8f2">,</span><span class="token class-name" style="color:#e6db74"> HttpRequestMessage</span><span class="token class-name punctuation" style="color:#f8f8f2">&gt;</span><span class="token plain"> preSendProxyRequestAction</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            app</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Run</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token keyword" style="color:#66d9ef">async</span><span class="token plain"> context </span><span class="token operator" style="color:#66d9ef">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                </span><span class="token class-name keyword" style="color:#66d9ef">var</span><span class="token plain"> proxyAddress </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;&quot;</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                </span><span class="token keyword" style="color:#66d9ef">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                    proxyAddress </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">proxyAddressTweaker</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">context</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Request</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Path</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Value</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                    </span><span class="token class-name keyword" style="color:#66d9ef">var</span><span class="token plain"> proxyRequest </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> context</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Request</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">CreateProxyHttpRequest</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">proxyAddress</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                    </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">preSendProxyRequestAction </span><span class="token operator" style="color:#66d9ef">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">null</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                        </span><span class="token function" style="color:#e6db74">preSendProxyRequestAction</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">context</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> proxyRequest</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                    </span><span class="token class-name keyword" style="color:#66d9ef">var</span><span class="token plain"> httpClients </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> context</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">RequestServices</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token generic-method function" style="color:#e6db74">GetService</span><span class="token generic-method generic class-name punctuation" style="color:#f8f8f2">&lt;</span><span class="token generic-method generic class-name" style="color:#e6db74">IHttpClients</span><span class="token generic-method generic class-name punctuation" style="color:#f8f8f2">&gt;</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"> </span><span class="token comment" style="color:#8292a2;font-style:italic">// IHttpClients is just a wrapper for HttpClient - insert your own here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                    </span><span class="token class-name keyword" style="color:#66d9ef">var</span><span class="token plain"> proxyResponse </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">await</span><span class="token plain"> httpClients</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">SendRequestAsync</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">proxyRequest</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                            HttpCompletionOption</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">ResponseHeadersRead</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> context</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">RequestAborted</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                        </span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">ConfigureAwait</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token boolean" style="color:#ae81ff">false</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                    </span><span class="token keyword" style="color:#66d9ef">await</span><span class="token plain"> context</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">CopyProxyHttpResponse</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">proxyResponse</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">ConfigureAwait</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token boolean" style="color:#ae81ff">false</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                </span><span class="token keyword" style="color:#66d9ef">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token class-name" style="color:#e6db74">OperationCanceledException</span><span class="token plain"> ex</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                    </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ex</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">CancellationToken</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">IsCancellationRequested</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                        </span><span class="token keyword" style="color:#66d9ef">return</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                    </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token operator" style="color:#66d9ef">!</span><span class="token plain">context</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Response</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">HasStarted</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                    </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                        context</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Response</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">StatusCode </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">408</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                        </span><span class="token keyword" style="color:#66d9ef">await</span><span class="token plain"> context</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Response</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                            </span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">WriteAsync</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&quot;Request timed out.&quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                </span><span class="token keyword" style="color:#66d9ef">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token class-name" style="color:#e6db74">Exception</span><span class="token plain"> e</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                    </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token operator" style="color:#66d9ef">!</span><span class="token plain">context</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Response</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">HasStarted</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                    </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                        context</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Response</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">StatusCode </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">500</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                        </span><span class="token keyword" style="color:#66d9ef">await</span><span class="token plain"> context</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Response</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                            </span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">WriteAsync</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                                </span><span class="token interpolation-string string" style="color:#a6e22e">$&quot;Request could not be proxied.\n\n</span><span class="token interpolation-string interpolation punctuation" style="color:#f8f8f2">{</span><span class="token interpolation-string interpolation expression language-csharp">e</span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:#f8f8f2">.</span><span class="token interpolation-string interpolation expression language-csharp">Message</span><span class="token interpolation-string interpolation punctuation" style="color:#f8f8f2">}</span><span class="token interpolation-string string" style="color:#a6e22e">\n\n</span><span class="token interpolation-string interpolation punctuation" style="color:#f8f8f2">{</span><span class="token interpolation-string interpolation expression language-csharp">e</span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:#f8f8f2">.</span><span class="token interpolation-string interpolation expression language-csharp">StackTrace</span><span class="token interpolation-string interpolation punctuation" style="color:#f8f8f2">}</span><span class="token interpolation-string string" style="color:#a6e22e">.&quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">public</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">static</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:#66d9ef">void</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">AddOrReplaceHeader</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token keyword" style="color:#66d9ef">this</span><span class="token plain"> </span><span class="token class-name" style="color:#e6db74">HttpRequestMessage</span><span class="token plain"> request</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token class-name keyword" style="color:#66d9ef">string</span><span class="token plain"> headerName</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token class-name keyword" style="color:#66d9ef">string</span><span class="token plain"> headerValue</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token comment" style="color:#8292a2;font-style:italic">// It&#x27;s possible for there to be multiple headers with the same name; we only want a single header to remain.  Our one.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token keyword" style="color:#66d9ef">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">request</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Headers</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">TryGetValues</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">headerName</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">out</span><span class="token plain"> </span><span class="token class-name keyword" style="color:#66d9ef">var</span><span class="token plain"> existingAuthorizationHeader</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                request</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Headers</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Remove</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">headerName</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            request</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Headers</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">TryAddWithoutValidation</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">headerName</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> headerValue</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">public</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">static</span><span class="token plain"> </span><span class="token return-type class-name" style="color:#e6db74">HttpRequestMessage</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">CreateProxyHttpRequest</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token keyword" style="color:#66d9ef">this</span><span class="token plain"> </span><span class="token class-name" style="color:#e6db74">HttpRequest</span><span class="token plain"> request</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token class-name keyword" style="color:#66d9ef">string</span><span class="token plain"> uriString</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token class-name keyword" style="color:#66d9ef">var</span><span class="token plain"> uri </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name" style="color:#e6db74">Uri</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">uriString </span><span class="token operator" style="color:#66d9ef">+</span><span class="token plain"> request</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">QueryString</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token class-name keyword" style="color:#66d9ef">var</span><span class="token plain"> requestMessage </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name" style="color:#e6db74">HttpRequestMessage</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token class-name keyword" style="color:#66d9ef">var</span><span class="token plain"> requestMethod </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> request</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Method</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token operator" style="color:#66d9ef">!</span><span class="token plain">HttpMethods</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">IsGet</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">requestMethod</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">&amp;&amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                </span><span class="token operator" style="color:#66d9ef">!</span><span class="token plain">HttpMethods</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">IsHead</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">requestMethod</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">&amp;&amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                </span><span class="token operator" style="color:#66d9ef">!</span><span class="token plain">HttpMethods</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">IsDelete</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">requestMethod</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">&amp;&amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                </span><span class="token operator" style="color:#66d9ef">!</span><span class="token plain">HttpMethods</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">IsTrace</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">requestMethod</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                </span><span class="token class-name keyword" style="color:#66d9ef">var</span><span class="token plain"> streamContent </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name" style="color:#e6db74">StreamContent</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">request</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Body</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                requestMessage</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Content </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> streamContent</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token comment" style="color:#8292a2;font-style:italic">// Copy the request headers.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">requestMessage</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Content </span><span class="token operator" style="color:#66d9ef">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">null</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                </span><span class="token keyword" style="color:#66d9ef">foreach</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token class-name keyword" style="color:#66d9ef">var</span><span class="token plain"> header </span><span class="token keyword" style="color:#66d9ef">in</span><span class="token plain"> request</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Headers</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                    </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token operator" style="color:#66d9ef">!</span><span class="token plain">requestMessage</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Headers</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">TryAddWithoutValidation</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">header</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Key</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> header</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Value</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">ToArray</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                        requestMessage</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Content</span><span class="token punctuation" style="color:#f8f8f2">?.</span><span class="token plain">Headers</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">TryAddWithoutValidation</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">header</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Key</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> header</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Value</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">ToArray</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            requestMessage</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Headers</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Host </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> uri</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Authority</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            requestMessage</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">RequestUri </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> uri</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            requestMessage</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Method </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name" style="color:#e6db74">HttpMethod</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">request</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Method</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token keyword" style="color:#66d9ef">return</span><span class="token plain"> requestMessage</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">public</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">static</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">async</span><span class="token plain"> </span><span class="token return-type class-name" style="color:#e6db74">Task</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">CopyProxyHttpResponse</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token keyword" style="color:#66d9ef">this</span><span class="token plain"> </span><span class="token class-name" style="color:#e6db74">HttpContext</span><span class="token plain"> context</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token class-name" style="color:#e6db74">HttpResponseMessage</span><span class="token plain"> responseMessage</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token class-name keyword" style="color:#66d9ef">var</span><span class="token plain"> response </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> context</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Response</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            response</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">StatusCode </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token keyword" style="color:#66d9ef">int</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> responseMessage</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">StatusCode</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token keyword" style="color:#66d9ef">foreach</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token class-name keyword" style="color:#66d9ef">var</span><span class="token plain"> header </span><span class="token keyword" style="color:#66d9ef">in</span><span class="token plain"> responseMessage</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Headers</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                response</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Headers</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">header</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Key</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> header</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Value</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">ToArray</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">responseMessage</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Content </span><span class="token operator" style="color:#66d9ef">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">null</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                </span><span class="token keyword" style="color:#66d9ef">foreach</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token class-name keyword" style="color:#66d9ef">var</span><span class="token plain"> header </span><span class="token keyword" style="color:#66d9ef">in</span><span class="token plain"> responseMessage</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Content</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Headers</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                    response</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Headers</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">header</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Key</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> header</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Value</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">ToArray</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            response</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Headers</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Remove</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&quot;transfer-encoding&quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token keyword" style="color:#66d9ef">using</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token class-name keyword" style="color:#66d9ef">var</span><span class="token plain"> responseStream </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">await</span><span class="token plain"> responseMessage</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Content</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">ReadAsStreamAsync</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">ConfigureAwait</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token boolean" style="color:#ae81ff">false</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                </span><span class="token keyword" style="color:#66d9ef">await</span><span class="token plain"> responseStream</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">CopyToAsync</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Body</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">81920</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> context</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">RequestAborted</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">ConfigureAwait</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token boolean" style="color:#ae81ff">false</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This works out to be a flexible and simple approach to allowlist proxying.</p></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/asp-net">asp.net</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.com/johnnyreilly/blog.johnnyreilly.com/edit/main/blog-website/blog/2019-02-22-aspnet-core-allowlist-proxying-http-requests/index.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/fork-ts-checker-webpack-plugin-v1"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">fork-ts-checker-webpack-plugin v1.0</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/typescript-and-webpack-watch-it"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">TypeScript and webpack: Watch It</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#why-do-we-need-to-proxy" class="table-of-contents__link toc-highlight">Why do we need to proxy?</a></li><li><a href="#the-proxy-regroup" class="table-of-contents__link toc-highlight">The Proxy Regroup</a></li><li><a href="#proxy-part-1" class="table-of-contents__link toc-highlight">Proxy Part 1</a></li><li><a href="#proxy-part-2" class="table-of-contents__link toc-highlight">Proxy Part 2</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item"><div class="footer__title"><a href="/tags/typescript" class="footer__link-item">TypeScript<img src="/img/ts-logo-128.svg" alt="TypeScript icon" class="footer__icon"></a></div>
<ul class="footer__items clean-list">
  <li class="footer__item"><a href="/typescript-vs-jsdoc-javascript" class="footer__link-item">TypeScript vs JSDoc JavaScript</a></li><li class="footer__item"><a href="/type-annotations-strong-types-weakly-held" class="footer__link-item">Type annotations proposal: strong types, weakly held</a></li>
</ul><div class="footer__title"><a href="/tags/azure" class="footer__link-item">Azure<img src="/img/azure-logo.svg" alt="Azure icon" class="footer__icon"></a></div>
<ul class="footer__items clean-list">
  <li class="footer__item"><a href="/azure-container-apps-easy-auth-and-dotnet-authentication" class="footer__link-item">Azure Container Apps: Easy Auth and .NET</a></li><li class="footer__item"><a href="/azure-static-web-apps-dynamic-redirects-azure-functions" class="footer__link-item">Azure Static Web Apps: dynamic redirects with Azure Functions</a></li>
</ul><div class="footer__title"><a href="/tags/asp-net" class="footer__link-item">ASP.NET<img src="/img/dotnet-logo.svg" alt="ASP.NET icon" class="footer__icon"></a></div>
<ul class="footer__items clean-list">
  <li class="footer__item"><a href="/eslint-your-csharp-in-vs-code-with-roslyn-analyzers" class="footer__link-item">ESLint your C# with Roslyn Analyzers</a></li><li class="footer__item"><a href="/aspnet-serilog-and-application-insights" class="footer__link-item">ASP.NET, Serilog and Application Insights</a></li>
</ul><div class="footer__title"><a href="/tags/react" class="footer__link-item">React<img src="/img/react-logo.svg" alt="React icon" class="footer__icon"></a></div>
<ul class="footer__items clean-list">
  <li class="footer__item"><a href="/structured-data-seo-and-react" class="footer__link-item">Structured data and React</a></li><li class="footer__item"><a href="/react-usesearchparamsstate" class="footer__link-item">React: storing state in URL with URLSearchParams</a></li>
</ul></li></ul></div><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item"><div class="footer__title">Notable articles</div>
<ul class="footer__items clean-list">
  <li class="footer__item"><a href="/definitely-typed-the-movie" class="footer__link-item">The history of Definitely Typed<img src="/img/definitely-typed-logo.png" alt="The history of Definitely Typed icon" class="footer__icon"></a></li><li class="footer__item"><a href="/typescript-documentary" class="footer__link-item">TypeScript: the documentary<img src="/img/ts-logo-128.svg" alt="TypeScript: the documentary icon" class="footer__icon"></a></li><li class="footer__item"><a href="/definitive-guide-to-migrating-from-blogger-to-docusaurus" class="footer__link-item">The definitive guide to migrating from Blogger to Docusaurus<img src="/img/docusaurus-logo.svg" alt="The definitive guide to migrating from Blogger to Docusaurus icon" class="footer__icon"></a></li><li class="footer__item"><a href="/how-we-fixed-my-seo" class="footer__link-item">How we fixed my SEO</a></li>
</ul><div class="footer__title">Popular articles</div>
<ul class="footer__items clean-list">
  <li class="footer__item"><a href="/aspnet-serilog-and-application-insights" class="footer__link-item">ASP.NET, Serilog and Application Insights</a></li><li class="footer__item"><a href="/eslint-your-csharp-in-vs-code-with-roslyn-analyzers" class="footer__link-item">ESLint your C# with Roslyn Analyzers</a></li><li class="footer__item"><a href="/prettier-your-csharp-with-dotnet-format-and-lint-staged" class="footer__link-item">dotnet-format: Prettier your C# with lint-staged & husky</a></li>
</ul><div class="footer__title">Recently updated</div>
<ul class="footer__items clean-list">
  <li class="footer__item"><a href="using-bun-in-azure-pipelines" class="footer__link-item">Using Bun in Azure Pipelines</a></li><li class="footer__item"><a href="bicep-lint-azure-pipelines-github-actions" class="footer__link-item">Bicep lint with Azure Pipelines and GitHub Actions</a></li><li class="footer__item"><a href="migrating-azure-functions-node-js-v4-typescript" class="footer__link-item">Migrating to v4 Azure Functions Node.js with TypeScript</a></li>
</ul></li></ul></div><div class="col footer__col"><div class="footer__title">Learn more / support me</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/johnnyreilly/blog.johnnyreilly.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog source code on GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/tags">Blog categories</a></li><li class="footer__item"><a href="https://johnnyreilly.com/rss.xml" target="_blank" rel="noopener noreferrer" class="footer__link-item">RSS feed<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://johnnyreilly.com/atom.xml" target="_blank" rel="noopener noreferrer" class="footer__link-item">Atom feed<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/privacy-policy">Privacy Policy</a></li><li class="footer__item"><iframe src="https://github.com/sponsors/johnnyreilly/card" title="Sponsor johnnyreilly" style="margin-top: 20px; border: 0; border-radius: 10px; background-color: white; min-height: 400px;"></iframe></li><li class="footer__item"><a href="https://www.buymeacoffee.com/qUBm0Wh" rel="noopener" target="_blank"><img src="https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png" loading="lazy" alt="Buy Me A Coffee" style="height: 60px !important;width: 217px !important;"></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2012 - 2024 John Reilly. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>