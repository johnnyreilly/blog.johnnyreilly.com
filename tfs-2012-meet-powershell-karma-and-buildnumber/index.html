<!doctype html><html lang=en dir=ltr class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.7.0"><title data-rh=true>TFS 2012 meet PowerShell, Karma and BuildNumber | johnnyreilly</title><meta data-rh=true name=viewport content="width=device-width, initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:image content=https://johnnyreilly.com/img/profile.jpg><meta data-rh=true name=twitter:image content=https://johnnyreilly.com/img/profile.jpg><meta data-rh=true property=og:url content=https://johnnyreilly.com/tfs-2012-meet-powershell-karma-and-buildnumber><meta data-rh=true property=og:locale content=en><meta data-rh=true name=docusaurus_locale content=en><meta data-rh=true name=docusaurus_tag content=default><meta data-rh=true name=docsearch:language content=en><meta data-rh=true name=docsearch:docusaurus_tag content=default><meta data-rh=true name=robots content=max-image-preview:large><meta data-rh=true name=monetization content=$ilp.uphold.com/LwQQhXdpwxeJ><meta data-rh=true property=og:title content="TFS 2012 meet PowerShell, Karma and BuildNumber | johnnyreilly"><meta data-rh=true name=description content="This guide explains how to run PowerShell scripts for TFS 2012 build processes and how to publish Karma test results in the platform."><meta data-rh=true property=og:description content="This guide explains how to run PowerShell scripts for TFS 2012 build processes and how to publish Karma test results in the platform."><meta data-rh=true property=og:type content=article><meta data-rh=true property=article:published_time content=2016-03-04T00:00:00.000Z><meta data-rh=true property=article:author content=https://johnnyreilly.com/about><meta data-rh=true property=article:tag content="Azure DevOps"><link data-rh=true rel=icon href=/favicon.ico><link data-rh=true rel=canonical href=https://johnnyreilly.com/tfs-2012-meet-powershell-karma-and-buildnumber><link data-rh=true rel=alternate href=https://johnnyreilly.com/tfs-2012-meet-powershell-karma-and-buildnumber hreflang=en><link data-rh=true rel=alternate href=https://johnnyreilly.com/tfs-2012-meet-powershell-karma-and-buildnumber hreflang=x-default><link data-rh=true rel=preconnect href=https://J3MYR1INLT-dsn.algolia.net crossorigin=anonymous><script data-rh=true type=application/ld+json>{"@context":"https://schema.org","@id":"https://johnnyreilly.com/tfs-2012-meet-powershell-karma-and-buildnumber","@type":"BlogPosting","author":{"@type":"Person","description":"OSS Engineer - TypeScript, Azure, React, Node.js, .NET","image":"https://johnnyreilly.com/img/profile.jpg","name":"John Reilly","url":"https://johnnyreilly.com/about"},"datePublished":"2016-03-04T00:00:00.000Z","description":"This guide explains how to run PowerShell scripts for TFS 2012 build processes and how to publish Karma test results in the platform.","headline":"TFS 2012 meet PowerShell, Karma and BuildNumber","isPartOf":{"@id":"https://johnnyreilly.com/","@type":"Blog","name":"I CAN MAKE THIS WORK"},"keywords":[],"mainEntityOfPage":"https://johnnyreilly.com/tfs-2012-meet-powershell-karma-and-buildnumber","name":"TFS 2012 meet PowerShell, Karma and BuildNumber","url":"https://johnnyreilly.com/tfs-2012-meet-powershell-karma-and-buildnumber"}</script><link rel=alternate type=application/rss+xml href=/rss.xml title="I CAN MAKE THIS WORK RSS Feed"><link rel=alternate type=application/atom+xml href=/atom.xml title="I CAN MAKE THIS WORK Atom Feed"><link rel=search type=application/opensearchdescription+xml title=johnnyreilly href=/opensearch.xml><link rel=icon href=/img/profile-64x64.jpg><link rel=manifest href=/manifest.json><meta name=theme-color content=#3578e5><meta name=apple-mobile-web-app-capable content=yes><meta name=apple-mobile-web-app-status-bar-style content=#000><link rel=apple-touch-icon href=/apple-touch-icon.png><link rel=preload href=https://johnnyreilly.com/fonts/Poppins-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=https://johnnyreilly.com/fonts/Poppins-Bold.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preconnect href=https://res.cloudinary.com><link rel=monetization href=https://ilp.uphold.com/LwQQhXdpwxeJ><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@id":"https://johnnyreilly.com","@type":"WebSite","copyrightHolder":{"@id":"https://johnnyreilly.com/about"},"description":"This is John Reilly's blog. John is an Open Source Software Engineer working on TypeScript, Azure, React, Node.js, .NET and more.","inLanguage":"en-UK","name":"johnnyreilly","potentialAction":{"@type":"SearchAction","query-input":"required name=search_term_string","target":{"@type":"EntryPoint","urlTemplate":"https://johnnyreilly.com/search?q={search_term_string}"}},"publisher":{"@id":"https://johnnyreilly.com/about"},"url":"https://johnnyreilly.com"},{"@id":"https://johnnyreilly.com/about","@type":"Person","address":{"@type":"PostalAddress","addressCountry":"United Kingdom","addressLocality":"London","streetAddress":"Twickenham"},"alternateName":"Johnny Reilly","birthPlace":"Bristol","description":"John is an Open Source Software Engineer working on TypeScript, Azure, React, Node.js, .NET and more. As well as writing code, John is a speaker at meetups, one of the founders of the TS Congress conference, and the author of the history of Definitely Typed, which he worked on in the early days of TypeScript.","email":"johnny_reilly@hotmail.com","image":{"@id":"https://johnnyreilly.com/about#image","@type":"ImageObject","caption":"John Reilly","contentUrl":"https://johnnyreilly.com/img/profile.jpg","height":200,"inLanguage":"en-UK","url":"https://johnnyreilly.com/img/profile.jpg","width":200},"name":"John Reilly","sameAs":["https://github.com/johnnyreilly","https://fosstodon.org/@johnny_reilly","https://twitter.com/johnny_reilly","https://bsky.app/profile/johnnyreilly.com","https://dev.to/johnnyreilly","https://app.daily.dev/johnnyreilly","https://stackoverflow.com/users/761388/john-reilly","https://blog.logrocket.com/author/johnreilly/","https://www.reddit.com/user/johnny_reilly","https://uk.linkedin.com/in/johnnyreilly"],"url":"https://johnnyreilly.com"},{"@id":"https://johnnyreilly.com/about#organization","@type":["Organization","Brand"],"description":"This is John Reilly's blog. John is an Open Source Software Engineer working on TypeScript, Azure, React, Node.js, .NET and more.","image":{"@id":"https://johnnyreilly.com/#logo"},"logo":{"@id":"https://johnnyreilly.com/#logo","@type":"ImageObject","caption":"John Reilly","contentUrl":"https://johnnyreilly.com/img/profile.jpg","height":200,"inLanguage":"en-UK","url":"https://johnnyreilly.com/img/profile.jpg","width":200},"name":"johnnyreilly","sameAs":["https://github.com/johnnyreilly","https://fosstodon.org/@johnny_reilly","https://twitter.com/johnny_reilly","https://bsky.app/profile/johnnyreilly.com","https://dev.to/johnnyreilly","https://app.daily.dev/johnnyreilly","https://stackoverflow.com/users/761388/john-reilly","https://blog.logrocket.com/author/johnreilly/","https://www.reddit.com/user/johnny_reilly","https://uk.linkedin.com/in/johnnyreilly"],"url":"https://johnnyreilly.com"}]}</script><link rel=webmention href=https://webmention.io/johnnyreilly.com/webmention><link rel=stylesheet href=/assets/css/styles.172d8ff3.css><script src=/assets/js/runtime~main.346d6426.js defer></script><script src=/assets/js/main.a7c49b72.js defer></script><body class=navigation-with-keyboard><script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:"light",document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><link rel=preload as=image href=/img/profile-64x64.jpg><link rel=preload as=image href=https://johnnyreilly.com/img/profile.jpg><script type=application/ld+json>[{"@context":"https://schema.org","@id":"/tfs-2012-meet-powershell-karma-and-buildnumber#breadcrumb","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://johnnyreilly.com","name":"Home","position":1},{"@type":"ListItem","item":"https://johnnyreilly.com/blog","name":"Blog","position":2},{"@type":"ListItem","name":"TFS 2012 meet PowerShell, Karma and BuildNumber","position":3}],"name":"Blog breadcrumb"}]</script><div role=region aria-label="Skip to main content"><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="navbar navbar--fixed-top"><div class=navbar__inner><div class=navbar__items><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><div class=navbar__logo><img src=/img/profile-64x64.jpg alt="Profile picture of John Reilly" class="themedComponent_mlkZ themedComponent--light_NVdE" height=32 width=32><img src=/img/profile-64x64.jpg alt="Profile picture of John Reilly" class="themedComponent_mlkZ themedComponent--dark_xIcU" height=32 width=32></div><b class="navbar__title text--truncate">John Reilly</b></a><a class="navbar__item navbar__link" href=/about>About</a><a class="navbar__item navbar__link" href=/blog>Blog</a><a class="navbar__item navbar__link" href=/talks>Talks</a></div><div class="navbar__items navbar__items--right"><a href=https://github.com/johnnyreilly target=_blank rel=me class="navbar__item navbar__link">GitHub<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><a href=https://bsky.app/profile/johnnyreilly.com target=_blank rel=me class="navbar__item navbar__link">Bluesky<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><a href=https://fosstodon.org/@johnny_reilly target=_blank rel=me class="navbar__item navbar__link">Mastodon<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><a href=https://twitter.com/johnny_reilly target=_blank rel=me class="navbar__item navbar__link">Twitter<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type=button disabled title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live=polite aria-pressed=false><svg viewBox="0 0 24 24" width=24 height=24 class=lightToggleIcon_pyhR><path fill=currentColor d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 class=darkToggleIcon_wfgR><path fill=currentColor d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"/></svg></button></div><div class=navbarSearchContainer_Bca1><button type=button class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 20 20" aria-hidden=true><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke=currentColor fill=none fill-rule=evenodd stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class=row><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><div role=group><h3 class=yearGroupHeading_rMGB>2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/microsoft-graphclient-filter-endswith-consistencylevel-eventual-header>Microsoft Graph client: how to filter by endswith</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/list-pipelines-with-azure-devops-api>List Pipelines with the Azure DevOps API</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/static-web-apps-cli-local-auth-emulator-with-dotnet-authentication>Static Web Apps CLI: local authentication emulation with ASP.NET</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/nodejs-azure-appinsights-fastify>Node.js, Azure Application Insights, and Fastify</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/get-service-connections-with-azure-devops-api>Get Service Connections with the Azure DevOps API (REST and TypeScript)</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/slash-command-your-deployment-with-github-actions>Slash command your deployment with GitHub Actions</a></ul></div><div role=group><h3 class=yearGroupHeading_rMGB>2024</h3><ul class="sidebarItemList_Yudw clean-list"><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/smuggling-gitignore-npmrc-in-npm-packages>Smuggling .gitignore, .npmrc and friends in npm packages</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/npx-and-azure-artifacts-the-secret-cli-delivery-mechanism>npx and Azure Artifacts: the secret CLI delivery mechanism</a></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class=title_f1Hy>TFS 2012 meet PowerShell, Karma and BuildNumber</h1><div class="container_mt6G margin-vert--md"><time datetime=2016-03-04T00:00:00.000Z>March 4, 2016</time> · <!-- -->6 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href=https://johnnyreilly.com/about target=_blank rel="noopener noreferrer" class=avatar__photo-link><img class="avatar__photo authorImage_XqGP" src=https://johnnyreilly.com/img/profile.jpg alt="John Reilly"></a><div class="avatar__intro authorDetails_lV9A"><div class=avatar__name><a href=https://johnnyreilly.com/about target=_blank rel="noopener noreferrer"><span class=authorName_yefp>John Reilly</span></a></div><small class=authorTitle_nd0D title="OSS Engineer - TypeScript, Azure, React, Node.js, .NET">OSS Engineer - TypeScript, Azure, React, Node.js, .NET</small><div class=authorSocials_rSDt></div></div></div></div></div></header><div id=__blog-post-container class=markdown><p>To my lasting regret, TFS 2012 has no direct support for PowerShell. Such a shame as PowerShell scripts can do a lot of heavy lifting in a build process. Well, here we're going to brute force TFS 2012 into running PowerShell scripts. And along the way we'll also get Karma test results publishing into TFS 2012 as an example usage. Nice huh? Let's go!</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=powershell-via-csproj>PowerShell via <code>csproj</code><a href=#powershell-via-csproj class=hash-link aria-label="Direct link to heading" title="Direct link to heading">​</a></h2>
<p>It's time to hack the <code>csproj</code> (or whatever project file you have) again. We're going to add an <code>AfterBuild</code> target to the end of the file. This target will be triggered after the build completes (as the name suggests):</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#9EFEFF;--prism-background-color:#2D2A55><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style=color:#9EFEFF;background-color:#2D2A55><code class=codeBlockLines_e6Vv><span class=token-line style=color:#9EFEFF><span class="token tag punctuation" style="color:rgb(255, 255, 255)">&lt;</span><span class="token tag" style="color:rgb(255, 157, 0)">Target</span><span class="token tag" style="color:rgb(255, 157, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 180, 84)">Name</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(255, 255, 255)">=</span><span class="token tag attr-value punctuation" style="color:rgb(255, 255, 255)">"</span><span class="token tag attr-value" style="color:rgb(255, 157, 0)">AfterBuild</span><span class="token tag attr-value punctuation" style="color:rgb(255, 255, 255)">"</span><span class="token tag punctuation" style="color:rgb(255, 255, 255)">></span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(255, 255, 255)">&lt;</span><span class="token tag" style="color:rgb(255, 157, 0)">Message</span><span class="token tag" style="color:rgb(255, 157, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 180, 84)">Importance</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(255, 255, 255)">=</span><span class="token tag attr-value punctuation" style="color:rgb(255, 255, 255)">"</span><span class="token tag attr-value" style="color:rgb(255, 157, 0)">High</span><span class="token tag attr-value punctuation" style="color:rgb(255, 255, 255)">"</span><span class="token tag" style="color:rgb(255, 157, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 180, 84)">Text</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(255, 255, 255)">=</span><span class="token tag attr-value punctuation" style="color:rgb(255, 255, 255)">"</span><span class="token tag attr-value" style="color:rgb(255, 157, 0)">AfterBuild: PublishUrl = $(PublishUrl), BuildUri = $(BuildUri), Configuration = $(Configuration), ProjectDir = $(ProjectDir), TargetDir = $(TargetDir), TargetFileName = $(TargetFileName), BuildNumber = $(BuildNumber), BuildDefinitionName = $(BuildDefinitionName)</span><span class="token tag attr-value punctuation" style="color:rgb(255, 255, 255)">"</span><span class="token tag" style="color:rgb(255, 157, 0)"> </span><span class="token tag punctuation" style="color:rgb(255, 255, 255)">/></span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(255, 255, 255)">&lt;</span><span class="token tag" style="color:rgb(255, 157, 0)">Exec</span><span class="token tag" style="color:rgb(255, 157, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 180, 84)">Command</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(255, 255, 255)">=</span><span class="token tag attr-value punctuation" style="color:rgb(255, 255, 255)">"</span><span class="token tag attr-value" style="color:rgb(255, 157, 0)">powershell.exe -NonInteractive -ExecutionPolicy RemoteSigned </span><span class="token tag attr-value punctuation" style="color:rgb(255, 255, 255)">"</span><span class="token tag attr-name" style="color:rgb(255, 180, 84)">&</span><span class="token tag" style="color:rgb(255, 157, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 180, 84)">'$(ProjectDir)AfterBuild.ps1'</span><span class="token tag" style="color:rgb(255, 157, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 180, 84)">'$(Configuration)'</span><span class="token tag" style="color:rgb(255, 157, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 180, 84)">'$(ProjectDir)'</span><span class="token tag" style="color:rgb(255, 157, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 180, 84)">'$(TargetDir)'</span><span class="token tag" style="color:rgb(255, 157, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 180, 84)">'$(PublishUrl)'</span><span class="token tag" style="color:rgb(255, 157, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 180, 84)">'$(BuildNumber)'</span><span class="token tag" style="color:rgb(255, 157, 0)"> </span><span class="token tag attr-name" style="color:rgb(255, 180, 84)">'$(BuildDefinitionName)'""</span><span class="token tag" style="color:rgb(255, 157, 0)"> </span><span class="token tag punctuation" style="color:rgb(255, 255, 255)">/></span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(255, 255, 255)">&lt;/</span><span class="token tag" style="color:rgb(255, 157, 0)">Target</span><span class="token tag punctuation" style="color:rgb(255, 255, 255)">></span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>There's 2 things happening in this target:</p>
<ol>
<li>A message is printed out during compilation which contains details of the various compile time variables. This is nothing more than a <code>console.log</code> statement really; it's useful for debugging and so I keep it around. You'll notice one of them is called <code>$(BuildNumber)</code>; more on that later.</li>
<li>A command is executed; PowerShell! This invokes PowerShell with the <code>-NonInteractive</code> and <code>-ExecutionPolicy RemoteSigned</code> flags. It passes a script to be executed called <code>AfterBuild.ps1</code> that lives in the root of the project directory. To that script a number of parameters are supplied; compile time variables that we may use in the script.</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=wheres-my-buildnumber-and-builddefinitionname>Where's my <code>BuildNumber</code> and <code>BuildDefinitionName</code>?<a href=#wheres-my-buildnumber-and-builddefinitionname class=hash-link aria-label="Direct link to heading" title="Direct link to heading">​</a></h2>
<p>So you've checked in your changes and kicked off a build on the server. You're picking over the log messages and you're thinking: "Where's my <code>BuildNumber</code>?". Well, TFS 2012 does not have that set as a variable at compile time by default. This stumped me for a while but thankfully I wasn't the only person wondering... As ever, <a href=http://stackoverflow.com/a/7330453/761388 target=_blank rel="noopener noreferrer">Stack Overflow had the answer</a>. So, deep breath, it's time to hack the TFS build template file.</p>
<p>Checkout the <code>DefaultTemplate.11.1.xaml</code> file from TFS and open it in your text editor of choice. It's <em>find and replace</em> time! (There are probably 2 instances that need replacement.) Perform a <em>find</em> for the below</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#9EFEFF;--prism-background-color:#2D2A55><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-js codeBlock_bY9V thin-scrollbar" style=color:#9EFEFF;background-color:#2D2A55><code class=codeBlockLines_e6Vv><span class=token-line style=color:#9EFEFF><span class="token punctuation" style="color:rgb(255, 255, 255)">[</span><span class="token known-class-name class-name" style="color:rgb(250, 208, 0)">String</span><span class="token punctuation" style="color:rgb(255, 255, 255)">.</span><span class="token method function property-access maybe-class-name" style="color:rgb(250, 208, 0)">Format</span><span class="token punctuation" style="color:rgb(255, 255, 255)">(</span><span class="token operator" style="color:rgb(255, 157, 0)">&</span><span class="token plain">quot</span><span class="token punctuation" style="color:rgb(255, 255, 255)">;</span><span class="token operator" style="color:rgb(255, 157, 0)">/</span><span class="token plain">p</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token maybe-class-name">SkipInvalidConfigurations</span><span class="token operator" style="color:rgb(255, 157, 0)">=</span><span class="token boolean" style="color:rgb(255, 98, 140)">true</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token number" style="color:rgb(255, 98, 140)">0</span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><span class="token operator" style="color:rgb(255, 157, 0)">&</span><span class="token plain">quot</span><span class="token punctuation" style="color:rgb(255, 255, 255)">;</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"> </span><span class="token maybe-class-name">MSBuildArguments</span><span class="token punctuation" style="color:rgb(255, 255, 255)">)</span><span class="token punctuation" style="color:rgb(255, 255, 255)">]</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>And <em>replace</em> it with this:</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#9EFEFF;--prism-background-color:#2D2A55><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-js codeBlock_bY9V thin-scrollbar" style=color:#9EFEFF;background-color:#2D2A55><code class=codeBlockLines_e6Vv><span class=token-line style=color:#9EFEFF><span class="token punctuation" style="color:rgb(255, 255, 255)">[</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">  </span><span class="token known-class-name class-name" style="color:rgb(250, 208, 0)">String</span><span class="token punctuation" style="color:rgb(255, 255, 255)">.</span><span class="token method function property-access maybe-class-name" style="color:rgb(250, 208, 0)">Format</span><span class="token punctuation" style="color:rgb(255, 255, 255)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">    </span><span class="token string" style="color:rgb(165, 255, 144)">'/p:SkipInvalidConfigurations=true /p:BuildNumber={1} /p:BuildDefinitionName={2} {0}'</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">    </span><span class="token maybe-class-name">MSBuildArguments</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">    </span><span class="token maybe-class-name">BuildDetail</span><span class="token punctuation" style="color:rgb(255, 255, 255)">.</span><span class="token property-access maybe-class-name">BuildNumber</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">    </span><span class="token maybe-class-name">BuildDetail</span><span class="token punctuation" style="color:rgb(255, 255, 255)">.</span><span class="token property-access maybe-class-name">BuildDefinition</span><span class="token punctuation" style="color:rgb(255, 255, 255)">.</span><span class="token property-access maybe-class-name">Name</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">  </span><span class="token punctuation" style="color:rgb(255, 255, 255)">)</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain"></span><span class="token punctuation" style="color:rgb(255, 255, 255)">]</span><span class="token punctuation" style="color:rgb(255, 255, 255)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Pretty long line eh? Let's try breaking that up to make it more readable: (but remember in the XAML it needs to be a one liner)</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#9EFEFF;--prism-background-color:#2D2A55><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-js codeBlock_bY9V thin-scrollbar" style=color:#9EFEFF;background-color:#2D2A55><code class=codeBlockLines_e6Vv><span class=token-line style=color:#9EFEFF><span class="token punctuation" style="color:rgb(255, 255, 255)">[</span><span class="token known-class-name class-name" style="color:rgb(250, 208, 0)">String</span><span class="token punctuation" style="color:rgb(255, 255, 255)">.</span><span class="token method function property-access maybe-class-name" style="color:rgb(250, 208, 0)">Format</span><span class="token punctuation" style="color:rgb(255, 255, 255)">(</span><span class="token plain">"</span><span class="token operator" style="color:rgb(255, 157, 0)">/</span><span class="token plain">p</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token maybe-class-name">SkipInvalidConfigurations</span><span class="token operator" style="color:rgb(255, 157, 0)">=</span><span class="token boolean" style="color:rgb(255, 98, 140)">true</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">    </span><span class="token operator" style="color:rgb(255, 157, 0)">/</span><span class="token plain">p</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token maybe-class-name">BuildNumber</span><span class="token operator" style="color:rgb(255, 157, 0)">=</span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token number" style="color:rgb(255, 98, 140)">1</span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">    </span><span class="token operator" style="color:rgb(255, 157, 0)">/</span><span class="token plain">p</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token maybe-class-name">BuildDefinitionName</span><span class="token operator" style="color:rgb(255, 157, 0)">=</span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token number" style="color:rgb(255, 98, 140)">2</span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token number" style="color:rgb(255, 98, 140)">0</span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><span class="token plain">"</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"> </span><span class="token maybe-class-name">MSBuildArguments</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"> </span><span class="token maybe-class-name">BuildDetail</span><span class="token punctuation" style="color:rgb(255, 255, 255)">.</span><span class="token property-access maybe-class-name">BuildNumber</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"> </span><span class="token maybe-class-name">BuildDetail</span><span class="token punctuation" style="color:rgb(255, 255, 255)">.</span><span class="token property-access maybe-class-name">BuildDefinition</span><span class="token punctuation" style="color:rgb(255, 255, 255)">.</span><span class="token property-access maybe-class-name">Name</span><span class="token punctuation" style="color:rgb(255, 255, 255)">)</span><span class="token punctuation" style="color:rgb(255, 255, 255)">]</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>We're just adding 2 extra parameters of <code>BuildNumber</code> and <code>BuildDefinitionName</code> to the invocation of MSBuild. Once we've checked this back in, <code>BuildNumber</code> and <code>BuildDefinitionName</code> will be available on future builds. Yay! <em>Important! You must have a build name that does not feature spaces; probably there's a way to pass spaces here but I'm not sure what it is.</em></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=afterbuildps1><code>AfterBuild.ps1</code><a href=#afterbuildps1 class=hash-link aria-label="Direct link to heading" title="Direct link to heading">​</a></h2>
<p>You can use your <code>AfterBuild.ps1</code> script to do any number of things. In my case I'm going to use MSTest to publish some test results which have been generated by Karma into TFS:</p>
<div class="language-ps codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#9EFEFF;--prism-background-color:#2D2A55><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-ps codeBlock_bY9V thin-scrollbar" style=color:#9EFEFF;background-color:#2D2A55><code class=codeBlockLines_e6Vv><span class=token-line style=color:#9EFEFF><span class="token plain">param ([string]$configuration, [string]$projectDir, [string]$targetDir, [string]$publishUrl, [string]$buildNumber, [string] $buildDefinitionName)</span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">$ErrorActionPreference = 'Stop'</span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">Clear</span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">function PublishTestResults([string]$resultsFile) {</span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain"> Write-Host 'PublishTests'</span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain"> $mstest = 'C:\Program Files (x86)\Microsoft Visual Studio 14.0\Common7\IDE\MSTest.exe'</span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain"> Write-Host "Using $mstest at $pwd"</span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain"> Write-Host "Publishing: $resultsFile"</span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain"> & $mstest /publishresultsfile:$resultsFile /publish:http://my-tfs-server:8080/tfs /teamproject:MyProject /publishbuild:$buildNumber /platform:'Any CPU' /flavor:Release</span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">}</span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">function FailBuildIfThereAreTestFailures([string]$resultsFile) {</span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain"> $results = [xml](GC $resultsFile)</span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain"> $outcome = $results.TestRun.ResultSummary.outcome</span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain"> $fgColor = if($outcome -eq "Failed") { "Red" } else { "Green" }</span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain"> $total = $results.TestRun.ResultSummary.Counters.total</span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain"> $passed = $results.TestRun.ResultSummary.Counters.passed</span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain"> $failed = $results.TestRun.ResultSummary.Counters.failed</span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain"> $failedTests = $results.TestRun.Results.UnitTestResult | Where-Object { $_.outcome -eq "Failed" }</span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain"> Write-Host Test Results: $outcome -ForegroundColor $fgColor -BackgroundColor "Black"</span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain"> Write-Host Total tests: $total</span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain"> Write-Host Passed: $passed</span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain"> Write-Host Failed: $failed</span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain"> Write-Host</span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain"> $failedTests | % { Write-Host Failed test: $_.testName</span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">  Write-Host $_.Output.ErrorInfo.Message</span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">  Write-Host $_.Output.ErrorInfo.StackTrace }</span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain"> Write-Host</span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain"> if($outcome -eq "Failed") {</span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">  Write-Host "Failing build as there are broken tests"</span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">  $host.SetShouldExit(1)</span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain"> }</span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">}</span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">function Run() {</span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">  Write-Host "Running AfterBuild.ps1 using Configuration: $configuration, projectDir: $projectDir, targetDir: $targetDir, publishUrl: $publishUrl, buildNumber: $buildNumber, buildDefinitionName: $buildDefinitionName"</span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain"> if($buildNumber) {</span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">  $resultsFile = "$projectDir\test-results.trx"</span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">  PublishTestResults $resultsFile</span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">  FailBuildIfThereAreTestFailures $resultsFile</span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain"> }</span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">}</span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain"># Off we go...</span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">Run</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Assuming we have a build number this script kicks off the <code>PublishTestResults</code> function above. So we won't attempt to publish test results when compiling in Visual Studio on our dev machine. The script looks for <code>MSTest.exe</code> in a certain location on disk (the default VS 2015 installation location in fact; it may be installed elsewhere on your build machine). MSTest is then invoked and passed a file called <code>test-results.trx</code> which is is expected to live in the root of the project. All being well, the test results will be registered with the running build and will be visible when you look at test results in TFS.</p>
<p>Finally in <code>FailBuildIfThereAreTestFailures</code> we parse the <code>test-results.trx</code> file (and for this I'm totally in the debt of <a href=https://gist.github.com/davidroberts63/5655441 target=_blank rel="noopener noreferrer">David Robert's helpful Gist</a>). We write out the results to the host so it'll show up in the MSBuild logs. Also, and this is crucial, if there are any failures we fail the build by exiting PowerShell with a code of 1. We are deliberately swallowing any error that Karma raises earlier when it detects failed tests. We do this because we want to publish the failed test results to TFS <em>before</em> we kill the build.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=bonus-karma-test-resultstrx>Bonus Karma: <code>test-results.trx</code><a href=#bonus-karma-test-resultstrx class=hash-link aria-label="Direct link to heading" title="Direct link to heading">​</a></h2>
<p>If you've read a <a href=/visual-studio-tsconfigjson-and-external>previous post of mine</a> you'll be aware that it's possible to get MSBuild to kick off npm build tasks. Specifically I have MSBuild kicking off an <code>npm run build</code>. My <code>package.json</code> looks like this:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#9EFEFF;--prism-background-color:#2D2A55><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-json codeBlock_bY9V thin-scrollbar" style=color:#9EFEFF;background-color:#2D2A55><code class=codeBlockLines_e6Vv><span class=token-line style=color:#9EFEFF><span class="token property" style="color:rgb(255, 157, 0)">"scripts"</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">    </span><span class="token property" style="color:rgb(255, 157, 0)">"test"</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">"karma start --reporters mocha,trx --single-run --browsers PhantomJS"</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">    </span><span class="token property" style="color:rgb(255, 157, 0)">"clean"</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">"gulp delete-dist-contents"</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">    </span><span class="token property" style="color:rgb(255, 157, 0)">"watch"</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">"gulp watch"</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">    </span><span class="token property" style="color:rgb(255, 157, 0)">"build"</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">"gulp build"</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">    </span><span class="token property" style="color:rgb(255, 157, 0)">"postbuild"</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">"npm run test"</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">  </span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>You can see that the <code>postbuild</code> hook kicks off the <code>test</code> script in turn. And that <code>test</code> script kicks off a single run of karma. I'm not going to go over setting up Karma at all here; there are other posts out there that cover that admirably. But I wanted to share news of the <a href=https://www.npmjs.com/package/karma-trx-reporter target=_blank rel="noopener noreferrer">karma trx reporter</a>. This reporter is the thing that produces our <code>test-results.trx</code> file; trx being the format that TFS likes to deal with.</p>
<p>So now we've got a PowerShell hook into our build process (something very useful in itself) which we are using to publish Karma test results into TFS 2012. They said it couldn't be done. They were wrong. Huzzah!!!!!!!</div><footer class=docusaurus-mt-lg><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class=col><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class=tag_QGVx><a title="The Azure DevOps suite of tools." class="tag_zVej tagRegular_sFm0" href=/tags/azure-devops>Azure DevOps</a></ul></div></div><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class=col><a href=https://github.com/johnnyreilly/blog.johnnyreilly.com/edit/main/blog-website/blog/2016-03-04-tfs-2012-meet-powershell-karma-and-buildnumber/index.md target=_blank rel="noopener noreferrer" class=theme-edit-this-page><svg fill=currentColor height=20 width=20 viewBox="0 0 40 40" class=iconEdit_Z9Sw aria-hidden=true><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"/></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href=/atom-recovering-from-corrupted-packages><div class=pagination-nav__sublabel>Newer Post</div><div class=pagination-nav__label>Atom - Recovering from Corrupted Packages</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/creating-angular-ui-routes-in-controller><div class=pagination-nav__sublabel>Older Post</div><div class=pagination-nav__label>Creating Angular UI Routes in the Controller</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#powershell-via-csproj class="table-of-contents__link toc-highlight">PowerShell via <code>csproj</code></a><li><a href=#wheres-my-buildnumber-and-builddefinitionname class="table-of-contents__link toc-highlight">Where's my <code>BuildNumber</code> and <code>BuildDefinitionName</code>?</a><li><a href=#afterbuildps1 class="table-of-contents__link toc-highlight"><code>AfterBuild.ps1</code></a><li><a href=#bonus-karma-test-resultstrx class="table-of-contents__link toc-highlight">Bonus Karma: <code>test-results.trx</code></a></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class=footer__title></div><ul class="footer__items clean-list"><li class=footer__item><div class=footer__title><a href=/tags/typescript class=footer__link-item>TypeScript<img src=/img/ts-logo-128.svg alt="TypeScript icon" class=footer__icon></a></div>
<ul class="footer__items clean-list">
  <li class=footer__item><a href=/typescript-vs-jsdoc-javascript class=footer__link-item>TypeScript vs JSDoc JavaScript</a><li class=footer__item><a href=/type-annotations-strong-types-weakly-held class=footer__link-item>Type annotations proposal: strong types, weakly held</a></li>
</ul><div class=footer__title><a href=/tags/azure class=footer__link-item>Azure<img src=/img/azure-logo.svg alt="Azure icon" class=footer__icon></a></div>
<ul class="footer__items clean-list">
  <li class=footer__item><a href=/azure-container-apps-easy-auth-and-dotnet-authentication class=footer__link-item>Azure Container Apps: Easy Auth and .NET</a><li class=footer__item><a href=/introducing-azdo-npm-auth class=footer__link-item>Introducing azdo-npm-auth (Azure DevOps npm auth)</a><li class=footer__item><a href=/npx-and-azure-artifacts-the-secret-cli-delivery-mechanism class=footer__link-item>npx and Azure Artifacts: the secret CLI delivery mechanism</a><li class=footer__item><a href=/azure-static-web-apps-dynamic-redirects-azure-functions class=footer__link-item>Azure Static Web Apps: dynamic redirects with Azure Functions</a></li>
</ul><div class=footer__title><a href=/tags/asp-net class=footer__link-item>ASP.NET<img src=/img/dotnet-logo.svg alt="ASP.NET icon" class=footer__icon></a></div>
<ul class="footer__items clean-list">
  <li class=footer__item><a href=/eslint-your-csharp-in-vs-code-with-roslyn-analyzers class=footer__link-item>ESLint your C# with Roslyn Analyzers</a><li class=footer__item><a href=/aspnet-serilog-and-application-insights class=footer__link-item>ASP.NET, Serilog and Application Insights</a></li>
</ul><div class=footer__title><a href=/tags/react class=footer__link-item>React<img src=/img/react-logo.svg alt="React icon" class=footer__icon></a></div>
<ul class="footer__items clean-list">
  <li class=footer__item><a href=/structured-data-seo-and-react class=footer__link-item>Structured data and React</a><li class=footer__item><a href=/react-usesearchparamsstate class=footer__link-item>React: storing state in URL with URLSearchParams</a></li>
</ul></ul></div><div class="col footer__col"><div class=footer__title></div><ul class="footer__items clean-list"><li class=footer__item><div class=footer__title>Notable articles</div>
<ul class="footer__items clean-list">
  <li class=footer__item><a href=/definitely-typed-the-movie class=footer__link-item>The history of Definitely Typed<img src=/img/definitely-typed-logo.png alt="The history of Definitely Typed icon" class=footer__icon></a><li class=footer__item><a href=/typescript-documentary class=footer__link-item>TypeScript: the documentary<img src=/img/ts-logo-128.svg alt="TypeScript: the documentary icon" class=footer__icon></a><li class=footer__item><a href=/how-we-fixed-my-seo class=footer__link-item>How we fixed my SEO</a></li>
</ul><div class=footer__title>Popular articles</div>
<ul class="footer__items clean-list">
  <li class=footer__item><a href=/aspnet-serilog-and-application-insights class=footer__link-item>ASP.NET, Serilog and Application Insights</a><li class=footer__item><a href=/eslint-your-csharp-in-vs-code-with-roslyn-analyzers class=footer__link-item>ESLint your C# with Roslyn Analyzers</a><li class=footer__item><a href=/prettier-your-csharp-with-dotnet-format-and-lint-staged class=footer__link-item>dotnet-format: Prettier your C# with lint-staged & husky</a></li>
</ul><div class=footer__title>Recently updated</div>
<ul class="footer__items clean-list">
  <li class=footer__item><a href=graph-api-ad-users-group-name-ids-csharp-sdk class=footer__link-item>Graph API: getting users Active Directory group names and ids with the C# SDK</a><li class=footer__item><a href=microsoft-graphclient-filter-endswith-consistencylevel-eventual-header class=footer__link-item>Microsoft Graph client: how to filter by endswith</a><li class=footer__item><a href=azure-ad-claims-static-web-apps-azure-functions class=footer__link-item>Azure AD Claims with Static Web Apps and Azure Functions</a></li>
</ul></ul></div><div class="col footer__col"><div class=footer__title>Learn more / support me</div><ul class="footer__items clean-list"><li class=footer__item><a class=footer__link-item href=/about>About me</a><li class=footer__item><a href=https://github.com/johnnyreilly/blog.johnnyreilly.com target=_blank rel="noopener noreferrer" class=footer__link-item>Blog source code on GitHub<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a class=footer__link-item href=/tags>Blog categories</a><li class=footer__item><a href=https://johnnyreilly.com/rss.xml target=_blank rel="noopener noreferrer" class=footer__link-item>RSS feed<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://johnnyreilly.com/atom.xml target=_blank rel="noopener noreferrer" class=footer__link-item>Atom feed<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a class=footer__link-item href=/privacy-policy>Privacy Policy</a><li class=footer__item><iframe src=https://github.com/sponsors/johnnyreilly/card title="Sponsor johnnyreilly" style="margin-top: 20px; border: 0; border-radius: 10px; background-color: white; min-height: 400px;"></iframe><li class=footer__item><a href=https://www.buymeacoffee.com/qUBm0Wh rel=noopener target=_blank><img src=https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png loading=lazy alt="Buy Me A Coffee" style="height: 60px !important;width: 217px !important;"></a></ul></div></div><div class="footer__bottom text--center"><div class=footer__copyright>Copyright © 2012 - 2025 John Reilly. Built with Docusaurus.</div></div></div></footer></div>