<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Dual Publishing ESM and CJS Modules with tsup and Are the Types Wrong? | johnnyreilly</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://johnnyreilly.com/dual-publishing-esm-cjs-modules-with-tsup-and-are-the-types-wrong"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" name="robots" content="max-image-preview:large"><meta data-rh="true" name="monetization" content="$ilp.uphold.com/LwQQhXdpwxeJ"><meta data-rh="true" property="og:title" content="Dual Publishing ESM and CJS Modules with tsup and Are the Types Wrong? | johnnyreilly"><meta data-rh="true" name="description" content="Learn how to publish a package that supports both ECMAScript modules (ESM) and CommonJS modules (CJS) using tsup and Are the Types Wrong?"><meta data-rh="true" property="og:description" content="Learn how to publish a package that supports both ECMAScript modules (ESM) and CommonJS modules (CJS) using tsup and Are the Types Wrong?"><meta data-rh="true" property="og:image" content="https://johnnyreilly.com/assets/images/title-image-dc75470e8b6f2a9987c70908fbd3c61a.png"><meta data-rh="true" name="twitter:image" content="https://johnnyreilly.com/assets/images/title-image-dc75470e8b6f2a9987c70908fbd3c61a.png"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2024-06-15T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://johnnyreilly.com/about"><meta data-rh="true" property="article:tag" content="TypeScript"><link data-rh="true" rel="icon" href="/favicon.ico"><link data-rh="true" rel="canonical" href="https://johnnyreilly.com/dual-publishing-esm-cjs-modules-with-tsup-and-are-the-types-wrong"><link data-rh="true" rel="alternate" href="https://johnnyreilly.com/dual-publishing-esm-cjs-modules-with-tsup-and-are-the-types-wrong" hreflang="en"><link data-rh="true" rel="alternate" href="https://johnnyreilly.com/dual-publishing-esm-cjs-modules-with-tsup-and-are-the-types-wrong" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://J3MYR1INLT-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://johnnyreilly.com/dual-publishing-esm-cjs-modules-with-tsup-and-are-the-types-wrong","mainEntityOfPage":"https://johnnyreilly.com/dual-publishing-esm-cjs-modules-with-tsup-and-are-the-types-wrong","url":"https://johnnyreilly.com/dual-publishing-esm-cjs-modules-with-tsup-and-are-the-types-wrong","headline":"Dual Publishing ESM and CJS Modules with tsup and Are the Types Wrong?","name":"Dual Publishing ESM and CJS Modules with tsup and Are the Types Wrong?","description":"Learn how to publish a package that supports both ECMAScript modules (ESM) and CommonJS modules (CJS) using tsup and Are the Types Wrong?","datePublished":"2024-06-15T00:00:00.000Z","author":{"@type":"Person","name":"John Reilly","description":"OSS Engineer - TypeScript, Azure, React, Node.js, .NET","url":"https://johnnyreilly.com/about","image":"https://johnnyreilly.com/img/profile.jpg"},"image":{"@type":"ImageObject","@id":"https://johnnyreilly.com/assets/images/title-image-dc75470e8b6f2a9987c70908fbd3c61a.png","url":"https://johnnyreilly.com/assets/images/title-image-dc75470e8b6f2a9987c70908fbd3c61a.png","contentUrl":"https://johnnyreilly.com/assets/images/title-image-dc75470e8b6f2a9987c70908fbd3c61a.png","caption":"title image for the blog post: Dual Publishing ESM and CJS Modules with tsup and Are the Types Wrong?"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://johnnyreilly.com/","name":"I CAN MAKE THIS WORK"}}</script><link rel="alternate" type="application/rss+xml" href="/rss.xml" title="I CAN MAKE THIS WORK RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="I CAN MAKE THIS WORK Atom Feed">




<link rel="search" type="application/opensearchdescription+xml" title="johnnyreilly" href="/opensearch.xml">

<link rel="icon" href="/img/profile-64x64.jpg">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#3578e5">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#000">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">

<link rel="preload" href="https://johnnyreilly.com/fonts/Poppins-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://johnnyreilly.com/fonts/Poppins-Bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preconnect" href="https://res.cloudinary.com">
<link rel="monetization" href="https://ilp.uphold.com/LwQQhXdpwxeJ">
<script type="application/ld+json">{"@context":"https://schema.org","@graph":[{"@id":"https://johnnyreilly.com","@type":"WebSite","url":"https://johnnyreilly.com","name":"johnnyreilly","description":"This is John Reilly's blog. John is an Open Source Software Engineer working on TypeScript, Azure, React, Node.js, .NET and more.","copyrightHolder":{"@id":"https://johnnyreilly.com/about"},"publisher":{"@id":"https://johnnyreilly.com/about"},"potentialAction":{"@type":"SearchAction","target":{"@type":"EntryPoint","urlTemplate":"https://johnnyreilly.com/search?q={search_term_string}"},"query-input":"required name=search_term_string"},"inLanguage":"en-UK"},{"@id":"https://johnnyreilly.com/about","@type":"Person","name":"John Reilly","alternateName":"Johnny Reilly","image":{"@type":"ImageObject","inLanguage":"en-UK","@id":"https://johnnyreilly.com/about#image","url":"https://johnnyreilly.com/img/profile.jpg","contentUrl":"https://johnnyreilly.com/img/profile.jpg","width":200,"height":200,"caption":"John Reilly"},"description":"John is an Open Source Software Engineer working on TypeScript, Azure, React, Node.js, .NET and more. As well as writing code, John is a speaker at meetups, one of the founders of the TS Congress conference, and the author of the history of Definitely Typed, which he worked on in the early days of TypeScript.","url":"https://johnnyreilly.com","address":{"@type":"PostalAddress","streetAddress":"Twickenham","addressLocality":"London","addressCountry":"United Kingdom"},"email":"johnny_reilly@hotmail.com","birthPlace":"Bristol","sameAs":["https://github.com/johnnyreilly","https://fosstodon.org/@johnny_reilly","https://twitter.com/johnny_reilly","https://bsky.app/profile/johnnyreilly.com","https://dev.to/johnnyreilly","https://app.daily.dev/johnnyreilly","https://stackoverflow.com/users/761388/john-reilly","https://blog.logrocket.com/author/johnreilly/","https://www.reddit.com/user/johnny_reilly","https://uk.linkedin.com/in/johnnyreilly"]},{"@id":"https://johnnyreilly.com/about#organization","@type":["Organization","Brand"],"url":"https://johnnyreilly.com","name":"johnnyreilly","description":"This is John Reilly's blog. John is an Open Source Software Engineer working on TypeScript, Azure, React, Node.js, .NET and more.","logo":{"@type":"ImageObject","inLanguage":"en-UK","@id":"https://johnnyreilly.com/#logo","url":"https://johnnyreilly.com/img/profile.jpg","contentUrl":"https://johnnyreilly.com/img/profile.jpg","width":200,"height":200,"caption":"John Reilly"},"image":{"@id":"https://johnnyreilly.com/#logo"},"sameAs":["https://github.com/johnnyreilly","https://fosstodon.org/@johnny_reilly","https://twitter.com/johnny_reilly","https://bsky.app/profile/johnnyreilly.com","https://dev.to/johnnyreilly","https://app.daily.dev/johnnyreilly","https://stackoverflow.com/users/761388/john-reilly","https://blog.logrocket.com/author/johnreilly/","https://www.reddit.com/user/johnny_reilly","https://uk.linkedin.com/in/johnnyreilly"]}]}</script>
<link rel="webmention" href="https://webmention.io/johnnyreilly.com/webmention"><link rel="stylesheet" href="/assets/css/styles.808d888d.css">
<script src="/assets/js/runtime~main.c2c8c6c4.js" defer="defer"></script>
<script src="/assets/js/main.800cdac4.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/profile-64x64.jpg"><link rel="preload" as="image" href="https://johnnyreilly.com/img/profile.jpg"><link rel="preload" as="image" href="/assets/images/title-image-dc75470e8b6f2a9987c70908fbd3c61a.png"><script type="application/ld+json">[{"@context":"https://schema.org","@type":"BreadcrumbList","@id":"/dual-publishing-esm-cjs-modules-with-tsup-and-are-the-types-wrong#breadcrumb","name":"Blog breadcrumb","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https://johnnyreilly.com"},{"@type":"ListItem","position":2,"name":"Blog","item":"https://johnnyreilly.com/blog"},{"@type":"ListItem","position":3,"name":"Dual Publishing ESM and CJS Modules with tsup and Are the Types Wrong?"}]}]</script><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/profile-64x64.jpg" alt="Profile picture of John Reilly" class="themedComponent_mlkZ themedComponent--light_NVdE" height="32" width="32"><img src="/img/profile-64x64.jpg" alt="Profile picture of John Reilly" class="themedComponent_mlkZ themedComponent--dark_xIcU" height="32" width="32"></div><b class="navbar__title text--truncate">John Reilly</b></a><a class="navbar__item navbar__link" href="/about">About</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/talks">Talks</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/johnnyreilly" target="_blank" rel="me" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><a href="https://bsky.app/profile/johnnyreilly.com" target="_blank" rel="me" class="navbar__item navbar__link">Bluesky<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><a href="https://fosstodon.org/@johnny_reilly" target="_blank" rel="me" class="navbar__item navbar__link">Mastodon<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><a href="https://twitter.com/johnny_reilly" target="_blank" rel="me" class="navbar__item navbar__link">Twitter<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure-devops-with-defaultazurecredential">Azure DevOps: using DefaultAzureCredential in an Azure Pipeline with AzureCLI@2</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure-devops-pull-requests-dynamic-required-reviewers">Azure DevOps: pull requests and dynamic required reviewers</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/typescript-go-pragmatic-choice">TypeScript is going Go: Why it’s the pragmatic choice</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/microsoft-graphclient-filter-endswith-consistencylevel-eventual-header">Microsoft Graph client: how to filter by endswith</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/list-pipelines-with-azure-devops-api">List Pipelines with the Azure DevOps API</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/static-web-apps-cli-local-auth-emulator-with-dotnet-authentication">Static Web Apps CLI: local authentication emulation with ASP.NET</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/nodejs-azure-appinsights-fastify">Node.js, Azure Application Insights, and Fastify</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/get-service-connections-with-azure-devops-api">Get Service Connections with the Azure DevOps API (REST and TypeScript)</a></li></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class="title_f1Hy">Dual Publishing ESM and CJS Modules with tsup and Are the Types Wrong?</h1><div class="container_mt6G margin-vert--md"><time datetime="2024-06-15T00:00:00.000Z">June 15, 2024</time> · <!-- -->6 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://johnnyreilly.com/about" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://johnnyreilly.com/img/profile.jpg" alt="John Reilly"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://johnnyreilly.com/about" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">John Reilly</span></a></div><small class="authorTitle_nd0D" title="OSS Engineer - TypeScript, Azure, React, Node.js, .NET">OSS Engineer - TypeScript, Azure, React, Node.js, .NET</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><p>If you need to publish a package that supports both ECMAScript modules (ESM) and CommonJS modules (CJS), you can use <a href="https://github.com/egoist/tsup" target="_blank" rel="noopener noreferrer"><code>tsup</code></a> to do so. This post will show you how to do that and how to ensure that the types are correct using the tool <a href="https://github.com/arethetypeswrong/arethetypeswrong.github.io" target="_blank" rel="noopener noreferrer"><code>Are the Types Wrong?</code></a>.</p>
<p><img decoding="async" loading="eager" alt="title image reading &amp;quot;Dual Publishing ESM and CJS Modules with tsup and Are the Types Wrong?&amp;quot; with the Are the Types Wrong logo" src="/assets/images/title-image-dc75470e8b6f2a9987c70908fbd3c61a.png" width="800" height="450" fetchpriority="high" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="package-support-for-esm-and-cjs-with-tsup">Package support for ESM and CJS with tsup<a href="#package-support-for-esm-and-cjs-with-tsup" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h2>
<p>I recently needed to build a package that supported both ESM and CJS modules. After attempting to implement this myself, and frankly aging ten years, I decided to see if there was a tool out there that could help me. Happily, there are a number of tools that can help with this and I found that the excellent <code>tsup</code> was the easiest to use.</p>
<p><code>tsup</code> is a zero-config TypeScript bundler with a focus on speed and simplicity. It&#x27;s a great tool for building and bundling your TypeScript code into ESM and CJS modules and is powered by <a href="https://github.com/evanw/esbuild" target="_blank" rel="noopener noreferrer"><code>esbuild</code></a>.</p>
<p>To get started, you can install <code>tsup</code> to your project:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9EFEFF;--prism-background-color:#2D2A55"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#9EFEFF;background-color:#2D2A55"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9EFEFF"><span class="token function" style="color:rgb(250, 208, 0)">npm</span><span class="token plain"> </span><span class="token function" style="color:rgb(250, 208, 0)">install</span><span class="token plain"> tsup --save-dev</span><br></span></code></pre></div></div>
<p>Then you can add a script to your <code>package.json</code> to build your package:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9EFEFF;--prism-background-color:#2D2A55"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#9EFEFF;background-color:#2D2A55"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9EFEFF"><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">  </span><span class="token property" style="color:rgb(255, 157, 0)">&quot;scripts&quot;</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">    </span><span class="token property" style="color:rgb(255, 157, 0)">&quot;build&quot;</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">&quot;tsup src/index.ts --format cjs,esm --dts --clean --sourcemap&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain"></span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><br></span></code></pre></div></div>
<p>In this example, we&#x27;re building the <code>src/index.ts</code> file into both CJS and ESM modules, generating type definitions, cleaning up the output directory prior to build, and generating sourcemaps. You can, if you like, use a <code>tsup.config.ts</code> file to configure <code>tsup</code> but I found the above to be sufficient for my needs.</p>
<p>When you run <code>npm run build</code>, you&#x27;ll see that <code>tsup</code> has created a <code>dist</code> directory with the following structure:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9EFEFF;--prism-background-color:#2D2A55"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#9EFEFF;background-color:#2D2A55"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9EFEFF"><span class="token plain">dist/</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">  index.cjs</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">  index.cjs.map</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">  index.d.cts</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">  index.js</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">  index.js.map</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">  index.d.ts</span><br></span></code></pre></div></div>
<p>The <code>index.js</code> and <code>index.js.map</code> files are the ESM modules and the <code>index.cjs</code> and <code>index.cjs.map</code> files are the CJS modules. The <code>index.d.ts</code> and <code>index.d.cts</code> files contain the type definitions.</p>
<p>This is great news! You now have a package that supports both ESM and CJS modules. But now we need to get our <code>package.json</code> file set up correctly.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="linting-your-packagejson-file-with-are-the-types-wrong">Linting your package.json file with Are the Types Wrong?<a href="#linting-your-packagejson-file-with-are-the-types-wrong" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h2>
<p>When you&#x27;re publishing a package, it&#x27;s important to ensure that your <code>package.json</code> file is set up correctly. It is the manifest that other packages consume. If it is not set up correctly, things won&#x27;t work at runtime and you&#x27;ll have an unpleasant engineering experience in your IDE as well. Getting it right includes ensuring that the <code>exports</code> field is set up correctly to support both ESM and CJS modules. This can be a bit tricky to get right, so it&#x27;s a good idea to use a tool to help you.</p>
<p>I made the following additions to my <code>package.json</code> file to support both ESM and CJS modules:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9EFEFF;--prism-background-color:#2D2A55"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#9EFEFF;background-color:#2D2A55"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9EFEFF"><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">  </span><span class="token property" style="color:rgb(255, 157, 0)">&quot;//&quot;</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">&quot;This is the correct way to set up a package with a `src/index.ts` root file that supports both ESM and CJS modules.&quot;</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">  </span><span class="token property" style="color:rgb(255, 157, 0)">&quot;type&quot;</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">&quot;module&quot;</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">  </span><span class="token property" style="color:rgb(255, 157, 0)">&quot;main&quot;</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">&quot;./dist/index.cjs&quot;</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">  </span><span class="token property" style="color:rgb(255, 157, 0)">&quot;module&quot;</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">&quot;./dist/index.js&quot;</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">  </span><span class="token property" style="color:rgb(255, 157, 0)">&quot;types&quot;</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">&quot;./dist/index.d.ts&quot;</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">  </span><span class="token property" style="color:rgb(255, 157, 0)">&quot;exports&quot;</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">    </span><span class="token property" style="color:rgb(255, 157, 0)">&quot;import&quot;</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">      </span><span class="token property" style="color:rgb(255, 157, 0)">&quot;types&quot;</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">&quot;./dist/index.d.ts&quot;</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">      </span><span class="token property" style="color:rgb(255, 157, 0)">&quot;import&quot;</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">&quot;./dist/index.js&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">    </span><span class="token property" style="color:rgb(255, 157, 0)">&quot;require&quot;</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">      </span><span class="token property" style="color:rgb(255, 157, 0)">&quot;types&quot;</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">&quot;./dist/index.d.cts&quot;</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">      </span><span class="token property" style="color:rgb(255, 157, 0)">&quot;require&quot;</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">&quot;./dist/index.cjs&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain"></span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><br></span></code></pre></div></div>
<p>Let&#x27;s break this down:</p>
<ul>
<li>The <code>type</code> field is set to <code>module</code> to indicate that the package supports ESM modules.</li>
<li>The <code>main</code> field is set to <code>./dist/index.cjs</code> to indicate the entry point for CJS modules.</li>
<li>The <code>module</code> field is set to <code>./dist/index.js</code> to indicate the entry point for ESM modules.</li>
<li>The <code>types</code> field is set to <code>./dist/index.d.ts</code> to indicate the type definitions file for ESM modules.</li>
</ul>
<p>We then set up the <code>exports</code> field to support both ESM and CJS modules. The <code>import</code> field is set up to support ESM modules and the <code>require</code> field is set up to support CJS modules. In each, the <code>types</code> field is set to the relevant type definitions file - significantly, the <code>types</code> comes first.</p>
<p>Here I&#x27;ve jumped straight to the good part here. I&#x27;ve given you the correct way to set up the <code>exports</code> field for a package that supports both ESM and CJS modules. But how do you know if your <code>package.json</code> file is set up correctly?</p>
<p>Well, in my case I used the tool <a href="https://arethetypeswrong.github.io/" target="_blank" rel="noopener noreferrer"><code>Are the Types Wrong</code></a> to lint my <code>package.json</code> file. <code>Are the Types Wrong</code> is a tool that checks your <code>package.json</code> file to ensure that it&#x27;s set up correctly for publishing a package that supports both ESM and CJS modules. You&#x27;re possibly aware of the <a href="https://arethetypeswrong.github.io/" target="_blank" rel="noopener noreferrer">website</a> but did you know that there&#x27;s a CLI tool that you can use to lint your <code>package.json</code> file?</p>
<p>There is.</p>
<p>If you would like to read the full documentation on the CLI tool, you can find it <a href="https://github.com/arethetypeswrong/arethetypeswrong.github.io/blob/main/packages/cli/README.md" target="_blank" rel="noopener noreferrer">here</a>. However, if you&#x27;re like me and in a hurry, you can just use it like this:</p>
<ul>
<li>cd into your project directory</li>
<li>run <code>npx --yes @arethetypeswrong/cli --pack .</code></li>
<li>et voila, your <code>package.json</code> file will be linted for type issues</li>
</ul>
<p>To see what this looks like, here&#x27;s the output from running <code>npx @arethetypeswrong/cli</code> in the project directory of a package with the <code>package.json</code> file <em>not</em> set up correctly:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9EFEFF;--prism-background-color:#2D2A55"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#9EFEFF;background-color:#2D2A55"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9EFEFF"><span class="token plain">api v1.0.0</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">Build tools:</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">- typescript@^5.2.2</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">❌ Import resolved to JavaScript files, but no </span><span class="token builtin class-name" style="color:rgb(250, 208, 0)">type</span><span class="token plain"> declarations were found. https://github.com/arethetypeswrong/arethetypeswrong.github.io/blob/main/docs/problems/UntypedResolution.md</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">┌───────────────────┬─────────────┐</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">│                   │ </span><span class="token string" style="color:rgb(165, 255, 144)">&quot;api&quot;</span><span class="token plain">       │</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">├───────────────────┼─────────────┤</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">│ node10            │ ❌ No types │</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">├───────────────────┼─────────────┤</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">│ node16 </span><span class="token punctuation" style="color:rgb(255, 255, 255)">(</span><span class="token plain">from CJS</span><span class="token punctuation" style="color:rgb(255, 255, 255)">)</span><span class="token plain"> │ ❌ No types │</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">├───────────────────┼─────────────┤</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">│ node16 </span><span class="token punctuation" style="color:rgb(255, 255, 255)">(</span><span class="token plain">from ESM</span><span class="token punctuation" style="color:rgb(255, 255, 255)">)</span><span class="token plain"> │ ❌ No types │</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">├───────────────────┼─────────────┤</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">│ bundler           │ ❌ No types │</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">└───────────────────┴─────────────┘</span><br></span></code></pre></div></div>
<p>By contrast, here&#x27;s how it looks when you use the correct <code>package.json</code> file:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9EFEFF;--prism-background-color:#2D2A55"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#9EFEFF;background-color:#2D2A55"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9EFEFF"><span class="token plain">shared v1.0.0</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">Build tools:</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">- typescript@^5.4.5</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">- tsup@^8.1.0</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain"> No problems found 🌟</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">┌───────────────────┬──────────┐</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">│                   │ </span><span class="token string" style="color:rgb(165, 255, 144)">&quot;api&quot;</span><span class="token plain">    │</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">├───────────────────┼──────────┤</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">│ node10            │ 🟢       │</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">├───────────────────┼──────────┤</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">│ node16 </span><span class="token punctuation" style="color:rgb(255, 255, 255)">(</span><span class="token plain">from CJS</span><span class="token punctuation" style="color:rgb(255, 255, 255)">)</span><span class="token plain"> │ 🟢 </span><span class="token punctuation" style="color:rgb(255, 255, 255)">(</span><span class="token plain">CJS</span><span class="token punctuation" style="color:rgb(255, 255, 255)">)</span><span class="token plain"> │</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">├───────────────────┼──────────┤</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">│ node16 </span><span class="token punctuation" style="color:rgb(255, 255, 255)">(</span><span class="token plain">from ESM</span><span class="token punctuation" style="color:rgb(255, 255, 255)">)</span><span class="token plain"> │ 🟢 </span><span class="token punctuation" style="color:rgb(255, 255, 255)">(</span><span class="token plain">ESM</span><span class="token punctuation" style="color:rgb(255, 255, 255)">)</span><span class="token plain"> │</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">├───────────────────┼──────────┤</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">│ bundler           │ 🟢       │</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">└───────────────────┴──────────┘</span><br></span></code></pre></div></div>
<p>Isn&#x27;t that great? You can now be confident that your <code>package.json</code> file is set up correctly for publishing a package that supports both ESM and CJS modules, both from a runtime code and a types perspective. So the full <code>package.json</code> might look something like this:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9EFEFF;--prism-background-color:#2D2A55"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#9EFEFF;background-color:#2D2A55"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9EFEFF"><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">  </span><span class="token property" style="color:rgb(255, 157, 0)">&quot;name&quot;</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">&quot;our-package&quot;</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">  </span><span class="token property" style="color:rgb(255, 157, 0)">&quot;version&quot;</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">&quot;1.0.0&quot;</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">  </span><span class="token property" style="color:rgb(255, 157, 0)">&quot;description&quot;</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">  </span><span class="token property" style="color:rgb(255, 157, 0)">&quot;scripts&quot;</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">    </span><span class="token property" style="color:rgb(255, 157, 0)">&quot;build&quot;</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">&quot;tsup src/index.ts --format cjs,esm --dts --clean --sourcemap&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">  </span><span class="token property" style="color:rgb(255, 157, 0)">&quot;author&quot;</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">  </span><span class="token property" style="color:rgb(255, 157, 0)">&quot;license&quot;</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">&quot;ISC&quot;</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">  </span><span class="token property" style="color:rgb(255, 157, 0)">&quot;dependencies&quot;</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">  </span><span class="token property" style="color:rgb(255, 157, 0)">&quot;devDependencies&quot;</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">    </span><span class="token property" style="color:rgb(255, 157, 0)">&quot;tsup&quot;</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">&quot;^8.1.0&quot;</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">    </span><span class="token property" style="color:rgb(255, 157, 0)">&quot;typescript&quot;</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">&quot;^5.4.5&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">  </span><span class="token property" style="color:rgb(255, 157, 0)">&quot;type&quot;</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">&quot;module&quot;</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">  </span><span class="token property" style="color:rgb(255, 157, 0)">&quot;main&quot;</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">&quot;./dist/index.cjs&quot;</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">  </span><span class="token property" style="color:rgb(255, 157, 0)">&quot;module&quot;</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">&quot;./dist/index.js&quot;</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">  </span><span class="token property" style="color:rgb(255, 157, 0)">&quot;types&quot;</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">&quot;./dist/index.d.ts&quot;</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">  </span><span class="token property" style="color:rgb(255, 157, 0)">&quot;exports&quot;</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">    </span><span class="token property" style="color:rgb(255, 157, 0)">&quot;import&quot;</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">      </span><span class="token property" style="color:rgb(255, 157, 0)">&quot;types&quot;</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">&quot;./dist/index.d.ts&quot;</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">      </span><span class="token property" style="color:rgb(255, 157, 0)">&quot;import&quot;</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">&quot;./dist/index.js&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">    </span><span class="token property" style="color:rgb(255, 157, 0)">&quot;require&quot;</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">      </span><span class="token property" style="color:rgb(255, 157, 0)">&quot;types&quot;</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">&quot;./dist/index.d.cts&quot;</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">      </span><span class="token property" style="color:rgb(255, 157, 0)">&quot;require&quot;</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">&quot;./dist/index.cjs&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain"></span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h2>
<p>In this post, we&#x27;ve seen how to publish a package that supports both ESM and CJS modules using <code>tsup</code>. We&#x27;ve also seen how to ensure that the types are correct using the tool <code>Are the Types Wrong</code>.</p>
<p>It&#x27;s probably worth saying that <code>Are the Types Wrong</code> doesn&#x27;t check everything, and that <code>tsup</code>s method of dual compilation makes some unchecked assumptions too. Using these tools isn&#x27;t a silver bullet, given how complicated the ESM/CJS compatibility story is, but they do their best to help.</p>
<p>Thanks to <a href="https://github.com/andrewbranch" target="_blank" rel="noopener noreferrer">Andrew Branch</a> for putting together <code>Are the Types Wrong</code> and to the folk that work on <code>tsup</code> for making it easy to build packages that support both ESM and CJS modules. Thanks also to Andrew for his help in reviewing this post.</p>
<p>Remember, friends don&#x27;t let friends publish packages with incorrect types!</p></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" title="The TypeScript programming language." class="tag_zVej tagRegular_sFm0" href="/tags/typescript">TypeScript</a></li></ul></div></div><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><a href="https://github.com/johnnyreilly/blog.johnnyreilly.com/edit/main/blog-website/blog/2024-06-15-dual-publishing-esm-cjs-modules-with-tsup-are-the-types-wrong/index.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/static-web-apps-cli-improve-performance-with-vite-server-proxy"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Static Web Apps CLI: improve performance with Vite server proxy</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/mui-react-tree-view-check-children-uncheck-parents"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">MUI React Tree View: check children, uncheck parents</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#package-support-for-esm-and-cjs-with-tsup" class="table-of-contents__link toc-highlight">Package support for ESM and CJS with tsup</a></li><li><a href="#linting-your-packagejson-file-with-are-the-types-wrong" class="table-of-contents__link toc-highlight">Linting your package.json file with Are the Types Wrong?</a></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a></li></ul></div></div></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item"><div class="footer__title"><a href="/tags/typescript" class="footer__link-item">TypeScript<img src="/img/ts-logo-128.svg" alt="TypeScript icon" class="footer__icon"></a></div>
<ul class="footer__items clean-list">
  <li class="footer__item"><a href="/typescript-vs-jsdoc-javascript" class="footer__link-item">TypeScript vs JSDoc JavaScript</a></li><li class="footer__item"><a href="/type-annotations-strong-types-weakly-held" class="footer__link-item">Type annotations proposal: strong types, weakly held</a></li>
</ul><div class="footer__title"><a href="/tags/azure" class="footer__link-item">Azure<img src="/img/azure-logo.svg" alt="Azure icon" class="footer__icon"></a></div>
<ul class="footer__items clean-list">
  <li class="footer__item"><a href="/azure-container-apps-easy-auth-and-dotnet-authentication" class="footer__link-item">Azure Container Apps: Easy Auth and .NET</a></li><li class="footer__item"><a href="/introducing-azdo-npm-auth" class="footer__link-item">Introducing azdo-npm-auth (Azure DevOps npm auth)</a></li><li class="footer__item"><a href="/npx-and-azure-artifacts-the-secret-cli-delivery-mechanism" class="footer__link-item">npx and Azure Artifacts: the secret CLI delivery mechanism</a></li><li class="footer__item"><a href="/azure-static-web-apps-dynamic-redirects-azure-functions" class="footer__link-item">Azure Static Web Apps: dynamic redirects with Azure Functions</a></li>
</ul><div class="footer__title"><a href="/tags/asp-net" class="footer__link-item">ASP.NET<img src="/img/dotnet-logo.svg" alt="ASP.NET icon" class="footer__icon"></a></div>
<ul class="footer__items clean-list">
  <li class="footer__item"><a href="/eslint-your-csharp-in-vs-code-with-roslyn-analyzers" class="footer__link-item">ESLint your C# with Roslyn Analyzers</a></li><li class="footer__item"><a href="/aspnet-serilog-and-application-insights" class="footer__link-item">ASP.NET, Serilog and Application Insights</a></li>
</ul><div class="footer__title"><a href="/tags/react" class="footer__link-item">React<img src="/img/react-logo.svg" alt="React icon" class="footer__icon"></a></div>
<ul class="footer__items clean-list">
  <li class="footer__item"><a href="/structured-data-seo-and-react" class="footer__link-item">Structured data and React</a></li><li class="footer__item"><a href="/react-usesearchparamsstate" class="footer__link-item">React: storing state in URL with URLSearchParams</a></li>
</ul></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item"><div class="footer__title">Notable articles</div>
<ul class="footer__items clean-list">
  <li class="footer__item"><a href="/definitely-typed-the-movie" class="footer__link-item">The history of Definitely Typed<img src="/img/definitely-typed-logo.png" alt="The history of Definitely Typed icon" class="footer__icon"></a></li><li class="footer__item"><a href="/typescript-documentary" class="footer__link-item">TypeScript: the documentary<img src="/img/ts-logo-128.svg" alt="TypeScript: the documentary icon" class="footer__icon"></a></li><li class="footer__item"><a href="/how-we-fixed-my-seo" class="footer__link-item">How we fixed my SEO</a></li>
</ul><div class="footer__title">Popular articles</div>
<ul class="footer__items clean-list">
  <li class="footer__item"><a href="/aspnet-serilog-and-application-insights" class="footer__link-item">ASP.NET, Serilog and Application Insights</a></li><li class="footer__item"><a href="/eslint-your-csharp-in-vs-code-with-roslyn-analyzers" class="footer__link-item">ESLint your C# with Roslyn Analyzers</a></li><li class="footer__item"><a href="/prettier-your-csharp-with-dotnet-format-and-lint-staged" class="footer__link-item">dotnet-format: Prettier your C# with lint-staged & husky</a></li>
</ul><div class="footer__title">Recently updated</div>
<ul class="footer__items clean-list">
  <li class="footer__item"><a href="azure-devops-with-defaultazurecredential" class="footer__link-item">Azure DevOps: using DefaultAzureCredential in an Azure Pipeline with AzureCLI@2</a></li><li class="footer__item"><a href="azure-devops-pull-requests-dynamic-required-reviewers" class="footer__link-item">Azure DevOps: pull requests and dynamic required reviewers</a></li><li class="footer__item"><a href="definitive-guide-to-migrating-from-blogger-to-docusaurus" class="footer__link-item">The definitive guide to migrating from Blogger to Docusaurus</a></li>
</ul></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Learn more / support me</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/about">About me</a></li><li class="footer__item"><a href="https://github.com/johnnyreilly/blog.johnnyreilly.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog source code on GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/tags">Blog categories</a></li><li class="footer__item"><a href="https://johnnyreilly.com/rss.xml" target="_blank" rel="noopener noreferrer" class="footer__link-item">RSS feed<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://johnnyreilly.com/atom.xml" target="_blank" rel="noopener noreferrer" class="footer__link-item">Atom feed<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/privacy-policy">Privacy Policy</a></li><li class="footer__item"><iframe src="https://github.com/sponsors/johnnyreilly/card" title="Sponsor johnnyreilly" style="margin-top: 20px; border: 0; border-radius: 10px; background-color: white; min-height: 400px;"></iframe></li><li class="footer__item"><a href="https://www.buymeacoffee.com/qUBm0Wh" rel="noopener" target="_blank"><img src="https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png" loading="lazy" alt="Buy Me A Coffee" style="height: 60px !important;width: 217px !important;"></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2012 - 2025 John Reilly. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>