---
title: "ts-loader v9"
author: John Reilly
author_url: https://github.com/johnnyreilly
author_image_url: https://blog.johnnyreilly.com/img/profile.jpg
tags: [webpack, ts-loader]
# image: blog/2021-04-20-ts-loader-v9/hello-world-bicep.png
hide_table_of_contents: false
---
`ts-loader` has just released v9.0.0.  This post goes through what this release is all about, and what it took to ship this version  .

## One big pull request

As of v8, `ts-loader` supported webpack 4 and webpack 5. However the webpack 5 support wasn't enforced by any kind of automated test pack. `ts-loader` has two test packs:

1. A [comparison test pack](https://github.com/TypeStrong/ts-loader/tree/main/test/comparison-tests#readme) that compares transpilation and webpack compilation output with known outputs.
2. An [execution test pack](https://github.com/TypeStrong/ts-loader/tree/main/test/execution-tests#readme) that executes Karma test packs written in TypeScript using `ts-loader`.

The test packs were tightly coupled to webpack 4 (and in the case of the comparison test pack, that's unavoidable). The mission was to port `ts-loader` to be built against (and have an automated test pack that ran against) webpack 5. 

This ended up being a [very big pull request](https://github.com/TypeStrong/ts-loader/pull/1251). Work on it started back in February 2021 and we're shipping now in April of 2021. I'd initially expected it would take a couple of days at most. I had underestimated.

A number of people collaborated on this PR, either with code, feedback or even just responding to questions.  So I'd like to say thank you to:
- [John Wallsten](https://github.com/JonWallsten) - who did a lot of the work swapping `ts-loader` over to webpack 5 APIs  
- [Nick Excell](https://github.com/appzuka)
- [Andrew Branch](https://github.com/andrewbranch)
- [Alexander Akait](https://github.com/alexander-akait) - who provided webpack 5 expertise and ideas
- [Tobias Koppers](https://github.com/sokra) - who got me out of a hole - more on that later

## What's changed

Let's go through the changes in v9. There's two breaking changes:

- The minimum webpack version supported is now webpack 5. This simplifies the codebase, which previously had to if/else the various API registrations based on the version of webpack being used.
- The minimum node version supported is now node 12. [Node 10 reaches end of life status at the end of April 2021.](https://nodejs.org/en/about/releases/)

An interesting aspect of migrating to building against webpack 5 was dropping the dependency upon [`@types/webpack`](https://www.npmjs.com/package/@types/webpack) in favour of the types that now ship with webpack 5 itself. This was a mostly great experience; however we discovered some missing pieces. Most notably, the [LoaderContext](https://github.com/TypeStrong/ts-loader/pull/1251/files#diff-2ee8da4ec0f3c043c7e097851af07383ae3ce13022973c8727312e06bf2b89b3R287) type wasn't exposed and so the definition had to be added directly to `ts-loader` for usage.

Alongside these changes, a [number of dependencies were upgraded](https://github.com/TypeStrong/ts-loader/pull/1251/files#diff-7ae45ad102eab3b6d7e7896acd08c427a9b25b346470d7bc6507b6481575d519).

## The hole

By the 19th of February most of the work was done.  However, [we were experiencing different behaviour between Linux and Windows in our comparison test pack](https://github.com/TypeStrong/ts-loader/pull/1251#issuecomment-781967959). Now there's a number of differences in behaviour between Linux style systems and Windows around path delimiters (`'\'` vs `'/'`) and line endings ('\r\n' vs '\n'). Our comparison test pack contains a wealth of normalisation hacks to accomodate this, but for some reason no amount of tweaking there seemed to be remedying the issue.  At this point I was fairly tired and pretty fed up.  So I took a break.

Time passed. In March [Alexander Akait](https://github.com/alexander-akait) checked in to see how things were going and volunteered to help. He also [suggested what turned out to be the fix](https://github.com/TypeStrong/ts-loader/pull/1251#issuecomment-799531375). But crucially I implemented this wrong. Observe [this commit](https://github.com/TypeStrong/ts-loader/pull/1251/commits/4bcc5c9623acfd7ffbaf028781a8353b37243804):

```ts
  const assetPath = path
    .relative(compilation.compiler.outputPath, outputFile.name)
    // According to @alexander-akait we should always '/' https://github.com/TypeStrong/ts-loader/pull/1251#issuecomment-799606985
    .replace(/\//g, '/');
```

If you look closely at the `replace`