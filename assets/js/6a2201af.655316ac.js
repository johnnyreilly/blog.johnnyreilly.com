"use strict";(self.webpackChunkjohnnyreilly_com=self.webpackChunkjohnnyreilly_com||[]).push([[42388],{37498:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>c});var i=n(74848),s=n(28453);const a={slug:"azure-static-web-apps-a-netlify-alternative",title:"Azure Static Web Apps - a Netlify alternative",authors:"johnnyreilly",tags:["azure static web apps","github actions","docusaurus"],description:"Azure Static Web Apps are a new offering from Microsoft. This post looks at what they are and how they compare to Netlify.",hide_table_of_contents:!1},o=void 0,r={permalink:"/azure-static-web-apps-a-netlify-alternative",editUrl:"https://github.com/johnnyreilly/blog.johnnyreilly.com/edit/main/blog-website/blog/2022-02-08-azure-static-web-apps-a-netlify-alternative/index.md",source:"@site/blog/2022-02-08-azure-static-web-apps-a-netlify-alternative/index.md",title:"Azure Static Web Apps - a Netlify alternative",description:"Azure Static Web Apps are a new offering from Microsoft. This post looks at what they are and how they compare to Netlify.",date:"2022-02-08T00:00:00.000Z",tags:[{label:"azure static web apps",permalink:"/tags/azure-static-web-apps"},{label:"github actions",permalink:"/tags/github-actions"},{label:"docusaurus",permalink:"/tags/docusaurus"}],readingTime:7.685,hasTruncateMarker:!0,authors:[{name:"John Reilly",title:"OSS Engineer - TypeScript, Azure, React, Node.js, .NET",url:"https://johnnyreilly.com/about",imageURL:"https://johnnyreilly.com/img/profile.jpg",key:"johnnyreilly"}],frontMatter:{slug:"azure-static-web-apps-a-netlify-alternative",title:"Azure Static Web Apps - a Netlify alternative",authors:"johnnyreilly",tags:["azure static web apps","github actions","docusaurus"],description:"Azure Static Web Apps are a new offering from Microsoft. This post looks at what they are and how they compare to Netlify.",hide_table_of_contents:!1},unlisted:!1,prevItem:{title:"Swashbuckle & inheritance: Give. Me. The. Types",permalink:"/swashbuckle-inheritance-multiple-return-types"},nextItem:{title:"Lazy loading images with Docusaurus",permalink:"/lazy-loading-images-with-docusaurus"}},l={authorsImageUrls:[void 0]},c=[{value:"Jamstack and Azure Static Web Apps",id:"jamstack-and-azure-static-web-apps",level:2},{value:"Create our application",id:"create-our-application",level:2},{value:"Creating a Static Web App in Azure",id:"creating-a-static-web-app-in-azure",level:2},{value:"Authentication",id:"authentication",level:2},{value:"Staging Environments",id:"staging-environments",level:2},{value:"Staging",id:"staging",level:2},{value:"Conclusion",id:"conclusion",level:2}];function u(e){const t={a:"a",blockquote:"blockquote",code:"code",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components},{Head:a}=t;return a||function(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Head",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(t.p,{children:["Jamstack sites have taken the world by storm. There's currently fierce competition between offerings like ",(0,i.jsx)(t.a,{href:"https://blog.logrocket.com/netlify-vs-cloudflare-pages/",children:"Netlify and Cloudflare"}),". A new player in this space is Azure Static Web Apps. This post will look at what working with SWAs is like and will demonstrate deploying one using GitHub Actions."]}),"\n",(0,i.jsx)(t.h2,{id:"jamstack-and-azure-static-web-apps",children:"Jamstack and Azure Static Web Apps"}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.a,{href:"https://en.m.wikipedia.org/wiki/Jamstack",children:"Jamstack"})," stands for JavaScript, API and Markup In Jamstack websites, the application logic typically resides on the client side. Typically these clients are built as ",(0,i.jsx)(t.a,{href:"https://en.m.wikipedia.org/wiki/Single-page_application",children:"single-page applications"})," and often have HTML files statically generated for every possible path to support search engine optimization."]}),"\n",(0,i.jsxs)(t.p,{children:["Azure Static Web Apps were released for general use in ",(0,i.jsx)(t.a,{href:"https://azure.microsoft.com/en-us/updates/azure-static-web-apps-is-now-generally-available/",children:"May 2021"})," and offer features including:"]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Globally distributed content for production apps"}),"\n",(0,i.jsx)(t.li,{children:"Auto-provisioned preview environments"}),"\n",(0,i.jsx)(t.li,{children:"Custom domain configuration and free SSL certificates"}),"\n",(0,i.jsx)(t.li,{children:"Built-in access to a variety of authentication providers"}),"\n",(0,i.jsx)(t.li,{children:"Route-based authorization"}),"\n",(0,i.jsx)(t.li,{children:"Custom routing"}),"\n",(0,i.jsx)(t.li,{children:"Integration with serverless APIs powered by Azure Functions"}),"\n",(0,i.jsx)(t.li,{children:"A custom Visual Studio Code developer extension"}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["Significantly, ",(0,i.jsx)(t.a,{href:"https://azure.microsoft.com/en-gb/pricing/details/app-service/static/",children:"these features are available to use for free"}),". With Netlify there is also a ",(0,i.jsx)(t.a,{href:"https://www.netlify.com/pricing/",children:"free tier"}),", however it's quite easy to exceed the build limits of the free tier and land yourself with an unexpected bill. By combining Azure Static Web Apps with GitHub Actions we can build comparable experiences and save ourselves money!"]}),"\n",(0,i.jsx)(t.p,{children:"So let's build ourselves a simple SWA and deploy it with GitHub Actions."}),"\n",(0,i.jsx)(t.h2,{id:"create-our-application",children:"Create our application"}),"\n",(0,i.jsxs)(t.p,{children:["Inside the root of our repository we're going to create a ",(0,i.jsx)(t.a,{href:"https://docusaurus.io/",children:"Docusaurus site"}),". Docusaurus is a good example of a static site, the kind of which is a natural fit for Jamstack. We could equally use something else like ",(0,i.jsx)(t.a,{href:"https://gohugo.io/",children:"Hugo"})," for instance."]}),"\n",(0,i.jsx)(t.p,{children:"At the command line we'll enter:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-shell",children:"npx create-docusaurus@latest website classic\n"})}),"\n",(0,i.jsxs)(t.p,{children:["And Docusaurus will create a new site in the ",(0,i.jsx)(t.code,{children:"website"})," directory. Let's commit and push this and turn our attention to Azure."]}),"\n",(0,i.jsx)(t.h2,{id:"creating-a-static-web-app-in-azure",children:"Creating a Static Web App in Azure"}),"\n",(0,i.jsxs)(t.p,{children:["There's a number of ways to create a Static Web App in Azure. It's possible to use ",(0,i.jsx)(t.a,{href:"https://johnnyreilly.com/2021/08/15/bicep-azure-static-web-apps-azure-devops#bicep-template",children:"infrastructure as code with a language like Bicep"}),". But for this post let's use the ",(0,i.jsx)(t.a,{href:"https://portal.azure.com",children:"Azure Portal"})," instead. If you don't have an account already, you can set one up for free very quickly."]}),"\n",(0,i.jsx)(t.p,{children:'Once you\'ve logged in, click "Create a resource" and look up Static Web App:'}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Screenshot of the Azure Portal, &quot;Create a resource&quot; Azure Static Web Apps section",src:n(65078).A+"",width:"1073",height:"640",loading:"eager",fetchpriority:"high"})}),"\n",(0,i.jsx)(t.p,{children:'Click on "Create" and you\'ll be take to the creation dialog:'}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Screenshot of the Azure Portal, &quot;Create a resource&quot; Azure Static Web Apps dialog",src:n(73041).A+"",width:"1213",height:"1404",loading:"lazy"})}),"\n",(0,i.jsx)(t.p,{children:'You\'ll need to create a resource group for your SWA to live in, give the app a name, the "Free" plan and a deployment source of GitHub.'}),"\n",(0,i.jsx)(t.p,{children:'Click on the "Sign in with GitHub" button and authorize Azure to access your GitHub account for Static Web Apps.'}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Screenshot of the Azure Portal, &quot;Create a resource&quot; Azure Static Web Apps dialog - repository settings",src:n(66184).A+"",width:"1201",height:"1018",loading:"lazy"})}),"\n",(0,i.jsx)(t.p,{children:"At this point Azure will query GitHub on your behalf and look up the organisations and repositories you have access to. Select the repository that you'd like to deploy to your Static Web App and select the branch you'd like to deploy."}),"\n",(0,i.jsxs)(t.p,{children:['You also need to provide Azure with some build details that help it understand how your app is built. We\'ll provide a preset of "Custom". We\'ll set the "App location" (the root of our front end app) to be ',(0,i.jsx)(t.code,{children:'"/website"'})," to tally up with the application we just created. We'll leave \"Api location\" blank and we'll set the output location to be ",(0,i.jsx)(t.code,{children:'"build"'})," - this is the directory under ",(0,i.jsx)(t.code,{children:"website"})," where Docusaurus will create our site."]}),"\n",(0,i.jsx)(t.p,{children:'Finally click "Review + create" and then "Create".'}),"\n",(0,i.jsx)(t.p,{children:"Azure will now:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Create an Azure Static Web app resource in Azure"}),"\n",(0,i.jsx)(t.li,{children:"Update your repository to add a GitHub Actions workflow to deploy your static web app"}),"\n",(0,i.jsx)(t.li,{children:"Kick off a first run of the GitHub Actions workflow to deploy your SWA."}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"Pretty amazing, right?"}),"\n",(0,i.jsx)(t.p,{children:"When you look at the resource in Azure it will look something like this:"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Screenshot of the Azure Portal, your Azure Static Web Apps resource",src:n(89867).A+"",width:"1422",height:"657",loading:"lazy"})}),"\n",(0,i.jsx)(t.p,{children:"If you click on the GitHub Action runs you'll be presented with your GitHub Action:"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Screenshot of the GitHub Action",src:n(68088).A+"",width:"1420",height:"1079",loading:"lazy"})}),"\n",(0,i.jsx)(t.p,{children:"And when that finishes running you'll be able to see your deployed Static Web App by clicking on the URL in the Azure Portal:"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Screenshot of your Static Web App running in a browser",src:n(27395).A+"",width:"1511",height:"676",loading:"lazy"})}),"\n",(0,i.jsx)(t.p,{children:"We've gone from having nothing, to having a brand new website in Azure, shipped via continous deployment in GitHub Actions in a matter of minutes. This is low friction and high value!"}),"\n",(0,i.jsx)(t.h2,{id:"authentication",children:"Authentication"}),"\n",(0,i.jsx)(t.p,{children:"Now we've done our initial deployment, let's take it a stage further and add authentication."}),"\n",(0,i.jsxs)(t.p,{children:["One of the awesome features of Static Web Apps is the fact that ",(0,i.jsx)(t.a,{href:"https://docs.microsoft.com/en-us/azure/static-web-apps/authentication-authorization?tabs=invitations#login",children:"authentication is available straight out of the box"}),". We can pick from GitHub, Azure Active Directory and Twitter as identity providers. Let's roll with GitHub and amend our ",(0,i.jsx)(t.code,{children:"website/src/pages/index.js"})," to support authentication:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-jsx",children:"import React, { useState, useEffect } from 'react';\nimport clsx from 'clsx';\nimport Layout from '@theme/Layout';\nimport useDocusaurusContext from '@docusaurus/useDocusaurusContext';\nimport styles from './index.module.css';\n\n/**\n * @typedef {object} UserInfo\n * @prop {\"github\"} identityProvider\n * @prop {string} userId\n * @prop {string} userDetails\n * @prop {string[]} userRoles\n */\n\n/**\n * @return {UserInfo | null}\n */\nfunction useUserInfo() {\n  const [userInfo, setUserInfo] = useState(null);\n\n  useEffect(() => {\n    async function getUserInfo() {\n      const response = await fetch('/.auth/me');\n      const payload = await response.json();\n      const { clientPrincipal } = payload;\n      return clientPrincipal;\n    }\n\n    getUserInfo().then((ui) => setUserInfo(ui));\n  }, []);\n\n  return userInfo;\n}\n\nexport default function Home() {\n  const { siteConfig } = useDocusaurusContext();\n  const userInfo = useUserInfo();\n\n  return (\n    <Layout\n      title={`Hello from ${siteConfig.title}`}\n      description=\"Description will go into a meta tag in <head />\"\n    >\n      <header className={clsx('hero hero--primary', styles.heroBanner)}>\n        <div className=\"container\">\n          <h1 className=\"hero__title\">{siteConfig.title}</h1>\n          <p className=\"hero__subtitle\">{siteConfig.tagline}</p>\n          <div className={styles.buttons}>\n            {userInfo ? (\n              <p>Hello {userInfo.userDetails}</p>\n            ) : (\n              <a\n                className=\"button button--secondary button--lg\"\n                href=\"/.auth/login/github\"\n              >\n                Click here to login\n              </a>\n            )}\n          </div>\n        </div>\n      </header>\n    </Layout>\n  );\n}\n"})}),"\n",(0,i.jsx)(t.p,{children:"The above code does the following:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["Implements a React hook named ",(0,i.jsx)(t.code,{children:"useUserInfo"})," which calls the ",(0,i.jsx)(t.code,{children:"/.auth/me"})," endpoint of your SWA. This returns ",(0,i.jsx)(t.code,{children:"null"})," when not authenticated, and the ",(0,i.jsx)(t.code,{children:"UserInfo"})," when authenticated."]}),"\n",(0,i.jsxs)(t.li,{children:["For users who are not authenticated, display a link button which takes people to ",(0,i.jsx)(t.code,{children:"/.auth/login/github"}),", thus triggering the GitHub authentication flow."]}),"\n",(0,i.jsxs)(t.li,{children:["For users who are authenticated, display the users ",(0,i.jsx)(t.code,{children:"userDetails"}),"; the GitHub username."]}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"Let's commit and push this and (when our build has finished running) browse to our Static Web App once again:"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Screenshot of Static Web App now featuring a login button",src:n(24631).A+"",width:"1940",height:"734",loading:"lazy"})}),"\n",(0,i.jsx)(t.p,{children:"If we click to login, we're taken through the GitHub authentication flow:"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Screenshot of Static Web App now featuring a login button",src:n(77659).A+"",width:"1023",height:"1070",loading:"lazy"})}),"\n",(0,i.jsx)(t.p,{children:"Once you've authorised and granted consent you'll be redirected to your app and see that you're logged in:"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Screenshot of Static Web App showing I&#39;m logged in",src:n(18778).A+"",width:"1937",height:"740",loading:"lazy"})}),"\n",(0,i.jsxs)(t.p,{children:["If we pop open the devtools of Chrome we'll see what comes back from the ",(0,i.jsx)(t.code,{children:"/.auth/me"})," endpoint:"]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Screenshot of Chrome devtools displaying a JSON structure",src:n(10197).A+"",width:"1611",height:"328",loading:"lazy"})}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-json",children:'{\n  "clientPrincipal": {\n    "identityProvider": "github",\n    "userId": "1f5b4b7de7d445e29dd6188bcc7ee052",\n    "userDetails": "johnnyreilly",\n    "userRoles": ["anonymous", "authenticated"]\n  }\n}\n'})}),"\n",(0,i.jsx)(t.p,{children:"We've now implemented and demonstrated authentication with Azure Static Web Apps with very little effort on our behalf. This is tremendous!"}),"\n",(0,i.jsx)(t.h2,{id:"staging-environments",children:"Staging Environments"}),"\n",(0,i.jsx)(t.p,{children:"Finally, let's look at a super cool feature that Static Web Apps provides by default. If you take a look at the Environments tab of your SWA you'll see this:"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Screenshot of the Azure Portal, your Azure Static Web Apps resource - featuring the phrase &quot;Open pull requests against the linked repository to create a staging environment.&quot;",src:n(35400).A+"",width:"2900",height:"976",loading:"lazy"})}),"\n",(0,i.jsxs)(t.blockquote,{children:["\n",(0,i.jsx)(t.h2,{id:"staging",children:"Staging"}),"\n",(0,i.jsx)(t.p,{children:"Open pull requests against the linked repository to create a staging environment."}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"Let's try that out! We'll create a new branch:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-shell",children:"git checkout -b feat/show-me-staging\n"})}),"\n",(0,i.jsxs)(t.p,{children:["In our ",(0,i.jsx)(t.code,{children:"index.js"})," we'll add an arbitrary piece of text:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-jsx",children:"<p>I'm a staging environment!</p>\n"})}),"\n",(0,i.jsx)(t.p,{children:"Then we'll commit and push our branch to GitHub and create a pull request. This triggers our GitHub Action to run once again. But this time, rather than publishing over our existing Static Web App, it's going to spin up a brand new one with our changes in. Not only that, it's going to put a link for us in our GitHub pull request so we can browse straight to it:"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Screenshot of the pull request in GitHub including a comment from the GitHub Actions bot which says: &quot;Azure Static Web Apps: Your stage site is ready! Visit it here: https://ambitious-island-05069ea10-2.centralus.azurestaticapps.net&quot;",src:n(27632).A+"",width:"2097",height:"1170",loading:"lazy"})}),"\n",(0,i.jsxs)(t.p,{children:["This is the equivalent of Netlify Deploy Previews, implemented with Azure Static Web Apps and GitHub Actions. Given the allowances for GitHub Actions currently sit at ",(0,i.jsx)(t.a,{href:"https://docs.github.com/en/billing/managing-billing-for-github-actions/about-billing-for-github-actions",children:"2,000 free minutes per month"})," as compared with Netlify's ",(0,i.jsx)(t.a,{href:"https://www.netlify.com/pricing/",children:"300 free minutes per month"}),", you're less likely to receive a bill for using Static Web Apps."]}),"\n",(0,i.jsx)(t.p,{children:"This staging environment will last only until the pull request is closed. At that point the environment is torn down by the GitHub Action."}),"\n",(0,i.jsx)(t.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,i.jsx)(t.p,{children:"In this post we've deployed a website to a Static Web App using GitHub Actions and implemented authentication. We've also demonstrated Azure's equivalent of Netlify's deploy previews; staging environments."}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.a,{href:"https://blog.logrocket.com/azure-static-web-apps-netlify-alternative/",children:"This post was originally published on LogRocket."})}),"\n",(0,i.jsx)(a,{children:(0,i.jsx)("link",{rel:"canonical",href:"https://blog.logrocket.com/azure-static-web-apps-netlify-alternative/"})})]})}function h(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(u,{...e})}):u(e)}},66184:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/screenshot-azure-portal-create-a-resource-dialog-repo-a2de23b7816aec676ed4ff67d8ad050b.png"},73041:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/screenshot-azure-portal-create-a-resource-dialog-e673221e269c82a9827c07084ae1216b.png"},65078:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/screenshot-azure-portal-create-a-resource-c96b4cc01f5980cce0e35108319a9421.png"},35400:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/screenshot-azure-portal-static-web-app-resource-environments-1bcff031a37577bd59bbed46f0c27699.png"},89867:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/screenshot-azure-portal-static-web-app-resource-aeb5bad8b5e9a499469c9816398670db.png"},68088:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/screenshot-github-action-37011d8698869ba4b04a84fc5fe0c3af.png"},27632:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/screenshot-github-pull-request-deploy-preview-dc7d94503a04d87d62a4d862937412a9.png"},10197:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/screenshot-static-web-app-devtools-me-6697fe8eaf0101940022da23f53ee984.png"},18778:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/screenshot-static-web-app-logged-in-e8adf36cea4a79badc437f5c54a137d9.png"},77659:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/screenshot-static-web-app-login-github-48c74b198021cce9eaa978d85e85dbb9.png"},24631:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/screenshot-static-web-app-login-3000a60604403556485f63c37b6cda49.png"},27395:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/screenshot-static-web-app-818eff8dedecdbba13d53408c97b2494.png"},28453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>r});var i=n(96540);const s={},a=i.createContext(s);function o(e){const t=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(a.Provider,{value:t},e.children)}}}]);