"use strict";(self.webpackChunkjohnnyreilly_com=self.webpackChunkjohnnyreilly_com||[]).push([[28290],{20086:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>r,contentTitle:()=>a,default:()=>u,frontMatter:()=>o,metadata:()=>l,toc:()=>c});var i=n(74848),s=n(28453);const o={slug:"using-pubsub-observer-pattern-to",title:"Using the PubSub / Observer pattern to emulate constructor chaining without cluttering up global scope",authors:"johnnyreilly",tags:["javascript"],hide_table_of_contents:!1,description:"Pass objects between JavaScript files using PubSub interface to achieve code reusability without global scope pollution. No prototypes needed."},a=void 0,l={permalink:"/using-pubsub-observer-pattern-to",editUrl:"https://github.com/johnnyreilly/blog.johnnyreilly.com/edit/main/blog-website/blog/2012-03-17-using-pubsub-observer-pattern-to/index.md",source:"@site/blog/2012-03-17-using-pubsub-observer-pattern-to/index.md",title:"Using the PubSub / Observer pattern to emulate constructor chaining without cluttering up global scope",description:"Pass objects between JavaScript files using PubSub interface to achieve code reusability without global scope pollution. No prototypes needed.",date:"2012-03-17T00:00:00.000Z",tags:[{inline:!1,label:"JavaScript",permalink:"/tags/javascript",description:"The JavaScript programming language."}],readingTime:5.48,hasTruncateMarker:!0,authors:[{name:"John Reilly",title:"OSS Engineer - TypeScript, Azure, React, Node.js, .NET",url:"https://johnnyreilly.com/about",imageURL:"https://johnnyreilly.com/img/profile.jpg",key:"johnnyreilly",page:null}],frontMatter:{slug:"using-pubsub-observer-pattern-to",title:"Using the PubSub / Observer pattern to emulate constructor chaining without cluttering up global scope",authors:"johnnyreilly",tags:["javascript"],hide_table_of_contents:!1,description:"Pass objects between JavaScript files using PubSub interface to achieve code reusability without global scope pollution. No prototypes needed."},unlisted:!1,prevItem:{title:"WCF - moving from Config to Code, a simple WCF service harness (plus implementing your own Authorization)",permalink:"/wcf-moving-from-config-to-code-simple"},nextItem:{title:"Striving for (JavaScript) Convention",permalink:"/striving-for-javascript-convention"}},r={authorsImageUrls:[void 0]},c=[{value:"The Problem",id:"the-problem",level:2}];function h(e){const t={a:"a",code:"code",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(t.p,{children:["Yes the title of this post is *",(0,i.jsx)(t.strong,{children:"painfully"}),"* verbose. Sorry about that. Couple of questions for you: - Have you ever liked the way you can have base classes in C# which can then be inherited and subclassed ",(0,i.jsx)("u",{children:"in a different file / class"})]}),"\n",(0,i.jsx)(t.p,{children:"?"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Have you ever thought; gosh it'd be nice to do something like that in JavaScript..."}),"\n",(0,i.jsxs)(t.li,{children:["Have you then looked at JavaScripts prototypical inheritance and thought \"right.... I'm sure it's possible but this going to end up like ",(0,i.jsx)(t.a,{href:"http://en.wikipedia.org/wiki/War_and_Peace",children:"War and Peace"}),'"']}),"\n",(0,i.jsx)(t.li,{children:"Have you then subsequently thought \"and hold on a minute... even if I did implement this using the prototype and split things between different files / modules wouldn't I have to pollute the global scope to achieve that? And wouldn't that mean that my code was exposed to the vagaries of any other scripts on the page? Hmmm...\""}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.a,{href:"http://www.thrillingdetective.com/eyes/oxford.html",children:"Men! Are you skinny? Do bullies kick sand in your face?"})," (Just wanted to see if you were still paying attention...)"]}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"the-problem",children:"The Problem"}),"\n",(0,i.jsx)(t.p,{children:"Well, the above thoughts occurred to me just recently. I had a situation where I was working on an MVC project and needed to build up quite large objects within JavaScript representing various models. The models in question were already implemented on the server side using classes and made extensive use of inheritance because many of the properties were shared between the various models. That is to say we would have models which were implemented through the use of a class inheriting a base class which in turn inherits a further base class. With me? Good. Perhaps I can make it a little clearer with an example. Here are my 3 classes. First BaseReilly.cs:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-cs",children:'public class BaseReilly\n{\n    public string LastName { get; set; }\n\n        public BaseReilly()\n        {\n            LastName = "Reilly";\n        }\n    }\n'})}),"\n",(0,i.jsx)(t.p,{children:"Next BoyReilly.cs (which inherits from BaseReilly):"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-cs",children:'public class BoyReilly : BaseReilly\n{\n    public string Sex { get; set; }\n\n    public BoyReilly()\n        : base()\n    {\n        Sex = "It is a manchild";\n    }\n}\n'})}),"\n",(0,i.jsx)(t.p,{children:"And finally JohnReilly.cs (which inherits from BoyReilly which in turn inherits from BaseReilly):"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-cs",children:'public class JohnReilly : BoyReilly\n{\n    public string FirstName { get; set; }\n\n    public JohnReilly()\n        : base()\n    {\n        FirstName = "John";\n    }\n}\n'})}),"\n",(0,i.jsx)(t.p,{children:'Using the above I can create myself my very own "JohnReilly" like so:'}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-cs",children:"var johnReilly = new JohnReilly();\n"})}),"\n",(0,i.jsx)(t.p,{children:"And it will look like this:"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{src:n(86031).A+"",width:"320",height:"140",loading:"eager",fetchpriority:"high"})}),"\n",(0,i.jsxs)(t.p,{children:["I was looking to implement something similar on the client and within JavaScript. I was keen to ensure ",(0,i.jsx)(t.a,{href:"http://en.wikipedia.org/wiki/Code_reuse",children:"code reuse"}),". And my inclination to keep things simple made me wary of making use of the ",(0,i.jsx)(t.a,{href:"http://bonsaiden.github.com/JavaScript-Garden/#object.prototype",children:"prototype"}),". It is undoubtedly powerful but I don't think even the mighty ",(0,i.jsx)(t.a,{href:"http://javascript.crockford.com/prototypal.html",children:"Crockford"}),' would consider it "simple". Also I had the reservation of exposing my object to the global scope. So what to do? I had an idea.... ## The Big Idea']}),"\n",(0,i.jsxs)(t.p,{children:["For a while I've been making use explicit use of the ",(0,i.jsx)(t.a,{href:"http://en.wikipedia.org/wiki/Observer_pattern",children:"Observer pattern"}),' in my JavaScript, better known by most as the publish/subscribe (or "PubSub") pattern. There\'s a million JavaScript libraries that facilitate this and after some experimentation I finally settled on ',(0,i.jsx)(t.a,{href:"https://github.com/phiggins42/bloody-jquery-plugins/blob/master/pubsub.js",children:"higgins"})," implementation as it's simple and I saw a ",(0,i.jsx)(t.a,{href:"http://jsperf.com/pubsubjs-vs-jquery-custom-events/11",children:"JSPerf"})," which demonstrated it as either the fastest or second fastest in class. Up until now my main use for it had been to facilitate loosely coupled GUI interactions. If I wanted one component on the screen to influence anothers behaviour I simply needed to get the first component to publish out the relevant events and the second to subscribe to these self-same events. One of the handy things about publishing out events this way is that with them you can also include data. This data can be useful when driving the response in the subscribers. However, it occurred to me that it would be equally possible to pass an object when publishing an event. **",(0,i.jsx)("u",{children:"And the subscribers could enrich that object with data as they saw fit."})]}),"\n",(0,i.jsx)(t.p,{children:"** Now this struck me as a pretty useful approach. It's not rock solid secure as it's always possible that someone could subscribe to your events and get access to your object as you published out. However, that's pretty unlikely to happen accidentally; certainly far less likely than someone else's global object clashing with your global object. ## What might this look like in practice?"}),"\n",(0,i.jsx)(t.p,{children:"So this is what it ended up looking like when I turned my 3 classes into JavaScript files / modules. First BaseReilly.js:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-js",children:"$(function () {\n  $.subscribe('PubSub.Inheritance.Emulation', function (obj) {\n    obj.LastName = 'Reilly';\n  });\n});\n"})}),"\n",(0,i.jsx)(t.p,{children:"Next BoyReilly.js:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-js",children:"$(function () {\n  $.subscribe('PubSub.Inheritance.Emulation', function (obj) {\n    obj.Sex = 'It is a manchild';\n  });\n});\n"})}),"\n",(0,i.jsx)(t.p,{children:"And finally JohnReilly.js:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-js",children:"$(function () {\n  $.subscribe('PubSub.Inheritance.Emulation', function (obj) {\n    obj.FirstName = 'John';\n  });\n});\n"})}),"\n",(0,i.jsx)(t.p,{children:'If the above scripts have been included in a page I can create myself my very own "JohnReilly" in JavaScript like so:'}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-js",children:'var oJohnReilly = {}; //Empty object\n\n$.publish(\'PubSub.Inheritance.Emulation\', [oJohnReilly]); //Empty object "published" so it can be enriched by subscribers\n\nconsole.log(JSON.stringify(oJohnReilly)); //Show me this thing you call "JohnReilly"\n'})}),"\n",(0,i.jsx)(t.p,{children:"And it will look like this:"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{src:n(38071).A+"",width:"320",height:"137",loading:"lazy"})}),"\n",(0,i.jsx)(t.p,{children:"And it works. Obviously the example I've given above it somewhat naive - in reality my object properties are driven by GUI components rather than hard-coded. But I hope this illustrates the point. This technique allows you to simply share functionality between different JavaScript files and so keep your codebase tight. I certainly wouldn't recommend it for all circumstances but when you're doing something as simple as building up an object to be used to pass data around (as I am) then it works very well indeed. ## A Final Thought on Script Ordering"}),"\n",(0,i.jsx)(t.p,{children:"A final thing that maybe worth mentioning is script ordering. The order in which functions are called is driven by the order in which subscriptions are made. In my example I was registering the scripts in this order:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-html",children:'<script src="/Scripts/PubSubInheritanceDemo/BaseReilly.js"><\/script>\n<script src="/Scripts/PubSubInheritanceDemo/BoyReilly.js"><\/script>\n<script src="/Scripts/PubSubInheritanceDemo/JohnReilly.js"<>/script>\n'})}),"\n",(0,i.jsx)(t.p,{children:"So when my event was published out the functions in the above JS files would be called in this order: 1. BaseReilly.js 2. BoyReilly.js 3. JohnReilly.js"}),"\n",(0,i.jsxs)(t.p,{children:["If you were so inclined you could use this to emulate inheritance in behaviour. Eg you could set a property in ",(0,i.jsx)(t.code,{children:"BaseReilly.js"})," which was subsequently overridden in ",(0,i.jsx)(t.code,{children:"JohnReilly.js"})," or ",(0,i.jsx)(t.code,{children:"BoyReilly.js"})," if you so desired. I'm not doing that myself but it occurred as a possibility. ## PS"]}),"\n",(0,i.jsxs)(t.p,{children:["If you're interested in learning more about JavaScript stabs at inheritance you could do far worse than look at Bob Inces in depth StackOverflow ",(0,i.jsx)(t.a,{href:"http://stackoverflow.com/a/1598077/761388",children:"answer"}),"."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{})})]})}function u(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},86031:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/CSharp-version-of-JohnReilly-836e0b7414d5a336104847981658261c.webp"},38071:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/JavaScript-version-of-JohnReilly-8e8928f803782798071a689ae95a2bcb.webp"},28453:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>l});var i=n(96540);const s={},o=i.createContext(s);function a(e){const t=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),i.createElement(o.Provider,{value:t},e.children)}}}]);