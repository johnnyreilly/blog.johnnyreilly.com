"use strict";(self.webpackChunkjohnnyreilly_com=self.webpackChunkjohnnyreilly_com||[]).push([[22320],{19345:(e,t,s)=>{s.d(t,{A:()=>i});const i=s.p+"assets/images/screenshot-npm-feeds-in-azure-artifacts-b561f2cc09bb8358baf4078561fc4c06.webp"},21489:e=>{e.exports=JSON.parse('{"permalink":"/azure-artifacts-publish-private-npm-package-with-azure-devops","editUrl":"https://github.com/johnnyreilly/blog.johnnyreilly.com/edit/main/blog-website/blog/2024-12-01-azure-artifacts-publish-private-npm-package-with-azure-devops/index.md","source":"@site/blog/2024-12-01-azure-artifacts-publish-private-npm-package-with-azure-devops/index.md","title":"Azure Artifacts: Publish a private npm package with Azure DevOps","description":"Azure DevOps has a feature called Azure Artifacts that supports publishing npm packages to a feed for consumption. This post shows how to publish a private npm package with Azure DevOps.","date":"2024-12-01T00:00:00.000Z","tags":[{"inline":false,"label":"Azure DevOps","permalink":"/tags/azure-devops","description":"The Azure DevOps suite of tools."},{"inline":false,"label":"Node.js","permalink":"/tags/node-js","description":"The Node.js runtime."}],"readingTime":2.92,"hasTruncateMarker":true,"authors":[{"name":"John Reilly","title":"OSS Engineer - TypeScript, Azure, React, Node.js, .NET","url":"https://johnnyreilly.com/about","imageURL":"https://johnnyreilly.com/img/profile.jpg","key":"johnnyreilly","page":null}],"frontMatter":{"slug":"azure-artifacts-publish-private-npm-package-with-azure-devops","title":"Azure Artifacts: Publish a private npm package with Azure DevOps","authors":"johnnyreilly","tags":["azure devops","node.js"],"image":"./title-image.png","hide_table_of_contents":false,"description":"Azure DevOps has a feature called Azure Artifacts that supports publishing npm packages to a feed for consumption. This post shows how to publish a private npm package with Azure DevOps."},"unlisted":false,"prevItem":{"title":"npx and Azure Artifacts: the secret CLI delivery mechanism","permalink":"/npx-and-azure-artifacts-the-secret-cli-delivery-mechanism"},"nextItem":{"title":"Introducing azdo-npm-auth (Azure DevOps npm auth)","permalink":"/introducing-azdo-npm-auth"}}')},24459:(e,t,s)=>{s.d(t,{A:()=>i});const i=s.p+"assets/images/title-image-f41c20b738c408ad754258ede7571c6f.png"},28453:(e,t,s)=>{s.d(t,{R:()=>r,x:()=>o});var i=s(96540);const n={},a=i.createContext(n);function r(e){const t=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:r(e.components),i.createElement(a.Provider,{value:t},e.children)}},44867:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>p,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>l});var i=s(21489),n=s(74848),a=s(28453);const r={slug:"azure-artifacts-publish-private-npm-package-with-azure-devops",title:"Azure Artifacts: Publish a private npm package with Azure DevOps",authors:"johnnyreilly",tags:["azure devops","node.js"],image:"./title-image.png",hide_table_of_contents:!1,description:"Azure DevOps has a feature called Azure Artifacts that supports publishing npm packages to a feed for consumption. This post shows how to publish a private npm package with Azure DevOps."},o=void 0,p={image:s(24459).A,authorsImageUrls:[void 0]},l=[{value:"What feeds are available in Azure Artifacts?",id:"what-feeds-are-available-in-azure-artifacts",level:2},{value:"Setting up the <code>.npmrc</code> file",id:"setting-up-the-npmrc-file",level:2},{value:"Publishing with Azure Pipelines",id:"publishing-with-azure-pipelines",level:2},{value:"Conclusion",id:"conclusion",level:2}];function c(e){const t={a:"a",code:"code",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.p,{children:"Azure DevOps has a feature called Azure Artifacts that supports publishing npm packages to a feed for consumption. Publishing a private npm package with Azure DevOps is a common scenario for teams that want to share code across projects or organizations. This post shows how to publish a private npm package with Azure DevOps."}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"title image reading &quot;Azure Artifacts: Publish a private npm package with Azure DevOps&quot; with an Azure DevOps and npm logos",src:s(87066).A+"",width:"800",height:"450",loading:"lazy"})}),"\n",(0,n.jsx)(t.p,{children:"Publishing a private npm package with Azure DevOps is fairly straightforward, but surprisingly documentation is a little sparse."}),"\n",(0,n.jsx)(t.h2,{id:"what-feeds-are-available-in-azure-artifacts",children:"What feeds are available in Azure Artifacts?"}),"\n",(0,n.jsxs)(t.p,{children:["If you don't already have a feed to publish your npm package to, you can create one in Azure DevOps ",(0,n.jsx)(t.a,{href:"https://learn.microsoft.com/en-us/azure/devops/artifacts/concepts/feeds?view=azure-devops",children:"by following these instructions"}),"."]}),"\n",(0,n.jsxs)(t.p,{children:["If you're trying to find out what feeds are available in Azure Artifacts, you can find them in the Azure DevOps UI. Go to the Artifacts section in Azure DevOps and you'll see a list of feeds. The URL for the feed will be in the format ",(0,n.jsx)(t.code,{children:"https://dev.azure.com/[ORGANIZATION]/_artifacts/feed"}),"."]}),"\n",(0,n.jsx)(t.p,{children:"There you'll see a dropdown with the feeds you have access to:"}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"screenshot of the feeds in Azure DevOps",src:s(19345).A+"",width:"1248",height:"690",loading:"lazy"})}),"\n",(0,n.jsxs)(t.p,{children:["You'll see from the screenshot that I have access to a feed called ",(0,n.jsx)(t.code,{children:"npmrc-script-organization"}),". Let's use that feed to publish a private npm package."]}),"\n",(0,n.jsxs)(t.h2,{id:"setting-up-the-npmrc-file",children:["Setting up the ",(0,n.jsx)(t.code,{children:".npmrc"})," file"]}),"\n",(0,n.jsxs)(t.p,{children:["So that you can publish to a private feed, you need to set up an ",(0,n.jsx)(t.code,{children:".npmrc"})," file in your project. This file will contain the URL of the feed you want to publish to, and your credentials. To set up the ",(0,n.jsx)(t.code,{children:".npmrc"}),' file, you can click on the "Connect to Feed" button in the Azure DevOps UI:']}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"Screenshot of &quot;connect to feed&quot; in Azure DevOps",src:s(82937).A+"",width:"1016",height:"118",loading:"lazy"})}),"\n",(0,n.jsxs)(t.p,{children:["Then select ",(0,n.jsx)(t.code,{children:"npm"})," and you'll see the instructions for setting up the ",(0,n.jsx)(t.code,{children:".npmrc"})," file:"]}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"Screenshot of the instructions for setting up the .npmrc file",src:s(62851).A+"",width:"2240",height:"678",loading:"lazy"})}),"\n",(0,n.jsx)(t.h2,{id:"publishing-with-azure-pipelines",children:"Publishing with Azure Pipelines"}),"\n",(0,n.jsx)(t.p,{children:"Now we're ready to publish our npm package with Azure DevOps. Here's an example of an Azure Pipelines YAML file that publishes a private npm package:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yml",children:"trigger:\n  batch: true\n\npool:\n  vmImage: ubuntu-latest\n\nvariables:\n  isMainBranch: ${{ eq(variables['Build.SourceBranch'], 'refs/heads/main') }}\n\nstages:\n  - stage: Build_Package_Publish\n    displayName: Build package and publish\n    jobs:\n      - job:\n        steps:\n          - task: NodeTool@0\n            inputs:\n              versionSpec: 20\n            displayName: Install Node.js\n\n          - task: npmAuthenticate@0\n            inputs:\n              workingFile: $(System.DefaultWorkingDirectory)/.npmrc\n\n          - bash: npm install\n            displayName: 'npm install'\n\n          - bash: npm run build\n            displayName: 'npm build'\n\n          - task: Npm@1\n            displayName: Publish Package\n            inputs:\n              command: 'publish'\n              publishRegistry: 'useFeed'\n              publishFeed: 'npmrc-script-organization'\n"})}),"\n",(0,n.jsx)(t.p,{children:"Let's break down the steps in this YAML file:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["We're installing Node.js and authenticating with the ",(0,n.jsx)(t.code,{children:".npmrc"})," file."]}),"\n",(0,n.jsxs)(t.li,{children:["We're running ",(0,n.jsx)(t.code,{children:"npm install"})," and ",(0,n.jsx)(t.code,{children:"npm run build"}),". These are standard steps for building a Node.js project; yours might vary; what's important is that you are able to get your built package set up."]}),"\n",(0,n.jsxs)(t.li,{children:["Finally, we use the ",(0,n.jsx)(t.code,{children:"Npm@1"})," task to publish the package. We specify the ",(0,n.jsx)(t.code,{children:"publishRegistry"})," as ",(0,n.jsx)(t.code,{children:"useFeed"})," and the ",(0,n.jsx)(t.code,{children:"publishFeed"})," as ",(0,n.jsx)(t.code,{children:"npmrc-script-organization"}),". This is the feed we're publishing to."]}),"\n"]}),"\n",(0,n.jsx)(t.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,n.jsxs)(t.p,{children:["In this post, we've seen how to publish a private npm package with Azure DevOps. We've set up the ",(0,n.jsx)(t.code,{children:".npmrc"})," file, and we've used an Azure Pipelines YAML file to publish the package. This is a common scenario for teams that want to share code across projects or organizations. I hope this post has been helpful to you!"]})]})}function h(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(c,{...e})}):c(e)}},62851:(e,t,s)=>{s.d(t,{A:()=>i});const i=s.p+"assets/images/screenshot-npmrc-e8b46fa648b27148f109ea8fbf6ba807.png"},82937:(e,t,s)=>{s.d(t,{A:()=>i});const i=s.p+"assets/images/screenshot-connect-to-feed-9420465335c838a5365e11888ea36437.webp"},87066:(e,t,s)=>{s.d(t,{A:()=>i});const i=s.p+"assets/images/title-image-f41c20b738c408ad754258ede7571c6f.png"}}]);