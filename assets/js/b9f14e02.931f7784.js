"use strict";(self.webpackChunkjohnnyreilly_com=self.webpackChunkjohnnyreilly_com||[]).push([[89380],{44334:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>r});var l=t(74848),o=t(28453);const i={slug:"decimalmodelbinder-for-nullable-decimals",title:"DecimalModelBinder for nullable Decimals",authors:"johnnyreilly",tags:["globalize","asp.net"],hide_table_of_contents:!1,description:"John forgot that MVCs ModelBinding doesnt handle regionalised numbers well. Provides solution found on Phil Haacks post."},a=void 0,s={permalink:"/decimalmodelbinder-for-nullable-decimals",editUrl:"https://github.com/johnnyreilly/blog.johnnyreilly.com/edit/main/blog-website/blog/2013-03-11-decimalmodelbinder-for-nullable-decimals/index.md",source:"@site/blog/2013-03-11-decimalmodelbinder-for-nullable-decimals/index.md",title:"DecimalModelBinder for nullable Decimals",description:"John forgot that MVCs ModelBinding doesnt handle regionalised numbers well. Provides solution found on Phil Haacks post.",date:"2013-03-11T00:00:00.000Z",tags:[{inline:!1,label:"Globalize",permalink:"/tags/globalize",description:"The Globalize library."},{inline:!1,label:"ASP.NET",permalink:"/tags/asp-net",description:"The web framework built by Microsoft."}],readingTime:1.78,hasTruncateMarker:!0,authors:[{name:"John Reilly",title:"OSS Engineer - TypeScript, Azure, React, Node.js, .NET",url:"https://johnnyreilly.com/about",imageURL:"https://johnnyreilly.com/img/profile.jpg",key:"johnnyreilly"}],frontMatter:{slug:"decimalmodelbinder-for-nullable-decimals",title:"DecimalModelBinder for nullable Decimals",authors:"johnnyreilly",tags:["globalize","asp.net"],hide_table_of_contents:!1,description:"John forgot that MVCs ModelBinding doesnt handle regionalised numbers well. Provides solution found on Phil Haacks post."},unlisted:!1,prevItem:{title:"Death to compatibility mode",permalink:"/death-to-compatibility-mode"},nextItem:{title:"Unit testing ModelState",permalink:"/unit-testing-modelstate"}},d={authorsImageUrls:[void 0]},r=[{value:"And now a question...",id:"and-now-a-question",level:2}];function c(e){const n={a:"a",code:"code",em:"em",h2:"h2",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.p,{children:"My memory appears to be a sieve. Twice in the last year I've forgotten that MVCs ModelBinding doesn't handle regionalised numbers terribly well. Each time I've thought \"hmmmm.... best Google that\" and lo and behold come upon this post on the issue by the fantastic Phil Haack:"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.a,{href:"http://haacked.com/archive/2011/03/19/fixing-binding-to-decimals.aspx",children:"http://haacked.com/archive/2011/03/19/fixing-binding-to-decimals.aspx"})}),"\n",(0,l.jsx)(n.p,{children:"This post has got me 90% of the way there, the last 10% being me tweaking it so the model binder can handle nullable decimals as well."}),"\n",(0,l.jsx)(n.p,{children:"In the expectation I that I may forget this again I thought I'd note down my tweaks now and hopefully save myself sometime when I'm next looking at this next..."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-cs",children:"using System;\nusing System.Globalization;\nusing System.Web.Mvc;\n\nnamespace My.ModelBinders\n{\n    /// <summary>\n    /// Thank you Phil Haack: used to model bind multiple culture decimals\n    /// http://haacked.com/archive/2011/03/19/fixing-binding-to-decimals.aspx\n    ///\n    /// Use by adding these 2 lines to Application_Start in Global.asax.cs:\n    ///\n    /// System.Web.Mvc.ModelBinders.Binders.Add(typeof(decimal), new ModelBinders.DecimalModelBinder());\n    /// System.Web.Mvc.ModelBinders.Binders.Add(typeof(decimal?), new ModelBinders.DecimalModelBinder());\n    /// </summary>\n    public class DecimalModelBinder : IModelBinder\n    {\n        public object BindModel(ControllerContext controllerContext,\n            ModelBindingContext bindingContext)\n        {\n            ValueProviderResult valueResult = bindingContext.ValueProvider\n                .GetValue(bindingContext.ModelName);\n            ModelState modelState = new ModelState { Value = valueResult };\n            object actualValue = null;\n            try\n            {\n                //Check if this is a nullable decimal and a null or empty string has been passed\n                var isNullableAndNull = (bindingContext.ModelMetadata.IsNullableValueType &&\n                                         string.IsNullOrEmpty(valueResult.AttemptedValue));\n\n                //If not nullable and null then we should try and parse the decimal\n                if (!isNullableAndNull)\n                {\n                    actualValue = decimal.Parse(valueResult.AttemptedValue, NumberStyles.Any, CultureInfo.CurrentCulture);\n                }\n            }\n            catch (FormatException e)\n            {\n                modelState.Errors.Add(e);\n            }\n\n            bindingContext.ModelState.Add(bindingContext.ModelName, modelState);\n            return actualValue;\n        }\n    }\n}\n"})}),"\n",(0,l.jsx)(n.h2,{id:"and-now-a-question",children:"And now a question..."}),"\n",(0,l.jsx)(n.p,{children:"Why hasn't MVC got an out-of-the-box model binder that does this anyway? In Phil Haack's original post it looks like they were considering putting this into MVC itself at some point:"}),"\n",(0,l.jsxs)(n.p,{children:['"',(0,l.jsx)(n.em,{children:"... In that case, the DefaultModelBinder chokes on the value. This is unfortunate because jQuery Validate allows that value just fine. I\u2019ll talk to the rest of my team about whether we should fix this in the next version of ASP.NET MVC, but for now it\u2019s good to know there\u2019s a workaround..."}),'"']}),"\n",(0,l.jsx)(n.p,{children:"If anyone knows the reason this never made it into core I'd love to know. Maybe there's a good reason?"})]})}function u(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(c,{...e})}):c(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>s});var l=t(96540);const o={},i=l.createContext(o);function a(e){const n=l.useContext(i);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),l.createElement(i.Provider,{value:n},e.children)}}}]);