"use strict";(self.webpackChunkjohnnyreilly_com=self.webpackChunkjohnnyreilly_com||[]).push([[7492],{75232:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>a,toc:()=>c});var i=t(74848),s=t(28453);const o={slug:"introducing-ado-npm-auth-lite",title:"Introducing Azure DevOps npm auth-lite",authors:"johnnyreilly",tags:["azure devops","node.js"],image:"./title-image.png",hide_table_of_contents:!1,description:"Azure DevOps npm auth-lite eases setting up local authentication to Azure DevOps npm feeds, particularly for non Windows users."},r=void 0,a={permalink:"/introducing-ado-npm-auth-lite",editUrl:"https://github.com/johnnyreilly/blog.johnnyreilly.com/edit/main/blog-website/blog/2024-11-09-introducing-ado-npm-auth-lite/index.md",source:"@site/blog/2024-11-09-introducing-ado-npm-auth-lite/index.md",title:"Introducing Azure DevOps npm auth-lite",description:"Azure DevOps npm auth-lite eases setting up local authentication to Azure DevOps npm feeds, particularly for non Windows users.",date:"2024-11-09T00:00:00.000Z",tags:[{inline:!1,label:"Azure DevOps",permalink:"/tags/azure-devops",description:"The Azure DevOps suite of tools."},{inline:!1,label:"Node.js",permalink:"/tags/node-js",description:"The Node.js runtime."}],readingTime:3.62,hasTruncateMarker:!0,authors:[{name:"John Reilly",title:"OSS Engineer - TypeScript, Azure, React, Node.js, .NET",url:"https://johnnyreilly.com/about",imageURL:"https://johnnyreilly.com/img/profile.jpg",key:"johnnyreilly",page:null}],frontMatter:{slug:"introducing-ado-npm-auth-lite",title:"Introducing Azure DevOps npm auth-lite",authors:"johnnyreilly",tags:["azure devops","node.js"],image:"./title-image.png",hide_table_of_contents:!1,description:"Azure DevOps npm auth-lite eases setting up local authentication to Azure DevOps npm feeds, particularly for non Windows users."},unlisted:!1,nextItem:{title:"Azure DevOps API: Set User Story column with the Azure DevOps Client for Node.js",permalink:"/azure-devops-set-user-story-column-api"}},l={image:t(11458).A,authorsImageUrls:[void 0]},c=[{value:"What problem are we solving?",id:"what-problem-are-we-solving",level:2},{value:"When do I need to run <code>ado-npm-auth-lite</code>?",id:"when-do-i-need-to-run-ado-npm-auth-lite",level:2},{value:"Authenticating to Azure",id:"authenticating-to-azure",level:2},{value:"Using a <code>preinstall</code> script",id:"using-a-preinstall-script",level:2},{value:"Summary",id:"summary",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"Azure DevOps has a feature called Azure Artifacts that supports publishing npm packages to a feed for consumption. Typically those npm packages are intended to be consumed by a restricted audience. To install a package published to a private feed you need to configure authentication, and for non Windows users this is a convoluted process."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"title image reading &quot;Introducing Azure DevOps npm auth-lite&quot; with an Azure DevOps and npm logos",src:t(3367).A+"",width:"800",height:"450",loading:"eager",fetchpriority:"high"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"https://github.com/johnnyreilly/ado-npm-auth-lite",children:"Azure DevOps npm auth-lite"})," exists to ease the setting up of local authentication to Azure DevOps npm feeds, particularly for non Windows users."]}),"\n",(0,i.jsx)(n.h2,{id:"what-problem-are-we-solving",children:"What problem are we solving?"}),"\n",(0,i.jsx)(n.p,{children:"Consider the onboarding process for a Windows user for consuming an Azure Artifact npm feed:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"screenshot of the onboarding process for Windows users",src:t(77994).A+"",width:"2168",height:"592",loading:"lazy"})}),"\n",(0,i.jsx)(n.p,{children:"Now consider the onboarding process for a non Windows user:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"screenshot of the onboarding process for non Windows users",src:t(15839).A+"",width:"2168",height:"1606",loading:"lazy"})}),"\n",(0,i.jsxs)(n.p,{children:["As we can see, there is a significant difference in the onboarding experience between operating systems. Windows users can use a tool named ",(0,i.jsx)(n.a,{href:"https://www.npmjs.com/package/vsts-npm-auth",children:(0,i.jsx)(n.code,{children:"vsts-npm-auth"})})," which automates onboarding. Non windows users have a longer road to follow. The instructions walk through manually creating an ",(0,i.jsx)(n.code,{children:".npmrc"})," file in a users home directory which contains information including a base 64 encoded Azure DevOps Personal Access Token with the Packaging read and write scopes. It is tedious to do."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"ado-npm-auth-lite"})," aims to automate the toil, and make the onboarding experience for non Windows users as simple as it is for Windows users."]}),"\n",(0,i.jsxs)(n.p,{children:["There is an official package named ",(0,i.jsx)(n.a,{href:"https://github.com/microsoft/ado-npm-auth",children:(0,i.jsx)(n.code,{children:"ado-npm-auth"})}),". However, ",(0,i.jsxs)(n.a,{href:"https://github.com/microsoft/ado-npm-auth/issues/50",children:["due to issues I experienced in using the ",(0,i.jsx)(n.code,{children:"ado-npm-auth"})," package"]}),", I found myself creating ",(0,i.jsx)(n.code,{children:"ado-npm-auth-lite"}),'. By the way, the "lite" in ',(0,i.jsx)(n.code,{children:"ado-npm-auth-lite"})," doesn't represent anything in particular; I just couldn't think of another good name."]}),"\n",(0,i.jsxs)(n.h2,{id:"when-do-i-need-to-run-ado-npm-auth-lite",children:["When do I need to run ",(0,i.jsx)(n.code,{children:"ado-npm-auth-lite"}),"?"]}),"\n",(0,i.jsxs)(n.p,{children:["Should you encounter the following message when you try to ",(0,i.jsx)(n.code,{children:"npm i"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"npm error code E401\nnpm error Unable to authenticate, your authentication token seems to be invalid.\nnpm error To correct this please try logging in again with:\nnpm error npm login\n"})}),"\n",(0,i.jsx)(n.p,{children:"That means either:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["You have no user ",(0,i.jsx)(n.code,{children:".npmrc"})," file ",(0,i.jsx)(n.strong,{children:"OR"})]}),"\n",(0,i.jsxs)(n.li,{children:["The token in your user ",(0,i.jsx)(n.code,{children:".npmrc"})," file is out of date"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["In either case, running ",(0,i.jsx)(n.code,{children:"ado-npm-auth-lite"})," should resolve the issue. To get ",(0,i.jsx)(n.code,{children:"ado-npm-auth-lite"})," to create the necessary user ",(0,i.jsx)(n.code,{children:".npmrc"})," file for local development, run the following command:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"npx --yes ado-npm-auth-lite --config .npmrc\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"ado-npm-auth-lite"})," requires the project ",(0,i.jsx)(n.code,{children:".npmrc"})," file exists in order that it can acquire the information to run. There is an optional ",(0,i.jsx)(n.code,{children:"config"})," parameter which allows selection of a specific project ",(0,i.jsx)(n.code,{children:".npmrc"})," file. If the ",(0,i.jsx)(n.code,{children:"config"})," parameter is not supplied, ",(0,i.jsx)(n.code,{children:"ado-npm-auth-lite"})," will default to use the ",(0,i.jsx)(n.code,{children:".npmrc"})," in the current project directory."]}),"\n",(0,i.jsxs)(n.p,{children:["Should you not have one already, there will be information in your Azure DevOps Artifacts section for connecting to the npm feed around creating a project ",(0,i.jsx)(n.code,{children:".npmrc"})," file. The required file should look something like this:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"registry=https://pkgs.dev.azure.com/johnnyreilly/_packaging/npmrc-script-organization/npm/registry/\n\nalways-auth=true\n"})}),"\n",(0,i.jsx)(n.h2,{id:"authenticating-to-azure",children:"Authenticating to Azure"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"ado-npm-auth-lite"})," requires that you are authenticated with Azure to acquire an Azure DevOps Personal Access Token. Internally it uses the Azure authentication token to acquire a Personal Access Token with the Packaging read and write scopes. To authenticate, run ",(0,i.jsx)(n.code,{children:"az login"}),". ",(0,i.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/cli/azure/install-azure-cli",children:"If you need to install the Azure CLI, follow these instructions"}),". It is not necessary to run ",(0,i.jsx)(n.code,{children:"az login"})," if you are already authenticated with Azure."]}),"\n",(0,i.jsxs)(n.h2,{id:"using-a-preinstall-script",children:["Using a ",(0,i.jsx)(n.code,{children:"preinstall"})," script"]}),"\n",(0,i.jsxs)(n.p,{children:["A great way to integrate ",(0,i.jsx)(n.code,{children:"ado-npm-auth-lite"})," is by using it in a ",(0,i.jsx)(n.code,{children:"preinstall"})," script in your ",(0,i.jsx)(n.code,{children:"package.json"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'"scripts": {\n  "preinstall": "npx --yes ado-npm-auth-lite"\n},\n'})}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"--yes"})," flag above is not mandatory; it simply skips having npm challenge the user as to whether to download the package."]}),"\n",(0,i.jsxs)(n.p,{children:["With the above ",(0,i.jsx)(n.code,{children:"preinstall"})," script in place, when the user performs ",(0,i.jsx)(n.code,{children:"npm i"})," or similar, before attempting to install, the relevant user ",(0,i.jsx)(n.code,{children:".npmrc"})," file will be put in place so that installation just works\u2122\ufe0f. This is a ",(0,i.jsx)(n.strong,{children:"great"})," developer experience."]}),"\n",(0,i.jsxs)(n.p,{children:["You might be worried about ",(0,i.jsx)(n.code,{children:"ado-npm-auth-lite"})," trying to create user ",(0,i.jsx)(n.code,{children:".npmrc"})," files when running CI builds. Happily this does not happen; it detects whether it is running in a CI environment and does ",(0,i.jsx)(n.strong,{children:"not"})," create a user ",(0,i.jsx)(n.code,{children:".npmrc"})," file in that case."]}),"\n",(0,i.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,i.jsxs)(n.p,{children:["If you're a Mac or a Linux user, hopefully ",(0,i.jsx)(n.code,{children:"ado-npm-auth-lite"})," can significantly ease the friction experienced doing local development with Azure DevOps npm feeds. You can see the ",(0,i.jsx)(n.a,{href:"https://github.com/johnnyreilly/ado-npm-auth-lite",children:"project code on GitHub here"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},11458:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/title-image-4c3dfee5229634a1298856a1fc181481.png"},15839:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/screenshot-onboarding-with-other-877ecf885ed2dced3ef6ef4e33fecab7.png"},77994:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/screenshot-onboarding-with-windows-bcf67d66378e527bc7a4a11c9598881a.png"},3367:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/title-image-4c3dfee5229634a1298856a1fc181481.png"},28453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>a});var i=t(96540);const s={},o=i.createContext(s);function r(e){const n=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);