"use strict";(self.webpackChunkjohnnyreilly_com=self.webpackChunkjohnnyreilly_com||[]).push([[28827],{22721:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/screenshot-azure-devops-service-connections-37041c60f0e692bbe10d70aa3510280a.webp"},28453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>c});var i=t(96540);const s={},o=i.createContext(s);function r(e){const n=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),i.createElement(o.Provider,{value:n},e.children)}},47357:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/title-image-635c8f7f7f2a2d2d6d61b3c45040d683.png"},54700:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/title-image-635c8f7f7f2a2d2d6d61b3c45040d683.png"},70118:e=>{e.exports=JSON.parse('{"permalink":"/get-service-connections-with-azure-devops-api","editUrl":"https://github.com/johnnyreilly/blog.johnnyreilly.com/edit/main/blog-website/blog/2025-01-25-get-service-connections-with-azure-devops-api/index.md","source":"@site/blog/2025-01-25-get-service-connections-with-azure-devops-api/index.md","title":"Get Service Connections with the Azure DevOps API (REST and TypeScript)","description":"Learn how to get service connections with the Azure DevOps REST API using both curl and TypeScript.","date":"2025-01-25T00:00:00.000Z","tags":[{"inline":false,"label":"Azure Pipelines","permalink":"/tags/azure-pipelines","description":"The Azure Pipelines CI / CD service."},{"inline":false,"label":"Azure DevOps","permalink":"/tags/azure-devops","description":"The Azure DevOps suite of tools."},{"inline":false,"label":"TypeScript","permalink":"/tags/typescript","description":"The TypeScript programming language."}],"readingTime":4.07,"hasTruncateMarker":true,"authors":[{"name":"John Reilly","title":"OSS Engineer - TypeScript, Azure, React, Node.js, .NET","url":"https://johnnyreilly.com/about","imageURL":"https://johnnyreilly.com/img/profile-2025.jpg","key":"johnnyreilly","page":null}],"frontMatter":{"slug":"get-service-connections-with-azure-devops-api","title":"Get Service Connections with the Azure DevOps API (REST and TypeScript)","authors":"johnnyreilly","tags":["azure pipelines","azure devops","typescript"],"image":"./title-image.png","hide_table_of_contents":false,"description":"Learn how to get service connections with the Azure DevOps REST API using both curl and TypeScript."},"unlisted":false,"prevItem":{"title":"Node.js, Azure Application Insights, and Fastify","permalink":"/nodejs-azure-appinsights-fastify"},"nextItem":{"title":"Slash command your deployment with GitHub Actions","permalink":"/slash-command-your-deployment-with-github-actions"}}')},94465:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>d,frontMatter:()=>r,metadata:()=>i,toc:()=>l});var i=t(70118),s=t(74848),o=t(28453);const r={slug:"get-service-connections-with-azure-devops-api",title:"Get Service Connections with the Azure DevOps API (REST and TypeScript)",authors:"johnnyreilly",tags:["azure pipelines","azure devops","typescript"],image:"./title-image.png",hide_table_of_contents:!1,description:"Learn how to get service connections with the Azure DevOps REST API using both curl and TypeScript."},c=void 0,a={image:t(47357).A,authorsImageUrls:[void 0]},l=[{value:"Service connections vs service endpoints",id:"service-connections-vs-service-endpoints",level:2},{value:"Curling service connections",id:"curling-service-connections",level:2},{value:"What if I want to use TypeScript?",id:"what-if-i-want-to-use-typescript",level:2},{value:"Conclusion",id:"conclusion",level:2}];function p(e){const n={a:"a",code:"code",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"If you work with Azure Pipelines, you'll likely have come upon the need to create service connections. These are the connections to external services that your pipelines need to run. You can interrogate these connections using the Azure DevOps REST API. This post goes through how to do this; both using curl and using TypeScript."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"title image reading &quot;Get Service Connections with the Azure DevOps API&quot; with the Azure DevOps logo",src:t(54700).A+"",width:"800",height:"450",loading:"lazy"})}),"\n",(0,s.jsxs)(n.p,{children:["I'm writing this post because when I attempted to use the ",(0,s.jsx)(n.a,{href:"https://github.com/microsoft/azure-devops-node-api",children:"Azure DevOps Client for Node.js"})," package to acquire them I found it lacking, and ",(0,s.jsx)(n.a,{href:"/create-pipeline-with-azure-devops-api",children:"not for the first time"}),". I am going to allow myself a little moan here; ever since Microsoft acquired GitHub, the Azure DevOps ecosystem feels like it has had insufficient investment."]}),"\n",(0,s.jsxs)(n.p,{children:["However, as is often the case, there is a way. The Azure DevOps REST API is there for us, and with a little ",(0,s.jsx)(n.code,{children:"fetch"})," we can get the job done."]}),"\n",(0,s.jsx)(n.h2,{id:"service-connections-vs-service-endpoints",children:"Service connections vs service endpoints"}),"\n",(0,s.jsx)(n.p,{children:'Before we get into the code, let\'s clarify the terminology. In Azure DevOps, service connections are the connections to external services that your pipelines need to run. However, the Azure DevOps REST API refers to these as "service endpoints".'}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Screenshot of service connections in the Azure DevOps UI",src:t(22721).A+"",width:"2066",height:"762",loading:"lazy"})}),"\n",(0,s.jsx)(n.p,{children:'So when you\'re looking the screenshot above and you see "service connections", remember that in the API they\'re referred to as "service endpoints". If there is an actual distinction between "service connections" and "service endpoints" I\'m not aware of it. If you know, please do let me know!'}),"\n",(0,s.jsx)(n.h2,{id:"curling-service-connections",children:"Curling service connections"}),"\n",(0,s.jsxs)(n.p,{children:['Once you know that service connections are referred to as "service endpoints" in the Azure DevOps REST API, you can use the ',(0,s.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/rest/api/azure/devops/serviceendpoint/endpoints/get-service-endpoints?view=azure-devops-rest-7.2&tabs=HTTP",children:"documentation"})," to get them. Here's a curl to get you started:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"curl  --user '':'PERSONAL_ACCESS_TOKEN' --header \"Content-Type: application/json\" --header \"Accept:application/json\" https://dev.azure.com/{organization}/{project}/_apis/serviceendpoint/endpoints?api-version=7.1\n"})}),"\n",(0,s.jsx)(n.h2,{id:"what-if-i-want-to-use-typescript",children:"What if I want to use TypeScript?"}),"\n",(0,s.jsxs)(n.p,{children:["Now that we can see there's a way to get service connections with curl, let's look at how we can do this with TypeScript. Effectively we'll want to ",(0,s.jsx)(n.code,{children:"fetch"})," (instead of using curl) and statically type the response with some interfaces. Here's a function that will retrieve service connections:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"export async function getAzureDevOpsServiceConnections({\n  personalAccessToken,\n  organization,\n  projectName,\n}: {\n  /** requires the vso.serviceendpoint scope which grants the ability to read service endpoints / service connections */\n  personalAccessToken: string;\n  /** eg \"johnnyreilly\" */\n  organization: string;\n  /** eg \"blog-demos\" */\n  projectName: string;\n}): Promise<ServiceConnection[]> {\n  // https://learn.microsoft.com/en-us/rest/api/azure/devops/serviceendpoint/endpoints/get-service-endpoints?view=azure-devops-rest-7.1&tabs=HTTP\n  const url = `https://dev.azure.com/${organization}/${projectName}/_apis/serviceendpoint/endpoints?api-version=7.1`;\n\n  const response = await fetch(url, {\n    method: 'GET',\n    headers: {\n      Accept: 'application/json',\n      'Content-Type': 'application/json',\n      Authorization: `Basic ${Buffer.from(`PAT:${personalAccessToken}`).toString('base64')}`,\n      'X-TFS-FedAuthRedirect': 'Suppress',\n    },\n  });\n\n  if (!response.ok) {\n    throw new Error(`HTTP error! status: ${response.status.toString()}`);\n  }\n\n  const data = (await response.json()) as Wrapper;\n\n  return data.value;\n}\n\ninterface Wrapper {\n  count: number;\n  value: ServiceConnection[];\n}\n\nexport interface ServiceConnection {\n  authorization: Authorization;\n  createdBy: CreatedBy;\n  data: Record<string, null | string>;\n  description: string;\n  id: string;\n  isOutdated: boolean;\n  isReady: boolean;\n  isShared: boolean;\n  modificationDate?: string;\n  modifiedBy?: ModifiedBy;\n  name: string;\n  owner: string;\n  serviceEndpointProjectReferences: ServiceEndpointProjectReference[];\n  serviceManagementReference: null;\n  type: string;\n  url: string;\n}\n\nexport interface CreatedBy {\n  _links: Links;\n  descriptor: string;\n  displayName: string;\n  id: string;\n  imageUrl: string;\n  uniqueName: string;\n  url: string;\n}\n\nexport interface Links {\n  avatar: Avatar;\n}\n\nexport interface Avatar {\n  href: string;\n}\n\nexport interface Authorization {\n  parameters: Record<string, null | string>;\n  scheme: string;\n}\n\nexport interface ServiceEndpointProjectReference {\n  description: string;\n  name: string;\n  projectReference: ProjectReference;\n}\n\nexport interface ProjectReference {\n  id: string;\n  name: string;\n}\n\nexport interface ModifiedBy {\n  displayName: null | string;\n  id: string;\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["The function ",(0,s.jsx)(n.code,{children:"getAzureDevOpsServiceConnections"})," is the one you'll want to call. It takes the following inputs:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"personalAccessToken"}),": the personal access token you've created in Azure DevOps with the ",(0,s.jsx)(n.code,{children:"vso.serviceendpoint"})," scope. You could equally use the ",(0,s.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/devops/pipelines/build/variables?view=azure-devops&tabs=yaml#systemaccesstoken",children:(0,s.jsx)(n.code,{children:"System.AccessToken"})})," that's available in your pipeline if that was appropriate."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"organization"}),": the name of your Azure DevOps organization"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"projectName"}),": the name of the project you're interested in"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["The function returns an array of ",(0,s.jsx)(n.code,{children:"ServiceConnection"})," objects. You'll note that the API actually returns a ",(0,s.jsx)(n.code,{children:"Wrapper"})," object that contains a ",(0,s.jsx)(n.code,{children:"count"})," and an array of ",(0,s.jsx)(n.code,{children:"ServiceConnection"})," objects. This isn't actually useful for my purposes, so I've just returned the array of ",(0,s.jsx)(n.code,{children:"ServiceConnection"})," objects."]}),"\n",(0,s.jsx)(n.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,s.jsx)(n.p,{children:'Honestly the hardest part about writing this post was being sure that "service connections" and "service endpoints" were the same thing. Truly naming things is hard.'}),"\n",(0,s.jsx)(n.p,{children:'Hopefully this post has helped you get the service connections you need. And as I mentioned earlier, if you know an actual distinction between "service connections" and "service endpoints" please do let me know!'})]})}function d(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(p,{...e})}):p(e)}}}]);