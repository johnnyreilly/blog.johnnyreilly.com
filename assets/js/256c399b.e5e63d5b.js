"use strict";(self.webpackChunkjohnnyreilly_com=self.webpackChunkjohnnyreilly_com||[]).push([[62533],{67030:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>c,frontMatter:()=>i,metadata:()=>o,toc:()=>d});var s=a(85893),n=a(11151);const i={slug:"schemar-github-action-to-validate-structured-data",title:"Schemar: a GitHub Action to validate structured data",authors:"johnnyreilly",tags:["seo"],image:"./title-image.png",description:"This post demonstrates how to use Schemar to validate structured data using a GitHub Action.",hide_table_of_contents:!1},r=void 0,o={permalink:"/schemar-github-action-to-validate-structured-data",editUrl:"https://github.com/johnnyreilly/blog.johnnyreilly.com/edit/main/blog-website/blog/2024-01-02-schemar-github-action-to-validate-structured-data/index.md",source:"@site/blog/2024-01-02-schemar-github-action-to-validate-structured-data/index.md",title:"Schemar: a GitHub Action to validate structured data",description:"This post demonstrates how to use Schemar to validate structured data using a GitHub Action.",date:"2024-01-02T00:00:00.000Z",formattedDate:"January 2, 2024",tags:[{label:"seo",permalink:"/tags/seo"}],readingTime:6.295,hasTruncateMarker:!0,authors:[{name:"John Reilly",title:"OSS Engineer - TypeScript, Azure, React, Node.js, .NET",url:"https://johnnyreilly.com/about",imageURL:"https://johnnyreilly.com/img/profile.jpg",key:"johnnyreilly"}],frontMatter:{slug:"schemar-github-action-to-validate-structured-data",title:"Schemar: a GitHub Action to validate structured data",authors:"johnnyreilly",tags:["seo"],image:"./title-image.png",description:"This post demonstrates how to use Schemar to validate structured data using a GitHub Action.",hide_table_of_contents:!1},unlisted:!1,prevItem:{title:"Bicep lint with Azure Pipelines and GitHub Actions",permalink:"/bicep-lint-azure-pipelines-github-actions"},nextItem:{title:"Snapshot log tests in .NET",permalink:"/snapshot-log-tests-dotnet"}},l={image:a(24945).Z,authorsImageUrls:[void 0]},d=[{value:"What is Schemar?",id:"what-is-schemar",level:2},{value:"Using Schemar",id:"using-schemar",level:2},{value:"Surfacing Schemar results in your pull requests",id:"surfacing-schemar-results-in-your-pull-requests",level:2},{value:"Adding Schemar to the GitHub Action",id:"adding-schemar-to-the-github-action",level:3},{value:"Testing it out",id:"testing-it-out",level:3},{value:"Conclusion",id:"conclusion",level:2}];function u(e){const t={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,n.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.p,{children:"Of late, I've found myself getting more and more into structured data. Structured data is a way of adding machine-readable information to web pages. To entertain myself, I liken it to static typing for websites. I've written about structured data before, but in this post I want to focus on how to validate structured data."}),"\n",(0,s.jsxs)(t.p,{children:["Specifically, how can we validate structured data in the context of a GitHub workflow? I've created a GitHub Action called ",(0,s.jsx)(t.a,{href:"https://github.com/marketplace/actions/schemar-ci-action",children:"Schemar"})," that facilitates just that. In this post we'll see how to use it."]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"title image reading &quot;Schemar: a GitHub Action to validate structured data&quot; with the GitHub Action logo",src:a(29711).Z+"",width:"800",height:"450",loading:"eager",fetchpriority:"high"})}),"\n",(0,s.jsx)(t.p,{children:"If you'd like to read more about structured data, you might like to read these posts:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"/structured-data-seo-and-react",children:"Structured data, SEO and React"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"/how-we-fixed-my-seo",children:"How we fixed my SEO"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"/docusaurus-blogs-adding-breadcrumb-structured-data",children:"Docusaurus blogs: adding breadcrumb structured data"})}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"what-is-schemar",children:"What is Schemar?"}),"\n",(0,s.jsxs)(t.p,{children:["Schemar is a GitHub Action that validates structured data. It's a wrapper around the ",(0,s.jsx)(t.a,{href:"https://validator.schema.org/",children:"Schema Markup Validator"})," tool."]}),"\n",(0,s.jsxs)(t.p,{children:["If you haven't heard of Schema.orgs validator; it originally started at Google as the Structured Data Testing Tool but was ",(0,s.jsx)(t.a,{href:"https://developers.google.com/search/blog/2020/12/structured-data-testing-tool-update",children:"repurposed and gifted to the community"}),"."]}),"\n",(0,s.jsx)(t.p,{children:"That tool is a website; Schemar is a wrapper around the tool that makes it easy to validate structured data in the context of a GitHub workflow. Let's imagine it's very important to you that your structured data is both present and valid. You could use Schemar to validate your structured data as part of your CI/CD pipeline."}),"\n",(0,s.jsxs)(t.p,{children:["Imagine Schemar to be the structured data equivalent of the ",(0,s.jsx)(t.a,{href:"https://github.com/treosh/lighthouse-ci-action",children:(0,s.jsx)(t.code,{children:"lighthouse-ci-action"})})," GitHub Action."]}),"\n",(0,s.jsx)(t.h2,{id:"using-schemar",children:"Using Schemar"}),"\n",(0,s.jsxs)(t.p,{children:["I'm going to take my blog (that's what you're reading right now BTW) and use Schemar to validate the structured data on it. I already have a GitHub Action that builds and deploys my blog to a staging environment in Azure Static Web Apps and ",(0,s.jsx)(t.a,{href:"/lighthouse-meet-github-actions",children:"validates it with Lighthouse"}),". So I'm going to add Schemar to that."]}),"\n",(0,s.jsxs)(t.p,{children:["But before we do that, let's look at simple usage of Schemar. If you were to add a ",(0,s.jsx)(t.code,{children:".github/workflows/schemar.yml"})," file to your repo with the following contents:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-yaml",children:"jobs:\n  release:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: johnnyreilly/schemar@v0.1.1\n        with:\n          urls: https://johnnyreilly.com\n\nname: Validate structured data\n\non:\n  pull_request: ~\n  push:\n    branches:\n      - main\n"})}),"\n",(0,s.jsxs)(t.p,{children:["Then you'd have a GitHub workflow that would validate the structured data on ",(0,s.jsx)(t.code,{children:"https://johnnyreilly.com"})," and fail if it wasn't valid."]}),"\n",(0,s.jsxs)(t.p,{children:["The ",(0,s.jsx)(t.code,{children:"urls"})," input of Schemar is a list of URLs to validate. In this case, we're just validating only one. The results look like this:"]}),"\n",(0,s.jsxs)(t.blockquote,{children:["\n",(0,s.jsxs)(t.p,{children:["Validating ",(0,s.jsx)(t.a,{href:"https://johnnyreilly.com",children:"https://johnnyreilly.com"})," for structured data..."]}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.a,{href:"https://johnnyreilly.com",children:"https://johnnyreilly.com"})," has structured data of these types:"]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"Organization / Brand"}),"\n",(0,s.jsx)(t.li,{children:"WebSite"}),"\n",(0,s.jsx)(t.li,{children:"Blog"}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["For more details see ",(0,s.jsx)(t.a,{href:"https://validator.schema.org/#url=https%3A%2F%2Fjohnnyreilly.com",children:"https://validator.schema.org/#url=https%3A%2F%2Fjohnnyreilly.com"})]}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["We can see that the home page of my blog has structured data of the types ",(0,s.jsx)(t.code,{children:"Organization / Brand"}),", ",(0,s.jsx)(t.code,{children:"WebSite"})," and ",(0,s.jsx)(t.code,{children:"Blog"}),". And we can even click into the Schema Markup Validator to see the details."]}),"\n",(0,s.jsx)(t.p,{children:"If at some point I were to omit or break the structured data on my blog, then Schemar would fail the build. This is a great way to ensure that your structured data is always present and valid."}),"\n",(0,s.jsx)(t.p,{children:"We're going to see what usage looks like in a minute, as we dive into a more sophisticated example."}),"\n",(0,s.jsx)(t.h2,{id:"surfacing-schemar-results-in-your-pull-requests",children:"Surfacing Schemar results in your pull requests"}),"\n",(0,s.jsx)(t.p,{children:"Now that we've seen a basic example, let's see what it looks like to use Schemar in a more sophisticated way. We're going to add Schemar to run against my blogs pull request previews, in the same way we're already running Lighthouse against them."}),"\n",(0,s.jsx)(t.h3,{id:"adding-schemar-to-the-github-action",children:"Adding Schemar to the GitHub Action"}),"\n",(0,s.jsxs)(t.p,{children:["I won't reiterate the whole GitHub workflow that spins up a preview environment here, but I'll show the key parts. You can see the whole thing in the ",(0,s.jsxs)(t.a,{href:"https://github.com/johnnyreilly/blog.johnnyreilly.com/blob/main/.github/workflows/build-and-deploy-static-web-app.yml",children:[(0,s.jsx)(t.code,{children:"build-and-deploy-static-web-app.yml"})," of the blog repo"]}),". You'll note I'm using Azure Static Web Apps to host my blog - but any web platform will do."]}),"\n",(0,s.jsx)(t.p,{children:"Here is the key part of the GitHub workflow:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-yaml",children:"structured_data_report_job:\n  name: Structured data report \ud83d\udcdd\n  needs: build_and_deploy_swa_job\n  if: github.event_name == 'pull_request' && github.event.action != 'closed'\n  runs-on: ubuntu-latest\n  steps:\n    - uses: actions/checkout@v4\n\n    - name: Wait for preview ${{ needs.build_and_deploy_swa_job.outputs.preview-url }} \u231a\n      id: static_web_app_wait_for_preview\n      uses: nev7n/wait_for_response@v1\n      with:\n        url: '${{ needs.build_and_deploy_swa_job.outputs.preview-url }}'\n        responseCode: 200\n        timeout: 600000\n        interval: 1000\n\n    - name: Audit URLs for structured data \ud83e\uddd0\n      id: structured_data_audit\n      uses: johnnyreilly/schemar@v0.1.1\n      with:\n        urls: |\n          ${{ needs.build_and_deploy_swa_job.outputs.preview-url }}\n          ${{ needs.build_and_deploy_swa_job.outputs.preview-url }}/about\n          ${{ needs.build_and_deploy_swa_job.outputs.preview-url }}/blog\n          ${{ needs.build_and_deploy_swa_job.outputs.preview-url }}/definitely-typed-the-movie\n\n    - name: Format structured data results\n      id: format_structured_data_results\n      if: always()\n      uses: actions/github-script@v7\n      with:\n        script: |\n          const structuredDataCommentMaker = (await import('${{ github.workspace }}/.github/workflows/structuredDataCommentMaker.mjs')).default;\n          const results = ${{ steps.structured_data_audit.outputs.results }};\n          core.setOutput(\"comment\", structuredDataCommentMaker('${{ needs.build_and_deploy_swa_job.outputs.preview-url }}', results));\n\n    - name: Add structured data results as comment \u270d\ufe0f\n      id: structured_data_comment_to_pr\n      if: always()\n      uses: marocchino/sticky-pull-request-comment@v2\n      with:\n        number: ${{ github.event.pull_request.number }}\n        header: structured_data\n        message: ${{ steps.format_structured_data_results.outputs.comment }}\n"})}),"\n",(0,s.jsxs)(t.p,{children:["Along with the following ",(0,s.jsx)(t.code,{children:"structuredDataCommentMaker.mjs"})," script:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-js",metastring:'title="structuredDataCommentMaker.mjs"',children:"// @ts-check\n\n/**\n * @typedef {Object} Result\n * @prop {string} url\n * @prop {ProcessedValidationResult} processedValidationResult\n */\n\n/**\n * @typedef {Object} ProcessedValidationResult\n * @prop {boolean} success\n * @prop {string} resultText\n */\n\n/**\n * @param {string} baseUrl\n * @param {Result[]} results\n */\nfunction createStructuredDataReport(baseUrl, results) {\n  const comment = `### \ud83d\udcdd Structured data report\n\n${results\n  .map((result) => {\n    const shortUrl = result.url.replace(baseUrl, '') || '/';\n    return `#### ${\n      result.processedValidationResult.success ? '\ud83d\udfe2' : '\ud83d\udd34'\n    } [${shortUrl}](${result.url}) \n${result.processedValidationResult.resultText}`;\n  })\n  .join('\\n')}\n`;\n  return comment;\n}\n\nexport default createStructuredDataReport;\n"})}),"\n",(0,s.jsx)(t.p,{children:"Let's break this down:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["We're using the ",(0,s.jsx)(t.a,{href:"https://github.com/nev7n/wait_for_response",children:(0,s.jsx)(t.code,{children:"nev7n/wait_for_response"})})," GitHub Action to wait for the preview to be available. This is because the preview URL is not available immediately after the preview is created."]}),"\n",(0,s.jsx)(t.li,{children:"We're running Schemar against four URLs in our pull request preview. These pages should have structured data; and if any fail then it's likely a sign that something has gone wrong with my sites structured data story."}),"\n",(0,s.jsxs)(t.li,{children:["We then take the output of the Schemar run and format it into a comment that we can add to the pull request - to do that we use the ",(0,s.jsx)(t.code,{children:"structuredDataCommentMaker.mjs"})," script."]}),"\n",(0,s.jsxs)(t.li,{children:["Finally, we add the comment to the pull request using the ",(0,s.jsx)(t.a,{href:"https://github.com/marocchino/sticky-pull-request-comment",children:(0,s.jsx)(t.code,{children:"marocchino/sticky-pull-request-comment"})})," GitHub Action."]}),"\n"]}),"\n",(0,s.jsx)(t.h3,{id:"testing-it-out",children:"Testing it out"}),"\n",(0,s.jsx)(t.p,{children:"Let's see what this looks like in action. I've created a pull request that breaks the structured data from my blog. This is what the pull request looks like:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-diff",children:"-'@type': 'Person',\n+'@type': 'Blarg', // let's break the schema!\n"})}),"\n",(0,s.jsx)(t.p,{children:"The question is, what does the pull request look like after the GitHub Action has run? Here's the answer:"}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"screenshot of the GitHub Action failing",src:a(25109).Z+"",width:"1579",height:"713",loading:"lazy"})}),"\n",(0,s.jsx)(t.p,{children:"It failed! And it put a comment on the PR that looks like this:"}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"screenshot of the GitHub Action comment on the PR",src:a(64131).Z+"",width:"906",height:"642",loading:"lazy"})}),"\n",(0,s.jsx)(t.p,{children:"Let's unbreak the structured data and see what happens:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-diff",children:"-'@type': 'Blarg', // let's break the schema!\n+'@type': 'Person',\n"})}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"screenshot of the GitHub Action failing",src:a(13223).Z+"",width:"1575",height:"777",loading:"lazy"})}),"\n",(0,s.jsx)(t.p,{children:"It succeeded! And it put a comment on the PR that looks like this:"}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"screenshot of the GitHub Action comment on the PR",src:a(27157).Z+"",width:"900",height:"508",loading:"lazy"})}),"\n",(0,s.jsx)(t.p,{children:"This is great! It means that I can be confident that my structured data is always present and valid. And if it isn't, then I'll know about it. I can even click through to the Schema Markup Validator to see the details."}),"\n",(0,s.jsx)(t.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,s.jsx)(t.p,{children:"My hope is that Schemar can be used to increase the quality of structured data on the web. I'm using it to increase the quality of structured data on my blog. I hope you'll find it useful too."}),"\n",(0,s.jsxs)(t.p,{children:["I've also ",(0,s.jsx)(t.a,{href:"https://github.com/schemaorg/schemaorg/discussions/3432",children:"shared this with the good folk of Schema.org"})," in the hope they'll find it useful too. The ",(0,s.jsx)(t.a,{href:"https://github.com/johnnyreilly/schemar",children:"source code of Schemar can be found here"}),"."]})]})}function c(e={}){const{wrapper:t}={...(0,n.a)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(u,{...e})}):u(e)}},24945:(e,t,a)=>{a.d(t,{Z:()=>s});const s=a.p+"assets/images/title-image-d26eb86d473a706da54606f51a9101b5.png"},25109:(e,t,a)=>{a.d(t,{Z:()=>s});const s=a.p+"assets/images/screenshot-failed-github-action-fb3a10c6bdbb1bdeb4e1a91f79f7bb06.png"},64131:(e,t,a)=>{a.d(t,{Z:()=>s});const s=a.p+"assets/images/screenshot-pull-request-failed-comment-6a8126dfd8bb299bfc7408294f6608cc.png"},27157:(e,t,a)=>{a.d(t,{Z:()=>s});const s=a.p+"assets/images/screenshot-pull-request-succeeded-comment-c0bebef5c518e85255b4d7e09e850856.png"},13223:(e,t,a)=>{a.d(t,{Z:()=>s});const s=a.p+"assets/images/screenshot-succeeded-github-action-7ff041dfd9da1cefddfb1e8d8b56c759.png"},29711:(e,t,a)=>{a.d(t,{Z:()=>s});const s=a.p+"assets/images/title-image-d26eb86d473a706da54606f51a9101b5.png"},11151:(e,t,a)=>{a.d(t,{Z:()=>o,a:()=>r});var s=a(67294);const n={},i=s.createContext(n);function r(e){const t=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:r(e.components),s.createElement(i.Provider,{value:t},e.children)}}}]);