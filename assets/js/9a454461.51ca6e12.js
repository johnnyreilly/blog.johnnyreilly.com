"use strict";(self.webpackChunkjohnnyreilly_com=self.webpackChunkjohnnyreilly_com||[]).push([[14477],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>d});var i=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=i.createContext({}),l=function(e){var t=i.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=l(e.components);return i.createElement(s.Provider,{value:t},e.children)},u="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},g=i.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,s=e.parentName,c=p(e,["components","mdxType","originalType","parentName"]),u=l(n),g=a,d=u["".concat(s,".").concat(g)]||u[g]||h[g]||r;return n?i.createElement(d,o(o({ref:t},c),{},{components:n})):i.createElement(d,o({ref:t},c))}));function d(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,o=new Array(r);o[0]=g;var p={};for(var s in t)hasOwnProperty.call(t,s)&&(p[s]=t[s]);p.originalType=e,p[u]="string"==typeof e?e:a,o[1]=p;for(var l=2;l<r;l++)o[l]=n[l];return i.createElement.apply(null,o)}return i.createElement.apply(null,n)}g.displayName="MDXCreateElement"},44727:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>d,frontMatter:()=>p,metadata:()=>l,toc:()=>u});n(67294);var i=n(3905);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function o(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}const p={slug:"bicep-link-azure-application-insights-to-static-web-apps",title:"Bicep: Link Azure Application Insights to Static Web Apps",authors:"johnnyreilly",image:"./title-image.png",tags:["azure","bicep","azure static web apps"],description:"Learn how to link Azure Application Insights to an Azure Static Web App using Bicep.",hide_table_of_contents:!1},s=void 0,l={permalink:"/bicep-link-azure-application-insights-to-static-web-apps",editUrl:"https://github.com/johnnyreilly/blog.johnnyreilly.com/edit/main/blog-website/blog/2023-10-18-bicep-link-azure-application-insights-to-static-web-apps/index.md",source:"@site/blog/2023-10-18-bicep-link-azure-application-insights-to-static-web-apps/index.md",title:"Bicep: Link Azure Application Insights to Static Web Apps",description:"Learn how to link Azure Application Insights to an Azure Static Web App using Bicep.",date:"2023-10-18T00:00:00.000Z",formattedDate:"October 18, 2023",tags:[{label:"azure",permalink:"/tags/azure"},{label:"bicep",permalink:"/tags/bicep"},{label:"azure static web apps",permalink:"/tags/azure-static-web-apps"}],readingTime:2.65,hasTruncateMarker:!0,authors:[{name:"John Reilly",title:"OSS Engineer - TypeScript, Azure, React, Node.js, .NET",url:"https://johnnyreilly.com/about",imageURL:"https://johnnyreilly.com/img/profile.jpg",key:"johnnyreilly"}],frontMatter:{slug:"bicep-link-azure-application-insights-to-static-web-apps",title:"Bicep: Link Azure Application Insights to Static Web Apps",authors:"johnnyreilly",image:"./title-image.png",tags:["azure","bicep","azure static web apps"],description:"Learn how to link Azure Application Insights to an Azure Static Web App using Bicep.",hide_table_of_contents:!1},prevItem:{title:"Migrating to v4 Azure Functions Node.js with TypeScript",permalink:"/migrating-azure-functions-node-js-v4-typescript"},nextItem:{title:"Docusaurus 3: how to migrate rehype plugins",permalink:"/docusaurus-3-how-to-migrate-rehype-plugins"}},c={image:n(54148).Z,authorsImageUrls:[void 0]},u=[{value:"A linked Azure Application Insights instance",id:"a-linked-azure-application-insights-instance",level:2},{value:"Bicep linking",id:"bicep-linking",level:2},{value:"Where would you get the values for the <code>hidden-link</code> tags?",id:"where-would-you-get-the-values-for-the-hidden-link-tags",level:2},{value:"Summary",id:"summary",level:2}],h={toc:u},g="wrapper";function d(e){var{components:t}=e,p=o(e,["components"]);return(0,i.kt)(g,r(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){a(e,t,n[t])}))}return e}({},h,p),{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"If you're looking into a Production issue with your Azure Static Web App, you'll want to be able to get to your logs as fast as possible. You can do this by linking your Static Web App to an Azure Application Insights instance. If you've used the Azure Portal to create your Static Web App, the setup phase will likely have done this for you already. But if you're using Bicep to create your Static Web App, you'll need to do this yourself."),(0,i.kt)("p",null,"This post will show you how to do that using Bicep."),(0,i.kt)("p",null,(0,i.kt)("img",{loading:"eager",fetchpriority:"high",alt:"title image reading &quot;Link Azure Application Insights to Static Web Apps with Bicep&quot; with the Bicep and Azure Static Web App logos",src:n(54148).Z,width:"800",height:"450"})),(0,i.kt)("h2",{id:"a-linked-azure-application-insights-instance"},"A linked Azure Application Insights instance"),(0,i.kt)("p",null,"What we want to achieve can be summmed up by this screenshot:"),(0,i.kt)("p",null,(0,i.kt)("img",{loading:"lazy",alt:"screenshot of the Azure Portal displaying the App Insights tab of a Static Web App, with a linked App Insights in view",src:n(115).Z,width:"919",height:"464"})),(0,i.kt)("p",null,"Inside the Azure Portal, inside our Static Web App, we want to see the App Insights tab and we want to see a linked App Insights instance. We do. But how?"),(0,i.kt)("h2",{id:"bicep-linking"},"Bicep linking"),(0,i.kt)("p",null,"The Bicep code to achieve this is pretty simple:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bicep",metastring:'title="static-web-app.bicep"',title:'"static-web-app.bicep"'},"var tagsWithHiddenLinks = union({\n  'hidden-link: /app-insights-resource-id': appInsightsId\n  'hidden-link: /app-insights-instrumentation-key': appInsightsInstrumentationKey\n  'hidden-link: /app-insights-conn-string': appInsightsConnectionString\n}, tags)\n\nresource staticWebApp 'Microsoft.Web/staticSites@2022-09-01' = {\n  name: staticWebAppName\n  location: location\n  tags: tagsWithHiddenLinks // <--- here\n  sku: {\n    name: 'Free'\n    tier: 'Free'\n  }\n  properties: {\n    repositoryUrl: 'https://github.com/johnnyreilly/blog.johnnyreilly.com'\n    repositoryToken: repositoryToken\n    branch: branch\n    provider: 'GitHub'\n    stagingEnvironmentPolicy: 'Enabled'\n    allowConfigFileUpdates: true\n    buildProperties:{\n      skipGithubActionWorkflowGeneration: true\n    }\n  }\n}\n")),(0,i.kt)("p",null,"Consider the code above; it's a fairly standard Bicep resource declaration for a Static Web App. The only difference is the ",(0,i.kt)("inlineCode",{parentName:"p"},"tags")," property. We're using the ",(0,i.kt)("inlineCode",{parentName:"p"},"union")," function to add three additional tags to the ",(0,i.kt)("inlineCode",{parentName:"p"},"tags")," property that has been passed into the ",(0,i.kt)("inlineCode",{parentName:"p"},"static-web-app.bicep")," module. These tags are the ",(0,i.kt)("inlineCode",{parentName:"p"},"hidden-link")," tags that link the Static Web App to the App Insights instance."),(0,i.kt)("p",null,"Luke Murray has a great post on ",(0,i.kt)("a",{parentName:"p",href:"https://luke.geek.nz/azure/hidden-tags-in-azure/"},(0,i.kt)("inlineCode",{parentName:"a"},"hidden-")," tags in Azure")," that I recommend you read if you want to know more about them. Essentially, hidden tags are tags that don't show up in the Azure Portal and have some metadata purpose. ",(0,i.kt)("inlineCode",{parentName:"p"},"hidden-link")," tags are a subset of those that are used to link resources together."),(0,i.kt)("h2",{id:"where-would-you-get-the-values-for-the-hidden-link-tags"},"Where would you get the values for the ",(0,i.kt)("inlineCode",{parentName:"h2"},"hidden-link")," tags?"),(0,i.kt)("p",null,"In the case of the ",(0,i.kt)("inlineCode",{parentName:"p"},"hidden-link")," tags we're using here, we need to know the ",(0,i.kt)("inlineCode",{parentName:"p"},"id"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"InstrumentationKey")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"ConnectionString")," of the App Insights instance we want to link to. We can get these values from the App Insights instance itself. Because of the way Bicep works, it's necessary to get those in a parent module to the Static Web App module. Here's an example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bicep"},"resource appInsightsResource 'Microsoft.Insights/components@2020-02-02' existing = {\n  name: appInsightsName\n}\n\nmodule staticWebApp './static-web-app.bicep' = {\n  name: '${deployment().name}-staticWebApp'\n  params: {\n    // ...\n    appInsightsId: appInsightsResource.id\n    appInsightsConnectionString: appInsightsResource.properties.ConnectionString\n    appInsightsInstrumentationKey: appInsightsResource.properties.InstrumentationKey\n    // ...\n  }\n}\n")),(0,i.kt)("h2",{id:"summary"},"Summary"),(0,i.kt)("p",null,"With this is place we have the linking we need to get to our logs quickly as we navigate around inside the Azure Portal. And we have it in place in a way that's repeatable and consistent. I hope you find this useful."))}d.isMDXComponent=!0},115:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/screenshot-azure-portal-open-in-application-insights-3bebf715a5d08241d7e350bb8915b347.png"},54148:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/title-image-bd6790656cd89e64fd25edbe986a6759.png"}}]);