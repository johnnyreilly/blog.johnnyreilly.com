<!doctype html><html lang=en dir=ltr class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.7.0"><title data-rh=true>Migrating to v4 Azure Functions Node.js with TypeScript | johnnyreilly</title><meta data-rh=true name=viewport content="width=device-width, initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:url content=https://johnnyreilly.com/migrating-azure-functions-node-js-v4-typescript><meta data-rh=true property=og:locale content=en><meta data-rh=true name=docusaurus_locale content=en><meta data-rh=true name=docusaurus_tag content=default><meta data-rh=true name=docsearch:language content=en><meta data-rh=true name=docsearch:docusaurus_tag content=default><meta data-rh=true name=robots content=max-image-preview:large><meta data-rh=true name=monetization content=$ilp.uphold.com/LwQQhXdpwxeJ><meta data-rh=true property=og:title content="Migrating to v4 Azure Functions Node.js with TypeScript | johnnyreilly"><meta data-rh=true name=description content="Learn how to migrate a TypeScript Azure Functions app to the v4 Node.js programming model."><meta data-rh=true property=og:description content="Learn how to migrate a TypeScript Azure Functions app to the v4 Node.js programming model."><meta data-rh=true property=og:image content=https://johnnyreilly.com/assets/images/title-image-e16bb3c85ded7aa934b9ef8a41a2541a.png><meta data-rh=true name=twitter:image content=https://johnnyreilly.com/assets/images/title-image-e16bb3c85ded7aa934b9ef8a41a2541a.png><meta data-rh=true property=og:type content=article><meta data-rh=true property=article:published_time content=2023-10-24T00:00:00.000Z><meta data-rh=true property=article:author content=https://johnnyreilly.com/about><meta data-rh=true property=article:tag content="TypeScript,Azure,Azure Functions,Azure Static Web Apps"><link data-rh=true rel=icon href=/favicon.ico><link data-rh=true rel=canonical href=https://johnnyreilly.com/migrating-azure-functions-node-js-v4-typescript><link data-rh=true rel=alternate href=https://johnnyreilly.com/migrating-azure-functions-node-js-v4-typescript hreflang=en><link data-rh=true rel=alternate href=https://johnnyreilly.com/migrating-azure-functions-node-js-v4-typescript hreflang=x-default><link data-rh=true rel=preconnect href=https://J3MYR1INLT-dsn.algolia.net crossorigin=anonymous><script data-rh=true type=application/ld+json>{"@context":"https://schema.org","@id":"https://johnnyreilly.com/migrating-azure-functions-node-js-v4-typescript","@type":"BlogPosting","author":{"@type":"Person","description":"OSS Engineer - TypeScript, Azure, React, Node.js, .NET","image":"https://johnnyreilly.com/img/profile.jpg","name":"John Reilly","url":"https://johnnyreilly.com/about"},"datePublished":"2023-10-24T00:00:00.000Z","description":"Learn how to migrate a TypeScript Azure Functions app to the v4 Node.js programming model.","headline":"Migrating to v4 Azure Functions Node.js with TypeScript","image":{"@id":"https://johnnyreilly.com/assets/images/title-image-e16bb3c85ded7aa934b9ef8a41a2541a.png","@type":"ImageObject","caption":"title image for the blog post: Migrating to v4 Azure Functions Node.js with TypeScript","contentUrl":"https://johnnyreilly.com/assets/images/title-image-e16bb3c85ded7aa934b9ef8a41a2541a.png","url":"https://johnnyreilly.com/assets/images/title-image-e16bb3c85ded7aa934b9ef8a41a2541a.png"},"isPartOf":{"@id":"https://johnnyreilly.com/","@type":"Blog","name":"I CAN MAKE THIS WORK"},"keywords":[],"mainEntityOfPage":"https://johnnyreilly.com/migrating-azure-functions-node-js-v4-typescript","name":"Migrating to v4 Azure Functions Node.js with TypeScript","url":"https://johnnyreilly.com/migrating-azure-functions-node-js-v4-typescript"}</script><link rel=alternate type=application/rss+xml href=/rss.xml title="I CAN MAKE THIS WORK RSS Feed"><link rel=alternate type=application/atom+xml href=/atom.xml title="I CAN MAKE THIS WORK Atom Feed"><link rel=search type=application/opensearchdescription+xml title=johnnyreilly href=/opensearch.xml><link rel=icon href=/img/profile-64x64.jpg><link rel=manifest href=/manifest.json><meta name=theme-color content=#3578e5><meta name=apple-mobile-web-app-capable content=yes><meta name=apple-mobile-web-app-status-bar-style content=#000><link rel=apple-touch-icon href=/apple-touch-icon.png><link rel=preload href=https://johnnyreilly.com/fonts/Poppins-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=https://johnnyreilly.com/fonts/Poppins-Bold.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preconnect href=https://res.cloudinary.com><link rel=monetization href=https://ilp.uphold.com/LwQQhXdpwxeJ><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@id":"https://johnnyreilly.com","@type":"WebSite","copyrightHolder":{"@id":"https://johnnyreilly.com/about"},"description":"This is John Reilly's blog. John is an Open Source Software Engineer working on TypeScript, Azure, React, Node.js, .NET and more.","inLanguage":"en-UK","name":"johnnyreilly","potentialAction":{"@type":"SearchAction","query-input":"required name=search_term_string","target":{"@type":"EntryPoint","urlTemplate":"https://johnnyreilly.com/search?q={search_term_string}"}},"publisher":{"@id":"https://johnnyreilly.com/about"},"url":"https://johnnyreilly.com"},{"@id":"https://johnnyreilly.com/about","@type":"Person","address":{"@type":"PostalAddress","addressCountry":"United Kingdom","addressLocality":"London","streetAddress":"Twickenham"},"alternateName":"Johnny Reilly","birthPlace":"Bristol","description":"John is an Open Source Software Engineer working on TypeScript, Azure, React, Node.js, .NET and more. As well as writing code, John is a speaker at meetups, one of the founders of the TS Congress conference, and the author of the history of Definitely Typed, which he worked on in the early days of TypeScript.","email":"johnny_reilly@hotmail.com","image":{"@id":"https://johnnyreilly.com/about#image","@type":"ImageObject","caption":"John Reilly","contentUrl":"https://johnnyreilly.com/img/profile.jpg","height":200,"inLanguage":"en-UK","url":"https://johnnyreilly.com/img/profile.jpg","width":200},"name":"John Reilly","sameAs":["https://github.com/johnnyreilly","https://fosstodon.org/@johnny_reilly","https://twitter.com/johnny_reilly","https://bsky.app/profile/johnnyreilly.com","https://dev.to/johnnyreilly","https://app.daily.dev/johnnyreilly","https://stackoverflow.com/users/761388/john-reilly","https://blog.logrocket.com/author/johnreilly/","https://www.reddit.com/user/johnny_reilly","https://uk.linkedin.com/in/johnnyreilly"],"url":"https://johnnyreilly.com"},{"@id":"https://johnnyreilly.com/about#organization","@type":["Organization","Brand"],"description":"This is John Reilly's blog. John is an Open Source Software Engineer working on TypeScript, Azure, React, Node.js, .NET and more.","image":{"@id":"https://johnnyreilly.com/#logo"},"logo":{"@id":"https://johnnyreilly.com/#logo","@type":"ImageObject","caption":"John Reilly","contentUrl":"https://johnnyreilly.com/img/profile.jpg","height":200,"inLanguage":"en-UK","url":"https://johnnyreilly.com/img/profile.jpg","width":200},"name":"johnnyreilly","sameAs":["https://github.com/johnnyreilly","https://fosstodon.org/@johnny_reilly","https://twitter.com/johnny_reilly","https://bsky.app/profile/johnnyreilly.com","https://dev.to/johnnyreilly","https://app.daily.dev/johnnyreilly","https://stackoverflow.com/users/761388/john-reilly","https://blog.logrocket.com/author/johnreilly/","https://www.reddit.com/user/johnny_reilly","https://uk.linkedin.com/in/johnnyreilly"],"url":"https://johnnyreilly.com"}]}</script><link rel=webmention href=https://webmention.io/johnnyreilly.com/webmention><link rel=stylesheet href=/assets/css/styles.172d8ff3.css><script src=/assets/js/runtime~main.346d6426.js defer></script><script src=/assets/js/main.a7c49b72.js defer></script><body class=navigation-with-keyboard><script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:"light",document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><link rel=preload as=image href=/img/profile-64x64.jpg><link rel=preload as=image href=https://johnnyreilly.com/img/profile.jpg><link rel=preload as=image href=/assets/images/title-image-e16bb3c85ded7aa934b9ef8a41a2541a.png><script type=application/ld+json>[{"@context":"https://schema.org","@id":"/migrating-azure-functions-node-js-v4-typescript#breadcrumb","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://johnnyreilly.com","name":"Home","position":1},{"@type":"ListItem","item":"https://johnnyreilly.com/blog","name":"Blog","position":2},{"@type":"ListItem","name":"Migrating to v4 Azure Functions Node.js with TypeScript","position":3}],"name":"Blog breadcrumb"}]</script><div role=region aria-label="Skip to main content"><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="navbar navbar--fixed-top"><div class=navbar__inner><div class=navbar__items><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><div class=navbar__logo><img src=/img/profile-64x64.jpg alt="Profile picture of John Reilly" class="themedComponent_mlkZ themedComponent--light_NVdE" height=32 width=32><img src=/img/profile-64x64.jpg alt="Profile picture of John Reilly" class="themedComponent_mlkZ themedComponent--dark_xIcU" height=32 width=32></div><b class="navbar__title text--truncate">John Reilly</b></a><a class="navbar__item navbar__link" href=/about>About</a><a class="navbar__item navbar__link" href=/blog>Blog</a><a class="navbar__item navbar__link" href=/talks>Talks</a></div><div class="navbar__items navbar__items--right"><a href=https://github.com/johnnyreilly target=_blank rel=me class="navbar__item navbar__link">GitHub<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><a href=https://bsky.app/profile/johnnyreilly.com target=_blank rel=me class="navbar__item navbar__link">Bluesky<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><a href=https://fosstodon.org/@johnny_reilly target=_blank rel=me class="navbar__item navbar__link">Mastodon<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><a href=https://twitter.com/johnny_reilly target=_blank rel=me class="navbar__item navbar__link">Twitter<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type=button disabled title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live=polite aria-pressed=false><svg viewBox="0 0 24 24" width=24 height=24 class=lightToggleIcon_pyhR><path fill=currentColor d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 class=darkToggleIcon_wfgR><path fill=currentColor d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"/></svg></button></div><div class=navbarSearchContainer_Bca1><button type=button class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 20 20" aria-hidden=true><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke=currentColor fill=none fill-rule=evenodd stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class=row><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><div role=group><h3 class=yearGroupHeading_rMGB>2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/microsoft-graphclient-filter-endswith-consistencylevel-eventual-header>Microsoft Graph client: how to filter by endswith</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/list-pipelines-with-azure-devops-api>List Pipelines with the Azure DevOps API</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/static-web-apps-cli-local-auth-emulator-with-dotnet-authentication>Static Web Apps CLI: local authentication emulation with ASP.NET</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/nodejs-azure-appinsights-fastify>Node.js, Azure Application Insights, and Fastify</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/get-service-connections-with-azure-devops-api>Get Service Connections with the Azure DevOps API (REST and TypeScript)</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/slash-command-your-deployment-with-github-actions>Slash command your deployment with GitHub Actions</a></ul></div><div role=group><h3 class=yearGroupHeading_rMGB>2024</h3><ul class="sidebarItemList_Yudw clean-list"><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/smuggling-gitignore-npmrc-in-npm-packages>Smuggling .gitignore, .npmrc and friends in npm packages</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/npx-and-azure-artifacts-the-secret-cli-delivery-mechanism>npx and Azure Artifacts: the secret CLI delivery mechanism</a></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class=title_f1Hy>Migrating to v4 Azure Functions Node.js with TypeScript</h1><div class="container_mt6G margin-vert--md"><time datetime=2023-10-24T00:00:00.000Z>October 24, 2023</time> · <!-- -->9 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href=https://johnnyreilly.com/about target=_blank rel="noopener noreferrer" class=avatar__photo-link><img class="avatar__photo authorImage_XqGP" src=https://johnnyreilly.com/img/profile.jpg alt="John Reilly"></a><div class="avatar__intro authorDetails_lV9A"><div class=avatar__name><a href=https://johnnyreilly.com/about target=_blank rel="noopener noreferrer"><span class=authorName_yefp>John Reilly</span></a></div><small class=authorTitle_nd0D title="OSS Engineer - TypeScript, Azure, React, Node.js, .NET">OSS Engineer - TypeScript, Azure, React, Node.js, .NET</small><div class=authorSocials_rSDt></div></div></div></div></div></header><div id=__blog-post-container class=markdown><p>There's a new programming model available for Node.js Azure Functions known as v4. There's documentation out there for <a href="https://learn.microsoft.com/en-us/azure/azure-functions/functions-node-upgrade-v4?tabs=v4" target=_blank rel="noopener noreferrer">how to migrate JavaScript Azure Functions from v3 to v4</a>, but at the time of writing, TypeScript wasn't covered.</p>
<p>This post fills in the gaps for a TypeScript Azure Function. It's probably worth mentioning that <a href=https://johnnyreilly.com target=_blank rel="noopener noreferrer">my blog</a> is an <a href=https://learn.microsoft.com/en-us/azure/static-web-apps/overview target=_blank rel="noopener noreferrer">Azure Static Web App</a> with a TypeScript Node.js Azure Functions back end. So, this post is based on my experience migrating my blog to v4.</p>
<p><img decoding=async loading=eager alt="title image reading &amp;quot;Link Azure Application Insights to Static Web Apps with Bicep&amp;quot; with the Bicep and Azure Static Web App logos" src=/assets/images/title-image-e16bb3c85ded7aa934b9ef8a41a2541a.png width=800 height=450 fetchpriority=high class=img_ev3q></p>
<p>I'm going to walk through the migration of my blog from v3 to v4. This takes place in <a href=https://github.com/johnnyreilly/blog.johnnyreilly.com/pull/728/files target=_blank rel="noopener noreferrer">this pull request</a>. I'll probably cover some of the ground of the offical JavaScript upgrade docs, but I'll also cover some of the TypeScript specific stuff.</p>
<p>There will be two main parts to this post:</p>
<ol>
<li>Changes to make to <code>package.json</code></li>
<li>Migrating a Function</li>
</ol>
<p>The second part will be the bulk of the post, but the first part is important too.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=1-changes-to-make-to-the-packagejson>1. Changes to make to the <code>package.json</code><a href=#1-changes-to-make-to-the-packagejson class=hash-link aria-label="Direct link to heading" title="Direct link to heading">​</a></h2>
<p>So, starting with the first part, there are three changes to make to the <code>package.json</code>:</p>
<div class="language-diff codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#9EFEFF;--prism-background-color:#2D2A55><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-diff codeBlock_bY9V thin-scrollbar" style=color:#9EFEFF;background-color:#2D2A55><code class=codeBlockLines_e6Vv><span class=token-line style=color:#9EFEFF><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"> "dependencies": {</span><br></span><span class=token-line style=color:#9EFEFF><span class="token unchanged line"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(173, 219, 103)">+</span><span class="token inserted-sign inserted line" style="color:rgb(173, 219, 103)">    "@azure/functions": "^4.0.1",</span><br></span><span class=token-line style=color:#9EFEFF><span class="token inserted-sign inserted line" style="color:rgb(173, 219, 103)"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"> },</span><br></span><span class=token-line style=color:#9EFEFF><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"> "devDependencies": {</span><br></span><span class=token-line style=color:#9EFEFF><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgba(239, 83, 80, 0.56)">-</span><span class="token deleted-sign deleted line" style="color:rgba(239, 83, 80, 0.56)">    "@azure/functions": "^3.5.0",</span><br></span><span class=token-line style=color:#9EFEFF><span class="token deleted-sign deleted line" style="color:rgba(239, 83, 80, 0.56)"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line"> },</span><br></span><span class=token-line style=color:#9EFEFF><span class="token unchanged line"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(173, 219, 103)">+</span><span class="token inserted-sign inserted line" style="color:rgb(173, 219, 103)">  "main": "dist/src/functions/*/index.js"</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<ol>
<li>Update the <code>@azure/functions</code> dependency to <code>^4.0.1</code> (or later)</li>
<li>The <code>@azure/functions</code> dev dependency becomes a regular dependency - this is because we'll be using the package at runtime now - previously we just used it to get the types at build time</li>
<li>Add a <code>main</code> property to the <code>package.json</code> with a glob that matches the functions in your project; in my case <code>dist/src/functions/*/index.js</code> - which will be our output from the TypeScript build</li>
</ol>
<p>As I took care of <strong>3.</strong>, I found myself changing the folder structure of my functions. Actually, this isn't mandatory, but it was tricky for me to come up with a glob for my current structure. So I moved things around - you may not need to. All that matters is that your glob matches the output of your build.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=2-migrating-a-function>2. Migrating a Function<a href=#2-migrating-a-function class=hash-link aria-label="Direct link to heading" title="Direct link to heading">​</a></h2>
<p>In order that we can understand what migration looks like, we must first take a look at the v3 version of a function. Here's the <code>fallback</code> function from my blog:</p>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#9EFEFF;--prism-background-color:#2D2A55><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style=color:#9EFEFF;background-color:#2D2A55><code class=codeBlockLines_e6Vv><span class=token-line style=color:#9EFEFF><span class="token keyword" style="color:rgb(255, 157, 0)">import</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(255, 157, 0)">type</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token plain"> AzureFunction</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"> Context</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"> HttpRequest </span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(255, 157, 0)">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">'@azure/functions'</span><span class="token punctuation" style="color:rgb(255, 255, 255)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain"></span><span class="token keyword" style="color:rgb(255, 157, 0)">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token plain"> redirect </span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(255, 157, 0)">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">'./redirect'</span><span class="token punctuation" style="color:rgb(255, 255, 255)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain"></span><span class="token keyword" style="color:rgb(255, 157, 0)">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token plain"> saveToDatabase </span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(255, 157, 0)">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">'./saveToDatabase'</span><span class="token punctuation" style="color:rgb(255, 255, 255)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain"></span><span class="token keyword" style="color:rgb(255, 157, 0)">const</span><span class="token plain"> httpTrigger</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token function-variable function" style="color:rgb(250, 208, 0)">AzureFunction</span><span class="token plain"> </span><span class="token operator" style="color:rgb(255, 157, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(255, 157, 0)">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(255, 157, 0)">function</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">  context</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> Context</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">  req</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> HttpRequest</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain"></span><span class="token punctuation" style="color:rgb(255, 255, 255)">)</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(250, 208, 0)">Promise</span><span class="token operator" style="color:rgb(255, 157, 0)">&lt;</span><span class="token keyword" style="color:rgb(255, 157, 0)">void</span><span class="token operator" style="color:rgb(255, 157, 0)">></span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">  </span><span class="token keyword" style="color:rgb(255, 157, 0)">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">    </span><span class="token keyword" style="color:rgb(255, 157, 0)">const</span><span class="token plain"> originalUrl </span><span class="token operator" style="color:rgb(255, 157, 0)">=</span><span class="token plain"> req</span><span class="token punctuation" style="color:rgb(255, 255, 255)">.</span><span class="token plain">headers</span><span class="token punctuation" style="color:rgb(255, 255, 255)">[</span><span class="token string" style="color:rgb(165, 255, 144)">'x-ms-original-url'</span><span class="token punctuation" style="color:rgb(255, 255, 255)">]</span><span class="token punctuation" style="color:rgb(255, 255, 255)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">    </span><span class="token keyword" style="color:rgb(255, 157, 0)">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token plain"> status</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"> location </span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(255, 157, 0)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(250, 208, 0)">redirect</span><span class="token punctuation" style="color:rgb(255, 255, 255)">(</span><span class="token plain">originalUrl</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"> context</span><span class="token punctuation" style="color:rgb(255, 255, 255)">.</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(255, 255, 255)">)</span><span class="token punctuation" style="color:rgb(255, 255, 255)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">    </span><span class="token keyword" style="color:rgb(255, 157, 0)">await</span><span class="token plain"> </span><span class="token function" style="color:rgb(250, 208, 0)">saveToDatabase</span><span class="token punctuation" style="color:rgb(255, 255, 255)">(</span><span class="token plain">originalUrl</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token plain"> status</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"> location </span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"> context</span><span class="token punctuation" style="color:rgb(255, 255, 255)">.</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(255, 255, 255)">)</span><span class="token punctuation" style="color:rgb(255, 255, 255)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">    context</span><span class="token punctuation" style="color:rgb(255, 255, 255)">.</span><span class="token plain">res </span><span class="token operator" style="color:rgb(255, 157, 0)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">      status</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">      headers</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">        location</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">      </span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">    </span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><span class="token punctuation" style="color:rgb(255, 255, 255)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">  </span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(255, 157, 0)">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">(</span><span class="token plain">error</span><span class="token punctuation" style="color:rgb(255, 255, 255)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">    context</span><span class="token punctuation" style="color:rgb(255, 255, 255)">.</span><span class="token plain">log</span><span class="token punctuation" style="color:rgb(255, 255, 255)">.</span><span class="token function" style="color:rgb(250, 208, 0)">error</span><span class="token punctuation" style="color:rgb(255, 255, 255)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">      </span><span class="token string" style="color:rgb(165, 255, 144)">'Problem with fallback'</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">      error</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">      req</span><span class="token punctuation" style="color:rgb(255, 255, 255)">.</span><span class="token plain">headers</span><span class="token punctuation" style="color:rgb(255, 255, 255)">[</span><span class="token string" style="color:rgb(165, 255, 144)">'x-ms-original-url'</span><span class="token punctuation" style="color:rgb(255, 255, 255)">]</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">    </span><span class="token punctuation" style="color:rgb(255, 255, 255)">)</span><span class="token punctuation" style="color:rgb(255, 255, 255)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">  </span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain"></span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><span class="token punctuation" style="color:rgb(255, 255, 255)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain"></span><span class="token keyword" style="color:rgb(255, 157, 0)">export</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(255, 157, 0)">default</span><span class="token plain"> httpTrigger</span><span class="token punctuation" style="color:rgb(255, 255, 255)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>The above is the code I use to power <a href=/azure-static-web-apps-dynamic-redirects-azure-functions>dynamic redirects in my Azure Static Web App with the Azure Function back-end</a>. It's a TypeScript Azure Function that takes a request, redirects to a new location and saves metadata about the redirect to a database.</p>
<p>Looking at the code now, I rather think I should have called the function <code>redirect</code> rather than <code>fallback</code>. I'll leave it as is for now, but I'll probably change it in the future.</p>
<p>What the <code>fallback</code> function does isn't significant for this post, but the structure is. Now let's look at the migrated version:</p>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#9EFEFF;--prism-background-color:#2D2A55><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style=color:#9EFEFF;background-color:#2D2A55><code class=codeBlockLines_e6Vv><span class=token-line style=color:#9EFEFF><span class="token keyword" style="color:rgb(255, 157, 0)">import</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(255, 157, 0)">type</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">  HttpRequest</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">  HttpResponseInit</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">  InvocationContext</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain"></span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(255, 157, 0)">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">'@azure/functions'</span><span class="token punctuation" style="color:rgb(255, 255, 255)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain"></span><span class="token keyword" style="color:rgb(255, 157, 0)">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token plain"> app </span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(255, 157, 0)">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">'@azure/functions'</span><span class="token punctuation" style="color:rgb(255, 255, 255)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain"></span><span class="token keyword" style="color:rgb(255, 157, 0)">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token plain"> redirect </span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(255, 157, 0)">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">'./redirect'</span><span class="token punctuation" style="color:rgb(255, 255, 255)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain"></span><span class="token keyword" style="color:rgb(255, 157, 0)">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token plain"> saveToDatabase </span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(255, 157, 0)">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">'./saveToDatabase'</span><span class="token punctuation" style="color:rgb(255, 255, 255)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain"></span><span class="token keyword" style="color:rgb(255, 157, 0)">export</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(255, 157, 0)">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(255, 157, 0)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(250, 208, 0)">fallback</span><span class="token punctuation" style="color:rgb(255, 255, 255)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">  request</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> HttpRequest</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">  context</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> InvocationContext</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain"></span><span class="token punctuation" style="color:rgb(255, 255, 255)">)</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(250, 208, 0)">Promise</span><span class="token operator" style="color:rgb(255, 157, 0)">&lt;</span><span class="token plain">HttpResponseInit</span><span class="token operator" style="color:rgb(255, 157, 0)">></span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">  </span><span class="token keyword" style="color:rgb(255, 157, 0)">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">    </span><span class="token keyword" style="color:rgb(255, 157, 0)">const</span><span class="token plain"> originalUrl </span><span class="token operator" style="color:rgb(255, 157, 0)">=</span><span class="token plain"> request</span><span class="token punctuation" style="color:rgb(255, 255, 255)">.</span><span class="token plain">headers</span><span class="token punctuation" style="color:rgb(255, 255, 255)">.</span><span class="token function" style="color:rgb(250, 208, 0)">get</span><span class="token punctuation" style="color:rgb(255, 255, 255)">(</span><span class="token string" style="color:rgb(165, 255, 144)">'x-ms-original-url'</span><span class="token punctuation" style="color:rgb(255, 255, 255)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(255, 157, 0)">||</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">''</span><span class="token punctuation" style="color:rgb(255, 255, 255)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">    </span><span class="token keyword" style="color:rgb(255, 157, 0)">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token plain"> status</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"> location </span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(255, 157, 0)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(250, 208, 0)">redirect</span><span class="token punctuation" style="color:rgb(255, 255, 255)">(</span><span class="token plain">originalUrl</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"> context</span><span class="token punctuation" style="color:rgb(255, 255, 255)">)</span><span class="token punctuation" style="color:rgb(255, 255, 255)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">    </span><span class="token keyword" style="color:rgb(255, 157, 0)">await</span><span class="token plain"> </span><span class="token function" style="color:rgb(250, 208, 0)">saveToDatabase</span><span class="token punctuation" style="color:rgb(255, 255, 255)">(</span><span class="token plain">originalUrl</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token plain"> status</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"> location </span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"> context</span><span class="token punctuation" style="color:rgb(255, 255, 255)">)</span><span class="token punctuation" style="color:rgb(255, 255, 255)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">    </span><span class="token keyword" style="color:rgb(255, 157, 0)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">      status</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">      headers</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">        location</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">      </span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">    </span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><span class="token punctuation" style="color:rgb(255, 255, 255)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">  </span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(255, 157, 0)">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">(</span><span class="token plain">error</span><span class="token punctuation" style="color:rgb(255, 255, 255)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">    context</span><span class="token punctuation" style="color:rgb(255, 255, 255)">.</span><span class="token function" style="color:rgb(250, 208, 0)">error</span><span class="token punctuation" style="color:rgb(255, 255, 255)">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">      </span><span class="token string" style="color:rgb(165, 255, 144)">'Problem with fallback'</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">      error</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">      request</span><span class="token punctuation" style="color:rgb(255, 255, 255)">.</span><span class="token plain">headers</span><span class="token punctuation" style="color:rgb(255, 255, 255)">.</span><span class="token function" style="color:rgb(250, 208, 0)">get</span><span class="token punctuation" style="color:rgb(255, 255, 255)">(</span><span class="token string" style="color:rgb(165, 255, 144)">'x-ms-original-url'</span><span class="token punctuation" style="color:rgb(255, 255, 255)">)</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">    </span><span class="token punctuation" style="color:rgb(255, 255, 255)">)</span><span class="token punctuation" style="color:rgb(255, 255, 255)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">    </span><span class="token keyword" style="color:rgb(255, 157, 0)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">      status</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(255, 98, 140)">500</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">      body</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">'something went wrong'</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">    </span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><span class="token punctuation" style="color:rgb(255, 255, 255)">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">  </span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain"></span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">app</span><span class="token punctuation" style="color:rgb(255, 255, 255)">.</span><span class="token function" style="color:rgb(250, 208, 0)">http</span><span class="token punctuation" style="color:rgb(255, 255, 255)">(</span><span class="token string" style="color:rgb(165, 255, 144)">'fallback'</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">  methods</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">[</span><span class="token string" style="color:rgb(165, 255, 144)">'GET'</span><span class="token punctuation" style="color:rgb(255, 255, 255)">]</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">  handler</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> fallback</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain"></span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><span class="token punctuation" style="color:rgb(255, 255, 255)">)</span><span class="token punctuation" style="color:rgb(255, 255, 255)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>As we can see, the logic looks pretty much the same. But a lot has changed. What's different? We'll go through the changes one by one.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=imports-used><code>import</code>s used<a href=#imports-used class=hash-link aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<p>Starting at the top, the <code>import</code>s we use are different:</p>
<div class="language-diff codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#9EFEFF;--prism-background-color:#2D2A55><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-diff codeBlock_bY9V thin-scrollbar" style=color:#9EFEFF;background-color:#2D2A55><code class=codeBlockLines_e6Vv><span class=token-line style=color:#9EFEFF><span class="token deleted-sign deleted prefix deleted" style="color:rgba(239, 83, 80, 0.56)">-</span><span class="token deleted-sign deleted line" style="color:rgba(239, 83, 80, 0.56)">import type { AzureFunction, Context, HttpRequest } from '@azure/functions';</span><br></span><span class=token-line style=color:#9EFEFF><span class="token deleted-sign deleted line" style="color:rgba(239, 83, 80, 0.56)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(173, 219, 103)">+</span><span class="token inserted-sign inserted line" style="color:rgb(173, 219, 103)">import type {</span><br></span><span class=token-line style=color:#9EFEFF><span class="token inserted-sign inserted line" style="color:rgb(173, 219, 103)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(173, 219, 103)">+</span><span class="token inserted-sign inserted line" style="color:rgb(173, 219, 103)">  HttpRequest,</span><br></span><span class=token-line style=color:#9EFEFF><span class="token inserted-sign inserted line" style="color:rgb(173, 219, 103)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(173, 219, 103)">+</span><span class="token inserted-sign inserted line" style="color:rgb(173, 219, 103)">  HttpResponseInit,</span><br></span><span class=token-line style=color:#9EFEFF><span class="token inserted-sign inserted line" style="color:rgb(173, 219, 103)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(173, 219, 103)">+</span><span class="token inserted-sign inserted line" style="color:rgb(173, 219, 103)">  InvocationContext,</span><br></span><span class=token-line style=color:#9EFEFF><span class="token inserted-sign inserted line" style="color:rgb(173, 219, 103)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(173, 219, 103)">+</span><span class="token inserted-sign inserted line" style="color:rgb(173, 219, 103)">} from '@azure/functions';</span><br></span><span class=token-line style=color:#9EFEFF><span class="token inserted-sign inserted line" style="color:rgb(173, 219, 103)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(173, 219, 103)">+</span><span class="token inserted-sign inserted line" style="color:rgb(173, 219, 103)">import { app } from '@azure/functions';</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>We're no longer just importing types, we're importing the <code>app</code> function from <code>@azure/functions</code> also. The types that are being imported are different too. We're no longer importing <code>AzureFunction, Context, HttpRequest</code> - instead we're importing <code>HttpRequest, HttpResponseInit,  InvocationContext</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=hello-app-goodbye-functionjson>Hello <code>app</code>, goodbye <code>function.json</code><a href=#hello-app-goodbye-functionjson class=hash-link aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<p>As we saw, we're making use of the <code>app</code> function from <code>@azure/functions</code>. This is a new function that we use to register our Azure Functions. We no longer use <code>function.json</code>. Instead we use <code>app</code>. In the case of my <code>fallback</code> Azure Functions, we register it like this:</p>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#9EFEFF;--prism-background-color:#2D2A55><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style=color:#9EFEFF;background-color:#2D2A55><code class=codeBlockLines_e6Vv><span class=token-line style=color:#9EFEFF><span class="token plain">app</span><span class="token punctuation" style="color:rgb(255, 255, 255)">.</span><span class="token function" style="color:rgb(250, 208, 0)">http</span><span class="token punctuation" style="color:rgb(255, 255, 255)">(</span><span class="token string" style="color:rgb(165, 255, 144)">'fallback'</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">  methods</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">[</span><span class="token string" style="color:rgb(165, 255, 144)">'GET'</span><span class="token punctuation" style="color:rgb(255, 255, 255)">]</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">  handler</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> fallback</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain"></span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><span class="token punctuation" style="color:rgb(255, 255, 255)">)</span><span class="token punctuation" style="color:rgb(255, 255, 255)">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>We're registering an HTTP trigger called <code>fallback</code> that responds to <code>GET</code> requests. The <code>handler</code> is the function that will be called when the trigger is invoked. There's more options available, but this is the minimum we need to register our function.</p>
<p>This minimal TypeScript/JavaScript replaces the more verbose <code>function.json</code> that used to sit alongside:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#9EFEFF;--prism-background-color:#2D2A55><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-json codeBlock_bY9V thin-scrollbar" style=color:#9EFEFF;background-color:#2D2A55><code class=codeBlockLines_e6Vv><span class=token-line style=color:#9EFEFF><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">  </span><span class="token property" style="color:rgb(255, 157, 0)">"bindings"</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">[</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">    </span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">      </span><span class="token property" style="color:rgb(255, 157, 0)">"authLevel"</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">"anonymous"</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">      </span><span class="token property" style="color:rgb(255, 157, 0)">"type"</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">"httpTrigger"</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">      </span><span class="token property" style="color:rgb(255, 157, 0)">"direction"</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">"in"</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">      </span><span class="token property" style="color:rgb(255, 157, 0)">"name"</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">"req"</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">      </span><span class="token property" style="color:rgb(255, 157, 0)">"methods"</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">[</span><span class="token string" style="color:rgb(165, 255, 144)">"get"</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">"post"</span><span class="token punctuation" style="color:rgb(255, 255, 255)">]</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">    </span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">    </span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">      </span><span class="token property" style="color:rgb(255, 157, 0)">"type"</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">"http"</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">      </span><span class="token property" style="color:rgb(255, 157, 0)">"direction"</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">"out"</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">      </span><span class="token property" style="color:rgb(255, 157, 0)">"name"</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">"res"</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">    </span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">  </span><span class="token punctuation" style="color:rgb(255, 255, 255)">]</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">  </span><span class="token property" style="color:rgb(255, 157, 0)">"scriptFile"</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">"../dist/fallback/index.js"</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain"></span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>All of this is gone, replaced by the <code>app</code> function usage. There's one part of the <code>function.json</code> that isn't covered by the <code>app</code> function, and that's the <code>scriptFile</code> property. This is covered by the <code>main</code> property we added to the <code>package.json</code> earlier.</p>
<p>The rest of the <code>function.json</code> is covered by the <code>app.http</code> call. Much terser.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=signature-and-types-of-our-function>Signature and types of our <code>function</code><a href=#signature-and-types-of-our-function class=hash-link aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<p>The signature of our function has changed too:</p>
<div class="language-diff codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#9EFEFF;--prism-background-color:#2D2A55><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-diff codeBlock_bY9V thin-scrollbar" style=color:#9EFEFF;background-color:#2D2A55><code class=codeBlockLines_e6Vv><span class=token-line style=color:#9EFEFF><span class="token deleted-sign deleted prefix deleted" style="color:rgba(239, 83, 80, 0.56)">-</span><span class="token deleted-sign deleted line" style="color:rgba(239, 83, 80, 0.56)">const httpTrigger: AzureFunction = async function (</span><br></span><span class=token-line style=color:#9EFEFF><span class="token deleted-sign deleted line" style="color:rgba(239, 83, 80, 0.56)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgba(239, 83, 80, 0.56)">-</span><span class="token deleted-sign deleted line" style="color:rgba(239, 83, 80, 0.56)">  context: Context,</span><br></span><span class=token-line style=color:#9EFEFF><span class="token deleted-sign deleted line" style="color:rgba(239, 83, 80, 0.56)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgba(239, 83, 80, 0.56)">-</span><span class="token deleted-sign deleted line" style="color:rgba(239, 83, 80, 0.56)">  req: HttpRequest</span><br></span><span class=token-line style=color:#9EFEFF><span class="token deleted-sign deleted line" style="color:rgba(239, 83, 80, 0.56)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgba(239, 83, 80, 0.56)">-</span><span class="token deleted-sign deleted line" style="color:rgba(239, 83, 80, 0.56)">): Promise&lt;void> {</span><br></span><span class=token-line style=color:#9EFEFF><span class="token deleted-sign deleted line" style="color:rgba(239, 83, 80, 0.56)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(173, 219, 103)">+</span><span class="token inserted-sign inserted line" style="color:rgb(173, 219, 103)">export async function fallback(</span><br></span><span class=token-line style=color:#9EFEFF><span class="token inserted-sign inserted line" style="color:rgb(173, 219, 103)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(173, 219, 103)">+</span><span class="token inserted-sign inserted line" style="color:rgb(173, 219, 103)">  request: HttpRequest,</span><br></span><span class=token-line style=color:#9EFEFF><span class="token inserted-sign inserted line" style="color:rgb(173, 219, 103)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(173, 219, 103)">+</span><span class="token inserted-sign inserted line" style="color:rgb(173, 219, 103)">  context: InvocationContext,</span><br></span><span class=token-line style=color:#9EFEFF><span class="token inserted-sign inserted line" style="color:rgb(173, 219, 103)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(173, 219, 103)">+</span><span class="token inserted-sign inserted line" style="color:rgb(173, 219, 103)">): Promise&lt;HttpResponseInit> {</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>You'll see here that we're using a function declaration rather than a function expression. Our new function takes our new types, the subtly different <code>HttpRequest</code> and <code>InvocationContext</code>, which are similar to, but different from, the previous <code>Context</code> and <code>HttpRequest</code> types. The order of these parameters has changed also.</p>
<p>The return type of the function is now <code>Promise&lt;HttpResponseInit></code> rather than <code>Promise&lt;void></code>. What this means is, we're going to return values from our function, which we didn't do previously. Let's look at the implications of this.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=from-contextres-to-promisehttpresponseinit>From <code>context.res</code> to <code>Promise&lt;HttpResponseInit></code><a href=#from-contextres-to-promisehttpresponseinit class=hash-link aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<p>With a v3 function, we'd set the <code>context.res</code> property to return values from our function. With a v4 function, we return values from our function directly. What does this look like?</p>
<div class="language-diff codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#9EFEFF;--prism-background-color:#2D2A55><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-diff codeBlock_bY9V thin-scrollbar" style=color:#9EFEFF;background-color:#2D2A55><code class=codeBlockLines_e6Vv><span class=token-line style=color:#9EFEFF><span class="token deleted-sign deleted prefix deleted" style="color:rgba(239, 83, 80, 0.56)">-</span><span class="token deleted-sign deleted line" style="color:rgba(239, 83, 80, 0.56)">    context.res = {</span><br></span><span class=token-line style=color:#9EFEFF><span class="token deleted-sign deleted line" style="color:rgba(239, 83, 80, 0.56)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgba(239, 83, 80, 0.56)">-</span><span class="token deleted-sign deleted line" style="color:rgba(239, 83, 80, 0.56)">      status,</span><br></span><span class=token-line style=color:#9EFEFF><span class="token deleted-sign deleted line" style="color:rgba(239, 83, 80, 0.56)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgba(239, 83, 80, 0.56)">-</span><span class="token deleted-sign deleted line" style="color:rgba(239, 83, 80, 0.56)">      headers: {</span><br></span><span class=token-line style=color:#9EFEFF><span class="token deleted-sign deleted line" style="color:rgba(239, 83, 80, 0.56)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgba(239, 83, 80, 0.56)">-</span><span class="token deleted-sign deleted line" style="color:rgba(239, 83, 80, 0.56)">        location,</span><br></span><span class=token-line style=color:#9EFEFF><span class="token deleted-sign deleted line" style="color:rgba(239, 83, 80, 0.56)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgba(239, 83, 80, 0.56)">-</span><span class="token deleted-sign deleted line" style="color:rgba(239, 83, 80, 0.56)">      },</span><br></span><span class=token-line style=color:#9EFEFF><span class="token deleted-sign deleted line" style="color:rgba(239, 83, 80, 0.56)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgba(239, 83, 80, 0.56)">-</span><span class="token deleted-sign deleted line" style="color:rgba(239, 83, 80, 0.56)">    };</span><br></span><span class=token-line style=color:#9EFEFF><span class="token deleted-sign deleted line" style="color:rgba(239, 83, 80, 0.56)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(173, 219, 103)">+</span><span class="token inserted-sign inserted line" style="color:rgb(173, 219, 103)">    return {</span><br></span><span class=token-line style=color:#9EFEFF><span class="token inserted-sign inserted line" style="color:rgb(173, 219, 103)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(173, 219, 103)">+</span><span class="token inserted-sign inserted line" style="color:rgb(173, 219, 103)">      status,</span><br></span><span class=token-line style=color:#9EFEFF><span class="token inserted-sign inserted line" style="color:rgb(173, 219, 103)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(173, 219, 103)">+</span><span class="token inserted-sign inserted line" style="color:rgb(173, 219, 103)">      headers: {</span><br></span><span class=token-line style=color:#9EFEFF><span class="token inserted-sign inserted line" style="color:rgb(173, 219, 103)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(173, 219, 103)">+</span><span class="token inserted-sign inserted line" style="color:rgb(173, 219, 103)">        location,</span><br></span><span class=token-line style=color:#9EFEFF><span class="token inserted-sign inserted line" style="color:rgb(173, 219, 103)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(173, 219, 103)">+</span><span class="token inserted-sign inserted line" style="color:rgb(173, 219, 103)">      },</span><br></span><span class=token-line style=color:#9EFEFF><span class="token inserted-sign inserted line" style="color:rgb(173, 219, 103)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(173, 219, 103)">+</span><span class="token inserted-sign inserted line" style="color:rgb(173, 219, 103)">    };</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>I rather like this change. My reasoning is that, in the event that there is subsequent code that would otherwise run after <code>context.res</code> was set, we no longer need to remember to subsequently <code>return</code> to prevent that running. (And yes, I have made that mistake on multiple occasions.) All we need do is return the value we want to return from our function.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=body---jsonbody><code>body -> jsonBody</code><a href=#body---jsonbody class=hash-link aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<p>Another difference is that we no longer set the <code>body</code> property of the <code>context.res</code>. Instead we return an object with a <code>jsonBody</code> property, assuming we're returning JSON from our API. (And that's the most common case, right?)</p>
<p>This wasn't illustrated in the <code>fallback</code> function above, but here's an example of migrating a function that returns JavaScript object literal named <code>redirectSummary</code>:</p>
<div class="language-diff codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#9EFEFF;--prism-background-color:#2D2A55><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-diff codeBlock_bY9V thin-scrollbar" style=color:#9EFEFF;background-color:#2D2A55><code class=codeBlockLines_e6Vv><span class=token-line style=color:#9EFEFF><span class="token deleted-sign deleted prefix deleted" style="color:rgba(239, 83, 80, 0.56)">-</span><span class="token deleted-sign deleted line" style="color:rgba(239, 83, 80, 0.56)">    context.res = {</span><br></span><span class=token-line style=color:#9EFEFF><span class="token deleted-sign deleted line" style="color:rgba(239, 83, 80, 0.56)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgba(239, 83, 80, 0.56)">-</span><span class="token deleted-sign deleted line" style="color:rgba(239, 83, 80, 0.56)">      status: 200,</span><br></span><span class=token-line style=color:#9EFEFF><span class="token deleted-sign deleted line" style="color:rgba(239, 83, 80, 0.56)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgba(239, 83, 80, 0.56)">-</span><span class="token deleted-sign deleted line" style="color:rgba(239, 83, 80, 0.56)">      body: redirectSummary,</span><br></span><span class=token-line style=color:#9EFEFF><span class="token deleted-sign deleted line" style="color:rgba(239, 83, 80, 0.56)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgba(239, 83, 80, 0.56)">-</span><span class="token deleted-sign deleted line" style="color:rgba(239, 83, 80, 0.56)">    };</span><br></span><span class=token-line style=color:#9EFEFF><span class="token deleted-sign deleted line" style="color:rgba(239, 83, 80, 0.56)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(173, 219, 103)">+</span><span class="token inserted-sign inserted line" style="color:rgb(173, 219, 103)">    return {</span><br></span><span class=token-line style=color:#9EFEFF><span class="token inserted-sign inserted line" style="color:rgb(173, 219, 103)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(173, 219, 103)">+</span><span class="token inserted-sign inserted line" style="color:rgb(173, 219, 103)">      status: 200,</span><br></span><span class=token-line style=color:#9EFEFF><span class="token inserted-sign inserted line" style="color:rgb(173, 219, 103)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(173, 219, 103)">+</span><span class="token inserted-sign inserted line" style="color:rgb(173, 219, 103)">      jsonBody: redirectSummary,</span><br></span><span class=token-line style=color:#9EFEFF><span class="token inserted-sign inserted line" style="color:rgb(173, 219, 103)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(173, 219, 103)">+</span><span class="token inserted-sign inserted line" style="color:rgb(173, 219, 103)">    };</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>The <code>body</code> property still exists, but it's for returning strings and other things, rather than JSON. If you're returning JSON, the easiest approach is to use the <code>jsonBody</code> property.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=runtime-apis>Runtime APIs<a href=#runtime-apis class=hash-link aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<p>Finally, the APIs offered by the <code>request</code> and <code>context</code> objects are different. I shan't go into detail here as it's <a href="https://learn.microsoft.com/en-us/azure/azure-functions/functions-node-upgrade-v4?tabs=v4#review-your-usage-of-http-types" target=_blank rel="noopener noreferrer">well covered in the official documentation</a>. But I will show you one of the changes I made to my <code>fallback</code> function:</p>
<div class="language-diff codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#9EFEFF;--prism-background-color:#2D2A55><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-diff codeBlock_bY9V thin-scrollbar" style=color:#9EFEFF;background-color:#2D2A55><code class=codeBlockLines_e6Vv><span class=token-line style=color:#9EFEFF><span class="token deleted-sign deleted prefix deleted" style="color:rgba(239, 83, 80, 0.56)">-</span><span class="token deleted-sign deleted line" style="color:rgba(239, 83, 80, 0.56)">    const originalUrl = req.headers['x-ms-original-url'];</span><br></span><span class=token-line style=color:#9EFEFF><span class="token deleted-sign deleted line" style="color:rgba(239, 83, 80, 0.56)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(173, 219, 103)">+</span><span class="token inserted-sign inserted line" style="color:rgb(173, 219, 103)">    const originalUrl = request.headers.get('x-ms-original-url') || '';</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Not too significant a tweak, but there's a number of slight changes like this to make. (Related to this, the logging API on the <code>context</code> object is also different - but not significantly.)</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=3-running-locally>3. Running locally<a href=#3-running-locally class=hash-link aria-label="Direct link to heading" title="Direct link to heading">​</a></h2>
<p>If you're a fan of running locally then you may need to make this tweak to your <code>host.json</code>:</p>
<div class="language-diff codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#9EFEFF;--prism-background-color:#2D2A55><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-diff codeBlock_bY9V thin-scrollbar" style=color:#9EFEFF;background-color:#2D2A55><code class=codeBlockLines_e6Vv><span class=token-line style=color:#9EFEFF><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   "extensionBundle": {</span><br></span><span class=token-line style=color:#9EFEFF><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">       "id": "Microsoft.Azure.Functions.ExtensionBundle",</span><br></span><span class=token-line style=color:#9EFEFF><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgba(239, 83, 80, 0.56)">-</span><span class="token deleted-sign deleted line" style="color:rgba(239, 83, 80, 0.56)">        "version": "[3.*, 4.0.0)"</span><br></span><span class=token-line style=color:#9EFEFF><span class="token deleted-sign deleted line" style="color:rgba(239, 83, 80, 0.56)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(173, 219, 103)">+</span><span class="token inserted-sign inserted line" style="color:rgb(173, 219, 103)">        "version": "[4.*, 5.0.0)"</span><br></span><span class=token-line style=color:#9EFEFF><span class="token inserted-sign inserted line" style="color:rgb(173, 219, 103)"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   }</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>A complete <code>host.json</code> might look like this:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#9EFEFF;--prism-background-color:#2D2A55><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-json codeBlock_bY9V thin-scrollbar" style=color:#9EFEFF;background-color:#2D2A55><code class=codeBlockLines_e6Vv><span class=token-line style=color:#9EFEFF><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">    </span><span class="token property" style="color:rgb(255, 157, 0)">"version"</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">"2.0"</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">    </span><span class="token property" style="color:rgb(255, 157, 0)">"logging"</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">        </span><span class="token property" style="color:rgb(255, 157, 0)">"applicationInsights"</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">            </span><span class="token property" style="color:rgb(255, 157, 0)">"samplingSettings"</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">                </span><span class="token property" style="color:rgb(255, 157, 0)">"isEnabled"</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 98, 140)">true</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">                </span><span class="token property" style="color:rgb(255, 157, 0)">"excludedTypes"</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">"Request"</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">            </span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">        </span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">    </span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">    </span><span class="token property" style="color:rgb(255, 157, 0)">"extensionBundle"</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">        </span><span class="token property" style="color:rgb(255, 157, 0)">"id"</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">"Microsoft.Azure.Functions.ExtensionBundle"</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">        </span><span class="token property" style="color:rgb(255, 157, 0)">"version"</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">"[4.*, 5.0.0)"</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain">    </span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><span class="token plain"></span><br></span><span class=token-line style=color:#9EFEFF><span class="token plain"></span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>As discussed with <a href=https://github.com/ejizba target=_blank rel="noopener noreferrer">Eric Jizba</a> on <a href=https://github.com/Azure/azure-functions-core-tools/issues/3508#issuecomment-1894356158 target=_blank rel="noopener noreferrer">this GitHub issue</a>, updating the <code>host.json</code> may not actually be necessary.  For me it seemed to be the thing that turned a not working setup into a working setup; but it's possible I was mistaken. Certainly if I revert the change now I'm still able to run locally.  What I'm saying is: your mileage may vary.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=conclusion>Conclusion<a href=#conclusion class=hash-link aria-label="Direct link to heading" title="Direct link to heading">​</a></h2>
<p>Migrating an Azure Function from v3 to v4 with TypeScript is a little more involved than I'd expected. But I do like that this moves us to a code style that feels more "Node-y". <del>The official documentation is good, but it's not complete right now.</del> There's now a decent upgrade guide available: <a href="https://learn.microsoft.com/en-us/azure/azure-functions/functions-node-upgrade-v4?tabs=v4" target=_blank rel="noopener noreferrer">https://learn.microsoft.com/en-us/azure/azure-functions/functions-node-upgrade-v4?tabs=v4</a></p>
<p>Hopefully this post will help you migrate your TypeScript Azure Functions to v4.</div><footer class=docusaurus-mt-lg><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class=col><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class=tag_QGVx><a title="The TypeScript programming language." class="tag_zVej tagRegular_sFm0" href=/tags/typescript>TypeScript</a><li class=tag_QGVx><a title="The Microsoft cloud platform." class="tag_zVej tagRegular_sFm0" href=/tags/azure>Azure</a><li class=tag_QGVx><a title="The Azure Functions service." class="tag_zVej tagRegular_sFm0" href=/tags/azure-functions>Azure Functions</a><li class=tag_QGVx><a title="The Azure Static Web Apps service." class="tag_zVej tagRegular_sFm0" href=/tags/azure-static-web-apps>Azure Static Web Apps</a></ul></div></div><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class=col><a href=https://github.com/johnnyreilly/blog.johnnyreilly.com/edit/main/blog-website/blog/2023-10-24-migrating-azure-functions-node-js-v4-typescript/index.md target=_blank rel="noopener noreferrer" class=theme-edit-this-page><svg fill=currentColor height=20 width=20 viewBox="0 0 40 40" class=iconEdit_Z9Sw aria-hidden=true><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"/></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href=/graph-api-ad-users-group-name-ids-csharp-sdk><div class=pagination-nav__sublabel>Newer Post</div><div class=pagination-nav__label>Graph API: getting users Active Directory group names and ids with the C# SDK</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/bicep-link-azure-application-insights-to-static-web-apps><div class=pagination-nav__sublabel>Older Post</div><div class=pagination-nav__label>Bicep: Link Azure Application Insights to Static Web Apps</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#1-changes-to-make-to-the-packagejson class="table-of-contents__link toc-highlight">1. Changes to make to the <code>package.json</code></a><li><a href=#2-migrating-a-function class="table-of-contents__link toc-highlight">2. Migrating a Function</a><ul><li><a href=#imports-used class="table-of-contents__link toc-highlight"><code>import</code>s used</a><li><a href=#hello-app-goodbye-functionjson class="table-of-contents__link toc-highlight">Hello <code>app</code>, goodbye <code>function.json</code></a><li><a href=#signature-and-types-of-our-function class="table-of-contents__link toc-highlight">Signature and types of our <code>function</code></a><li><a href=#from-contextres-to-promisehttpresponseinit class="table-of-contents__link toc-highlight">From <code>context.res</code> to <code>Promise&lt;HttpResponseInit></code></a><li><a href=#body---jsonbody class="table-of-contents__link toc-highlight"><code>body -> jsonBody</code></a><li><a href=#runtime-apis class="table-of-contents__link toc-highlight">Runtime APIs</a></ul><li><a href=#3-running-locally class="table-of-contents__link toc-highlight">3. Running locally</a><li><a href=#conclusion class="table-of-contents__link toc-highlight">Conclusion</a></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class=footer__title></div><ul class="footer__items clean-list"><li class=footer__item><div class=footer__title><a href=/tags/typescript class=footer__link-item>TypeScript<img src=/img/ts-logo-128.svg alt="TypeScript icon" class=footer__icon></a></div>
<ul class="footer__items clean-list">
  <li class=footer__item><a href=/typescript-vs-jsdoc-javascript class=footer__link-item>TypeScript vs JSDoc JavaScript</a><li class=footer__item><a href=/type-annotations-strong-types-weakly-held class=footer__link-item>Type annotations proposal: strong types, weakly held</a></li>
</ul><div class=footer__title><a href=/tags/azure class=footer__link-item>Azure<img src=/img/azure-logo.svg alt="Azure icon" class=footer__icon></a></div>
<ul class="footer__items clean-list">
  <li class=footer__item><a href=/azure-container-apps-easy-auth-and-dotnet-authentication class=footer__link-item>Azure Container Apps: Easy Auth and .NET</a><li class=footer__item><a href=/introducing-azdo-npm-auth class=footer__link-item>Introducing azdo-npm-auth (Azure DevOps npm auth)</a><li class=footer__item><a href=/npx-and-azure-artifacts-the-secret-cli-delivery-mechanism class=footer__link-item>npx and Azure Artifacts: the secret CLI delivery mechanism</a><li class=footer__item><a href=/azure-static-web-apps-dynamic-redirects-azure-functions class=footer__link-item>Azure Static Web Apps: dynamic redirects with Azure Functions</a></li>
</ul><div class=footer__title><a href=/tags/asp-net class=footer__link-item>ASP.NET<img src=/img/dotnet-logo.svg alt="ASP.NET icon" class=footer__icon></a></div>
<ul class="footer__items clean-list">
  <li class=footer__item><a href=/eslint-your-csharp-in-vs-code-with-roslyn-analyzers class=footer__link-item>ESLint your C# with Roslyn Analyzers</a><li class=footer__item><a href=/aspnet-serilog-and-application-insights class=footer__link-item>ASP.NET, Serilog and Application Insights</a></li>
</ul><div class=footer__title><a href=/tags/react class=footer__link-item>React<img src=/img/react-logo.svg alt="React icon" class=footer__icon></a></div>
<ul class="footer__items clean-list">
  <li class=footer__item><a href=/structured-data-seo-and-react class=footer__link-item>Structured data and React</a><li class=footer__item><a href=/react-usesearchparamsstate class=footer__link-item>React: storing state in URL with URLSearchParams</a></li>
</ul></ul></div><div class="col footer__col"><div class=footer__title></div><ul class="footer__items clean-list"><li class=footer__item><div class=footer__title>Notable articles</div>
<ul class="footer__items clean-list">
  <li class=footer__item><a href=/definitely-typed-the-movie class=footer__link-item>The history of Definitely Typed<img src=/img/definitely-typed-logo.png alt="The history of Definitely Typed icon" class=footer__icon></a><li class=footer__item><a href=/typescript-documentary class=footer__link-item>TypeScript: the documentary<img src=/img/ts-logo-128.svg alt="TypeScript: the documentary icon" class=footer__icon></a><li class=footer__item><a href=/how-we-fixed-my-seo class=footer__link-item>How we fixed my SEO</a></li>
</ul><div class=footer__title>Popular articles</div>
<ul class="footer__items clean-list">
  <li class=footer__item><a href=/aspnet-serilog-and-application-insights class=footer__link-item>ASP.NET, Serilog and Application Insights</a><li class=footer__item><a href=/eslint-your-csharp-in-vs-code-with-roslyn-analyzers class=footer__link-item>ESLint your C# with Roslyn Analyzers</a><li class=footer__item><a href=/prettier-your-csharp-with-dotnet-format-and-lint-staged class=footer__link-item>dotnet-format: Prettier your C# with lint-staged & husky</a></li>
</ul><div class=footer__title>Recently updated</div>
<ul class="footer__items clean-list">
  <li class=footer__item><a href=graph-api-ad-users-group-name-ids-csharp-sdk class=footer__link-item>Graph API: getting users Active Directory group names and ids with the C# SDK</a><li class=footer__item><a href=microsoft-graphclient-filter-endswith-consistencylevel-eventual-header class=footer__link-item>Microsoft Graph client: how to filter by endswith</a><li class=footer__item><a href=azure-ad-claims-static-web-apps-azure-functions class=footer__link-item>Azure AD Claims with Static Web Apps and Azure Functions</a></li>
</ul></ul></div><div class="col footer__col"><div class=footer__title>Learn more / support me</div><ul class="footer__items clean-list"><li class=footer__item><a class=footer__link-item href=/about>About me</a><li class=footer__item><a href=https://github.com/johnnyreilly/blog.johnnyreilly.com target=_blank rel="noopener noreferrer" class=footer__link-item>Blog source code on GitHub<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a class=footer__link-item href=/tags>Blog categories</a><li class=footer__item><a href=https://johnnyreilly.com/rss.xml target=_blank rel="noopener noreferrer" class=footer__link-item>RSS feed<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://johnnyreilly.com/atom.xml target=_blank rel="noopener noreferrer" class=footer__link-item>Atom feed<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a class=footer__link-item href=/privacy-policy>Privacy Policy</a><li class=footer__item><iframe src=https://github.com/sponsors/johnnyreilly/card title="Sponsor johnnyreilly" style="margin-top: 20px; border: 0; border-radius: 10px; background-color: white; min-height: 400px;"></iframe><li class=footer__item><a href=https://www.buymeacoffee.com/qUBm0Wh rel=noopener target=_blank><img src=https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png loading=lazy alt="Buy Me A Coffee" style="height: 60px !important;width: 217px !important;"></a></ul></div></div><div class="footer__bottom text--center"><div class=footer__copyright>Copyright © 2012 - 2025 John Reilly. Built with Docusaurus.</div></div></div></footer></div>