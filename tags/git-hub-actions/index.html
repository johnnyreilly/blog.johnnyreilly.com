<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="I CAN MAKE THIS WORK RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="I CAN MAKE THIS WORK Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-51754530-2","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=297675200"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","297675200",{})</script>
<link rel="icon" href="/img/favicon/profile.jpg">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#3578e5">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#000">
<link rel="apple-touch-icon" href="/img/favicon/apple-touch-icon.png"><title data-react-helmet="true">2 posts tagged with &quot;GitHub Actions&quot; | I CAN MAKE THIS WORK</title><meta data-react-helmet="true" property="og:title" content="2 posts tagged with &quot;GitHub Actions&quot; | I CAN MAKE THIS WORK"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="https://blog.johnnyreilly.com/img/profile.jpg"><meta data-react-helmet="true" name="twitter:image" content="https://blog.johnnyreilly.com/img/profile.jpg"><meta data-react-helmet="true" property="og:url" content="https://blog.johnnyreilly.com/tags/git-hub-actions"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-react-helmet="true" name="robots" content="max-image-preview:large"><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://blog.johnnyreilly.com/tags/git-hub-actions"><link data-react-helmet="true" rel="alternate" href="https://blog.johnnyreilly.com/tags/git-hub-actions" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://blog.johnnyreilly.com/tags/git-hub-actions" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.763f33af.css">
<link rel="preload" href="/assets/js/runtime~main.e1a9c30a.js" as="script">
<link rel="preload" href="/assets/js/main.057f98ca.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/profile.jpg" alt="I CAN MAKE THIS WORK" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/img/profile.jpg" alt="I CAN MAKE THIS WORK" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">I CAN MAKE THIS WORK</b></a><a class="navbar__item navbar__link" href="/about">About</a><a class="navbar__item navbar__link" href="/archive">Blog Archive</a><a class="navbar__item navbar__link" href="/talks">Talks</a></div><div class="navbar__items navbar__items--right"><a href="https://polywork.johnnyreilly.com/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Polywork<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://github.com/johnnyreilly" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://twitter.com/johnny_reilly" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_71bT toggle_3Zt9 toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">ðŸŒœ</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">ðŸŒž</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-tags-post-list-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_2ahu thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_2hhb margin-bottom--md">Recent posts</div><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/2021/12/19/azure-container-apps-bicep-and-github-actions">Azure Container Apps, Bicep and GitHub Actions</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/2021/12/12/open-graph-sharing-previews-guide">Open Graph: a guide to sharable social media previews</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/2021/12/05/azure-static-web-app-deploy-previews-with-azure-devops">Azure Static Web App Deploy Previews with Azure DevOps</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/2021/11/22/typescript-vs-jsdoc-javascript">TypeScript vs JSDoc JavaScript</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/2021/11/18/azure-standard-tests-with-bicep">Azure standard availability tests with Bicep</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><header class="margin-bottom--xl"><h1>2 posts tagged with &quot;GitHub Actions&quot;</h1><a href="/tags">View All Tags</a></header><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_GeHD" itemprop="headline"><a itemprop="url" href="/2021/12/19/azure-container-apps-bicep-and-github-actions">Azure Container Apps, Bicep and GitHub Actions</a></h2><div class="blogPostData_291c margin-vert--md"><time datetime="2021-12-19T00:00:00.000Z" itemprop="datePublished">December 19, 2021</time> Â· <!-- -->4 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_1R69"><div class="avatar margin-bottom--sm"><a href="https://twitter.com/johnny_reilly" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_1yU8" src="https://blog.johnnyreilly.com/img/profile.jpg" alt="John Reilly"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://twitter.com/johnny_reilly" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">John Reilly</span></a></div></div></div></div></div></header><meta itemprop="image" content="https://blog.johnnyreilly.com/assets/images/title-image-77a00ce5109282712322616d4a314924.png"><div class="markdown" itemprop="articleBody"><p>Azure Container Apps are an exciting way to deploy containers to Azure. This post shows how to deploy the infrastructure for an Azure Container App to Azure using Bicep and GitHub Actions. The <a href="https://docs.microsoft.com/en-us/azure/container-apps/" target="_blank" rel="noopener noreferrer">Azure Container App documentation</a> features quickstarts for deploying your first container app using both the Azure Portal and the Azure CLI. These are great, but there&#x27;s a gap if you prefer to deploy using Bicep and you&#x27;d like to get your CI/CD setup right from the beginning. This post aims to fill that gap.</p><p><img alt="title image reading &amp;quot;Azure Container Apps, Bicep and GitHub Actions&amp;quot; with the Bicep, Azure Container Apps and GitHub Actions logos" src="/assets/images/title-image-77a00ce5109282712322616d4a314924.png"></p><h2 class="anchor anchorWithStickyNavbar_31ik" id="bicep">Bicep<a class="hash-link" href="#bicep" title="Direct link to heading">â€‹</a></h2><p>Let&#x27;s begin with the Bicep required to deploy an Azure Container App.</p><p>In our new repository we&#x27;ll create an <code>infra</code> directory, into which we&#x27;ll place a <code>main.bicep</code> file which will contain our Bicep template.</p><p>I&#x27;ve pared this down to the simplest Bicep template that I can; it only requires a name parameter:</p><div class="codeBlockContainer_K1bP language-bicep theme-code-block"><div class="codeBlockContent_hGly bicep"><pre tabindex="0" class="prism-code language-bicep codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token plain">param name string</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">param secrets array = []</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">var location = resourceGroup().location</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">var environmentName = &#x27;Production&#x27;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">var workspaceName = &#x27;${name}-log-analytics&#x27;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">resource workspace &#x27;Microsoft.OperationalInsights/workspaces@2020-08-01&#x27; = {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  name: workspaceName</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  location: location</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  properties: {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    sku: {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      name: &#x27;PerGB2018&#x27;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    retentionInDays: 30</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    workspaceCapping: {}</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">resource environment &#x27;Microsoft.Web/kubeEnvironments@2021-03-01&#x27; = {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  name: environmentName</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  location: location</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  properties: {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    type: &#x27;managed&#x27;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    internalLoadBalancerEnabled: false</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    appLogsConfiguration: {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      destination: &#x27;log-analytics&#x27;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      logAnalyticsConfiguration: {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        customerId: workspace.properties.customerId</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        sharedKey: listKeys(workspace.id, workspace.apiVersion).primarySharedKey</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">resource containerApp &#x27;Microsoft.Web/containerapps@2021-03-01&#x27; = {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  name: name</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  kind: &#x27;containerapps&#x27;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  location: location</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  properties: {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    kubeEnvironmentId: environment.id</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    configuration: {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      secrets: secrets</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      registries: []</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      ingress: {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        &#x27;external&#x27;:true</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        &#x27;targetPort&#x27;:80</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    template: {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      containers: [</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">          &#x27;name&#x27;:&#x27;simple-hello-world-container&#x27;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">          &#x27;image&#x27;:&#x27;mcr.microsoft.com/azuredocs/containerapps-helloworld:latest&#x27;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">          &#x27;command&#x27;:[]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">          &#x27;resources&#x27;:{</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">            &#x27;cpu&#x27;:&#x27;.25&#x27;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">            &#x27;memory&#x27;:&#x27;.5Gi&#x27;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">          }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      ]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Some things to note from the template:</p><ul><li>We&#x27;re deploying three resources; a container app, a kube environment and an operational insights.</li><li>Just like the official quickstarts we&#x27;re going to use the <code>containerapps-helloworld</code> image.</li></ul><h2 class="anchor anchorWithStickyNavbar_31ik" id="setting-up-a-resource-group">Setting up a resource group<a class="hash-link" href="#setting-up-a-resource-group" title="Direct link to heading">â€‹</a></h2><p>In order that you can deploy your Bicep, we&#x27;re going to need a resource group to send it to. Right now, Azure Container Apps aren&#x27;t available everywhere. So we&#x27;re going to create ourselves a resource group in North Europe which does support ACAs:</p><div class="codeBlockContainer_K1bP language-shell theme-code-block"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token plain">az group create -g rg-aca -l northeurope</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="deploying-with-the-azure-cli">Deploying with the Azure CLI<a class="hash-link" href="#deploying-with-the-azure-cli" title="Direct link to heading">â€‹</a></h2><p>With this resource group in place, we could simply deploy using the Azure CLI like so:</p><div class="codeBlockContainer_K1bP language-shell theme-code-block"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token plain">az deployment group create </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  --resource-group rg-aca </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  --template-file ./infra/main.bicep </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  --parameters </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token assign-left variable" style="color:rgb(214, 222, 235)">name</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;container-app&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="deploying-with-github-actions">Deploying with GitHub Actions<a class="hash-link" href="#deploying-with-github-actions" title="Direct link to heading">â€‹</a></h2><p>However, we&#x27;re aiming to set up a GitHub Action to do this for us. We&#x27;ll create a <code>.github/workflows/deploy.yaml</code> file in our repository:</p><div class="codeBlockContainer_K1bP language-yaml theme-code-block"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Deploy</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token key atrule">on</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token key atrule">push</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token key atrule">branches</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token key atrule">workflow_dispatch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token key atrule">env</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token key atrule">RESOURCE_GROUP</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> rg</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">aca</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token key atrule">jobs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token key atrule">deploy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token key atrule">runs-on</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token key atrule">steps</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Checkout repository</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token key atrule">uses</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> actions/checkout@v2</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Azure Login</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token key atrule">uses</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> azure/login@v1</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token key atrule">with</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">          </span><span class="token key atrule">creds</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> secrets.AZURE_CREDENTIALS </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Deploy bicep</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token key atrule">uses</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> azure/CLI@v1</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token key atrule">with</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">          </span><span class="token key atrule">inlineScript</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">|</span><span class="token scalar string" style="color:rgb(173, 219, 103)"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token scalar string" style="color:rgb(173, 219, 103)">            az deployment group create \</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token scalar string" style="color:rgb(173, 219, 103)">              --resource-group ${{ env.RESOURCE_GROUP }} \</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token scalar string" style="color:rgb(173, 219, 103)">              --template-file ./infra/main.bicep \</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token scalar string" style="color:rgb(173, 219, 103)">              --parameters \</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token scalar string" style="color:rgb(173, 219, 103)">                name=&#x27;container-app&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The above GitHub action is very simple. It:</p><ol><li>Logs into Azure using some <code>AZURE_CREDENTIALS</code> we&#x27;ll set up in a moment.</li><li>Invokes the Azure CLI to deploy our Bicep template.</li></ol><p>Let&#x27;s create that <code>AZURE_CREDENTIALS</code> secret in GitHub:</p><p><img alt="Screenshot of `AZURE_CREDENTIALS` secret in the GitHub website that we need to create" src="/assets/images/screenshot-github-secrets-4d6c19f593d7554791e123cbeed782b6.png"></p><p>We&#x27;ll use the Azure CLI once more:</p><div class="codeBlockContainer_K1bP language-shell theme-code-block"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token plain">az ad sp create-for-rbac --name </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;myApp&quot;</span><span class="token plain"> --role contributor </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    --scopes /subscriptions/</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">subscription-id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">/resourceGroups/</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">resource-group</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    --sdk-auth</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Remember to replace the <code>{subscription-id}</code> with your subscription id and <code>{resource-group}</code> with the name of your resource group (<code>rg-aca</code> if you&#x27;re following along). This command will pump out a lump of JSON that looks something like this:</p><div class="codeBlockContainer_K1bP language-json theme-code-block"><div class="codeBlockContent_hGly json"><pre tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token property" style="color:rgb(128, 203, 196)">&quot;clientId&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;a-client-id&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token property" style="color:rgb(128, 203, 196)">&quot;clientSecret&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;a-client-secret&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token property" style="color:rgb(128, 203, 196)">&quot;subscriptionId&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;a-subscription-id&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token property" style="color:rgb(128, 203, 196)">&quot;tenantId&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;a-tenant-id&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token property" style="color:rgb(128, 203, 196)">&quot;activeDirectoryEndpointUrl&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;https://login.microsoftonline.com&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token property" style="color:rgb(128, 203, 196)">&quot;resourceManagerEndpointUrl&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;https://management.azure.com/&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token property" style="color:rgb(128, 203, 196)">&quot;activeDirectoryGraphResourceId&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;https://graph.windows.net/&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token property" style="color:rgb(128, 203, 196)">&quot;sqlManagementEndpointUrl&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;https://management.core.windows.net:8443/&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token property" style="color:rgb(128, 203, 196)">&quot;galleryEndpointUrl&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;https://gallery.azure.com/&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token property" style="color:rgb(128, 203, 196)">&quot;managementEndpointUrl&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;https://management.core.windows.net/&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Take this and save it as the <code>AZURE_CREDENTIALS</code> secret in Azure.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="running-it">Running it<a class="hash-link" href="#running-it" title="Direct link to heading">â€‹</a></h2><p>When the GitHub Action has been run you&#x27;ll find that Azure Container App is now showing up inside the Azure Portal:</p><p><img alt="screenshot of the Azure Container App in the Azure Portal" src="/assets/images/screenshot-azure-portal-container-app-78ff79ba2dcae59afd03efd3285fd490.png"></p><p>You&#x27;ll see a URL is displayed, when you go that URL you&#x27;ll find the hello world image is running!</p><p><img alt="screenshot of the running Azure Container App" src="/assets/images/screenshot-of-running-container-app-a96a08c0f50bfdd9f21b8ca90c1bb3b4.png"></p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_2ga9 padding--none margin-left--sm"><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/tags/azure-container-apps">Azure Container Apps</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/tags/bicep">Bicep</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/tags/git-hub-actions">GitHub Actions</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about Azure Container Apps, Bicep and GitHub Actions" href="/2021/12/19/azure-container-apps-bicep-and-github-actions"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_GeHD" itemprop="headline"><a itemprop="url" href="/2019/01/05/github-actions-and-yarn">GitHub Actions and Yarn</a></h2><div class="blogPostData_291c margin-vert--md"><time datetime="2019-01-05T00:00:00.000Z" itemprop="datePublished">January 5, 2019</time> Â· <!-- -->4 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_1R69"><div class="avatar margin-bottom--sm"><a href="https://twitter.com/johnny_reilly" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_1yU8" src="https://blog.johnnyreilly.com/img/profile.jpg" alt="John Reilly"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://twitter.com/johnny_reilly" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">John Reilly</span></a></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>I&#x27;d been meaning to automate the npm publishing of <a href="https://github.com/TypeStrong/ts-loader" target="_blank" rel="noopener noreferrer"><code>ts-loader</code></a> for the longest time. I had attempted to use Travis to do this in the same way as <a href="https://github.com/Realytics/fork-ts-checker-webpack-plugin" target="_blank" rel="noopener noreferrer"><code>fork-ts-checker-webpack-plugin</code></a>. Alas using secure environment variables in Travis has unfortunate implications for ts-loader&#x27;s test pack.</p><p>Be not afeard. I&#x27;ve heard there&#x27;s a new shiny thing from GitHub that I could use instead... It&#x27;s a sign; I must use it!</p><p>GitHub Actions are still in beta. Technically Actions are <a href="https://developer.github.com/actions/creating-github-actions/" target="_blank" rel="noopener noreferrer">code run in Docker containers</a> in response to events. This didn&#x27;t mean a great deal to me until I started thinking about what I wanted to do with <code>ts-loader</code>&#x27;s publishing flow.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="automate-what">Automate What?<a class="hash-link" href="#automate-what" title="Direct link to heading">â€‹</a></h2><p>Each time I publish a release of <code>ts-loader</code> I execute the following node commands by hand:</p><ol><li><code>yarn install</code> <!-- -->-<!-- --> to install <code>ts-loader</code>&#x27;s dependencies</li><li><code>yarn build</code> <!-- -->-<!-- --> to build <code>ts-loader</code></li><li><code>yarn test</code> <!-- -->-<!-- --> to run <code>ts-loader</code>&#x27;s test packs</li><li><code>npm publish</code> <!-- -->-<!-- --> to publish the release of <code>ts-loader</code> to npm</li></ol><p>Having read up on GitHub Actions it seemed like they were born to handle this sort of task.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="github-action-for-npm">GitHub Action for <code>npm</code><a class="hash-link" href="#github-action-for-npm" title="Direct link to heading">â€‹</a></h2><p>I quickly discovered that someone out there <s>loves me</s></p><p>had <a href="https://github.com/actions/npm" target="_blank" rel="noopener noreferrer">already written a GitHub Action for <code>npm</code></a>.</p><p>The example in the <code>README/index.md</code> could be easily tweaked to meet my needs with one caveat: I had to use <code>npm</code> in place of <code>yarn</code>. I didn&#x27;t want to switch from <code>yarn</code>. What to do?</p><p>Well, remember when I said actions are code run in Docker containers? Another way to phrase that is to say: GitHub Actions are Docker images. Let&#x27;s look under the covers of the <code>npm</code> GitHub Action. As we peer inside the <a href="https://github.com/actions/npm/blob/e7aaefed7c9f2e83d493ff810f17fa5ccd7ed437/Dockerfile#L1" target="_blank" rel="noopener noreferrer"><code>Dockerfile</code></a> what do we find?</p><div class="codeBlockContainer_K1bP theme-code-block"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token plain">FROM node:10-slim</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Hmmmm.... Interesting. The base image of the <code>npm</code> GitHub Action is <code>node:10-slim</code>. Looking it up, it seems the <code>-slim</code> Docker images come with <a href="https://github.com/nodejs/docker-node/blob/master/Dockerfile-slim.template" target="_blank" rel="noopener noreferrer"><code>yarn</code> included</a>. Which means we should be able to use <code>yarn</code> inside the <code>npm</code> GitHub Action. Nice!</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="github-action-for-npm-for-yarn">GitHub Action for <code>npm</code> for <code>yarn</code><a class="hash-link" href="#github-action-for-npm-for-yarn" title="Direct link to heading">â€‹</a></h2><p>Using <code>yarn</code> from the GitHub Action for <code>npm</code> is delightfully simple. Here&#x27;s what running <code>npm install</code> looks like:</p><div class="codeBlockContainer_K1bP theme-code-block"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token plain"># install with npm</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">action &quot;install&quot; {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  uses = &quot;actions/npm@1.0.0&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  args = &quot;install&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Pivoting to use <code>yarn install</code> instead of <code>npm install</code> is as simple as:</p><div class="codeBlockContainer_K1bP theme-code-block"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token plain"># install with yarn</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">action &quot;install&quot; {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  uses = &quot;actions/npm@1.0.0&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  runs = &quot;yarn&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  args = &quot;install&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>You can see we&#x27;ve introduced the <code>runs = &quot;yarn&quot;</code> and after that the <code>args</code> are whatever you need them to be.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="going-with-the-workflow">Going With The Workflow<a class="hash-link" href="#going-with-the-workflow" title="Direct link to heading">â€‹</a></h2><p>A GitHub Workflow that implements the steps I need would look like this:</p><div class="codeBlockContainer_K1bP theme-code-block"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token plain">workflow &quot;build, test and publish on release&quot; {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  on = &quot;push&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  resolves = &quot;publish&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"># install with yarn</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">action &quot;install&quot; {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  uses = &quot;actions/npm@1.0.0&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  runs = &quot;yarn&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  args = &quot;install&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"># build with yarn</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">action &quot;build&quot; {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  needs = &quot;install&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  uses = &quot;actions/npm@1.0.0&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  runs = &quot;yarn&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  args = &quot;build&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"># test with yarn</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">action &quot;test&quot; {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  needs = &quot;build&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  uses = &quot;actions/npm@1.0.0&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  runs = &quot;yarn&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  args = &quot;test&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"># filter for a new tag</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">action &quot;check for new tag&quot; {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  needs = &quot;Test&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  uses = &quot;actions/bin/filter@master&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  args = &quot;tag&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"># publish with npm</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">action &quot;publish&quot; {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  needs = &quot;check for new tag&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  uses = &quot;actions/npm@1.0.0&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  args = &quot;publish&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  secrets = [&quot;NPM_AUTH_TOKEN&quot;]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>As you can see, this is a direct automation of steps 1-4 I listed earlier. Since all these actions are executed in the same container, we can skip from <code>yarn</code> to <code>npm</code> with gay abandon.</p><p>What&#x27;s absolutely amazing is, when I got access to GitHub Actions <a href="https://github.com/TypeStrong/ts-loader/blob/master/.github/main.workflow" target="_blank" rel="noopener noreferrer">my hand crafted workflow</a> looked like it should work first time! I know, right? Don&#x27;t you love it when that happens? <a href="https://github.com/actions/bin/issues/13" target="_blank" rel="noopener noreferrer">Alas there&#x27;s presently a problem with filters in GitHub Actions</a>. But that&#x27;s by the by, if you&#x27;re just looking to use a GitHub Action with yarn instead of npm then you are home free.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="you-dont-actually-need-the-npm-github-action">You Don&#x27;t Actually Need the npm GitHub Action<a class="hash-link" href="#you-dont-actually-need-the-npm-github-action" title="Direct link to heading">â€‹</a></h2><p>You heard me right. Docker containers be Docker containers. You don&#x27;t actually need to use this:</p><div class="codeBlockContainer_K1bP theme-code-block"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token plain">uses = &quot;actions/npm@1.0.0&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>You can use <em>any</em> Docker container which has node / npm installed! So if you&#x27;d like to use say node 11 instead you could just do this:</p><div class="codeBlockContainer_K1bP theme-code-block"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token plain">uses = &quot;docker://node:11&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Which would use the node 11 image on <a href="https://hub.docker.com/_/node" target="_blank" rel="noopener noreferrer">docker hub</a>.</p><p>Which is pretty cool. You know what&#x27;s even more incredible? Inside a workflow you can switch <code>uses</code> mid-workflow and keep the output. That&#x27;s right; you can have a work flow with say three actions running <code>uses = &quot;docker://node:11&quot;</code> and then a fourth running <code>uses = &quot;actions/npm@1.0.0&quot;</code>. That&#x27;s <em>so</em> flexible and powerful!</p><p>Thanks to <a href="https://github.com/mcolyer" target="_blank" rel="noopener noreferrer">Matt Colyer</a> and <a href="https://github.com/LandonSchropp" target="_blank" rel="noopener noreferrer">Landon Schropp</a> for <a href="https://github.com/actions/npm/issues/9" target="_blank" rel="noopener noreferrer">schooling me on the intricicies of GitHub Actions</a>. Much â¤</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_2ga9 padding--none margin-left--sm"><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/tags/docker">docker</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/tags/yarn">yarn</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/tags/git-hub-actions">GitHub Actions</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about GitHub Actions and Yarn" href="/2019/01/05/github-actions-and-yarn"><b>Read More</b></a></div></footer></article></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Support me</div><ul class="footer__items"><li class="footer__item"><a href="https://www.buymeacoffee.com/qUBm0Wh" target="_blank"><img src="https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png" alt="Buy Me A Coffee" style="height: 60px !important;width: 217px !important;"></a></li><li class="footer__item"><div style="display: flex; align-items: center;"><iframe src="https://github.com/sponsors/johnnyreilly/button" title="Sponsor johnnyreilly" height="35" width="116" style="border: 0;"></iframe><div>&nbsp;on GitHub</div></div></li></ul></div><div class="col footer__col"><div class="footer__title">Feeds</div><ul class="footer__items"><li class="footer__item"><a href="https://blog.johnnyreilly.com/rss.xml" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>RSS<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://blog.johnnyreilly.com/atom.xml" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Atom<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 John Reilly. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.e1a9c30a.js"></script>
<script src="/assets/js/main.057f98ca.js"></script>
</body>
</html>