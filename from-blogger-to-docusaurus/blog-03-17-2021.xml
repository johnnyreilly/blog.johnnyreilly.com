<?xml version='1.0' encoding='UTF-8'?><?xml-stylesheet href="https://www.blogger.com/styles/atom.css" type="text/css"?><feed xmlns='http://www.w3.org/2005/Atom' xmlns:openSearch='http://a9.com/-/spec/opensearchrss/1.0/' xmlns:gd='http://schemas.google.com/g/2005' xmlns:thr='http://purl.org/syndication/thread/1.0' xmlns:georss='http://www.georss.org/georss'><id>tag:blogger.com,1999:blog-3759615474523601615.archive</id><updated>2021-03-17T21:27:18.928Z</updated><title type='text'>I CAN MAKE THIS WORK...</title><link rel='http://schemas.google.com/g/2005#feed' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/archive'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/archive'/><link rel='http://schemas.google.com/g/2005#post' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/archive'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><generator version='7.00' uri='https://www.blogger.com'>Blogger</generator><entry><id>tag:blogger.com,1999:blog-3759615474523601615.layout</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#template'/><title type='text'>Template: I CAN MAKE THIS WORK...</title><content type='text'>&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;!DOCTYPE html&gt;
&lt;html b:version='2' class='v2' expr:dir='data:blog.languageDirection' xmlns='http://www.w3.org/1999/xhtml' xmlns:b='http://www.google.com/2005/gml/b' xmlns:data='http://www.google.com/2005/gml/data' xmlns:expr='http://www.google.com/2005/gml/expr'&gt;
  &lt;head&gt;
    &lt;b:if cond='data:blog.isMobile'&gt;
      &lt;meta content='width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0' name='viewport'/&gt;
      &lt;b:else/&gt;
      &lt;meta content='width=1100' name='viewport'/&gt;
    &lt;/b:if&gt;
    &lt;b:include data='blog' name='all-head-content'/&gt;
    &lt;title&gt;
      &lt;data:blog.pageTitle/&gt;
    &lt;/title&gt;
    &lt;b:skin&gt;&lt;![CDATA[
      /*
-----------------------------------------------
Blogger Template Style
Name:     Awesome Inc.
Designer: Tina Chen
URL:      tinachen.org
----------------------------------------------- */
/* Variable definitions
====================
&lt;Variable name="keycolor" description="Main Color" type="color" default="#ffffff" value="#ffffff"/&gt;
&lt;Group description="Page" selector="body"&gt;
&lt;Variable name="body.font" description="Font" type="font"
default="normal normal 13px Arial, Tahoma, Helvetica, FreeSans, sans-serif" value="normal normal 20px Open Sans"/&gt;
&lt;Variable name="body.background.color" description="Background Color" type="color" default="#000000" value="#fce5cd"/&gt;
&lt;Variable name="body.text.color" description="Text Color" type="color" default="#ffffff" value="#4c4c4c"/&gt;
&lt;/Group&gt;
&lt;Group description="Links" selector=".main-inner"&gt;
&lt;Variable name="link.color" description="Link Color" type="color" default="#888888" value="#3b7ace"/&gt;
&lt;Variable name="link.visited.color" description="Visited Color" type="color" default="#444444" value="#4f48a0"/&gt;
&lt;Variable name="link.hover.color" description="Hover Color" type="color" default="#cccccc" value="#3b7ace"/&gt;
&lt;/Group&gt;
&lt;Group description="Blog Title" selector=".header h1"&gt;
&lt;Variable name="header.font" description="Title Font" type="font"
default="normal bold 40px Arial, Tahoma, Helvetica, FreeSans, sans-serif" value="normal bold 40px Inconsolata"/&gt;
&lt;Variable name="header.text.color" description="Title Color" type="color" default="$(body.text.color)"  value="#4c4c4c"/&gt;
&lt;Variable name="header.background.color" description="Header Background" type="color" default="transparent"  value="transparent"/&gt;
&lt;/Group&gt;
&lt;Group description="Blog Description" selector=".header .description"&gt;
&lt;Variable name="description.font" description="Font" type="font"
default="normal normal 14px Arial, Tahoma, Helvetica, FreeSans, sans-serif" value="normal normal 12px Open Sans"/&gt;
&lt;Variable name="description.text.color" description="Text Color" type="color"
default="$(body.text.color)"  value="#4c4c4c"/&gt;
&lt;/Group&gt;
&lt;Group description="Tabs Text" selector=".tabs-inner .widget li a"&gt;
&lt;Variable name="tabs.font" description="Font" type="font"
default="normal bold 14px Arial, Tahoma, Helvetica, FreeSans, sans-serif" value="normal bold 12px Open Sans"/&gt;
&lt;Variable name="tabs.text.color" description="Text Color" type="color" default="$(body.text.color)" value="#4c4c4c"/&gt;
&lt;Variable name="tabs.selected.text.color" description="Selected Color" type="color" default="$(tabs.text.color)" value="#ffffff"/&gt;
&lt;/Group&gt;
&lt;Group description="Tabs Background" selector=".tabs-outer .PageList"&gt;
&lt;Variable name="tabs.background.color" description="Background Color" type="color" default="#141414" value="#eeeeee"/&gt;
&lt;Variable name="tabs.selected.background.color" description="Selected Color" type="color" default="#444444" value="#6a6a6a"/&gt;
&lt;Variable name="tabs.border.color" description="Border Color" type="color" default="$(widget.border.color)" value="#9a9a9a"/&gt;
&lt;/Group&gt;
&lt;Group description="Date Header" selector=".main-inner .widget h2.date-header, .main-inner .widget h2.date-header span"&gt;
&lt;Variable name="date.font" description="Font" type="font"
default="normal normal 14px Arial, Tahoma, Helvetica, FreeSans, sans-serif" value="normal normal 14px Verdana, Geneva, sans-serif"/&gt;
&lt;Variable name="date.text.color" description="Text Color" type="color" default="#666666" value="#4c4c4c"/&gt;
&lt;Variable name="date.border.color" description="Border Color" type="color" default="$(widget.border.color)" value="#eeeeee"/&gt;
&lt;/Group&gt;
&lt;Group description="Post Title" selector="h3.post-title, h4, h3.post-title a"&gt;
&lt;Variable name="post.title.font" description="Font" type="font"
default="normal bold 22px Arial, Tahoma, Helvetica, FreeSans, sans-serif" value="normal bold 36px Droid Sans"/&gt;
&lt;Variable name="post.title.text.color" description="Text Color" type="color" default="$(body.text.color)" value="#4c4c4c"/&gt;
&lt;/Group&gt;
&lt;Group description="Post Background" selector=".post"&gt;
&lt;Variable name="post.background.color" description="Background Color" type="color" default="$(widget.background.color)"  value="#ffffff"/&gt;
&lt;Variable name="post.border.color" description="Border Color" type="color" default="$(widget.border.color)"  value="#eeeeee"/&gt;
&lt;Variable name="post.border.bevel.color" description="Bevel Color" type="color" default="$(widget.border.color)" value="#eeeeee"/&gt;
&lt;/Group&gt;
&lt;Group description="Gadget Title" selector="h2"&gt;
&lt;Variable name="widget.title.font" description="Font" type="font"
default="normal bold 14px Arial, Tahoma, Helvetica, FreeSans, sans-serif" value="normal bold 14px Verdana, Geneva, sans-serif"/&gt;
&lt;Variable name="widget.title.text.color" description="Text Color" type="color" default="$(body.text.color)" value="#4c4c4c"/&gt;
&lt;/Group&gt;
&lt;Group description="Gadget Text" selector=".sidebar .widget"&gt;
&lt;Variable name="widget.font" description="Font" type="font"
default="normal normal 14px Arial, Tahoma, Helvetica, FreeSans, sans-serif" value="normal normal 14px Open Sans"/&gt;
&lt;Variable name="widget.text.color" description="Text Color" type="color" default="$(body.text.color)" value="#4c4c4c"/&gt;
&lt;Variable name="widget.alternate.text.color" description="Alternate Color" type="color" default="#666666" value="#6a6a6a"/&gt;
&lt;/Group&gt;
&lt;Group description="Gadget Links" selector=".sidebar .widget"&gt;
&lt;Variable name="widget.link.color" description="Link Color" type="color" default="$(link.color)" value="#3b7ace"/&gt;
&lt;Variable name="widget.link.visited.color" description="Visited Color" type="color" default="$(link.visited.color)" value="#4f48a0"/&gt;
&lt;Variable name="widget.link.hover.color" description="Hover Color" type="color" default="$(link.hover.color)" value="#3b7ace"/&gt;
&lt;/Group&gt;
&lt;Group description="Gadget Background" selector=".sidebar .widget"&gt;
&lt;Variable name="widget.background.color" description="Background Color" type="color" default="#141414" value="#ffffff"/&gt;
&lt;Variable name="widget.border.color" description="Border Color" type="color" default="#222222" value="#eeeeee"/&gt;
&lt;Variable name="widget.border.bevel.color" description="Bevel Color" type="color" default="#000000" value="transparent"/&gt;
&lt;/Group&gt;
&lt;Group description="Sidebar Background" selector=".column-left-inner .column-right-inner"&gt;
&lt;Variable name="widget.outer.background.color" description="Background Color" type="color" default="transparent"  value="transparent"/&gt;
&lt;/Group&gt;
&lt;Group description="Images" selector=".main-inner"&gt;
&lt;Variable name="image.background.color" description="Background Color" type="color" default="transparent" value="transparent"/&gt;
&lt;Variable name="image.border.color" description="Border Color" type="color" default="transparent" value="transparent"/&gt;
&lt;/Group&gt;
&lt;Group description="Feed" selector=".blog-feeds"&gt;
&lt;Variable name="feed.text.color" description="Text Color" type="color" default="$(body.text.color)" value="#4c4c4c"/&gt;
&lt;/Group&gt;
&lt;Group description="Feed Links" selector=".blog-feeds"&gt;
&lt;Variable name="feed.link.color" description="Link Color" type="color" default="$(link.color)" value="#3b7ace"/&gt;
&lt;Variable name="feed.link.visited.color" description="Visited Color" type="color" default="$(link.visited.color)" value="#4f48a0"/&gt;
&lt;Variable name="feed.link.hover.color" description="Hover Color" type="color" default="$(link.hover.color)" value="#3b7ace"/&gt;
&lt;/Group&gt;
&lt;Group description="Pager" selector=".blog-pager"&gt;
&lt;Variable name="pager.background.color" description="Background Color" type="color" default="$(post.background.color)"  value="#ffffff"/&gt;
&lt;/Group&gt;
&lt;Group description="Footer" selector=".footer-outer"&gt;
&lt;Variable name="footer.background.color" description="Background Color" type="color" default="$(widget.background.color)"  value="#ffffff"/&gt;
&lt;Variable name="footer.text.color" description="Text Color" type="color" default="$(body.text.color)"  value="#4c4c4c"/&gt;
&lt;/Group&gt;
&lt;Variable name="title.shadow.spread" description="Title Shadow" type="length" default="-1px" value="-1px"/&gt;
&lt;Variable name="body.background" description="Body Background" type="background"
color="$(body.background.color)"
default="$(color) none repeat scroll top left" value="$(color) none no-repeat scroll center center"/&gt;
&lt;Variable name="body.background.gradient.cap" description="Body Gradient Cap" type="url"
default="none" value="none"/&gt;
&lt;Variable name="body.background.size" description="Body Background Size" type="string" default="auto" value="auto"/&gt;
&lt;Variable name="tabs.background.gradient" description="Tabs Background Gradient" type="url"
default="none" value="url(//www.blogblog.com/1kt/awesomeinc/tabs_gradient_light.png)"/&gt;
&lt;Variable name="header.background.gradient" description="Header Background Gradient" type="url" default="none"  value="none"/&gt;
&lt;Variable name="header.padding.top" description="Header Top Padding" type="length" default="22px"  value="22px"/&gt;
&lt;Variable name="header.margin.top" description="Header Top Margin" type="length" default="0"  value="0"/&gt;
&lt;Variable name="header.margin.bottom" description="Header Bottom Margin" type="length" default="0"  value="0"/&gt;
&lt;Variable name="widget.padding.top" description="Widget Padding Top" type="length" default="8px"  value="8px"/&gt;
&lt;Variable name="widget.padding.side" description="Widget Padding Side" type="length" default="15px"  value="15px"/&gt;
&lt;Variable name="widget.outer.margin.top" description="Widget Top Margin" type="length" default="0"  value="0"/&gt;
&lt;Variable name="widget.outer.background.gradient" description="Gradient" type="url" default="none"  value="none"/&gt;
&lt;Variable name="widget.border.radius" description="Gadget Border Radius" type="length" default="0"  value="0"/&gt;
&lt;Variable name="outer.shadow.spread" description="Outer Shadow Size" type="length" default="0"  value="0"/&gt;
&lt;Variable name="date.header.border.radius.top" description="Date Header Border Radius Top" type="length" default="0"  value="0"/&gt;
&lt;Variable name="date.header.position" description="Date Header Position" type="length" default="15px"  value="15px"/&gt;
&lt;Variable name="date.space" description="Date Space" type="length" default="30px"  value="30px"/&gt;
&lt;Variable name="date.position" description="Date Float" type="string" default="static"  value="static"/&gt;
&lt;Variable name="date.padding.bottom" description="Date Padding Bottom" type="length" default="0"  value="0"/&gt;
&lt;Variable name="date.border.size" description="Date Border Size" type="length" default="0"  value="0"/&gt;
&lt;Variable name="date.background" description="Date Background" type="background" color="transparent"
default="$(color) none no-repeat scroll top left"  value="$(color) none no-repeat scroll top left"/&gt;
&lt;Variable name="date.first.border.radius.top" description="Date First top radius" type="length" default="$(widget.border.radius)"  value="0"/&gt;
&lt;Variable name="date.last.space.bottom" description="Date Last Space Bottom" type="length"
default="20px"  value="20px"/&gt;
&lt;Variable name="date.last.border.radius.bottom" description="Date Last bottom radius" type="length" default="$(widget.border.radius)"  value="0"/&gt;
&lt;Variable name="post.first.padding.top" description="First Post Padding Top" type="length" default="0"  value="0"/&gt;
&lt;Variable name="image.shadow.spread" description="Image Shadow Size" type="length" default="0" value="0"/&gt;
&lt;Variable name="image.border.radius" description="Image Border Radius" type="length" default="0" value="0"/&gt;
&lt;Variable name="separator.outdent" description="Separator Outdent" type="length" default="15px"  value="15px"/&gt;
&lt;Variable name="title.separator.border.size" description="Widget Title Border Size" type="length" default="1px"  value="1px"/&gt;
&lt;Variable name="list.separator.border.size" description="List Separator Border Size" type="length" default="1px"  value="1px"/&gt;
&lt;Variable name="shadow.spread" description="Shadow Size" type="length" default="0" value="20px"/&gt;
&lt;Variable name="startSide" description="Side where text starts in blog language" type="automatic" default="left"/&gt;
&lt;Variable name="endSide" description="Side where text ends in blog language" type="automatic" default="right"/&gt;
&lt;Variable name="date.side" description="Side where date header is placed" type="string" default="$(endSide)" value="right"/&gt;
&lt;Variable name="pager.border.radius.top" description="Pager Border Top Radius" type="length" default="$(widget.border.radius)"  value="0"/&gt;
&lt;Variable name="pager.space.top" description="Pager Top Space" type="length" default="1em"  value="1em"/&gt;
&lt;Variable name="footer.background.gradient" description="Background Gradient" type="url" default="none"  value="none"/&gt;
&lt;Variable name="mobile.background.size" description="Mobile Background Size" type="string"
default="$(body.background.size)" value="auto"/&gt;
&lt;Variable name="mobile.background.overlay" description="Mobile Background Overlay" type="string"
default="transparent none repeat scroll top left" value="transparent none repeat scroll top left"/&gt;
&lt;Variable name="mobile.button.color" description="Mobile Button Color" type="color" default="#ffffff"  value="#ffffff"/&gt;
*/
/* Content
----------------------------------------------- */
body {
font: $(body.font);
color: $(body.text.color);
background: $(body.background);
}
html body .content-outer {
min-width: 0;
max-width: 100%;
width: 100%;
}
a:link {
text-decoration: none;
color: $(link.color);
}
a:visited {
text-decoration: none;
color: $(link.visited.color);
}
a:hover {
text-decoration: underline;
color: $(link.hover.color);
}
.body-fauxcolumn-outer .cap-top {
position: absolute;
z-index: 1;
height: 276px;
width: 100%;
background: transparent $(body.background.gradient.cap) repeat-x scroll top left;
_background-image: none;
}
/* Columns
----------------------------------------------- */
.content-inner {
padding: 0;
}
.header-inner .section {
margin: 0 16px;
}
.tabs-inner .section {
margin: 0 16px;
}
.main-inner {
padding-top: $(date.space);
}
.main-inner .column-center-inner,
.main-inner .column-left-inner,
.main-inner .column-right-inner {
padding: 0 5px;
}
*+html body .main-inner .column-center-inner {
margin-top: -$(date.space);
}
#layout .main-inner .column-center-inner {
margin-top: 0;
}
/* Header
----------------------------------------------- */
.header-outer {
margin: $(header.margin.top) 0 $(header.margin.bottom) 0;
background: $(header.background.color) $(header.background.gradient) repeat scroll 0 0;
}
.Header h1 {
font: $(header.font);
color: $(header.text.color);
text-shadow: 0 0 $(title.shadow.spread) #000000;
}
.Header h1 a {
color: $(header.text.color);
}
.Header .description {
font: $(description.font);
color: $(description.text.color);
}
.header-inner .Header .titlewrapper,
.header-inner .Header .descriptionwrapper {
padding-left: 0;
padding-right: 0;
margin-bottom: 0;
}
.header-inner .Header .titlewrapper {
padding-top: $(header.padding.top);
}
/* Tabs
----------------------------------------------- */
.tabs-outer {
overflow: hidden;
position: relative;
background: $(tabs.background.color) $(tabs.background.gradient) repeat scroll 0 0;
}
#layout .tabs-outer {
overflow: visible;
}
.tabs-cap-top, .tabs-cap-bottom {
position: absolute;
width: 100%;
border-top: 1px solid $(tabs.border.color);
}
.tabs-cap-bottom {
bottom: 0;
}
.tabs-inner .widget li a {
display: inline-block;
margin: 0;
padding: .6em 1.5em;
font: $(tabs.font);
color: $(tabs.text.color);
border-top: 1px solid $(tabs.border.color);
border-bottom: 1px solid $(tabs.border.color);
border-$startSide: 1px solid $(tabs.border.color);
height: 16px;
line-height: 16px;
}
.tabs-inner .widget li:last-child a {
border-$endSide: 1px solid $(tabs.border.color);
}
.tabs-inner .widget li.selected a, .tabs-inner .widget li a:hover {
background: $(tabs.selected.background.color) $(tabs.background.gradient) repeat-x scroll 0 -100px;
color: $(tabs.selected.text.color);
}
/* Headings
----------------------------------------------- */
h2 {
font: $(widget.title.font);
color: $(widget.title.text.color);
}
/* Widgets
----------------------------------------------- */
.main-inner .section {
margin: 0 27px;
padding: 0;
}
.main-inner .column-left-outer,
.main-inner .column-right-outer {
margin-top: $(widget.outer.margin.top);
}
#layout .main-inner .column-left-outer,
#layout .main-inner .column-right-outer {
margin-top: 0;
}
.main-inner .column-left-inner,
.main-inner .column-right-inner {
background: $(widget.outer.background.color) $(widget.outer.background.gradient) repeat 0 0;
-moz-box-shadow: 0 0 $(outer.shadow.spread) rgba(0, 0, 0, .2);
-webkit-box-shadow: 0 0 $(outer.shadow.spread) rgba(0, 0, 0, .2);
-goog-ms-box-shadow: 0 0 $(outer.shadow.spread) rgba(0, 0, 0, .2);
box-shadow: 0 0 $(outer.shadow.spread) rgba(0, 0, 0, .2);
-moz-border-radius: $(widget.border.radius);
-webkit-border-radius: $(widget.border.radius);
-goog-ms-border-radius: $(widget.border.radius);
border-radius: $(widget.border.radius);
}
#layout .main-inner .column-left-inner,
#layout .main-inner .column-right-inner {
margin-top: 0;
}
.sidebar .widget {
font: $(widget.font);
color: $(widget.text.color);
}
.sidebar .widget a:link {
color: $(widget.link.color);
}
.sidebar .widget a:visited {
color: $(widget.link.visited.color);
}
.sidebar .widget a:hover {
color: $(widget.link.hover.color);
}
.sidebar .widget h2 {
text-shadow: 0 0 $(title.shadow.spread) #000000;
}
.main-inner .widget {
background-color: $(widget.background.color);
border: 1px solid $(widget.border.color);
padding: 0 $(widget.padding.side) 15px;
margin: 20px -16px;
-moz-box-shadow: 0 0 $(shadow.spread) rgba(0, 0, 0, .2);
-webkit-box-shadow: 0 0 $(shadow.spread) rgba(0, 0, 0, .2);
-goog-ms-box-shadow: 0 0 $(shadow.spread) rgba(0, 0, 0, .2);
box-shadow: 0 0 $(shadow.spread) rgba(0, 0, 0, .2);
-moz-border-radius: $(widget.border.radius);
-webkit-border-radius: $(widget.border.radius);
-goog-ms-border-radius: $(widget.border.radius);
border-radius: $(widget.border.radius);
}
.main-inner .widget h2 {
margin: 0 -$(separator.outdent);
padding: .6em $(separator.outdent) .5em;
border-bottom: 1px solid $(widget.border.bevel.color);
}
.footer-inner .widget h2 {
padding: 0 0 .4em;
border-bottom: 1px solid $(widget.border.bevel.color);
}
.main-inner .widget h2 + div, .footer-inner .widget h2 + div {
border-top: $(title.separator.border.size) solid $(widget.border.color);
padding-top: $(widget.padding.top);
}
.main-inner .widget .widget-content {
margin: 0 -$(separator.outdent);
padding: 7px $(separator.outdent) 0;
}
.main-inner .widget ul, .main-inner .widget #ArchiveList ul.flat {
margin: -$(widget.padding.top) -15px 0;
padding: 0;
list-style: none;
}
.main-inner .widget #ArchiveList {
margin: -$(widget.padding.top) 0 0;
}
.main-inner .widget ul li, .main-inner .widget #ArchiveList ul.flat li {
padding: .5em 15px;
text-indent: 0;
color: $(widget.alternate.text.color);
border-top: $(list.separator.border.size) solid $(widget.border.color);
border-bottom: 1px solid $(widget.border.bevel.color);
}
.main-inner .widget #ArchiveList ul li {
padding-top: .25em;
padding-bottom: .25em;
}
.main-inner .widget ul li:first-child, .main-inner .widget #ArchiveList ul.flat li:first-child {
border-top: none;
}
.main-inner .widget ul li:last-child, .main-inner .widget #ArchiveList ul.flat li:last-child {
border-bottom: none;
}
.post-body {
position: relative;
}
.main-inner .widget .post-body ul {
padding: 0 2.5em;
margin: .5em 0;
list-style: disc;
}
.main-inner .widget .post-body ul li {
padding: 0.25em 0;
margin-bottom: .25em;
color: $(body.text.color);
border: none;
}
.footer-inner .widget ul {
padding: 0;
list-style: none;
}
.widget .zippy {
color: $(widget.alternate.text.color);
}
/* Posts
----------------------------------------------- */
body .main-inner .Blog {
padding: 0;
margin-bottom: 1em;
background-color: transparent;
border: none;
-moz-box-shadow: 0 0 0 rgba(0, 0, 0, 0);
-webkit-box-shadow: 0 0 0 rgba(0, 0, 0, 0);
-goog-ms-box-shadow: 0 0 0 rgba(0, 0, 0, 0);
box-shadow: 0 0 0 rgba(0, 0, 0, 0);
}
.main-inner .section:last-child .Blog:last-child {
padding: 0;
margin-bottom: 1em;
}
.main-inner .widget h2.date-header {
margin: 0 -15px 1px;
padding: 0 0 $(date.padding.bottom) 0;
font: $(date.font);
color: $(date.text.color);
background: $(date.background);
border-top: $(date.border.size) solid $(date.border.color);
border-bottom: 1px solid $(widget.border.bevel.color);
-moz-border-radius-topleft: $(date.header.border.radius.top);
-moz-border-radius-topright: $(date.header.border.radius.top);
-webkit-border-top-left-radius: $(date.header.border.radius.top);
-webkit-border-top-right-radius: $(date.header.border.radius.top);
border-top-left-radius: $(date.header.border.radius.top);
border-top-right-radius: $(date.header.border.radius.top);
position: $(date.position);
bottom: 100%;
$(date.side): $(date.header.position);
text-shadow: 0 0 $(title.shadow.spread) #000000;
}
.main-inner .widget h2.date-header span {
font: $(date.font);
display: block;
padding: .5em 15px;
border-left: $(date.border.size) solid $(date.border.color);
border-right: $(date.border.size) solid $(date.border.color);
}
.date-outer {
position: relative;
margin: $(date.space) 0 20px;
padding: 0 15px;
background-color: $(post.background.color);
border: 1px solid $(post.border.color);
-moz-box-shadow: 0 0 $(shadow.spread) rgba(0, 0, 0, .2);
-webkit-box-shadow: 0 0 $(shadow.spread) rgba(0, 0, 0, .2);
-goog-ms-box-shadow: 0 0 $(shadow.spread) rgba(0, 0, 0, .2);
box-shadow: 0 0 $(shadow.spread) rgba(0, 0, 0, .2);
-moz-border-radius: $(widget.border.radius);
-webkit-border-radius: $(widget.border.radius);
-goog-ms-border-radius: $(widget.border.radius);
border-radius: $(widget.border.radius);
}
.date-outer:first-child {
margin-top: 0;
}
.date-outer:last-child {
margin-bottom: $(date.last.space.bottom);
-moz-border-radius-bottomleft: $(date.last.border.radius.bottom);
-moz-border-radius-bottomright: $(date.last.border.radius.bottom);
-webkit-border-bottom-left-radius: $(date.last.border.radius.bottom);
-webkit-border-bottom-right-radius: $(date.last.border.radius.bottom);
-goog-ms-border-bottom-left-radius: $(date.last.border.radius.bottom);
-goog-ms-border-bottom-right-radius: $(date.last.border.radius.bottom);
border-bottom-left-radius: $(date.last.border.radius.bottom);
border-bottom-right-radius: $(date.last.border.radius.bottom);
}
.date-posts {
margin: 0 -$(separator.outdent);
padding: 0 $(separator.outdent);
clear: both;
}
.post-outer, .inline-ad {
border-top: 1px solid $(post.border.bevel.color);
margin: 0 -$(separator.outdent);
padding: 15px $(separator.outdent);
}
.post-outer {
padding-bottom: 10px;
}
.post-outer:first-child {
padding-top: $(post.first.padding.top);
border-top: none;
}
.post-outer:last-child, .inline-ad:last-child {
border-bottom: none;
}
.post-body {
position: relative;
}
.post-body img {
padding: 8px;
background: $(image.background.color);
border: 1px solid $(image.border.color);
-moz-box-shadow: 0 0 $(image.shadow.spread) rgba(0, 0, 0, .2);
-webkit-box-shadow: 0 0 $(image.shadow.spread) rgba(0, 0, 0, .2);
box-shadow: 0 0 $(image.shadow.spread) rgba(0, 0, 0, .2);
-moz-border-radius: $(image.border.radius);
-webkit-border-radius: $(image.border.radius);
border-radius: $(image.border.radius);
}
h3.post-title, h4 {
font: $(post.title.font);
color: $(post.title.text.color);
}
h3.post-title a {
font: $(post.title.font);
color: $(post.title.text.color);
}
h3.post-title a:hover {
color: $(link.hover.color);
text-decoration: underline;
}
.post-header {
margin: 0 0 1em;
}
.post-body {
line-height: 1.4;
}
.post-outer h2 {
color: $(body.text.color);
}
.post-footer {
margin: 1.5em 0 0;
}
#blog-pager {
padding: 15px;
font-size: 120%;
background-color: $(pager.background.color);
border: 1px solid $(widget.border.color);
-moz-box-shadow: 0 0 $(shadow.spread) rgba(0, 0, 0, .2);
-webkit-box-shadow: 0 0 $(shadow.spread) rgba(0, 0, 0, .2);
-goog-ms-box-shadow: 0 0 $(shadow.spread) rgba(0, 0, 0, .2);
box-shadow: 0 0 $(shadow.spread) rgba(0, 0, 0, .2);
-moz-border-radius: $(widget.border.radius);
-webkit-border-radius: $(widget.border.radius);
-goog-ms-border-radius: $(widget.border.radius);
border-radius: $(widget.border.radius);
-moz-border-radius-topleft: $(pager.border.radius.top);
-moz-border-radius-topright: $(pager.border.radius.top);
-webkit-border-top-left-radius: $(pager.border.radius.top);
-webkit-border-top-right-radius: $(pager.border.radius.top);
-goog-ms-border-top-left-radius: $(pager.border.radius.top);
-goog-ms-border-top-right-radius: $(pager.border.radius.top);
border-top-left-radius: $(pager.border.radius.top);
border-top-right-radius-topright: $(pager.border.radius.top);
margin-top: $(pager.space.top);
}
.blog-feeds, .post-feeds {
margin: 1em 0;
text-align: center;
color: $(feed.text.color);
}
.blog-feeds a, .post-feeds a {
color: $(feed.link.color);
}
.blog-feeds a:visited, .post-feeds a:visited {
color: $(feed.link.visited.color);
}
.blog-feeds a:hover, .post-feeds a:hover {
color: $(feed.link.hover.color);
}
.post-outer .comments {
margin-top: 2em;
}
/* Comments
----------------------------------------------- */
.comments .comments-content .icon.blog-author {
background-repeat: no-repeat;
background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEgAACxIB0t1+/AAAAAd0SU1FB9sLFwMeCjjhcOMAAAD+SURBVDjLtZSvTgNBEIe/WRRnm3U8RC1neQdsm1zSBIU9VVF1FkUguQQsD9ITmD7ECZIJSE4OZo9stoVjC/zc7ky+zH9hXwVwDpTAWWLrgS3QAe8AZgaAJI5zYAmc8r0G4AHYHQKVwII8PZrZFsBFkeRCABYiMh9BRUhnSkPTNCtVXYXURi1FpBDgArj8QU1eVXUzfnjv7yP7kwu1mYrkWlU33vs1QNu2qU8pwN0UpKoqokjWwCztrMuBhEhmh8bD5UDqur75asbcX0BGUB9/HAMB+r32hznJgXy2v0sGLBcyAJ1EK3LFcbo1s91JeLwAbwGYu7TP/3ZGfnXYPgAVNngtqatUNgAAAABJRU5ErkJggg==);
}
.comments .comments-content .loadmore a {
border-top: 1px solid $(tabs.border.color);
border-bottom: 1px solid $(tabs.border.color);
}
.comments .continue {
border-top: 2px solid $(tabs.border.color);
}
/* Footer
----------------------------------------------- */
.footer-outer {
margin: -$(shadow.spread) 0 -1px;
padding: $(shadow.spread) 0 0;
color: $(footer.text.color);
overflow: hidden;
}
.footer-fauxborder-left {
border-top: 1px solid $(widget.border.color);
background: $(footer.background.color) $(footer.background.gradient) repeat scroll 0 0;
-moz-box-shadow: 0 0 $(shadow.spread) rgba(0, 0, 0, .2);
-webkit-box-shadow: 0 0 $(shadow.spread) rgba(0, 0, 0, .2);
-goog-ms-box-shadow: 0 0 $(shadow.spread) rgba(0, 0, 0, .2);
box-shadow: 0 0 $(shadow.spread) rgba(0, 0, 0, .2);
margin: 0 -$(shadow.spread);
}
/* Mobile
----------------------------------------------- */
body.mobile {
background-size: $(mobile.background.size);
}
.mobile .body-fauxcolumn-outer {
background: $(mobile.background.overlay);
}
*+html body.mobile .main-inner .column-center-inner {
margin-top: 0;
}
.mobile .main-inner .widget {
padding: 0 0 15px;
}
.mobile .main-inner .widget h2 + div,
.mobile .footer-inner .widget h2 + div {
border-top: none;
padding-top: 0;
}
.mobile .footer-inner .widget h2 {
padding: 0.5em 0;
border-bottom: none;
}
.mobile .main-inner .widget .widget-content {
margin: 0;
padding: 7px 0 0;
}
.mobile .main-inner .widget ul,
.mobile .main-inner .widget #ArchiveList ul.flat {
margin: 0 -15px 0;
}
.mobile .main-inner .widget h2.date-header {
$(date.side): 0;
}
.mobile .date-header span {
padding: 0.4em 0;
}
.mobile .date-outer:first-child {
margin-bottom: 0;
border: 1px solid $(post.border.color);
-moz-border-radius-topleft: $(date.first.border.radius.top);
-moz-border-radius-topright: $(date.first.border.radius.top);
-webkit-border-top-left-radius: $(date.first.border.radius.top);
-webkit-border-top-right-radius: $(date.first.border.radius.top);
-goog-ms-border-top-left-radius: $(date.first.border.radius.top);
-goog-ms-border-top-right-radius: $(date.first.border.radius.top);
border-top-left-radius: $(date.first.border.radius.top);
border-top-right-radius: $(date.first.border.radius.top);
}
.mobile .date-outer {
border-color: $(post.border.color);
border-width: 0 1px 1px;
}
.mobile .date-outer:last-child {
margin-bottom: 0;
}
.mobile .main-inner {
padding: 0;
}
.mobile .header-inner .section {
margin: 0;
}
.mobile .post-outer, .mobile .inline-ad {
padding: 5px 0;
}
.mobile .tabs-inner .section {
margin: 0 10px;
}
.mobile .main-inner .widget h2 {
margin: 0;
padding: 0;
}
.mobile .main-inner .widget h2.date-header span {
padding: 0;
}
.mobile .main-inner .widget .widget-content {
margin: 0;
padding: 7px 0 0;
}
.mobile #blog-pager {
border: 1px solid transparent;
background: $(footer.background.color) $(footer.background.gradient) repeat scroll 0 0;
}
.mobile .main-inner .column-left-inner,
.mobile .main-inner .column-right-inner {
background: $(widget.outer.background.color) $(widget.outer.background.gradient) repeat 0 0;
-moz-box-shadow: none;
-webkit-box-shadow: none;
-goog-ms-box-shadow: none;
box-shadow: none;
}
.mobile .date-posts {
margin: 0;
padding: 0;
}
.mobile .footer-fauxborder-left {
margin: 0;
border-top: inherit;
}
.mobile .main-inner .section:last-child .Blog:last-child {
margin-bottom: 0;
}
.mobile-index-contents {
color: $(body.text.color);
}
.mobile .mobile-link-button {
background: $(link.color) $(tabs.background.gradient) repeat scroll 0 0;
}
.mobile-link-button a:link, .mobile-link-button a:visited {
color: $(mobile.button.color);
}
.mobile .tabs-inner .PageList .widget-content {
background: transparent;
border-top: 1px solid;
border-color: $(tabs.border.color);
color: $(tabs.text.color);
}
.mobile .tabs-inner .PageList .widget-content .pagelist-arrow {
border-$startSide: 1px solid $(tabs.border.color);
}

    ]]&gt;&lt;/b:skin&gt;
    &lt;b:template-skin&gt;
      &lt;b:variable default='960px' name='content.width' type='length' value='1100px'/&gt;
      &lt;b:variable default='0' name='main.column.left.width' type='length'/&gt;
      &lt;b:variable default='310px' name='main.column.right.width' type='length' value='300px'/&gt;
      &lt;![CDATA[
body {
min-width: $(content.width);
}
.content-outer, .content-fauxcolumn-outer, .region-inner {
min-width: $(content.width);
max-width: $(content.width);
_width: $(content.width);
}
.main-inner .columns {
padding-left: $(main.column.left.width);
padding-right: $(main.column.right.width);
}
.main-inner .fauxcolumn-center-outer {
left: $(main.column.left.width);
right: $(main.column.right.width);
/* IE6 does not respect left and right together */
_width: expression(this.parentNode.offsetWidth -
parseInt("$(main.column.left.width)") -
parseInt("$(main.column.right.width)") + 'px');
}
.main-inner .fauxcolumn-left-outer {
width: $(main.column.left.width);
}
.main-inner .fauxcolumn-right-outer {
width: $(main.column.right.width);
}
.main-inner .column-left-outer {
width: $(main.column.left.width);
right: 100%;
margin-left: -$(main.column.left.width);
}
.main-inner .column-right-outer {
width: $(main.column.right.width);
margin-right: -$(main.column.right.width);
}
#layout {
min-width: 0;
}
#layout .content-outer {
min-width: 0;
width: 800px;
}
#layout .region-inner {
min-width: 0;
width: auto;
}
]]&gt;
    &lt;/b:template-skin&gt;
    &lt;b:include data='blog' name='google-analytics'/&gt;
    &lt;!--SYNTAX HIGHLIGHTER BEGINS--&gt;
    &lt;link href='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/default.min.css' rel='stylesheet'/&gt;
    &lt;script src='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/highlight.min.js'/&gt;
    &lt;script src='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/languages/powershell.min.js'/&gt;
    &lt;script&gt;hljs.highlightAll();&lt;/script&gt;
    &lt;!--
    &lt;link href='http://fonts.googleapis.com/css?family=Inconsolata' rel='stylesheet' type='text/css'/&gt;
    &lt;script src='https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js'/&gt;
    --&gt;
    &lt;style&gt;
pre &amp;gt; code { font-size: 0.7em; }
/*
pre.prettyprint { font-size: 0.7em; white-space: pre-wrap; }
code, pre.prettyprint {
    font-family: Inconsolata,Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,serif;
}
*/

blockquote{
  display:block;
  background: #fff;
  padding: 15px 20px 15px 45px;
  margin: 0 0 20px;
  position: relative;
  
  /*Font*/
  /*font-family: Georgia, serif;
  font-size: 16px;*/
  line-height: 1.2;
  color: #666;
  text-align: justify;
  
  /*Borders - (Optional)*/
  border-left: 15px solid #c76c0c;
  border-right: 2px solid #c76c0c;
  
  /*Box Shadow - (Optional)*/
  -moz-box-shadow: 2px 2px 15px #ccc;
  -webkit-box-shadow: 2px 2px 15px #ccc;
  box-shadow: 2px 2px 15px #ccc;
}

blockquote::before{
  content: &amp;quot;\201C&amp;quot;; /*Unicode for Left Double Quote*/
  
  /*Font*/
  font-family: Georgia, serif;
  font-size: 60px;
  font-weight: bold;
  color: #999;
  
  /*Positioning*/
  position: absolute;
  left: 10px;
  top:5px;
}

blockquote::after{
  /*Reset to make sure*/
  content: &amp;quot;&amp;quot;;
}

blockquote a{
  text-decoration: none;
  background: #eee;
  cursor: pointer;
  padding: 0 3px;
  color: #c76c0c;
}

blockquote a:hover{
 color: #666;
}

blockquote em{
  font-style: italic;
}
    &lt;/style&gt;
    &lt;!--SYNTAX HIGHLIGHTER ENDS--&gt;
&lt;/head&gt;
  &lt;body expr:class='&amp;quot;loading&amp;quot; + data:blog.mobileClass'&gt;
    &lt;b:section class='navbar' id='navbar' maxwidgets='1' showaddelement='no'&gt;
      &lt;b:widget id='Navbar1' locked='false' title='Navbar' type='Navbar'&gt;
        &lt;b:includable id='main'&gt;&amp;lt;script type=&amp;quot;text/javascript&amp;quot;&amp;gt;
    function setAttributeOnload(object, attribute, val) {
      if(window.addEventListener) {
        window.addEventListener(&amp;#39;load&amp;#39;,
          function(){ object[attribute] = val; }, false);
      } else {
        window.attachEvent(&amp;#39;onload&amp;#39;, function(){ object[attribute] = val; });
      }
    }
  &amp;lt;/script&amp;gt;
&amp;lt;div id=&amp;quot;navbar-iframe-container&amp;quot;&amp;gt;&amp;lt;/div&amp;gt;
&amp;lt;script type=&amp;quot;text/javascript&amp;quot; src=&amp;quot;https://apis.google.com/js/plusone.js&amp;quot;&amp;gt;&amp;lt;/script&amp;gt;
&amp;lt;script type=&amp;quot;text/javascript&amp;quot;&amp;gt;
      gapi.load(&amp;quot;gapi.iframes:gapi.iframes.style.bubble&amp;quot;, function() {
        if (gapi.iframes &amp;amp;&amp;amp; gapi.iframes.getContext) {
          gapi.iframes.getContext().openChild({
              url: &amp;#39;https://www.blogger.com/navbar.g?targetBlogID\x3d3759615474523601615\x26blogName\x3dI+CAN+MAKE+THIS+WORK...\x26publishMode\x3dPUBLISH_MODE_BLOGSPOT\x26navbarType\x3dDISABLED\x26layoutType\x3dLAYOUTS\x26searchRoot\x3dhttps://icanmakethiswork.blogspot.com/search\x26blogLocale\x3den_GB\x26v\x3d2\x26homepageUrl\x3dhttps://icanmakethiswork.blogspot.com/\x26vt\x3d-6287945319692689253&amp;#39;,
              where: document.getElementById(&amp;quot;navbar-iframe-container&amp;quot;),
              id: &amp;quot;navbar-iframe&amp;quot;
          });
        }
      });
    &amp;lt;/script&amp;gt;&amp;lt;script type=&amp;quot;text/javascript&amp;quot;&amp;gt;
(function() {
var script = document.createElement(&amp;#39;script&amp;#39;);
script.type = &amp;#39;text/javascript&amp;#39;;
script.src = &amp;#39;//pagead2.googlesyndication.com/pagead/js/google_top_exp.js&amp;#39;;
var head = document.getElementsByTagName(&amp;#39;head&amp;#39;)[0];
if (head) {
head.appendChild(script);
}})();
&amp;lt;/script&amp;gt;
&lt;/b:includable&gt;
      &lt;/b:widget&gt;
    &lt;/b:section&gt;
    &lt;b:if cond='data:blog.pageType == &amp;quot;index&amp;quot;'&gt;
      &lt;div itemscope='itemscope' itemtype='http://schema.org/Blog' style='display: none;'&gt;
        &lt;meta expr:content='data:blog.title' itemprop='name'/&gt;
        &lt;b:if cond='data:blog.metaDescription'&gt;
          &lt;meta expr:content='data:blog.metaDescription' itemprop='description'/&gt;
        &lt;/b:if&gt;
      &lt;/div&gt;
    &lt;/b:if&gt;
    &lt;div class='body-fauxcolumns'&gt;
      &lt;div class='fauxcolumn-outer body-fauxcolumn-outer'&gt;
        &lt;div class='cap-top'&gt;
          &lt;div class='cap-left'/&gt;
          &lt;div class='cap-right'/&gt;
        &lt;/div&gt;
        &lt;div class='fauxborder-left'&gt;
          &lt;div class='fauxborder-right'/&gt;
          &lt;div class='fauxcolumn-inner'&gt;
          &lt;/div&gt;
        &lt;/div&gt;
        &lt;div class='cap-bottom'&gt;
          &lt;div class='cap-left'/&gt;
          &lt;div class='cap-right'/&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
    &lt;div class='content'&gt;
      &lt;div class='content-fauxcolumns'&gt;
        &lt;div class='fauxcolumn-outer content-fauxcolumn-outer'&gt;
          &lt;div class='cap-top'&gt;
            &lt;div class='cap-left'/&gt;
            &lt;div class='cap-right'/&gt;
          &lt;/div&gt;
          &lt;div class='fauxborder-left'&gt;
            &lt;div class='fauxborder-right'/&gt;
            &lt;div class='fauxcolumn-inner'&gt;
            &lt;/div&gt;
          &lt;/div&gt;
          &lt;div class='cap-bottom'&gt;
            &lt;div class='cap-left'/&gt;
            &lt;div class='cap-right'/&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
      &lt;div class='content-outer'&gt;
        &lt;div class='content-cap-top cap-top'&gt;
          &lt;div class='cap-left'/&gt;
          &lt;div class='cap-right'/&gt;
        &lt;/div&gt;
        &lt;div class='fauxborder-left content-fauxborder-left'&gt;
          &lt;div class='fauxborder-right content-fauxborder-right'/&gt;
          &lt;div class='content-inner'&gt;
            &lt;header&gt;
              &lt;div class='header-outer'&gt;
                &lt;div class='header-cap-top cap-top'&gt;
                  &lt;div class='cap-left'/&gt;
                  &lt;div class='cap-right'/&gt;
                &lt;/div&gt;
                &lt;div class='fauxborder-left header-fauxborder-left'&gt;
                  &lt;div class='fauxborder-right header-fauxborder-right'/&gt;
                  &lt;div class='region-inner header-inner'&gt;
                    &lt;b:section class='header' id='header' maxwidgets='1' showaddelement='no'&gt;
                      &lt;b:widget id='Header1' locked='false' title='I CAN MAKE THIS WORK... (Header)' type='Header'&gt;
                        &lt;b:widget-settings&gt;
                          &lt;b:widget-setting name='displayUrl'/&gt;
                          &lt;b:widget-setting name='displayHeight'&gt;0&lt;/b:widget-setting&gt;
                          &lt;b:widget-setting name='sectionWidth'&gt;-1&lt;/b:widget-setting&gt;
                          &lt;b:widget-setting name='useImage'&gt;false&lt;/b:widget-setting&gt;
                          &lt;b:widget-setting name='shrinkToFit'&gt;false&lt;/b:widget-setting&gt;
                          &lt;b:widget-setting name='imagePlacement'&gt;BEHIND&lt;/b:widget-setting&gt;
                          &lt;b:widget-setting name='displayWidth'&gt;0&lt;/b:widget-setting&gt;
                        &lt;/b:widget-settings&gt;
                        &lt;b:includable id='main'&gt;
                          &lt;b:if cond='data:useImage'&gt;
                            &lt;b:if cond='data:imagePlacement == &amp;quot;BEHIND&amp;quot;'&gt;
                              &lt;!--
Show image as background to text. You can't really calculate the width
reliably in JS because margins are not taken into account by any of
clientWidth, offsetWidth or scrollWidth, so we don't force a minimum
width if the user is using shrink to fit.
This results in a margin-width's worth of pixels being cropped. If the
user is not using shrink to fit then we expand the header.
--&gt;
                              &lt;b:if cond='data:mobile'&gt;
                                &lt;div id='header-inner'&gt;
                                  &lt;div class='titlewrapper' style='background: transparent'&gt;
                                    &lt;h1 class='title' style='background: transparent; border-width: 0px'&gt;
                                      &lt;b:include name='title'/&gt;
                                    &lt;/h1&gt;
                                  &lt;/div&gt;
                                  &lt;b:include name='description'/&gt;
                                &lt;/div&gt;
                                &lt;b:else/&gt;
                                &lt;div expr:style='&amp;quot;background-image: url(\&amp;quot;&amp;quot; + data:sourceUrl + &amp;quot;\&amp;quot;); &amp;quot;                        + &amp;quot;background-position: &amp;quot;                        + data:backgroundPositionStyleStr + &amp;quot;; &amp;quot;                        + data:widthStyleStr                        + &amp;quot;min-height: &amp;quot; + data:height                        + &amp;quot;_height: &amp;quot; + data:height                        + &amp;quot;background-repeat: no-repeat; &amp;quot;' id='header-inner'&gt;
                                  &lt;div class='titlewrapper' style='background: transparent'&gt;
                                    &lt;h1 class='title' style='background: transparent; border-width: 0px'&gt;
                                      &lt;b:include name='title'/&gt;
                                    &lt;/h1&gt;
                                  &lt;/div&gt;
                                  &lt;b:include name='description'/&gt;
                                &lt;/div&gt;
                              &lt;/b:if&gt;
                              &lt;b:else/&gt;
                              &lt;!--Show the image only--&gt;
                              &lt;div id='header-inner'&gt;
                                &lt;a expr:href='data:blog.homepageUrl' style='display: block'&gt;
                                  &lt;img expr:alt='data:title' expr:height='data:height' expr:id='data:widget.instanceId + &amp;quot;_headerimg&amp;quot;' expr:src='data:sourceUrl' expr:width='data:width' style='display: block'/&gt;
                                &lt;/a&gt;
                                &lt;!--Show the description--&gt;
                                &lt;b:if cond='data:imagePlacement == &amp;quot;BEFORE_DESCRIPTION&amp;quot;'&gt;
                                  &lt;b:include name='description'/&gt;
                                &lt;/b:if&gt;
                              &lt;/div&gt;
                            &lt;/b:if&gt;
                            &lt;b:else/&gt;
                            &lt;!--No header image --&gt;
                            &lt;div id='header-inner'&gt;
                              &lt;div class='titlewrapper'&gt;
                                &lt;h1 class='title'&gt;
                                  &lt;b:include name='title'/&gt;
                                &lt;/h1&gt;
                              &lt;/div&gt;
                              &lt;b:include name='description'/&gt;
                            &lt;/div&gt;
                          &lt;/b:if&gt;
                        &lt;/b:includable&gt;
                        &lt;b:includable id='description'&gt;
                          &lt;div class='descriptionwrapper'&gt;
                            &lt;p class='description'&gt;
                              &lt;span&gt;
                                &lt;data:description/&gt;
                              &lt;/span&gt;
                            &lt;/p&gt;
                          &lt;/div&gt;
                        &lt;/b:includable&gt;
                        &lt;b:includable id='title'&gt;
                          &lt;b:if cond='data:blog.url == data:blog.homepageUrl'&gt;
                            &lt;data:title/&gt;
                            &lt;b:else/&gt;
                            &lt;a expr:href='data:blog.homepageUrl'&gt;
                              &lt;data:title/&gt;
                            &lt;/a&gt;
                          &lt;/b:if&gt;
                        &lt;/b:includable&gt;
                      &lt;/b:widget&gt;
                    &lt;/b:section&gt;
                  &lt;/div&gt;
                &lt;/div&gt;
                &lt;div class='header-cap-bottom cap-bottom'&gt;
                  &lt;div class='cap-left'/&gt;
                  &lt;div class='cap-right'/&gt;
                &lt;/div&gt;
              &lt;/div&gt;
            &lt;/header&gt;
            &lt;div class='tabs-outer'&gt;
              &lt;div class='tabs-cap-top cap-top'&gt;
                &lt;div class='cap-left'/&gt;
                &lt;div class='cap-right'/&gt;
              &lt;/div&gt;
              &lt;div class='fauxborder-left tabs-fauxborder-left'&gt;
                &lt;div class='fauxborder-right tabs-fauxborder-right'/&gt;
                &lt;div class='region-inner tabs-inner'&gt;
                  &lt;b:section class='tabs' id='crosscol' maxwidgets='1' showaddelement='yes'/&gt;
                  &lt;b:section class='tabs' id='crosscol-overflow' showaddelement='no'/&gt;
                &lt;/div&gt;
              &lt;/div&gt;
              &lt;div class='tabs-cap-bottom cap-bottom'&gt;
                &lt;div class='cap-left'/&gt;
                &lt;div class='cap-right'/&gt;
              &lt;/div&gt;
            &lt;/div&gt;
            &lt;div class='main-outer'&gt;
              &lt;div class='main-cap-top cap-top'&gt;
                &lt;div class='cap-left'/&gt;
                &lt;div class='cap-right'/&gt;
              &lt;/div&gt;
              &lt;div class='fauxborder-left main-fauxborder-left'&gt;
                &lt;div class='fauxborder-right main-fauxborder-right'/&gt;
                &lt;div class='region-inner main-inner'&gt;
                  &lt;div class='columns fauxcolumns'&gt;
                    &lt;div class='fauxcolumn-outer fauxcolumn-center-outer'&gt;
                      &lt;div class='cap-top'&gt;
                        &lt;div class='cap-left'/&gt;
                        &lt;div class='cap-right'/&gt;
                      &lt;/div&gt;
                      &lt;div class='fauxborder-left'&gt;
                        &lt;div class='fauxborder-right'/&gt;
                        &lt;div class='fauxcolumn-inner'&gt;
                        &lt;/div&gt;
                      &lt;/div&gt;
                      &lt;div class='cap-bottom'&gt;
                        &lt;div class='cap-left'/&gt;
                        &lt;div class='cap-right'/&gt;
                      &lt;/div&gt;
                    &lt;/div&gt;
                    &lt;div class='fauxcolumn-outer fauxcolumn-left-outer'&gt;
                      &lt;div class='cap-top'&gt;
                        &lt;div class='cap-left'/&gt;
                        &lt;div class='cap-right'/&gt;
                      &lt;/div&gt;
                      &lt;div class='fauxborder-left'&gt;
                        &lt;div class='fauxborder-right'/&gt;
                        &lt;div class='fauxcolumn-inner'&gt;
                        &lt;/div&gt;
                      &lt;/div&gt;
                      &lt;div class='cap-bottom'&gt;
                        &lt;div class='cap-left'/&gt;
                        &lt;div class='cap-right'/&gt;
                      &lt;/div&gt;
                    &lt;/div&gt;
                    &lt;div class='fauxcolumn-outer fauxcolumn-right-outer'&gt;
                      &lt;div class='cap-top'&gt;
                        &lt;div class='cap-left'/&gt;
                        &lt;div class='cap-right'/&gt;
                      &lt;/div&gt;
                      &lt;div class='fauxborder-left'&gt;
                        &lt;div class='fauxborder-right'/&gt;
                        &lt;div class='fauxcolumn-inner'&gt;
                        &lt;/div&gt;
                      &lt;/div&gt;
                      &lt;div class='cap-bottom'&gt;
                        &lt;div class='cap-left'/&gt;
                        &lt;div class='cap-right'/&gt;
                      &lt;/div&gt;
                    &lt;/div&gt;
                    &lt;!-- corrects IE6 width calculation --&gt;
                    &lt;div class='columns-inner'&gt;
                      &lt;div class='column-center-outer'&gt;
                        &lt;div class='column-center-inner'&gt;
                          &lt;b:section class='main' id='main' showaddelement='no'&gt;
                            &lt;b:widget id='Blog1' locked='false' title='Blog posts' type='Blog'&gt;
                              &lt;b:widget-settings&gt;
                                &lt;b:widget-setting name='showDateHeader'&gt;true&lt;/b:widget-setting&gt;
                                &lt;b:widget-setting name='style.textcolor'&gt;#4c4c4c&lt;/b:widget-setting&gt;
                                &lt;b:widget-setting name='showShareButtons'&gt;true&lt;/b:widget-setting&gt;
                                &lt;b:widget-setting name='showCommentLink'&gt;false&lt;/b:widget-setting&gt;
                                &lt;b:widget-setting name='style.urlcolor'&gt;#4c4c4c&lt;/b:widget-setting&gt;
                                &lt;b:widget-setting name='showAuthor'&gt;false&lt;/b:widget-setting&gt;
                                &lt;b:widget-setting name='disableGooglePlusShare'&gt;true&lt;/b:widget-setting&gt;
                                &lt;b:widget-setting name='style.linkcolor'&gt;#4c4c4c&lt;/b:widget-setting&gt;
                                &lt;b:widget-setting name='style.unittype'&gt;TextAndImage&lt;/b:widget-setting&gt;
                                &lt;b:widget-setting name='style.bgcolor'&gt;#ffffff&lt;/b:widget-setting&gt;
                                &lt;b:widget-setting name='showAuthorProfile'&gt;false&lt;/b:widget-setting&gt;
                                &lt;b:widget-setting name='style.layout'&gt;1x1&lt;/b:widget-setting&gt;
                                &lt;b:widget-setting name='showLabels'&gt;true&lt;/b:widget-setting&gt;
                                &lt;b:widget-setting name='showLocation'&gt;true&lt;/b:widget-setting&gt;
                                &lt;b:widget-setting name='showTimestamp'&gt;true&lt;/b:widget-setting&gt;
                                &lt;b:widget-setting name='postsPerAd'&gt;1&lt;/b:widget-setting&gt;
                                &lt;b:widget-setting name='showBacklinks'&gt;false&lt;/b:widget-setting&gt;
                                &lt;b:widget-setting name='style.bordercolor'&gt;#ffffff&lt;/b:widget-setting&gt;
                                &lt;b:widget-setting name='showInlineAds'&gt;false&lt;/b:widget-setting&gt;
                                &lt;b:widget-setting name='showReactions'&gt;false&lt;/b:widget-setting&gt;
                              &lt;/b:widget-settings&gt;
                              &lt;b:includable id='main' var='top'&gt;
                                &lt;b:if cond='data:mobile == &amp;quot;false&amp;quot;'&gt;
                                  &lt;!-- posts --&gt;
                                  &lt;div class='blog-posts hfeed'&gt;
                                    &lt;b:include data='top' name='status-message'/&gt;
                                    &lt;data:defaultAdStart/&gt;
                                    &lt;b:loop values='data:posts' var='post'&gt;
                                      &lt;b:if cond='data:post.isDateStart'&gt;
                                        &lt;b:if cond='data:post.isFirstPost == &amp;quot;false&amp;quot;'&gt;
                                          &amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;
                                        &lt;/b:if&gt;
                                      &lt;/b:if&gt;
                                      &lt;b:if cond='data:post.isDateStart'&gt;
                                        &amp;lt;div class=&amp;quot;date-outer&amp;quot;&amp;gt;
                                      &lt;/b:if&gt;
                                      &lt;b:if cond='data:post.dateHeader'&gt;
                                        &lt;h2 class='date-header'&gt;
                                          &lt;span&gt;
                                            &lt;data:post.dateHeader/&gt;
                                          &lt;/span&gt;
                                        &lt;/h2&gt;
                                      &lt;/b:if&gt;
                                      &lt;b:if cond='data:post.isDateStart'&gt;
                                        &amp;lt;div class=&amp;quot;date-posts&amp;quot;&amp;gt;
                                      &lt;/b:if&gt;
                                      &lt;div class='post-outer'&gt;
                                        &lt;b:include data='post' name='post'/&gt;
                                        &lt;b:if cond='data:blog.pageType == &amp;quot;static_page&amp;quot;'&gt;
                                          &lt;b:include data='post' name='comment_picker'/&gt;
                                        &lt;/b:if&gt;
                                        &lt;b:if cond='data:blog.pageType == &amp;quot;item&amp;quot;'&gt;
                                          &lt;b:include data='post' name='comment_picker'/&gt;
                                        &lt;/b:if&gt;
                                      &lt;/div&gt;
                                      &lt;b:if cond='data:post.includeAd'&gt;
                                        &lt;b:if cond='data:post.isFirstPost'&gt;
                                          &lt;data:defaultAdEnd/&gt;
                                          &lt;b:else/&gt;
                                          &lt;data:adEnd/&gt;
                                        &lt;/b:if&gt;
                                        &lt;div class='inline-ad'&gt;
                                          &lt;data:adCode/&gt;
                                        &lt;/div&gt;
                                        &lt;data:adStart/&gt;
                                      &lt;/b:if&gt;
                                    &lt;/b:loop&gt;
                                    &lt;b:if cond='data:numPosts != 0'&gt;
                                      &amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;
                                    &lt;/b:if&gt;
                                    &lt;data:adEnd/&gt;
                                  &lt;/div&gt;
                                  &lt;!-- navigation --&gt;
                                  &lt;b:include name='nextprev'/&gt;
                                  &lt;!-- feed links --&gt;
                                  &lt;b:include name='feedLinks'/&gt;
                                  &lt;b:if cond='data:top.showStars'&gt;
                                    &lt;script src='//www.google.com/jsapi' type='text/javascript'/&gt;
                                    &lt;script type='text/javascript'&gt;
                                      google.load(&amp;quot;annotations&amp;quot;, &amp;quot;1&amp;quot;, {&amp;quot;locale&amp;quot;: &amp;quot;&lt;data:top.languageCode/&gt;&amp;quot;});
                                      function initialize() {
                                        google.annotations.setApplicationId(&lt;data:top.blogspotReviews/&gt;);
                                        google.annotations.createAll();
                                        google.annotations.fetch();
                                      }
                                      google.setOnLoadCallback(initialize);
                                    &lt;/script&gt;
                                  &lt;/b:if&gt;
                                  &lt;b:else/&gt;
                                  &lt;b:include name='mobile-main'/&gt;
                                &lt;/b:if&gt;
                                &lt;b:if cond='data:top.showDummy'&gt;
                                  &lt;data:top.dummyBootstrap/&gt;
                                &lt;/b:if&gt;
                              &lt;/b:includable&gt;
                              &lt;b:includable id='backlinkDeleteIcon' var='backlink'&gt;
                                &lt;span expr:class='&amp;quot;item-control &amp;quot; + data:backlink.adminClass'&gt;
                                  &lt;a expr:href='data:backlink.deleteUrl' expr:title='data:top.deleteBacklinkMsg'&gt;
                                    &lt;img src='//www.blogger.com/img/icon_delete13.gif'/&gt;
                                  &lt;/a&gt;
                                &lt;/span&gt;
                              &lt;/b:includable&gt;
                              &lt;b:includable id='backlinks' var='post'&gt;
                                &lt;a name='links'/&gt;
                                &lt;h4&gt;
                                  &lt;data:post.backlinksLabel/&gt;
                                &lt;/h4&gt;
                                &lt;b:if cond='data:post.numBacklinks != 0'&gt;
                                  &lt;dl class='comments-block' id='comments-block'&gt;
                                    &lt;b:loop values='data:post.backlinks' var='backlink'&gt;
                                      &lt;div class='collapsed-backlink backlink-control'&gt;
                                        &lt;dt class='comment-title'&gt;
                                          &lt;span class='backlink-toggle-zippy'&gt;
                                            &amp;#160;
                                          &lt;/span&gt;
                                          &lt;a expr:href='data:backlink.url' rel='nofollow'&gt;
                                            &lt;data:backlink.title/&gt;
                                          &lt;/a&gt;
                                          &lt;b:include data='backlink' name='backlinkDeleteIcon'/&gt;
                                        &lt;/dt&gt;
                                        &lt;dd class='comment-body collapseable'&gt;
                                          &lt;data:backlink.snippet/&gt;
                                        &lt;/dd&gt;
                                        &lt;dd class='comment-footer collapseable'&gt;
                                          &lt;span class='comment-author'&gt;
                                            &lt;data:post.authorLabel/&gt;
                                            &lt;data:backlink.author/&gt;
                                          &lt;/span&gt;
                                          &lt;span class='comment-timestamp'&gt;
                                            &lt;data:post.timestampLabel/&gt;
                                            &lt;data:backlink.timestamp/&gt;
                                          &lt;/span&gt;
                                        &lt;/dd&gt;
                                      &lt;/div&gt;
                                    &lt;/b:loop&gt;
                                  &lt;/dl&gt;
                                &lt;/b:if&gt;
                                &lt;p class='comment-footer'&gt;
                                  &lt;a class='comment-link' expr:href='data:post.createLinkUrl' expr:id='data:widget.instanceId + &amp;quot;_backlinks-create-link&amp;quot;' target='_blank'&gt;
                                    &lt;data:post.createLinkLabel/&gt;
                                  &lt;/a&gt;
                                &lt;/p&gt;
                              &lt;/b:includable&gt;
                              &lt;b:includable id='comment-form' var='post'&gt;
                                &lt;div class='comment-form'&gt;
                                  &lt;a name='comment-form'/&gt;
                                  &lt;b:if cond='data:mobile'&gt;
                                    &lt;h4 id='comment-post-message'&gt;
                                      &lt;a expr:id='data:widget.instanceId + &amp;quot;_comment-editor-toggle-link&amp;quot;' href='javascript:void(0)'&gt;
                                        &lt;data:postCommentMsg/&gt;
                                      &lt;/a&gt;
                                    &lt;/h4&gt;
                                    &lt;p&gt;
                                      &lt;data:blogCommentMessage/&gt;
                                    &lt;/p&gt;
                                    &lt;data:blogTeamBlogMessage/&gt;
                                    &lt;a expr:href='data:post.commentFormIframeSrc' id='comment-editor-src'/&gt;
                                    &lt;iframe allowtransparency='true' class='blogger-iframe-colorize blogger-comment-from-post' frameborder='0' height='410' id='comment-editor' name='comment-editor' src='' style='display: none' width='100%'/&gt;
                                    &lt;b:else/&gt;
                                    &lt;h4 id='comment-post-message'&gt;
                                      &lt;data:postCommentMsg/&gt;
                                    &lt;/h4&gt;
                                    &lt;p&gt;
                                      &lt;data:blogCommentMessage/&gt;
                                    &lt;/p&gt;
                                    &lt;data:blogTeamBlogMessage/&gt;
                                    &lt;a expr:href='data:post.commentFormIframeSrc' id='comment-editor-src'/&gt;
                                    &lt;iframe allowtransparency='true' class='blogger-iframe-colorize blogger-comment-from-post' frameborder='0' height='410' id='comment-editor' name='comment-editor' src='' width='100%'/&gt;
                                  &lt;/b:if&gt;
                                  &lt;data:post.friendConnectJs/&gt;
                                  &lt;data:post.cmtfpIframe/&gt;
                                  &lt;script type='text/javascript'&gt;
                                    BLOG_CMT_createIframe(&amp;#39;&lt;data:post.appRpcRelayPath/&gt;&amp;#39;, &amp;#39;&lt;data:post.communityId/&gt;&amp;#39;);
                                  &lt;/script&gt;
                                &lt;/div&gt;
                              &lt;/b:includable&gt;
                              &lt;b:includable id='commentDeleteIcon' var='comment'&gt;
                                &lt;span expr:class='&amp;quot;item-control &amp;quot; + data:comment.adminClass'&gt;
                                  &lt;b:if cond='data:showCmtPopup'&gt;
                                    &lt;div class='goog-toggle-button'&gt;
                                      &lt;div class='goog-inline-block comment-action-icon'/&gt;
                                    &lt;/div&gt;
                                    &lt;b:else/&gt;
                                    &lt;a class='comment-delete' expr:href='data:comment.deleteUrl' expr:title='data:top.deleteCommentMsg'&gt;
                                      &lt;img src='//www.blogger.com/img/icon_delete13.gif'/&gt;
                                    &lt;/a&gt;
                                  &lt;/b:if&gt;
                                &lt;/span&gt;
                              &lt;/b:includable&gt;
                              &lt;b:includable id='comment_count_picker' var='post'&gt;
                                &lt;b:if cond='data:post.commentSource == 1'&gt;
                                  &lt;span class='cmt_count_iframe_holder' expr:data-count='data:post.numComments' expr:data-onclick='data:post.addCommentOnclick' expr:data-post-url='data:post.url' expr:data-url='data:post.canonicalUrl'&gt;
                                  &lt;/span&gt;
                                  &lt;b:else/&gt;
                                  &lt;a class='comment-link' expr:href='data:post.addCommentUrl' expr:onclick='data:post.addCommentOnclick'&gt;
                                    &lt;data:post.commentLabelFull/&gt;
                                    :
                                  &lt;/a&gt;
                                &lt;/b:if&gt;
                              &lt;/b:includable&gt;
                              &lt;b:includable id='comment_picker' var='post'&gt;
                                &lt;b:if cond='data:post.commentSource == 1'&gt;
                                  &lt;b:include data='post' name='iframe_comments'/&gt;
                                  &lt;b:else/&gt;
                                  &lt;b:if cond='data:post.showThreadedComments'&gt;
                                    &lt;b:include data='post' name='threaded_comments'/&gt;
                                    &lt;b:else/&gt;
                                    &lt;b:include data='post' name='comments'/&gt;
                                  &lt;/b:if&gt;
                                &lt;/b:if&gt;
                              &lt;/b:includable&gt;
                              &lt;b:includable id='comments' var='post'&gt;
                                &lt;div class='comments' id='comments'&gt;
                                  &lt;a name='comments'/&gt;
                                  &lt;b:if cond='data:post.allowComments'&gt;
                                    &lt;h4&gt;
                                      &lt;data:post.commentLabelFull/&gt;
                                      :
                                    &lt;/h4&gt;
                                    &lt;b:if cond='data:post.commentPagingRequired'&gt;
                                      &lt;span class='paging-control-container'&gt;
                                        &lt;b:if cond='data:post.hasOlderLinks'&gt;
                                          &lt;a expr:class='data:post.oldLinkClass' expr:href='data:post.oldestLinkUrl'&gt;
                                            &lt;data:post.oldestLinkText/&gt;
                                          &lt;/a&gt;
                                          &amp;#160;
                                          &lt;a expr:class='data:post.oldLinkClass' expr:href='data:post.olderLinkUrl'&gt;
                                            &lt;data:post.olderLinkText/&gt;
                                          &lt;/a&gt;
                                          &amp;#160;
                                        &lt;/b:if&gt;
                                        &lt;data:post.commentRangeText/&gt;
                                        &lt;b:if cond='data:post.hasNewerLinks'&gt;
                                          &amp;#160;
                                          &lt;a expr:class='data:post.newLinkClass' expr:href='data:post.newerLinkUrl'&gt;
                                            &lt;data:post.newerLinkText/&gt;
                                          &lt;/a&gt;
                                          &amp;#160;
                                          &lt;a expr:class='data:post.newLinkClass' expr:href='data:post.newestLinkUrl'&gt;
                                            &lt;data:post.newestLinkText/&gt;
                                          &lt;/a&gt;
                                        &lt;/b:if&gt;
                                      &lt;/span&gt;
                                    &lt;/b:if&gt;
                                    &lt;div expr:id='data:widget.instanceId + &amp;quot;_comments-block-wrapper&amp;quot;'&gt;
                                      &lt;dl expr:class='data:post.avatarIndentClass' id='comments-block'&gt;
                                        &lt;b:loop values='data:post.comments' var='comment'&gt;
                                          &lt;dt expr:class='&amp;quot;comment-author &amp;quot; + data:comment.authorClass' expr:id='data:comment.anchorName'&gt;
                                            &lt;b:if cond='data:comment.favicon'&gt;
                                              &lt;img expr:src='data:comment.favicon' height='16px' style='margin-bottom:-2px;' width='16px'/&gt;
                                            &lt;/b:if&gt;
                                            &lt;a expr:name='data:comment.anchorName'/&gt;
                                            &lt;b:if cond='data:blog.enabledCommentProfileImages'&gt;
                                              &lt;data:comment.authorAvatarImage/&gt;
                                            &lt;/b:if&gt;
                                            &lt;b:if cond='data:comment.authorUrl'&gt;
                                              &lt;a expr:href='data:comment.authorUrl' rel='nofollow'&gt;
                                                &lt;data:comment.author/&gt;
                                              &lt;/a&gt;
                                              &lt;b:else/&gt;
                                              &lt;data:comment.author/&gt;
                                            &lt;/b:if&gt;
                                            &lt;data:commentPostedByMsg/&gt;
                                          &lt;/dt&gt;
                                          &lt;dd class='comment-body' expr:id='data:widget.instanceId + data:comment.cmtBodyIdPostfix'&gt;
                                            &lt;b:if cond='data:comment.isDeleted'&gt;
                                              &lt;span class='deleted-comment'&gt;
                                                &lt;data:comment.body/&gt;
                                              &lt;/span&gt;
                                              &lt;b:else/&gt;
                                              &lt;p&gt;
                                                &lt;data:comment.body/&gt;
                                              &lt;/p&gt;
                                            &lt;/b:if&gt;
                                          &lt;/dd&gt;
                                          &lt;dd class='comment-footer'&gt;
                                            &lt;span class='comment-timestamp'&gt;
                                              &lt;a expr:href='data:comment.url' title='comment permalink'&gt;
                                                &lt;data:comment.timestamp/&gt;
                                              &lt;/a&gt;
                                              &lt;b:include data='comment' name='commentDeleteIcon'/&gt;
                                            &lt;/span&gt;
                                          &lt;/dd&gt;
                                        &lt;/b:loop&gt;
                                      &lt;/dl&gt;
                                    &lt;/div&gt;
                                    &lt;b:if cond='data:post.commentPagingRequired'&gt;
                                      &lt;span class='paging-control-container'&gt;
                                        &lt;a expr:class='data:post.oldLinkClass' expr:href='data:post.oldestLinkUrl'&gt;
                                          &lt;data:post.oldestLinkText/&gt;
                                        &lt;/a&gt;
                                        &lt;a expr:class='data:post.oldLinkClass' expr:href='data:post.olderLinkUrl'&gt;
                                          &lt;data:post.olderLinkText/&gt;
                                        &lt;/a&gt;
                                        &amp;#160;
                                        &lt;data:post.commentRangeText/&gt;
                                        &amp;#160;
                                        &lt;a expr:class='data:post.newLinkClass' expr:href='data:post.newerLinkUrl'&gt;
                                          &lt;data:post.newerLinkText/&gt;
                                        &lt;/a&gt;
                                        &lt;a expr:class='data:post.newLinkClass' expr:href='data:post.newestLinkUrl'&gt;
                                          &lt;data:post.newestLinkText/&gt;
                                        &lt;/a&gt;
                                      &lt;/span&gt;
                                    &lt;/b:if&gt;
                                    &lt;p class='comment-footer'&gt;
                                      &lt;b:if cond='data:post.embedCommentForm'&gt;
                                        &lt;b:if cond='data:post.allowNewComments'&gt;
                                          &lt;b:include data='post' name='comment-form'/&gt;
                                          &lt;b:else/&gt;
                                          &lt;data:post.noNewCommentsText/&gt;
                                        &lt;/b:if&gt;
                                        &lt;b:else/&gt;
                                        &lt;b:if cond='data:post.allowComments'&gt;
                                          &lt;a expr:href='data:post.addCommentUrl' expr:onclick='data:post.addCommentOnclick'&gt;
                                            &lt;data:postCommentMsg/&gt;
                                          &lt;/a&gt;
                                        &lt;/b:if&gt;
                                      &lt;/b:if&gt;
                                    &lt;/p&gt;
                                  &lt;/b:if&gt;
                                  &lt;b:if cond='data:showCmtPopup'&gt;
                                    &lt;div id='comment-popup'&gt;
                                      &lt;iframe allowtransparency='true' frameborder='0' id='comment-actions' name='comment-actions' scrolling='no'&gt;
                                      &lt;/iframe&gt;
                                    &lt;/div&gt;
                                  &lt;/b:if&gt;
                                  &lt;div id='backlinks-container'&gt;
                                    &lt;div expr:id='data:widget.instanceId + &amp;quot;_backlinks-container&amp;quot;'&gt;
                                      &lt;b:if cond='data:post.showBacklinks'&gt;
                                        &lt;b:include data='post' name='backlinks'/&gt;
                                      &lt;/b:if&gt;
                                    &lt;/div&gt;
                                  &lt;/div&gt;
                                &lt;/div&gt;
                              &lt;/b:includable&gt;
                              &lt;b:includable id='feedLinks'&gt;
                                &lt;b:if cond='data:blog.pageType != &amp;quot;item&amp;quot;'&gt;
                                  &lt;!-- Blog feed links --&gt;
                                  &lt;b:if cond='data:feedLinks'&gt;
                                    &lt;div class='blog-feeds'&gt;
                                      &lt;b:include data='feedLinks' name='feedLinksBody'/&gt;
                                    &lt;/div&gt;
                                  &lt;/b:if&gt;
                                  &lt;b:else/&gt;
                                  &lt;!--Post feed links --&gt;
                                  &lt;div class='post-feeds'&gt;
                                    &lt;b:loop values='data:posts' var='post'&gt;
                                      &lt;b:if cond='data:post.allowComments'&gt;
                                        &lt;b:if cond='data:post.feedLinks'&gt;
                                          &lt;b:include data='post.feedLinks' name='feedLinksBody'/&gt;
                                        &lt;/b:if&gt;
                                      &lt;/b:if&gt;
                                    &lt;/b:loop&gt;
                                  &lt;/div&gt;
                                &lt;/b:if&gt;
                              &lt;/b:includable&gt;
                              &lt;b:includable id='feedLinksBody' var='links'&gt;
                                &lt;div class='feed-links'&gt;
                                  &lt;data:feedLinksMsg/&gt;
                                  &lt;b:loop values='data:links' var='f'&gt;
                                    &lt;a class='feed-link' expr:href='data:f.url' expr:type='data:f.mimeType' target='_blank'&gt;
                                      &lt;data:f.name/&gt;
                                      (
                                      &lt;data:f.feedType/&gt;
                                      )
                                    &lt;/a&gt;
                                  &lt;/b:loop&gt;
                                &lt;/div&gt;
                              &lt;/b:includable&gt;
                              &lt;b:includable id='iframe_comments' var='post'&gt;
                                &lt;b:if cond='data:post.allowIframeComments'&gt;
                                  &lt;script expr:src='data:post.iframeCommentSrc' type='text/javascript'/&gt;
                                  &lt;div class='cmt_iframe_holder' expr:data-href='data:post.canonicalUrl' expr:data-viewtype='data:post.viewType'/&gt;
                                  &lt;b:if cond='data:post.embedCommentForm == &amp;quot;false&amp;quot;'&gt;
                                    &lt;a expr:href='data:post.addCommentUrl' expr:onclick='data:post.addCommentOnclick'&gt;
                                      &lt;data:postCommentMsg/&gt;
                                    &lt;/a&gt;
                                  &lt;/b:if&gt;
                                &lt;/b:if&gt;
                              &lt;/b:includable&gt;
                              &lt;b:includable id='mobile-index-post' var='post'&gt;
                                &lt;div class='mobile-date-outer date-outer'&gt;
                                  &lt;b:if cond='data:post.dateHeader'&gt;
                                    &lt;div class='date-header'&gt;
                                      &lt;span&gt;
                                        &lt;data:post.dateHeader/&gt;
                                      &lt;/span&gt;
                                    &lt;/div&gt;
                                  &lt;/b:if&gt;
                                  &lt;div class='mobile-post-outer'&gt;
                                    &lt;a expr:href='data:post.url'&gt;
                                      &lt;h3 class='mobile-index-title entry-title' itemprop='name'&gt;
                                        &lt;data:post.title/&gt;
                                      &lt;/h3&gt;
                                      &lt;div class='mobile-index-arrow'&gt;
                                        &amp;amp;rsaquo;
                                      &lt;/div&gt;
                                      &lt;div class='mobile-index-contents'&gt;
                                        &lt;b:if cond='data:post.thumbnailUrl'&gt;
                                          &lt;div class='mobile-index-thumbnail'&gt;
                                            &lt;div class='Image'&gt;
                                              &lt;img expr:src='data:post.thumbnailUrl'/&gt;
                                            &lt;/div&gt;
                                          &lt;/div&gt;
                                        &lt;/b:if&gt;
                                        &lt;div class='post-body'&gt;
                                          &lt;b:if cond='data:post.snippet'&gt;
                                            &lt;data:post.snippet/&gt;
                                          &lt;/b:if&gt;
                                        &lt;/div&gt;
                                      &lt;/div&gt;
                                      &lt;div style='clear: both;'/&gt;
                                    &lt;/a&gt;
                                    &lt;div class='mobile-index-comment'&gt;
                                      &lt;b:if cond='data:blog.pageType != &amp;quot;static_page&amp;quot;'&gt;
                                        &lt;b:if cond='data:post.allowComments'&gt;
                                          &lt;b:if cond='data:post.numComments != 0'&gt;
                                            &lt;b:include data='post' name='comment_count_picker'/&gt;
                                          &lt;/b:if&gt;
                                        &lt;/b:if&gt;
                                      &lt;/b:if&gt;
                                    &lt;/div&gt;
                                  &lt;/div&gt;
                                &lt;/div&gt;
                              &lt;/b:includable&gt;
                              &lt;b:includable id='mobile-main' var='top'&gt;
                                &lt;!-- posts --&gt;
                                &lt;div class='blog-posts hfeed'&gt;
                                  &lt;b:include data='top' name='status-message'/&gt;
                                  &lt;b:if cond='data:blog.pageType == &amp;quot;index&amp;quot;'&gt;
                                    &lt;b:loop values='data:posts' var='post'&gt;
                                      &lt;b:include data='post' name='mobile-index-post'/&gt;
                                    &lt;/b:loop&gt;
                                    &lt;b:else/&gt;
                                    &lt;b:loop values='data:posts' var='post'&gt;
                                      &lt;b:include data='post' name='mobile-post'/&gt;
                                    &lt;/b:loop&gt;
                                  &lt;/b:if&gt;
                                &lt;/div&gt;
                                &lt;b:include name='mobile-nextprev'/&gt;
                              &lt;/b:includable&gt;
                              &lt;b:includable id='mobile-nextprev'&gt;
                                &lt;div class='blog-pager' id='blog-pager'&gt;
                                  &lt;b:if cond='data:newerPageUrl'&gt;
                                    &lt;div class='mobile-link-button' id='blog-pager-newer-link'&gt;
                                      &lt;a class='blog-pager-newer-link' expr:href='data:newerPageUrl' expr:id='data:widget.instanceId + &amp;quot;_blog-pager-newer-link&amp;quot;' expr:title='data:newerPageTitle'&gt;
                                        &amp;amp;lsaquo;
                                      &lt;/a&gt;
                                    &lt;/div&gt;
                                  &lt;/b:if&gt;
                                  &lt;b:if cond='data:olderPageUrl'&gt;
                                    &lt;div class='mobile-link-button' id='blog-pager-older-link'&gt;
                                      &lt;a class='blog-pager-older-link' expr:href='data:olderPageUrl' expr:id='data:widget.instanceId + &amp;quot;_blog-pager-older-link&amp;quot;' expr:title='data:olderPageTitle'&gt;
                                        &amp;amp;rsaquo;
                                      &lt;/a&gt;
                                    &lt;/div&gt;
                                  &lt;/b:if&gt;
                                  &lt;div class='mobile-link-button' id='blog-pager-home-link'&gt;
                                    &lt;a class='home-link' expr:href='data:blog.homepageUrl'&gt;
                                      &lt;data:homeMsg/&gt;
                                    &lt;/a&gt;
                                  &lt;/div&gt;
                                  &lt;div class='mobile-desktop-link'&gt;
                                    &lt;a class='home-link' expr:href='data:desktopLinkUrl'&gt;
                                      &lt;data:desktopLinkMsg/&gt;
                                    &lt;/a&gt;
                                  &lt;/div&gt;
                                &lt;/div&gt;
                                &lt;div class='clear'/&gt;
                              &lt;/b:includable&gt;
                              &lt;b:includable id='mobile-post' var='post'&gt;
                                &lt;div class='date-outer'&gt;
                                  &lt;b:if cond='data:post.dateHeader'&gt;
                                    &lt;h2 class='date-header'&gt;
                                      &lt;span&gt;
                                        &lt;data:post.dateHeader/&gt;
                                      &lt;/span&gt;
                                    &lt;/h2&gt;
                                  &lt;/b:if&gt;
                                  &lt;div class='date-posts'&gt;
                                    &lt;div class='post-outer'&gt;
                                      &lt;div class='post hentry uncustomized-post-template' itemscope='itemscope' itemtype='http://schema.org/BlogPosting'&gt;
                                        &lt;b:if cond='data:post.thumbnailUrl'&gt;
                                          &lt;meta expr:content='data:post.thumbnailUrl' itemprop='image_url'/&gt;
                                        &lt;/b:if&gt;
                                        &lt;meta expr:content='data:blog.blogId' itemprop='blogId'/&gt;
                                        &lt;meta expr:content='data:post.id' itemprop='postId'/&gt;
                                        &lt;a expr:name='data:post.id'/&gt;
                                        &lt;b:if cond='data:post.title'&gt;
                                          &lt;h3 class='post-title entry-title' itemprop='name'&gt;
                                            &lt;b:if cond='data:post.link'&gt;
                                              &lt;a expr:href='data:post.link'&gt;
                                                &lt;data:post.title/&gt;
                                              &lt;/a&gt;
                                              &lt;b:else/&gt;
                                              &lt;b:if cond='data:post.url'&gt;
                                                &lt;b:if cond='data:blog.url != data:post.url'&gt;
                                                  &lt;a expr:href='data:post.url'&gt;
                                                    &lt;data:post.title/&gt;
                                                  &lt;/a&gt;
                                                  &lt;b:else/&gt;
                                                  &lt;data:post.title/&gt;
                                                &lt;/b:if&gt;
                                                &lt;b:else/&gt;
                                                &lt;data:post.title/&gt;
                                              &lt;/b:if&gt;
                                            &lt;/b:if&gt;
                                          &lt;/h3&gt;
                                        &lt;/b:if&gt;
                                        &lt;div class='post-header'&gt;
                                          &lt;div class='post-header-line-1'/&gt;
                                        &lt;/div&gt;
                                        &lt;div class='post-body entry-content' expr:id='&amp;quot;post-body-&amp;quot; + data:post.id' itemprop='articleBody'&gt;
                                          &lt;data:post.body/&gt;
                                          &lt;div style='clear: both;'/&gt;
                                          &lt;!-- clear for photos floats --&gt;
                                        &lt;/div&gt;
                                        &lt;div class='post-footer'&gt;
                                          &lt;div class='post-footer-line post-footer-line-1'&gt;
                                            &lt;span class='post-author vcard'&gt;
                                              &lt;b:if cond='data:top.showAuthor'&gt;
                                                &lt;b:if cond='data:post.authorProfileUrl'&gt;
                                                  &lt;span class='fn' itemprop='author' itemscope='itemscope' itemtype='http://schema.org/Person'&gt;
                                                    &lt;meta expr:content='data:post.authorProfileUrl' itemprop='url'/&gt;
                                                    &lt;a expr:href='data:post.authorProfileUrl' rel='author' title='author profile'&gt;
                                                      &lt;span itemprop='name'&gt;
                                                        &lt;data:post.author/&gt;
                                                      &lt;/span&gt;
                                                    &lt;/a&gt;
                                                  &lt;/span&gt;
                                                  &lt;b:else/&gt;
                                                  &lt;span class='fn' itemprop='author' itemscope='itemscope' itemtype='http://schema.org/Person'&gt;
                                                    &lt;span itemprop='name'&gt;
                                                      &lt;data:post.author/&gt;
                                                    &lt;/span&gt;
                                                  &lt;/span&gt;
                                                &lt;/b:if&gt;
                                              &lt;/b:if&gt;
                                            &lt;/span&gt;
                                            &lt;span class='post-timestamp'&gt;
                                              &lt;b:if cond='data:top.showTimestamp'&gt;
                                                &lt;data:top.timestampLabel/&gt;
                                                &lt;b:if cond='data:post.url'&gt;
                                                  &lt;meta expr:content='data:post.canonicalUrl' itemprop='url'/&gt;
                                                  &lt;a class='timestamp-link' expr:href='data:post.url' rel='bookmark' title='permanent link'&gt;
                                                    &lt;abbr class='published' expr:title='data:post.timestampISO8601' itemprop='datePublished'&gt;
                                                      &lt;data:post.timestamp/&gt;
                                                    &lt;/abbr&gt;
                                                  &lt;/a&gt;
                                                &lt;/b:if&gt;
                                              &lt;/b:if&gt;
                                            &lt;/span&gt;
                                            &lt;span class='post-comment-link'&gt;
                                              &lt;b:if cond='data:blog.pageType != &amp;quot;item&amp;quot;'&gt;
                                                &lt;b:if cond='data:blog.pageType != &amp;quot;static_page&amp;quot;'&gt;
                                                  &lt;b:if cond='data:post.allowComments'&gt;
                                                    &lt;b:include data='post' name='comment_count_picker'/&gt;
                                                  &lt;/b:if&gt;
                                                &lt;/b:if&gt;
                                              &lt;/b:if&gt;
                                            &lt;/span&gt;
                                          &lt;/div&gt;
                                          &lt;div class='post-footer-line post-footer-line-2'&gt;
                                            &lt;b:if cond='data:top.showMobileShare'&gt;
                                              &lt;div class='mobile-link-button goog-inline-block' id='mobile-share-button'&gt;
                                                &lt;a href='javascript:void(0);'&gt;
                                                  &lt;data:shareMsg/&gt;
                                                &lt;/a&gt;
                                              &lt;/div&gt;
                                            &lt;/b:if&gt;
                                            &lt;b:if cond='data:top.showDummy'&gt;
                                              &lt;div class='goog-inline-block dummy-container'&gt;
                                                &lt;data:post.dummyTag/&gt;
                                              &lt;/div&gt;
                                            &lt;/b:if&gt;
                                          &lt;/div&gt;
                                        &lt;/div&gt;
                                      &lt;/div&gt;
                                      &lt;b:if cond='data:blog.pageType == &amp;quot;static_page&amp;quot;'&gt;
                                        &lt;b:include data='post' name='comment_picker'/&gt;
                                      &lt;/b:if&gt;
                                      &lt;b:if cond='data:blog.pageType == &amp;quot;item&amp;quot;'&gt;
                                        &lt;b:include data='post' name='comment_picker'/&gt;
                                      &lt;/b:if&gt;
                                    &lt;/div&gt;
                                  &lt;/div&gt;
                                &lt;/div&gt;
                              &lt;/b:includable&gt;
                              &lt;b:includable id='nextprev'&gt;
                                &lt;div class='blog-pager' id='blog-pager'&gt;
                                  &lt;b:if cond='data:newerPageUrl'&gt;
                                    &lt;span id='blog-pager-newer-link'&gt;
                                      &lt;a class='blog-pager-newer-link' expr:href='data:newerPageUrl' expr:id='data:widget.instanceId + &amp;quot;_blog-pager-newer-link&amp;quot;' expr:title='data:newerPageTitle'&gt;
                                        &lt;data:newerPageTitle/&gt;
                                      &lt;/a&gt;
                                    &lt;/span&gt;
                                  &lt;/b:if&gt;
                                  &lt;b:if cond='data:olderPageUrl'&gt;
                                    &lt;span id='blog-pager-older-link'&gt;
                                      &lt;a class='blog-pager-older-link' expr:href='data:olderPageUrl' expr:id='data:widget.instanceId + &amp;quot;_blog-pager-older-link&amp;quot;' expr:title='data:olderPageTitle'&gt;
                                        &lt;data:olderPageTitle/&gt;
                                      &lt;/a&gt;
                                    &lt;/span&gt;
                                  &lt;/b:if&gt;
                                  &lt;a class='home-link' expr:href='data:blog.homepageUrl'&gt;
                                    &lt;data:homeMsg/&gt;
                                  &lt;/a&gt;
                                  &lt;b:if cond='data:mobileLinkUrl'&gt;
                                    &lt;div class='blog-mobile-link'&gt;
                                      &lt;a expr:href='data:mobileLinkUrl'&gt;
                                        &lt;data:mobileLinkMsg/&gt;
                                      &lt;/a&gt;
                                    &lt;/div&gt;
                                  &lt;/b:if&gt;
                                &lt;/div&gt;
                                &lt;div class='clear'/&gt;
                              &lt;/b:includable&gt;
                              &lt;b:includable id='post' var='post'&gt;
                                &lt;div class='post hentry' itemprop='blogPost' itemscope='itemscope' itemtype='http://schema.org/BlogPosting'&gt;
                                  &lt;b:if cond='data:post.firstImageUrl'&gt;
                                    &lt;meta expr:content='data:post.firstImageUrl' itemprop='image_url'/&gt;
                                  &lt;/b:if&gt;
                                  &lt;meta expr:content='data:blog.blogId' itemprop='blogId'/&gt;
                                  &lt;meta expr:content='data:post.id' itemprop='postId'/&gt;
                                  &lt;a expr:name='data:post.id'/&gt;
                                  &lt;b:if cond='data:post.title'&gt;
                                    &lt;h3 class='post-title entry-title' itemprop='name'&gt;
                                      &lt;b:if cond='data:post.link'&gt;
                                        &lt;a expr:href='data:post.link'&gt;
                                          &lt;data:post.title/&gt;
                                        &lt;/a&gt;
                                        &lt;b:else/&gt;
                                        &lt;b:if cond='data:post.url'&gt;
                                          &lt;b:if cond='data:blog.url != data:post.url'&gt;
                                            &lt;a expr:href='data:post.url'&gt;
                                              &lt;data:post.title/&gt;
                                            &lt;/a&gt;
                                            &lt;b:else/&gt;
                                            &lt;data:post.title/&gt;
                                          &lt;/b:if&gt;
                                          &lt;b:else/&gt;
                                          &lt;data:post.title/&gt;
                                        &lt;/b:if&gt;
                                      &lt;/b:if&gt;
                                    &lt;/h3&gt;
                                  &lt;/b:if&gt;
                                  &lt;div class='post-header'&gt;
                                    &lt;div class='post-header-line-1'/&gt;
                                  &lt;/div&gt;
                                  &lt;b:if cond='data:blog.metaDescription == &amp;quot;&amp;quot;'&gt;
                                    &lt;!-- Then use the post body as the schema.org description,
for good G+/FB snippeting. --&gt;
                                    &lt;div class='post-body entry-content' expr:id='&amp;quot;post-body-&amp;quot; + data:post.id' itemprop='description articleBody'&gt;
                                      &lt;data:post.body/&gt;
                                      &lt;div style='clear: both;'/&gt;
                                      &lt;!-- clear for photos floats --&gt;
                                    &lt;/div&gt;
                                    &lt;b:else/&gt;
                                    &lt;div class='post-body entry-content' expr:id='&amp;quot;post-body-&amp;quot; + data:post.id' itemprop='articleBody'&gt;
                                      &lt;data:post.body/&gt;
                                      &lt;div style='clear: both;'/&gt;
                                      &lt;!-- clear for photos floats --&gt;
                                    &lt;/div&gt;
                                  &lt;/b:if&gt;
                                  &lt;b:if cond='data:post.hasJumpLink'&gt;
                                    &lt;div class='jump-link'&gt;
                                      &lt;a expr:href='data:post.url + &amp;quot;#more&amp;quot;' expr:title='data:post.title'&gt;
                                        &lt;data:post.jumpText/&gt;
                                      &lt;/a&gt;
                                    &lt;/div&gt;
                                  &lt;/b:if&gt;
                                  &lt;div class='post-footer'&gt;
                                    &lt;div class='post-footer-line post-footer-line-1'&gt;
                                      &lt;span class='post-author vcard'&gt;
                                        &lt;b:if cond='data:top.showAuthor'&gt;
                                          &lt;data:top.authorLabel/&gt;
                                          &lt;b:if cond='data:post.authorProfileUrl'&gt;
                                            &lt;span class='fn' itemprop='author' itemscope='itemscope' itemtype='http://schema.org/Person'&gt;
                                              &lt;meta expr:content='data:post.authorProfileUrl' itemprop='url'/&gt;
                                              &lt;a class='g-profile' expr:href='data:post.authorProfileUrl' rel='author' title='author profile'&gt;
                                                &lt;span itemprop='name'&gt;
                                                  &lt;data:post.author/&gt;
                                                &lt;/span&gt;
                                              &lt;/a&gt;
                                            &lt;/span&gt;
                                            &lt;b:else/&gt;
                                            &lt;span class='fn' itemprop='author' itemscope='itemscope' itemtype='http://schema.org/Person'&gt;
                                              &lt;span itemprop='name'&gt;
                                                &lt;data:post.author/&gt;
                                              &lt;/span&gt;
                                            &lt;/span&gt;
                                          &lt;/b:if&gt;
                                        &lt;/b:if&gt;
                                      &lt;/span&gt;
                                      &lt;span class='post-timestamp'&gt;
                                        &lt;b:if cond='data:top.showTimestamp'&gt;
                                          &lt;data:top.timestampLabel/&gt;
                                          &lt;b:if cond='data:post.url'&gt;
                                            &lt;meta expr:content='data:post.canonicalUrl' itemprop='url'/&gt;
                                            &lt;a class='timestamp-link' expr:href='data:post.url' rel='bookmark' title='permanent link'&gt;
                                              &lt;abbr class='published' expr:title='data:post.timestampISO8601' itemprop='datePublished'&gt;
                                                &lt;data:post.timestamp/&gt;
                                              &lt;/abbr&gt;
                                            &lt;/a&gt;
                                          &lt;/b:if&gt;
                                        &lt;/b:if&gt;
                                      &lt;/span&gt;
                                      &lt;span class='post-comment-link'&gt;
                                        &lt;b:if cond='data:blog.pageType != &amp;quot;item&amp;quot;'&gt;
                                          &lt;b:if cond='data:blog.pageType != &amp;quot;static_page&amp;quot;'&gt;
                                            &lt;b:if cond='data:post.allowComments'&gt;
                                              &lt;b:include data='post' name='comment_count_picker'/&gt;
                                            &lt;/b:if&gt;
                                          &lt;/b:if&gt;
                                        &lt;/b:if&gt;
                                      &lt;/span&gt;
                                      &lt;span class='post-icons'&gt;
                                        &lt;!-- email post links --&gt;
                                        &lt;b:if cond='data:post.emailPostUrl'&gt;
                                          &lt;span class='item-action'&gt;
                                            &lt;a expr:href='data:post.emailPostUrl' expr:title='data:top.emailPostMsg'&gt;
                                              &lt;img alt='' class='icon-action' height='13' src='http://img1.blogblog.com/img/icon18_email.gif' width='18'/&gt;
                                            &lt;/a&gt;
                                          &lt;/span&gt;
                                        &lt;/b:if&gt;
                                        &lt;!-- quickedit pencil --&gt;
                                        &lt;b:include data='post' name='postQuickEdit'/&gt;
                                      &lt;/span&gt;
                                      &lt;div class='post-share-buttons goog-inline-block'&gt;
                                        &lt;b:if cond='data:post.sharePostUrl'&gt;
                                          &lt;b:include data='post' name='shareButtons'/&gt;
                                        &lt;/b:if&gt;
                                      &lt;/div&gt;
                                    &lt;/div&gt;
                                    &lt;div class='post-footer-line post-footer-line-2'&gt;
                                      &lt;span class='post-labels'&gt;
                                        &lt;b:if cond='data:post.labels'&gt;
                                          &lt;data:postLabelsLabel/&gt;
                                          &lt;b:loop values='data:post.labels' var='label'&gt;
                                            &lt;a expr:href='data:label.url' rel='tag'&gt;
                                              &lt;data:label.name/&gt;
                                            &lt;/a&gt;
                                            &lt;b:if cond='data:label.isLast != &amp;quot;true&amp;quot;'&gt;
                                              ,
                                            &lt;/b:if&gt;
                                          &lt;/b:loop&gt;
                                        &lt;/b:if&gt;
                                      &lt;/span&gt;
                                    &lt;/div&gt;
                                    &lt;div class='post-footer-line post-footer-line-3'&gt;
                                      &lt;span class='post-location'&gt;
                                        &lt;b:if cond='data:top.showLocation'&gt;
                                          &lt;b:if cond='data:post.location'&gt;
                                            &lt;data:postLocationLabel/&gt;
                                            &lt;a expr:href='data:post.location.mapsUrl' target='_blank'&gt;
                                              &lt;data:post.location.name/&gt;
                                            &lt;/a&gt;
                                          &lt;/b:if&gt;
                                        &lt;/b:if&gt;
                                      &lt;/span&gt;
                                    &lt;/div&gt;
                                  &lt;/div&gt;
                                &lt;/div&gt;
                              &lt;/b:includable&gt;
                              &lt;b:includable id='postQuickEdit' var='post'&gt;
                                &lt;b:if cond='data:post.editUrl'&gt;
                                  &lt;span expr:class='&amp;quot;item-control &amp;quot; + data:post.adminClass'&gt;
                                    &lt;a expr:href='data:post.editUrl' expr:title='data:top.editPostMsg'&gt;
                                      &lt;img alt='' class='icon-action' height='18' src='http://img2.blogblog.com/img/icon18_edit_allbkg.gif' width='18'/&gt;
                                    &lt;/a&gt;
                                  &lt;/span&gt;
                                &lt;/b:if&gt;
                              &lt;/b:includable&gt;
                              &lt;b:includable id='shareButtons' var='post'&gt;
                                &lt;b:if cond='data:top.showEmailButton'&gt;
                                  &lt;a class='goog-inline-block share-button sb-email' expr:href='data:post.sharePostUrl + &amp;quot;&amp;amp;target=email&amp;quot;' expr:title='data:top.emailThisMsg' target='_blank'&gt;
                                    &lt;span class='share-button-link-text'&gt;
                                      &lt;data:top.emailThisMsg/&gt;
                                    &lt;/span&gt;
                                  &lt;/a&gt;
                                &lt;/b:if&gt;
                                &lt;b:if cond='data:top.showBlogThisButton'&gt;
                                  &lt;a class='goog-inline-block share-button sb-blog' expr:href='data:post.sharePostUrl + &amp;quot;&amp;amp;target=blog&amp;quot;' expr:onclick='&amp;quot;window.open(this.href, \&amp;quot;_blank\&amp;quot;, \&amp;quot;height=270,width=475\&amp;quot;); return false;&amp;quot;' expr:title='data:top.blogThisMsg' target='_blank'&gt;
                                    &lt;span class='share-button-link-text'&gt;
                                      &lt;data:top.blogThisMsg/&gt;
                                    &lt;/span&gt;
                                  &lt;/a&gt;
                                &lt;/b:if&gt;
                                &lt;b:if cond='data:top.showTwitterButton'&gt;
                                  &lt;a class='goog-inline-block share-button sb-twitter' expr:href='data:post.sharePostUrl + &amp;quot;&amp;amp;target=twitter&amp;quot;' expr:title='data:top.shareToTwitterMsg' target='_blank'&gt;
                                    &lt;span class='share-button-link-text'&gt;
                                      &lt;data:top.shareToTwitterMsg/&gt;
                                    &lt;/span&gt;
                                  &lt;/a&gt;
                                &lt;/b:if&gt;
                                &lt;b:if cond='data:top.showFacebookButton'&gt;
                                  &lt;a class='goog-inline-block share-button sb-facebook' expr:href='data:post.sharePostUrl + &amp;quot;&amp;amp;target=facebook&amp;quot;' expr:onclick='&amp;quot;window.open(this.href, \&amp;quot;_blank\&amp;quot;, \&amp;quot;height=430,width=640\&amp;quot;); return false;&amp;quot;' expr:title='data:top.shareToFacebookMsg' target='_blank'&gt;
                                    &lt;span class='share-button-link-text'&gt;
                                      &lt;data:top.shareToFacebookMsg/&gt;
                                    &lt;/span&gt;
                                  &lt;/a&gt;
                                &lt;/b:if&gt;
                                &lt;b:if cond='data:top.showOrkutButton'&gt;
                                  &lt;a class='goog-inline-block share-button sb-orkut' expr:href='data:post.sharePostUrl + &amp;quot;&amp;amp;target=orkut&amp;quot;' expr:title='data:top.shareToOrkutMsg' target='_blank'&gt;
                                    &lt;span class='share-button-link-text'&gt;
                                      &lt;data:top.shareToOrkutMsg/&gt;
                                    &lt;/span&gt;
                                  &lt;/a&gt;
                                &lt;/b:if&gt;
                                &lt;b:if cond='data:top.showDummy'&gt;
                                  &lt;div class='goog-inline-block dummy-container'&gt;
                                    &lt;data:post.dummyTag/&gt;
                                  &lt;/div&gt;
                                &lt;/b:if&gt;
                              &lt;/b:includable&gt;
                              &lt;b:includable id='status-message'&gt;
                                &lt;b:if cond='data:navMessage'&gt;
                                  &lt;div class='status-msg-wrap'&gt;
                                    &lt;div class='status-msg-body'&gt;
                                      &lt;data:navMessage/&gt;
                                    &lt;/div&gt;
                                    &lt;div class='status-msg-border'&gt;
                                      &lt;div class='status-msg-bg'&gt;
                                        &lt;div class='status-msg-hidden'&gt;
                                          &lt;data:navMessage/&gt;
                                        &lt;/div&gt;
                                      &lt;/div&gt;
                                    &lt;/div&gt;
                                  &lt;/div&gt;
                                  &lt;div style='clear: both;'/&gt;
                                &lt;/b:if&gt;
                              &lt;/b:includable&gt;
                              &lt;b:includable id='threaded-comment-form' var='post'&gt;
                                &lt;div class='comment-form'&gt;
                                  &lt;a name='comment-form'/&gt;
                                  &lt;b:if cond='data:mobile'&gt;
                                    &lt;p&gt;
                                      &lt;data:blogCommentMessage/&gt;
                                    &lt;/p&gt;
                                    &lt;data:blogTeamBlogMessage/&gt;
                                    &lt;a expr:href='data:post.commentFormIframeSrc' id='comment-editor-src'/&gt;
                                    &lt;iframe allowtransparency='true' class='blogger-iframe-colorize blogger-comment-from-post' frameborder='0' height='410' id='comment-editor' name='comment-editor' src='' style='display: none' width='100%'/&gt;
                                    &lt;b:else/&gt;
                                    &lt;p&gt;
                                      &lt;data:blogCommentMessage/&gt;
                                    &lt;/p&gt;
                                    &lt;data:blogTeamBlogMessage/&gt;
                                    &lt;a expr:href='data:post.commentFormIframeSrc' id='comment-editor-src'/&gt;
                                    &lt;iframe allowtransparency='true' class='blogger-iframe-colorize blogger-comment-from-post' frameborder='0' height='410' id='comment-editor' name='comment-editor' src='' width='100%'/&gt;
                                  &lt;/b:if&gt;
                                  &lt;data:post.friendConnectJs/&gt;
                                  &lt;data:post.cmtfpIframe/&gt;
                                  &lt;script type='text/javascript'&gt;
                                    BLOG_CMT_createIframe(&amp;#39;&lt;data:post.appRpcRelayPath/&gt;&amp;#39;, &amp;#39;&lt;data:post.communityId/&gt;&amp;#39;);
                                  &lt;/script&gt;
                                &lt;/div&gt;
                              &lt;/b:includable&gt;
                              &lt;b:includable id='threaded_comment_js' var='post'&gt;
                                &lt;script async='async' expr:src='data:post.commentSrc' type='text/javascript'/&gt;
                                &lt;script type='text/javascript'&gt;
                                  (function() {
                                    var items = &lt;data:post.commentJso/&gt;;
                                    var msgs = &lt;data:post.commentMsgs/&gt;;
                                    var config = &lt;data:post.commentConfig/&gt;;
                                    // &lt;![CDATA[
                                    var cursor = null;
                                    if (items &amp;&amp; items.length &gt; 0) {
                                      cursor = parseInt(items[items.length - 1].timestamp) + 1;
                                    }
                                    var bodyFromEntry = function(entry) {
                                      if (entry.gd$extendedProperty) {
                                        for (var k in entry.gd$extendedProperty) {
                                          if (entry.gd$extendedProperty[k].name == 'blogger.contentRemoved') {
                                            return '&lt;span class="deleted-comment"&gt;' + entry.content.$t + '&lt;/span&gt;';
                                          }
                                        }
                                      }
                                      return entry.content.$t;
                                    }
                                    var parse = function(data) {
                                      cursor = null;
                                      var comments = [];
                                      if (data &amp;&amp; data.feed &amp;&amp; data.feed.entry) {
                                        for (var i = 0, entry; entry = data.feed.entry[i]; i++) {
                                          var comment = {};
                                          // comment ID, parsed out of the original id format
                                          var id = /blog-(\d+).post-(\d+)/.exec(entry.id.$t);
                                          comment.id = id ? id[2] : null;
                                          comment.body = bodyFromEntry(entry);
                                          comment.timestamp = Date.parse(entry.published.$t) + '';
                                          if (entry.author &amp;&amp; entry.author.constructor === Array) {
                                            var auth = entry.author[0];
                                            if (auth) {
                                              comment.author = {
                                                name: (auth.name ? auth.name.$t : undefined),
                                                profileUrl: (auth.uri ? auth.uri.$t : undefined),
                                                avatarUrl: (auth.gd$image ? auth.gd$image.src : undefined)
                                              };
                                            }
                                          }
                                          if (entry.link) {
                                            if (entry.link[2]) {
                                              comment.link = comment.permalink = entry.link[2].href;
                                            }
                                            if (entry.link[3]) {
                                              var pid = /.*comments\/default\/(\d+)\?.*/.exec(entry.link[3].href);
                                              if (pid &amp;&amp; pid[1]) {
                                                comment.parentId = pid[1];
                                              }
                                            }
                                          }
                                          comment.deleteclass = 'item-control blog-admin';
                                          if (entry.gd$extendedProperty) {
                                            for (var k in entry.gd$extendedProperty) {
                                              if (entry.gd$extendedProperty[k].name == 'blogger.itemClass') {
                                                comment.deleteclass += ' ' + entry.gd$extendedProperty[k].value;
                                              } else if (entry.gd$extendedProperty[k].name == 'blogger.displayTime') {
                                                comment.displayTime = entry.gd$extendedProperty[k].value;
                                              }
                                            }
                                          }
                                          comments.push(comment);
                                        }
                                      }
                                      return comments;
                                    };
                                    var paginator = function(callback) {
                                      if (hasMore()) {
                                        var url = config.feed + '?alt=json&amp;v=2&amp;orderby=published&amp;reverse=false&amp;max-results=50';
                                        if (cursor) {
                                          url += '&amp;published-min=' + new Date(cursor).toISOString();
                                        }
                                        window.bloggercomments = function(data) {
                                          var parsed = parse(data);
                                          cursor = parsed.length &lt; 50 ? null
                                          : parseInt(parsed[parsed.length - 1].timestamp) + 1
                                          callback(parsed);
                                          window.bloggercomments = null;
                                        }
                                        url += '&amp;callback=bloggercomments';
                                        var script = document.createElement('script');
                                        script.type = 'text/javascript';
                                        script.src = url;
                                        document.getElementsByTagName('head')[0].appendChild(script);
                                      }
                                    };
                                    var hasMore = function() {
                                      return !!cursor;
                                    };
                                    var getMeta = function(key, comment) {
                                      if ('iswriter' == key) {
                                        var matches = !!comment.author
                                        &amp;&amp; comment.author.name == config.authorName
                                        &amp;&amp; comment.author.profileUrl == config.authorUrl;
                                        return matches ? 'true' : '';
                                      } else if ('deletelink' == key) {
                                        return config.baseUri + '/delete-comment.g?blogID='
                                        + config.blogId + '&amp;postID=' + comment.id;
                                      } else if ('deleteclass' == key) {
                                        return comment.deleteclass;
                                      }
                                      return '';
                                    };
                                    var replybox = null;
                                    var replyUrlParts = null;
                                    var replyParent = undefined;
                                    var onReply = function(commentId, domId) {
                                      if (replybox == null) {
                                        // lazily cache replybox, and adjust to suit this style:
                                        replybox = document.getElementById('comment-editor');
                                        if (replybox != null) {
                                          replybox.height = '250px';
                                          replybox.style.display = 'block';
                                          replyUrlParts = replybox.src.split('#');
                                        }
                                      }
                                      if (replybox &amp;&amp; (commentId !== replyParent)) {
                                        document.getElementById(domId).insertBefore(replybox, null);
                                        replybox.src = replyUrlParts[0]
                                        + (commentId ? '&amp;parentID=' + commentId : '')
                                        + '#' + replyUrlParts[1];
                                        replyParent = commentId;
                                      }
                                    };
                                    var hash = (window.location.hash || '#').substring(1);
                                    var startThread, targetComment;
                                    if (/^comment-form_/.test(hash)) {
                                      startThread = hash.substring('comment-form_'.length);
                                    } else if (/^c[0-9]+$/.test(hash)) {
                                      targetComment = hash.substring(1);
                                    }
                                    // Configure commenting API:
                                    var configJso = {
                                      'maxDepth': config.maxThreadDepth
                                    };
                                    var provider = {
                                      'id': config.postId,
                                      'data': items,
                                      'loadNext': paginator,
                                      'hasMore': hasMore,
                                      'getMeta': getMeta,
                                      'onReply': onReply,
                                      'rendered': true,
                                      'initComment': targetComment,
                                      'initReplyThread': startThread,
                                      'config': configJso,
                                      'messages': msgs
                                    };
                                    var render = function() {
                                      if (window.goog &amp;&amp; window.goog.comments) {
                                        var holder = document.getElementById('comment-holder');
                                        window.goog.comments.render(holder, provider);
                                      }
                                    };
                                    // render now, or queue to render when library loads:
                                    if (window.goog &amp;&amp; window.goog.comments) {
                                      render();
                                    } else {
                                      window.goog = window.goog || {};
                                      window.goog.comments = window.goog.comments || {};
                                      window.goog.comments.loadQueue = window.goog.comments.loadQueue || [];
                                      window.goog.comments.loadQueue.push(render);
                                    }
                                  })();
                                  // ]]&gt;
                                &lt;/script&gt;
                              &lt;/b:includable&gt;
                              &lt;b:includable id='threaded_comments' var='post'&gt;
                                &lt;div class='comments' id='comments'&gt;
                                  &lt;a name='comments'/&gt;
                                  &lt;h4&gt;
                                    &lt;data:post.commentLabelFull/&gt;
                                    :
                                  &lt;/h4&gt;
                                  &lt;div class='comments-content'&gt;
                                    &lt;b:if cond='data:post.embedCommentForm'&gt;
                                      &lt;b:include data='post' name='threaded_comment_js'/&gt;
                                    &lt;/b:if&gt;
                                    &lt;div id='comment-holder'&gt;
                                      &lt;data:post.commentHtml/&gt;
                                    &lt;/div&gt;
                                  &lt;/div&gt;
                                  &lt;p class='comment-footer'&gt;
                                    &lt;b:if cond='data:post.allowNewComments'&gt;
                                      &lt;b:include data='post' name='threaded-comment-form'/&gt;
                                      &lt;b:else/&gt;
                                      &lt;data:post.noNewCommentsText/&gt;
                                    &lt;/b:if&gt;
                                  &lt;/p&gt;
                                  &lt;b:if cond='data:showCmtPopup'&gt;
                                    &lt;div id='comment-popup'&gt;
                                      &lt;iframe allowtransparency='true' frameborder='0' id='comment-actions' name='comment-actions' scrolling='no'&gt;
                                      &lt;/iframe&gt;
                                    &lt;/div&gt;
                                  &lt;/b:if&gt;
                                  &lt;div id='backlinks-container'&gt;
                                    &lt;div expr:id='data:widget.instanceId + &amp;quot;_backlinks-container&amp;quot;'&gt;
                                      &lt;b:if cond='data:post.showBacklinks'&gt;
                                        &lt;b:include data='post' name='backlinks'/&gt;
                                      &lt;/b:if&gt;
                                    &lt;/div&gt;
                                  &lt;/div&gt;
                                &lt;/div&gt;
                              &lt;/b:includable&gt;
                            &lt;/b:widget&gt;
                          &lt;/b:section&gt;
                        &lt;/div&gt;
                      &lt;/div&gt;
                      &lt;div class='column-left-outer'&gt;
                        &lt;div class='column-left-inner'&gt;
                          &lt;aside&gt;
                            &lt;macro:include id='main-column-left-sections' name='sections'&gt;
                              &lt;macro:param default='0' name='num' value='0'/&gt;
                              &lt;macro:param default='sidebar-left' name='idPrefix'/&gt;
                              &lt;macro:param default='sidebar' name='class'/&gt;
                              &lt;macro:param default='true' name='includeBottom'/&gt;
                            &lt;/macro:include&gt;
                          &lt;/aside&gt;
                        &lt;/div&gt;
                      &lt;/div&gt;
                      &lt;div class='column-right-outer'&gt;
                        &lt;div class='column-right-inner'&gt;
                          &lt;aside&gt;
                            &lt;macro:include id='main-column-right-sections' name='sections'&gt;
                              &lt;macro:param default='2' name='num' value='1'/&gt;
                              &lt;macro:param default='sidebar-right' name='idPrefix'/&gt;
                              &lt;macro:param default='sidebar' name='class'/&gt;
                              &lt;macro:param default='true' name='includeBottom'/&gt;
                            &lt;/macro:include&gt;
                          &lt;/aside&gt;
                        &lt;/div&gt;
                      &lt;/div&gt;
                    &lt;/div&gt;
                    &lt;div style='clear: both'/&gt;
                    &lt;!-- columns --&gt;
                  &lt;/div&gt;
                  &lt;!-- main --&gt;
                &lt;/div&gt;
              &lt;/div&gt;
              &lt;div class='main-cap-bottom cap-bottom'&gt;
                &lt;div class='cap-left'/&gt;
                &lt;div class='cap-right'/&gt;
              &lt;/div&gt;
            &lt;/div&gt;
            &lt;footer&gt;
              &lt;div class='footer-outer'&gt;
                &lt;div class='footer-cap-top cap-top'&gt;
                  &lt;div class='cap-left'/&gt;
                  &lt;div class='cap-right'/&gt;
                &lt;/div&gt;
                &lt;div class='fauxborder-left footer-fauxborder-left'&gt;
                  &lt;div class='fauxborder-right footer-fauxborder-right'/&gt;
                  &lt;div class='region-inner footer-inner'&gt;
                    &lt;macro:include id='footer-sections' name='sections'&gt;
                      &lt;macro:param default='2' name='num'/&gt;
                      &lt;macro:param default='footer' name='idPrefix'/&gt;
                      &lt;macro:param default='foot' name='class'/&gt;
                      &lt;macro:param default='false' name='includeBottom'/&gt;
                    &lt;/macro:include&gt;
                    &lt;!-- outside of the include in order to lock Attribution widget --&gt;
                    &lt;b:section class='foot' id='footer-3' showaddelement='no'/&gt;
                  &lt;/div&gt;
                &lt;/div&gt;
                &lt;div class='footer-cap-bottom cap-bottom'&gt;
                  &lt;div class='cap-left'/&gt;
                  &lt;div class='cap-right'/&gt;
                &lt;/div&gt;
              &lt;/div&gt;
            &lt;/footer&gt;
            &lt;!-- content --&gt;
          &lt;/div&gt;
        &lt;/div&gt;
        &lt;div class='content-cap-bottom cap-bottom'&gt;
          &lt;div class='cap-left'/&gt;
          &lt;div class='cap-right'/&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
    &lt;script type='text/javascript'&gt;
      window.setTimeout(function() {
        document.body.className = document.body.className.replace(&amp;#39;loading&amp;#39;, &amp;#39;&amp;#39;);
                                                                  }, 10);
    &lt;/script&gt;
  &lt;/body&gt;
  &lt;macro:includable id='sections' var='col'&gt;
    &lt;macro:if cond='data:col.num == 0'&gt;
      &lt;macro:else/&gt;
      &lt;b:section mexpr:class='data:col.class' mexpr:id='data:col.idPrefix + &amp;quot;-1&amp;quot;' preferred='yes' showaddelement='yes'/&gt;
      &lt;macro:if cond='data:col.num &amp;gt;= 2'&gt;
        &lt;table border='0' cellpadding='0' cellspacing='0' mexpr:class='&amp;quot;section-columns columns-&amp;quot; + data:col.num'&gt;
          &lt;tbody&gt;
            &lt;tr&gt;
              &lt;td class='first columns-cell'&gt;
                &lt;b:section mexpr:class='data:col.class' mexpr:id='data:col.idPrefix + &amp;quot;-2-1&amp;quot;'/&gt;
              &lt;/td&gt;
              &lt;td class='columns-cell'&gt;
                &lt;b:section mexpr:class='data:col.class' mexpr:id='data:col.idPrefix + &amp;quot;-2-2&amp;quot;'/&gt;
              &lt;/td&gt;
              &lt;macro:if cond='data:col.num &amp;gt;= 3'&gt;
                &lt;td class='columns-cell'&gt;
                  &lt;b:section mexpr:class='data:col.class' mexpr:id='data:col.idPrefix + &amp;quot;-2-3&amp;quot;'/&gt;
                &lt;/td&gt;
              &lt;/macro:if&gt;
              &lt;macro:if cond='data:col.num &amp;gt;= 4'&gt;
                &lt;td class='columns-cell'&gt;
                  &lt;b:section mexpr:class='data:col.class' mexpr:id='data:col.idPrefix + &amp;quot;-2-4&amp;quot;'/&gt;
                &lt;/td&gt;
              &lt;/macro:if&gt;
            &lt;/tr&gt;
          &lt;/tbody&gt;
        &lt;/table&gt;
        &lt;macro:if cond='data:col.includeBottom'&gt;
          &lt;b:section mexpr:class='data:col.class' mexpr:id='data:col.idPrefix + &amp;quot;-3&amp;quot;' showaddelement='no'/&gt;
        &lt;/macro:if&gt;
      &lt;/macro:if&gt;
    &lt;/macro:if&gt;
  &lt;/macro:includable&gt;
  
  
  
  
&lt;b:section-contents id='sidebar-right-1'&gt;
  &lt;b:widget id='HTML1' locked='false' title='Me! Me! Me!' type='HTML'&gt;
    &lt;b:widget-settings&gt;
      &lt;b:widget-setting name='content'&gt;&amp;lt;img class=&amp;quot;avatar rounded-2&amp;quot; src=&amp;quot;https://avatars0.githubusercontent.com/u/1010525?s=400&amp;amp;amp;u=294033082cfecf8ad1645b4290e362583b33094a&amp;amp;amp;v=4&amp;quot; width=&amp;quot;100&amp;quot; height=&amp;quot;100&amp;quot; alt=&amp;quot;@johnnyreilly&amp;quot; /&amp;gt;

&amp;lt;p&amp;gt;Long-time Londoner, born in Bristol and raised in Fleet.  Developer, writer, hedge chopper extraordinaire, father, food botherer, Christian and husband to the most wonderful Geordie wife there ever was!&amp;lt;/p&amp;gt;

&amp;lt;p&amp;gt;You can &amp;lt;a href=&amp;quot;mailto:johnny_reilly@hotmail.com&amp;quot;&amp;gt;email me&amp;lt;/a&amp;gt;.&amp;lt;/p&amp;gt;

&amp;lt;p&amp;gt;&amp;lt;a href=&amp;quot;http://twitter.com/johnny_reilly&amp;quot; class=&amp;quot;twitter-follow-button&amp;quot; data-size=&amp;quot;large&amp;quot; data-show-count=&amp;quot;false&amp;quot;&amp;gt;@johnny_reilly&amp;lt;/a&amp;gt;&amp;lt;/p&amp;gt;

&amp;lt;script src=&amp;quot;http://platform.twitter.com/widgets.js&amp;quot; type=&amp;quot;text/javascript&amp;quot;&amp;gt;&amp;lt;/script&amp;gt;&lt;/b:widget-setting&gt;
    &lt;/b:widget-settings&gt;
    &lt;b:includable id='main'&gt;
        &lt;!-- only display title if it's non-empty --&gt;
        &lt;b:if cond='data:title != &amp;quot;&amp;quot;'&gt;
          &lt;h2 class='title'&gt;
            &lt;data:title/&gt;
          &lt;/h2&gt;
        &lt;/b:if&gt;
        &lt;div class='widget-content'&gt;
          &lt;data:content/&gt;
        &lt;/div&gt;
        &lt;b:include name='quickedit'/&gt;
      &lt;/b:includable&gt;
  &lt;/b:widget&gt;
  &lt;b:widget id='HTML3' locked='false' title='' type='HTML'&gt;
    &lt;b:widget-settings&gt;
      &lt;b:widget-setting name='content'&gt;&lt;![CDATA[&lt;a href="https://www.buymeacoffee.com/qUBm0Wh" target="_blank"&gt;&lt;img src="https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png" alt="Buy Me A Coffee" style="height: 60px !important;width: 217px !important;" /&gt;&lt;/a&gt;]]&gt;&lt;/b:widget-setting&gt;
    &lt;/b:widget-settings&gt;
    &lt;b:includable id='main'&gt;
  &lt;!-- only display title if it's non-empty --&gt;
  &lt;b:if cond='data:title != &amp;quot;&amp;quot;'&gt;
    &lt;h2 class='title'&gt;&lt;data:title/&gt;&lt;/h2&gt;
  &lt;/b:if&gt;
  &lt;div class='widget-content'&gt;
    &lt;data:content/&gt;
  &lt;/div&gt;

  &lt;b:include name='quickedit'/&gt;
&lt;/b:includable&gt;
  &lt;/b:widget&gt;
  &lt;b:widget id='BlogArchive1' locked='false' title='Blog archive' type='BlogArchive'&gt;
    &lt;b:widget-settings&gt;
      &lt;b:widget-setting name='showStyle'&gt;HIERARCHY&lt;/b:widget-setting&gt;
      &lt;b:widget-setting name='yearPattern'&gt;yyyy&lt;/b:widget-setting&gt;
      &lt;b:widget-setting name='showWeekEnd'&gt;true&lt;/b:widget-setting&gt;
      &lt;b:widget-setting name='monthPattern'&gt;MMMM&lt;/b:widget-setting&gt;
      &lt;b:widget-setting name='dayPattern'&gt;MMM dd&lt;/b:widget-setting&gt;
      &lt;b:widget-setting name='weekPattern'&gt;MM/dd&lt;/b:widget-setting&gt;
      &lt;b:widget-setting name='chronological'&gt;false&lt;/b:widget-setting&gt;
      &lt;b:widget-setting name='showPosts'&gt;true&lt;/b:widget-setting&gt;
      &lt;b:widget-setting name='frequency'&gt;MONTHLY&lt;/b:widget-setting&gt;
    &lt;/b:widget-settings&gt;
    &lt;b:includable id='main'&gt;
        &lt;b:if cond='data:title'&gt;
          &lt;h2&gt;
            &lt;data:title/&gt;
          &lt;/h2&gt;
        &lt;/b:if&gt;
        &lt;div class='widget-content'&gt;
          &lt;div id='ArchiveList'&gt;
            &lt;div expr:id='data:widget.instanceId + &amp;quot;_ArchiveList&amp;quot;'&gt;
              &lt;b:if cond='data:style == &amp;quot;HIERARCHY&amp;quot;'&gt;
                &lt;b:include data='data' name='interval'/&gt;
              &lt;/b:if&gt;
              &lt;b:if cond='data:style == &amp;quot;FLAT&amp;quot;'&gt;
                &lt;b:include data='data' name='flat'/&gt;
              &lt;/b:if&gt;
              &lt;b:if cond='data:style == &amp;quot;MENU&amp;quot;'&gt;
                &lt;b:include data='data' name='menu'/&gt;
              &lt;/b:if&gt;
            &lt;/div&gt;
          &lt;/div&gt;
          &lt;b:include name='quickedit'/&gt;
        &lt;/div&gt;
      &lt;/b:includable&gt;
    &lt;b:includable id='flat' var='data'&gt;
        &lt;ul class='flat'&gt;
          &lt;b:loop values='data:data' var='i'&gt;
            &lt;li class='archivedate'&gt;
              &lt;a expr:href='data:i.url'&gt;
                &lt;data:i.name/&gt;
              &lt;/a&gt;
              (
              &lt;data:i.post-count/&gt;
              )
            &lt;/li&gt;
          &lt;/b:loop&gt;
        &lt;/ul&gt;
      &lt;/b:includable&gt;
    &lt;b:includable id='interval' var='intervalData'&gt;
        &lt;b:loop values='data:intervalData' var='i'&gt;
          &lt;ul class='hierarchy'&gt;
            &lt;li expr:class='&amp;quot;archivedate &amp;quot; + data:i.expclass'&gt;
              &lt;b:include data='i' name='toggle'/&gt;
              &lt;a class='post-count-link' expr:href='data:i.url'&gt;
                &lt;data:i.name/&gt;
              &lt;/a&gt;
              &lt;span class='post-count' dir='ltr'&gt;
                (
                &lt;data:i.post-count/&gt;
                )
              &lt;/span&gt;
              &lt;b:if cond='data:i.data'&gt;
                &lt;b:include data='i.data' name='interval'/&gt;
              &lt;/b:if&gt;
              &lt;b:if cond='data:i.posts'&gt;
                &lt;b:include data='i.posts' name='posts'/&gt;
              &lt;/b:if&gt;
            &lt;/li&gt;
          &lt;/ul&gt;
        &lt;/b:loop&gt;
      &lt;/b:includable&gt;
    &lt;b:includable id='menu' var='data'&gt;
        &lt;select expr:id='data:widget.instanceId + &amp;quot;_ArchiveMenu&amp;quot;'&gt;
          &lt;option value=''&gt;
            &lt;data:title/&gt;
          &lt;/option&gt;
          &lt;b:loop values='data:data' var='i'&gt;
            &lt;option expr:value='data:i.url'&gt;
              &lt;data:i.name/&gt;
              (
              &lt;data:i.post-count/&gt;
              )
            &lt;/option&gt;
          &lt;/b:loop&gt;
        &lt;/select&gt;
      &lt;/b:includable&gt;
    &lt;b:includable id='posts' var='posts'&gt;
        &lt;ul class='posts'&gt;
          &lt;b:loop values='data:posts' var='i'&gt;
            &lt;li&gt;
              &lt;a expr:href='data:i.url'&gt;
                &lt;data:i.title/&gt;
              &lt;/a&gt;
            &lt;/li&gt;
          &lt;/b:loop&gt;
        &lt;/ul&gt;
      &lt;/b:includable&gt;
    &lt;b:includable id='toggle' var='interval'&gt;
        &lt;b:if cond='data:interval.toggleId'&gt;
          &lt;b:if cond='data:interval.expclass == &amp;quot;expanded&amp;quot;'&gt;
            &lt;a class='toggle' href='javascript:void(0)'&gt;
              &lt;span class='zippy toggle-open'&gt;
                &amp;#9660;&amp;#160;
              &lt;/span&gt;
            &lt;/a&gt;
            &lt;b:else/&gt;
            &lt;a class='toggle' href='javascript:void(0)'&gt;
              &lt;span class='zippy'&gt;
                &lt;b:if cond='data:blog.languageDirection == &amp;quot;rtl&amp;quot;'&gt;
                  &amp;#9668;&amp;#160;
                  &lt;b:else/&gt;
                  &amp;#9658;&amp;#160;
                &lt;/b:if&gt;
              &lt;/span&gt;
            &lt;/a&gt;
          &lt;/b:if&gt;
        &lt;/b:if&gt;
      &lt;/b:includable&gt;
  &lt;/b:widget&gt;
  &lt;b:widget id='Text1' locked='false' title='What exactly is this?' type='Text'&gt;
    &lt;b:widget-settings&gt;
      &lt;b:widget-setting name='content'&gt;&lt;![CDATA[The meanderings and ramblings of a dev.  If you were wondering, the slightly egotistical-sounding title of this blog started life as a pun on &lt;a href="http://en.wikipedia.org/wiki/ICANN" target="_blank"&gt;ICANN&lt;/a&gt;. Not, if I'm honest, the finest joke in the world but I haven't yet thought of a better name and so here we are...&lt;br /&gt;&lt;br /&gt;&lt;a href="https://reillysontour.blogspot.com/"&gt;I also write a (sort of) travel blog.&lt;/a&gt;]]&gt;&lt;/b:widget-setting&gt;
    &lt;/b:widget-settings&gt;
    &lt;b:includable id='main'&gt;
  &lt;!-- only display title if it's non-empty --&gt;
  &lt;b:if cond='data:title != &amp;quot;&amp;quot;'&gt;
    &lt;h2 class='title'&gt;&lt;data:title/&gt;&lt;/h2&gt;
  &lt;/b:if&gt;
  &lt;div class='widget-content'&gt;
    &lt;data:content/&gt;
  &lt;/div&gt;

  &lt;b:include name='quickedit'/&gt;
&lt;/b:includable&gt;
  &lt;/b:widget&gt;
&lt;/b:section-contents&gt;&lt;b:section-contents id='footer-1'&gt;
  &lt;b:widget id='HTML2' locked='false' title='Disqus for icanmakethiswork' type='HTML' version='1'&gt;
    &lt;b:widget-settings&gt;
      &lt;b:widget-setting name='content'&gt;&lt;![CDATA[&lt;!-- Disqus Widget --&gt;]]&gt;&lt;/b:widget-setting&gt;
    &lt;/b:widget-settings&gt;
    &lt;b:includable id='main'&gt;
            &lt;script type='text/javascript'&gt;
                var disqus_shortname = &amp;#39;icanmakethiswork&amp;#39;;
                var disqus_blogger_current_url = &amp;quot;&lt;data:blog.canonicalUrl/&gt;&amp;quot;;
                if (!disqus_blogger_current_url.length) {
                    disqus_blogger_current_url = &amp;quot;&lt;data:blog.url/&gt;&amp;quot;;
                }
                var disqus_blogger_homepage_url = &amp;quot;&lt;data:blog.homepageUrl/&gt;&amp;quot;;
                var disqus_blogger_canonical_homepage_url = &amp;quot;&lt;data:blog.canonicalHomepageUrl/&gt;&amp;quot;;
            &lt;/script&gt;
            &lt;b:if cond='data:blog.pageType == &amp;quot;item&amp;quot;'&gt;
                &lt;style type='text/css'&gt;
                    #comments {display:none;}
                &lt;/style&gt;
                &lt;script type='text/javascript'&gt;
                    (function() {
                        var bloggerjs = document.createElement(&amp;#39;script&amp;#39;);
                        bloggerjs.type = &amp;#39;text/javascript&amp;#39;;
                        bloggerjs.async = true;
                                                               bloggerjs.src = &amp;#39;//&amp;#39;+disqus_shortname+&amp;#39;.disqus.com/blogger_item.js&amp;#39;;
                        (document.getElementsByTagName(&amp;#39;head&amp;#39;)[0] || document.getElementsByTagName(&amp;#39;body&amp;#39;)[0]).appendChild(bloggerjs);
                    })();
                &lt;/script&gt;
            &lt;/b:if&gt;
                &lt;style type='text/css'&gt;
                    .post-comment-link { visibility: hidden; }
                &lt;/style&gt;
                &lt;script type='text/javascript'&gt;
                (function() {
                    var bloggerjs = document.createElement(&amp;#39;script&amp;#39;);
                    bloggerjs.type = &amp;#39;text/javascript&amp;#39;;
                    bloggerjs.async = true;
                                                           bloggerjs.src = &amp;#39;//&amp;#39;+disqus_shortname+&amp;#39;.disqus.com/blogger_index.js&amp;#39;;
                    (document.getElementsByTagName(&amp;#39;head&amp;#39;)[0] || document.getElementsByTagName(&amp;#39;body&amp;#39;)[0]).appendChild(bloggerjs);
                })();
                &lt;/script&gt;
        &lt;/b:includable&gt;
  &lt;/b:widget&gt;
&lt;/b:section-contents&gt;&lt;b:section-contents id='footer-2-1'/&gt;&lt;b:section-contents id='footer-2-2'/&gt;&lt;/html&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/template/default'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/template/default'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_PUBLISHING_MODE</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>The type of publishing done for this blog.</title><content type='text'>PUBLISH_MODE_BLOGSPOT</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_PUBLISHING_MODE'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_PUBLISHING_MODE'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_ADMIN_PERMISSION</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>The list of administrators' emails for the blog.</title><content type='text'>johnnypaulreilly@gmail.com</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_ADMIN_PERMISSION'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_ADMIN_PERMISSION'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_ADULT_CONTENT</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Whether this blog contains adult content</title><content type='text'>false</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_ADULT_CONTENT'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_ADULT_CONTENT'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_ALTERNATE_JSRENDER_ALLOWED</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Whether alternative JS renderings are allowed</title><content type='text'>true</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_ALTERNATE_JSRENDER_ALLOWED'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_ALTERNATE_JSRENDER_ALLOWED'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_ANALYTICS_ACCOUNT_NUMBER</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Blog's Google Analytics account number</title><content type='text'>UA-51754530-2</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_ANALYTICS_ACCOUNT_NUMBER'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_ANALYTICS_ACCOUNT_NUMBER'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_ARCHIVE_DATE_FORMAT</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>The number of the archive index date format</title><content type='text'>9</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_ARCHIVE_DATE_FORMAT'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_ARCHIVE_DATE_FORMAT'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_ARCHIVE_FREQUENCY</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>How frequently this blog should be archived</title><content type='text'>MONTHLY</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_ARCHIVE_FREQUENCY'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_ARCHIVE_FREQUENCY'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_AUTHOR_PERMISSION</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>The list of authors' emails who have permission to publish.</title><content type='text'></content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_AUTHOR_PERMISSION'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_AUTHOR_PERMISSION'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_BY_POST_ARCHIVING</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Whether to provide an archive page for each post</title><content type='text'>true</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_BY_POST_ARCHIVING'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_BY_POST_ARCHIVING'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_COMMENT_ACCESS</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Who can comment</title><content type='text'>BLOGGERS</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_COMMENT_ACCESS'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_COMMENT_ACCESS'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_COMMENT_CAPTCHA</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Whether to require commenters to complete a Captcha</title><content type='text'>true</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_COMMENT_CAPTCHA'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_COMMENT_CAPTCHA'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_COMMENT_EMAIL</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>List of email addresses to which notifications of new comments are sent</title><content type='text'></content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_COMMENT_EMAIL'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_COMMENT_EMAIL'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_COMMENT_FEED</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>The type of feed to provide for blog comments</title><content type='text'>FULL</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_COMMENT_FEED'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_COMMENT_FEED'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_COMMENT_FORM_LOCATION</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Blog comment form location</title><content type='text'>EMBEDDED_IFRAME</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_COMMENT_FORM_LOCATION'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_COMMENT_FORM_LOCATION'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_COMMENT_MESSAGE</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Blog comment message</title><content type='text'></content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_COMMENT_MESSAGE'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_COMMENT_MESSAGE'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_COMMENT_MODERATION</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Whether to enable comment moderation</title><content type='text'>DISABLED</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_COMMENT_MODERATION'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_COMMENT_MODERATION'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_COMMENT_MODERATION_DELAY</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Number of days after which new comments are subject to moderation</title><content type='text'>14</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_COMMENT_MODERATION_DELAY'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_COMMENT_MODERATION_DELAY'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_COMMENT_MODERATION_EMAIL</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Email address for receiving notifications of new comments that require moderation</title><content type='text'></content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_COMMENT_MODERATION_EMAIL'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_COMMENT_MODERATION_EMAIL'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_COMMENT_PROFILE_IMAGES</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Whether to show profile images in comments</title><content type='text'>true</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_COMMENT_PROFILE_IMAGES'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_COMMENT_PROFILE_IMAGES'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_COMMENTS_ALLOWED</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Whether to show comments</title><content type='text'>false</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_COMMENTS_ALLOWED'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_COMMENTS_ALLOWED'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_COMMENTS_TIME_STAMP_FORMAT</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Comment time stamp format number</title><content type='text'>29</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_COMMENTS_TIME_STAMP_FORMAT'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_COMMENTS_TIME_STAMP_FORMAT'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_CONVERT_LINE_BREAKS</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Whether to convert line breaks into &lt;br /&gt; tags in post editor</title><content type='text'>true</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_CONVERT_LINE_BREAKS'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_CONVERT_LINE_BREAKS'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_CUSTOM_ADS_TXT</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>The custom ads.txt content of the blog served to ads search engines.</title><content type='text'></content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_CUSTOM_ADS_TXT'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_CUSTOM_ADS_TXT'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_CUSTOM_ADS_TXT_ENABLED</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Whether this blog serves custom ads.txt content to ads search engines.</title><content type='text'>false</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_CUSTOM_ADS_TXT_ENABLED'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_CUSTOM_ADS_TXT_ENABLED'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_CUSTOM_PAGE_NOT_FOUND</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>The content served when the requested post or page is not found.</title><content type='text'></content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_CUSTOM_PAGE_NOT_FOUND'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_CUSTOM_PAGE_NOT_FOUND'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_CUSTOM_ROBOTS_TXT</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>The custom robots.txt content of the blog served to search engines.</title><content type='text'></content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_CUSTOM_ROBOTS_TXT'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_CUSTOM_ROBOTS_TXT'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_CUSTOM_ROBOTS_TXT_ENABLED</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Whether this blog serves custom robots.txt content to search engines.</title><content type='text'>false</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_CUSTOM_ROBOTS_TXT_ENABLED'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_CUSTOM_ROBOTS_TXT_ENABLED'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_DATE_FORMAT</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>The number of the date header format</title><content type='text'>26</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_DATE_FORMAT'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_DATE_FORMAT'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_DEFAULT_COMMENTS_MODE</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Default comment mode for posts</title><content type='text'>DEFAULT_HAVE_COMMENTS</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_DEFAULT_COMMENTS_MODE'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_DEFAULT_COMMENTS_MODE'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_DESCRIPTION</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>A description of the blog</title><content type='text'></content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_DESCRIPTION'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_DESCRIPTION'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_EMAIL_POST_LINKS</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Whether to show a link for users to email posts</title><content type='text'>false</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_EMAIL_POST_LINKS'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_EMAIL_POST_LINKS'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_FEED_REDIRECT_URL</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>URL to redirect post feed requests to</title><content type='text'></content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_FEED_REDIRECT_URL'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_FEED_REDIRECT_URL'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_FLOAT_ALIGNMENT</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Whether float alignment is enabled for the blog</title><content type='text'>true</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_FLOAT_ALIGNMENT'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_FLOAT_ALIGNMENT'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_LOCALE</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Language for this blog</title><content type='text'>en_GB</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_LOCALE'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_LOCALE'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_MAIL_PUBLISH</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Whether Mail-to-Blogger posts should be immediately published</title><content type='text'>false</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_MAIL_PUBLISH'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_MAIL_PUBLISH'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_MAIL_TO_BLOGGER</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Secret from which the Mail-to-Blogger email address is derived</title><content type='text'>draft</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_MAIL_TO_BLOGGER'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_MAIL_TO_BLOGGER'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_MAX_NUM</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Maximum number of things to show on the main page"</title><content type='text'>1</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_MAX_NUM'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_MAX_NUM'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_MAX_UNIT</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Unit of things to show on the main page</title><content type='text'>POSTS</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_MAX_UNIT'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_MAX_UNIT'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_META_DESCRIPTION</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>The meta description of the blog served to search engines.</title><content type='text'></content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_META_DESCRIPTION'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_META_DESCRIPTION'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_META_DESCRIPTION_ENABLED</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Whether this blog is served with meta descriptions.</title><content type='text'>false</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_META_DESCRIPTION_ENABLED'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_META_DESCRIPTION_ENABLED'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_NAME</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>The name of the blog</title><content type='text'>I CAN MAKE THIS WORK...</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_NAME'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_NAME'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_PER_POST_FEED</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>The type of feed to provide for per-post comments</title><content type='text'>FULL</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_PER_POST_FEED'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_PER_POST_FEED'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_POST_FEED</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>The type of feed to provide for blog posts</title><content type='text'>FULL</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_POST_FEED'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_POST_FEED'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_POST_FEED_FOOTER</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Footer to append to the end of each entry in the post feed</title><content type='text'></content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_POST_FEED_FOOTER'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_POST_FEED_FOOTER'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_POST_TEMPLATE</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>The template for blog posts</title><content type='text'></content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_POST_TEMPLATE'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_POST_TEMPLATE'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_QUICK_EDITING</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Whether Quick Editing is enabled</title><content type='text'>false</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_QUICK_EDITING'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_QUICK_EDITING'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_READ_ACCESS_MODE</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>The access type for the readers of the blog.</title><content type='text'>PUBLIC</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_READ_ACCESS_MODE'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_READ_ACCESS_MODE'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_READER_PERMISSION</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>The list of emails for users who have permission to read the blog.</title><content type='text'></content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_READER_PERMISSION'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_READER_PERMISSION'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_SEARCHABLE</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Whether this blog should be indexed by search engines</title><content type='text'>true</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_SEARCHABLE'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_SEARCHABLE'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_SEND_EMAIL</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Comma-separated list of emails to send new blog posts to</title><content type='text'></content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_SEND_EMAIL'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_SEND_EMAIL'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_SHOW_TITLE</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Whether to show the title field</title><content type='text'>true</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_SHOW_TITLE'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_SHOW_TITLE'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_SHOW_URL</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Whether to show a related link box in the post composer</title><content type='text'>true</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_SHOW_URL'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_SHOW_URL'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_SUBDOMAIN</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>The BlogSpot subdomain under which to publish your blog</title><content type='text'>icanmakethiswork</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_SUBDOMAIN'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_SUBDOMAIN'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_TIME_STAMP_FORMAT</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>The number of the time stamp format</title><content type='text'>27</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_TIME_STAMP_FORMAT'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_TIME_STAMP_FORMAT'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_TIME_ZONE</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>The time zone for this blog</title><content type='text'>Europe/London</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_TIME_ZONE'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_TIME_ZONE'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.settings.BLOG_USE_LIGHTBOX</id><published>2012-01-07T13:46:46.067Z</published><updated>2021-03-17T21:27:18.928Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Whether to show images in the Lightbox when clicked</title><content type='text'>true</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_USE_LIGHTBOX'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/settings/BLOG_USE_LIGHTBOX'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8821528530336510107</id><published>2021-03-15T06:26:00.001Z</published><updated>2021-03-15T06:26:57.770Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Blogger'/><category scheme='http://www.blogger.com/atom/ns#' term='Docusaurus'/><title type='text'>From Blogger to Docusaurus</title><content type='html'>&lt;p&gt;&lt;a href="https://v2.docusaurus.io/"&gt;Docusaurus&lt;/a&gt; is, amongst other things, a Markdown powered blogging platform. My blog has lived happily on &lt;a href="https://www.blogger.com/"&gt;Blogger&lt;/a&gt; for the past decade.  I'm considering moving, but losing my historic content as part of the move was never an option. This post goes through what it would look like to move from Blogger to Docusaurus &lt;em&gt;without&lt;/em&gt; losing your content.&lt;/p&gt;&lt;p&gt;It is imperative that the world never forgets what I was doing with jQuery in 2012.&lt;/p&gt;&lt;h4 id="blogascode"&gt;Blog as code&lt;/h4&gt;&lt;p&gt;Everything is better when it's code.  Infrastructure as code. Awesome right? So naturally "blog as code" must be better than just a blog.  More seriously, &lt;a href="https://en.wikipedia.org/wiki/Markdown"&gt;Markdown&lt;/a&gt; is a tremendous documentation format. Simple, straightforward and, like Goldilocks, "just right". For a long time I've written everything as Markdown. My years of toil down the Open Source mines have preconditioned me to be very MD-disposed.&lt;/p&gt;&lt;p&gt;I started out writing this blog a long time ago as pure HTML. Not the smoothest of writing formats. At some point I got into the habit of spinning up a new repo in GitHub for a new blogpost, writing it in Markdown and piping it through a variety of tools to convert it into HTML for publication on Blogger.  As time passed I felt I'd be a lot happier if I wasn't creating a repo each time. What if I did all my blogging in a single repo and used that as the code that represented my blog?&lt;/p&gt;&lt;p&gt;Just having that thought laid the seeds for what was to follow:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;An investigation into importing my content from Blogger into a GitHub repo&lt;/li&gt;&lt;li&gt;An experimental port to Docusaurus&lt;/li&gt;&lt;li&gt;The automation of publication to Docusaurus and Blogger&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;We're going to go through 1 and 2 now.  But before we do that, let's create ourselves a Docusaurus site for our blog:&lt;/p&gt;&lt;pre&gt;&lt;code&gt;npx @docusaurus/init@latest init blog-website classic&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="iwanteverything"&gt;I want everything&lt;/h4&gt;&lt;p&gt;The first thing to do, was obtain my blog content. This is a mass of HTML that lived inside Blogger's database. (One assumes they have a database; I haven't actually checked.) There's a "Back up content" option inside Blogger to allow this:&lt;/p&gt;&lt;p&gt;&lt;img style="max-width: 100%;" src="https://raw.githubusercontent.com/johnnyreilly/blog.johnnyreilly.com/main/blog-website/static/blog/2021-03-15-from-blogger-to-docusaurus/blogger-back-up-your-content.png" alt="Download content from Blogger" /&gt;&lt;/p&gt;&lt;p&gt;It provides you with an XML file with a dispiritingly small size. Ten years blogging? You'll get change out of 4Mb it turns out. &lt;/p&gt;&lt;h4 id="fromhtmlinxmltomarkdown"&gt;From HTML in XML to Markdown&lt;/h4&gt;&lt;p&gt;We now want to take that XML and:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Extract each blog post (and it's associated metadata; title / tags and whatnot) &lt;/li&gt;&lt;li&gt;Convert the HTML content of each blog post from HTML to Markdown and save it as a &lt;code&gt;.md&lt;/code&gt; file&lt;/li&gt;&lt;li&gt;Download the images used in the blogpost so they can be stored in the repo alongside&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;To do this we're going to whip up a smallish TypeScript console app.  Let's initialise it with the packages we're going to need:&lt;/p&gt;&lt;pre&gt;&lt;code&gt;mkdir from-blogger-to-docusaurus&lt;br /&gt;cd from-blogger-to-docusaurus&lt;br /&gt;npx typescript --init&lt;br /&gt;yarn init&lt;br /&gt;yarn add @types/axios @types/he @types/jsdom @types/node @types/showdown axios fast-xml-parser he jsdom showdown ts-node typescript&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;We're using:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;a href="https://github.com/NaturalIntelligence/fast-xml-parser"&gt;&lt;code&gt;fast-xml-parser&lt;/code&gt;&lt;/a&gt; to parse XML&lt;/li&gt;&lt;li&gt;&lt;a href="https://github.com/mathiasbynens/he"&gt;&lt;code&gt;he&lt;/code&gt;&lt;/a&gt;, &lt;a href="https://github.com/jsdom/jsdom"&gt;jsdom&lt;/a&gt; and &lt;a href="https://github.com/showdownjs/showdown"&gt;showdown&lt;/a&gt; to convert HTML to Markdown&lt;/li&gt;&lt;li&gt;&lt;a href="https://github.com/axios/axios"&gt;&lt;code&gt;axios&lt;/code&gt;&lt;/a&gt; to download images&lt;/li&gt;&lt;li&gt;&lt;a href="https://github.com/microsoft/TypeScript"&gt;&lt;code&gt;typescript&lt;/code&gt;&lt;/a&gt; to code in and &lt;a href="https://github.com/TypeStrong/ts-node"&gt;&lt;code&gt;ts-node&lt;/code&gt;&lt;/a&gt; to make our TypeScript Node.js console app.&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;Now we have all the packages we need, it's time to write our script.&lt;/p&gt;&lt;pre&gt;&lt;code class="ts language-ts"&gt;import fs from 'fs'&lt;br /&gt;import path from 'path'&lt;br /&gt;import showdown from 'showdown';&lt;br /&gt;import he from 'he'&lt;br /&gt;import jsdom from 'jsdom'&lt;br /&gt;import axios from 'axios';&lt;br /&gt;import fastXmlParser from 'fast-xml-parser';&lt;br /&gt;&lt;br /&gt;const bloggerXmlPath = './blog-03-13-2021.xml';&lt;br /&gt;const docusaurusDirectory = '../blog-website';&lt;br /&gt;const notMarkdownable: string[] = [];&lt;br /&gt;&lt;br /&gt;async function fromXmlToMarkDown() {&lt;br /&gt;    const posts = await getPosts();&lt;br /&gt;&lt;br /&gt;    for (const post of posts) {&lt;br /&gt;        await makePostIntoMarkDownAndDownloadImages(post);&lt;br /&gt;    }&lt;br /&gt;    if (notMarkdownable.length)&lt;br /&gt;        console.log('These blog posts could not be turned into MarkDown - go find out why!', notMarkdownable)&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;async function getPosts(): Promise&amp;lt;Post[]&amp;gt; {&lt;br /&gt;    const xml = await fs.promises.readFile(bloggerXmlPath, 'utf-8');&lt;br /&gt;&lt;br /&gt;    const options = {&lt;br /&gt;        attributeNamePrefix: "@_",&lt;br /&gt;        attrNodeName: "attr", //default is 'false'&lt;br /&gt;        textNodeName: "#text",&lt;br /&gt;        ignoreAttributes: false,&lt;br /&gt;        ignoreNameSpace: false,&lt;br /&gt;        allowBooleanAttributes: true,&lt;br /&gt;        parseNodeValue: true,&lt;br /&gt;        parseAttributeValue: true,&lt;br /&gt;        trimValues: true,&lt;br /&gt;        cdataTagName: "__cdata", //default is 'false'&lt;br /&gt;        cdataPositionChar: "\\c",&lt;br /&gt;        parseTrueNumberOnly: false,&lt;br /&gt;        arrayMode: true, //"strict"&lt;br /&gt;        attrValueProcessor: (val: string, attrName: string) =&amp;gt; he.decode(val, { isAttributeValue: true }),//default is a=&amp;gt;a&lt;br /&gt;        tagValueProcessor: (val: string, tagName: string) =&amp;gt; he.decode(val), //default is a=&amp;gt;a&lt;br /&gt;    };&lt;br /&gt;&lt;br /&gt;    const traversalObj = fastXmlParser.getTraversalObj(xml, options);&lt;br /&gt;    const blog = fastXmlParser.convertToJson(traversalObj, options);&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;    const postsRaw = blog.feed[0].entry&lt;br /&gt;        .filter((entry: any) =&amp;gt;&lt;br /&gt;            entry.category.some((category: any) =&amp;gt; category.attr['@_term'] === "http://schemas.google.com/blogger/2008/kind#post") &amp;amp;&amp;amp;&lt;br /&gt;            entry.link.some((link: any) =&amp;gt; link.attr["@_href"] &amp;amp;&amp;amp; link.attr["@_type"] === "text/html") &amp;amp;&amp;amp;&lt;br /&gt;            entry.published &amp;lt; '2021-03-07'&lt;br /&gt;        );&lt;br /&gt;&lt;br /&gt;    const posts: Post[] = postsRaw.map((entry: any) =&amp;gt; {&lt;br /&gt;        return {&lt;br /&gt;            title: entry.title[0]['#text'],&lt;br /&gt;            content: entry.content[0]['#text'],&lt;br /&gt;            published: entry.published,&lt;br /&gt;            link: entry.link.find((link: any) =&amp;gt; link.attr["@_href"] &amp;amp;&amp;amp; link.attr["@_type"] === "text/html")&lt;br /&gt;                ? entry.link.find((link: any) =&amp;gt; link.attr["@_href"] &amp;amp;&amp;amp; link.attr["@_type"] === "text/html").attr["@_href"]&lt;br /&gt;                : undefined,&lt;br /&gt;            tags: Array.isArray(entry.category) &amp;amp;&amp;amp; entry.category.some((category: any) =&amp;gt; category.attr['@_scheme'] === "http://www.blogger.com/atom/ns#")&lt;br /&gt;                ? entry.category&lt;br /&gt;                    .filter((category: any) =&amp;gt; category.attr['@_scheme'] === "http://www.blogger.com/atom/ns#" &amp;amp;&amp;amp; category.attr["@_term"] !== 'constructor') // 'constructor' will make docusaurus choke&lt;br /&gt;                    .map((category: any) =&amp;gt; category.attr["@_term"])&lt;br /&gt;                : []&lt;br /&gt;        };&lt;br /&gt;    })&lt;br /&gt;&lt;br /&gt;    for (const post of posts) {&lt;br /&gt;        const { content, ...others } = post;&lt;br /&gt;        console.log(others, content.length)&lt;br /&gt;        if (!content || !others.title || !others.published) throw new Error("No content");&lt;br /&gt;    }&lt;br /&gt;&lt;br /&gt;    return posts.filter(post =&amp;gt; post.link);&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;async function makePostIntoMarkDownAndDownloadImages(post: Post) {&lt;br /&gt;    const converter = new showdown.Converter({&lt;br /&gt;        ghCodeBlocks: true&lt;br /&gt;    });&lt;br /&gt;    const linkSections = post.link.split('/');&lt;br /&gt;    const linkSlug = linkSections[linkSections.length - 1]&lt;br /&gt;    const filename = post.published.substr(0, 10) + '-' + linkSlug.replace('.html', '.md');&lt;br /&gt;&lt;br /&gt;    const contentProcessed = post.content&lt;br /&gt;        // remove stray &amp;lt;br /&amp;gt; tags &lt;br /&gt;        .replace(/&amp;lt;br\s*\/?&amp;gt;/gi, '\n')&lt;br /&gt;        // translate &amp;lt;code class="lang-cs" into &amp;lt;code class="language-cs"&amp;gt; to be showdown friendly&lt;br /&gt;        .replace(/code class="lang-/gi, 'code class="language-');&lt;br /&gt;&lt;br /&gt;    const images: string[] = [];&lt;br /&gt;    const dom = new jsdom.JSDOM(contentProcessed);&lt;br /&gt;    let markdown = "";&lt;br /&gt;    try {&lt;br /&gt;        markdown = converter.makeMarkdown(contentProcessed, dom.window.document)&lt;br /&gt;            // bigger titles&lt;br /&gt;            .replace(/###### /g, '#### ')&lt;br /&gt;&lt;br /&gt;            // &amp;lt;div style="width:100%;height:0;padding-bottom:56%;position:relative;"&amp;gt;&amp;lt;iframe src="https://giphy.com/embed/l7JDTHpsXM26k" width="100%" height="100%" style="position:absolute" frameborder="0" class="giphy-embed" allowfullscreen=""&amp;gt;&amp;lt;/iframe&amp;gt;&amp;lt;/div&amp;gt;&lt;br /&gt;&lt;br /&gt;            // The mechanism below extracts the underlying iframe&lt;br /&gt;            .replace(/&amp;lt;div.*(&amp;lt;iframe.*"&amp;gt;).*&amp;lt;\/div&amp;gt;/g, (replacer) =&amp;gt; {&lt;br /&gt;                const dom = new jsdom.JSDOM(replacer);&lt;br /&gt;                const iframe = dom?.window?.document?.querySelector("iframe");&lt;br /&gt;                return iframe?.outerHTML ?? '';&lt;br /&gt;            })&lt;br /&gt;&lt;br /&gt;            // The mechanism below strips class and style attributes from iframes - react hates them&lt;br /&gt;            .replace(/&amp;lt;iframe.*&amp;lt;\/iframe&amp;gt;/g, (replacer) =&amp;gt; {&lt;br /&gt;                const dom = new jsdom.JSDOM(replacer);&lt;br /&gt;                const iframe = dom?.window?.document?.querySelector("iframe");&lt;br /&gt;                iframe?.removeAttribute('class')&lt;br /&gt;                iframe?.removeAttribute('style')&lt;br /&gt;                return iframe?.outerHTML ?? '';&lt;br /&gt;            })&lt;br /&gt;&lt;br /&gt;            // capitalise appropriately&lt;br /&gt;            .replace(/frameborder/g, 'frameBorder')&lt;br /&gt;            .replace(/allowfullscreen/g, 'allowFullScreen')&lt;br /&gt;            .replace(/charset/g, 'charSet')&lt;br /&gt;&lt;br /&gt;            // Blogger tends to put images in HTML that looks like this:&lt;br /&gt;            // &amp;lt;div class="separator" style="clear: both;"&amp;gt;&amp;lt;a href="https://1.bp.blogspot.com/-UwrtZigWg78/YDqN82KbjVI/AAAAAAAAZTE/Umezr1MGQicnxMMr5rQHD4xKINg9fasDACLcBGAsYHQ/s783/traffic-to-app-service.png" style="display: block; padding: 1em 0; text-align: center; "&amp;gt;&amp;lt;img alt="traffic to app service" border="0" width="600" data-original-height="753" data-original-width="783" src="https://1.bp.blogspot.com/-UwrtZigWg78/YDqN82KbjVI/AAAAAAAAZTE/Umezr1MGQicnxMMr5rQHD4xKINg9fasDACLcBGAsYHQ/s600/traffic-to-app-service.png"&amp;gt;&amp;lt;/a&amp;gt;&amp;lt;/div&amp;gt;&lt;br /&gt;&lt;br /&gt;            // The mechanism below extracts the underlying image path and it's alt text&lt;br /&gt;            .replace(/&amp;lt;div.*(&amp;lt;img.*"&amp;gt;).*&amp;lt;\/div&amp;gt;/g, (replacer) =&amp;gt; {&lt;br /&gt;                const div = new jsdom.JSDOM(replacer);&lt;br /&gt;                const img = div?.window?.document?.querySelector("img");&lt;br /&gt;                const alt = img?.getAttribute('alt') ?? '';&lt;br /&gt;                const src = img?.getAttribute('src') ?? '';&lt;br /&gt;&lt;br /&gt;                if (src) images.push(src);&lt;br /&gt;&lt;br /&gt;                return `![${alt}](${src})`&lt;br /&gt;            });&lt;br /&gt;    }&lt;br /&gt;    catch (e) {&lt;br /&gt;        console.log(post.link)&lt;br /&gt;        console.log(e)&lt;br /&gt;        notMarkdownable.push(post.link)&lt;br /&gt;        return;&lt;br /&gt;    }&lt;br /&gt;&lt;br /&gt;    const imageDirectory = filename.replace('.md', '');&lt;br /&gt;    for (const url of images) {&lt;br /&gt;        try {&lt;br /&gt;            const localUrl = await downloadImage(url, imageDirectory);&lt;br /&gt;            markdown = markdown.replace(url, 'https://raw.githubusercontent.com/johnnyreilly/blog.johnnyreilly.com/main/blog-website/static/blog/' + localUrl);&lt;br /&gt;        } catch (e) {&lt;br /&gt;            console.error(`Failed to download ${url}`)&lt;br /&gt;        }&lt;br /&gt;    }&lt;br /&gt;&lt;br /&gt;    const content = `---&lt;br /&gt;title: "${post.title}"&lt;br /&gt;author: John Reilly&lt;br /&gt;author_url: https://github.com/johnnyreilly&lt;br /&gt;author_image_url: https://avatars.githubusercontent.com/u/1010525?s=400&amp;amp;u=294033082cfecf8ad1645b4290e362583b33094a&amp;amp;v=4&lt;br /&gt;tags: [${post.tags.join(', ')}]&lt;br /&gt;hide_table_of_contents: false&lt;br /&gt;---&lt;br /&gt;${markdown}&lt;br /&gt;`;&lt;br /&gt;&lt;br /&gt;    await fs.promises.writeFile(path.resolve(docusaurusDirectory, 'blog', filename), content);&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;async function downloadImage(url: string, directory: string) {&lt;br /&gt;    console.log(`Downloading ${url}`);&lt;br /&gt;    const pathParts = new URL(url).pathname.split('/');&lt;br /&gt;    const filename = pathParts[pathParts.length - 1];&lt;br /&gt;    const directoryTo = path.resolve(docusaurusDirectory, 'static', 'blog', directory);&lt;br /&gt;    const pathTo = path.resolve(docusaurusDirectory, 'static', 'blog', directory, filename);&lt;br /&gt;&lt;br /&gt;    if (!fs.existsSync(directoryTo)) {&lt;br /&gt;        fs.mkdirSync(directoryTo);&lt;br /&gt;    }&lt;br /&gt;&lt;br /&gt;    const writer = fs.createWriteStream(pathTo)&lt;br /&gt;&lt;br /&gt;    const response = await axios({&lt;br /&gt;        url,&lt;br /&gt;        method: 'GET',&lt;br /&gt;        responseType: 'stream'&lt;br /&gt;    })&lt;br /&gt;&lt;br /&gt;    response.data.pipe(writer)&lt;br /&gt;&lt;br /&gt;    return new Promise&amp;lt;string&amp;gt;((resolve, reject) =&amp;gt; {&lt;br /&gt;        writer.on('finish', () =&amp;gt; resolve(directory + '/' + filename))&lt;br /&gt;        writer.on('error', reject)&lt;br /&gt;    })&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;interface Post { &lt;br /&gt;    title: string;&lt;br /&gt;    content: string;&lt;br /&gt;    published: string;&lt;br /&gt;    link: string;&lt;br /&gt;    tags: string[];&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;// do it!&lt;br /&gt;fromXmlToMarkDown();&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;To summarise what the script does, it:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;parses the blog XML into an array of &lt;code&gt;Post&lt;/code&gt;s&lt;/li&gt;&lt;li&gt;each post is then converted from HTML into Markdown, a Docusaurus header is created and prepended, then the file is saved to the &lt;code&gt;blog-website/blog&lt;/code&gt; directory&lt;/li&gt;&lt;li&gt;the images of each post are downloaded with Axios and saved to the &lt;code&gt;blog-websihttps://raw.githubusercontent.com/johnnyreilly/blog.johnnyreilly.com/main/blog-website/static/blog/{POST NAME}&lt;/code&gt; directory&lt;/li&gt;&lt;/ul&gt;&lt;h4 id="bringingitalltogether"&gt;Bringing it all together&lt;/h4&gt;&lt;p&gt;To run the script, we add the following script to the &lt;code&gt;package.json&lt;/code&gt;:&lt;/p&gt;&lt;pre&gt;&lt;code&gt;  "scripts": {&lt;br /&gt;    "start": "ts-node index.ts"&lt;br /&gt;  },&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;And have ourselves a merry little &lt;code&gt;yarn start&lt;/code&gt; to kick off the process. In a very short period of time, if you crack open the &lt;code&gt;blogs&lt;/code&gt; directory of your Docusaurus site you'll see a collection of Markdown files which represent your blog and are ready to power Docusaurus:&lt;/p&gt;&lt;p&gt;&lt;img style="max-width: 100%;" src="https://raw.githubusercontent.com/johnnyreilly/blog.johnnyreilly.com/main/blog-website/static/blog/2021-03-15-from-blogger-to-docusaurus/blogs-as-markdown.png" alt="Markdown files" /&gt;&lt;/p&gt;&lt;p&gt;I have slightly papered over some details here.  For my own case I discovered that I hadn't always written perfect HTML when blogging. I had to go in and fix the HTML in a number of historic blogs such that the mechanism would work. I also learned that a number of my screenshots that I use to illustrate posts have vanished from Blogger at some point.  This makes me all the more convinced that storing your blog in a repo is a good idea.  Things should not "go missing".&lt;/p&gt;&lt;p&gt;Congratulations! We're now the proud owners of a Docusaurus blog site based upon our Blogger content that looks something like this: &lt;/p&gt;&lt;p&gt;&lt;img style="max-width: 100%;" src="https://raw.githubusercontent.com/johnnyreilly/blog.johnnyreilly.com/main/blog-website/static/blog/2021-03-15-from-blogger-to-docusaurus/docusaurus.png" alt="Blog in Docusaurus" /&gt;&lt;/p&gt;&lt;h4 id="makingthemove"&gt;Making the move?&lt;/h4&gt;&lt;p&gt;Now that I've got the content, I'm theoretically safe to migrate from Blogger to Docusaurus.  I'm pondering this now and I have come up with a checklist of criteria to satisfy before I do.  You can have a read of the &lt;a href="https://github.com/johnnyreilly/blog.johnnyreilly.com#migrating-to-docusauras"&gt;criteria here&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;Odds are, I'm likely to make the move; it's probably just a matter of time.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8821528530336510107'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8821528530336510107'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2021/03/from-blogger-to-docusaurus_15.html' title='From Blogger to Docusaurus'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-822627434282421455</id><published>2021-03-10T06:48:00.001Z</published><updated>2021-03-10T08:34:17.292Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Entity Framework'/><category scheme='http://www.blogger.com/atom/ns#' term='managed identity'/><category scheme='http://www.blogger.com/atom/ns#' term='connection string'/><category scheme='http://www.blogger.com/atom/ns#' term='Microsoft.Data.SqlClient'/><title type='text'>Managed Identity, Azure SQL and Entity Framework</title><content type='html'>&lt;p&gt;Managed Identity offers a very secure way for applications running in Azure to connect to Azure SQL databases. It's an approach that does not require code changes; merely configuration of connection string and associated resources. Hence it has a good developer experience. Importantly, it allows us to avoid exposing our database to username / password authentication, and hence making it a tougher target for bad actors.&lt;/p&gt;&lt;p&gt;This post talks us through using managed identity for connecting to Azure SQL. &lt;/p&gt;&lt;h4 id="integratedsecuritytrue"&gt;&lt;code&gt;Integrated Security=true&lt;/code&gt;&lt;/h4&gt;&lt;p&gt;Everyone is deploying to the cloud. Few are the organisations that view deployment to data centers they manage as the future. This is generally a good thing, however in the excitement of the new, it's possible to forget some of the good properties that "on premise" deployment afforded when it came to connectivity and authentication.&lt;/p&gt;&lt;p&gt;I speak of course, of our old friend &lt;code&gt;Integrated Security=true&lt;/code&gt;. When you seek to connect a web application to a database, you'll typically use some kind of database connection string. And back in the day, it may have looked something like this:&lt;/p&gt;&lt;pre&gt;&lt;code&gt;Data Source=myServer;Initial Catalog=myDB;Integrated Security=true;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The above provides a database server, a database and also &lt;code&gt;Integrated Security=true&lt;/code&gt;. When you see &lt;code&gt;Integrated Security=true&lt;/code&gt;, what you're essentially looking at is an instruction to use the identity that an application is running under (typically called a "service account") as the authentication credential to secure access to the database. Under the covers, this amounts to &lt;a href="https://docs.microsoft.com/en-us/dotnet/framework/data/adonet/sql/authentication-in-sql-server"&gt;Windows Authentication&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;The significant thing about this approach is that it is more secure than using usernames and passwords in the connection string. If you have to use username and password to authenticate, then you need to persist them somewhere - so you need to make sure that's secure. Also, if someone manages to acquire that username and password, they're free to get access to the database and do malicious things.&lt;/p&gt;&lt;p&gt;Bottom line: the less you are sharing authentication credentials, the better your security. Integrated Security is a harder nut to crack than username and password. The thing to note about the above phrase is "Windows Authentication".  Web Apps in Azure / AWS etc do not typically use Windows Authentication when it comes to connecting to the database.  Connecting with username / password is far more common.&lt;/p&gt;&lt;p&gt;What if there was a way to have the developer experience of &lt;code&gt;Integrated Security=true&lt;/code&gt; without needing to use Windows Authentication?  There is.&lt;/p&gt;&lt;h4 id="managedidentity"&gt;Managed Identity&lt;/h4&gt;&lt;p&gt;The docs express the purpose of &lt;a href="https://docs.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/overview"&gt;managed identity&lt;/a&gt; well:&lt;/p&gt;&lt;blockquote&gt;  &lt;p&gt;A common challenge for developers is the management of secrets and credentials to secure communication between different services. On Azure, managed identities eliminate the need for developers having to manage credentials by providing an identity for the Azure resource in Azure AD and using it to obtain Azure Active Directory (Azure AD) tokens&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;Historically a certain amount of ceremony was required to use managed identity to connect to a database, and could involve augmenting a &lt;code&gt;DbContext&lt;/code&gt; like so:&lt;/p&gt;&lt;pre&gt;&lt;code class="cs language-cs"&gt;public MyDbContext(DbContextOptions options) : base(options) {&lt;br /&gt;    var conn = (Microsoft.Data.SqlClient.SqlConnection)Database.GetDbConnection();&lt;br /&gt;    var credential = new DefaultAzureCredential();&lt;br /&gt;    var token = credential&lt;br /&gt;        .GetToken(&lt;br /&gt;            new Azure.Core.TokenRequestContext(new[] { "https://database.windows.net/.default" })&lt;br /&gt;        );&lt;br /&gt;    conn.AccessToken = token.Token;&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;This mechanism works, and has the tremendous upside of no longer requiring credentials be passed in a connection string.  However, as you can see this isn't the simplest of setups.  And also, what if you don't want to use managed identity when you're developing locally?  This approach has baggage and forces us to make code changes.&lt;/p&gt;&lt;h4 id="connectionstringalone"&gt;Connection String alone&lt;/h4&gt;&lt;p&gt;The wonderful aspect of the original &lt;code&gt;Integrated Security=true&lt;/code&gt; approach, was that there were no code changes required; one need only supply the connection string. Just configuration.&lt;/p&gt;&lt;p&gt;This is now possible with Azure SQL thanks to &lt;a href="https://github.com/dotnet/SqlClient/pull/730"&gt;this PR&lt;/a&gt; to the &lt;a href="https://www.nuget.org/packages/Microsoft.Data.SqlClient/"&gt;Microsoft.Data.SqlClient&lt;/a&gt; nuget package. (Incidentally, &lt;a href="https://devblogs.microsoft.com/dotnet/introducing-the-new-microsoftdatasqlclient/"&gt;Microsoft.Data.SqlClient is the successor to System.Data.SqlClient.&lt;/a&gt;)&lt;/p&gt;&lt;p&gt;Support for connection string managed identities &lt;a href="https://github.com/dotnet/SqlClient/blob/master/release-notes/2.1/2.1.0.md#Azure-Active-Directory-Managed-Identity-authentication"&gt;shipped with v2.1&lt;/a&gt;. Connection strings can look slightly different depending on the type of managed identity you're using:&lt;/p&gt;&lt;pre&gt;&lt;code&gt;// For System Assigned Managed Identity&lt;br /&gt;"Server:{serverURL}; Authentication=Active Directory MSI; Initial Catalog={db};"&lt;br /&gt;&lt;br /&gt;// For System Assigned Managed Identity&lt;br /&gt;"Server:{serverURL}; Authentication=Active Directory Managed Identity; Initial Catalog={db};"&lt;br /&gt;&lt;br /&gt;// For User Assigned Managed Identity&lt;br /&gt;"Server:{serverURL}; Authentication=Active Directory MSI; User Id={ObjectIdOfManagedIdentity}; Initial Catalog={db};"&lt;br /&gt;&lt;br /&gt;// For User Assigned Managed Identity&lt;br /&gt;"Server:{serverURL}; Authentication=Active Directory Managed Identity; User Id={ObjectIdOfManagedIdentity}; Initial Catalog={db};"&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Regardless of the approach, you can see that none of the connection strings have credentials in them.  And that's special.&lt;/p&gt;&lt;h4 id="usagewithentityframeworkcore5"&gt;Usage with Entity Framework Core 5&lt;/h4&gt;&lt;p&gt;If you're using Entity Framework Core, you might be struggling to get this working and encountering strange error messages.  In my ASP.NET project I had a dependendency on  &lt;a href="https://www.nuget.org/packages/Microsoft.EntityFrameworkCore.SqlServer/5.0.4"&gt;Microsoft.EntityFrameworkCore.SqlServer@5&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;&lt;img style="max-width: 100%;" src="https://raw.githubusercontent.com/johnnyreilly/blog.johnnyreilly.com/main/blog-website/static/blog/2021-03-10-managed-identity-azure-sql-entity-framework/entity-framework-core-nuget.png" alt="Microsoft.EntityFrameworkCore.SqlServer@5 in NuGet" /&gt;&lt;/p&gt;&lt;p&gt;If you look close above, you'll see that the package has a dependency on Microsoft.Data.SqlClient, but crucially on 2.0.1 or greater.  So if &lt;code&gt;dotnet&lt;/code&gt; has installed a version of Microsoft.Data.SqlClient which is &lt;em&gt;less&lt;/em&gt; than 2.1 then the functionality required will not be installed. The resolution is simple, ensure that the required version is installed:&lt;/p&gt;&lt;pre&gt;&lt;code&gt;dotnet add package Microsoft.Data.SqlClient --version 2.1.2&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The version which we want to use is 2.1 (or greater) and fortunately that is compatible with Entity Framework Core 5.  Incidentally, when Entity Framework Core 6 ships it will no longer be necessary to manually specify this dependency as it already requires Microsoft.Data.SqlClient@2.1 as a minimum.&lt;/p&gt;&lt;h4 id="userassignedmanagedidentity"&gt;User Assigned Managed Identity&lt;/h4&gt;&lt;p&gt;If you're using user assigned managed identity, you'll need to supply the object id of your managed identity, which you can find in the &lt;a href="https://portal.azure.com/"&gt;Azure Portal&lt;/a&gt;:&lt;/p&gt;&lt;p&gt;&lt;img style="max-width: 100%;" src="https://raw.githubusercontent.com/johnnyreilly/blog.johnnyreilly.com/main/blog-website/static/blog/2021-03-10-managed-identity-azure-sql-entity-framework/managed-identity-object-id.png" alt="Managed Identity object id" /&gt;&lt;/p&gt;&lt;p&gt;You can configure this in ARM as well, but cryptically, the object id goes by the nom de plume of &lt;code&gt;principalId&lt;/code&gt; (thanks to my partner in crime &lt;a href="https://github.com/jmccor99"&gt;John McCormick&lt;/a&gt; for puzzling that out):&lt;/p&gt;&lt;pre&gt;&lt;code class="json language-json"&gt;"CONNECTIONSTRINGS__OURDBCONNECTION": "[concat('Server=tcp:', parameters('sqlServerName') , '.database.windows.net,1433;Initial Catalog=', parameters('sqlDatabaseName'),';Authentication=Active Directory MSI',';User Id=', reference(resourceId('Microsoft.ManagedIdentity/userAssignedIdentities/', parameters('managedIdentityName')), '2018-11-30').principalId)]"&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;That's it! With managed identity handling your authentication you can sleep easy, knowing you should be in a better place security wise.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/822627434282421455'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/822627434282421455'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2021/03/managed-identity-azure-sql-and-entity.html' title='Managed Identity, Azure SQL and Entity Framework'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5409171245965083944</id><published>2021-03-06T18:44:00.001Z</published><updated>2021-03-07T06:42:37.679Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Generate TypeScript and CSharp clients with NSwag based on an API</title><content type='html'>&lt;p&gt;Generating clients for APIs is a tremendous way to reduce the amount of work you have to do when you're building a project.  Why handwrite that code when it can be auto-generated for you quickly and accurately by a tool like &lt;a href="https://github.com/RicoSuter/NSwag"&gt;NSwag&lt;/a&gt;? To quote the docs:&lt;/p&gt;&lt;blockquote&gt;  &lt;p&gt;The NSwag project provides tools to generate OpenAPI specifications from existing ASP.NET Web API controllers and client code from these OpenAPI specifications.   The project combines the functionality of Swashbuckle (OpenAPI/Swagger generation) and AutoRest (client generation) in one toolchain. &lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;There's some great posts out there that show you how to generate the clients with NSwag using an &lt;code&gt;nswag.json&lt;/code&gt; file directly from a .NET project.&lt;/p&gt;&lt;p&gt;However, what if you want to use NSwag purely for its client generation capabilities? You may have an API written with another language / platform that exposes a Swagger endpoint, that you simply wish to create a client for.  How do you do that?  Also, if you want to do some special customisation of the clients you're generating, you may find yourself struggling to configure that in &lt;code&gt;nswag.json&lt;/code&gt;. In that case, it's possible to hook into NSwag directly to do this with a simple .NET console app.&lt;/p&gt;&lt;p&gt;This post will:&lt;/p&gt;&lt;ul&gt;  &lt;li&gt;Create a .NET API which exposes a Swagger endpoint. (Alternatively, you could use any other Swagger endpoint; &lt;a href="https://blog.logrocket.com/documenting-your-express-api-with-swagger/"&gt;for example an Express API&lt;/a&gt;.)&lt;/li&gt;&lt;li&gt;Create a .NET console app which can create both TypeScript and CSharp clients from a Swagger endpoint.&lt;/li&gt;&lt;li&gt;Create a script which, when run, creates a TypeScript client.&lt;/li&gt;&lt;li&gt;Consume the API using the generated client in a simple TypeScript application.&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;You will need both &lt;a href="https://nodejs.org/en/"&gt;Node.js&lt;/a&gt; and the &lt;a href="https://dotnet.microsoft.com/download"&gt;.NET SDK&lt;/a&gt; installed.&lt;/p&gt;&lt;h4 id="createanapi"&gt;Create an API&lt;/h4&gt; &lt;p&gt;We'll now create an API which exposes a &lt;a href="https://swagger.io/resources/open-api/"&gt;Swagger / Open API&lt;/a&gt; endpoint.  Whilst we're doing that we'll create a TypeScript React app which we'll use later on. We'll drop to the command line and enter the following commands which use the .NET SDK, node and the &lt;code&gt;create-react-app&lt;/code&gt; package:&lt;/p&gt;&lt;pre class="prettyprint cs"&gt;&lt;code class="shell language-shell"&gt;mkdir src&lt;br /&gt;cd src&lt;br /&gt;npx create-react-app client-app --template typescript&lt;br /&gt;mkdir server-app&lt;br /&gt;cd server-app&lt;br /&gt;dotnet new api -o API&lt;br /&gt;cd API&lt;br /&gt;dotnet add package NSwag.AspNetCore&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;We now have a .NET API with a dependency on NSwag. We'll start to use it by replacing the &lt;code&gt;Startup.cs&lt;/code&gt; that's been generated with the following:&lt;/p&gt;&lt;pre class="prettyprint cs"&gt;&lt;code class="cs language-cs"&gt;using Microsoft.AspNetCore.Builder;&lt;br /&gt;using Microsoft.AspNetCore.Hosting;&lt;br /&gt;using Microsoft.Extensions.Configuration;&lt;br /&gt;using Microsoft.Extensions.DependencyInjection;&lt;br /&gt;using Microsoft.Extensions.Hosting;&lt;br /&gt;&lt;br /&gt;namespace API&lt;br /&gt;{&lt;br /&gt;    public class Startup&lt;br /&gt;    {&lt;br /&gt;        const string ALLOW_DEVELOPMENT_CORS_ORIGINS_POLICY = "AllowDevelopmentSpecificOrigins";&lt;br /&gt;        const string LOCAL_DEVELOPMENT_URL = "http://localhost:3000";&lt;br /&gt;&lt;br /&gt;        public Startup(IConfiguration configuration)&lt;br /&gt;        {&lt;br /&gt;            Configuration = configuration;&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        public IConfiguration Configuration { get; }&lt;br /&gt;&lt;br /&gt;        // This method gets called by the runtime. Use this method to add services to the container.&lt;br /&gt;        public void ConfigureServices(IServiceCollection services)&lt;br /&gt;        {&lt;br /&gt;&lt;br /&gt;            services.AddControllers();&lt;br /&gt;&lt;br /&gt;            services.AddCors(options =&amp;gt; {&lt;br /&gt;                options.AddPolicy(name: ALLOW_DEVELOPMENT_CORS_ORIGINS_POLICY,&lt;br /&gt;                    builder =&amp;gt; {&lt;br /&gt;                        builder.WithOrigins(LOCAL_DEVELOPMENT_URL)&lt;br /&gt;                            .AllowAnyMethod()&lt;br /&gt;                            .AllowAnyHeader()&lt;br /&gt;                            .AllowCredentials();&lt;br /&gt;                    });&lt;br /&gt;            });&lt;br /&gt;&lt;br /&gt;            // Register the Swagger services&lt;br /&gt;            services.AddSwaggerDocument();&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        // This method gets called by the runtime. Use this method to configure the HTTP request pipeline.&lt;br /&gt;        public void Configure (IApplicationBuilder app, IWebHostEnvironment env)&lt;br /&gt;        {&lt;br /&gt;            if (env.IsDevelopment())&lt;br /&gt;            {&lt;br /&gt;                app.UseDeveloperExceptionPage();&lt;br /&gt;            } &lt;br /&gt;            else&lt;br /&gt;            {&lt;br /&gt;                app.UseExceptionHandler("/Error");&lt;br /&gt;                app.UseHsts ();&lt;br /&gt;                app.UseHttpsRedirection();&lt;br /&gt;            }&lt;br /&gt;&lt;br /&gt;            app.UseDefaultFiles();&lt;br /&gt;            app.UseStaticFiles();&lt;br /&gt;&lt;br /&gt;            app.UseRouting();&lt;br /&gt;&lt;br /&gt;            app.UseAuthorization();&lt;br /&gt;&lt;br /&gt;            // Register the Swagger generator and the Swagger UI middlewares&lt;br /&gt;            app.UseOpenApi();&lt;br /&gt;            app.UseSwaggerUi3();&lt;br /&gt;&lt;br /&gt;            if (env.IsDevelopment())&lt;br /&gt;                app.UseCors(ALLOW_DEVELOPMENT_CORS_ORIGINS_POLICY);&lt;br /&gt;&lt;br /&gt;            app.UseEndpoints(endpoints =&amp;gt;&lt;br /&gt;            {&lt;br /&gt;                endpoints.MapControllers();&lt;br /&gt;            });&lt;br /&gt;        }&lt;br /&gt;    }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The significant changes in the above &lt;code&gt;Startup.cs&lt;/code&gt; are:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;Exposing a Swagger endpoint with &lt;code&gt;UseOpenApi&lt;/code&gt; and &lt;code&gt;UseSwaggerUi3&lt;/code&gt;.  NSwag will automagically create Swagger endpoints in your application for all your controllers. The .NET template ships with a &lt;code&gt;WeatherForecastController&lt;/code&gt;.&lt;/li&gt;&lt;li&gt;Allowing &lt;a href="https://docs.microsoft.com/en-us/aspnet/core/security/cors"&gt;Cross-Origin Requests (CORS)&lt;/a&gt; which is useful during development (and will facilitate a demo later).&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;Back in the root of our project we're going to initialise an npm project. We're going to use this to put in place a number of handy &lt;a href="https://docs.npmjs.com/cli/v6/using-npm/scripts"&gt;&lt;code&gt;npm scripts&lt;/code&gt;&lt;/a&gt; that will make our project easier to work with. So we'll &lt;code&gt;npm init&lt;/code&gt; and accept all the defaults.&lt;/p&gt;&lt;p&gt;Now we're going add some dependencies which our scripts will use: &lt;code&gt;npm install cpx cross-env npm-run-all start-server-and-test&lt;/code&gt;&lt;/p&gt;&lt;p&gt;We'll also add ourselves some &lt;code&gt;scripts&lt;/code&gt; to our &lt;code&gt;package.json&lt;/code&gt;:&lt;/p&gt;&lt;pre class="prettyprint cs"&gt;&lt;code class="json language-json"&gt;  "scripts": {&lt;br /&gt;    "postinstall": "npm run install:client-app &amp;amp;&amp;amp; npm run install:server-app",&lt;br /&gt;    "install:client-app": "cd src/client-app &amp;amp;&amp;amp; npm install",&lt;br /&gt;    "install:server-app": "cd src/server-app/API &amp;amp;&amp;amp; dotnet restore",&lt;br /&gt;    "build": "npm run build:client-app &amp;amp;&amp;amp; npm run build:server-app",&lt;br /&gt;    "build:client-app": "cd src/client-app &amp;amp;&amp;amp; npm run build",&lt;br /&gt;    "postbuild:client-app": "cpx \"src/client-app/build/**/*.*\" \"src/server-app/API/wwwroot/\"",&lt;br /&gt;    "build:server-app": "cd src/server-app/API &amp;amp;&amp;amp; dotnet build --configuration release",&lt;br /&gt;    "start": "run-p start:client-app start:server-app",&lt;br /&gt;    "start:client-app": "cd src/client-app &amp;amp;&amp;amp; npm start",&lt;br /&gt;    "start:server-app": "cross-env ASPNETCORE_URLS=http://*:5000 ASPNETCORE_ENVIRONMENT=Development dotnet watch --project src/server-app/API run --no-launch-profile"&lt;br /&gt;  }&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Let's walk through what the above scripts provide us with:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Running &lt;code&gt;npm install&lt;/code&gt; in the root of our project will not only install dependencies for our root &lt;code&gt;package.json&lt;/code&gt;, thanks to our &lt;code&gt;postinstall&lt;/code&gt;, &lt;code&gt;install:client-app&lt;/code&gt; and &lt;code&gt;install:server-app&lt;/code&gt; scripts it will install the React app and .NET app dependencies as well.&lt;/li&gt;&lt;li&gt;Running &lt;code&gt;npm run build&lt;/code&gt; will build our client and server apps.&lt;/li&gt;&lt;li&gt;Running &lt;code&gt;npm run start&lt;/code&gt; will start both our React app and our .NET app.  Our React app will be started at &lt;a href="http://localhost:3000"&gt;http://localhost:3000&lt;/a&gt;. Our .NET app will be started at &lt;a href="http://localhost:5000"&gt;http://localhost:5000&lt;/a&gt; (some environment variables are passed to it with &lt;a href="https://github.com/kentcdodds/cross-env"&gt;&lt;code&gt;cross-env&lt;/code&gt;&lt;/a&gt; ).&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;Once &lt;code&gt;npm run start&lt;/code&gt; has been run, you will find a Swagger endpoint at &lt;a href="http://localhost:5000/swagger"&gt;http://localhost:5000/swagger&lt;/a&gt;:&lt;/p&gt; &lt;div class="separator" style="clear: both;"&gt;&lt;a href="https://1.bp.blogspot.com/-LUtQhYEKuKY/YDKqrDPdzqI/AAAAAAAAZSI/7IMmlA1YC3Esn8_DapWEawUuA3zirF02wCLcBGAsYHQ/s2048/swagger.png" style="display: block; padding: 1em 0; text-align: center; "&gt;&lt;img alt="swagger screenshot" border="0" width="600" data-original-height="1235" data-original-width="2048" src="https://1.bp.blogspot.com/-LUtQhYEKuKY/YDKqrDPdzqI/AAAAAAAAZSI/7IMmlA1YC3Esn8_DapWEawUuA3zirF02wCLcBGAsYHQ/s600/swagger.png"/&gt;&lt;/a&gt;&lt;/div&gt; &lt;h4 id="theclientgeneratorproject"&gt;The client generator project&lt;/h4&gt;&lt;p&gt;Now we've scaffolded our Swagger-ed API, we want to put together the console app that will generate our typed clients.&lt;/p&gt;&lt;pre class="prettyprint cs"&gt;&lt;code class="shell language-shell"&gt;cd src/server-app&lt;br /&gt;dotnet new console -o APIClientGenerator&lt;br /&gt;cd APIClientGenerator&lt;br /&gt;dotnet add package NSwag.CodeGeneration.CSharp&lt;br /&gt;dotnet add package NSwag.CodeGeneration.TypeScript&lt;br /&gt;dotnet add package NSwag.Core&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;We now have a console app with dependencies on the code generation portions of NSwag. Now let's change up &lt;code&gt;Program.cs&lt;/code&gt; to make use of this:&lt;/p&gt;&lt;pre class="prettyprint cs"&gt;&lt;code class="cs language-cs"&gt;using System;&lt;br /&gt;using System.IO;&lt;br /&gt;using System.Threading.Tasks;&lt;br /&gt;using NJsonSchema;&lt;br /&gt;using NJsonSchema.CodeGeneration.TypeScript;&lt;br /&gt;using NJsonSchema.Visitors;&lt;br /&gt;using NSwag;&lt;br /&gt;using NSwag.CodeGeneration.CSharp;&lt;br /&gt;using NSwag.CodeGeneration.TypeScript;&lt;br /&gt;&lt;br /&gt;namespace APIClientGenerator&lt;br /&gt;{&lt;br /&gt;    class Program&lt;br /&gt;    {&lt;br /&gt;        static async Task Main(string[] args)&lt;br /&gt;        {&lt;br /&gt;            if (args.Length != 3)&lt;br /&gt;                throw new ArgumentException("Expecting 3 arguments: URL, generatePath, language");&lt;br /&gt;&lt;br /&gt;            var url = args[0];&lt;br /&gt;            var generatePath = Path.Combine(Directory.GetCurrentDirectory(), args[1]);&lt;br /&gt;            var language = args[2];&lt;br /&gt;&lt;br /&gt;            if (language != "TypeScript" &amp;amp;&amp;amp; language != "CSharp")&lt;br /&gt;                throw new ArgumentException("Invalid language parameter; valid values are TypeScript and CSharp");&lt;br /&gt;&lt;br /&gt;            if (language == "TypeScript") &lt;br /&gt;                await GenerateTypeScriptClient(url, generatePath);&lt;br /&gt;            else&lt;br /&gt;                await GenerateCSharpClient(url, generatePath);&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        async static Task GenerateTypeScriptClient(string url, string generatePath) =&amp;gt;&lt;br /&gt;            await GenerateClient(&lt;br /&gt;                document: await OpenApiDocument.FromUrlAsync(url),&lt;br /&gt;                generatePath: generatePath,&lt;br /&gt;                generateCode: (OpenApiDocument document) =&amp;gt;&lt;br /&gt;                {&lt;br /&gt;                    var settings = new TypeScriptClientGeneratorSettings();&lt;br /&gt;&lt;br /&gt;                    settings.TypeScriptGeneratorSettings.TypeStyle = TypeScriptTypeStyle.Interface;&lt;br /&gt;                    settings.TypeScriptGeneratorSettings.TypeScriptVersion = 3.5M;&lt;br /&gt;                    settings.TypeScriptGeneratorSettings.DateTimeType = TypeScriptDateTimeType.String;&lt;br /&gt;&lt;br /&gt;                    var generator = new TypeScriptClientGenerator(document, settings);&lt;br /&gt;                    var code = generator.GenerateFile();&lt;br /&gt;&lt;br /&gt;                    return code;&lt;br /&gt;                }&lt;br /&gt;            );&lt;br /&gt;&lt;br /&gt;        async static Task GenerateCSharpClient(string url, string generatePath) =&amp;gt;&lt;br /&gt;            await GenerateClient(&lt;br /&gt;                document: await OpenApiDocument.FromUrlAsync(url),&lt;br /&gt;                generatePath: generatePath,&lt;br /&gt;                generateCode: (OpenApiDocument document) =&amp;gt;&lt;br /&gt;                {&lt;br /&gt;                    var settings = new CSharpClientGeneratorSettings&lt;br /&gt;                    {&lt;br /&gt;                        UseBaseUrl = false&lt;br /&gt;                    };&lt;br /&gt;&lt;br /&gt;                    var generator = new CSharpClientGenerator(document, settings);&lt;br /&gt;                    var code = generator.GenerateFile();&lt;br /&gt;                    return code;&lt;br /&gt;                }&lt;br /&gt;            );&lt;br /&gt;&lt;br /&gt;        private async static Task GenerateClient(OpenApiDocument document, string generatePath, Func&amp;lt;OpenApiDocument, string&amp;gt; generateCode)&lt;br /&gt;        {&lt;br /&gt;            Console.WriteLine($"Generating {generatePath}...");&lt;br /&gt;&lt;br /&gt;            var code = generateCode(document);&lt;br /&gt;&lt;br /&gt;            await System.IO.File.WriteAllTextAsync(generatePath, code);&lt;br /&gt;        }&lt;br /&gt;    }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;We've created ourselves a simple .NET console application that creates TypeScript and CSharp clients for a given Swagger URL.  It expects three arguments:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;code&gt;url&lt;/code&gt; - the url of the &lt;code&gt;swagger.json&lt;/code&gt; file to generate a client for.&lt;/li&gt;&lt;li&gt;&lt;code&gt;generatePath&lt;/code&gt; - the path where the generated client file should be placed, relative to this project.&lt;/li&gt;&lt;li&gt;&lt;code&gt;language&lt;/code&gt; - the language of the client to generate; valid values are "TypeScript" and "CSharp".&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;To create a TypeScript client with it then we'd use the following command:&lt;/p&gt;&lt;pre class="prettyprint shell"&gt;&lt;code class="shell language-shell"&gt;dotnet run --project src/server-app/APIClientGenerator http://localhost:5000/swagger/v1/swagger.json src/client-app/src/clients.ts TypeScript&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;However, for this to run successfully, we'll first have to ensure the API is running.  It would be great if we had a single command we could run that would:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;bring up the API&lt;/li&gt;&lt;li&gt;generate a client&lt;/li&gt;&lt;li&gt;bring down the API&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;Let's make that.&lt;/p&gt;&lt;h4 id="buildingamakeaclientscript"&gt;Building a "make a client" script&lt;/h4&gt;&lt;p&gt;In the root of the project we're going to add the following &lt;code&gt;scripts&lt;/code&gt;:&lt;/p&gt;&lt;pre class="prettyprint json"&gt;&lt;code class="json language-json"&gt;    "generate-client:server-app": "start-server-and-test generate-client:server-app:serve http-get://localhost:5000/swagger/v1/swagger.json generate-client:server-app:generate",&lt;br /&gt;    "generate-client:server-app:serve": "cross-env ASPNETCORE_URLS=http://*:5000 ASPNETCORE_ENVIRONMENT=Development dotnet run --project src/server-app/API --no-launch-profile",&lt;br /&gt;    "generate-client:server-app:generate": "dotnet run --project src/server-app/APIClientGenerator http://localhost:5000/swagger/v1/swagger.json src/client-app/src/clients.ts TypeScript",&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Let's walk through what's happening here. Running &lt;code&gt;npm run generate-client:server-app&lt;/code&gt; will:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Use the &lt;a href="https://github.com/bahmutov/start-server-and-test"&gt;&lt;code&gt;start-server-and-test&lt;/code&gt;&lt;/a&gt; package to spin up our server-app by running the &lt;code&gt;generate-client:server-app:serve&lt;/code&gt; script.&lt;/li&gt;&lt;li&gt;&lt;code&gt;start-server-and-test&lt;/code&gt; waits for the Swagger endpoint to start responding to requests. When it does start responding, &lt;code&gt;start-server-and-test&lt;/code&gt; runs the &lt;code&gt;generate-client:server-app:generate&lt;/code&gt; script which runs our APIClientGenerator console app and provides it with the URL where our swagger can be found, the path of the file to generate and the language of "TypeScript"&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;If you were wanting to generate a C# client (say if you were writing a &lt;a href="https://blog.logrocket.com/js-free-frontends-blazor/"&gt;Blazor&lt;/a&gt; app) then you could change the &lt;code&gt;generate-client:server-app:generate&lt;/code&gt; script as follows:&lt;/p&gt;&lt;pre class="prettyprint json"&gt;&lt;code class="json language-json"&gt;   "generate-client:server-app:generate": "dotnet run --project src/server-app/ApiClientGenerator http://localhost:5000/swagger/v1/swagger.json clients.cs CSharp",&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="consumeourgeneratedapiclient"&gt;Consume our generated API client&lt;/h4&gt;&lt;p&gt;Let's run the &lt;code&gt;npm run generate-client:server-app&lt;/code&gt; command.  It creates a &lt;code&gt;clients.ts&lt;/code&gt; file which nestles nicely inside our &lt;code&gt;client-app&lt;/code&gt;. We're going to exercise that in a moment. First of all, let's enable proxying from our &lt;code&gt;client-app&lt;/code&gt; to our &lt;code&gt;server-app&lt;/code&gt; following the instructions in the &lt;a href="https://create-react-app.dev/docs/proxying-api-requests-in-development/"&gt;Create React App docs&lt;/a&gt; and adding the following to our &lt;code&gt;client-app/package.json&lt;/code&gt;:&lt;/p&gt;&lt;pre class="prettyprint cs"&gt;&lt;code class="json language-json"&gt;  "proxy": "http://localhost:5000"&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Now let's start our apps with &lt;code&gt;npm run start&lt;/code&gt;.  We'll then replace the contents of &lt;code&gt;App.tsx&lt;/code&gt; with:&lt;/p&gt;&lt;pre class="prettyprint tsx"&gt;&lt;code class="tsx language-jsx"&gt;import React from "react";&lt;br /&gt;import "./App.css";&lt;br /&gt;import { WeatherForecast, WeatherForecastClient } from "./clients";&lt;br /&gt;&lt;br /&gt;function App() {&lt;br /&gt;  const [weather, setWeather] = React.useState&amp;lt;WeatherForecast[] | null&amp;gt;();&lt;br /&gt;  React.useEffect(() =&amp;gt; {&lt;br /&gt;    async function loadWeather() {&lt;br /&gt;      const weatherClient = new WeatherForecastClient(/* baseUrl */ "");&lt;br /&gt;      const forecast = await weatherClient.get();&lt;br /&gt;      setWeather(forecast);&lt;br /&gt;    }&lt;br /&gt;    loadWeather();&lt;br /&gt;  }, [setWeather]);&lt;br /&gt;&lt;br /&gt;  return (&lt;br /&gt;    &amp;lt;div className="App"&amp;gt;&lt;br /&gt;      &amp;lt;header className="App-header"&amp;gt;&lt;br /&gt;        {weather ? (&lt;br /&gt;          &amp;lt;table&amp;gt;&lt;br /&gt;            &amp;lt;thead&amp;gt;&lt;br /&gt;              &amp;lt;tr&amp;gt;&lt;br /&gt;                &amp;lt;th&amp;gt;Date&amp;lt;/th&amp;gt;&lt;br /&gt;                &amp;lt;th&amp;gt;Summary&amp;lt;/th&amp;gt;&lt;br /&gt;                &amp;lt;th&amp;gt;Centigrade&amp;lt;/th&amp;gt;&lt;br /&gt;                &amp;lt;th&amp;gt;Fahrenheit&amp;lt;/th&amp;gt;&lt;br /&gt;              &amp;lt;/tr&amp;gt;&lt;br /&gt;            &amp;lt;/thead&amp;gt;&lt;br /&gt;            &amp;lt;tbody&amp;gt;&lt;br /&gt;              {weather.map(({ date, summary, temperatureC, temperatureF }) =&amp;gt; (&lt;br /&gt;                &amp;lt;tr key={date}&amp;gt;&lt;br /&gt;                  &amp;lt;td&amp;gt;{new Date(date).toLocaleDateString()}&amp;lt;/td&amp;gt;&lt;br /&gt;                  &amp;lt;td&amp;gt;{summary}&amp;lt;/td&amp;gt;&lt;br /&gt;                  &amp;lt;td&amp;gt;{temperatureC}&amp;lt;/td&amp;gt;&lt;br /&gt;                  &amp;lt;td&amp;gt;{temperatureF}&amp;lt;/td&amp;gt;&lt;br /&gt;                &amp;lt;/tr&amp;gt;&lt;br /&gt;              ))}&lt;br /&gt;            &amp;lt;/tbody&amp;gt;&lt;br /&gt;          &amp;lt;/table&amp;gt;&lt;br /&gt;        ) : (&lt;br /&gt;          &amp;lt;p&amp;gt;Loading weather...&amp;lt;/p&amp;gt;&lt;br /&gt;        )}&lt;br /&gt;      &amp;lt;/header&amp;gt;&lt;br /&gt;    &amp;lt;/div&amp;gt;&lt;br /&gt;  );&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;export default App;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Inside the &lt;code&gt;React.useEffect&lt;/code&gt; above you can see we create a new instance of the auto-generated &lt;code&gt;WeatherForecastClient&lt;/code&gt;.  We then call &lt;code&gt;weatherClient.get()&lt;/code&gt; which sends the &lt;code&gt;GET&lt;/code&gt; request to the server to acquire the data and provides it in a strongly typed fashion (&lt;code&gt;get()&lt;/code&gt; returns an array of &lt;code&gt;WeatherForecast&lt;/code&gt;). This is then displayed on the page like so:&lt;/p&gt; &lt;div class="separator" style="clear: both;"&gt;&lt;a href="https://1.bp.blogspot.com/-s1udvINOP9A/YDKrVvsAnZI/AAAAAAAAZSQ/RK9QzXaUc6k8z-XK9ECGvoHFHaWdCL17wCLcBGAsYHQ/s2048/use-generated-client.gif" style="display: block; padding: 1em 0; text-align: center; "&gt;&lt;img alt="load data from server" border="0" width="600" data-original-height="1210" data-original-width="2048" src="https://1.bp.blogspot.com/-s1udvINOP9A/YDKrVvsAnZI/AAAAAAAAZSQ/RK9QzXaUc6k8z-XK9ECGvoHFHaWdCL17wCLcBGAsYHQ/s600/use-generated-client.gif"/&gt;&lt;/a&gt;&lt;/div&gt; &lt;p&gt;As you an see we're loading data from the server using our auto-generated client.  We're reducing the amount of code we have to write &lt;em&gt;and&lt;/em&gt; we're reducing the likelihood of errors.&lt;/p&gt; &lt;p&gt;&lt;em&gt;This post was originally posted on &lt;a href="https://blog.logrocket.com/generate-typescript-csharp-clients-nswag-api/"&gt;LogRocket&lt;/a&gt;.&lt;/em&gt;&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5409171245965083944'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5409171245965083944'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2021/02/generate-typescript-and-csharp-clients-with-nswag.html' title='Generate TypeScript and CSharp clients with NSwag based on an API'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='https://1.bp.blogspot.com/-LUtQhYEKuKY/YDKqrDPdzqI/AAAAAAAAZSI/7IMmlA1YC3Esn8_DapWEawUuA3zirF02wCLcBGAsYHQ/s72-c/swagger.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4479369118777113203</id><published>2021-02-27T18:34:00.000Z</published><updated>2021-02-27T18:34:10.273Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Goodbye Client Affinity, Hello Data Protection with Azure</title><content type='html'>&lt;p&gt;I've written lately about &lt;a href="https://blog.johnnyreilly.com/2021/02/azure-app-service-health-checks-and-zero-downtime-deployments.html"&gt;zero downtime releases with Azure App Service&lt;/a&gt;.  Zero downtime releases are only successful if your authentication mechanism survives a new deployment.  We looked in my last post at &lt;a href="https://blog.johnnyreilly.com/2021/02/easy-auth-tokens-survive-releases-on-linux-azure-app-service.html"&gt;how to achieve this with Azure's in-built authentication mechanism; Easy Auth&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;We're now going to look at how the same goal can be achieved if your ASP.NET application is authenticating another way. We achieve this through use of the &lt;a href="https://docs.microsoft.com/en-us/aspnet/core/security/data-protection/configuration/overview"&gt;ASP.NET Data Protection&lt;/a&gt; system. Andrew Lock has written &lt;a href="https://andrewlock.net/an-introduction-to-the-data-protection-system-in-asp-net-core/"&gt;an excellent walkthrough on the topic&lt;/a&gt; and I encourage you to read it.  &lt;/p&gt;&lt;p&gt;We're interested in the ASP.NET data-protection system because it encrypts and decrypts sensitive data including the authentication cookie. It's wonderful that the data protection does this, but at the same time it presents a problem. We would like to route traffic to &lt;em&gt;multiple&lt;/em&gt; instances of our application So traffic could go to instance 1, instance 2 of our app etc.&lt;/p&gt; &lt;div class="separator" style="clear: both;"&gt;&lt;a href="https://1.bp.blogspot.com/-UwrtZigWg78/YDqN82KbjVI/AAAAAAAAZTE/Umezr1MGQicnxMMr5rQHD4xKINg9fasDACLcBGAsYHQ/s783/traffic-to-app-service.png" style="display: block; padding: 1em 0; text-align: center; "&gt;&lt;img  alt="traffic to app service" border="0" width="600" data-original-height="753" data-original-width="783" src="https://1.bp.blogspot.com/-UwrtZigWg78/YDqN82KbjVI/AAAAAAAAZTE/Umezr1MGQicnxMMr5rQHD4xKINg9fasDACLcBGAsYHQ/s600/traffic-to-app-service.png"/&gt;&lt;/a&gt;&lt;/div&gt; &lt;p&gt;How can we ensure the different instances of our app can read the authentication cookies regardless of the instance that produced them? How can we ensure that instance 1 can read cookies produced by instance 2 and vice versa?  And for that matter, we'd like all instances to be able to read cookies whether they were produced by an instance in a production or staging slot. &lt;/p&gt;&lt;p&gt;We're aiming to avoid the use of "sticky sessions" and ARRAffinity cookies. These ensure that traffic is continually routed to the same instance. Routing to the same instance explicitly prevents us from stopping routing traffic to an old instance and starting routing to a new one.&lt;/p&gt;&lt;p&gt;With the data protection activated and multiple instances of your app service you immediately face the issue that different instances of the app will be unable to read cookies they did not create.  This is the default behaviour of data protection. &lt;a href="https://docs.microsoft.com/en-us/aspnet/core/host-and-deploy/web-farm?view=aspnetcore-5.0#data-protection"&gt;To quote the docs:&lt;/a&gt;&lt;/p&gt;&lt;blockquote&gt;  &lt;p&gt;Data Protection relies upon a set of cryptographic keys stored in a key ring. When the Data Protection system is initialized, it applies default settings that store the key ring locally. Under the default configuration, a unique key ring is stored on each node of the web farm. Consequently, each web farm node can't decrypt data that's encrypted by an app on any other node. &lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;The problem here is the data protection keys (the key ring) is being stored locally on each instance. What are the implications of this? Well, For example, instance 2 doesn't have access to the keys instance 1 is using and so can't decrypt instance 1 cookies.&lt;/p&gt;&lt;h4 id="sharingiscaring"&gt;Sharing is caring&lt;/h4&gt;&lt;p&gt;What we need to do is move away from storing keys locally, and to storing it in a &lt;em&gt;shared&lt;/em&gt; place instead.  We're going to store data protection keys in Azure Blob Storage and protect the keys with Azure Key Vault:&lt;/p&gt; &lt;div class="separator" style="clear: both;"&gt;&lt;a href="https://1.bp.blogspot.com/-0geuo2dyI_c/YDqORnxBh7I/AAAAAAAAZTM/0Oa6huI-5BgzLOSd7IO6aGHMZc1YacvBwCLcBGAsYHQ/s1087/data-protection-zero-downtime.png" style="display: block; padding: 1em 0; text-align: center; "&gt;&lt;img  alt="persist keys to azure blob" border="0" height="600" data-original-height="1087" data-original-width="783" src="https://1.bp.blogspot.com/-0geuo2dyI_c/YDqORnxBh7I/AAAAAAAAZTM/0Oa6huI-5BgzLOSd7IO6aGHMZc1YacvBwCLcBGAsYHQ/s600/data-protection-zero-downtime.png"/&gt;&lt;/a&gt;&lt;/div&gt; &lt;p&gt;All instances of the application can access the key ring and consequently sharing cookies is enabled.  &lt;a href="https://docs.microsoft.com/en-us/aspnet/core/security/data-protection/configuration/overview?view=aspnetcore-5.0#protectkeyswithazurekeyvault"&gt;As the documentation attests&lt;/a&gt;, enabling this is fairly simple.  It amounts to adding the following packages to your ASP.NET app:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;a href="https://www.nuget.org/packages/Azure.Extensions.AspNetCore.DataProtection.Blobs"&gt;&lt;code&gt;Azure.Extensions.AspNetCore.DataProtection.Blobs&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="https://www.nuget.org/packages/Azure.Extensions.AspNetCore.DataProtection.Keys"&gt;&lt;code&gt;Azure.Extensions.AspNetCore.DataProtection.Keys&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;And adding the following to the &lt;code&gt;ConfigureServices&lt;/code&gt; in your ASP.NET app:&lt;/p&gt;&lt;pre&gt;&lt;code class="cs language-cs"&gt;    services.AddDataProtection().SetApplicationName("OurWebApp")&lt;br /&gt;        // azure credentials require storage blob contributor role permissions&lt;br /&gt;        // eg https://my-storage-account.blob.core.windows.net/keys/key&lt;br /&gt;        .PersistKeysToAzureBlobStorage(new Uri($"https://{Configuration["StorageAccountName"]}.blob.core.windows.net/keys/key"), new DefaultAzureCredential())&lt;br /&gt;&lt;br /&gt;        // azure credentials require key vault crypto role permissions&lt;br /&gt;        // eg https://my-key-vault.vault.azure.net/keys/dataprotection&lt;br /&gt;        .ProtectKeysWithAzureKeyVault(new Uri($"https://{Configuration["KeyVaultName"]}.vault.azure.net/keys/dataprotection"), new DefaultAzureCredential());&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;In the above example you can see we're passing the name of our Storage account and Key Vault via configuration.&lt;/p&gt;&lt;p&gt;There's one more crucial piece of the puzzle here; and it's role assignments, better known as permissions.  Your App Service needs to be able to read and write to Azure Key Vault and the Azure Blob Storage. The permissions of &lt;a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#storage-blob-data-contributor"&gt;Storage Blob Data Contributor&lt;/a&gt; and &lt;a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#key-vault-crypto-officer-preview"&gt;Key Vault Crypto Officer&lt;/a&gt; are sufficient to enable this.  (If you'd like to see what configuring that looks like via ARM templates then &lt;a href="https://blog.johnnyreilly.com/2021/02/arm-templates-security-role-assignments.html"&gt;check out this post&lt;/a&gt;.)&lt;/p&gt;&lt;p&gt;With this in place we're able to route traffic to any instance of our application, secure in the knowledge that it will be able to read the cookies.  Furthermore, we've enabled zero downtime releases as a direct consequence.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4479369118777113203'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4479369118777113203'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2021/02/goodbye-client-affinity-hello-data-protection-with-azure.html' title='Goodbye Client Affinity, Hello Data Protection with Azure'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='https://1.bp.blogspot.com/-UwrtZigWg78/YDqN82KbjVI/AAAAAAAAZTE/Umezr1MGQicnxMMr5rQHD4xKINg9fasDACLcBGAsYHQ/s72-c/traffic-to-app-service.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6393942934254545669</id><published>2021-02-16T05:46:00.001Z</published><updated>2021-02-16T05:46:39.656Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Making Easy Auth tokens survive releases on Linux Azure App Service</title><content type='html'>&lt;p&gt;I &lt;a href="https://blog.johnnyreilly.com/2021/02/azure-app-service-health-checks-and-zero-downtime-deployments.html"&gt;wrote recently about zero downtime deployments on Azure App Service&lt;/a&gt;. Many applications require authentication, and ours is no exception. In our case we&amp;#39;re using Azure Active Directory facilitated by &lt;a href="https://docs.microsoft.com/en-us/azure/app-service/overview-authentication-authorization"&gt;&amp;quot;Easy Auth&amp;quot;&lt;/a&gt; which provides authentication to our App Service.&lt;/p&gt;&lt;p&gt;Our app uses a Linux App Service. It&amp;#39;s worth knowing that Linux App Services run as a Docker container. As a consequence, Easy Auth works in a slightly different way; effectively as a middleware. &lt;a href="https://docs.microsoft.com/en-us/azure/app-service/overview-authentication-authorization#on-containers"&gt;To quote the docs on Easy Auth&lt;/a&gt;:&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;This module handles several things for your app:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Authenticates users with the specified provider&lt;/li&gt;&lt;li&gt;Validates, stores, and refreshes tokens&lt;/li&gt;&lt;li&gt;Manages the authenticated session&lt;/li&gt;&lt;li&gt;Injects identity information into request headers&lt;br&gt;The module runs separately from your application code and is configured using app settings. No SDKs, specific languages, or changes to your application code are required.&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;The authentication and authorization module runs in a separate container, isolated from your application code. Using what&amp;#39;s known as the &lt;a href="https://docs.microsoft.com/en-us/azure/architecture/patterns/ambassador"&gt;Ambassador&lt;/a&gt; pattern, it interacts with the incoming traffic to perform similar functionality as on Windows.&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;However, &lt;a href="https://social.msdn.microsoft.com/Forums/en-US/dde551b2-c86d-474b-b0a6-cc66163785a1/restarting-azure-app-service-on-linux-with-azure-active-directory-authentication-resets-authme#b59951ab-623a-4442-a221-80c157387bbe"&gt;Microsoft have acknowledged there is a potential bug in Easy Auth support at present&lt;/a&gt;. When the app service is restarted, the stored tokens are removed, and &lt;strong&gt;authentication begins to fail&lt;/strong&gt;. As you might well imagine, authentication similarly  starts to fail when a new app service is introduced - as is the case during deployment.&lt;/p&gt;&lt;p&gt;This is really significant.  You may well have &amp;quot;zero downtime deployment&amp;quot;, but it doesn&amp;#39;t amount to a hill of beans if the moment you&amp;#39;ve deployed your users find they&amp;#39;re effectively logged out. &lt;a href="https://social.msdn.microsoft.com/Forums/en-US/dde551b2-c86d-474b-b0a6-cc66163785a1/restarting-azure-app-service-on-linux-with-azure-active-directory-authentication-resets-authme#b59951ab-623a-4442-a221-80c157387bbe"&gt;The advice from Microsoft&lt;/a&gt; is to use &lt;a href="https://docs.microsoft.com/en-gb/archive/blogs/jpsanders/azure-app-service-authentication-using-a-blob-storage-for-token-cache"&gt;Blob Storage for Token Cache&lt;/a&gt;:&lt;/p&gt;&lt;p&gt;&lt;a href="https://twitter.com/cgillum"&gt;Chris Gillum&lt;/a&gt; said in a &lt;a href="https://cgillum.tech/2016/03/07/app-service-token-store/"&gt;blog on the topic&lt;/a&gt;:&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;you can provision an Azure Blob Storage container and configure your web app with a SaS URL (with read/write/list access) pointing to that blob container. This SaS URL can then be saved to the &lt;code&gt;WEBSITE_AUTH_TOKEN_CONTAINER_SASURL&lt;/code&gt; app setting. When this app setting is present, all tokens will be stored in and fetched from the specified blob container.&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;To turn that into something visual, what&amp;#39;s suggested is this:&lt;/p&gt; &lt;div class="separator" style="clear: both;"&gt;&lt;a href="https://1.bp.blogspot.com/-aKGORx1hlLE/YCta21s3ayI/AAAAAAAAZRM/Ej3Wj-wYoAICyW6qf444kr_eSn4yI49QACLcBGAsYHQ/s1113/easy-auth-zero-downtime-deployment.png" style="display: block; padding: 1em 0;  "&gt;&lt;img alt="diagram of Easy Auth with blog storage" border="0" height="600" data-original-height="1113" data-original-width="880" src="https://1.bp.blogspot.com/-aKGORx1hlLE/YCta21s3ayI/AAAAAAAAZRM/Ej3Wj-wYoAICyW6qf444kr_eSn4yI49QACLcBGAsYHQ/s600/easy-auth-zero-downtime-deployment.png"/&gt;&lt;/a&gt;&lt;/div&gt;  &lt;h4 id="sas-sy-arm-templates"&gt;SaS-sy ARM Templates&lt;/h4&gt;&lt;p&gt;I have the good fortune to work with some very talented people.  One of them, &lt;a href="https://github.com/jmccor99"&gt;John McCormick&lt;/a&gt; turned his hand to putting this proposed solution into &lt;code&gt;azure-pipelines.yml&lt;/code&gt; and ARM template-land.  First of all, let&amp;#39;s look at our &lt;code&gt;azure-pipelines.yml&lt;/code&gt;.  We add the following, prior to our deployment job:&lt;/p&gt;&lt;pre class="prettyprint yml"&gt;&lt;code class="lang-yml"&gt;      - job: SASGen&lt;br /&gt;        displayName: Generate SAS Token&lt;br /&gt;&lt;br /&gt;        steps:&lt;br /&gt;          - task: AzurePowerShell@4&lt;br /&gt;            name: ObtainSasTokenTask&lt;br /&gt;            inputs:&lt;br /&gt;              azureSubscription: $(serviceConnection)&lt;br /&gt;              ScriptType: inlineScript&lt;br /&gt;              Inline: |&lt;br /&gt;                $startTime = Get-Date&lt;br /&gt;                $expiryTime = $startTime.AddDays(90)&lt;br /&gt;                $storageAcc = Get-AzStorageAccount -ResourceGroupName $(azureResourceGroup) -Name $(storageAccountName)&lt;br /&gt;                $ctx = $storageAcc.Context&lt;br /&gt;                $sas = New-AzStorageContainerSASToken -Context $ctx -Name &amp;quot;tokens&amp;quot; -Permission &amp;quot;rwl&amp;quot; -Protocol HttpsOnly -StartTime $startTime -ExpiryTime $expiryTime -FullUri&lt;br /&gt;                Write-Host &amp;quot;##vso[task.setvariable variable=sasToken;issecret=true;isOutput=true]$sas&amp;quot;&lt;br /&gt;              azurePowerShellVersion: &amp;#39;LatestVersion&amp;#39;&lt;br /&gt;&lt;br /&gt;      - job: DeployAppARMTemplates&lt;br /&gt;        variables:&lt;br /&gt;          sasToken: $[dependencies.SASGen.outputs[&amp;#39;ObtainSasTokenTask.sasToken&amp;#39;] ]&lt;br /&gt;        displayName: Deploy App ARM Templates&lt;br /&gt;        dependsOn:&lt;br /&gt;        - SASGen&lt;br /&gt;&lt;br /&gt;        steps:&lt;br /&gt;          - task: AzureResourceManagerTemplateDeployment@3&lt;br /&gt;            displayName: Deploy app-service ARM Template&lt;br /&gt;            inputs:&lt;br /&gt;              deploymentScope: Resource Group&lt;br /&gt;              azureResourceManagerConnection: $(serviceConnection)&lt;br /&gt;              subscriptionId: $(subscriptionId)&lt;br /&gt;              action: Create Or Update Resource Group&lt;br /&gt;              resourceGroupName: $(azureResourceGroup)&lt;br /&gt;              location: $(location)&lt;br /&gt;              templateLocation: Linked artifact&lt;br /&gt;              csmFile: &amp;#39;infra/app-service/azuredeploy.json&amp;#39;&lt;br /&gt;              csmParametersFile: &amp;#39;infra/azuredeploy.parameters.json&amp;#39;&lt;br /&gt;              overrideParameters: &amp;gt;-&lt;br /&gt;                -sasUrl $(sasToken)&lt;br /&gt;              deploymentMode: Incremental&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;There&amp;#39;s two notable things happening above:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;In the &lt;code&gt;SASGen&lt;/code&gt; job, a PowerShell script runs that &lt;a href="https://docs.microsoft.com/en-us/powershell/module/az.storage/new-azstoragecontainersastoken?view=azps-5.5.0"&gt;generates a SaS token URL&lt;/a&gt; with read, write and list permissions that will last for 90 days. (Incidentally, there is a way to do this via &lt;a href="https://stackoverflow.com/a/56127006/761388"&gt;ARM templates, and without PowerShell&lt;/a&gt; - but alas it didn&amp;#39;t seem to work when we experimented with it.)&lt;/li&gt;&lt;li&gt;The generated (secret) token URL (&lt;code&gt;sasUrl&lt;/code&gt;) is passed as a parameter to our App Service ARM template. The ARM template sets an appsetting for the app service:&lt;/li&gt;&lt;/ol&gt;&lt;pre class="prettyprint json"&gt;&lt;code class="lang-json"&gt;{&lt;br /&gt;    &amp;quot;apiVersion&amp;quot;: &amp;quot;2020-09-01&amp;quot;,&lt;br /&gt;    &amp;quot;name&amp;quot;: &amp;quot;appsettings&amp;quot;,&lt;br /&gt;    &amp;quot;type&amp;quot;: &amp;quot;config&amp;quot;,&lt;br /&gt;    &amp;quot;properties&amp;quot;: {&lt;br /&gt;        &amp;quot;WEBSITE_AUTH_TOKEN_CONTAINER_SASURL&amp;quot;: &amp;quot;[parameters(&amp;#39;sasUrl&amp;#39;)]&amp;quot;&lt;br /&gt;    }&lt;br /&gt;},&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;If you google &lt;code&gt;WEBSITE_AUTH_TOKEN_CONTAINER_SASURL&lt;/code&gt; you will not find a geat deal. Documentation is short.  What you will find is &lt;a href="http://jsandersblog.azurewebsites.net/2017/08/10/azure-app-service-authentication-using-a-blob-storage-for-token-cache/"&gt;Jeff Sanders excellent blog on the topic&lt;/a&gt;. It is, in terms of content, it has some commonality with this post; except in Jeff&amp;#39;s example he&amp;#39;s manually implementing the workaround in the Azure Portal.&lt;/p&gt;&lt;h4 id="what-s-actually-happening-"&gt;What&amp;#39;s actually happening?&lt;/h4&gt;&lt;p&gt;With this in place, every time someone logs into your app a JSON token is written to the storage like so:&lt;/p&gt; &lt;div class="separator" style="clear: both;"&gt;&lt;a href="https://1.bp.blogspot.com/-gl0CZKCUp9c/YCtbVHOeAsI/AAAAAAAAZRU/F1xd438bJ64UGrjhrt3nCspjC7lQ6hd7QCLcBGAsYHQ/s2598/token.png" style="display: block; padding: 1em 0; "&gt;&lt;img alt="token in storage account" border="0" width="600" data-original-height="542" data-original-width="2598" src="https://1.bp.blogspot.com/-gl0CZKCUp9c/YCtbVHOeAsI/AAAAAAAAZRU/F1xd438bJ64UGrjhrt3nCspjC7lQ6hd7QCLcBGAsYHQ/s600/token.png"/&gt;&lt;/a&gt;&lt;/div&gt; &lt;p&gt;If you take the trouble to look inside you&amp;#39;ll find something like this tucked away:&lt;/p&gt;&lt;pre class="prettyprint json"&gt;&lt;code class="lang-json"&gt;{&lt;br /&gt;    &amp;quot;encrypted&amp;quot;: true,&lt;br /&gt;    &amp;quot;tokens&amp;quot;: {&lt;br /&gt;        &amp;quot;aad&amp;quot;: &amp;quot;herewith_a_very_very_long_encrypted_token&amp;quot;&lt;br /&gt;    },&lt;br /&gt;    &amp;quot;version&amp;quot;: 1&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;With this in place, you can safely restart your app service and / or deploy a new one, safe in the knowledge that the tokens will live on in the storage account, and that consequently you will not be unauthenticating users. &lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/6393942934254545669'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/6393942934254545669'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2021/02/easy-auth-tokens-survive-releases-on-linux-azure-app-service.html' title='Making Easy Auth tokens survive releases on Linux Azure App Service'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='https://1.bp.blogspot.com/-aKGORx1hlLE/YCta21s3ayI/AAAAAAAAZRM/Ej3Wj-wYoAICyW6qf444kr_eSn4yI49QACLcBGAsYHQ/s72-c/easy-auth-zero-downtime-deployment.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8499903948848961831</id><published>2021-02-11T07:39:00.000Z</published><updated>2021-02-11T07:39:40.036Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Azure App Service, Health checks and zero downtime deployments</title><content type='html'>&lt;p&gt;I&amp;#39;ve been working recently on zero downtime deployments using Azure App Service. They&amp;#39;re facilitated by a combination of &lt;a href="https://docs.microsoft.com/en-us/azure/app-service/monitor-instances-health-check"&gt;Health checks&lt;/a&gt; and &lt;a href="https://docs.microsoft.com/en-us/azure/app-service/deploy-staging-slots"&gt;deployment slots&lt;/a&gt;. This post will talk about why this is important and how it works.&lt;/p&gt;&lt;h4 id="why-zero-downtime-deployments-"&gt;Why zero downtime deployments?&lt;/h4&gt;&lt;p&gt;Historically (and for many applications, currently) deployment results in downtime.  A period of time during the release where an application is not available to users whilst the new version is deployed. There are a number of downsides to releases with downtime:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;Your users cannot use your application. This will frustrate them and make them sad.&lt;/li&gt;&lt;li&gt;Because you&amp;#39;re a kind person and you want your users to be happy, you&amp;#39;ll optimise to make their lives better.  You&amp;#39;ll release when the fewest users are accessing your application. It will likely mean you&amp;#39;ll end up working late, early or at weekends.&lt;/li&gt;&lt;li&gt;Again because you want to reduce impact on users, you&amp;#39;ll release less often. This means that every release will bring with it a greater collection of changes.  This is turn will often result in a large degree of focus on manually testing each release, to reduce the likelihood of bugs ending up in users hands. This is a noble aim, but it drags the teams focus away from shipping.&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;Put simply: downtime in releases impacts customer happiness and leads to reduced pace for teams. It&amp;#39;s a vicious circle.&lt;/p&gt;&lt;p&gt;But if we turn it around, what does it look like if releases have &lt;em&gt;no&lt;/em&gt; downtime at all?&lt;/p&gt;&lt;ol&gt;&lt;li&gt;Your users can always use your application.  This will please them.&lt;/li&gt;&lt;li&gt;Your team is now safe to release at any time, day or night.  They will likely release more often as a consequence.&lt;/li&gt;&lt;li&gt;If your team has sufficient automated testing in place, they&amp;#39;re now in a position where they can move to &lt;a href="https://www.atlassian.com/continuous-delivery/principles/continuous-integration-vs-delivery-vs-deployment"&gt;Continuous Deployment&lt;/a&gt;.&lt;/li&gt;&lt;li&gt;Releases become boring.  This is good.  They &amp;quot;just work&amp;quot; and so the team can focus instead on building the cool features that are going to make users lives even better.&lt;/li&gt;&lt;/ol&gt;&lt;h4 id="manual-zero-downtime-releases-with-app-services"&gt;Manual zero downtime releases with App Services&lt;/h4&gt;&lt;p&gt;App Services have the ability to scale out. To &lt;a href="https://azure.microsoft.com/en-us/blog/scaling-up-and-scaling-out-in-windows-azure-web-sites/"&gt;quote the docs&lt;/a&gt;:&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;A scale out operation is the equivalent of creating multiple copies of your web site and adding a load balancer to distribute the demand  between them. When you scale out ... there is no need to configure load balancing separately since this is already provided by the platform.&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;As you can see, scaling out works by having multiple instances of your app. Deployment slots are exactly this, but with an extra twist.  If you add a deployment slot to your App Service, then you &lt;strong&gt;no longer deploy to production&lt;/strong&gt;.  Instead you deploy to your staging slot.  Your staging slot is accessible in the same way your production slot is accessible. So whilst your users may go to &lt;a href="https://my-glorious-app.io"&gt;https://my-glorious-app.io&lt;/a&gt;, your staging slot may live at &lt;a href="https://my-glorious-app-stage.azurewebsites.net"&gt;https://my-glorious-app-stage.azurewebsites.net&lt;/a&gt; instead.  Because this is accessible, this is testable.  You are in a position to test the deployed application before making it generally available.&lt;/p&gt; &lt;div class="separator" style="clear: both;"&gt;&lt;a href="https://1.bp.blogspot.com/-bTtR_2BzQ10/YCTcHnUqM1I/AAAAAAAAZJc/HsMQe-SERN4s71Scys8R8DSVkFmN4S5jgCPcBGAYYCw/s1100/app-service-with-slots.png" style="display: block; padding: 1em 0; text-align: center; "&gt;&lt;img alt="" border="0" width="600" data-original-height="893" data-original-width="1100" src="https://1.bp.blogspot.com/-bTtR_2BzQ10/YCTcHnUqM1I/AAAAAAAAZJc/HsMQe-SERN4s71Scys8R8DSVkFmN4S5jgCPcBGAYYCw/s600/app-service-with-slots.png"/&gt;&lt;/a&gt;&lt;/div&gt; &lt;p&gt;Once you&amp;#39;re happy that everything looks good, you can &amp;quot;swap slots&amp;quot;.  What this means, is the version of the app living in the staging slot, gets moved into the production slot. So that which lived at &lt;a href="https://my-glorious-app-stage.azurewebsites.net"&gt;https://my-glorious-app-stage.azurewebsites.net&lt;/a&gt; moves to &lt;a href="https://my-glorious-app.io"&gt;https://my-glorious-app.io&lt;/a&gt;. For a more details on what that involves &lt;a href="https://docs.microsoft.com/en-us/azure/app-service/deploy-staging-slots#what-happens-during-a-swap"&gt;read this&lt;/a&gt;. The significant take home is this: there is no downtime.  Traffic stops being routed to the old instance and starts being routed to the new one. It&amp;#39;s as simple as that.&lt;/p&gt;&lt;p&gt;I should mention at this point that there&amp;#39;s a &lt;a href="https://opensource.com/article/17/5/colorful-deployments"&gt;number of zero downtime strategies out there&lt;/a&gt; and slots can help support a number of these.  This includes canary deployments, where a subset of traffic is routed to the new version prior to it being opened out more widely.  In our case, we&amp;#39;re looking at rolling deployments, where we replace the currently running instances of our application with the new ones; but it&amp;#39;s worth being aware that there are other strategies that slots can facilitate.&lt;/p&gt;&lt;p&gt;So what does it look like when slots swap?  Well, to test that out, we swapped slots on our two App Service instances.  We repeatedly CURLed our apps &lt;a href="https://blog.johnnyreilly.com/2021/01/surfacing-azure-pipelines-build-info-in.html"&gt;&lt;code&gt;api/build&lt;/code&gt;&lt;/a&gt; endpoint that exposes the build information; to get visibility around which version of our app we were routing traffic to.  This is what we saw:&lt;/p&gt;&lt;pre class="prettyprint shell"&gt;&lt;code&gt;Thu Jan 21 11:51:51 GMT 2021&lt;br /&gt;{&amp;quot;buildNumber&amp;quot;:&amp;quot;20210121.5&amp;quot;,&amp;quot;buildId&amp;quot;:&amp;quot;17992&amp;quot;,&amp;quot;commitHash&amp;quot;:&amp;quot;c2122919df54bfa6a0d20bceb9f06890f822b26e&amp;quot;}&lt;br /&gt;Thu Jan 21 11:51:54 GMT 2021&lt;br /&gt;{&amp;quot;buildNumber&amp;quot;:&amp;quot;20210121.6&amp;quot;,&amp;quot;buildId&amp;quot;:&amp;quot;18015&amp;quot;,&amp;quot;commitHash&amp;quot;:&amp;quot;062ac1488fcf1737fe1dbab0d05c095786218f30&amp;quot;}&lt;br /&gt;Thu Jan 21 11:51:57 GMT 2021&lt;br /&gt;{&amp;quot;buildNumber&amp;quot;:&amp;quot;20210121.5&amp;quot;,&amp;quot;buildId&amp;quot;:&amp;quot;17992&amp;quot;,&amp;quot;commitHash&amp;quot;:&amp;quot;c2122919df54bfa6a0d20bceb9f06890f822b26e&amp;quot;}&lt;br /&gt;Thu Jan 21 11:52:00 GMT 2021&lt;br /&gt;{&amp;quot;buildNumber&amp;quot;:&amp;quot;20210121.6&amp;quot;,&amp;quot;buildId&amp;quot;:&amp;quot;18015&amp;quot;,&amp;quot;commitHash&amp;quot;:&amp;quot;062ac1488fcf1737fe1dbab0d05c095786218f30&amp;quot;}&lt;br /&gt;Thu Jan 21 11:52:03 GMT 2021&lt;br /&gt;{&amp;quot;buildNumber&amp;quot;:&amp;quot;20210121.6&amp;quot;,&amp;quot;buildId&amp;quot;:&amp;quot;18015&amp;quot;,&amp;quot;commitHash&amp;quot;:&amp;quot;062ac1488fcf1737fe1dbab0d05c095786218f30&amp;quot;}&lt;br /&gt;Thu Jan 21 11:52:05 GMT 2021&lt;br /&gt;{&amp;quot;buildNumber&amp;quot;:&amp;quot;20210121.6&amp;quot;,&amp;quot;buildId&amp;quot;:&amp;quot;18015&amp;quot;,&amp;quot;commitHash&amp;quot;:&amp;quot;062ac1488fcf1737fe1dbab0d05c095786218f30&amp;quot;}&lt;br /&gt;Thu Jan 21 11:52:08 GMT 2021&lt;br /&gt;{&amp;quot;buildNumber&amp;quot;:&amp;quot;20210121.5&amp;quot;,&amp;quot;buildId&amp;quot;:&amp;quot;17992&amp;quot;,&amp;quot;commitHash&amp;quot;:&amp;quot;c2122919df54bfa6a0d20bceb9f06890f822b26e&amp;quot;}&lt;br /&gt;Thu Jan 21 11:52:10 GMT 2021&lt;br /&gt;{&amp;quot;buildNumber&amp;quot;:&amp;quot;20210121.6&amp;quot;,&amp;quot;buildId&amp;quot;:&amp;quot;18015&amp;quot;,&amp;quot;commitHash&amp;quot;:&amp;quot;062ac1488fcf1737fe1dbab0d05c095786218f30&amp;quot;}&lt;br /&gt;Thu Jan 21 11:52:12 GMT 2021&lt;br /&gt;{&amp;quot;buildNumber&amp;quot;:&amp;quot;20210121.5&amp;quot;,&amp;quot;buildId&amp;quot;:&amp;quot;17992&amp;quot;,&amp;quot;commitHash&amp;quot;:&amp;quot;c2122919df54bfa6a0d20bceb9f06890f822b26e&amp;quot;}&lt;br /&gt;Thu Jan 21 11:52:15 GMT 2021&lt;br /&gt;{&amp;quot;buildNumber&amp;quot;:&amp;quot;20210121.6&amp;quot;,&amp;quot;buildId&amp;quot;:&amp;quot;18015&amp;quot;,&amp;quot;commitHash&amp;quot;:&amp;quot;062ac1488fcf1737fe1dbab0d05c095786218f30&amp;quot;}&lt;br /&gt;Thu Jan 21 11:52:17 GMT 2021&lt;br /&gt;{&amp;quot;buildNumber&amp;quot;:&amp;quot;20210121.6&amp;quot;,&amp;quot;buildId&amp;quot;:&amp;quot;18015&amp;quot;,&amp;quot;commitHash&amp;quot;:&amp;quot;062ac1488fcf1737fe1dbab0d05c095786218f30&amp;quot;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The first new version of our application showed up in a production slot at 11:51:54, and the last old version showed up at 11:52:12. So it took a total of 15 seconds to complete the transition from hitting only instances of the old application to hitting only instances of the new application.  During that 15 seconds either old or new versions of the application would be serving traffic. Significantly, there was always a version of the application returning responses.&lt;/p&gt;&lt;p&gt;This is &lt;em&gt;very&lt;/em&gt; exciting! We have zero downtime deployments!&lt;/p&gt;&lt;h4 id="rollbacks-for-bonus-points"&gt;Rollbacks for bonus points&lt;/h4&gt;&lt;p&gt;We now have the new version of the app (&lt;code&gt;buildNumber: 20210121.6&lt;/code&gt;) in the production slot, and the old version of the app (&lt;code&gt;buildNumber: 20210121.5&lt;/code&gt;) in the staging slot.&lt;/p&gt;&lt;p&gt;Slots have a tremendous rollback story.  If it emerges that there was some uncaught issue in your release and you&amp;#39;d like to revert to the previous version, you can! Just as we swapped just now to move &lt;code&gt;buildNumber: 20210121.6&lt;/code&gt; from the staging slot to the production slot and &lt;code&gt;buildNumber: 20210121.5&lt;/code&gt; the other way, we can swap right back and revert our release like so:&lt;/p&gt; &lt;div class="separator" style="clear: both;"&gt;&lt;a href="https://1.bp.blogspot.com/-qkJUMUnIU04/YCTcyiVfpzI/AAAAAAAAZJg/UKzqfyAlmBgHh1A1zRMuUggyGsUJxTEwACLcBGAsYHQ/s1100/app-service-with-slots-and-build-number.png" style="display: block; padding: 1em 0; text-align: center; "&gt;&lt;img alt="" border="0" width="600" data-original-height="957" data-original-width="1100" src="https://1.bp.blogspot.com/-qkJUMUnIU04/YCTcyiVfpzI/AAAAAAAAZJg/UKzqfyAlmBgHh1A1zRMuUggyGsUJxTEwACLcBGAsYHQ/s600/app-service-with-slots-and-build-number.png"/&gt;&lt;/a&gt;&lt;/div&gt; &lt;p&gt;Once again users going to &lt;a href="https://my-glorious-app.io"&gt;https://my-glorious-app.io&lt;/a&gt; are hitting &lt;code&gt;buildNumber: 20210121.5&lt;/code&gt;.&lt;/p&gt;&lt;p&gt;This is also &lt;em&gt;very&lt;/em&gt; exciting! We have zero downtime deployments &lt;em&gt;and&lt;/em&gt; rollbacks!&lt;/p&gt;&lt;h4 id="automated-zero-downtime-releases-with-health-checks"&gt;Automated zero downtime releases with Health checks&lt;/h4&gt;&lt;p&gt;The final piece of the puzzle here automation.  You&amp;#39;re a sophisticated team, you&amp;#39;ve put a great deal of energy into automating your tests.  You don&amp;#39;t want your release process to be manual for this very reason; you trust your test coverage.  You want to move to Continuous Deployment.&lt;/p&gt;&lt;p&gt;Fortunately, automating swapping slots is a breeze with &lt;code&gt;azure-pipelines.yml&lt;/code&gt;.  Consider the following:&lt;/p&gt;&lt;pre class="prettyprint yml"&gt;&lt;code class="lang-yml"&gt;      - job: DeployApp&lt;br /&gt;        displayName: Deploy app&lt;br /&gt;        dependsOn:&lt;br /&gt;        - DeployARMTemplates&lt;br /&gt;&lt;br /&gt;        steps:&lt;br /&gt;        - download: current&lt;br /&gt;          artifact: webapp&lt;br /&gt;&lt;br /&gt;        - task: AzureWebApp@1&lt;br /&gt;          displayName: &amp;#39;Deploy Web Application&amp;#39;&lt;br /&gt;          inputs:&lt;br /&gt;            azureSubscription: $(serviceConnection)&lt;br /&gt;            resourceGroupName: $(azureResourceGroup)&lt;br /&gt;            appName: $(appServiceName)&lt;br /&gt;            package: $(Pipeline.Workspace)/webapp/**/*.zip&lt;br /&gt;            slotName: stage&lt;br /&gt;            deployToSlotOrASE: true&lt;br /&gt;            deploymentMethod: auto&lt;br /&gt;&lt;br /&gt;      - job: SwapSlots&lt;br /&gt;        displayName: Swap Slots&lt;br /&gt;        dependsOn:&lt;br /&gt;        - DeployApp&lt;br /&gt;&lt;br /&gt;        steps:&lt;br /&gt;          - task: AzureAppServiceManage@0&lt;br /&gt;            displayName: Swap Slots&lt;br /&gt;            inputs:&lt;br /&gt;              action: &amp;#39;Swap Slots&amp;#39;&lt;br /&gt;              azureSubscription: $(serviceConnection)&lt;br /&gt;              resourceGroupName: $(azureResourceGroup)&lt;br /&gt;              webAppName: $(appServiceName)&lt;br /&gt;              SourceSlot: &amp;#39;stage&amp;#39;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The first job here, deploys our previously built &lt;code&gt;webapp&lt;/code&gt; to the &lt;code&gt;stage&lt;/code&gt; slot.  The second job swaps the slot.  &lt;/p&gt;&lt;p&gt;When I first considered this, the question rattling around in the back of my mind was this: how does App Service know when it&amp;#39;s safe to swap?  What if we swap before our app has fully woken up and started serving responses?&lt;/p&gt;&lt;p&gt;It so happens that using &lt;a href="https://docs.microsoft.com/en-us/azure/app-service/monitor-instances-health-check"&gt;Health checks, App Service caters for this beautifully&lt;/a&gt;.  A health check endpoint is a URL in your application which, when hit, checks the dependencies of your application.  &amp;quot;Is the database accessible?&amp;quot; &amp;quot;Are the APIs I depend upon accessible?&amp;quot; The diagram from the docs expresses it very well:&lt;/p&gt; &lt;div class="separator" style="clear: both;"&gt;&lt;a href="https://1.bp.blogspot.com/-It0Mt--GVXM/YCTdLnQN71I/AAAAAAAAZJs/Lu3AC3ZWTQ8v6RMrDHNQxsPKGkxK7syWQCLcBGAsYHQ/s400/health-check-failure-diagram.png" style="display: block; padding: 1em 0; text-align: center; "&gt;&lt;img alt="" border="0" width="600" data-original-height="166" data-original-width="400" src="https://1.bp.blogspot.com/-It0Mt--GVXM/YCTdLnQN71I/AAAAAAAAZJs/Lu3AC3ZWTQ8v6RMrDHNQxsPKGkxK7syWQCLcBGAsYHQ/s600/health-check-failure-diagram.png"/&gt;&lt;/a&gt;&lt;/div&gt; &lt;p&gt;This approach is very similar to &lt;a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/"&gt;liveness, readiness and startup probes in Kubernetes&lt;/a&gt;.  To make use of Health checks, in our ARM template for our App Service we have configured a &lt;code&gt;healthCheckPath&lt;/code&gt;:&lt;/p&gt;&lt;pre class="prettyprint json"&gt;&lt;code class="lang-json"&gt;&amp;quot;siteConfig&amp;quot;: {&lt;br /&gt;    &amp;quot;linuxFxVersion&amp;quot;: &amp;quot;[parameters(&amp;#39;linuxFxVersion&amp;#39;)]&amp;quot;,&lt;br /&gt;    &amp;quot;alwaysOn&amp;quot;: true,&lt;br /&gt;    &amp;quot;http20Enabled&amp;quot;: true,&lt;br /&gt;    &amp;quot;minTlsVersion&amp;quot;: &amp;quot;1.2&amp;quot;,&lt;br /&gt;    &amp;quot;healthCheckPath&amp;quot;: &amp;quot;/api/health&amp;quot;,&lt;br /&gt;    //...&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;This tells App Service where to look to check the health. The health check endpoint itself is provided by the &lt;code&gt;MapHealthChecks&lt;/code&gt; in our &lt;code&gt;Startup.cs&lt;/code&gt; of our .NET application:&lt;/p&gt;&lt;pre class="prettyprint cs"&gt;&lt;code class="lang-cs"&gt;app.UseEndpoints(endpoints =&amp;gt; {&lt;br /&gt;    endpoints.MapControllerRoute(&lt;br /&gt;        name: &amp;quot;default&amp;quot;,&lt;br /&gt;        pattern: &amp;quot;{controller}/{action=Index}/{id?}&amp;quot;);&lt;br /&gt;&lt;br /&gt;    endpoints.MapHealthChecks(&amp;quot;/api/health&amp;quot;);&lt;br /&gt;});&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;You read a full list of all the ways App Service uses Health checks &lt;a href="https://docs.microsoft.com/en-us/azure/app-service/monitor-instances-health-check#what-app-service-does-with-health-checks"&gt;here&lt;/a&gt;.  Pertinent for zero downtime deployments is this:&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;when scaling up or out, App Service pings the Health check path to ensure new instances are ready.&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;This is the magic sauce.  App Service doesn&amp;#39;t route traffic to an instance until it&amp;#39;s given the thumbs up that it&amp;#39;s ready in the form of passing health checks. This is excellent; it is this that makes automated zero downtime releases a reality.&lt;/p&gt;&lt;p&gt;Props to the various Azure teams that have made this possible; I&amp;#39;m very impressed by the way in which the Health checks and slots can be combined together to support some tremendous use cases.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8499903948848961831'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8499903948848961831'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2021/02/azure-app-service-health-checks-and-zero-downtime-deployments.html' title='Azure App Service, Health checks and zero downtime deployments'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='https://1.bp.blogspot.com/-bTtR_2BzQ10/YCTcHnUqM1I/AAAAAAAAZJc/HsMQe-SERN4s71Scys8R8DSVkFmN4S5jgCPcBGAYYCw/s72-c/app-service-with-slots.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-845795993857170623</id><published>2021-02-08T17:41:00.002Z</published><updated>2021-02-08T18:42:21.373Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>ARM templates, security, role assignments and magic GUIDs</title><content type='html'>&lt;p&gt;If you&amp;#39;re deploying to Azure, there&amp;#39;s a good chance you&amp;#39;re using &lt;a href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/templates/overview"&gt;ARM templates&lt;/a&gt; to do so.  Once you&amp;#39;ve got past &amp;quot;Hello World&amp;quot;, you&amp;#39;ll probably find yourself in a situation when you&amp;#39;re deploying multiple types of resource to make your solution.  For instance, you may be deploying an &lt;a href="https://docs.microsoft.com/en-us/azure/app-service/quickstart-arm-template?pivots=platform-linux#review-the-template"&gt;App Service&lt;/a&gt; alongside &lt;a href="https://docs.microsoft.com/en-us/azure/templates/microsoft.keyvault/vaults"&gt;Key Vault&lt;/a&gt; and &lt;a href="https://docs.microsoft.com/en-us/azure/templates/microsoft.storage/storageaccounts"&gt;Storage&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;One of the hardest things when it comes to deploying software and having it work, is permissions.  Without adequate permissions configured, the most beautiful code can do &lt;em&gt;nothing&lt;/em&gt;.  Incidentally, this is a good thing.  We&amp;#39;re deploying to the web; many people are there, not all good. As a different kind of web-head once said:&lt;/p&gt; &lt;div class="separator" style="clear: both;"&gt;&lt;a href="https://raw.githubusercontent.com/johnnyreilly/arm-templates-security-role-assignments-and-magic-guids/main/with-great-power-comes-great-responsibility.jpg" style="display: block; padding: 1em 0; text-align: center; "&gt;&lt;img  alt="With great power, comes great responsibility" border="0" data-original-height="187" data-original-width="269" src="https://raw.githubusercontent.com/johnnyreilly/arm-templates-security-role-assignments-and-magic-guids/main/with-great-power-comes-great-responsibility.jpg"/&gt;&lt;/a&gt;&lt;/div&gt; &lt;p&gt;Azure has great power and &lt;a href="https://docs.microsoft.com/en-us/azure/security/fundamentals/identity-management-best-practices#use-role-based-access-control"&gt;suggests you use it wisely&lt;/a&gt;.&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;Access management for cloud resources is critical for any organization that uses the cloud. &lt;a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/overview"&gt;Azure role-based access control (Azure RBAC)&lt;/a&gt; helps you manage who has access to Azure resources, what they can do with those resources, and what areas they have access to.&lt;/p&gt;&lt;p&gt;Designating groups or individual roles responsible for specific functions in Azure helps avoid confusion that can lead to human and automation errors that create security risks. Restricting access based on the &lt;a href="https://en.wikipedia.org/wiki/Need_to_know"&gt;need to know&lt;/a&gt; and &lt;a href="https://en.wikipedia.org/wiki/Principle_of_least_privilege"&gt;least privilege&lt;/a&gt; security principles is imperative for organizations that want to enforce security policies for data access.&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;This is good advice. With that in mind, how can we ensure that the different resources we&amp;#39;re deploying to Azure can talk to one another?&lt;/p&gt;&lt;h4 id="role-up-for-your-assignments"&gt;Role (up for your) assignments&lt;/h4&gt;&lt;p&gt;The answer is roles.  There&amp;#39;s a number of roles that exist in Azure that can be assigned to users, groups, service principals and managed identities. In our own case we&amp;#39;re using managed identity for our resources.  What we can do is use &lt;a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/overview#how-azure-rbac-works"&gt;&amp;quot;role assignments&amp;quot;&lt;/a&gt; to give our managed identity access to given resources. &lt;a href="https://twitter.com/ArLucaID"&gt;Arturo Lucatero&lt;/a&gt; gives a great short explanation of this: &lt;/p&gt; &lt;iframe width="560" height="315" src="https://www.youtube.com/embed/Dzhm-garKBM" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen&gt;&lt;/iframe&gt; &lt;p&gt;Whilst this explanation is delightfully simple, the actual implementation when it comes to ARM templates is a little more involved. Because now it&amp;#39;s time to talk &amp;quot;magic&amp;quot; GUIDs. Consider the following truncated ARM template, which gives our managed identity (and hence our App Service which uses this identity) access to Key Vault and Storage:&lt;/p&gt;&lt;pre class="prettyprint json"&gt;&lt;code class="lang-json"&gt;{&lt;br /&gt;    &amp;quot;$schema&amp;quot;: &amp;quot;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&amp;quot;,&lt;br /&gt;    // ...&lt;br /&gt;    &amp;quot;variables&amp;quot;: {&lt;br /&gt;        // ...&lt;br /&gt;        &amp;quot;managedIdentity&amp;quot;: &amp;quot;[concat(&amp;#39;mi-&amp;#39;, parameters(&amp;#39;applicationName&amp;#39;), &amp;#39;-&amp;#39;, parameters(&amp;#39;environment&amp;#39;), &amp;#39;-&amp;#39;, &amp;#39;001&amp;#39;)]&amp;quot;,&lt;br /&gt;        &amp;quot;appInsightsName&amp;quot;: &amp;quot;[concat(&amp;#39;appi-&amp;#39;, parameters(&amp;#39;applicationName&amp;#39;), &amp;#39;-&amp;#39;, parameters(&amp;#39;environment&amp;#39;), &amp;#39;-&amp;#39;, &amp;#39;001&amp;#39;)]&amp;quot;,&lt;br /&gt;        &amp;quot;keyVaultName&amp;quot;: &amp;quot;[concat(&amp;#39;kv-&amp;#39;, parameters(&amp;#39;applicationName&amp;#39;), &amp;#39;-&amp;#39;, parameters(&amp;#39;environment&amp;#39;), &amp;#39;-&amp;#39;, &amp;#39;001&amp;#39;)]&amp;quot;,&lt;br /&gt;        &amp;quot;storageAccountName&amp;quot;: &amp;quot;[concat(&amp;#39;st&amp;#39;, parameters(&amp;#39;applicationName&amp;#39;), parameters(&amp;#39;environment&amp;#39;), &amp;#39;001&amp;#39;)]&amp;quot;,&lt;br /&gt;        &amp;quot;storageBlobDataContributor&amp;quot;: &amp;quot;[subscriptionResourceId(&amp;#39;Microsoft.Authorization/roleDefinitions&amp;#39;, &amp;#39;ba92f5b4-2d11-453d-a403-e96b0029c9fe&amp;#39;)]&amp;quot;,&lt;br /&gt;        &amp;quot;keyVaultSecretsOfficer&amp;quot;: &amp;quot;[subscriptionResourceId(&amp;#39;Microsoft.Authorization/roleDefinitions&amp;#39;, &amp;#39;b86a8fe4-44ce-4948-aee5-eccb2c155cd7&amp;#39;)]&amp;quot;,&lt;br /&gt;        &amp;quot;keyVaultCryptoOfficer&amp;quot;: &amp;quot;[subscriptionResourceId(&amp;#39;Microsoft.Authorization/roleDefinitions&amp;#39;, &amp;#39;14b46e9e-c2b7-41b4-b07b-48a6ebf60603&amp;#39;)]&amp;quot;,&lt;br /&gt;        &amp;quot;uniqueRoleGuidKeyVaultSecretsOfficer&amp;quot;: &amp;quot;[guid(resourceId(&amp;#39;Microsoft.KeyVault/vaults&amp;#39;,  variables(&amp;#39;keyVaultName&amp;#39;)), variables(&amp;#39;keyVaultSecretsOfficer&amp;#39;), resourceId(&amp;#39;Microsoft.KeyVault/vaults&amp;#39;, variables(&amp;#39;keyVaultName&amp;#39;)))]&amp;quot;,&lt;br /&gt;        &amp;quot;uniqueRoleGuidKeyVaultCryptoOfficer&amp;quot;: &amp;quot;[guid(resourceId(&amp;#39;Microsoft.KeyVault/vaults&amp;#39;,  variables(&amp;#39;keyVaultName&amp;#39;)), variables(&amp;#39;keyVaultCryptoOfficer&amp;#39;), resourceId(&amp;#39;Microsoft.KeyVault/vaults&amp;#39;, variables(&amp;#39;keyVaultName&amp;#39;)))]&amp;quot;,&lt;br /&gt;        &amp;quot;uniqueRoleGuidStorageAccount&amp;quot;: &amp;quot;[guid(resourceId(&amp;#39;Microsoft.Storage/storageAccounts&amp;#39;,  variables(&amp;#39;storageAccountName&amp;#39;)), variables(&amp;#39;storageBlobDataContributor&amp;#39;), resourceId(&amp;#39;Microsoft.Storage/storageAccounts&amp;#39;, variables(&amp;#39;storageAccountName&amp;#39;)))]&amp;quot;&lt;br /&gt;    },&lt;br /&gt;    &amp;quot;resources&amp;quot;: [&lt;br /&gt;        {&lt;br /&gt;            &amp;quot;type&amp;quot;: &amp;quot;Microsoft.ManagedIdentity/userAssignedIdentities&amp;quot;,&lt;br /&gt;            &amp;quot;name&amp;quot;: &amp;quot;[variables(&amp;#39;managedIdentity&amp;#39;)]&amp;quot;,&lt;br /&gt;            &amp;quot;apiVersion&amp;quot;: &amp;quot;2018-11-30&amp;quot;,&lt;br /&gt;            &amp;quot;location&amp;quot;: &amp;quot;[parameters(&amp;#39;location&amp;#39;)]&amp;quot;&lt;br /&gt;        },&lt;br /&gt;        // ...&lt;br /&gt;        {&lt;br /&gt;            &amp;quot;type&amp;quot;: &amp;quot;Microsoft.Storage/storageAccounts/providers/roleAssignments&amp;quot;,&lt;br /&gt;            &amp;quot;apiVersion&amp;quot;: &amp;quot;2020-04-01-preview&amp;quot;,&lt;br /&gt;            &amp;quot;name&amp;quot;: &amp;quot;[concat(variables(&amp;#39;storageAccountName&amp;#39;), &amp;#39;/Microsoft.Authorization/&amp;#39;, variables(&amp;#39;uniqueRoleGuidStorageAccount&amp;#39;))]&amp;quot;,&lt;br /&gt;            &amp;quot;dependsOn&amp;quot;: [&lt;br /&gt;                &amp;quot;[resourceId(&amp;#39;Microsoft.ManagedIdentity/userAssignedIdentities&amp;#39;, variables(&amp;#39;managedIdentity&amp;#39;))]&amp;quot;&lt;br /&gt;            ],&lt;br /&gt;            &amp;quot;properties&amp;quot;: {&lt;br /&gt;                &amp;quot;roleDefinitionId&amp;quot;: &amp;quot;[variables(&amp;#39;storageBlobDataContributor&amp;#39;)]&amp;quot;,&lt;br /&gt;                &amp;quot;principalId&amp;quot;: &amp;quot;[reference(resourceId(&amp;#39;Microsoft.ManagedIdentity/userAssignedIdentities/&amp;#39;, variables(&amp;#39;managedIdentity&amp;#39;)), &amp;#39;2018-11-30&amp;#39;).principalId]&amp;quot;,&lt;br /&gt;                &amp;quot;scope&amp;quot;: &amp;quot;[resourceId(&amp;#39;Microsoft.Storage/storageAccounts&amp;#39;, variables(&amp;#39;storageAccountName&amp;#39;))]&amp;quot;,&lt;br /&gt;                &amp;quot;principalType&amp;quot;: &amp;quot;ServicePrincipal&amp;quot;&lt;br /&gt;            }&lt;br /&gt;        },&lt;br /&gt;        {&lt;br /&gt;            &amp;quot;type&amp;quot;: &amp;quot;Microsoft.KeyVault/vaults/providers/roleAssignments&amp;quot;,&lt;br /&gt;            &amp;quot;apiVersion&amp;quot;: &amp;quot;2018-01-01-preview&amp;quot;,&lt;br /&gt;            &amp;quot;name&amp;quot;: &amp;quot;[concat(variables(&amp;#39;keyVaultName&amp;#39;), &amp;#39;/Microsoft.Authorization/&amp;#39;, variables(&amp;#39;uniqueRoleGuidKeyVaultSecretsOfficer&amp;#39;))]&amp;quot;,&lt;br /&gt;            &amp;quot;dependsOn&amp;quot;: [&lt;br /&gt;                &amp;quot;[resourceId(&amp;#39;Microsoft.ManagedIdentity/userAssignedIdentities&amp;#39;, variables(&amp;#39;managedIdentity&amp;#39;))]&amp;quot;&lt;br /&gt;            ],&lt;br /&gt;            &amp;quot;properties&amp;quot;: {&lt;br /&gt;                &amp;quot;roleDefinitionId&amp;quot;: &amp;quot;[variables(&amp;#39;keyVaultSecretsOfficer&amp;#39;)]&amp;quot;,&lt;br /&gt;                &amp;quot;principalId&amp;quot;: &amp;quot;[reference(resourceId(&amp;#39;Microsoft.ManagedIdentity/userAssignedIdentities/&amp;#39;, variables(&amp;#39;managedIdentity&amp;#39;)), &amp;#39;2018-11-30&amp;#39;).principalId]&amp;quot;,&lt;br /&gt;                &amp;quot;scope&amp;quot;: &amp;quot;[resourceId(&amp;#39;Microsoft.KeyVault/vaults&amp;#39;, variables(&amp;#39;keyVaultName&amp;#39;))]&amp;quot;,&lt;br /&gt;                &amp;quot;principalType&amp;quot;: &amp;quot;ServicePrincipal&amp;quot;&lt;br /&gt;            }&lt;br /&gt;        },&lt;br /&gt;        {&lt;br /&gt;            &amp;quot;type&amp;quot;: &amp;quot;Microsoft.KeyVault/vaults/providers/roleAssignments&amp;quot;,&lt;br /&gt;            &amp;quot;apiVersion&amp;quot;: &amp;quot;2018-01-01-preview&amp;quot;,&lt;br /&gt;            &amp;quot;name&amp;quot;: &amp;quot;[concat(variables(&amp;#39;keyVaultName&amp;#39;), &amp;#39;/Microsoft.Authorization/&amp;#39;, variables(&amp;#39;uniqueRoleGuidKeyVaultCryptoOfficer&amp;#39;))]&amp;quot;,&lt;br /&gt;            &amp;quot;dependsOn&amp;quot;: [&lt;br /&gt;                &amp;quot;[resourceId(&amp;#39;Microsoft.ManagedIdentity/userAssignedIdentities&amp;#39;, variables(&amp;#39;managedIdentity&amp;#39;))]&amp;quot;&lt;br /&gt;            ],&lt;br /&gt;            &amp;quot;properties&amp;quot;: {&lt;br /&gt;                &amp;quot;roleDefinitionId&amp;quot;: &amp;quot;[variables(&amp;#39;keyVaultCryptoOfficer&amp;#39;)]&amp;quot;,&lt;br /&gt;                &amp;quot;principalId&amp;quot;: &amp;quot;[reference(resourceId(&amp;#39;Microsoft.ManagedIdentity/userAssignedIdentities/&amp;#39;, variables(&amp;#39;managedIdentity&amp;#39;)), &amp;#39;2018-11-30&amp;#39;).principalId]&amp;quot;,&lt;br /&gt;                &amp;quot;scope&amp;quot;: &amp;quot;[resourceId(&amp;#39;Microsoft.KeyVault/vaults&amp;#39;, variables(&amp;#39;keyVaultName&amp;#39;))]&amp;quot;,&lt;br /&gt;                &amp;quot;principalType&amp;quot;: &amp;quot;ServicePrincipal&amp;quot;&lt;br /&gt;            }&lt;br /&gt;        }&lt;br /&gt;    ]&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Let&amp;#39;s take a look at these three variables:&lt;/p&gt;&lt;pre class="prettyprint json"&gt;&lt;code class="lang-json"&gt;        &amp;quot;storageBlobDataContributor&amp;quot;: &amp;quot;[subscriptionResourceId(&amp;#39;Microsoft.Authorization/roleDefinitions&amp;#39;, &amp;#39;ba92f5b4-2d11-453d-a403-e96b0029c9fe&amp;#39;)]&amp;quot;,&lt;br /&gt;        &amp;quot;keyVaultSecretsOfficer&amp;quot;: &amp;quot;[subscriptionResourceId(&amp;#39;Microsoft.Authorization/roleDefinitions&amp;#39;, &amp;#39;b86a8fe4-44ce-4948-aee5-eccb2c155cd7&amp;#39;)]&amp;quot;,&lt;br /&gt;        &amp;quot;keyVaultCryptoOfficer&amp;quot;: &amp;quot;[subscriptionResourceId(&amp;#39;Microsoft.Authorization/roleDefinitions&amp;#39;, &amp;#39;14b46e9e-c2b7-41b4-b07b-48a6ebf60603&amp;#39;)]&amp;quot;,&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The three variables above contain the subscription resource ids for the roles &lt;a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#storage-blob-data-contributor"&gt;Storage Blob Data Contributor&lt;/a&gt;, &lt;a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#key-vault-secrets-officer-preview"&gt;Key Vault Secrets Officer&lt;/a&gt; and &lt;a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#key-vault-crypto-officer-preview"&gt;Key Vault Crypto Officer&lt;/a&gt;.  The first question on your mind is likely: &amp;quot;what is &lt;code&gt;ba92f5b4-2d11-453d-a403-e96b0029c9fe&lt;/code&gt; and where does it come from?&amp;quot; Great question! Well, each of these GUIDs represents a built-in role in Azure RBAC. The &lt;code&gt;ba92f5b4-2d11-453d-a403-e96b0029c9fe&lt;/code&gt; represents the Storage Blob Data Contributor role.&lt;/p&gt;&lt;p&gt;How can I look these up?  Well, there&amp;#39;s two ways; &lt;a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/built-in-roles"&gt;there&amp;#39;s an article which documents them here&lt;/a&gt; or you could crack open the &lt;a href="https://azure.microsoft.com/en-gb/features/cloud-shell/"&gt;Cloud Shell&lt;/a&gt; and look up a role by GUID like so:&lt;/p&gt;&lt;pre class="prettyprint ps"&gt;&lt;code class="lang-ps"&gt;Get-AzRoleDefinition | ? {$_.id -eq &amp;quot;ba92f5b4-2d11-453d-a403-e96b0029c9fe&amp;quot; }&lt;br /&gt;&lt;br /&gt;Name             : Storage Blob Data Contributor&lt;br /&gt;Id               : ba92f5b4-2d11-453d-a403-e96b0029c9fe&lt;br /&gt;IsCustom         : False&lt;br /&gt;Description      : Allows for read, write and delete access to Azure Storage blob containers and data&lt;br /&gt;Actions          : {Microsoft.Storage/storageAccounts/blobServices/containers/delete, Microsoft.Storage/storageAccounts/blobServices/containers/read,&lt;br /&gt;                   Microsoft.Storage/storageAccounts/blobServices/containers/write, Microsoft.Storage/storageAccounts/blobServices/generateUserDelegationKey/action}&lt;br /&gt;NotActions       : {}&lt;br /&gt;DataActions      : {Microsoft.Storage/storageAccounts/blobServices/containers/blobs/delete, Microsoft.Storage/storageAccounts/blobServices/containers/blobs/read,&lt;br /&gt;                   Microsoft.Storage/storageAccounts/blobServices/containers/blobs/write, Microsoft.Storage/storageAccounts/blobServices/containers/blobs/move/action}&lt;br /&gt;NotDataActions   : {}&lt;br /&gt;AssignableScopes : {/}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Or by name like so:&lt;/p&gt;&lt;pre class="prettyprint ps"&gt;&lt;code class="lang-ps"&gt;Get-AzRoleDefinition | ? {$_.name -like &amp;quot;*Crypto Officer*&amp;quot; }&lt;br /&gt;&lt;br /&gt;Name             : Key Vault Crypto Officer&lt;br /&gt;Id               : 14b46e9e-c2b7-41b4-b07b-48a6ebf60603&lt;br /&gt;IsCustom         : False&lt;br /&gt;Description      : Perform any action on the keys of a key vault, except manage permissions. Only works for key vaults that use the &amp;#39;Azure role-based access control&amp;#39; permission model.&lt;br /&gt;Actions          : {Microsoft.Authorization/*/read, Microsoft.Insights/alertRules/*, Microsoft.Resources/deployments/*, Microsoft.Resources/subscriptions/resourceGroups/read}&lt;br /&gt;NotActions       : {}&lt;br /&gt;DataActions      : {Microsoft.KeyVault/vaults/keys/*}&lt;br /&gt;NotDataActions   : {}&lt;br /&gt;AssignableScopes : {/}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;As you can see, the &lt;code&gt;Actions&lt;/code&gt; section of the output above (and in even more detail on the &lt;a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/built-in-roles"&gt;linked article&lt;/a&gt;) provides information about what the different roles can do.  So if you&amp;#39;re looking to enable one Azure resource to talk to another, you should be able to refer to these to identify a role that you might want to use.&lt;/p&gt;&lt;h4 id="creating-a-role-assignment"&gt;Creating a role assignment&lt;/h4&gt;&lt;p&gt;So now we understand how you identify the roles in question, let&amp;#39;s take the final leap and look at assigning those roles to our managed identity.  For each role assignment, you&amp;#39;ll need a &lt;code&gt;roleAssignments&lt;/code&gt; resource defined that looks like this:&lt;/p&gt;&lt;pre class="prettyprint json"&gt;&lt;code class="lang-json"&gt;        {&lt;br /&gt;            &amp;quot;type&amp;quot;: &amp;quot;Microsoft.KeyVault/vaults/providers/roleAssignments&amp;quot;,&lt;br /&gt;            &amp;quot;apiVersion&amp;quot;: &amp;quot;2018-01-01-preview&amp;quot;,&lt;br /&gt;            &amp;quot;name&amp;quot;: &amp;quot;[concat(variables(&amp;#39;keyVaultName&amp;#39;), &amp;#39;/Microsoft.Authorization/&amp;#39;, variables(&amp;#39;uniqueRoleGuidKeyVaultCryptoOfficer&amp;#39;))]&amp;quot;,&lt;br /&gt;            &amp;quot;dependsOn&amp;quot;: [&lt;br /&gt;                &amp;quot;[resourceId(&amp;#39;Microsoft.ManagedIdentity/userAssignedIdentities&amp;#39;, variables(&amp;#39;managedIdentity&amp;#39;))]&amp;quot;&lt;br /&gt;            ],&lt;br /&gt;            &amp;quot;properties&amp;quot;: {&lt;br /&gt;                &amp;quot;roleDefinitionId&amp;quot;: &amp;quot;[variables(&amp;#39;keyVaultCryptoOfficer&amp;#39;)]&amp;quot;,&lt;br /&gt;                &amp;quot;principalId&amp;quot;: &amp;quot;[reference(resourceId(&amp;#39;Microsoft.ManagedIdentity/userAssignedIdentities/&amp;#39;, variables(&amp;#39;managedIdentity&amp;#39;)), &amp;#39;2018-11-30&amp;#39;).principalId]&amp;quot;,&lt;br /&gt;                &amp;quot;scope&amp;quot;: &amp;quot;[resourceId(&amp;#39;Microsoft.KeyVault/vaults&amp;#39;, variables(&amp;#39;keyVaultName&amp;#39;))]&amp;quot;,&lt;br /&gt;                &amp;quot;principalType&amp;quot;: &amp;quot;ServicePrincipal&amp;quot;&lt;br /&gt;            }&lt;br /&gt;        }&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Let&amp;#39;s go through the above, significant property by significant property (it&amp;#39;s also worth checking the official reference &lt;a href="https://docs.microsoft.com/en-us/azure/templates/microsoft.authorization/roleassignments"&gt;here&lt;/a&gt;):&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;code&gt;type&lt;/code&gt; - the type of role assignment we want to create, for a key vault it&amp;#39;s &lt;code&gt;&amp;quot;Microsoft.KeyVault/vaults/providers/roleAssignments&amp;quot;&lt;/code&gt;, for storage it&amp;#39;s &lt;code&gt;&amp;quot;Microsoft.Storage/storageAccounts/providers/roleAssignments&amp;quot;&lt;/code&gt;.  The pattern is that it&amp;#39;s the resource type, followed by &lt;code&gt;&amp;quot;/providers/roleAssignments&amp;quot;&lt;/code&gt;. &lt;/li&gt;&lt;li&gt;&lt;code&gt;dependsOn&lt;/code&gt; - before we can create a role assignment, we need the service principal we desire to permission (in our case a managed identity) to exist&lt;/li&gt;&lt;li&gt;&lt;code&gt;properties.roleDefinitionId&lt;/code&gt; - the role that we&amp;#39;re assigning, provided as an id. So for this example it&amp;#39;s the &lt;code&gt;keyVaultCryptoOfficer&lt;/code&gt; variable, which was earlier defined as &lt;code&gt;[subscriptionResourceId(&amp;#39;Microsoft.Authorization/roleDefinitions&amp;#39;, &amp;#39;ba92f5b4-2d11-453d-a403-e96b0029c9fe&amp;#39;)]&lt;/code&gt;. (Note the use of the GUID)&lt;/li&gt;&lt;li&gt;&lt;code&gt;properties.principalId&lt;/code&gt; - the id of the principal we&amp;#39;re adding permissions for. In our case this is a managed identity (a type of service principal).&lt;/li&gt;&lt;li&gt;&lt;code&gt;properties.scope&lt;/code&gt; - we&amp;#39;re modifying another resource; our key vault isn&amp;#39;t defined in this ARM template and we want to specify the resource we&amp;#39;re granting permissions to.&lt;/li&gt;&lt;li&gt;&lt;code&gt;properties.principalType&lt;/code&gt; - the type of principal that we&amp;#39;re creating an assignment for; in our this is &lt;code&gt;&amp;quot;ServicePrincipal&amp;quot;&lt;/code&gt; - our managed identity.&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;There is an alternate approach that you can use where the &lt;code&gt;type&lt;/code&gt; is &lt;code&gt;&amp;quot;Microsoft.Authorization/roleAssignments&amp;quot;&lt;/code&gt;. Whilst this also works, it displayed errors in the &lt;a href="https://marketplace.visualstudio.com/items?itemName=msazurermtools.azurerm-vscode-tools"&gt;Azure tooling for VS Code&lt;/a&gt;.  As such, we&amp;#39;ve opted not to use that approach in our ARM templates.&lt;/p&gt;&lt;p&gt;Many thanks to the awesome &lt;a href="https://github.com/jmccor99"&gt;John McCormick&lt;/a&gt; who wrangled permissions with me until we bent Azure RBAC to our will. &lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/845795993857170623'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/845795993857170623'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2021/02/arm-templates-security-role-assignments.html' title='ARM templates, security, role assignments and magic GUIDs'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='https://i.ytimg.com/vi/Dzhm-garKBM/default.jpg' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3459590498913051832</id><published>2021-01-30T10:09:00.002Z</published><updated>2021-01-30T10:09:47.866Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='asp.net'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Azure'/><category scheme='http://www.blogger.com/atom/ns#' term='Application Insights'/><category scheme='http://www.blogger.com/atom/ns#' term='Serilog'/><title type='text'>ASP.NET, Serilog and Application Insights</title><content type='html'>&lt;p&gt;If you&amp;#39;re deploying an ASP.NET application to Azure App Services, there&amp;#39;s a decent chance you&amp;#39;ll also be using the fantastic &lt;a href="https://serilog.net/"&gt;Serilog&lt;/a&gt; and will want to plug it into Azure&amp;#39;s &lt;a href="https://docs.microsoft.com/en-us/azure/azure-monitor/app/app-insights-overview"&gt;Application Insights&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;This post will show you how it&amp;#39;s done, and it&amp;#39;ll also build upon the &lt;a href="https://blog.johnnyreilly.com/2021/01/surfacing-azure-pipelines-build-info-in.html"&gt;build info work from our previous post&lt;/a&gt;.  In what way?  Great question.  Well logs are a tremendous diagnostic tool.  If you have logs which display some curious behaviour, and you&amp;#39;d like to replicate that in another environment, you really want to take exactly that version of the codebase out to play.  Our last post introduced build info into our application in the form of our &lt;code&gt;AppVersionInfo&lt;/code&gt; class that looks something like this:  &lt;/p&gt;&lt;pre class="prettyprint json"&gt;&lt;code class="lang-json"&gt;{&lt;br /&gt;    &amp;quot;buildNumber&amp;quot;: &amp;quot;20210130.1&amp;quot;,&lt;br /&gt;    &amp;quot;buildId&amp;quot;: &amp;quot;123456&amp;quot;,&lt;br /&gt;    &amp;quot;branchName&amp;quot;: &amp;quot;main&amp;quot;,&lt;br /&gt;    &amp;quot;commitHash&amp;quot;: &amp;quot;7089620222c30c1ad88e4b556c0a7908ddd34a8e&amp;quot;&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;We&amp;#39;d initially exposed an endpoint in our application which surfaced up this information.  Now we&amp;#39;re going to take that self same information and bake it into our log messages by making use of &lt;a href="https://github.com/serilog/serilog/wiki/Enrichment"&gt;Serilog&amp;#39;s enrichment functionality&lt;/a&gt;. Build info and Serilog&amp;#39;s enrichment are the double act your logging has been waiting for.&lt;/p&gt;&lt;h4 id="let-s-plug-it-together"&gt;Let&amp;#39;s plug it together&lt;/h4&gt;&lt;p&gt;We&amp;#39;re going to need a number of Serilog dependencies added to our &lt;code&gt;.csproj&lt;/code&gt;:&lt;/p&gt;&lt;pre class="prettyprint xml"&gt;&lt;code class="lang-xml"&gt;    &amp;lt;PackageReference Include=&amp;quot;Serilog.AspNetCore&amp;quot; Version=&amp;quot;3.4.0&amp;quot; /&amp;gt;&lt;br /&gt;    &amp;lt;PackageReference Include=&amp;quot;Serilog.Enrichers.Environment&amp;quot; Version=&amp;quot;2.1.3&amp;quot; /&amp;gt;&lt;br /&gt;    &amp;lt;PackageReference Include=&amp;quot;Serilog.Enrichers.Thread&amp;quot; Version=&amp;quot;3.1.0&amp;quot; /&amp;gt;&lt;br /&gt;    &amp;lt;PackageReference Include=&amp;quot;Serilog.Sinks.ApplicationInsights&amp;quot; Version=&amp;quot;3.1.0&amp;quot; /&amp;gt;&lt;br /&gt;    &amp;lt;PackageReference Include=&amp;quot;Serilog.Sinks.Async&amp;quot; Version=&amp;quot;1.4.0&amp;quot; /&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The earlier in your application lifetime you get logging wired up, the happier you will be.  Earlier, means more information when you&amp;#39;re diagnosing issues.  So we want to start in our &lt;code&gt;Program.cs&lt;/code&gt;; &lt;code&gt;Startup.cs&lt;/code&gt; would be just &lt;em&gt;way&lt;/em&gt; too late.&lt;/p&gt;&lt;pre class="prettyprint cs"&gt;&lt;code class="lang-cs"&gt;public class Program {&lt;br /&gt;    const string APP_NAME = &amp;quot;MyAmazingApp&amp;quot;;&lt;br /&gt;&lt;br /&gt;    public static int Main(string[] args) {&lt;br /&gt;        AppVersionInfo.InitialiseBuildInfoGivenPath(Directory.GetCurrentDirectory());&lt;br /&gt;        LoggerConfigurationExtensions.SetupLoggerConfiguration(APP_NAME, AppVersionInfo.GetBuildInfo());&lt;br /&gt;&lt;br /&gt;        try&lt;br /&gt;        {&lt;br /&gt;            Log.Information(&amp;quot;Starting web host&amp;quot;);&lt;br /&gt;            CreateHostBuilder(args).Build().Run();&lt;br /&gt;            return 0;&lt;br /&gt;        }&lt;br /&gt;        catch (Exception ex)&lt;br /&gt;        {&lt;br /&gt;            Log.Fatal(ex, &amp;quot;Host terminated unexpectedly&amp;quot;);&lt;br /&gt;            return 1;&lt;br /&gt;        }&lt;br /&gt;        finally&lt;br /&gt;        {&lt;br /&gt;            Log.CloseAndFlush();&lt;br /&gt;        }&lt;br /&gt;    }&lt;br /&gt;&lt;br /&gt;    public static IHostBuilder CreateHostBuilder(string[] args) =&amp;gt;&lt;br /&gt;        Host.CreateDefaultBuilder(args)&lt;br /&gt;            .UseSerilog((hostBuilderContext, services, loggerConfiguration) =&amp;gt; {&lt;br /&gt;                loggerConfiguration.ConfigureBaseLogging(APP_NAME, AppVersionInfo.GetBuildInfo());&lt;br /&gt;                loggerConfiguration.AddApplicationInsightsLogging(services, hostBuilderContext.Configuration);&lt;br /&gt;            })&lt;br /&gt;            .ConfigureWebHostDefaults(webBuilder =&amp;gt; {&lt;br /&gt;                webBuilder&lt;br /&gt;                    .UseStartup&amp;lt;Startup&amp;gt;();&lt;br /&gt;            });&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;If you look at the code above you&amp;#39;ll see that the first line of code that executes is &lt;code&gt;AppVersionInfo.InitialiseBuildInfoGivenPath&lt;/code&gt;.  This initialises our &lt;code&gt;AppVersionInfo&lt;/code&gt; so we have meaningful build info to pump into our logs.   The next thing we do is to configure Serilog with &lt;code&gt;LoggerConfigurationExtensions.SetupLoggerConfiguration&lt;/code&gt;.  This provides us with a configured logger so we are free to log any issues that take place during startup.  (Incidentally, after startup you&amp;#39;ll likely inject an &lt;code&gt;ILogger&lt;/code&gt; into your classes rather than using the static &lt;code&gt;Log&lt;/code&gt; directly.)&lt;/p&gt;&lt;p&gt;Finally, we call &lt;code&gt;CreateHostBuilder&lt;/code&gt; which in turn calls &lt;code&gt;UseSerilog&lt;/code&gt; to plug Serilog into ASP.NET.  If you take a look inside the body of &lt;code&gt;UserSerilog&lt;/code&gt; you&amp;#39;ll see we configure the logging of ASP.NET (in the same we did for Serilog) and we hook into Application Insights as well.  There&amp;#39;s been a number of references to &lt;code&gt;LoggerConfigurationExtensions&lt;/code&gt;.  Let&amp;#39;s take a look at it:&lt;/p&gt;&lt;pre class="prettyprint cs"&gt;&lt;code class="lang-cs"&gt;internal static class LoggerConfigurationExtensions {&lt;br /&gt;    internal static void SetupLoggerConfiguration(string appName, BuildInfo buildInfo) {&lt;br /&gt;        Log.Logger = new LoggerConfiguration()&lt;br /&gt;            .ConfigureBaseLogging(appName, buildInfo)&lt;br /&gt;            .CreateLogger();&lt;br /&gt;    }&lt;br /&gt;&lt;br /&gt;    internal static LoggerConfiguration ConfigureBaseLogging(&lt;br /&gt;        this LoggerConfiguration loggerConfiguration,&lt;br /&gt;        string appName,&lt;br /&gt;        BuildInfo buildInfo&lt;br /&gt;    ) {&lt;br /&gt;        loggerConfiguration&lt;br /&gt;            .MinimumLevel.Debug()&lt;br /&gt;            .MinimumLevel.Override(&amp;quot;Microsoft&amp;quot;, LogEventLevel.Information)&lt;br /&gt;            // AMAZING COLOURS IN THE CONSOLE!!!!&lt;br /&gt;            .WriteTo.Async(a =&amp;gt; a.Console(theme: AnsiConsoleTheme.Code))&lt;br /&gt;            .Enrich.FromLogContext()&lt;br /&gt;            .Enrich.WithMachineName()&lt;br /&gt;            .Enrich.WithThreadId()&lt;br /&gt;            // Build information as custom properties&lt;br /&gt;            .Enrich.WithProperty(nameof(buildInfo.BuildId), buildInfo.BuildId)&lt;br /&gt;            .Enrich.WithProperty(nameof(buildInfo.BuildNumber), buildInfo.BuildNumber)&lt;br /&gt;            .Enrich.WithProperty(nameof(buildInfo.BranchName), buildInfo.BranchName)&lt;br /&gt;            .Enrich.WithProperty(nameof(buildInfo.CommitHash), buildInfo.CommitHash)&lt;br /&gt;            .Enrich.WithProperty(&amp;quot;ApplicationName&amp;quot;, appName);&lt;br /&gt;&lt;br /&gt;        return loggerConfiguration;&lt;br /&gt;    }&lt;br /&gt;&lt;br /&gt;    internal static LoggerConfiguration AddApplicationInsightsLogging(this LoggerConfiguration loggerConfiguration, IServiceProvider services, IConfiguration configuration)&lt;br /&gt;    {&lt;br /&gt;        if (!string.IsNullOrWhiteSpace(configuration.GetValue&amp;lt;string&amp;gt;(&amp;quot;APPINSIGHTS_INSTRUMENTATIONKEY&amp;quot;)))&lt;br /&gt;        {&lt;br /&gt;            loggerConfiguration.WriteTo.ApplicationInsights(&lt;br /&gt;                services.GetRequiredService&amp;lt;TelemetryConfiguration&amp;gt;(),&lt;br /&gt;                TelemetryConverter.Traces);&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        return loggerConfiguration;&lt;br /&gt;    }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;If we take a look at the &lt;code&gt;ConfigureBaseLogging&lt;/code&gt; method above, we can see that our logs are being enriched with the build info, property by property. We&amp;#39;re also giving ourselves a beautifully coloured console thanks to Serilog&amp;#39;s glorious &lt;a href="https://github.com/serilog/serilog-sinks-console#themes"&gt;theme support&lt;/a&gt;:&lt;/p&gt; &lt;div class="separator" style="clear: both;"&gt;&lt;a href="https://github.com/johnnyreilly/dotnet-serilog-and-azure-application-insights/blob/main/coloured-console.png?raw=true" style="display: block; padding: 1em 0; text-align: center; "&gt;&lt;img alt="" border="0" width="600" data-original-height="111" data-original-width="800" src="https://github.com/johnnyreilly/dotnet-serilog-and-azure-application-insights/blob/main/coloured-console.png?raw=true"/&gt;&lt;/a&gt;&lt;/div&gt; &lt;p&gt;Take a moment to admire the salmon pinks. Is it not lovely?&lt;/p&gt;&lt;p&gt;Finally we come to the main act. Plugging in Application Insights is as simple as dropping in &lt;code&gt;loggerConfiguration.WriteTo.ApplicationInsights&lt;/code&gt; into our configuration.  You&amp;#39;ll note that this depends upon the existence of an application setting of &lt;code&gt;APPINSIGHTS_INSTRUMENTATIONKEY&lt;/code&gt; - this is the secret sauce that we need to be in place so we can pipe logs merrily to Application Insights.  So you&amp;#39;ll need this configuration in place so this works.&lt;/p&gt; &lt;div class="separator" style="clear: both;"&gt;&lt;a href="https://github.com/johnnyreilly/dotnet-serilog-and-azure-application-insights/blob/main/application-insights-properties.png?raw=true" style="display: block; padding: 1em 0; text-align: center; "&gt;&lt;img alt="" border="0" height="600" data-original-height="800" data-original-width="604" src="https://github.com/johnnyreilly/dotnet-serilog-and-azure-application-insights/blob/main/application-insights-properties.png?raw=true"/&gt;&lt;/a&gt;&lt;/div&gt; &lt;p&gt;As you can see, we now have the likes of &lt;code&gt;BuildNumber&lt;/code&gt;, &lt;code&gt;CommitHash&lt;/code&gt; and friends visible on each log.  Happy diagnostic days!&lt;/p&gt;&lt;p&gt;I&amp;#39;m indebted to the marvellous &lt;a href="https://twitter.com/MarcelMichau"&gt;Marcel Michau&lt;/a&gt; who showed me how to get the fiddlier parts of how to get Application Insights plugged in the right way.  Thanks chap!&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3459590498913051832'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3459590498913051832'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2021/01/aspnet-serilog-and-application-insights.html' title='ASP.NET, Serilog and Application Insights'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6902262076975914467</id><published>2021-01-29T06:45:00.001Z</published><updated>2021-03-17T21:09:34.432Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='build information'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='azure pipelines'/><title type='text'>Surfacing Azure Pipelines Build Info in a .NET React SPA</title><content type='html'>&lt;p&gt;The title of this post is hugely specific, but the idea is simple.  We want to answer the question: &amp;quot;what codebase is running in Production right now?&amp;quot; Many is the time where I&amp;#39;ve been pondering over why something isn&amp;#39;t working as expected and burned a disappointing amount of time before realising that I&amp;#39;m playing with an old version of an app. Wouldn&amp;#39;t it be great give our app a way to say: &amp;quot;Hey! I&amp;#39;m version 1.2.3.4 of your app; built from this commit hash, I was built on Wednesday, I was the nineth build that day and I was built from the &lt;code&gt;main&lt;/code&gt; branch.  And I&amp;#39;m an Aries.&amp;quot;  Or something like that.&lt;/p&gt;&lt;p&gt;This post was inspired by &lt;a href="https://www.hanselman.com/blog/adding-a-git-commit-hash-and-azure-devops-build-number-and-build-id-to-an-aspnet-website"&gt;Scott Hanselman&amp;#39;s similar post on the topic&lt;/a&gt;.  Ultimately this ended up going in a fairly different direction and so seemed worthy of a post of its own.&lt;/p&gt;&lt;p&gt;A particular difference is that this is targeting SPAs.  Famously, cache invalidation is hard.  It&amp;#39;s possible for the HTML/JS/CSS of your app to be stale due to aggressive caching.  So we&amp;#39;re going to make it possible to see build information for both when the SPA (or &amp;quot;client&amp;quot;) is built, as well as when the .NET app (or &amp;quot;server&amp;quot;) is built.  We&amp;#39;re using a specific type of SPA here; a &lt;a href="https://reactjs.org/"&gt;React&lt;/a&gt; SPA built with &lt;a href="https://www.typescriptlang.org/"&gt;TypeScript&lt;/a&gt; and &lt;a href="https://material-ui.com/"&gt;Material UI&lt;/a&gt;, however the principles here are general; you could surface this up any which way you choose. &lt;/p&gt;&lt;h4 id="putting-build-info-into-azure-pipelines-yml"&gt;Putting build info into &lt;code&gt;azure-pipelines.yml&lt;/code&gt;&lt;/h4&gt;&lt;p&gt;The first thing we&amp;#39;re going to do is to inject our build details into two identical &lt;code&gt;buildinfo.json&lt;/code&gt; files; one that sits in the server codebase and which will be used to drive the server build information, and one that sits in the client codebase to drive the client equivalent. They&amp;#39;ll end up looking something like this:&lt;/p&gt;&lt;pre class="prettyprint json"&gt;&lt;code class="lang-json"&gt;{&lt;br /&gt;    &amp;quot;buildNumber&amp;quot;: &amp;quot;20210130.1&amp;quot;,&lt;br /&gt;    &amp;quot;buildId&amp;quot;: &amp;quot;123456&amp;quot;,&lt;br /&gt;    &amp;quot;branchName&amp;quot;: &amp;quot;main&amp;quot;,&lt;br /&gt;    &amp;quot;commitHash&amp;quot;: &amp;quot;7089620222c30c1ad88e4b556c0a7908ddd34a8e&amp;quot;&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;We generate this by adding the following &lt;code&gt;yml&lt;/code&gt; to the beginning of our &lt;code&gt;azure-pipelines.yml&lt;/code&gt; (crucially before the client or server build take place):&lt;/p&gt;&lt;pre class="prettyprint yml"&gt;&lt;code class="lang-yml"&gt;        - script: |&lt;br /&gt;            echo -e -n &amp;quot;{\&amp;quot;buildNumber\&amp;quot;:\&amp;quot;$(Build.BuildNumber)\&amp;quot;,\&amp;quot;buildId\&amp;quot;:\&amp;quot;$(Build.BuildId)\&amp;quot;,\&amp;quot;branchName\&amp;quot;:\&amp;quot;$(Build.SourceBranchName)\&amp;quot;,\&amp;quot;commitHash\&amp;quot;:\&amp;quot;$(Build.SourceVersion)\&amp;quot;}&amp;quot; &amp;gt; &amp;quot;$(Build.SourcesDirectory)/src/client-app/src/buildinfo.json&amp;quot;&lt;br /&gt;            echo -e -n &amp;quot;{\&amp;quot;buildNumber\&amp;quot;:\&amp;quot;$(Build.BuildNumber)\&amp;quot;,\&amp;quot;buildId\&amp;quot;:\&amp;quot;$(Build.BuildId)\&amp;quot;,\&amp;quot;branchName\&amp;quot;:\&amp;quot;$(Build.SourceBranchName)\&amp;quot;,\&amp;quot;commitHash\&amp;quot;:\&amp;quot;$(Build.SourceVersion)\&amp;quot;}&amp;quot; &amp;gt; &amp;quot;$(Build.SourcesDirectory)/src/server-app/Server/buildinfo.json&amp;quot;&lt;br /&gt;          displayName: &amp;quot;emit build details as JSON&amp;quot;&lt;br /&gt;          failOnStderr: true&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;As you can see, we&amp;#39;re placing the following variables that are available at build time in Azure Pipelines, into the &lt;code&gt;buildinfo.json&lt;/code&gt;:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;code&gt;BuildNumber&lt;/code&gt; - The name of the completed build; which usually takes the form of a date in the &lt;code&gt;yyyyMMdd&lt;/code&gt; format, suffixed by &lt;code&gt;.x&lt;/code&gt; where &lt;code&gt;x&lt;/code&gt; is a number that increments representing the number of builds that have taken place on the given day.&lt;/li&gt;&lt;li&gt;&lt;code&gt;BuildId&lt;/code&gt; - The ID of the record for the completed build.&lt;/li&gt;&lt;li&gt;&lt;code&gt;SourceVersion&lt;/code&gt; - This is the commit hash of the source code in Git&lt;/li&gt;&lt;li&gt;&lt;code&gt;SourceBranchName&lt;/code&gt; - The name of the branch in Git.&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;a href="https://docs.microsoft.com/en-us/azure/devops/pipelines/build/variables?view=azure-devops&amp;amp;tabs=yaml#build-variables-devops-services"&gt;There&amp;#39;s many variables available in Azure Pipelines that can be used&lt;/a&gt; - we&amp;#39;ve picked out the ones most interesting to us.&lt;/p&gt;&lt;h4 id="surfacing-the-server-build-info"&gt;Surfacing the server build info&lt;/h4&gt;&lt;p&gt;Our pipeline is dropping the &lt;code&gt;buildinfo.json&lt;/code&gt; over pre-existing stub &lt;code&gt;buildinfo.json&lt;/code&gt; files in both our client and server codebases.  The stub files look like this:&lt;/p&gt;&lt;pre class="prettyprint json"&gt;&lt;code class="lang-json"&gt;{&lt;br /&gt;    &amp;quot;buildNumber&amp;quot;: &amp;quot;yyyyMMdd.x&amp;quot;,&lt;br /&gt;    &amp;quot;buildId&amp;quot;: &amp;quot;xxxxxx&amp;quot;,&lt;br /&gt;    &amp;quot;branchName&amp;quot;: &amp;quot;&amp;quot;,&lt;br /&gt;    &amp;quot;commitHash&amp;quot;: &amp;quot;LOCAL_BUILD&amp;quot;&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;In our .NET app, the &lt;code&gt;buildinfo.json&lt;/code&gt; file has been dropped in the root of the app.  And as luck would have it, all JSON files are automatically included in a .NET build and so it will be available at runtime.  We want to surface this file through an API, and we also want to use it to stamp details into our logs.&lt;/p&gt;&lt;p&gt;So we need to parse the file, and for that we&amp;#39;ll use this:&lt;/p&gt;&lt;pre class="prettyprint cs"&gt;&lt;code class="lang-cs"&gt;using System;&lt;br /&gt;using System.IO;&lt;br /&gt;using System.Text.Json;&lt;br /&gt;&lt;br /&gt;namespace Server {&lt;br /&gt;    public record BuildInfo(string BranchName, string BuildNumber, string BuildId, string CommitHash);&lt;br /&gt;&lt;br /&gt;    public static class AppVersionInfo {&lt;br /&gt;        private const string _buildFileName = &amp;quot;buildinfo.json&amp;quot;;&lt;br /&gt;        private static BuildInfo _fileBuildInfo = new(&lt;br /&gt;            BranchName: &amp;quot;&amp;quot;,&lt;br /&gt;            BuildNumber: DateTime.UtcNow.ToString(&amp;quot;yyyyMMdd&amp;quot;) + &amp;quot;.0&amp;quot;,&lt;br /&gt;            BuildId: &amp;quot;xxxxxx&amp;quot;,&lt;br /&gt;            CommitHash: $&amp;quot;Not yet initialised - call {nameof(InitialiseBuildInfoGivenPath)}&amp;quot;&lt;br /&gt;        );&lt;br /&gt;&lt;br /&gt;        public static void InitialiseBuildInfoGivenPath(string path) {&lt;br /&gt;            var buildFilePath = Path.Combine(path, _buildFileName);&lt;br /&gt;            if (File.Exists(buildFilePath)) {&lt;br /&gt;                try {&lt;br /&gt;                    var buildInfoJson = File.ReadAllText(buildFilePath);&lt;br /&gt;                    var buildInfo = JsonSerializer.Deserialize&amp;lt;BuildInfo&amp;gt;(buildInfoJson, new JsonSerializerOptions {&lt;br /&gt;                        PropertyNamingPolicy = JsonNamingPolicy.CamelCase&lt;br /&gt;                    });&lt;br /&gt;                    if (buildInfo == null) throw new Exception($&amp;quot;Failed to deserialise {_buildFileName}&amp;quot;);&lt;br /&gt;&lt;br /&gt;                    _fileBuildInfo = buildInfo;&lt;br /&gt;                } catch (Exception) {&lt;br /&gt;                    _fileBuildInfo = new BuildInfo(&lt;br /&gt;                        BranchName: &amp;quot;&amp;quot;,&lt;br /&gt;                        BuildNumber: DateTime.UtcNow.ToString(&amp;quot;yyyyMMdd&amp;quot;) + &amp;quot;.0&amp;quot;,&lt;br /&gt;                        BuildId: &amp;quot;xxxxxx&amp;quot;,&lt;br /&gt;                        CommitHash: &amp;quot;Failed to load build info from buildinfo.json&amp;quot;&lt;br /&gt;                    );&lt;br /&gt;                }&lt;br /&gt;            }&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        public static BuildInfo GetBuildInfo() =&amp;gt; _fileBuildInfo;&lt;br /&gt;    }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The above code reads the &lt;code&gt;buildinfo.json&lt;/code&gt; file and deserialises it into a &lt;code&gt;BuildInfo&lt;/code&gt; record which is then surfaced up by the &lt;code&gt;GetBuildInfo&lt;/code&gt; method. We initialise this at the start of our &lt;code&gt;Program.cs&lt;/code&gt; like so:&lt;/p&gt;&lt;pre class="prettyprint cs"&gt;&lt;code class="lang-cs"&gt;        public static int Main(string[] args) {&lt;br /&gt;            AppVersionInfo.InitialiseBuildInfoGivenPath(Directory.GetCurrentDirectory());&lt;br /&gt;            // Now we&amp;#39;re free to call AppVersionInfo.GetBuildInfo()&lt;br /&gt;            // ....&lt;br /&gt;        }&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Now we need a controller to surface this information up. We&amp;#39;ll add ourselves a &lt;code&gt;BuildInfoController.cs&lt;/code&gt;:&lt;/p&gt;&lt;pre class="prettyprint cs"&gt;&lt;code class="lang-cs"&gt;using Microsoft.AspNetCore.Authorization;&lt;br /&gt;using Microsoft.AspNetCore.Mvc;&lt;br /&gt;&lt;br /&gt;namespace Server.Controllers {&lt;br /&gt;    [ApiController]&lt;br /&gt;    public class BuildInfoController : ControllerBase {&lt;br /&gt;        [AllowAnonymous]&lt;br /&gt;        [HttpGet(&amp;quot;api/build&amp;quot;)]&lt;br /&gt;        public BuildInfo GetBuild() =&amp;gt; AppVersionInfo.GetBuildInfo();&lt;br /&gt;    }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;This exposes an &lt;code&gt;api/build&lt;/code&gt; endpoint in our .NET app that, when hit, will display the following JSON:&lt;/p&gt;  &lt;div&gt;&lt;a href="https://raw.githubusercontent.com/johnnyreilly/blog.johnnyreilly.com/main/blog-website/static/blog/2021-01-29-surfacing-azure-pipelines-build-info-in/api-build-screenshot.png" style="display: block; padding: 1em 0; "&gt;&lt;img alt="" border="0" width="600" data-original-height="189" data-original-width="800" src="https://raw.githubusercontent.com/johnnyreilly/blog.johnnyreilly.com/main/blog-website/static/blog/2021-01-29-surfacing-azure-pipelines-build-info-in/api-build-screenshot.png"/&gt;&lt;/a&gt;&lt;/div&gt; &lt;h4 id="surfacing-the-client-build-info"&gt;Surfacing the client build info&lt;/h4&gt;&lt;p&gt;Our server now lets the world know which version it is running and this is tremendous.  Now let&amp;#39;s make our client do the same.&lt;/p&gt;&lt;p&gt;Very little is required to achieve this.  Again we have a &lt;code&gt;buildinfo.json&lt;/code&gt; sat in the root of our codebase.  We&amp;#39;re able to import it as a module in TypeScript because we&amp;#39;ve set the following property in our &lt;code&gt;tsconfig.json&lt;/code&gt;:&lt;/p&gt;&lt;pre class="prettyprint json"&gt;&lt;code class="lang-json"&gt;        &amp;quot;resolveJsonModule&amp;quot;: true,&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;As a consequence, consumption is as simple as:&lt;/p&gt;&lt;pre class="prettyprint ts"&gt;&lt;code&gt;import clientBuildInfo from &amp;#39;./buildinfo.json&amp;#39;;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Which provides us with a &lt;code&gt;clientBuildInfo&lt;/code&gt; which TypeScript automatically derives as this type:&lt;/p&gt;&lt;pre class="prettyprint ts"&gt;&lt;code&gt;type ClientBuildInfo = {&lt;br /&gt;    buildNumber: string;&lt;br /&gt;    buildId: string;&lt;br /&gt;    branchName: string;&lt;br /&gt;    commitHash: string;&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;How you choose to use that information is entirely your choice.  We&amp;#39;re going to add ourselves an &amp;quot;about&amp;quot; screen in our app, which displays both client info (loaded using the mechanism above) and server info (&lt;code&gt;fetch&lt;/code&gt;ed from the &lt;code&gt;/api/build&lt;/code&gt; endpoint).&lt;/p&gt;&lt;pre class="prettyprint ts"&gt;&lt;code class="lang-tsx"&gt;import {&lt;br /&gt;    Card,&lt;br /&gt;    CardContent,&lt;br /&gt;    CardHeader,&lt;br /&gt;    createStyles,&lt;br /&gt;    Grid,&lt;br /&gt;    makeStyles,&lt;br /&gt;    Theme,&lt;br /&gt;    Typography,&lt;br /&gt;    Zoom,&lt;br /&gt;} from &amp;#39;@material-ui/core&amp;#39;;&lt;br /&gt;import React from &amp;#39;react&amp;#39;;&lt;br /&gt;import clientBuildInfo from &amp;#39;../../buildinfo.json&amp;#39;;&lt;br /&gt;import { projectsPurple } from &amp;#39;../shared/colors&amp;#39;;&lt;br /&gt;import { Loading } from &amp;#39;../shared/Loading&amp;#39;;&lt;br /&gt;import { TransitionContainer } from &amp;#39;../shared/TransitionContainer&amp;#39;;&lt;br /&gt;&lt;br /&gt;const useStyles = (cardColor: string) =&amp;gt;&lt;br /&gt;    makeStyles((theme: Theme) =&amp;gt;&lt;br /&gt;        createStyles({&lt;br /&gt;            card: {&lt;br /&gt;                padding: theme.spacing(0),&lt;br /&gt;                backgroundColor: cardColor,&lt;br /&gt;                color: theme.palette.common.white,&lt;br /&gt;                minHeight: theme.spacing(28),&lt;br /&gt;            },&lt;br /&gt;            avatar: {&lt;br /&gt;                backgroundColor: theme.palette.getContrastText(cardColor),&lt;br /&gt;                color: cardColor,&lt;br /&gt;            },&lt;br /&gt;            main: {&lt;br /&gt;                padding: theme.spacing(2),&lt;br /&gt;            },&lt;br /&gt;        })&lt;br /&gt;    )();&lt;br /&gt;&lt;br /&gt;type Styles = ReturnType&amp;lt;typeof useStyles&amp;gt;;&lt;br /&gt;&lt;br /&gt;const AboutPage: React.FC = () =&amp;gt; {&lt;br /&gt;    const [serverBuildInfo, setServerBuildInfo] = React.useState&amp;lt;typeof clientBuildInfo&amp;gt;();&lt;br /&gt;&lt;br /&gt;    React.useEffect(() =&amp;gt; {&lt;br /&gt;        fetch(&amp;#39;/api/build&amp;#39;)&lt;br /&gt;            .then((response) =&amp;gt; response.json())&lt;br /&gt;            .then(setServerBuildInfo);&lt;br /&gt;    }, []);&lt;br /&gt;&lt;br /&gt;    const classes = useStyles(projectsPurple);&lt;br /&gt;&lt;br /&gt;    return (&lt;br /&gt;        &amp;lt;TransitionContainer&amp;gt;&lt;br /&gt;            &amp;lt;Grid container spacing={3}&amp;gt;&lt;br /&gt;                &amp;lt;Grid item xs={12} sm={12} container alignItems=&amp;quot;center&amp;quot;&amp;gt;&lt;br /&gt;                    &amp;lt;Grid item&amp;gt;&lt;br /&gt;                        &amp;lt;Typography variant=&amp;quot;h4&amp;quot; component=&amp;quot;h1&amp;quot;&amp;gt;&lt;br /&gt;                            About&lt;br /&gt;                        &amp;lt;/Typography&amp;gt;&lt;br /&gt;                    &amp;lt;/Grid&amp;gt;&lt;br /&gt;                &amp;lt;/Grid&amp;gt;&lt;br /&gt;            &amp;lt;/Grid&amp;gt;&lt;br /&gt;            &amp;lt;Grid container spacing={1}&amp;gt;&lt;br /&gt;                &amp;lt;BuildInfo classes={classes} title=&amp;quot;Client Version&amp;quot; {...clientBuildInfo} /&amp;gt;&lt;br /&gt;            &amp;lt;/Grid&amp;gt;&lt;br /&gt;            &amp;lt;br /&amp;gt;&lt;br /&gt;            &amp;lt;Grid container spacing={1}&amp;gt;&lt;br /&gt;                {serverBuildInfo ? (&lt;br /&gt;                    &amp;lt;BuildInfo classes={classes} title=&amp;quot;Server Version&amp;quot; {...serverBuildInfo} /&amp;gt;&lt;br /&gt;                ) : (&lt;br /&gt;                    &amp;lt;Loading /&amp;gt;&lt;br /&gt;                )}&lt;br /&gt;            &amp;lt;/Grid&amp;gt;&lt;br /&gt;        &amp;lt;/TransitionContainer&amp;gt;&lt;br /&gt;    );&lt;br /&gt;};&lt;br /&gt;&lt;br /&gt;interface Props {&lt;br /&gt;    classes: Styles;&lt;br /&gt;    title: string;&lt;br /&gt;    branchName: string;&lt;br /&gt;    buildNumber: string;&lt;br /&gt;    buildId: string;&lt;br /&gt;    commitHash: string;&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;const BuildInfo: React.FC&amp;lt;Props&amp;gt; = ({ classes, title, branchName, buildNumber, buildId, commitHash }) =&amp;gt; (&lt;br /&gt;    &amp;lt;Zoom mountOnEnter unmountOnExit in={true}&amp;gt;&lt;br /&gt;        &amp;lt;Card className={classes.card}&amp;gt;&lt;br /&gt;            &amp;lt;CardHeader title={title} /&amp;gt;&lt;br /&gt;            &amp;lt;CardContent className={classes.main}&amp;gt;&lt;br /&gt;                &amp;lt;Typography variant=&amp;quot;body1&amp;quot; component=&amp;quot;p&amp;quot;&amp;gt;&lt;br /&gt;                    &amp;lt;b&amp;gt;Build Number&amp;lt;/b&amp;gt; {buildNumber}&lt;br /&gt;                &amp;lt;/Typography&amp;gt;&lt;br /&gt;                &amp;lt;Typography variant=&amp;quot;body1&amp;quot; component=&amp;quot;p&amp;quot;&amp;gt;&lt;br /&gt;                    &amp;lt;b&amp;gt;Build Id&amp;lt;/b&amp;gt; {buildId}&lt;br /&gt;                &amp;lt;/Typography&amp;gt;&lt;br /&gt;                &amp;lt;Typography variant=&amp;quot;body1&amp;quot; component=&amp;quot;p&amp;quot;&amp;gt;&lt;br /&gt;                    &amp;lt;b&amp;gt;Branch Name&amp;lt;/b&amp;gt; {branchName}&lt;br /&gt;                &amp;lt;/Typography&amp;gt;&lt;br /&gt;                &amp;lt;Typography variant=&amp;quot;body1&amp;quot; component=&amp;quot;p&amp;quot;&amp;gt;&lt;br /&gt;                    &amp;lt;b&amp;gt;Commit Hash&amp;lt;/b&amp;gt; {commitHash}&lt;br /&gt;                &amp;lt;/Typography&amp;gt;&lt;br /&gt;            &amp;lt;/CardContent&amp;gt;&lt;br /&gt;        &amp;lt;/Card&amp;gt;&lt;br /&gt;    &amp;lt;/Zoom&amp;gt;&lt;br /&gt;);&lt;br /&gt;&lt;br /&gt;export default AboutPage;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;When the above page is viewed it looks like this:&lt;/p&gt; &lt;div&gt;&lt;a href="https://raw.githubusercontent.com/johnnyreilly/surfacing-azure-pipelines-build-info-in-a-dotnet-react-spa/main/about-page.png" style="display: block; padding: 0.25em 0; "&gt;&lt;img alt="" border="0" height="400" data-original-height="800" data-original-width="795" src="https://raw.githubusercontent.com/johnnyreilly/surfacing-azure-pipelines-build-info-in-a-dotnet-react-spa/main/about-page.png"/&gt;&lt;/a&gt;&lt;/div&gt; &lt;p&gt;And that&amp;#39;s it!  Our app is clearly telling us what version is being run, both on the server and in the client.  Thanks to Scott Hanselman for his work which inspired this.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/6902262076975914467'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/6902262076975914467'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2021/01/surfacing-azure-pipelines-build-info-in.html' title='Surfacing Azure Pipelines Build Info in a .NET React SPA'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-316095148389214651</id><published>2021-01-17T17:01:00.001Z</published><updated>2021-01-17T17:01:16.818Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Azure Easy Auth and Roles with .NET and Microsoft.Identity.Web</title><content type='html'>&lt;p&gt;&lt;a href="https://blog.johnnyreilly.com/2021/01/azure-easy-auth-and-roles-with-dotnet-and-core.html"&gt;I wrote recently about how to get Azure Easy Auth to work with roles&lt;/a&gt;.  This involved borrowing the approach used by &lt;a href="https://github.com/MaximRouiller/MaximeRouiller.Azure.AppService.EasyAuth"&gt;MaximeRouiller.Azure.AppService.EasyAuth&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;As a consequence of writing that post I came to learn that official support for Azure Easy Auth had landed in October 2020 in v1.2 of &lt;a href="https://github.com/AzureAD/microsoft-identity-web/wiki/1.2.0#integration-with-azure-app-services-authentication-of-web-apps-running-with-microsoftidentityweb"&gt;Microsoft.Identity.Web&lt;/a&gt;.  This was great news; I was delighted.&lt;/p&gt;&lt;p&gt;However, it turns out that the same authorization issue that &lt;code&gt;MaximeRouiller.Azure.AppService.EasyAuth&lt;/code&gt; suffers from, is visited upon &lt;code&gt;Microsoft.Identity.Web&lt;/code&gt; as well.&lt;/p&gt;&lt;h4 id="getting-set-up"&gt;Getting set up&lt;/h4&gt;&lt;p&gt;We&amp;#39;re using a .NET 5 project, running in an Azure App Service (Linux). In our &lt;code&gt;.csproj&lt;/code&gt; we have:&lt;/p&gt;&lt;pre class="prettyprint xml"&gt;&lt;code class="lang-xml"&gt;    &amp;lt;PackageReference Include=&amp;quot;Microsoft.Identity.Web&amp;quot; Version=&amp;quot;1.4.1&amp;quot; /&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;In our &lt;code&gt;Startup.cs&lt;/code&gt; we&amp;#39;re using:&lt;/p&gt;&lt;pre class="prettyprint json"&gt;&lt;code class="lang-cs"&gt;      public void ConfigureServices(IServiceCollection services) {&lt;br /&gt;            //...&lt;br /&gt;            services.AddMicrosoftIdentityWebAppAuthentication(Configuration);&lt;br /&gt;            //...&lt;br /&gt;      }&lt;br /&gt;&lt;br /&gt;      public void Configure(IApplicationBuilder app, IWebHostEnvironment env) {&lt;br /&gt;            //...&lt;br /&gt;            app.UseAuthentication();&lt;br /&gt;            app.UseAuthorization();&lt;br /&gt;            //...&lt;br /&gt;      }&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="you-gotta-roles-with-it"&gt;You gotta &lt;code&gt;roles&lt;/code&gt; with it&lt;/h4&gt;&lt;p&gt;Whilst the authentication works, authorization does not.  So whilst my app knows who I am - the authorization is not working with relation to &lt;strong&gt;roles&lt;/strong&gt;.&lt;/p&gt;&lt;p&gt;When directly using &lt;code&gt;Microsoft.Identity.Web&lt;/code&gt; when running locally, we see these claims:&lt;/p&gt;&lt;pre class="prettyprint json"&gt;&lt;code class="lang-json"&gt;[&lt;br /&gt;    // ...&lt;br /&gt;    {&lt;br /&gt;        &amp;quot;type&amp;quot;: &amp;quot;http://schemas.microsoft.com/ws/2008/06/identity/claims/role&amp;quot;,&lt;br /&gt;        &amp;quot;value&amp;quot;: &amp;quot;Administrator&amp;quot;&lt;br /&gt;    },&lt;br /&gt;    {&lt;br /&gt;        &amp;quot;type&amp;quot;: &amp;quot;http://schemas.microsoft.com/ws/2008/06/identity/claims/role&amp;quot;,&lt;br /&gt;        &amp;quot;value&amp;quot;: &amp;quot;Reader&amp;quot;&lt;br /&gt;    },&lt;br /&gt;    // ...&lt;br /&gt;&lt;br /&gt;]&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;However, we get different behaviour with EasyAuth; it provides roles related claims with a &lt;strong&gt;different type&lt;/strong&gt;:&lt;/p&gt;&lt;pre class="prettyprint json"&gt;&lt;code class="lang-json"&gt;[&lt;br /&gt;    // ...&lt;br /&gt;    {&lt;br /&gt;        &amp;quot;type&amp;quot;: &amp;quot;roles&amp;quot;,&lt;br /&gt;        &amp;quot;value&amp;quot;: &amp;quot;Administrator&amp;quot;&lt;br /&gt;    },&lt;br /&gt;    {&lt;br /&gt;        &amp;quot;type&amp;quot;: &amp;quot;roles&amp;quot;,&lt;br /&gt;        &amp;quot;value&amp;quot;: &amp;quot;Reader&amp;quot;&lt;br /&gt;    },&lt;br /&gt;    // ...&lt;br /&gt;]&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;This means that roles related authorization &lt;em&gt;does not work&lt;/em&gt; with Easy Auth:&lt;/p&gt;&lt;pre class="prettyprint cs"&gt;&lt;code class="lang-cs"&gt;[Authorize(Roles = &amp;quot;Reader&amp;quot;)]&lt;br /&gt;[HttpGet(&amp;quot;api/reader&amp;quot;)]&lt;br /&gt;public string GetWithReader() =&amp;gt;&lt;br /&gt;    &amp;quot;this is a secure endpoint that users with the Reader role can access&amp;quot;;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;This is because .NET is looking for claims with a &lt;code&gt;type&lt;/code&gt; of &lt;code&gt;&amp;quot;http://schemas.microsoft.com/ws/2008/06/identity/claims/role&amp;quot;&lt;/code&gt; and not finding them with Easy Auth.&lt;/p&gt;&lt;h4 id="claims-transformation-ftw"&gt;Claims transformation FTW&lt;/h4&gt;&lt;p&gt;There is a way to work around this issue .NET using &lt;code&gt;IClaimsTransformation&lt;/code&gt;.  This is a poorly documented feature, but fortunately &lt;a href="https://gunnarpeipman.com/aspnet-core-adding-claims-to-existing-identity/"&gt;Gunnar Peipman&amp;#39;s blog does a grand job of explaining it&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;Inside our &lt;code&gt;Startup.cs&lt;/code&gt; I&amp;#39;ve registered a claims transformer:&lt;/p&gt;&lt;pre class="prettyprint cs"&gt;&lt;code class="lang-cs"&gt;services.AddScoped&amp;lt;IClaimsTransformation, AddRolesClaimsTransformation&amp;gt;();&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;And that claims transformer looks like this:&lt;/p&gt;&lt;pre class="prettyprint cs"&gt;&lt;code class="lang-cs"&gt;    public class AddRolesClaimsTransformation : IClaimsTransformation {&lt;br /&gt;        private readonly ILogger&amp;lt;AddRolesClaimsTransformation&amp;gt; _logger;&lt;br /&gt;&lt;br /&gt;        public AddRolesClaimsTransformation(ILogger&amp;lt;AddRolesClaimsTransformation&amp;gt; logger) {&lt;br /&gt;            _logger = logger;&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        public Task&amp;lt;ClaimsPrincipal&amp;gt; TransformAsync(ClaimsPrincipal principal) {&lt;br /&gt;            var mappedRolesClaims = principal.Claims&lt;br /&gt;                .Where(claim =&amp;gt; claim.Type == &amp;quot;roles&amp;quot;)&lt;br /&gt;                .Select(claim =&amp;gt; new Claim(ClaimTypes.Role, claim.Value))&lt;br /&gt;                .ToList();&lt;br /&gt;&lt;br /&gt;            // Clone current identity&lt;br /&gt;            var clone = principal.Clone();&lt;br /&gt;&lt;br /&gt;            if (clone.Identity is not ClaimsIdentity newIdentity) return Task.FromResult(principal);&lt;br /&gt;&lt;br /&gt;            // Add role claims to cloned identity&lt;br /&gt;            foreach (var mappedRoleClaim in mappedRolesClaims) &lt;br /&gt;                newIdentity.AddClaim(mappedRoleClaim);&lt;br /&gt;&lt;br /&gt;            if (mappedRolesClaims.Count &amp;gt; 0)&lt;br /&gt;                _logger.LogInformation(&amp;quot;Added roles claims {mappedRolesClaims}&amp;quot;, mappedRolesClaims);&lt;br /&gt;            else&lt;br /&gt;                _logger.LogInformation(&amp;quot;No roles claims added&amp;quot;);&lt;br /&gt;&lt;br /&gt;            return Task.FromResult(clone);&lt;br /&gt;        }&lt;br /&gt;    }&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The class above creates a new principal with &lt;code&gt;&amp;quot;roles&amp;quot;&lt;/code&gt; claims mapped across to &lt;code&gt;&amp;quot;http://schemas.microsoft.com/ws/2008/06/identity/claims/role&amp;quot;&lt;/code&gt;.  This is enough to get .NET treating roles the way you&amp;#39;d hope.&lt;/p&gt;&lt;p&gt;&lt;a href="https://github.com/AzureAD/microsoft-identity-web/issues/881"&gt;I&amp;#39;ve raised an issue against the &lt;code&gt;Microsoft.Identity.Web&lt;/code&gt; repo&lt;/a&gt; about this. Perhaps one day this workaround will no longer be necessary.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/316095148389214651'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/316095148389214651'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2021/01/azure-easy-auth-and-roles-with-net-and-microsoft-identity-web.html' title='Azure Easy Auth and Roles with .NET and Microsoft.Identity.Web'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2682282257968932278</id><published>2021-01-14T19:15:00.002Z</published><updated>2021-01-17T17:04:07.299Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Azure'/><category scheme='http://www.blogger.com/atom/ns#' term='App service'/><category scheme='http://www.blogger.com/atom/ns#' term='authorisation'/><category scheme='http://www.blogger.com/atom/ns#' term='Authentication'/><category scheme='http://www.blogger.com/atom/ns#' term='azure AD'/><title type='text'>Azure Easy Auth and Roles with .NET (and .NET Core)</title><content type='html'>&lt;p&gt;&lt;em&gt;If this post is interesting to you, you may also want to &lt;a href="https://blog.johnnyreilly.com/2021/01/azure-easy-auth-and-roles-with-net-and-microsoft-identity-web.html"&gt;look at this one where we try to use Microsoft.Identity.Web for the same purpose.&lt;/a&gt;&lt;/em&gt;&lt;/p&gt; &lt;p&gt;Azure has a feature which is intended to allow Authentication and Authorization to be applied outside of your application code. It&amp;#39;s called &lt;a href="https://docs.microsoft.com/en-us/azure/app-service/overview-authentication-authorization"&gt;&amp;quot;Easy Auth&amp;quot;&lt;/a&gt;. Unfortunately, in the context of App Services it doesn&amp;#39;t work with .NET Core and .NET.  Perhaps it would be better to say: of the various .NETs, it supports .NET Framework. &lt;a href="https://docs.microsoft.com/en-us/azure/app-service/overview-authentication-authorization#userapplication-claims"&gt;To quote the docs&lt;/a&gt;:&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;At this time, ASP.NET Core does not currently support populating the current user with the Authentication/Authorization feature. However, some &lt;a href="https://github.com/MaximRouiller/MaximeRouiller.Azure.AppService.EasyAuth"&gt;3rd party, open source middleware components&lt;/a&gt; do exist to help fill this gap.&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;Thanks to &lt;a href="https://twitter.com/MaximRouiller"&gt;Maxime Rouiller&lt;/a&gt; there&amp;#39;s a way forward here. However, as I was taking this for a spin today, I discovered another issue. &lt;/p&gt;&lt;h4 id="where-are-our-roles-"&gt;Where are our roles?&lt;/h4&gt;&lt;p&gt;Consider the following .NET controller:&lt;/p&gt;&lt;pre class="prettyprint cs"&gt;&lt;code class="lang-cs"&gt;[Authorize(Roles = &amp;quot;Administrator,Reader&amp;quot;)]&lt;br /&gt;[HttpGet(&amp;quot;api/admin-reader&amp;quot;)]&lt;br /&gt;public string GetWithAdminOrReader() =&amp;gt;&lt;br /&gt;    &amp;quot;this is a secure endpoint that users with the Administrator or Reader role can access&amp;quot;;&lt;br /&gt;&lt;br /&gt;[Authorize(Roles = &amp;quot;Administrator&amp;quot;)]&lt;br /&gt;[HttpGet(&amp;quot;api/admin&amp;quot;)]&lt;br /&gt;public string GetWithAdmin() =&amp;gt;&lt;br /&gt;    &amp;quot;this is a secure endpoint that users with the Administrator role can access&amp;quot;;&lt;br /&gt;&lt;br /&gt;[Authorize(Roles = &amp;quot;Reader&amp;quot;)]&lt;br /&gt;[HttpGet(&amp;quot;api/reader&amp;quot;)]&lt;br /&gt;public string GetWithReader() =&amp;gt;&lt;br /&gt;    &amp;quot;this is a secure endpoint that users with the Reader role can access&amp;quot;;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The three endpoints above restrict access based upon roles. However, even with Maxime&amp;#39;s marvellous shim in the mix, authorization doesn&amp;#39;t work when deployed to an Azure App Service.  Why?  Well, it comes down to how roles are mapped to claims.  &lt;/p&gt;&lt;p&gt;Let&amp;#39;s back up a bit. First of all we&amp;#39;ve added a dependency to our project:&lt;/p&gt;&lt;pre class="prettyprint"&gt;&lt;code class="lang-shell"&gt;dotnet add package MaximeRouiller.Azure.AppService.EasyAuth&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Next we&amp;#39;ve updated our &lt;code&gt;Startup.cs&lt;/code&gt; &lt;code&gt;ConfigureServices&lt;/code&gt; such that it looks like this:&lt;/p&gt;&lt;pre class="prettyprint cs"&gt;&lt;code class="lang-cs"&gt;if (Env.IsDevelopment()) {&lt;br /&gt;    services.AddMicrosoftIdentityWebAppAuthentication(Configuration);&lt;br /&gt;else&lt;br /&gt;    services.AddAuthentication(&amp;quot;EasyAuth&amp;quot;).AddEasyAuthAuthentication((o) =&amp;gt; { });&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;With the above in place, either the Microsoft Identity platform will directly be used for authentication, or Maxime&amp;#39;s package will be used as the default authentication scheme.  The driver for this is &lt;code&gt;Env&lt;/code&gt; which is an &lt;code&gt;IHostEnvironment&lt;/code&gt; that was injected to the &lt;code&gt;Startup.cs&lt;/code&gt;.  Running locally, both authentication and authorization will work.  However, deployed to an Azure App Service, only authentication will work.&lt;/p&gt;&lt;p&gt;It turns out that directly using the Microsoft Identity platform, we see roles claims coming through like so:&lt;/p&gt;&lt;pre class="prettyprint json"&gt;&lt;code class="lang-json"&gt;[&lt;br /&gt;    // ...&lt;br /&gt;    {&lt;br /&gt;        &amp;quot;type&amp;quot;: &amp;quot;http://schemas.microsoft.com/ws/2008/06/identity/claims/role&amp;quot;,&lt;br /&gt;        &amp;quot;value&amp;quot;: &amp;quot;Administrator&amp;quot;&lt;br /&gt;    },&lt;br /&gt;    {&lt;br /&gt;        &amp;quot;type&amp;quot;: &amp;quot;http://schemas.microsoft.com/ws/2008/06/identity/claims/role&amp;quot;,&lt;br /&gt;        &amp;quot;value&amp;quot;: &amp;quot;Reader&amp;quot;&lt;br /&gt;    },&lt;br /&gt;    // ...&lt;br /&gt;&lt;br /&gt;]&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;But in Azure we see roles claims showing up with a different &lt;code&gt;type&lt;/code&gt;:&lt;/p&gt;&lt;pre class="prettyprint json"&gt;&lt;code class="lang-json"&gt;[&lt;br /&gt;    // ...&lt;br /&gt;    {&lt;br /&gt;        &amp;quot;type&amp;quot;: &amp;quot;roles&amp;quot;,&lt;br /&gt;        &amp;quot;value&amp;quot;: &amp;quot;Administrator&amp;quot;&lt;br /&gt;    },&lt;br /&gt;    {&lt;br /&gt;        &amp;quot;type&amp;quot;: &amp;quot;roles&amp;quot;,&lt;br /&gt;        &amp;quot;value&amp;quot;: &amp;quot;Reader&amp;quot;&lt;br /&gt;    },&lt;br /&gt;    // ...&lt;br /&gt;]&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;This is the crux of the problem; .NET and .NET Core are looking in a different place for roles.&lt;/p&gt;&lt;h4 id="role-up-role-up-"&gt;Role up, role up!&lt;/h4&gt;&lt;p&gt;There wasn&amp;#39;t an obvious way to make this work with Maxime&amp;#39;s package.  So we ended up lifting the source code of Maxime&amp;#39;s package and tweaking it. Take a look:&lt;/p&gt;&lt;pre class="prettyprint cs"&gt;&lt;code class="lang-cs"&gt;using Microsoft.AspNetCore.Authentication;&lt;br /&gt;using Microsoft.Extensions.DependencyInjection;&lt;br /&gt;using Microsoft.Extensions.Logging;&lt;br /&gt;using Microsoft.Extensions.Options;&lt;br /&gt;using System;&lt;br /&gt;using System.Collections.Generic;&lt;br /&gt;using System.Linq;&lt;br /&gt;using System.Security.Claims;&lt;br /&gt;using System.Text.Encodings.Web;&lt;br /&gt;using System.Text.Json;&lt;br /&gt;using System.Text.Json.Serialization;&lt;br /&gt;using System.Threading.Tasks;&lt;br /&gt;&lt;br /&gt;/// &amp;lt;summary&amp;gt;&lt;br /&gt;/// Based on https://github.com/MaximRouiller/MaximeRouiller.Azure.AppService.EasyAuth&lt;br /&gt;/// Essentially EasyAuth only supports .NET Framework: https://docs.microsoft.com/en-us/azure/app-service/app-service-authentication-how-to#access-user-claims&lt;br /&gt;/// This allows us to get support for Authentication and Authorization (using roles) with .NET&lt;br /&gt;/// &amp;lt;/summary&amp;gt;&lt;br /&gt;namespace EasyAuth {&lt;br /&gt;    public static class EasyAuthAuthenticationBuilderExtensions {&lt;br /&gt;        public static AuthenticationBuilder AddEasyAuthAuthentication(&lt;br /&gt;            this IServiceCollection services) =&amp;gt;&lt;br /&gt;            services.AddAuthentication(&amp;quot;EasyAuth&amp;quot;).AddEasyAuthAuthenticationScheme(o =&amp;gt; { });&lt;br /&gt;&lt;br /&gt;        public static AuthenticationBuilder AddEasyAuthAuthenticationScheme(&lt;br /&gt;            this AuthenticationBuilder builder,&lt;br /&gt;            Action&amp;lt;EasyAuthAuthenticationOptions&amp;gt; configure) =&amp;gt;&lt;br /&gt;                builder.AddScheme&amp;lt;EasyAuthAuthenticationOptions, EasyAuthAuthenticationHandler&amp;gt;(&lt;br /&gt;                    &amp;quot;EasyAuth&amp;quot;,&lt;br /&gt;                    &amp;quot;EasyAuth&amp;quot;,&lt;br /&gt;                    configure);&lt;br /&gt;    }&lt;br /&gt;&lt;br /&gt;    public class EasyAuthAuthenticationOptions : AuthenticationSchemeOptions {&lt;br /&gt;        public EasyAuthAuthenticationOptions() {&lt;br /&gt;            Events = new object();&lt;br /&gt;        }&lt;br /&gt;    }&lt;br /&gt;&lt;br /&gt;    public class EasyAuthAuthenticationHandler : AuthenticationHandler&amp;lt;EasyAuthAuthenticationOptions&amp;gt; {&lt;br /&gt;        public EasyAuthAuthenticationHandler(&lt;br /&gt;            IOptionsMonitor&amp;lt;EasyAuthAuthenticationOptions&amp;gt; options,&lt;br /&gt;            ILoggerFactory logger,&lt;br /&gt;            UrlEncoder encoder,&lt;br /&gt;            ISystemClock clock)&lt;br /&gt;            : base(options, logger, encoder, clock) {&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        protected override Task&amp;lt;AuthenticateResult&amp;gt; HandleAuthenticateAsync() {&lt;br /&gt;            try {&lt;br /&gt;                var easyAuthEnabled = string.Equals(Environment.GetEnvironmentVariable(&amp;quot;WEBSITE_AUTH_ENABLED&amp;quot;, EnvironmentVariableTarget.Process), &amp;quot;True&amp;quot;, StringComparison.InvariantCultureIgnoreCase);&lt;br /&gt;                if (!easyAuthEnabled) return Task.FromResult(AuthenticateResult.NoResult());&lt;br /&gt;&lt;br /&gt;                var easyAuthProvider = Context.Request.Headers[&amp;quot;X-MS-CLIENT-PRINCIPAL-IDP&amp;quot;].FirstOrDefault();&lt;br /&gt;                var msClientPrincipalEncoded = Context.Request.Headers[&amp;quot;X-MS-CLIENT-PRINCIPAL&amp;quot;].FirstOrDefault();&lt;br /&gt;                if (string.IsNullOrWhiteSpace(easyAuthProvider) ||&lt;br /&gt;                    string.IsNullOrWhiteSpace(msClientPrincipalEncoded))&lt;br /&gt;                    return Task.FromResult(AuthenticateResult.NoResult());&lt;br /&gt;&lt;br /&gt;                var decodedBytes = Convert.FromBase64String(msClientPrincipalEncoded);&lt;br /&gt;                var msClientPrincipalDecoded = System.Text.Encoding.Default.GetString(decodedBytes);&lt;br /&gt;                var clientPrincipal = JsonSerializer.Deserialize&amp;lt;MsClientPrincipal&amp;gt;(msClientPrincipalDecoded);&lt;br /&gt;                if (clientPrincipal == null) return Task.FromResult(AuthenticateResult.NoResult());&lt;br /&gt;&lt;br /&gt;                var mappedRolesClaims = clientPrincipal.Claims&lt;br /&gt;                    .Where(claim =&amp;gt; claim.Type == &amp;quot;roles&amp;quot;)&lt;br /&gt;                    .Select(claim =&amp;gt; new Claim(ClaimTypes.Role, claim.Value))&lt;br /&gt;                    .ToList();&lt;br /&gt;&lt;br /&gt;                var claims = clientPrincipal.Claims.Select(claim =&amp;gt; new Claim(claim.Type, claim.Value)).ToList();&lt;br /&gt;                claims.AddRange(mappedRolesClaims);&lt;br /&gt;&lt;br /&gt;                var principal = new ClaimsPrincipal();&lt;br /&gt;                principal.AddIdentity(new ClaimsIdentity(claims, clientPrincipal.AuthenticationType, clientPrincipal.NameType, clientPrincipal.RoleType));&lt;br /&gt;&lt;br /&gt;                var ticket = new AuthenticationTicket(principal, easyAuthProvider);&lt;br /&gt;                var success = AuthenticateResult.Success(ticket);&lt;br /&gt;                Context.User = principal;&lt;br /&gt;&lt;br /&gt;                return Task.FromResult(success);&lt;br /&gt;            } catch (Exception ex) {&lt;br /&gt;                return Task.FromResult(AuthenticateResult.Fail(ex));&lt;br /&gt;            }&lt;br /&gt;        }&lt;br /&gt;    }&lt;br /&gt;&lt;br /&gt;    public class MsClientPrincipal {&lt;br /&gt;        [JsonPropertyName(&amp;quot;auth_typ&amp;quot;)]&lt;br /&gt;        public string? AuthenticationType { get; set; }&lt;br /&gt;        [JsonPropertyName(&amp;quot;claims&amp;quot;)]&lt;br /&gt;        public IEnumerable&amp;lt;UserClaim&amp;gt; Claims { get; set; } = Array.Empty&amp;lt;UserClaim&amp;gt;();&lt;br /&gt;        [JsonPropertyName(&amp;quot;name_typ&amp;quot;)]&lt;br /&gt;        public string? NameType { get; set; }&lt;br /&gt;        [JsonPropertyName(&amp;quot;role_typ&amp;quot;)]&lt;br /&gt;        public string? RoleType { get; set; }&lt;br /&gt;    }&lt;br /&gt;&lt;br /&gt;    public class UserClaim {&lt;br /&gt;        [JsonPropertyName(&amp;quot;typ&amp;quot;)]&lt;br /&gt;        public string Type { get; set; } = string.Empty;&lt;br /&gt;        [JsonPropertyName(&amp;quot;val&amp;quot;)]&lt;br /&gt;        public string Value { get; set; } = string.Empty;&lt;br /&gt;    }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;There&amp;#39;s a number of changes in the above code to Maxime&amp;#39;s package.  Three changes that are not significant and one that is. First the insignificant changes:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;It uses &lt;a href="https://docs.microsoft.com/en-us/dotnet/standard/serialization/system-text-json-how-to?pivots=dotnet-5-0"&gt;&lt;code&gt;System.Text.Json&lt;/code&gt;&lt;/a&gt; in place of JSON.NET&lt;/li&gt;&lt;li&gt;It uses &lt;a href="https://blog.johnnyreilly.com/2020/12/nullable-reference-types-csharp-strictnullchecks.html"&gt;C#s nullable reference types&lt;/a&gt;&lt;/li&gt;&lt;li&gt;It changes the extension method signature such that instead of entering &lt;code&gt;services.AddAuthentication().AddEasyAuthAuthentication((o) =&amp;gt; { })&lt;/code&gt; we now need only enter &lt;code&gt;services.AddEasyAuthAuthentication()&lt;/code&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;Now the significant change:&lt;/p&gt;&lt;p&gt;Where the middleware encounters claims in the &lt;code&gt;X-MS-CLIENT-PRINCIPAL&lt;/code&gt; header with the &lt;code&gt;Type&lt;/code&gt; of &lt;code&gt;&amp;quot;roles&amp;quot;&lt;/code&gt; it creates brand new claims for each, with the same &lt;code&gt;Value&lt;/code&gt; but with the official &lt;code&gt;Type&lt;/code&gt; supplied by &lt;code&gt;ClaimsTypes.Role&lt;/code&gt; of &lt;code&gt;&amp;quot;http://schemas.microsoft.com/ws/2008/06/identity/claims/role&amp;quot;&lt;/code&gt;.  The upshot of this, is that when the processed claims are inspected in Azure they now look more like this:&lt;/p&gt;&lt;pre class="prettyprint json"&gt;&lt;code class="lang-json"&gt;[&lt;br /&gt;    // ...&lt;br /&gt;    {&lt;br /&gt;        &amp;quot;type&amp;quot;: &amp;quot;roles&amp;quot;,&lt;br /&gt;        &amp;quot;value&amp;quot;: &amp;quot;Administrator&amp;quot;&lt;br /&gt;    },&lt;br /&gt;    {&lt;br /&gt;        &amp;quot;type&amp;quot;: &amp;quot;roles&amp;quot;,&lt;br /&gt;        &amp;quot;value&amp;quot;: &amp;quot;Reader&amp;quot;&lt;br /&gt;    },&lt;br /&gt;    // ...&lt;br /&gt;    {&lt;br /&gt;        &amp;quot;type&amp;quot;: &amp;quot;http://schemas.microsoft.com/ws/2008/06/identity/claims/role&amp;quot;,&lt;br /&gt;        &amp;quot;value&amp;quot;: &amp;quot;Administrator&amp;quot;&lt;br /&gt;    },&lt;br /&gt;    {&lt;br /&gt;        &amp;quot;type&amp;quot;: &amp;quot;http://schemas.microsoft.com/ws/2008/06/identity/claims/role&amp;quot;,&lt;br /&gt;        &amp;quot;value&amp;quot;: &amp;quot;Reader&amp;quot;&lt;br /&gt;    }&lt;br /&gt;]&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;As you can see, we now have both the originally supplied roles &lt;em&gt;as well&lt;/em&gt; as roles of the type that .NET and .NET Core expect.  Consequently, roles based behaviour starts to work.  Thanks to Maxime for his fine work on the initial solution.  It would be tremendous if neither the code in this blog post nor Maxime&amp;#39;s shim were required. Still, until that glorious day!&lt;/p&gt; &lt;h4&gt;Update: Potential ways forward&lt;/h4&gt; &lt;p&gt;When I was tweeting this post, Maxime was good enough to respond and suggest that this may be resolved within Azure itself in future:&lt;/p&gt; &lt;blockquote class="twitter-tweet"&gt;&lt;p lang="en" dir="ltr"&gt;Oh, so that&amp;#39;s why they removed the name? &lt;br&gt;&lt;br&gt;Jokes aside, we hope that this package won&amp;#39;t be necessary for the future. I know that &lt;a href="https://twitter.com/mattchenderson?ref_src=twsrc%5Etfw"&gt;@mattchenderson&lt;/a&gt; is part of a working group to update Easy Auth.&lt;br&gt;&lt;br&gt;Might want to make sure you follow him as well. &lt;/p&gt;&amp;mdash; Maxime Rouiller (@MaximRouiller) &lt;a href="https://twitter.com/MaximRouiller/status/1349804324713615366?ref_src=twsrc%5Etfw"&gt;January 14, 2021&lt;/a&gt;&lt;/blockquote&gt; &lt;script async src="https://platform.twitter.com/widgets.js" charset="utf-8"&gt;&lt;/script&gt; &lt;p&gt;There's a prospective PR that would add an event to Maxime's API.  If something along these lines was merged, then my workaround would no longer be necessary. Follow the PR &lt;a href="https://github.com/MaximRouiller/MaximeRouiller.Azure.AppService.EasyAuth/pull/13"&gt;here&lt;/a&gt;.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2682282257968932278'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2682282257968932278'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2021/01/azure-easy-auth-and-roles-with-dotnet-and-core.html' title='Azure Easy Auth and Roles with .NET (and .NET Core)'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-7132129819922128441</id><published>2021-01-03T21:13:00.002Z</published><updated>2021-01-19T05:50:05.374Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='useQueries'/><category scheme='http://www.blogger.com/atom/ns#' term='react-query'/><title type='text'>Strongly typing react-querys useQueries</title><content type='html'>&lt;p&gt;If you haven&amp;#39;t used &lt;a href="https://react-query.tanstack.com/"&gt;&lt;code&gt;react-query&lt;/code&gt;&lt;/a&gt; then I heartily recommend it. It provides (to quote the docs):&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;Hooks for fetching, caching and updating asynchronous data in React&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;With version 3 of &lt;code&gt;react-query&lt;/code&gt;, a new hook was added: &lt;a href="https://react-query.tanstack.com/reference/useQueries"&gt;&lt;code&gt;useQueries&lt;/code&gt;&lt;/a&gt;. This hook allows you fetch a variable number of queries at the same time.  An example of what usage looks like is this (&lt;a href="https://react-query.tanstack.com/guides/parallel-queries#dynamic-parallel-queries-with-usequeries"&gt;borrowed from the excellent docs&lt;/a&gt;):&lt;/p&gt;&lt;pre class="prettyprint ts"&gt;&lt;code class="lang-tsx"&gt; function App({ users }) {&lt;br /&gt;   const userQueries = useQueries(&lt;br /&gt;     users.map(user =&amp;gt; {&lt;br /&gt;       return {&lt;br /&gt;         queryKey: [&amp;#39;user&amp;#39;, user.id],&lt;br /&gt;         queryFn: () =&amp;gt; fetchUserById(user.id),&lt;br /&gt;       }&lt;br /&gt;     })&lt;br /&gt;   )&lt;br /&gt; }&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Whilst &lt;code&gt;react-query&lt;/code&gt; is written in TypeScript, the way that &lt;code&gt;useQueries&lt;/code&gt; is presently written strips the types that are supplied to it.  Consider &lt;a href="https://github.com/tannerlinsley/react-query/blob/d25ab3ef8260ea1c02b52b7082c3ce4120596b31/src/react/useQueries.ts#L8"&gt;the signature of the &lt;code&gt;useQueries&lt;/code&gt;&lt;/a&gt;:&lt;/p&gt;&lt;pre class="prettyprint ts"&gt;&lt;code class="lang-ts"&gt;export function useQueries(queries: UseQueryOptions[]): UseQueryResult[] {&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;This returns an array of &lt;a href="https://github.com/tannerlinsley/react-query/blob/d25ab3ef8260ea1c02b52b7082c3ce4120596b31/src/react/types.ts#L42"&gt;&lt;code&gt;UseQueryResult&lt;/code&gt;&lt;/a&gt;:&lt;/p&gt;&lt;pre class="prettyprint ts"&gt;&lt;code class="lang-ts"&gt;export type UseQueryResult&amp;lt;&lt;br /&gt;  TData = unknown,&lt;br /&gt;  TError = unknown&lt;br /&gt;&amp;gt; = UseBaseQueryResult&amp;lt;TData, TError&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;As you can see, no type parameters are passed to &lt;code&gt;UseQueryResult&lt;/code&gt; in the &lt;code&gt;useQueries&lt;/code&gt; signature and so it takes the default types of &lt;code&gt;unknown&lt;/code&gt;.  This forces the consumer to either assert the type that they believe to be there, or to use type narrowing to ensure the type.  The former approach exposes a possibility of errors (the user can specify incorrect types) and the latter approach requires our code to perform type narrowing operations which are essentially unnecessary (the type hasn&amp;#39;t changed since it was returned; it&amp;#39;s simply been discarded).&lt;/p&gt;&lt;p&gt;What if there was a way to strongly type &lt;code&gt;useQueries&lt;/code&gt; so we neither risked specifying incorrect types, nor wasted precious lines of code and CPU cycles performing type narrowing?  There is my friends, read on!&lt;/p&gt;&lt;h4 id="usequeriestyped-a-strongly-typed-wrapper-for-usequeries"&gt;&lt;code&gt;useQueriesTyped&lt;/code&gt; - a strongly typed wrapper for &lt;code&gt;useQueries&lt;/code&gt;&lt;/h4&gt;&lt;p&gt;It&amp;#39;s possible to wrap the &lt;code&gt;useQueries&lt;/code&gt; hook with our own &lt;code&gt;useQueriesTyped&lt;/code&gt; hook which exposes a strongly typed API.  It looks like this:&lt;/p&gt;&lt;pre class="prettyprint ts"&gt;&lt;code class="lang-ts"&gt;import { useQueries, UseQueryOptions, UseQueryResult } from &amp;#39;react-query&amp;#39;;&lt;br /&gt;&lt;br /&gt;type Awaited&amp;lt;T&amp;gt; = T extends PromiseLike&amp;lt;infer U&amp;gt; ? Awaited&amp;lt;U&amp;gt; : T;&lt;br /&gt;&lt;br /&gt;export function useQueriesTyped&amp;lt;TQueries extends readonly UseQueryOptions[]&amp;gt;(&lt;br /&gt;    queries: [...TQueries]&lt;br /&gt;): {&lt;br /&gt;  [ArrayElement in keyof TQueries]: UseQueryResult&amp;lt;&lt;br /&gt;    TQueries[ArrayElement] extends { select: infer TSelect }&lt;br /&gt;      ? TSelect extends (data: any) =&amp;gt; any&lt;br /&gt;        ? ReturnType&amp;lt;TSelect&amp;gt;&lt;br /&gt;        : never&lt;br /&gt;      : Awaited&amp;lt;&lt;br /&gt;          ReturnType&amp;lt;&lt;br /&gt;            NonNullable&amp;lt;&lt;br /&gt;              Extract&amp;lt;TQueries[ArrayElement], UseQueryOptions&amp;gt;[&amp;#39;queryFn&amp;#39;]&lt;br /&gt;            &amp;gt;&lt;br /&gt;          &amp;gt;&lt;br /&gt;        &amp;gt;&lt;br /&gt;  &amp;gt;&lt;br /&gt;} {&lt;br /&gt;    // eslint-disable-next-line @typescript-eslint/no-explicit-any&lt;br /&gt;    return useQueries(queries as UseQueryOptions&amp;lt;unknown, unknown, unknown&amp;gt;[]) as any;&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Let&amp;#39;s unpack this.  The first and most significant thing to note here is that &lt;code&gt;queries&lt;/code&gt; moves from being &lt;code&gt;UseQueryOptions[]&lt;/code&gt; to being &lt;code&gt;TQueries extends readonly UseQueryOptions[]&lt;/code&gt; - far more fancy! The reason for this change is we want the type parameters to flow through on an element by element basis in the supplied array.  &lt;a href="https://www.typescriptlang.org/docs/handbook/release-notes/typescript-4-0.html#variadic-tuple-types"&gt;TypeScript 4&amp;#39;s variadic tuple types&lt;/a&gt;  should allow us to support this.  So the new array signature looks like this:&lt;/p&gt;&lt;pre class="prettyprint ts"&gt;&lt;code class="lang-ts"&gt;queries: [...TQueries]&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Where &lt;code&gt;TQueries&lt;/code&gt; is&lt;/p&gt;&lt;pre class="prettyprint ts"&gt;&lt;code class="lang-ts"&gt;TQueries extends readonly UseQueryOptions[]&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;What this means is, that each element of the rest parameters array must have a type of &lt;code&gt;readonly UseQueryOptions&lt;/code&gt;. Otherwise the compiler will shout at us (and rightly so).&lt;/p&gt;&lt;p&gt;So that&amp;#39;s what&amp;#39;s coming in.... What&amp;#39;s going out? Well the return type of &lt;code&gt;useQueriesTyped&lt;/code&gt; is the tremendously verbose:&lt;/p&gt;&lt;pre class="prettyprint ts"&gt;&lt;code class="lang-ts"&gt;{ &lt;br /&gt;  [ArrayElement in keyof TQueries]: UseQueryResult&amp;lt;&lt;br /&gt;    TQueries[ArrayElement] extends { select: infer TSelect }&lt;br /&gt;      ? TSelect extends (data: any) =&amp;gt; any&lt;br /&gt;        ? ReturnType&amp;lt;TSelect&amp;gt;&lt;br /&gt;        : never&lt;br /&gt;      : Awaited&amp;lt;&lt;br /&gt;          ReturnType&amp;lt;&lt;br /&gt;            NonNullable&amp;lt;&lt;br /&gt;              Extract&amp;lt;TQueries[ArrayElement], UseQueryOptions&amp;gt;[&amp;#39;queryFn&amp;#39;]&lt;br /&gt;            &amp;gt;&lt;br /&gt;          &amp;gt;&lt;br /&gt;        &amp;gt;&lt;br /&gt;  &amp;gt;&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Let&amp;#39;s walk this through.  First of all we&amp;#39;ll look at this bit:&lt;/p&gt;&lt;pre class="prettyprint ts"&gt;&lt;code class="lang-ts"&gt;{ [ArrayElement in keyof TQueries]: /* the type has been stripped to protect your eyes */ }&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;On the face of it, it looks like we&amp;#39;re returning an &lt;code&gt;Object&lt;/code&gt;, not an &lt;code&gt;Array&lt;/code&gt;.  There&amp;#39;s nuance here; &lt;a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array"&gt;JavaScript &lt;code&gt;Array&lt;/code&gt;s are &lt;code&gt;Object&lt;/code&gt;s&lt;/a&gt;. &lt;/p&gt;&lt;p&gt;More specifically, by approaching the signature this way, we can acquire the &lt;code&gt;ArrayElement&lt;/code&gt; type which represents each of the keys of the array. Consider this array:&lt;/p&gt;&lt;pre class="prettyprint ts"&gt;&lt;code class="lang-ts"&gt;[1, &amp;#39;two&amp;#39;, new Date()]&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;For the above, &lt;code&gt;ArrayElement&lt;/code&gt; would take the values &lt;code&gt;0&lt;/code&gt;, &lt;code&gt;1&lt;/code&gt; and &lt;code&gt;2&lt;/code&gt;.  And this is going to prove useful in a moment as we&amp;#39;re going to index into our &lt;code&gt;TQueries&lt;/code&gt; object to surface up the return types for each element of our return array from there.&lt;/p&gt;&lt;p&gt;Now let&amp;#39;s look at the return type for each element.  The signature of that looks like this:&lt;/p&gt;&lt;pre class="prettyprint ts"&gt;&lt;code class="lang-ts"&gt;  UseQueryResult&amp;lt;&lt;br /&gt;    TQueries[ArrayElement] extends { select: infer TSelect }&lt;br /&gt;      ? TSelect extends (data: any) =&amp;gt; any&lt;br /&gt;        ? ReturnType&amp;lt;TSelect&amp;gt;&lt;br /&gt;        : never&lt;br /&gt;      : Awaited&amp;lt;&lt;br /&gt;          ReturnType&amp;lt;&lt;br /&gt;            NonNullable&amp;lt;&lt;br /&gt;              Extract&amp;lt;TQueries[ArrayElement], UseQueryOptions&amp;gt;[&amp;#39;queryFn&amp;#39;]&lt;br /&gt;            &amp;gt;&lt;br /&gt;          &amp;gt;&lt;br /&gt;        &amp;gt;&lt;br /&gt;  &amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Gosh... Well there&amp;#39;s a lot going on here. Let&amp;#39;s start in the middle and work our way out.&lt;/p&gt;&lt;pre class="prettyprint ts"&gt;&lt;code class="lang-ts"&gt;TQueries[ArrayElement]&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The above code indexes into our &lt;code&gt;TQueries&lt;/code&gt; array for each element of our strongly typed indexer &lt;code&gt;ArrayElement&lt;/code&gt;. So it might resolve the first element of an array to &lt;code&gt;{ queryKey: &amp;#39;key1&amp;#39;, queryFn: () =&amp;gt; 1 }&lt;/code&gt;, for example. Next:&lt;/p&gt;&lt;pre class="prettyprint ts"&gt;&lt;code class="lang-ts"&gt;Extract&amp;lt;TQueries[ArrayElement], UseQueryOptions&amp;gt;[&amp;#39;queryFn&amp;#39;]&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;We&amp;#39;re now taking the type of each element provided, and grabbing the type of the &lt;code&gt;queryFn&lt;/code&gt; property. It&amp;#39;s this type which contains the type of the data that will be passed back, that we want to make use of.  So for an examples of &lt;code&gt;[{ queryKey: &amp;#39;key1&amp;#39;, queryFn: () =&amp;gt; 1 }, { queryKey: &amp;#39;key2&amp;#39;, queryFn: () =&amp;gt; &amp;#39;two&amp;#39; }, { queryKey: &amp;#39;key3&amp;#39;, queryFn: () =&amp;gt; new Date() }]&lt;/code&gt; we&amp;#39;d have the type: &lt;code&gt;const result: [() =&amp;gt; number, () =&amp;gt; string, () =&amp;gt; Date]&lt;/code&gt;.&lt;/p&gt;&lt;pre class="prettyprint ts"&gt;&lt;code class="lang-ts"&gt;NonNullable&amp;lt;Extract&amp;lt;TQueries[ArrayElement], UseQueryOptions&amp;gt;[&amp;#39;queryFn&amp;#39;]&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The next stage is using &lt;code&gt;NonNullable&lt;/code&gt; on our &lt;code&gt;queryFn&lt;/code&gt;, given that on &lt;code&gt;UseQueryOptions&lt;/code&gt; it&amp;#39;s an optional type. In our use case it is not optional / nullable and so we need to enforce that.&lt;/p&gt;&lt;pre class="prettyprint ts"&gt;&lt;code class="lang-ts"&gt;ReturnType&amp;lt;NonNullable&amp;lt;Extract&amp;lt;TQueries[ArrayElement], UseQueryOptions&amp;gt;[&amp;#39;queryFn&amp;#39;]&amp;gt;&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Now we want to get the return type of our &lt;code&gt;queryFn&lt;/code&gt; - as that&amp;#39;s the data type we&amp;#39;re interested. So we use TypeScript&amp;#39;s &lt;code&gt;ReturnType&lt;/code&gt; for that.&lt;/p&gt;&lt;pre class="prettyprint ts"&gt;&lt;code class="lang-ts"&gt;ReturnType&amp;lt;NonNullable&amp;lt;Extract&amp;lt;TQueries[ArrayElement], UseQueryOptions&amp;gt;[&amp;#39;queryFn&amp;#39;]&amp;gt;&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Here we&amp;#39;re using &lt;a href="https://devblogs.microsoft.com/typescript/announcing-typescript-4-1/#recursive-conditional-types"&gt;TypeScript 4.1&amp;#39;s recursive conditional types&lt;/a&gt; to unwrap a &lt;code&gt;Promise&lt;/code&gt; (or not) to the relevant type. This allows us to get the actual type we&amp;#39;re interested in, as opposed to the &lt;code&gt;Promise&lt;/code&gt; of that type.  Finally we have the type we need!  So we can do this:&lt;/p&gt;&lt;pre class="prettyprint ts"&gt;&lt;code class="lang-ts"&gt;type Awaited&amp;lt;T&amp;gt; = T extends PromiseLike&amp;lt;infer U&amp;gt; ? Awaited&amp;lt;U&amp;gt; : T;&lt;br /&gt;&lt;br /&gt;Awaited&amp;lt;ReturnType&amp;lt;NonNullable&amp;lt;Extract&amp;lt;TQueries[ArrayElement], UseQueryOptions&amp;gt;[&amp;#39;queryFn&amp;#39;]&amp;gt;&amp;gt;&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;It&amp;#39;s at this point where we reach a conditional type in our type definition.  Essentially, we have two different typing behaviours in play:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;Where we&amp;#39;re inferring the return type of the query&lt;/li&gt;&lt;li&gt;Where we&amp;#39;re inferring the return type of a &lt;code&gt;select&lt;/code&gt;.  A &lt;code&gt;select&lt;/code&gt; option can be used to transform or select a part of the data returned by the query function. It has the signature: &lt;code&gt;select: (data: TData) =&amp;gt; TSelect&lt;/code&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;We&amp;#39;ve been unpacking the first of these so far.  Now we encounter the conditional type that chooses between them:&lt;/p&gt;&lt;pre class="prettyprint ts"&gt;&lt;code class="lang-ts"&gt;    TQueries[ArrayElement] extends { select: infer TSelect }&lt;br /&gt;      ? TSelect extends (data: any) =&amp;gt; any&lt;br /&gt;        ? ReturnType&amp;lt;TSelect&amp;gt;&lt;br /&gt;        : never&lt;br /&gt;      : Awaited&amp;lt; /*...*/ &amp;gt;&lt;br /&gt;  &amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;What&amp;#39;s happening here is:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;if a query includes a &lt;code&gt;select&lt;/code&gt; option, we infer what that is and then subsequently extract the return type of the &lt;code&gt;select&lt;/code&gt;.&lt;/li&gt;&lt;li&gt;otherwise we use the query return type (as we we&amp;#39;ve previously examined)&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;Finally, whichever type we end up with, we supply that type as a parameter to &lt;code&gt;UseQueryResult&lt;/code&gt;.  And that is what is going to surface up our types to our users.&lt;/p&gt;&lt;h4 id="usage"&gt;Usage&lt;/h4&gt;&lt;p&gt;So what does using our &lt;code&gt;useQueriesTyped&lt;/code&gt; hook look like?&lt;/p&gt;&lt;p&gt;Well, supplying &lt;code&gt;queryFn&lt;/code&gt;s with different signatures looks like this:&lt;/p&gt;&lt;pre class="prettyprint ts"&gt;&lt;code class="lang-ts"&gt;const result = useQueriesTyped({ queryKey: &amp;#39;key1&amp;#39;, queryFn: () =&amp;gt; 1 }, { queryKey: &amp;#39;key2&amp;#39;, queryFn: () =&amp;gt; &amp;#39;two&amp;#39; });&lt;br /&gt;// const result: [QueryObserverResult&amp;lt;number, unknown&amp;gt;, QueryObserverResult&amp;lt;string, unknown&amp;gt;]&lt;br /&gt;&lt;br /&gt;if (result[0].data) {&lt;br /&gt;    // number&lt;br /&gt;}&lt;br /&gt;if (result[1].data) {&lt;br /&gt;    // string&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;As you can see, we&amp;#39;re being returned a &lt;code&gt;Tuple&lt;/code&gt; and the exact types are flowing through.&lt;/p&gt;&lt;p&gt;Next let&amp;#39;s look at a &lt;code&gt;.map&lt;/code&gt; example with identical types in our supplied array:&lt;/p&gt;&lt;pre class="prettyprint ts"&gt;&lt;code class="lang-ts"&gt;const resultWithAllTheSameTypes = useQueriesTyped(...[1, 2].map((x) =&amp;gt; ({ queryKey: `${x}`, queryFn: () =&amp;gt; x })));&lt;br /&gt;// const resultWithAllTheSameTypes: QueryObserverResult&amp;lt;number, unknown&amp;gt;[]&lt;br /&gt;&lt;br /&gt;if (resultWithAllTheSameTypes[0].data) {&lt;br /&gt;    // number&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The return type of &lt;code&gt;number&lt;/code&gt; is flowing through for each element.&lt;/p&gt;&lt;p&gt;Finally let&amp;#39;s look at how &lt;code&gt;.map&lt;/code&gt; handles arrays with different types of elements:&lt;/p&gt;&lt;pre class="prettyprint ts"&gt;&lt;code class="lang-ts"&gt;const resultWithDifferentTypes = useQueriesTyped(&lt;br /&gt;    ...[1, &amp;#39;two&amp;#39;, new Date()].map((x) =&amp;gt; ({ queryKey: `${x}`, queryFn: () =&amp;gt; x }))&lt;br /&gt;);&lt;br /&gt;//const resultWithDifferentTypes: QueryObserverResult&amp;lt;string | number | Date, unknown&amp;gt;[]&lt;br /&gt;&lt;br /&gt;if (resultWithDifferentTypes[0].data) {&lt;br /&gt;    // string | number | Date&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;if (resultWithDifferentTypes[1].data) {&lt;br /&gt;    // string | number | Date&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;if (resultWithDifferentTypes[2].data) {&lt;br /&gt;    // string | number | Date&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Admittedly this last example is a somewhat unlikely scenario. But again we can see the types flowing through - though further narrowing would be required here to get to the exact type.&lt;/p&gt;&lt;h4 id="in-the-box-"&gt;In the box?&lt;/h4&gt;&lt;p&gt;It&amp;#39;s great that we can wrap &lt;code&gt;useQueries&lt;/code&gt; to get a strongly typed experience.  It would be tremendous if this functionality was available by default.  &lt;a href="https://github.com/tannerlinsley/react-query/pull/1527"&gt;There&amp;#39;s a discussion going on around this&lt;/a&gt;.  It&amp;#39;s possible that this wrapper may no longer need to exist, and that would be amazing.  In the meantime; enjoy!&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7132129819922128441'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7132129819922128441'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2021/01/strongly-typing-react-query-s-usequeries.html' title='Strongly typing &lt;code&gt;react-query&lt;/code&gt;s &lt;code&gt;useQueries&lt;/code&gt;'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4299131020037941763</id><published>2021-01-02T17:58:00.001Z</published><updated>2021-01-03T08:21:39.216Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='CRACO'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='TypeScript'/><category scheme='http://www.blogger.com/atom/ns#' term='create react app'/><category scheme='http://www.blogger.com/atom/ns#' term='fork-ts-checker-webpack-plugin'/><category scheme='http://www.blogger.com/atom/ns#' term='ts-loader'/><title type='text'>Create React App with ts-loader and CRACO</title><content type='html'>&lt;p&gt;&lt;a href="https://create-react-app.dev/"&gt;Create React App&lt;/a&gt; is a fantastic way to get up and running building a web app with React.  It also supports using TypeScript with React.  Simply entering the following:&lt;/p&gt;&lt;pre&gt;&lt;code class="lang-shell"&gt;npx create-react-app my-app --template typescript&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Will give you a great TypeScript React project to get building with. There&amp;#39;s two parts to the TypeScript support that exist:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;Transpilation AKA &amp;quot;turning our TypeScript into JavaScript&amp;quot;.  Back since &lt;a href="https://devblogs.microsoft.com/typescript/typescript-and-babel-7/"&gt;Babel 7 launched, Babel has enjoyed great support for transpiling TypeScript into JavaScript&lt;/a&gt;.  Create React App leverages this; using the Babel webpack loader, &lt;a href="https://github.com/babel/babel-loader"&gt;babel-loader&lt;/a&gt;, for transpilation.&lt;/li&gt;&lt;li&gt;Type checking AKA &amp;quot;seeing if our code compiles&amp;quot;.  Create React App uses the &lt;a href="https://github.com/TypeStrong/fork-ts-checker-webpack-plugin"&gt;&lt;code&gt;fork-ts-checker-webpack-plugin&lt;/code&gt;&lt;/a&gt; to run the TypeScript type checker on a separate process and report any issues that may exist.&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;This is a great setup and works very well for the majority of use cases.  However, what if we&amp;#39;d like to tweak this setup? What if we&amp;#39;d like to swap out &lt;code&gt;babel-loader&lt;/code&gt; for &lt;code&gt;ts-loader&lt;/code&gt; for compilation purposes?  Can we do that?  &lt;/p&gt;&lt;p&gt;Yes you can!  And that&amp;#39;s what we&amp;#39;re going to do using a tool named &lt;a href="https://github.com/gsoft-inc/craco"&gt;&lt;code&gt;CRACO&lt;/code&gt;&lt;/a&gt; - the pithy shortening of &amp;quot;Create React App Configuration Override&amp;quot;.  This is a tool that allows us to:&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;Get all the benefits of create-react-app and customization without using &amp;#39;eject&amp;#39; by adding a single &lt;code&gt;craco.config.js&lt;/code&gt; file at the root of your application and customize your eslint, babel, postcss configurations and many more.&lt;/p&gt;&lt;/blockquote&gt;&lt;h4 id="babel-loader-ts-loader"&gt;&lt;del&gt;&lt;code&gt;babel-loader&lt;/code&gt;&lt;/del&gt; &lt;code&gt;ts-loader&lt;/code&gt;&lt;/h4&gt;&lt;p&gt;So let&amp;#39;s do the swap.  First of all we&amp;#39;re going to need to add &lt;code&gt;CRACO&lt;/code&gt; and &lt;code&gt;ts-loader&lt;/code&gt; to our project:&lt;/p&gt;&lt;pre&gt;&lt;code class="lang-shell"&gt;npm install @craco/craco ts-loader --save-dev&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Then we&amp;#39;ll swap over our various &lt;code&gt;scripts&lt;/code&gt; in our &lt;code&gt;package.json&lt;/code&gt; to use &lt;code&gt;CRACO&lt;/code&gt;:&lt;/p&gt;&lt;pre class="prettyprint json"&gt;&lt;code class="lang-json"&gt;        &amp;quot;start&amp;quot;: &amp;quot;craco start&amp;quot;,&lt;br /&gt;        &amp;quot;build&amp;quot;: &amp;quot;craco build&amp;quot;,&lt;br /&gt;        &amp;quot;test&amp;quot;: &amp;quot;craco test&amp;quot;,&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Finally we&amp;#39;ll add a &lt;code&gt;craco.config.js&lt;/code&gt; file to the root of our project.  This is where we swap out &lt;code&gt;babel-loader&lt;/code&gt; for &lt;code&gt;ts-loader&lt;/code&gt;:&lt;/p&gt;&lt;pre class="prettyprint js"&gt;&lt;code class="lang-js"&gt;const { addAfterLoader, removeLoaders, loaderByName, getLoaders, throwUnexpectedConfigError } = require(&amp;#39;@craco/craco&amp;#39;);&lt;br /&gt;&lt;br /&gt;const throwError = (message) =&amp;gt;&lt;br /&gt;    throwUnexpectedConfigError({&lt;br /&gt;        packageName: &amp;#39;craco&amp;#39;,&lt;br /&gt;        githubRepo: &amp;#39;gsoft-inc/craco&amp;#39;,&lt;br /&gt;        message,&lt;br /&gt;        githubIssueQuery: &amp;#39;webpack&amp;#39;,&lt;br /&gt;    });&lt;br /&gt;&lt;br /&gt;module.exports = {&lt;br /&gt;    webpack: {&lt;br /&gt;        configure: (webpackConfig, { paths }) =&amp;gt; {&lt;br /&gt;            const { hasFoundAny, matches } = getLoaders(webpackConfig, loaderByName(&amp;#39;babel-loader&amp;#39;));&lt;br /&gt;            if (!hasFoundAny) throwError(&amp;#39;failed to find babel-loader&amp;#39;);&lt;br /&gt;&lt;br /&gt;            console.log(&amp;#39;removing babel-loader&amp;#39;);&lt;br /&gt;            const { hasRemovedAny, removedCount } = removeLoaders(webpackConfig, loaderByName(&amp;#39;babel-loader&amp;#39;));&lt;br /&gt;            if (!hasRemovedAny) throwError(&amp;#39;no babel-loader to remove&amp;#39;);&lt;br /&gt;            if (removedCount !== 2) throwError(&amp;#39;had expected to remove 2 babel loader instances&amp;#39;);&lt;br /&gt;&lt;br /&gt;            console.log(&amp;#39;adding ts-loader&amp;#39;);&lt;br /&gt;&lt;br /&gt;            const tsLoader = {&lt;br /&gt;                test: /\.(js|mjs|jsx|ts|tsx)$/,&lt;br /&gt;                include: paths.appSrc,&lt;br /&gt;                loader: require.resolve(&amp;#39;ts-loader&amp;#39;),&lt;br /&gt;                options: { transpileOnly: true },&lt;br /&gt;            };&lt;br /&gt;&lt;br /&gt;            const { isAdded: tsLoaderIsAdded } = addAfterLoader(webpackConfig, loaderByName(&amp;#39;url-loader&amp;#39;), tsLoader);&lt;br /&gt;            if (!tsLoaderIsAdded) throwError(&amp;#39;failed to add ts-loader&amp;#39;);&lt;br /&gt;            console.log(&amp;#39;added ts-loader&amp;#39;);&lt;br /&gt;&lt;br /&gt;            console.log(&amp;#39;adding non-application JS babel-loader back&amp;#39;);&lt;br /&gt;            const { isAdded: babelLoaderIsAdded } = addAfterLoader(&lt;br /&gt;                webpackConfig,&lt;br /&gt;                loaderByName(&amp;#39;ts-loader&amp;#39;),&lt;br /&gt;                matches[1].loader // babel-loader&lt;br /&gt;            );&lt;br /&gt;            if (!babelLoaderIsAdded) throwError(&amp;#39;failed to add back babel-loader for non-application JS&amp;#39;);&lt;br /&gt;            console.log(&amp;#39;added non-application JS babel-loader back&amp;#39;);&lt;br /&gt;&lt;br /&gt;            return webpackConfig;&lt;br /&gt;        },&lt;br /&gt;    },&lt;br /&gt;};&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;So what&amp;#39;s happening here?  The script looks for &lt;code&gt;babel-loader&lt;/code&gt; usages in the default Create React App config.  There will be two; one for TypeScript / JavaScript application code (we want to replace this) and one for non application JavaScript code.  I&amp;#39;m actually not too clear what non application JavaScript code there is or can be, but we&amp;#39;ll leave it in place; it may be important.&lt;/p&gt;&lt;p&gt;You cannot remove a &lt;em&gt;single&lt;/em&gt; loader using &lt;code&gt;CRACO&lt;/code&gt;, so instead we&amp;#39;ll remove both and we&amp;#39;ll add back the non application JavaScript &lt;code&gt;babel-loader&lt;/code&gt;.  We&amp;#39;ll also add &lt;code&gt;ts-loader&lt;/code&gt; with the &lt;code&gt;transpileOnly: true&lt;/code&gt; option set (to ensure &lt;code&gt;ts-loader&lt;/code&gt; doesn&amp;#39;t do type checking).&lt;/p&gt;&lt;p&gt;Now the next time we run &lt;code&gt;npm start&lt;/code&gt; we&amp;#39;ll have Create React App running using &lt;code&gt;ts-loader&lt;/code&gt; and &lt;em&gt;without&lt;/em&gt; having ejected.  If we want to adjust the options of &lt;code&gt;ts-loader&lt;/code&gt; further then we&amp;#39;re completely at liberty to do so, adjusting the &lt;code&gt;options&lt;/code&gt; in our &lt;code&gt;craco.config.js&lt;/code&gt;.&lt;/p&gt; &lt;p&gt;If you value debugging your original source code rather than the transpiled JavaScript, remember to set the &lt;code&gt;"sourceMap": true&lt;/code&gt; property in your &lt;code&gt;tsconfig.json&lt;/code&gt;.&lt;/p&gt; &lt;p&gt;Finally, if we wanted to go even further, we could remove the &lt;code&gt;fork-ts-checker-webpack-plugin&lt;/code&gt; and move &lt;code&gt;ts-loader&lt;/code&gt; to use &lt;code&gt;transpileOnly: false&lt;/code&gt; so it performs type checking also.  However, generally it may be better to stay with the setup with post outlines for performance reasons.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4299131020037941763'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4299131020037941763'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2021/01/create-react-app-with-ts-loader-and-craco.html' title='Create React App with &lt;code&gt;ts-loader&lt;/code&gt; and &lt;code&gt;CRACO&lt;/code&gt;'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2128276014758452542</id><published>2020-12-30T07:15:00.001Z</published><updated>2020-12-30T07:15:32.011Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='azure-pipelines'/><category scheme='http://www.blogger.com/atom/ns#' term='jest'/><title type='text'>Azure Pipelines meet Jest</title><content type='html'>&lt;p&gt;This post explains how to integrate the tremendous test runner &lt;a href="https://jestjs.io/"&gt;Jest&lt;/a&gt; with the continuous integration platform &lt;a href="https://azure.microsoft.com/en-gb/services/devops/pipelines/?nav=min"&gt;Azure Pipelines&lt;/a&gt;.  Perhaps we&amp;#39;re setting up a new project and we&amp;#39;ve created a new React app with &lt;a href="https://create-react-app.dev/"&gt;Create React App&lt;/a&gt;.  This ships with Jest support out of the box. How do we get that plugged into Pipelines such that:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;Tests run as part of our pipeline&lt;/li&gt;&lt;li&gt;A failing test fails the build&lt;/li&gt;&lt;li&gt;Test results are reported in Azure Pipelines UI?&lt;/li&gt;&lt;/ol&gt;&lt;h4 id="tests-run-as-part-of-our-pipeline"&gt;Tests run as part of our pipeline&lt;/h4&gt;&lt;p&gt;First of all, lets get the tests running. Crack open your &lt;code&gt;azure-pipelines.yml&lt;/code&gt; file and, in the appropriate place add the following:&lt;/p&gt;&lt;pre class="prettyprint yml"&gt;&lt;code class="lang-yml"&gt;        - task: Npm@1&lt;br /&gt;          displayName: npm run test&lt;br /&gt;          inputs:&lt;br /&gt;            command: &amp;#39;custom&amp;#39;&lt;br /&gt;            workingDir: &amp;#39;src/client-app&amp;#39;&lt;br /&gt;            customCommand: &amp;#39;run test&amp;#39;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The above will, when run, trigger a &lt;code&gt;npm run test&lt;/code&gt; in the &lt;code&gt;src/client-app&lt;/code&gt; folder of my project (it&amp;#39;s here where my React app lives). You&amp;#39;d imagine this would just work  - but life is not that simple.  This is because Jest, by default, runs in watch mode.   This is blocking and so not appropriate for CI.&lt;/p&gt;&lt;p&gt;In our &lt;code&gt;src/client-app/package.json&lt;/code&gt; let&amp;#39;s create a new script that runs the tests but &lt;em&gt;not&lt;/em&gt; in watch mode:&lt;/p&gt;&lt;pre class="prettyprint json"&gt;&lt;code class="lang-json"&gt;        &amp;quot;test:ci&amp;quot;: &amp;quot;npm run test -- --watchAll=false&amp;quot;,&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;and switch our &lt;code&gt;azure-pipelines.yml&lt;/code&gt; to use it:&lt;/p&gt;&lt;pre class="prettyprint yml"&gt;&lt;code class="lang-yml"&gt;        - task: Npm@1&lt;br /&gt;          displayName: npm run test&lt;br /&gt;          inputs:&lt;br /&gt;            command: &amp;#39;custom&amp;#39;&lt;br /&gt;            workingDir: &amp;#39;src/client-app&amp;#39;&lt;br /&gt;            customCommand: &amp;#39;run test:ci&amp;#39;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Boom!  We&amp;#39;re now running tests as part of our pipeline.  And also, failing tests will fail the build, because of Jest&amp;#39;s default behaviour of exiting with status code 1 on failed tests.&lt;/p&gt;&lt;h4 id="tests-results-are-reported-in-azure-pipelines-ui"&gt;Tests results are reported in Azure Pipelines UI&lt;/h4&gt;&lt;p&gt;Pipelines has a really nice UI for reporting test results.  If you&amp;#39;re using something like .NET then you&amp;#39;ll find that test results just magically show up there. We&amp;#39;d like that for our Jest tests as well.  And we can have it.&lt;/p&gt;&lt;p&gt;The way we achieve this is by:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;Producing test results in a format that can be subsequently processed&lt;/li&gt;&lt;li&gt;Using those test results to publish to Azure Pipelines&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;The way that you configure Jest test output is through usage of &lt;a href="https://jestjs.io/docs/en/cli#--reporters"&gt;&lt;code&gt;reporters&lt;/code&gt;&lt;/a&gt;.  However, Create React App doesn&amp;#39;t support these.  However that&amp;#39;s not an issue, as the marvellous &lt;a href="https://twitter.com/dan_abramov"&gt;Dan Abramov&lt;/a&gt; demonstrates &lt;a href="https://github.com/facebook/create-react-app/issues/2474#issuecomment-306340526"&gt;here&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;We need to install the &lt;a href="https://github.com/jest-community/jest-junit"&gt;&lt;code&gt;jest-junit&lt;/code&gt;&lt;/a&gt; package to our &lt;code&gt;client-app&lt;/code&gt;:&lt;/p&gt;&lt;pre class="prettyprint sh"&gt;&lt;code&gt;npm install jest-junit --save-dev&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;And we&amp;#39;ll tweak our &lt;code&gt;test:ci&lt;/code&gt; script to use the &lt;code&gt;jest-junit&lt;/code&gt; reporter as well:&lt;/p&gt;&lt;pre class="prettyprint json"&gt;&lt;code class="lang-json"&gt;        &amp;quot;test:ci&amp;quot;: &amp;quot;npm run test -- --watchAll=false --reporters=default --reporters=jest-junit&amp;quot;,&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;We also need to add some configuration to our &lt;code&gt;package.json&lt;/code&gt; in the form of a &lt;code&gt;jest-junit&lt;/code&gt; element:&lt;/p&gt;&lt;pre class="prettyprint json"&gt;&lt;code class="lang-json"&gt;    &amp;quot;jest-junit&amp;quot;: {&lt;br /&gt;        &amp;quot;suiteNameTemplate&amp;quot;: &amp;quot;{filepath}&amp;quot;,&lt;br /&gt;        &amp;quot;outputDirectory&amp;quot;: &amp;quot;.&amp;quot;,&lt;br /&gt;        &amp;quot;outputName&amp;quot;: &amp;quot;junit.xml&amp;quot;&lt;br /&gt;    }&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The above configuration will use the name of the test file as the suite name in the results, which should speed up the tracking down of the failing test. The other values specify where the test results should be published to, in this case the root of our &lt;code&gt;client-app&lt;/code&gt; with the filename &lt;code&gt;junit.xml&lt;/code&gt;.&lt;/p&gt;&lt;p&gt;Now our CI is producing our test results, how do we get them into Pipelines? For that we need the &lt;a href="https://docs.microsoft.com/en-us/azure/devops/pipelines/tasks/test/publish-test-results?view=azure-devops&amp;amp;tabs=trx%2Cyaml"&gt;Publish test results task&lt;/a&gt; and a new step in our &lt;code&gt;azure-pipelines.yml&lt;/code&gt; &lt;em&gt;after&lt;/em&gt; our &lt;code&gt;npm run test&lt;/code&gt; step:&lt;/p&gt;&lt;pre class="prettyprint yml"&gt;&lt;code class="lang-yml"&gt;        - task: Npm@1&lt;br /&gt;          displayName: npm run test&lt;br /&gt;          inputs:&lt;br /&gt;            command: &amp;#39;custom&amp;#39;&lt;br /&gt;            workingDir: &amp;#39;src/client-app&amp;#39;&lt;br /&gt;            customCommand: &amp;#39;run test:ci&amp;#39;&lt;br /&gt;&lt;br /&gt;        - task: PublishTestResults@2&lt;br /&gt;          displayName: &amp;#39;supply npm test results to pipelines&amp;#39;&lt;br /&gt;          condition: succeededOrFailed() # because otherwise we won&amp;#39;t know what tests failed&lt;br /&gt;          inputs:&lt;br /&gt;            testResultsFiles: &amp;#39;src/client-app/junit.xml&amp;#39;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;This will read the test results from our &lt;code&gt;src/client-app/junit.xml&lt;/code&gt; file and pump them into Pipelines.  Do note that we&amp;#39;re &lt;em&gt;always&lt;/em&gt; running this step; so if the previous step failed (as it would in the case of a failing test) we still pump out the details of what that failure was.  Like so:&lt;/p&gt; &lt;div class="separator" style="clear: both;"&gt;&lt;a href="https://1.bp.blogspot.com/-WdPl_yOaIgk/X-woSEpy3HI/AAAAAAAAYxs/Xu3sKpop0vIHwh6JpO51al7fr2XixkHkQCLcBGAsYHQ/s0/test-and-publish-steps.png" style="display: block; padding: 1em 0; text-align: center; "&gt;&lt;img alt="" border="0" data-original-height="136" data-original-width="592" src="https://1.bp.blogspot.com/-WdPl_yOaIgk/X-woSEpy3HI/AAAAAAAAYxs/Xu3sKpop0vIHwh6JpO51al7fr2XixkHkQCLcBGAsYHQ/s0/test-and-publish-steps.png"/&gt;&lt;/a&gt;&lt;/div&gt; &lt;p&gt;And that&amp;#39;s it!  Azure Pipelines and Jest integrated.&lt;/p&gt; &lt;div class="separator" style="clear: both;"&gt;&lt;a href="https://1.bp.blogspot.com/-XOP0KB_68vs/X-woeakZ_BI/AAAAAAAAYx4/AUHdc4USOEcpcv1o0ZVQ4AkZaRrmJYBsQCPcBGAYYCw/s3120/test-results.png" style="display: block; padding: 1em 0; text-align: center; "&gt;&lt;img alt="" border="0" width="600" data-original-height="798" data-original-width="3120" src="https://1.bp.blogspot.com/-XOP0KB_68vs/X-woeakZ_BI/AAAAAAAAYx4/AUHdc4USOEcpcv1o0ZVQ4AkZaRrmJYBsQCPcBGAYYCw/s600/test-results.png"/&gt;&lt;/a&gt;&lt;/div&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2128276014758452542'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2128276014758452542'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2020/12/azure-pipelines-meet-jest.html' title='Azure Pipelines meet Jest'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='https://1.bp.blogspot.com/-WdPl_yOaIgk/X-woSEpy3HI/AAAAAAAAYxs/Xu3sKpop0vIHwh6JpO51al7fr2XixkHkQCLcBGAsYHQ/s72-c/test-and-publish-steps.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2096151075675546625</id><published>2020-12-22T10:01:00.000Z</published><updated>2020-12-22T10:01:13.656Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Prettier your CSharp with dotnet-format and lint-staged</title><content type='html'>&lt;p&gt;Consistent formatting is a good thing. It makes code less confusing to newcomers and it allows whoever is working on the codebase to reliably focus on the task at hand.  Not &amp;quot;fixing curly braces because Janice messed them up with her last commit&amp;quot;. (A &lt;code&gt;git commit&lt;/code&gt; message that would be tragic in so many ways.)&lt;/p&gt;&lt;p&gt;Once you&amp;#39;ve agreed that you want to have consistent formatting, you want it to be enforced.  Enter, stage left, &lt;a href="https://prettier.io/"&gt;Prettier&lt;/a&gt;, the fantastic tool for formatting code.  It rocks; I&amp;#39;ve been using on my JavaScript / TypeScript for the longest time.  But what about C#?  Well, there is a &lt;a href="https://github.com/warrenseine/prettier-plugin-csharp"&gt;Prettier plugin for C#&lt;/a&gt;.... Sort of.  It appears to be abandoned and contains the worrying message in the &lt;code&gt;README.md&lt;/code&gt;:&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;Please note that this plugin is under active development, and might not be ready to run on production code yet. It will break your code.&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;Not a ringing endorsement.&lt;/p&gt;&lt;h4 id="dotnet-format-a-new-hope"&gt;&lt;code&gt;dotnet-format&lt;/code&gt;: a new hope&lt;/h4&gt;&lt;p&gt;&lt;a href="https://twitter.com/margaridagp"&gt;Margarida Pereira&lt;/a&gt; recently pointed me in the direction of &lt;a href="https://github.com/dotnet/format"&gt;&lt;code&gt;dotnet-format&lt;/code&gt;&lt;/a&gt; which is a formatter for .NET. It&amp;#39;s a .NET tool which:&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;is a code formatter for dotnet that applies style preferences to a project or solution. Preferences will be read from an &lt;code&gt;.editorconfig&lt;/code&gt; file, if present, otherwise a default set of preferences will be used.&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;It can be installed with:&lt;/p&gt;&lt;pre class="prettyprint sh"&gt;&lt;code class="lang-shell"&gt;dotnet tool install -g dotnet-format&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The &lt;a href="https://github.com/dotnet/format/issues/648#issuecomment-614905524"&gt;VS Code C# extension will make use of this formatter&lt;/a&gt;, you just need to set the following in your &lt;code&gt;settings.json&lt;/code&gt;:&lt;/p&gt;&lt;pre&gt;&lt;code class="lang-json"&gt;    &amp;quot;omnisharp.enableRoslynAnalyzers&amp;quot;: true,&lt;br /&gt;    &amp;quot;omnisharp.enableEditorConfigSupport&amp;quot;: true&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="customising-your-formatting"&gt;Customising your formatting&lt;/h4&gt;&lt;p&gt;If you&amp;#39;d like to deviate from the &lt;a href="https://docs.microsoft.com/en-us/dotnet/fundamentals/code-analysis/code-style-rule-options"&gt;default formatting options&lt;/a&gt; then create yourself a &lt;code&gt;.editorconfig&lt;/code&gt; file in the root of your project.  Let&amp;#39;s say you prefer more of the &lt;a href="https://en.wikipedia.org/wiki/Indentation_style#K&amp;amp;R_style"&gt;K &amp;amp; R style&lt;/a&gt; approach to braces instead of the C# default of &lt;a href="https://en.wikipedia.org/wiki/Indentation_style#Allman_style"&gt;Allman style&lt;/a&gt;. To make &lt;code&gt;dotnet-format&lt;/code&gt; use that you&amp;#39;d set the following:&lt;/p&gt;&lt;pre class="prettyprint ini"&gt;&lt;code class="lang-ini"&gt;# Remove the line below if you want to inherit .editorconfig settings from higher directories&lt;br /&gt;root = true&lt;br /&gt;&lt;br /&gt;# See https://github.com/dotnet/format/blob/master/docs/Supported-.editorconfig-options.md for reference&lt;br /&gt;[*.cs]&lt;br /&gt;csharp_new_line_before_open_brace = none&lt;br /&gt;csharp_new_line_before_catch = false&lt;br /&gt;csharp_new_line_before_else = false&lt;br /&gt;csharp_new_line_before_finally = false&lt;br /&gt;csharp_new_line_before_members_in_anonymous_types = false&lt;br /&gt;csharp_new_line_before_members_in_object_initializers = false&lt;br /&gt;csharp_new_line_between_query_expression_clauses = true&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;With this in place it&amp;#39;s K &amp;amp; R all the way baby!&lt;/p&gt;&lt;h4 id="lint-staged-integration"&gt;&lt;code&gt;lint-staged&lt;/code&gt; integration&lt;/h4&gt;&lt;p&gt;It&amp;#39;s become somewhat standard to use the marvellous &lt;a href="https://github.com/typicode/husky"&gt;&lt;code&gt;husky&lt;/code&gt;&lt;/a&gt; and &lt;a href="https://github.com/okonet/lint-staged"&gt;&lt;code&gt;lint-staged&lt;/code&gt;&lt;/a&gt; to enforce code quality.  To quote the docs:&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;Run linters against staged git files and don&amp;#39;t let  slip into your code base!&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;So, before I happened upon &lt;code&gt;dotnet-format&lt;/code&gt; I was already enforcing TypeScript / JavaScript style with the following entry in my &lt;code&gt;package.json&lt;/code&gt;:&lt;/p&gt;&lt;pre class="prettyprint json"&gt;&lt;code class="lang-json"&gt;&amp;quot;husky&amp;quot;: {&lt;br /&gt;    &amp;quot;hooks&amp;quot;: {&lt;br /&gt;        &amp;quot;pre-commit&amp;quot;: &amp;quot;lint-staged&amp;quot;&lt;br /&gt;    }&lt;br /&gt;},&lt;br /&gt;&amp;quot;lint-staged&amp;quot;: {&lt;br /&gt;    &amp;quot;*.{js,ts,tsx}&amp;quot;: &amp;quot;prettier --write&amp;quot;&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The above configuration runs Prettier against files which have been staged for commit, provided they have the suffix &lt;code&gt;.js&lt;/code&gt; or &lt;code&gt;.ts&lt;/code&gt; or &lt;code&gt;.tsx&lt;/code&gt;. How can we get &lt;code&gt;dotnet-format&lt;/code&gt; in the mix also?  Like so:&lt;/p&gt;&lt;pre class="prettyprint json"&gt;&lt;code class="lang-json"&gt;&amp;quot;husky&amp;quot;: {&lt;br /&gt;    &amp;quot;hooks&amp;quot;: {&lt;br /&gt;        &amp;quot;pre-commit&amp;quot;: &amp;quot;lint-staged --relative&amp;quot;&lt;br /&gt;    }&lt;br /&gt;},&lt;br /&gt;&amp;quot;lint-staged&amp;quot;: {&lt;br /&gt;    &amp;quot;*.cs&amp;quot;: &amp;quot;dotnet format --include&amp;quot;,&lt;br /&gt;    &amp;quot;*.{js,ts,tsx}&amp;quot;: &amp;quot;prettier --write&amp;quot;&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;We&amp;#39;ve done two things here.  First, we&amp;#39;ve changed the &lt;code&gt;lint-staged&lt;/code&gt; command to include the parameter &lt;code&gt;--relative&lt;/code&gt;.  This is because &lt;code&gt;dotnet-format&lt;/code&gt; only deals with relative paths.  Prettier is pretty flexible, so we can make this change without breaking anything.&lt;/p&gt;&lt;p&gt;Secondly we&amp;#39;ve added the &lt;code&gt;*.cs&lt;/code&gt; task of &lt;code&gt;dotnet format --include&lt;/code&gt;. This is the task that will be run on commit, when &lt;code&gt;lint-staged&lt;/code&gt; runs, it will pass a list of relative file paths to &lt;code&gt;dotnet format&lt;/code&gt;, the &lt;code&gt;--include&lt;/code&gt; accepts &lt;code&gt;a list of relative file or folder paths to include in formatting&lt;/code&gt;.  So if you&amp;#39;d staged two files it might end up executing a command like this:&lt;/p&gt;&lt;p&gt;&lt;code&gt;dotnet format --include src/server-app/Server/Controllers/UserController.cs src/server-app/Server/Controllers/WeatherForecastController.cs&lt;/code&gt;&lt;/p&gt;&lt;p&gt;By and large we don&amp;#39;t have to think about this; the important take home is that we&amp;#39;re now enforcing standardised formatting for all C# files upon commit.  Everything that goes into the codebase will be formatted in a consistent fashion.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2096151075675546625'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2096151075675546625'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2020/12/prettier-your-csharp-with-dotnet-format-and-lint-staged.html' title='Prettier your CSharp with &lt;code&gt;dotnet-format&lt;/code&gt; and &lt;code&gt;lint-staged&lt;/code&gt;'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2204077095519524273</id><published>2020-12-21T09:00:00.000Z</published><updated>2020-12-21T09:00:04.293Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>How to make Azure AD 403</title><content type='html'>&lt;p&gt;This post is about how you can customise ASP.NETs integration with Azure Active Directory to customise the behaviour that redirects unauthorized requests to the &lt;code&gt;AccessDenied&lt;/code&gt; endpoint. If you&amp;#39;re using the tremendous &lt;a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/scenario-web-app-sign-user-app-configuration?tabs=aspnetcore"&gt;Azure Active Directory for authentication with ASP.NET&lt;/a&gt; then there&amp;#39;s a good chance you&amp;#39;re using the &lt;a href="https://github.com/AzureAD/microsoft-identity-web"&gt;&lt;code&gt;Microsoft.Identity.Web&lt;/code&gt;&lt;/a&gt; library. It&amp;#39;s this that allows us to drop the following statement into the &lt;code&gt;ConfigureServices&lt;/code&gt; method of our &lt;code&gt;Startup&lt;/code&gt; class: &lt;/p&gt;&lt;pre class="prettyprint cs"&gt;&lt;code class="lang-cs"&gt;services.AddMicrosoftIdentityWebAppAuthentication(Configuration);&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Which (combined with configuration in our &lt;code&gt;appsettings.json&lt;/code&gt; files) hooks us up with Azure AD for authentication.  This is 95% awesome.  The 5% is what we&amp;#39;re here for.  Here&amp;#39;s a screenshot of the scenario that troubles us:&lt;/p&gt; &lt;div class="separator" style="clear: both;"&gt;&lt;a href="https://github.com/johnnyreilly/make-azure-ad-403/blob/main/AccessDenied.png?raw=true" style="display: block; padding: 1em 0; text-align: center; "&gt;&lt;img alt="" border="0" width="600" data-original-height="375" data-original-width="800" src="https://github.com/johnnyreilly/make-azure-ad-403/blob/main/AccessDenied.png?raw=true"/&gt;&lt;/a&gt;&lt;/div&gt; &lt;p&gt;We&amp;#39;ve made a request to &lt;code&gt;/WeatherForecast&lt;/code&gt;; a secured endpoint (a controller decorated with the &lt;code&gt;Authorize&lt;/code&gt; attribute). We&amp;#39;re authenticated; the app knows who we are.  But we&amp;#39;re not authorized / allowed to access this endpoint.  We don&amp;#39;t have permission. The HTTP specification caters directly for this scenario with &lt;a href="https://tools.ietf.org/html/rfc7231#section-6.5.3"&gt;status code &lt;code&gt;403 Forbidden&lt;/code&gt;&lt;/a&gt;:&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;The 403 (Forbidden) status code indicates that the server understood the request but refuses to authorize it.&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;However, &lt;code&gt;Microsoft.Identity.Web&lt;/code&gt; is ploughing another furrow.  Instead of returning &lt;code&gt;403&lt;/code&gt;, it&amp;#39;s returning &lt;code&gt;302 Found&lt;/code&gt; and redirecting the browser to &lt;code&gt;https://localhost:5001/Account/AccessDenied?ReturnUrl=%2FWeatherForecast&lt;/code&gt;.  Now the intentions here are &lt;em&gt;great&lt;/em&gt;.  If you wanted to implement a page in your application at that endpoint that displayed some kind of useful message it would be really useful. However, what if you want the more HTTP-y behaviour instead? In the case of a HTTP request triggered by JavaScript (typical for Single Page Applications) then this redirect isn&amp;#39;t that helpful.  JavaScript doesn&amp;#39;t really know what to do with the &lt;code&gt;302&lt;/code&gt; and whilst you could code around this, it&amp;#39;s not desirable.&lt;/p&gt;&lt;p&gt;We want &lt;code&gt;403&lt;/code&gt; - we don&amp;#39;t want &lt;code&gt;302&lt;/code&gt;.&lt;/p&gt;&lt;h4 id="give-us-403"&gt;Give us &lt;code&gt;403&lt;/code&gt;&lt;/h4&gt;&lt;p&gt;You can have this behaviour by dropping the following code after your &lt;code&gt;services.AddMicrosoftIdentityWebAppAuthentication&lt;/code&gt;:&lt;/p&gt;&lt;pre class="prettyprint cs"&gt;&lt;code class="lang-cs"&gt;services.Configure&amp;lt;CookieAuthenticationOptions&amp;gt;(CookieAuthenticationDefaults.AuthenticationScheme, options =&amp;gt;&lt;br /&gt;{&lt;br /&gt;    options.Events.OnRedirectToAccessDenied = new Func&amp;lt;RedirectContext&amp;lt;CookieAuthenticationOptions&amp;gt;, Task&amp;gt;(context =&amp;gt;&lt;br /&gt;    {&lt;br /&gt;        context.Response.StatusCode = StatusCodes.Status403Forbidden;&lt;br /&gt;        return context.Response.CompleteAsync();&lt;br /&gt;    });&lt;br /&gt;});&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;This code hijacks the redirect to AccessDenied and transforms it into a &lt;code&gt;403&lt;/code&gt; instead.  Tremendous!  What does this look like?&lt;/p&gt; &lt;div class="separator" style="clear: both;"&gt;&lt;a href="https://raw.githubusercontent.com/johnnyreilly/make-azure-ad-403/main/Forbidden.png" style="display: block; padding: 1em 0; text-align: center; "&gt;&lt;img alt="" border="0" width="600" data-original-height="375" data-original-width="800" src="https://raw.githubusercontent.com/johnnyreilly/make-azure-ad-403/main/Forbidden.png"/&gt;&lt;/a&gt;&lt;/div&gt; &lt;p&gt;This is the behaviour we want!&lt;/p&gt;&lt;h4 id="extra-customisation-bonus-points"&gt;Extra customisation bonus points&lt;/h4&gt;&lt;p&gt;You may want to have some nuance to the way you handle unauthorized requests. Because of the nature of &lt;code&gt;OnRedirectToAccessDenied&lt;/code&gt; this is entirely possible; you have complete access to the requests coming in which you can use to direct behaviour. To take a single example, let&amp;#39;s say we want to direct normal browsing behaviour (AKA humans clicking about in Chrome) which is not authorized to a given screen, otherwise provide &lt;code&gt;403&lt;/code&gt;s.  What would that look like?&lt;/p&gt;&lt;pre class="prettyprint cs"&gt;&lt;code class="lang-cs"&gt;services.Configure&amp;lt;CookieAuthenticationOptions&amp;gt;(CookieAuthenticationDefaults.AuthenticationScheme, options =&amp;gt;&lt;br /&gt;{&lt;br /&gt;    options.Events.OnRedirectToAccessDenied = new Func&amp;lt;RedirectContext&amp;lt;CookieAuthenticationOptions&amp;gt;, Task&amp;gt;(context =&amp;gt;&lt;br /&gt;    {&lt;br /&gt;        var isRequestForHtml = context.Request.Headers[&amp;quot;Accept&amp;quot;].ToString().Contains(&amp;quot;text/html&amp;quot;);&lt;br /&gt;        if (isRequestForHtml) {&lt;br /&gt;            context.Response.StatusCode = StatusCodes.Status302Found;&lt;br /&gt;            context.Response.Headers[&amp;quot;Location&amp;quot;] = &amp;quot;/unauthorized&amp;quot;;&lt;br /&gt;        }&lt;br /&gt;        else {&lt;br /&gt;            context.Response.StatusCode = StatusCodes.Status403Forbidden;&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        return context.Response.CompleteAsync();&lt;br /&gt;    });&lt;br /&gt;});&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;So above, we check the request &lt;code&gt;Accept&lt;/code&gt; headers and see if they contain &lt;code&gt;&amp;quot;text/html&amp;quot;&lt;/code&gt;; which we&amp;#39;re using as a signal that the request came from a users browsing.  (This may not be bulletproof; better suggestions gratefully received.)  If the request does contain a &lt;code&gt;&amp;quot;text/html&amp;quot;&lt;/code&gt; &lt;code&gt;Accept&lt;/code&gt; header then we redirect the client to an &lt;code&gt;/unauthorized&lt;/code&gt; screen, otherwise we return &lt;code&gt;403&lt;/code&gt; as we did before.  Super flexible and powerful!&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2204077095519524273'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2204077095519524273'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2020/12/how-to-make-azure-ad-403.html' title='How to make Azure AD 403'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5316887045297862723</id><published>2020-12-20T17:22:00.000Z</published><updated>2020-12-20T17:22:13.050Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Nullable reference types; CSharp's very own strictNullChecks</title><content type='html'>&lt;p&gt;&amp;#39;Tis the season to play with new compiler settings! I&amp;#39;m a very keen TypeScript user and have been merrily using &lt;a href="https://www.typescriptlang.org/docs/handbook/release-notes/typescript-2-0.html#--strictnullchecks"&gt;&lt;code&gt;strictNullChecks&lt;/code&gt;&lt;/a&gt; since it shipped.  I was dimly aware that C# was also getting a similar feature by the name of &lt;a href="https://docs.microsoft.com/en-us/dotnet/csharp/tutorials/nullable-reference-types"&gt;nullable reference types&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;It&amp;#39;s only now that I&amp;#39;ve got round to taking at look at this marvellous feature. I thought I&amp;#39;d share what moving to nullable reference types looked like for me; and what code changes I found myself making as a consequence.&lt;/p&gt;&lt;h4 id="turning-on-nullable-reference-types"&gt;Turning on nullable reference types&lt;/h4&gt;&lt;p&gt;To turn on nullable reference types in a C# project you should pop open the &lt;code&gt;.csproj&lt;/code&gt; file and ensure it contains a &lt;code&gt;&amp;lt;Nullable&amp;gt;enable&amp;lt;/Nullable&amp;gt;&lt;/code&gt;.  So if you had a .NET Core 3.1 codebase it might look like this:&lt;/p&gt;&lt;pre class="prettyprint xml"&gt;&lt;code class="lang-xml"&gt;  &amp;lt;PropertyGroup&amp;gt;&lt;br /&gt;    &amp;lt;TargetFramework&amp;gt;netcoreapp3.1&amp;lt;/TargetFramework&amp;gt;&lt;br /&gt;    &amp;lt;Nullable&amp;gt;enable&amp;lt;/Nullable&amp;gt;&lt;br /&gt;  &amp;lt;/PropertyGroup&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;When you compile from this point forward, possible null reference types are reported as warnings.  Consider this C#:&lt;/p&gt;&lt;pre class="prettyprint cs"&gt;&lt;code class="lang-cs"&gt;    [ApiController]&lt;br /&gt;    public class UserController : ControllerBase&lt;br /&gt;    {&lt;br /&gt;        private readonly ILogger&amp;lt;UserController&amp;gt; _logger;&lt;br /&gt;&lt;br /&gt;        public UserController(ILogger&amp;lt;UserController&amp;gt; logger)&lt;br /&gt;        {&lt;br /&gt;            _logger = logger;&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        [AllowAnonymous]&lt;br /&gt;        [HttpGet(&amp;quot;UserName&amp;quot;)]&lt;br /&gt;        public string GetUserName()&lt;br /&gt;        {&lt;br /&gt;            if (User.Identity.IsAuthenticated) {&lt;br /&gt;                _logger.LogInformation(&amp;quot;{User} is getting their username&amp;quot;, User.Identity.Name);&lt;br /&gt;                return User.Identity.Name;&lt;br /&gt;            }&lt;br /&gt;&lt;br /&gt;            _logger.LogInformation(&amp;quot;The user is not authenticated&amp;quot;);&lt;br /&gt;            return null;&lt;br /&gt;        }&lt;br /&gt;    }&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;A &lt;code&gt;dotnet build&lt;/code&gt; results in this:&lt;/p&gt;&lt;pre class="prettyprint sh"&gt;&lt;code class="lang-shell"&gt;dotnet build --configuration release&lt;br /&gt;&lt;br /&gt;Microsoft (R) Build Engine version 16.7.1+52cd83677 for .NET&lt;br /&gt;Copyright (C) Microsoft Corporation. All rights reserved.&lt;br /&gt;&lt;br /&gt;  Determining projects to restore...&lt;br /&gt;  Restored /Users/jreilly/code/app/src/server-app/Server/app.csproj (in 471 ms).&lt;br /&gt;Controllers/UserController.cs(38,24): warning CS8603: Possible null reference return. [/Users/jreilly/code/app/src/server-app/Server/app.csproj]&lt;br /&gt;Controllers/UserController.cs(42,20): warning CS8603: Possible null reference return. [/Users/jreilly/code/app/src/server-app/Server/app.csproj]&lt;br /&gt;  app -&amp;gt; /Users/jreilly/code/app/src/server-app/Server/bin/release/netcoreapp3.1/app.dll&lt;br /&gt;  app -&amp;gt; /Users/jreilly/code/app/src/server-app/Server/bin/release/netcoreapp3.1/app.Views.dll&lt;br /&gt;&lt;br /&gt;Build succeeded.&lt;br /&gt;&lt;br /&gt;Controllers/UserController.cs(38,24): warning CS8603: Possible null reference return. [/Users/jreilly/code/app/src/server-app/Server/app.csproj]&lt;br /&gt;Controllers/UserController.cs(42,20): warning CS8603: Possible null reference return. [/Users/jreilly/code/app/src/server-app/Server/app.csproj]&lt;br /&gt;    2 Warning(s)&lt;br /&gt;    0 Error(s)&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;You see the two &lt;code&gt;&amp;quot;Possible null reference return.&amp;quot;&lt;/code&gt; warnings? Bingo&lt;/p&gt;&lt;h4 id="really-make-it-hurt"&gt;Really make it hurt&lt;/h4&gt;&lt;p&gt;This is good - information is being surfaced up.  But it&amp;#39;s a warning.  I could ignore it.  I like compilers to get really up in my face and force me to make a change.  I&amp;#39;m not into warnings; I&amp;#39;m into errors.  Know what works for you.  If you&amp;#39;re similarly minded, you can upgrade nullable reference warnings to errors by tweaking the &lt;code&gt;.csproj&lt;/code&gt; a touch further.  Add yourself a &lt;code&gt;&amp;lt;WarningsAsErrors&amp;gt;nullable&amp;lt;/WarningsAsErrors&amp;gt;&lt;/code&gt; element.  So maybe your &lt;code&gt;.csproj&lt;/code&gt; now looks like this:&lt;/p&gt;&lt;pre class="prettyprint xml"&gt;&lt;code class="lang-xml"&gt;  &amp;lt;PropertyGroup&amp;gt;&lt;br /&gt;    &amp;lt;TargetFramework&amp;gt;netcoreapp3.1&amp;lt;/TargetFramework&amp;gt;&lt;br /&gt;    &amp;lt;Nullable&amp;gt;enable&amp;lt;/Nullable&amp;gt;&lt;br /&gt;    &amp;lt;WarningsAsErrors&amp;gt;nullable&amp;lt;/WarningsAsErrors&amp;gt;&lt;br /&gt;  &amp;lt;/PropertyGroup&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;And a &lt;code&gt;dotnet build&lt;/code&gt; will result in this:&lt;/p&gt;&lt;pre class="prettyprint sh"&gt;&lt;code class="lang-shell"&gt;dotnet build --configuration release&lt;br /&gt;&lt;br /&gt;Microsoft (R) Build Engine version 16.7.1+52cd83677 for .NET&lt;br /&gt;Copyright (C) Microsoft Corporation. All rights reserved.&lt;br /&gt;&lt;br /&gt;  Determining projects to restore...&lt;br /&gt;  Restored /Users/jreilly/code/app/src/server-app/Server/app.csproj (in 405 ms).&lt;br /&gt;Controllers/UserController.cs(38,24): error CS8603: Possible null reference return. [/Users/jreilly/code/app/src/server-app/Server/app.csproj]&lt;br /&gt;Controllers/UserController.cs(42,20): error CS8603: Possible null reference return. [/Users/jreilly/code/app/src/server-app/Server/app.csproj]&lt;br /&gt;&lt;br /&gt;Build FAILED.&lt;br /&gt;&lt;br /&gt;Controllers/UserController.cs(38,24): error CS8603: Possible null reference return. [/Users/jreilly/code/app/src/server-app/Server/app.csproj]&lt;br /&gt;Controllers/UserController.cs(42,20): error CS8603: Possible null reference return. [/Users/jreilly/code/app/src/server-app/Server/app.csproj]&lt;br /&gt;    0 Warning(s)&lt;br /&gt;    2 Error(s)&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Yay!  Errors!&lt;/p&gt;&lt;h4 id="what-do-they-mean-"&gt;What do they mean?&lt;/h4&gt;&lt;p&gt;"&lt;code&gt;Possible null reference return&lt;/code&gt;" isn&amp;#39;t the clearest of errors. What does that actually amount to?  Well, it amounts to the compiler saying &amp;quot;you&amp;#39;re a liar! (maybe)&amp;quot;. Let&amp;#39;s look again at the code where this error is reported:&lt;/p&gt;&lt;pre class="prettyprint cs"&gt;&lt;code class="lang-cs"&gt;        [AllowAnonymous]&lt;br /&gt;        [HttpGet(&amp;quot;UserName&amp;quot;)]&lt;br /&gt;        public string GetUserName()&lt;br /&gt;        {&lt;br /&gt;            if (User.Identity.IsAuthenticated) {&lt;br /&gt;                _logger.LogInformation(&amp;quot;{User} is getting their username&amp;quot;, User.Identity.Name);&lt;br /&gt;                return User.Identity.Name;&lt;br /&gt;            }&lt;br /&gt;&lt;br /&gt;            _logger.LogInformation(&amp;quot;The user is not authenticated&amp;quot;);&lt;br /&gt;            return null;&lt;br /&gt;        }&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;We&amp;#39;re getting that error reported where we&amp;#39;re returning &lt;code&gt;null&lt;/code&gt; and where we&amp;#39;re returning &lt;code&gt;User.Identity.Name&lt;/code&gt; which &lt;em&gt;may&lt;/em&gt; be &lt;code&gt;null&lt;/code&gt;. And we&amp;#39;re getting that because as far as the compiler is concerned &lt;code&gt;string&lt;/code&gt; has changed. Before we turned on nullable reference types the compiler considered &lt;code&gt;string&lt;/code&gt; to mean &lt;code&gt;string&lt;/code&gt; &lt;em&gt;OR&lt;/em&gt; &lt;code&gt;null&lt;/code&gt;. Now, &lt;code&gt;string&lt;/code&gt; means &lt;code&gt;string&lt;/code&gt;.&lt;/p&gt;&lt;p&gt;This is the same sort of behaviour as TypeScripts &lt;code&gt;strictNullChecks&lt;/code&gt;.  With TypeScript, before you turn on &lt;code&gt;strictNullChecks&lt;/code&gt;, as far as the compiler is concerned, &lt;code&gt;string&lt;/code&gt; means &lt;code&gt;string&lt;/code&gt; &lt;em&gt;OR&lt;/em&gt; &lt;code&gt;null&lt;/code&gt; &lt;em&gt;OR&lt;/em&gt; &lt;code&gt;undefined&lt;/code&gt; (JavaScript didn&amp;#39;t feel one null-ish value was enough and so has two - don&amp;#39;t ask).  Once &lt;code&gt;strictNullChecks&lt;/code&gt; is on, &lt;code&gt;string&lt;/code&gt; means &lt;code&gt;string&lt;/code&gt;.&lt;/p&gt;&lt;p&gt;It&amp;#39;s a lot clearer. And that&amp;#39;s why the compiler is getting antsy. The method signature is &lt;code&gt;string&lt;/code&gt;, but it can see &lt;code&gt;null&lt;/code&gt; potentially being returned.  It doesn&amp;#39;t like it.  By and large that&amp;#39;s good. We want the compiler to notice this as that&amp;#39;s the entire point.  We want to catch accidental &lt;code&gt;null&lt;/code&gt;s before they hit a user.  This is &lt;em&gt;great&lt;/em&gt;!  However, what do you do if have a method (as we do) that legitimately returns a &lt;code&gt;string&lt;/code&gt; or &lt;code&gt;null&lt;/code&gt;?&lt;/p&gt;&lt;h4 id="widening-the-type-to-include-null"&gt;Widening the type to include &lt;code&gt;null&lt;/code&gt;&lt;/h4&gt;&lt;p&gt;We change the signature from this:&lt;/p&gt;&lt;pre class="prettyprint cs"&gt;&lt;code class="lang-cs"&gt;        public string GetUserName()&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;To this:&lt;/p&gt;&lt;pre class="prettyprint cs"&gt;&lt;code class="lang-cs"&gt;        public string? GetUserName()&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;That&amp;#39;s right, the simple addition of &lt;code&gt;?&lt;/code&gt; marks a reference type (like a string) as potentially being &lt;code&gt;null&lt;/code&gt;. Adding that means that we&amp;#39;re potentially returning &lt;code&gt;null&lt;/code&gt;, but we&amp;#39;re sure about it; there&amp;#39;s intention here - it&amp;#39;s not accidental.  Wonderful!&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5316887045297862723'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5316887045297862723'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2020/12/nullable-reference-types-csharp-strictnullchecks.html' title='Nullable reference types; CSharp&amp;#39;s very own &lt;code&gt;strictNullChecks&lt;/code&gt;'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4038396998958275664</id><published>2020-12-09T05:14:00.003Z</published><updated>2020-12-09T06:34:51.333Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>azure-pipelines-task-lib and isOutput setVariable</title><content type='html'>&lt;p&gt;Some blog posts are insightful treatises on the future of web development, some are &amp;quot;here&amp;#39;s how I solved my problem&amp;quot;. This is most assuredly the latter.&lt;/p&gt;&lt;p&gt;I&amp;#39;m writing an &lt;a href="https://docs.microsoft.com/en-us/azure/devops/extend/develop/add-build-task?view=azure-devops"&gt;custom pipelines task extension for Azure Pipelines&lt;/a&gt;. It&amp;#39;s written with TypeScript and the &lt;a href="https://github.com/microsoft/azure-pipelines-task-lib"&gt;azure-pipelines-task-lib&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;The pipeline needs to output a variable. Azure Pipelines does that using the &lt;code&gt;setvariable&lt;/code&gt; command combined with &lt;a href="https://docs.microsoft.com/en-us/azure/devops/pipelines/process/variables?view=azure-devops&amp;amp;tabs=yaml%2Cbatch#set-a-multi-job-output-variable"&gt;isOutput=true&lt;/a&gt;. This looks something like this: &lt;code&gt;##vso[task.setvariable variable=myOutputVar;isOutput=true]this is the value&amp;quot;&lt;/code&gt;.&lt;/p&gt;&lt;p&gt;The bad news is that the lib &lt;a href="https://github.com/microsoft/azure-pipelines-task-lib/issues/688"&gt;doesn&amp;#39;t presently support &lt;code&gt;isOutput=true&lt;/code&gt;&lt;/a&gt;. Gosh it makes me sad. Hopefully in future it will be resolved. But what now?&lt;/p&gt;&lt;p&gt;For now we can hack ourselves a workaround:&lt;/p&gt;&lt;pre class="prettyprint ts"&gt;&lt;code class="lang-ts"&gt;import * as tl from &amp;#39;azure-pipelines-task-lib/task&amp;#39;;&lt;br /&gt;import * as tcm from &amp;#39;azure-pipelines-task-lib/taskcommand&amp;#39;;&lt;br /&gt;import * as os from &amp;#39;os&amp;#39;;&lt;br /&gt;&lt;br /&gt;/**&lt;br /&gt; * Sets a variable which will be output as well.&lt;br /&gt; *&lt;br /&gt; * @param     name    name of the variable to set&lt;br /&gt; * @param     val     value to set&lt;br /&gt; * @param     secret  whether variable is secret.  Multi-line secrets are not allowed.  Optional, defaults to false&lt;br /&gt; * @returns   void&lt;br /&gt; */&lt;br /&gt;export function setOutputVariable(name: string, val: string, secret = false): void {&lt;br /&gt;    // use the implementation of setVariable to set all the internals,&lt;br /&gt;    // then subsequently set the output variable manually&lt;br /&gt;    tl.setVariable(name, val, secret);&lt;br /&gt;&lt;br /&gt;    const varValue = val || &amp;#39;&amp;#39;;&lt;br /&gt;&lt;br /&gt;    // write the command&lt;br /&gt;    // see https://docs.microsoft.com/en-us/azure/devops/pipelines/process/variables?view=azure-devops&amp;amp;tabs=yaml%2Cbatch#set-a-multi-job-output-variable&lt;br /&gt;    _command(&lt;br /&gt;        &amp;#39;task.setvariable&amp;#39;,&lt;br /&gt;        { variable: name || &amp;#39;&amp;#39;, isOutput: &amp;#39;true&amp;#39;, issecret: (secret || false).toString() },&lt;br /&gt;        varValue&lt;br /&gt;    );&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;const _outStream = process.stdout;&lt;br /&gt;&lt;br /&gt;function _writeLine(str: string): void {&lt;br /&gt;    _outStream.write(str + os.EOL);&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;function _command(command: string, properties: any, message: string) {&lt;br /&gt;    const taskCmd = new tcm.TaskCommand(command, properties, message);&lt;br /&gt;    _writeLine(taskCmd.toString());&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The above is effectively a wrapper for the existing &lt;a href="https://github.com/microsoft/azure-pipelines-task-lib/blob/90e9cde0e509cba77185a80ef3af2fc898fb026c/node/task.ts#L162"&gt;&lt;code&gt;setVariable&lt;/code&gt;&lt;/a&gt;. However, once it&amp;#39;s called into the initial implementation, &lt;code&gt;setOutputVariable&lt;/code&gt; then writes out the same variable once more, but this time bolting on &lt;code&gt;isOutput=true&lt;/code&gt;.&lt;/p&gt;&lt;p&gt;Finally, I've raised a PR to see if &lt;code&gt;isOutput&lt;/code&gt; can be added directly to the library.  &lt;a href="https://github.com/microsoft/azure-pipelines-task-lib/pull/691"&gt;You can track progress on that here.&lt;/a&gt;&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4038396998958275664'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4038396998958275664'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2020/12/azure-pipelines-task-lib-and-isoutput-setvariable.html' title='&lt;code&gt;azure-pipelines-task-lib&lt;/code&gt; and &lt;code&gt;isOutput&lt;/code&gt; &lt;code&gt;setVariable&lt;/code&gt;'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8635683172707895262</id><published>2020-11-28T15:37:00.001Z</published><updated>2020-11-28T15:47:57.912Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Images in MarkDown for the Azure DevOps Marketplace!</title><content type='html'>&lt;p&gt;I&amp;#39;ve recently found myself developing &lt;a href="https://docs.microsoft.com/en-us/azure/devops/extend/develop/add-build-task?view=azure-devops"&gt;custom pipelines task extensions for Azure DevOps&lt;/a&gt;. The extensions being developed end up in the &lt;a href="https://marketplace.visualstudio.com/azuredevops"&gt;Azure DevOps Marketplace&lt;/a&gt;. What you see there when you look at existing extensions is some pretty lovely documentation.&lt;/p&gt; &lt;div class="separator" style="clear: both;"&gt;&lt;a href="https://1.bp.blogspot.com/-YjTvZKSW0rU/X8Jshi3AN8I/AAAAAAAAYeQ/gSmekY_tvv0aHXGS_hSNmHVKO32ROGR0ACPcBGAYYCw/s2048/azure-devops-marketplace.png" style="display: block; padding: 1em 0; text-align: center; "&gt;&lt;img alt="" border="0" width="600" data-original-height="1410" data-original-width="2048" src="https://1.bp.blogspot.com/-YjTvZKSW0rU/X8Jshi3AN8I/AAAAAAAAYeQ/gSmekY_tvv0aHXGS_hSNmHVKO32ROGR0ACPcBGAYYCw/s600/azure-devops-marketplace.png"/&gt;&lt;/a&gt;&lt;/div&gt; &lt;h4 id="how-can-my-tasks-look-as-lovely-"&gt;How can our tasks look as lovely?&lt;/h4&gt;&lt;p&gt;That, my friends, is the question to answer. Good documentation is key to success. Here&amp;#39;s the ask: when a custom task is installed it becomes available in the marketplace, we want it to:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;contain documentation&lt;/li&gt;&lt;li&gt;that documentation should support images... For a picture, famously, speaks a thousand words&lt;/li&gt;&lt;/ul&gt;&lt;h4 id="mark-down-my-manifest"&gt;Mark(Down) our manifest&lt;/h4&gt;&lt;p&gt;To get documentation showing up in the marketplace, we need to take a look at the &lt;code&gt;vss-extension.json&lt;/code&gt; file which lies at the root of our extension folder. It&amp;#39;s a kind of manifest file and is documented &lt;a href="https://docs.microsoft.com/en-us/azure/devops/extend/develop/manifest?view=azure-devops"&gt;here&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;&lt;a href="https://docs.microsoft.com/en-us/azure/devops/extend/develop/manifest?view=azure-devops#discovery-attributes"&gt;Tucked away in the docs, you&amp;#39;ll find mention of a &lt;code&gt;content&lt;/code&gt; property and the words:&lt;/a&gt;&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;Dictionary of content files that describe your extension to users...&lt;br&gt;Each file is assumed to be in &lt;a href="https://help.github.com/articles/github-flavored-markdown/"&gt;GitHub Flavored Markdown format&lt;/a&gt;.  The path of each item is the path to the markdown file in the extension. Valid keys: &lt;code&gt;details&lt;/code&gt;.&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;This means we can have a MarkDown file in our repo which documents our task. To stay consistent with most projects, a solid choice is to use the &lt;code&gt;README.md&lt;/code&gt; that sits in the root of the project to this end.&lt;/p&gt;&lt;p&gt;So the simple addition of this:&lt;/p&gt;&lt;pre class="prettyprint json"&gt;&lt;code class="lang-json"&gt;{&lt;br /&gt;    //...&lt;br /&gt;    &amp;quot;content&amp;quot;: {&lt;br /&gt;        &amp;quot;details&amp;quot;: {&lt;br /&gt;            &amp;quot;path&amp;quot;: &amp;quot;README.md&amp;quot;&lt;br /&gt;        }&lt;br /&gt;    },&lt;br /&gt;    //...&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Gives us documentation in the marketplace. Yay!&lt;/p&gt;&lt;h4 id="images"&gt;Now the images...&lt;/h4&gt;&lt;p&gt;If we are referencing images in our &lt;code&gt;README.md&lt;/code&gt; then, as it stands right now, they won&amp;#39;t show up in the marketplace. It&amp;#39;ll be broken link city. Imagine some MarkDown like this:&lt;/p&gt;&lt;pre&gt;&lt;code class="lang-md"&gt;![alt text](images/screenshot.png)&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;This is entirely correct and supported, but won&amp;#39;t work by default. This is because these images need to be specified in the &lt;a href="https://docs.microsoft.com/en-us/azure/devops/extend/develop/manifest?view=azure-devops#files"&gt;&lt;code&gt;files&lt;/code&gt; property&lt;/a&gt; of the &lt;code&gt;vss-extension.json&lt;/code&gt;.&lt;/p&gt;&lt;pre class="prettyprint json"&gt;&lt;code class="lang-json"&gt;{&lt;br /&gt;    //...&lt;br /&gt;    &amp;quot;content&amp;quot;: {&lt;br /&gt;        &amp;quot;details&amp;quot;: {&lt;br /&gt;            &amp;quot;path&amp;quot;: &amp;quot;README.md&amp;quot;&lt;br /&gt;        }&lt;br /&gt;    },&lt;br /&gt;    &amp;quot;files&amp;quot;: [&lt;br /&gt;        {&lt;br /&gt;            &amp;quot;path&amp;quot;: &amp;quot;images&amp;quot;,&lt;br /&gt;            &amp;quot;addressable&amp;quot;: true&lt;br /&gt;        }&lt;br /&gt;    ]&lt;br /&gt;    //...&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Consider the above; the &lt;code&gt;path&lt;/code&gt; of &lt;code&gt;images&lt;/code&gt; includes everything inside the &lt;code&gt;images&lt;/code&gt; folder in the task. However, it&amp;#39;s crucial that the &lt;a href="https://docs.microsoft.com/en-us/azure/devops/extend/develop/manifest?view=azure-devops#properties-1"&gt;&lt;code&gt;&amp;quot;addressable&amp;quot;: true&lt;/code&gt;&lt;/a&gt; is present as well. It&amp;#39;s this that makes the files in this &lt;code&gt;path&lt;/code&gt; URL-addressable. And without that, the images won&amp;#39;t be displayed.&lt;/p&gt;&lt;p&gt;That&amp;#39;s it! We&amp;#39;re done!  We can have rich, image inclusive, documentation in our custom tasks.&lt;/p&gt;&lt;p&gt;A final note: it&amp;#39;s possible to specify individual files rather than whole paths in the &lt;code&gt;files&lt;/code&gt; directory and you might want to do that if you&amp;#39;re being very careful around file size.  There is a maximum size for a custom task and it&amp;#39;s easy to breach it.  But by and large I find that &amp;quot;allowlisting&amp;quot; a single directory is easier.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8635683172707895262'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8635683172707895262'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2020/11/images-in-markdown-for-azure-devops-marketplace.html' title='Images in MarkDown for the Azure DevOps Marketplace!'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='https://1.bp.blogspot.com/-YjTvZKSW0rU/X8Jshi3AN8I/AAAAAAAAYeQ/gSmekY_tvv0aHXGS_hSNmHVKO32ROGR0ACPcBGAYYCw/s72-c/azure-devops-marketplace.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1295748291297094950</id><published>2020-11-14T10:05:00.000Z</published><updated>2020-11-14T10:05:11.643Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Bulletproof uniq with TypeScript generics (yay code reviews!)</title><content type='html'>&lt;p&gt;Never neglect the possibilities of a code review. There are times when you raise a PR and all you want is for everyone to hit approve so you can merge, merge and ship, ship!  This can be a missed opportunity.  For as much as I&amp;#39;d like to imagine my code is perfect, it&amp;#39;s patently not.  There&amp;#39;s always scope for improvement.&lt;/p&gt;&lt;h4 id="what-s-this-"&gt;&amp;quot;What&amp;#39;s this?&amp;quot;&lt;/h4&gt;&lt;p&gt;This week afforded me that opportunity. I was walking through a somewhat complicated PR on a call and someone said &amp;quot;what&amp;#39;s this?&amp;quot;.  They&amp;#39;d spotted an expression much like this in my code:&lt;/p&gt;&lt;pre class="prettyprint ts"&gt;&lt;code class="lang-ts"&gt;const myValues = [...new Set(allTheValuesSupplied)];&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;What is that? Well, it&amp;#39;s a number of things:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set#Remove_duplicate_elements_from_the_array"&gt;It&amp;#39;s a way to get the unique values in a collection.&lt;/a&gt;&lt;/li&gt;&lt;li&gt;It&amp;#39;s a pro-tip and a coding BMX trick.&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;What do I mean?  Well, this is indeed a technique for getting the unique values in a collection. But it relies upon you knowing a bunch of things:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set"&gt;&lt;code&gt;Set&lt;/code&gt;&lt;/a&gt; contains unique values. If you add multiple identical values, only a single value will be stored.&lt;/li&gt;&lt;li&gt;The &lt;a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set/Set"&gt;&lt;code&gt;Set&lt;/code&gt; constructor&lt;/a&gt; takes &lt;a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Iteration_protocols#The_iterable_protocol"&gt;iterable objects&lt;/a&gt;. This means we can &lt;code&gt;new&lt;/code&gt; up a &lt;code&gt;Set&lt;/code&gt; with an array that we want to &amp;quot;unique-ify&amp;quot; and we will have a &lt;code&gt;Set&lt;/code&gt; that contains those unique values.&lt;/li&gt;&lt;li&gt;If you want to go on to do filtering / mapping etc on your unique values, you&amp;#39;ll need to get them out of the &lt;code&gt;Set&lt;/code&gt;.  This is because (regrettably) ECMAScript iterables don&amp;#39;t implicitly support these operations and neither are methods such as these part of the &lt;code&gt;Set&lt;/code&gt; API.  The easiest way to do that is to &lt;a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Spread_syntax"&gt;spread&lt;/a&gt; into a new array which you can then operate upon. &lt;/li&gt;&lt;/ul&gt;&lt;p&gt;I have this knowledge.  Lots of people have this knowledge.  But whilst this may be the case, using this technique goes against what I would generally consider to be a good tenet of programming: comprehensibility.  When you read this code above, it doesn&amp;#39;t immediately tell you what it&amp;#39;s doing.  This is a strike against it.&lt;/p&gt;&lt;p&gt;Further to that, it&amp;#39;s &amp;quot;noisy&amp;quot;.  Even if the reader does have this knowledge, as they digest the code, they have to mentally unravel it.  &amp;quot;Oh it&amp;#39;s a &lt;code&gt;Set&lt;/code&gt;, we&amp;#39;re passing in values, then spreading it out, it&amp;#39;s probably intended to get the unique values.... Right, cool, cool.... Continue!&amp;quot;&lt;/p&gt; &lt;div style="width:100%;height:0;padding-bottom:56%;position:relative;"&gt;&lt;iframe src="https://giphy.com/embed/4NnSe87mg3h25JYIDh" width="100%" height="100%" style="position:absolute" frameBorder="0" class="giphy-embed" allowFullScreen&gt;&lt;/iframe&gt;&lt;/div&gt;&lt;p&gt;&lt;/p&gt; &lt;p&gt;&lt;a href="https://twitter.com/margaridagp"&gt;Margarida Pereira&lt;/a&gt; explicitly called this out and I found myself agreeing. Let&amp;#39;s make a &lt;code&gt;uniq&lt;/code&gt; function!&lt;/p&gt;&lt;h4 id="uniq-v1"&gt;&lt;code&gt;uniq&lt;/code&gt; v1&lt;/h4&gt;&lt;p&gt;I wrote a very simple &lt;code&gt;uniq&lt;/code&gt; function which looked like this:&lt;/p&gt;&lt;pre class="prettyprint ts"&gt;&lt;code class="lang-ts"&gt;/**&lt;br /&gt; * Return the unique values found in the passed iterable&lt;br /&gt; */&lt;br /&gt;function uniq&amp;lt;TElement&amp;gt;(iterableToGetUniqueValuesOf: Iterable&amp;lt;TElement&amp;gt;) {&lt;br /&gt;    return [...new Set(iterableToGetUniqueValuesOf)];&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Usage of this was simple:&lt;/p&gt;&lt;pre class="prettyprint ts"&gt;&lt;code class="lang-ts"&gt;uniq([1,1,1,3,1,1,2]) // produces [1, 3, 2]&lt;br /&gt;uniq([&amp;quot;John&amp;quot;, &amp;quot;Guida&amp;quot;, &amp;quot;Ollie&amp;quot;, &amp;quot;Divya&amp;quot;, &amp;quot;John&amp;quot;]) // produces [&amp;quot;John&amp;quot;, &amp;quot;Guida&amp;quot;, &amp;quot;Ollie&amp;quot;, &amp;quot;Divya&amp;quot;]&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;And I thought this was tremendous. I committed and pushed. I assumed there was no more to be done. Guida (Margarida) then made this very helpful comment:&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;BTW, I found a big bold warning that &lt;code&gt;new Set()&lt;/code&gt; compares objects by reference (unless they&amp;#39;re primitives) so it might be worth adding a comment to warn people that uniq/distinct compares objects by reference:&lt;br /&gt;&lt;a href="https://codeburst.io/javascript-array-distinct-5edc93501dc4"&gt;https://codeburst.io/javascript-array-distinct-5edc93501dc4&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;She was right! If a caller was to, say, pass a collection of objects to &lt;code&gt;uniq&lt;/code&gt; then they&amp;#39;d end up highly disappointed. Consider:&lt;/p&gt;&lt;pre class="prettyprint ts"&gt;&lt;code class="lang-ts"&gt;uniq([{ name: &amp;quot;John&amp;quot; }, { name: &amp;quot;John&amp;quot; }]) // produces [{ name: &amp;quot;John&amp;quot; }, { name: &amp;quot;John&amp;quot; }]&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;We can do better!&lt;/p&gt;&lt;h4 id="uniq-v2"&gt;&lt;code&gt;uniq&lt;/code&gt; v2&lt;/h4&gt;&lt;p&gt;I like compilers shouting at me.  Or more accurately, I like compilers telling me when something isn&amp;#39;t valid / supported / correct. I wanted &lt;code&gt;uniq&lt;/code&gt; to mirror the behaviour of &lt;code&gt;Set&lt;/code&gt; - to only support primitives such as &lt;code&gt;string&lt;/code&gt;, &lt;code&gt;number&lt;/code&gt; etc.  So I made a new version of &lt;code&gt;uniq&lt;/code&gt; that hardened up the generic contraints:&lt;/p&gt;&lt;pre class="prettyprint ts"&gt;&lt;code class="lang-ts"&gt;/**&lt;br /&gt; * Return the unique values found in the passed iterable&lt;br /&gt; */&lt;br /&gt;function uniq&amp;lt;TElement extends string | number | bigint | boolean | symbol&amp;gt;(&lt;br /&gt;    iterableToGetUniqueValuesOf: Iterable&amp;lt;TElement&amp;gt;&lt;br /&gt;) {&lt;br /&gt;    return [...new Set(iterableToGetUniqueValuesOf)];&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;With this in place, the compiler started shouting in the most helpful way.  When I re-attemped &lt;code&gt;[{ name: &amp;quot;John&amp;quot; }, { name: &amp;quot;John&amp;quot; }]&lt;/code&gt; the compiler hit me with:&lt;/p&gt;&lt;p&gt;&lt;code&gt;Argument of type &amp;#39;{ name: string; }[]&amp;#39; is not assignable to parameter of type &amp;#39;Iterable&amp;lt;string | number | bigint | boolean | symbol&amp;gt;&amp;#39;.&lt;/code&gt;&lt;/p&gt;&lt;p&gt;&lt;a href="https://www.typescriptlang.org/play?#code/FAYw9gdgzmA2CmA6WYDmAKArhAlgR3QG0BvAAggEMBbeALlICIApMACwgdIF8AaUsyjXrM2HbgF0AlJNCQYCZGiy4ChEewZ91HKTOAB6AFSHgpQ6QBK8AC6YAThFLXW8UtnyZXANwqxPUUgAzMGwAE1IcR2dXAAcKKCh4cJxreDsKACMEU0N9YEDsEGscSDcVAB4AFQBRBBoIa1J4AA9UiFCAqGs7SNRSAB9yTCoMtIHSDJxUSMbBjLA4eApHQagATxG4AD50U1J9lLTMhEqwAHEbAFUVTwA1X38AeUD6AElU9Kz4Ktr4eustsBJPw9vs7DZ7I5CIgYRB4AB3UgAZRs6EOnxO5yuN3g9z88Cgz0k4gA3MAuMAgA"&gt;Take a look.&lt;/a&gt;&lt;/p&gt;&lt;p&gt;This is good. This is descriptive code that only allows legitimate inputs.  It should lead to less confusion and a reduced likelihood of issues in Production. It&amp;#39;s also a nice example of how code review can result in demonstrably better code. Thanks Guida!&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1295748291297094950'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1295748291297094950'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2020/11/bulletproof-uniq-with-typescript.html' title='Bulletproof uniq with TypeScript generics (yay code reviews!)'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-7479463423921486801</id><published>2020-11-10T19:02:00.002Z</published><updated>2020-11-10T19:02:37.053Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Throttling data requests with React Hooks</title><content type='html'>&lt;p&gt;When an application loads data, typically relatively few HTTP requests will be made.  For example, if we imagine we&amp;#39;re making a student administration application, then a &amp;quot;view&amp;quot; screen might make a single HTTP request to load that student&amp;#39;s data before displaying it.&lt;/p&gt;&lt;p&gt;Occasionally there&amp;#39;s a need for an application to make a large number of HTTP requests.  Consider a reporting application which loads data and then aggregates it for presentation purposes.&lt;/p&gt;&lt;p&gt;This need presents two interesting problems to solve:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;how do we load data gradually?&lt;/li&gt;&lt;li&gt;how do we present loading progress to users?&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;This post will talk about how we can tackle these and demonstrate using a custom React Hook.&lt;/p&gt;&lt;h4 id="let-s-bring-chrome-to-its-knees"&gt;Let&amp;#39;s bring Chrome to its knees&lt;/h4&gt;&lt;p&gt;We&amp;#39;ll begin our journey by spinning up a TypeScript React app with &lt;a href="https://create-react-app.dev/"&gt;Create React App&lt;/a&gt;:&lt;/p&gt;&lt;pre class="prettyprint shell"&gt;&lt;code class="lang-shell"&gt;npx create-react-app throttle-requests-react-hook --template typescript&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Because we&amp;#39;re going to be making a number of asynchronous calls, we&amp;#39;re going to simplify the code by leaning on the widely used &lt;a href="https://github.com/streamich/react-use"&gt;&lt;code&gt;react-use&lt;/code&gt;&lt;/a&gt; for a &lt;a href="https://github.com/streamich/react-use/blob/master/docs/useAsync.md"&gt;&lt;code&gt;useAsync&lt;/code&gt;&lt;/a&gt; hook.&lt;/p&gt;&lt;pre class="prettyprint shell"&gt;&lt;code class="lang-shell"&gt;cd throttle-requests-react-hook&lt;br /&gt;yarn add react-use&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;We&amp;#39;ll replace the &lt;code&gt;App.css&lt;/code&gt; file with this:&lt;/p&gt;&lt;pre class="prettyprint css"&gt;&lt;code class="lang-css"&gt;.App {&lt;br /&gt;  text-align: center;&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;.App-header {&lt;br /&gt;  background-color: #282c34;&lt;br /&gt;  min-height: 100vh;&lt;br /&gt;  display: flex;&lt;br /&gt;  flex-direction: column;&lt;br /&gt;  align-items: center;&lt;br /&gt;  justify-content: center;&lt;br /&gt;  font-size: calc(10px + 2vmin);&lt;br /&gt;  color: white;&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;.App-labelinput &amp;gt; * {&lt;br /&gt;  margin: 0.5em;&lt;br /&gt;  font-size:24px;&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;.App-link {&lt;br /&gt;  color: #61dafb;&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;.App-button {&lt;br /&gt;  font-size: calc(10px + 2vmin);&lt;br /&gt;  margin-top: 0.5em;&lt;br /&gt;  padding: 1em;&lt;br /&gt;  background-color: cornflowerblue;&lt;br /&gt;  color: #ffffff;&lt;br /&gt;  text-align: center;&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;.App-progress {&lt;br /&gt;  padding: 1em;&lt;br /&gt;  background-color: cadetblue;&lt;br /&gt;  color: #ffffff;&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;.App-results {&lt;br /&gt;  display: flex;&lt;br /&gt;  flex-wrap: wrap;&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;.App-results &amp;gt; * {&lt;br /&gt;  padding: 1em;&lt;br /&gt;  margin: 0.5em;&lt;br /&gt;  background-color: darkblue;&lt;br /&gt;  flex: 1 1 300px;&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Then we&amp;#39;ll replace the &lt;code&gt;App.tsx&lt;/code&gt; contents with this:&lt;/p&gt;&lt;pre class="prettyprint tsx"&gt;&lt;code class="lang-tsx"&gt;import React, { useState } from &amp;quot;react&amp;quot;;&lt;br /&gt;import { useAsync } from &amp;quot;react-use&amp;quot;;&lt;br /&gt;import &amp;quot;./App.css&amp;quot;;&lt;br /&gt;&lt;br /&gt;function use10_000Requests(startedAt: string) {&lt;br /&gt;  const responses = useAsync(async () =&amp;gt; {&lt;br /&gt;    if (!startedAt) return;&lt;br /&gt;&lt;br /&gt;    // make 10,000 unique HTTP requests&lt;br /&gt;    const results = await Promise.all(&lt;br /&gt;      Array.from(Array(10_000)).map(async (_, index) =&amp;gt; {&lt;br /&gt;        const response = await fetch(&lt;br /&gt;          `/manifest.json?querystringValueToPreventCaching=${startedAt}_request-${index}`&lt;br /&gt;        );&lt;br /&gt;        const json = await response.json();&lt;br /&gt;        return json;&lt;br /&gt;      })&lt;br /&gt;    );&lt;br /&gt;&lt;br /&gt;    return results;&lt;br /&gt;  }, [startedAt]);&lt;br /&gt;&lt;br /&gt;  return responses;&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;function App() {&lt;br /&gt;  const [startedAt, setStartedAt] = useState(&amp;quot;&amp;quot;);&lt;br /&gt;  const responses = use10_000Requests(startedAt);&lt;br /&gt;&lt;br /&gt;  return (&lt;br /&gt;    &amp;lt;div className=&amp;quot;App&amp;quot;&amp;gt;&lt;br /&gt;      &amp;lt;header className=&amp;quot;App-header&amp;quot;&amp;gt;&lt;br /&gt;        &amp;lt;h1&amp;gt;The HTTP request machine&amp;lt;/h1&amp;gt;&lt;br /&gt;        &amp;lt;button&lt;br /&gt;          className=&amp;quot;App-button&amp;quot;&lt;br /&gt;          onClick={(_) =&amp;gt; setStartedAt(new Date().toISOString())}&lt;br /&gt;        &amp;gt;&lt;br /&gt;          Make 10,000 requests&lt;br /&gt;        &amp;lt;/button&amp;gt;&lt;br /&gt;        {responses.loading &amp;amp;&amp;amp; &amp;lt;div&amp;gt;{progressMessage}&amp;lt;/div&amp;gt;}&lt;br /&gt;        {responses.error &amp;amp;&amp;amp; &amp;lt;div&amp;gt;Something went wrong&amp;lt;/div&amp;gt;}&lt;br /&gt;        {responses.value &amp;amp;&amp;amp; (&lt;br /&gt;          &amp;lt;div className=&amp;quot;App-results&amp;quot;&amp;gt;&lt;br /&gt;            {responses.value.length} requests completed successfully&lt;br /&gt;          &amp;lt;/div&amp;gt;&lt;br /&gt;        )}&lt;br /&gt;      &amp;lt;/header&amp;gt;&lt;br /&gt;    &amp;lt;/div&amp;gt;&lt;br /&gt;  );&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;export default App;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The app that we&amp;#39;ve built is very simple; it&amp;#39;s a button which, when you press it, fires 10,000 HTTP requests in parallel using the &lt;a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API"&gt;Fetch API&lt;/a&gt;.  The data being requested in this case is an arbitrary JSON file; the &lt;code&gt;manifest.json&lt;/code&gt;.  If you look closely you&amp;#39;ll see we&amp;#39;re doing some querystring tricks with our URL to avoid getting cached data.&lt;/p&gt;&lt;p&gt;In fact, for this demo we&amp;#39;re not interested in the results of these HTTP requests; rather we&amp;#39;re interested in how the browser copes with this approach. (Spoiler: not well!) It&amp;#39;s worth considering that requesting a text file from a server running on the same machine as the browser should be fast.&lt;/p&gt;&lt;p&gt;So we&amp;#39;ll run &lt;code&gt;yarn start&lt;/code&gt; and go to &lt;a href="http://localhost:3000"&gt;http://localhost:3000&lt;/a&gt; to get to the app. Running with Devtools open results in the following unhappy affair:&lt;/p&gt; &lt;div class="separator" style="clear: both;"&gt;&lt;a href="https://1.bp.blogspot.com/-BmBB1-YEYP4/X6ri-bXhfTI/AAAAAAAAYak/twb1nozRYos2MbswIkymHaogc4sYGWd-wCLcBGAsYHQ/s1898/i-want-it-all.gif" style="display: block; padding: 1em 0; text-align: center; "&gt;&lt;img alt="" border="0" width="600" data-original-height="862" data-original-width="1898" src="https://1.bp.blogspot.com/-BmBB1-YEYP4/X6ri-bXhfTI/AAAAAAAAYak/twb1nozRYos2MbswIkymHaogc4sYGWd-wCLcBGAsYHQ/s600/i-want-it-all.gif"/&gt;&lt;/a&gt;&lt;/div&gt; &lt;p&gt;The GIF above has been edited significantly for length. In reality it took 20 seconds for the first request to be fired, prior to that Chrome was unresponsive. When requests did start to fire, a significant number failed with &lt;code&gt;net::ERR_INSUFFICIENT_RESOURCES&lt;/code&gt;.  Further to that, those requests that were fired sat in &amp;quot;Stalled&amp;quot; state prior to being executed.  This is a consequence of &lt;a href="https://developers.google.com/web/tools/chrome-devtools/network/reference#timing"&gt;Chrome limiting the number of connections - all browsers do this&lt;/a&gt;:&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;There are already six TCP connections open for this origin, which is the limit. Applies to HTTP/1.0 and HTTP/1.1 only.&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;In summary, the problems with the current approach are:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;the browser becoming unresponsive&lt;/li&gt;&lt;li&gt;failing HTTP requests due to insufficient resources&lt;/li&gt;&lt;li&gt;no information displayed to the user around progress&lt;/li&gt;&lt;/ol&gt;&lt;h4 id="throttle-me-this"&gt;Throttle me this&lt;/h4&gt;&lt;p&gt;Instead of hammering the browser by firing all the requests at once, we could instead implement a throttle.  A throttle is a mechanism which allows you to limit the rate at which operations are performed.  In this case we want to limit the rate at which HTTP requests are made. A throttle will tackle problems 1 and 2 - essentially keeping the browser free and easy and ensuring that requests are all successfully sent.  We also want to keep our users informed around how progress is going.  It&amp;#39;s time to unveil the &lt;code&gt;useThrottleRequests&lt;/code&gt; hook:&lt;/p&gt;&lt;pre class="prettyprint ts"&gt;&lt;code class="lang-ts"&gt;import { useMemo, useReducer } from &amp;quot;react&amp;quot;;&lt;br /&gt;import { AsyncState } from &amp;quot;react-use/lib/useAsync&amp;quot;;&lt;br /&gt;&lt;br /&gt;/** Function which makes a request */&lt;br /&gt;export type RequestToMake = () =&amp;gt; Promise&amp;lt;void&amp;gt;;&lt;br /&gt;&lt;br /&gt;/**&lt;br /&gt; * Given an array of requestsToMake and a limit on the number of max parallel requests&lt;br /&gt; * queue up those requests and start firing them&lt;br /&gt; * - inspired by Rafael Xavier&amp;#39;s approach here: https://stackoverflow.com/a/48007240/761388&lt;br /&gt; *&lt;br /&gt; * @param requestsToMake&lt;br /&gt; * @param maxParallelRequests the maximum number of requests to make - defaults to 6&lt;br /&gt; */&lt;br /&gt;async function throttleRequests(&lt;br /&gt;  requestsToMake: RequestToMake[],&lt;br /&gt;  maxParallelRequests = 6&lt;br /&gt;) {&lt;br /&gt;  // queue up simultaneous calls&lt;br /&gt;  const queue: Promise&amp;lt;void&amp;gt;[] = [];&lt;br /&gt;  for (let requestToMake of requestsToMake) {&lt;br /&gt;    // fire the async function, add its promise to the queue,&lt;br /&gt;    // and remove it from queue when complete&lt;br /&gt;    const promise = requestToMake().then((res) =&amp;gt; {&lt;br /&gt;      queue.splice(queue.indexOf(promise), 1);&lt;br /&gt;      return res;&lt;br /&gt;    });&lt;br /&gt;    queue.push(promise);&lt;br /&gt;&lt;br /&gt;    // if the number of queued requests matches our limit then&lt;br /&gt;    // wait for one to finish before enqueueing more&lt;br /&gt;    if (queue.length &amp;gt;= maxParallelRequests) {&lt;br /&gt;      await Promise.race(queue);&lt;br /&gt;    }&lt;br /&gt;  }&lt;br /&gt;  // wait for the rest of the calls to finish&lt;br /&gt;  await Promise.all(queue);&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;/**&lt;br /&gt; * The state that represents the progress in processing throttled requests&lt;br /&gt; */&lt;br /&gt;export type ThrottledProgress&amp;lt;TData&amp;gt; = {&lt;br /&gt;  /** the number of requests that will be made */&lt;br /&gt;  totalRequests: number;&lt;br /&gt;  /** the errors that came from failed requests */&lt;br /&gt;  errors: Error[];&lt;br /&gt;  /** the responses that came from successful requests */&lt;br /&gt;  values: TData[];&lt;br /&gt;  /** a value between 0 and 100 which represents the percentage of requests that have been completed (whether successfully or not) */&lt;br /&gt;  percentageLoaded: number;&lt;br /&gt;  /** whether the throttle is currently processing requests */&lt;br /&gt;  loading: boolean;&lt;br /&gt;};&lt;br /&gt;&lt;br /&gt;function createThrottledProgress&amp;lt;TData&amp;gt;(&lt;br /&gt;  totalRequests: number&lt;br /&gt;): ThrottledProgress&amp;lt;TData&amp;gt; {&lt;br /&gt;  return {&lt;br /&gt;    totalRequests,&lt;br /&gt;    percentageLoaded: 0,&lt;br /&gt;    loading: false,&lt;br /&gt;    errors: [],&lt;br /&gt;    values: [],&lt;br /&gt;  };&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;/**&lt;br /&gt; * A reducing function which takes the supplied `ThrottledProgress` and applies a new value to it&lt;br /&gt; */&lt;br /&gt;function updateThrottledProgress&amp;lt;TData&amp;gt;(&lt;br /&gt;  currentProgress: ThrottledProgress&amp;lt;TData&amp;gt;,&lt;br /&gt;  newData: AsyncState&amp;lt;TData&amp;gt;&lt;br /&gt;): ThrottledProgress&amp;lt;TData&amp;gt; {&lt;br /&gt;  const errors = newData.error&lt;br /&gt;    ? [...currentProgress.errors, newData.error]&lt;br /&gt;    : currentProgress.errors;&lt;br /&gt;&lt;br /&gt;  const values = newData.value&lt;br /&gt;    ? [...currentProgress.values, newData.value]&lt;br /&gt;    : currentProgress.values;&lt;br /&gt;&lt;br /&gt;  const percentageLoaded =&lt;br /&gt;    currentProgress.totalRequests === 0&lt;br /&gt;      ? 0&lt;br /&gt;      : Math.round(&lt;br /&gt;          ((errors.length + values.length) / currentProgress.totalRequests) * 100&lt;br /&gt;        );&lt;br /&gt;&lt;br /&gt;  const loading =&lt;br /&gt;    currentProgress.totalRequests === 0&lt;br /&gt;      ? false&lt;br /&gt;      : errors.length + values.length &amp;lt; currentProgress.totalRequests;&lt;br /&gt;&lt;br /&gt;  return {&lt;br /&gt;    totalRequests: currentProgress.totalRequests,&lt;br /&gt;    loading,&lt;br /&gt;    percentageLoaded,&lt;br /&gt;    errors,&lt;br /&gt;    values,&lt;br /&gt;  };&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;type ThrottleActions&amp;lt;TValue&amp;gt; =&lt;br /&gt;  | {&lt;br /&gt;      type: &amp;quot;initialise&amp;quot;;&lt;br /&gt;      totalRequests: number;&lt;br /&gt;    }&lt;br /&gt;  | {&lt;br /&gt;      type: &amp;quot;requestSuccess&amp;quot;;&lt;br /&gt;      value: TValue;&lt;br /&gt;    }&lt;br /&gt;  | {&lt;br /&gt;      type: &amp;quot;requestFailed&amp;quot;;&lt;br /&gt;      error: Error;&lt;br /&gt;    };&lt;br /&gt;&lt;br /&gt;/**&lt;br /&gt; * Create a ThrottleRequests and an updater&lt;br /&gt; */&lt;br /&gt;export function useThrottleRequests&amp;lt;TValue&amp;gt;() {&lt;br /&gt;  function reducer(&lt;br /&gt;    throttledProgressAndState: ThrottledProgress&amp;lt;TValue&amp;gt;,&lt;br /&gt;    action: ThrottleActions&amp;lt;TValue&amp;gt;&lt;br /&gt;  ): ThrottledProgress&amp;lt;TValue&amp;gt; {&lt;br /&gt;    switch (action.type) {&lt;br /&gt;      case &amp;quot;initialise&amp;quot;:&lt;br /&gt;        return createThrottledProgress(action.totalRequests);&lt;br /&gt;&lt;br /&gt;      case &amp;quot;requestSuccess&amp;quot;:&lt;br /&gt;        return updateThrottledProgress(throttledProgressAndState, {&lt;br /&gt;          loading: false,&lt;br /&gt;          value: action.value,&lt;br /&gt;        });&lt;br /&gt;&lt;br /&gt;      case &amp;quot;requestFailed&amp;quot;:&lt;br /&gt;        return updateThrottledProgress(throttledProgressAndState, {&lt;br /&gt;          loading: false,&lt;br /&gt;          error: action.error,&lt;br /&gt;        });&lt;br /&gt;    }&lt;br /&gt;  }&lt;br /&gt;&lt;br /&gt;  const [throttle, dispatch] = useReducer(&lt;br /&gt;    reducer,&lt;br /&gt;    createThrottledProgress&amp;lt;TValue&amp;gt;(/** totalRequests */ 0)&lt;br /&gt;  );&lt;br /&gt;&lt;br /&gt;  const updateThrottle = useMemo(() =&amp;gt; {&lt;br /&gt;    /**&lt;br /&gt;     * Update the throttle with a successful request&lt;br /&gt;     * @param values from request&lt;br /&gt;     */&lt;br /&gt;    function requestSucceededWithData(value: TValue) {&lt;br /&gt;      return dispatch({&lt;br /&gt;        type: &amp;quot;requestSuccess&amp;quot;,&lt;br /&gt;        value,&lt;br /&gt;      });&lt;br /&gt;    }&lt;br /&gt;&lt;br /&gt;    /**&lt;br /&gt;     * Update the throttle upon a failed request with an error message&lt;br /&gt;     * @param error error&lt;br /&gt;     */&lt;br /&gt;    function requestFailedWithError(error: Error) {&lt;br /&gt;      return dispatch({&lt;br /&gt;        type: &amp;quot;requestFailed&amp;quot;,&lt;br /&gt;        error,&lt;br /&gt;      });&lt;br /&gt;    }&lt;br /&gt;&lt;br /&gt;    /**&lt;br /&gt;     * Given an array of requestsToMake and a limit on the number of max parallel requests&lt;br /&gt;     * queue up those requests and start firing them&lt;br /&gt;     * - based upon https://stackoverflow.com/a/48007240/761388&lt;br /&gt;     *&lt;br /&gt;     * @param requestsToMake&lt;br /&gt;     * @param maxParallelRequests the maximum number of requests to make - defaults to 6&lt;br /&gt;     */&lt;br /&gt;    function queueRequests(&lt;br /&gt;      requestsToMake: RequestToMake[],&lt;br /&gt;      maxParallelRequests = 6&lt;br /&gt;    ) {&lt;br /&gt;      dispatch({&lt;br /&gt;        type: &amp;quot;initialise&amp;quot;,&lt;br /&gt;        totalRequests: requestsToMake.length,&lt;br /&gt;      });&lt;br /&gt;&lt;br /&gt;      return throttleRequests(requestsToMake, maxParallelRequests);&lt;br /&gt;    }&lt;br /&gt;&lt;br /&gt;    return {&lt;br /&gt;      queueRequests,&lt;br /&gt;      requestSucceededWithData,&lt;br /&gt;      requestFailedWithError,&lt;br /&gt;    };&lt;br /&gt;  }, [dispatch]);&lt;br /&gt;&lt;br /&gt;  return {&lt;br /&gt;    throttle,&lt;br /&gt;    updateThrottle,&lt;br /&gt;  };&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The &lt;code&gt;useThrottleRequests&lt;/code&gt; hook returns 2 properties:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;&lt;code&gt;throttle&lt;/code&gt; - a &lt;code&gt;ThrottledProgress&amp;lt;TData&amp;gt;&lt;/code&gt; that contains the following data:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;code&gt;totalRequests&lt;/code&gt; - the number of requests that will be made&lt;/li&gt;&lt;li&gt;&lt;code&gt;errors&lt;/code&gt; - the errors that came from failed requests&lt;/li&gt;&lt;li&gt;&lt;code&gt;values&lt;/code&gt; - the responses that came from successful requests&lt;/li&gt;&lt;li&gt;&lt;code&gt;percentageLoaded&lt;/code&gt; - a value between 0 and 100 which represents the percentage of requests that have been completed (whether successfully or not)&lt;/li&gt;&lt;li&gt;&lt;code&gt;loading&lt;/code&gt; - whether the throttle is currently processing requests&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;code&gt;updateThrottle&lt;/code&gt; - an object which exposes 3 functions:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;code&gt;queueRequests&lt;/code&gt; - the function to which you pass the requests that should be queued and executed in a throttled fashion&lt;/li&gt;&lt;li&gt;&lt;code&gt;requestSucceededWithData&lt;/code&gt; - the function which is called if a request succeeds to provide the data&lt;/li&gt;&lt;li&gt;&lt;code&gt;requestFailedWithError&lt;/code&gt; - the function which is called if a request fails to provide the error&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;That&amp;#39;s a lot of words to describe our &lt;code&gt;useThrottleRequests&lt;/code&gt; hook.  Let&amp;#39;s look at what it looks like by migrating our &lt;code&gt;use10_000Requests&lt;/code&gt; hook to (no pun intended) use it. Here&amp;#39;s a new implementation of &lt;code&gt;App.tsx&lt;/code&gt;:&lt;/p&gt;&lt;pre class="prettyprint tsx"&gt;&lt;code class="lang-tsx"&gt;import React, { useState } from &amp;quot;react&amp;quot;;&lt;br /&gt;import { useAsync } from &amp;quot;react-use&amp;quot;;&lt;br /&gt;import { useThrottleRequests } from &amp;quot;./useThrottleRequests&amp;quot;;&lt;br /&gt;import &amp;quot;./App.css&amp;quot;;&lt;br /&gt;&lt;br /&gt;function use10_000Requests(startedAt: string) {&lt;br /&gt;  const { throttle, updateThrottle } = useThrottleRequests();&lt;br /&gt;  const [progressMessage, setProgressMessage] = useState(&amp;quot;not started&amp;quot;);&lt;br /&gt;&lt;br /&gt;  useAsync(async() =&amp;gt; {&lt;br /&gt;      if (!startedAt) return;&lt;br /&gt;&lt;br /&gt;      setProgressMessage(&amp;quot;preparing&amp;quot;);&lt;br /&gt;&lt;br /&gt;      const requestsToMake = Array.from(Array(10_000)).map(&lt;br /&gt;        (_, index) =&amp;gt; async () =&amp;gt; {&lt;br /&gt;          try {&lt;br /&gt;            setProgressMessage(`loading ${index}...`);&lt;br /&gt;&lt;br /&gt;            const response = await fetch(&lt;br /&gt;              `/manifest.json?querystringValueToPreventCaching=${startedAt}_request-${index}`&lt;br /&gt;            );&lt;br /&gt;            const json = await response.json();&lt;br /&gt;&lt;br /&gt;            updateThrottle.requestSucceededWithData(json);&lt;br /&gt;          } catch (error) {&lt;br /&gt;            console.error(`failed to load ${index}`, error);&lt;br /&gt;            updateThrottle.requestFailedWithError(error);&lt;br /&gt;          }&lt;br /&gt;        }&lt;br /&gt;      );&lt;br /&gt;&lt;br /&gt;      await updateThrottle.queueRequests(requestsToMake);&lt;br /&gt;&lt;br /&gt;  }, [startedAt, updateThrottle, setProgressMessage]);&lt;br /&gt;&lt;br /&gt;  return { throttle, progressMessage };&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;function App() {&lt;br /&gt;  const [startedAt, setStartedAt] = useState(&amp;quot;&amp;quot;);&lt;br /&gt;&lt;br /&gt;  const { progressMessage, throttle } = use10_000Requests(startedAt);&lt;br /&gt;&lt;br /&gt;  return (&lt;br /&gt;    &amp;lt;div className=&amp;quot;App&amp;quot;&amp;gt;&lt;br /&gt;      &amp;lt;header className=&amp;quot;App-header&amp;quot;&amp;gt;&lt;br /&gt;        &amp;lt;h1&amp;gt;The HTTP request machine&amp;lt;/h1&amp;gt;&lt;br /&gt;        &amp;lt;button&lt;br /&gt;          className=&amp;quot;App-button&amp;quot;&lt;br /&gt;          onClick={(_) =&amp;gt; setStartedAt(new Date().toISOString())}&lt;br /&gt;        &amp;gt;&lt;br /&gt;          Make 10,000 requests&lt;br /&gt;        &amp;lt;/button&amp;gt;&lt;br /&gt;        {throttle.loading &amp;amp;&amp;amp; &amp;lt;div&amp;gt;{progressMessage}&amp;lt;/div&amp;gt;}&lt;br /&gt;        {throttle.values.length &amp;gt; 0 &amp;amp;&amp;amp; (&lt;br /&gt;          &amp;lt;div className=&amp;quot;App-results&amp;quot;&amp;gt;&lt;br /&gt;            {throttle.values.length} requests completed successfully&lt;br /&gt;          &amp;lt;/div&amp;gt;&lt;br /&gt;        )}&lt;br /&gt;        {throttle.errors.length &amp;gt; 0 &amp;amp;&amp;amp; (&lt;br /&gt;          &amp;lt;div className=&amp;quot;App-results&amp;quot;&amp;gt;&lt;br /&gt;            {throttle.errors.length} requests errored&lt;br /&gt;          &amp;lt;/div&amp;gt;&lt;br /&gt;        )}&lt;br /&gt;      &amp;lt;/header&amp;gt;&lt;br /&gt;    &amp;lt;/div&amp;gt;&lt;br /&gt;  );&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;export default App;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Looking at the new &lt;code&gt;use10_000Requests&lt;/code&gt; hook, there&amp;#39;s a few subtle differences to our prior implementation.  First of all, we&amp;#39;re now exposing the &lt;code&gt;throttle&lt;/code&gt;; a &lt;code&gt;ThrottleProgress&amp;lt;TData&amp;gt;&lt;/code&gt;. Our updated hook also exposes a &lt;code&gt;progressMessage&lt;/code&gt; which is a simple &lt;code&gt;string&lt;/code&gt; stored with &lt;code&gt;useState&lt;/code&gt; that we update as our throttle runs.  In truth the information being surfaced here isn&amp;#39;t that interesting.  The &lt;code&gt;progressMessage&lt;/code&gt; is in place just to illustrate that you could capture some data from your requests as they complete for display purposes; a running total for instance.&lt;/p&gt;&lt;p&gt;So, how does our new hook approach perform?&lt;/p&gt; &lt;div class="separator" style="clear: both;"&gt;&lt;a href="https://1.bp.blogspot.com/-wjmo7BaaYGw/X6ritEEQKPI/AAAAAAAAYag/3sZ8S8nH5Dc-ZtSYCJjGu2wN_R2pcU3SgCLcBGAsYHQ/s1898/i-want-it-all-with-hook.gif" style="display: block; padding: 1em 0; text-align: center; "&gt;&lt;img alt="" border="0" width="600" data-original-height="862" data-original-width="1898" src="https://1.bp.blogspot.com/-wjmo7BaaYGw/X6ritEEQKPI/AAAAAAAAYag/3sZ8S8nH5Dc-ZtSYCJjGu2wN_R2pcU3SgCLcBGAsYHQ/s600/i-want-it-all-with-hook.gif"/&gt;&lt;/a&gt;&lt;/div&gt; &lt;p&gt;Very well indeed!  Please note that the above GIF has again been edited for brevity.  If we look back at the problems we faced with the prior approach, how do we compare?&lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;del&gt;the browser becoming unresponsive&lt;/del&gt; - the browser remains responsive.&lt;/li&gt;&lt;li&gt;&lt;del&gt;failing HTTP requests due to insufficient resources&lt;/del&gt; - the browser does not experience failing HTTP requests.&lt;/li&gt;&lt;li&gt;&lt;del&gt;no information displayable to the user around progress&lt;/del&gt; - details of progress are displayed to the user throughout.&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;Tremendous!&lt;/p&gt;&lt;h4 id="what-shall-we-build-"&gt;What shall we build?&lt;/h4&gt;&lt;p&gt;Our current example is definitely contrived.  Let&amp;#39;s try and apply our &lt;code&gt;useThrottleRequests&lt;/code&gt; hook to a more realistic scenario.  We&amp;#39;re going to build an application which, given a repo on GitHub, lists all the contributors blogs.  (You can specify a blog URL on your GitHub profile; many people use this to specify their Twitter profile.)&lt;/p&gt;&lt;p&gt;We can build this thanks to the excellent &lt;a href="https://docs.github.com/en/free-pro-team@latest/rest"&gt;GitHub REST API&lt;/a&gt;. It exposes two endpoints of interest given our goal.&lt;/p&gt;&lt;h5 id="1-list-repository-contributors"&gt;1. List repository contributors&lt;/h5&gt;&lt;p&gt;&lt;a href="https://docs.github.com/en/free-pro-team@latest/rest/reference/repos#list-repository-contributors"&gt;List repository contributors&lt;/a&gt; lists contributors to the specified repository at this URL: &lt;code&gt;GET https://api.github.com/repos/{owner}/{repo}/contributors&lt;/code&gt;.  The response is an array of objects, crucially featuring a &lt;code&gt;url&lt;/code&gt; property that points to the user in question&amp;#39;s API endpoint:&lt;/p&gt;&lt;pre class="prettyprint js"&gt;&lt;code class="lang-js"&gt;[&lt;br /&gt;  // ...&lt;br /&gt;  {&lt;br /&gt;    // ...&lt;br /&gt;    &amp;quot;url&amp;quot;: &amp;quot;https://api.github.com/users/octocat&amp;quot;,&lt;br /&gt;    // ...&lt;br /&gt;  },&lt;br /&gt;  // ...&lt;br /&gt;]&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h5 id="2-get-a-user"&gt;2. Get a user&lt;/h5&gt;&lt;p&gt;&lt;a href="https://docs.github.com/en/free-pro-team@latest/rest/reference/users#get-a-user"&gt;Get a user&lt;/a&gt; is the API that the &lt;code&gt;url&lt;/code&gt; property above is referring to.  When called it returns an object representing the publicly available information about a user:&lt;/p&gt;&lt;pre class="prettyprint js"&gt;&lt;code class="lang-js"&gt;{&lt;br /&gt;  // ...&lt;br /&gt;  &amp;quot;name&amp;quot;: &amp;quot;The Octocat&amp;quot;,&lt;br /&gt;  // ...&lt;br /&gt;  &amp;quot;blog&amp;quot;: &amp;quot;https://github.blog&amp;quot;,&lt;br /&gt;  // ...&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="blogging-devs-v1-0"&gt;Blogging devs v1.0&lt;/h4&gt;&lt;p&gt;We&amp;#39;re now ready to build our blogging devs app; let&amp;#39;s replace the existing &lt;code&gt;App.tsx&lt;/code&gt; with:&lt;/p&gt;&lt;pre class="prettyprint tsx"&gt;&lt;code class="lang-tsx"&gt;import React, { useCallback, useMemo, useState } from &amp;quot;react&amp;quot;;&lt;br /&gt;import { useAsync } from &amp;quot;react-use&amp;quot;;&lt;br /&gt;import { useThrottleRequests } from &amp;quot;./useThrottleRequests&amp;quot;;&lt;br /&gt;import &amp;quot;./App.css&amp;quot;;&lt;br /&gt;&lt;br /&gt;type GitHubUser = { name: string; blog?: string };&lt;br /&gt;&lt;br /&gt;function timeout(ms: number) {&lt;br /&gt;  return new Promise((resolve) =&amp;gt; setTimeout(resolve, ms));&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;function useContributors(contributorsUrlToLoad: string) {&lt;br /&gt;  const { throttle, updateThrottle } = useThrottleRequests&amp;lt;GitHubUser&amp;gt;();&lt;br /&gt;  const [progressMessage, setProgressMessage] = useState(&amp;quot;&amp;quot;);&lt;br /&gt;&lt;br /&gt;  useAsync(async () =&amp;gt; {&lt;br /&gt;    if (!contributorsUrlToLoad) return;&lt;br /&gt;&lt;br /&gt;    setProgressMessage(&amp;quot;loading contributors&amp;quot;);&lt;br /&gt;&lt;br /&gt;    // load contributors from GitHub&lt;br /&gt;    const contributorsResponse = await fetch(contributorsUrlToLoad);&lt;br /&gt;    const contributors: { url: string }[] = await contributorsResponse.json();&lt;br /&gt;&lt;br /&gt;    setProgressMessage(`loading ${contributors.length} contributors...`);&lt;br /&gt;&lt;br /&gt;    // For each entry in result, retrieve the given user from GitHub&lt;br /&gt;    const requestsToMake = contributors.map(({ url }, index) =&amp;gt; async () =&amp;gt; {&lt;br /&gt;      try {&lt;br /&gt;        setProgressMessage(&lt;br /&gt;          `loading ${index} / ${contributors.length}: ${url}...`&lt;br /&gt;        );&lt;br /&gt;&lt;br /&gt;        const response = await fetch(url);&lt;br /&gt;        const json: GitHubUser = await response.json();&lt;br /&gt;&lt;br /&gt;        // wait for 1 second before completing the request&lt;br /&gt;        // - makes for better demos&lt;br /&gt;        await timeout(1000);&lt;br /&gt;&lt;br /&gt;        updateThrottle.requestSucceededWithData(json);&lt;br /&gt;      } catch (error) {&lt;br /&gt;        console.error(`failed to load ${url}`, error);&lt;br /&gt;        updateThrottle.requestFailedWithError(error);&lt;br /&gt;      }&lt;br /&gt;    });&lt;br /&gt;&lt;br /&gt;    await updateThrottle.queueRequests(requestsToMake);&lt;br /&gt;&lt;br /&gt;    setProgressMessage(&amp;quot;&amp;quot;);&lt;br /&gt;  }, [contributorsUrlToLoad, updateThrottle, setProgressMessage]);&lt;br /&gt;&lt;br /&gt;  return { throttle, progressMessage };&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;function App() {&lt;br /&gt;  // The owner and repo to query; we&amp;#39;re going to default&lt;br /&gt;  // to using DefinitelyTyped as an example repo as it&lt;br /&gt;  // is one of the most contributed to repos on GitHub&lt;br /&gt;  const [owner, setOwner] = useState(&amp;quot;DefinitelyTyped&amp;quot;);&lt;br /&gt;  const [repo, setRepo] = useState(&amp;quot;DefinitelyTyped&amp;quot;);&lt;br /&gt;  const handleOwnerChange = useCallback(&lt;br /&gt;    (event: React.ChangeEvent&amp;lt;HTMLInputElement&amp;gt;) =&amp;gt;&lt;br /&gt;      setOwner(event.target.value),&lt;br /&gt;    [setOwner]&lt;br /&gt;  );&lt;br /&gt;  const handleRepoChange = useCallback(&lt;br /&gt;    (event: React.ChangeEvent&amp;lt;HTMLInputElement&amp;gt;) =&amp;gt; setRepo(event.target.value),&lt;br /&gt;    [setRepo]&lt;br /&gt;  );&lt;br /&gt;&lt;br /&gt;  const contributorsUrl = `https://api.github.com/repos/${owner}/${repo}/contributors`;&lt;br /&gt;&lt;br /&gt;  const [contributorsUrlToLoad, setUrlToLoad] = useState(&amp;quot;&amp;quot;);&lt;br /&gt;  const { progressMessage, throttle } = useContributors(contributorsUrlToLoad);&lt;br /&gt;&lt;br /&gt;  const bloggers = useMemo(&lt;br /&gt;    () =&amp;gt; throttle.values.filter((contributor) =&amp;gt; contributor.blog),&lt;br /&gt;    [throttle]&lt;br /&gt;  );&lt;br /&gt;&lt;br /&gt;  return (&lt;br /&gt;    &amp;lt;div className=&amp;quot;App&amp;quot;&amp;gt;&lt;br /&gt;      &amp;lt;header className=&amp;quot;App-header&amp;quot;&amp;gt;&lt;br /&gt;        &amp;lt;h1&amp;gt;Blogging devs&amp;lt;/h1&amp;gt;&lt;br /&gt;&lt;br /&gt;        &amp;lt;p&amp;gt;&lt;br /&gt;          Show me the{&amp;quot; &amp;quot;}&lt;br /&gt;          &amp;lt;a&lt;br /&gt;            className=&amp;quot;App-link&amp;quot;&lt;br /&gt;            href={contributorsUrl}&lt;br /&gt;            target=&amp;quot;_blank&amp;quot;&lt;br /&gt;            rel=&amp;quot;noopener noreferrer&amp;quot;&lt;br /&gt;          &amp;gt;&lt;br /&gt;            contributors for {owner}/{repo}&lt;br /&gt;          &amp;lt;/a&amp;gt;{&amp;quot; &amp;quot;}&lt;br /&gt;          who have blogs.&lt;br /&gt;        &amp;lt;/p&amp;gt;&lt;br /&gt;&lt;br /&gt;        &amp;lt;div className=&amp;quot;App-labelinput&amp;quot;&amp;gt;&lt;br /&gt;          &amp;lt;label htmlFor=&amp;quot;owner&amp;quot;&amp;gt;GitHub Owner&amp;lt;/label&amp;gt;&lt;br /&gt;          &amp;lt;input&lt;br /&gt;            id=&amp;quot;owner&amp;quot;&lt;br /&gt;            type=&amp;quot;text&amp;quot;&lt;br /&gt;            value={owner}&lt;br /&gt;            onChange={handleOwnerChange}&lt;br /&gt;          /&amp;gt;&lt;br /&gt;          &amp;lt;label htmlFor=&amp;quot;repo&amp;quot;&amp;gt;GitHub Repo&amp;lt;/label&amp;gt;&lt;br /&gt;          &amp;lt;input&lt;br /&gt;            id=&amp;quot;repo&amp;quot;&lt;br /&gt;            type=&amp;quot;text&amp;quot;&lt;br /&gt;            value={repo}&lt;br /&gt;            onChange={handleRepoChange}&lt;br /&gt;          /&amp;gt;&lt;br /&gt;        &amp;lt;/div&amp;gt;&lt;br /&gt;&lt;br /&gt;        &amp;lt;button&lt;br /&gt;          className=&amp;quot;App-button&amp;quot;&lt;br /&gt;          onClick={(e) =&amp;gt; setUrlToLoad(contributorsUrl)}&lt;br /&gt;        &amp;gt;&lt;br /&gt;          Load bloggers from GitHub&lt;br /&gt;        &amp;lt;/button&amp;gt;&lt;br /&gt;&lt;br /&gt;        {progressMessage &amp;amp;&amp;amp; (&lt;br /&gt;          &amp;lt;div className=&amp;quot;App-progress&amp;quot;&amp;gt;{progressMessage}&amp;lt;/div&amp;gt;&lt;br /&gt;        )}&lt;br /&gt;&lt;br /&gt;        {throttle.percentageLoaded &amp;gt; 0 &amp;amp;&amp;amp; (&lt;br /&gt;          &amp;lt;&amp;gt;&lt;br /&gt;            &amp;lt;h3&amp;gt;Behold {bloggers.length} bloggers:&amp;lt;/h3&amp;gt;&lt;br /&gt;            &amp;lt;div className=&amp;quot;App-results&amp;quot;&amp;gt;&lt;br /&gt;              {bloggers.map((blogger) =&amp;gt; (&lt;br /&gt;                &amp;lt;div key={blogger.name}&amp;gt;&lt;br /&gt;                  &amp;lt;div&amp;gt;{blogger.name}&amp;lt;/div&amp;gt;&lt;br /&gt;                  &amp;lt;a&lt;br /&gt;                    className=&amp;quot;App-link&amp;quot;&lt;br /&gt;                    href={blogger.blog}&lt;br /&gt;                    target=&amp;quot;_blank&amp;quot;&lt;br /&gt;                    rel=&amp;quot;noopener noreferrer&amp;quot;&lt;br /&gt;                  &amp;gt;&lt;br /&gt;                    {blogger.blog}&lt;br /&gt;                  &amp;lt;/a&amp;gt;&lt;br /&gt;                &amp;lt;/div&amp;gt;&lt;br /&gt;              ))}&lt;br /&gt;            &amp;lt;/div&amp;gt;&lt;br /&gt;          &amp;lt;/&amp;gt;&lt;br /&gt;        )}&lt;br /&gt;&lt;br /&gt;        {throttle.errors.length &amp;gt; 0 &amp;amp;&amp;amp; (&lt;br /&gt;          &amp;lt;div className=&amp;quot;App-results&amp;quot;&amp;gt;&lt;br /&gt;            {throttle.errors.length} requests errored&lt;br /&gt;          &amp;lt;/div&amp;gt;&lt;br /&gt;        )}&lt;br /&gt;      &amp;lt;/header&amp;gt;&lt;br /&gt;    &amp;lt;/div&amp;gt;&lt;br /&gt;  );&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;export default App;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The application gives users the opportunity to enter the organisation and repository of a GitHub project.  Then, when the button is clicked, it:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;loads the contributors&lt;/li&gt;&lt;li&gt;for each contributor it loads the individual user (separate HTTP request for each)&lt;/li&gt;&lt;li&gt;as it loads it communicates how far through the loading progress it has got&lt;/li&gt;&lt;li&gt;as users are loaded, it renders a tile for each user with a listed blog&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;Just to make the demo a little clearer we&amp;#39;ve artificially slowed the duration of each request by a second.  What does it look like when you put it together?  Well like this:&lt;/p&gt; &lt;div class="separator" style="clear: both;"&gt;&lt;a href="https://1.bp.blogspot.com/-6IPYGt2hIck/X6rhzmi0fkI/AAAAAAAAYac/zScbWyA0x7sE-xjvyHrpbjLfAlGXQ7BHwCPcBGAYYCw/s1898/blogging-devs.gif" style="display: block; padding: 1em 0; text-align: center; "&gt;&lt;img alt="" border="0" width="600" data-original-height="862" data-original-width="1898" src="https://1.bp.blogspot.com/-6IPYGt2hIck/X6rhzmi0fkI/AAAAAAAAYac/zScbWyA0x7sE-xjvyHrpbjLfAlGXQ7BHwCPcBGAYYCw/s600/blogging-devs.gif"/&gt;&lt;/a&gt;&lt;/div&gt; &lt;p&gt;We have built a React Hook which allows us to:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;gradually load data&lt;/li&gt;&lt;li&gt;without blocking the UI of the browser&lt;/li&gt;&lt;li&gt;and which provides progress data to keep users informed.&lt;/li&gt;&lt;/ul&gt; &lt;p&gt;&lt;a href="https://blog.logrocket.com/throttling-data-requests-with-react-hooks/"&gt;This post was originally published on LogRocket.&lt;/a&gt;&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7479463423921486801'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7479463423921486801'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2020/11/throttle-data-requests-with-react-hooks.html' title='Throttling data requests with React Hooks'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='https://1.bp.blogspot.com/-BmBB1-YEYP4/X6ri-bXhfTI/AAAAAAAAYak/twb1nozRYos2MbswIkymHaogc4sYGWd-wCLcBGAsYHQ/s72-c/i-want-it-all.gif' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6782298858132569584</id><published>2020-10-31T17:13:00.000Z</published><updated>2020-10-31T17:13:37.820Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='azure devops api'/><category scheme='http://www.blogger.com/atom/ns#' term='203'/><category scheme='http://www.blogger.com/atom/ns#' term='node.js'/><title type='text'>Azure DevOps Node API: The missing episodes</title><content type='html'>&lt;p&gt;I&amp;#39;ve been taking a good look at the &lt;a href="https://docs.microsoft.com/en-us/rest/api/azure/devops/?view=azure-devops-rest-6.1"&gt;REST API for Azure DevOps&lt;/a&gt;. I&amp;#39;m delighted to say that it&amp;#39;s a very full API. However, there&amp;#39;s quirks.&lt;/p&gt;&lt;p&gt;I&amp;#39;m writing a tool that interrogates Azure DevOps in order that it can construct release documentation. That release documentation we would like to publish to the project wiki.&lt;/p&gt;&lt;p&gt;To make integration with Azure DevOps even easier, the ADO team have put a good amount of work into &lt;a href="https://docs.microsoft.com/en-us/rest/api/azure/devops/?view=azure-devops-rest-6.1#client-libraries"&gt;client libraries&lt;/a&gt; that allow you to code in your language of choice. In my case I&amp;#39;m writing a Node.js tool (using TypeScript) and happily the client lib for Node is written and published with TypeScript too. Tremendous! However, there is a &amp;quot;but&amp;quot; coming....&lt;/p&gt;&lt;h4 id="wiki-got-a-big-ol-but"&gt;Wiki got a big ol&amp;#39; &amp;quot;but&amp;quot;&lt;/h4&gt;&lt;p&gt;As I&amp;#39;ve been using the Node client lib, I&amp;#39;ve found minor quirks. Such as the &lt;a href="https://github.com/microsoft/azure-devops-node-api/issues/415"&gt;&lt;code&gt;GitApi.getRefs&lt;/code&gt; missing the pagination parts of the API&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;Whilst the &lt;code&gt;GitApi&lt;/code&gt; was missing some parameters on a method, the &lt;code&gt;WikiApi&lt;/code&gt; was &lt;a href="https://github.com/microsoft/azure-devops-node-api/issues/416"&gt;missing whole endpoints, such as the Pages - Create Or Update&lt;/a&gt; one. The various &lt;a href="https://github.com/microsoft/azure-devops-node-api/blob/master/CONTRIBUTING.md#general-contribution-guide"&gt;client libraries are auto-generated&lt;/a&gt; which makes contribution a difficult game. The lovely &lt;a href="https://github.com/vtbassmatt"&gt;Matt Cooper&lt;/a&gt; has &lt;a href="https://github.com/microsoft/azure-devops-node-api/issues/415#issuecomment-717991914"&gt;alerted the team&lt;/a&gt;&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;These clients are generated from the server-side controllers, and at a glance, I don&amp;#39;t understand why those two parameters weren&amp;#39;t included. Full transparency, we don&amp;#39;t dedicate a lot of cycles here, but I will get it on the team&amp;#39;s radar to investigate/improve.&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;In the meantime, I still had a tool to write.&lt;/p&gt;&lt;h4 id="handrolled-wiki-api"&gt;Handrolled Wiki API&lt;/h4&gt;&lt;p&gt;Whilst the Node.js client lib was missing some crucial pieces, there did seem to be a way forward. Using the API directly; not using the client lib to do our HTTP and using &lt;a href="https://github.com/axios/axios"&gt;axios&lt;/a&gt; instead. Happily the types we needed were still available for be leveraged.&lt;/p&gt;&lt;p&gt;Looking at the docs it seemed it ought to be simple:&lt;/p&gt;&lt;p&gt;&lt;a href="https://docs.microsoft.com/en-us/rest/api/azure/devops/?view=azure-devops-rest-6.1#assemble-the-request"&gt;https://docs.microsoft.com/en-us/rest/api/azure/devops/?view=azure-devops-rest-6.1#assemble-the-request&lt;/a&gt;&lt;/p&gt;&lt;p&gt;But when I attempted this I found my requests erroring out with 203 Non-Authoritative Informations. It didn&amp;#39;t make sense. I couldn&amp;#39;t get a single request to be successful, they all failed. It occurred to me that the answer was hiding in &lt;code&gt;node_modules&lt;/code&gt;. I&amp;#39;d managed to make successful requests to the API using the client lib. What was it doing that I wasn&amp;#39;t?&lt;/p&gt;&lt;p&gt;The answer ended up being an authorization one-liner:&lt;/p&gt;&lt;pre class="prettyprint ts"&gt;&lt;code class="lang-ts"&gt;    const request = await axios({&lt;br /&gt;        url,&lt;br /&gt;        headers: {&lt;br /&gt;            Accept: &amp;#39;application/json&amp;#39;,&lt;br /&gt;            &amp;#39;Content-Type&amp;#39;: &amp;#39;application/json&amp;#39;,&lt;br /&gt;            // This!&lt;br /&gt;            Authorization: `Basic ${Buffer.from(`PAT:${adoPersonalAccessToken}`).toString(&amp;#39;base64&amp;#39;)}`,&lt;br /&gt;            &amp;#39;X-TFS-FedAuthRedirect&amp;#39;: &amp;#39;Suppress&amp;#39;,&lt;br /&gt;        },&lt;br /&gt;    });&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;With this in hand everything started to work and I found myself able to write my own clients to fill in the missing pieces from the client lib:&lt;/p&gt;&lt;pre class="prettyprint ts"&gt;&lt;code class="lang-ts"&gt;import axios from &amp;#39;axios&amp;#39;;&lt;br /&gt;import { WikiPage, WikiPageCreateOrUpdateParameters, WikiType } from &amp;#39;azure-devops-node-api/interfaces/WikiInterfaces&amp;#39;;&lt;br /&gt;import { IWikiApi } from &amp;#39;azure-devops-node-api/WikiApi&amp;#39;;&lt;br /&gt;&lt;br /&gt;async function getWikiPage({&lt;br /&gt;    adoUrl,&lt;br /&gt;    adoProject,&lt;br /&gt;    adoPat,&lt;br /&gt;    wikiId,&lt;br /&gt;    path,&lt;br /&gt;}: {&lt;br /&gt;    adoUrl: string;&lt;br /&gt;    adoProject: string;&lt;br /&gt;    adoPat: string;&lt;br /&gt;    wikiId: string;&lt;br /&gt;    path: string;&lt;br /&gt;}) {&lt;br /&gt;    try {&lt;br /&gt;        const url = `${makeBaseApiUrl({&lt;br /&gt;            adoUrl,&lt;br /&gt;            adoProject,&lt;br /&gt;        })}/wiki/wikis/${wikiId}/pages?${apiVersion}&amp;amp;path=${path}&amp;amp;includeContent=True&amp;amp;recursionLevel=full`;&lt;br /&gt;        const request = await axios({&lt;br /&gt;            url,&lt;br /&gt;            headers: makeHeaders(adoPat),&lt;br /&gt;        });&lt;br /&gt;&lt;br /&gt;        const page: WikiPage = request.data;&lt;br /&gt;        return page;&lt;br /&gt;    } catch (error) {&lt;br /&gt;        return undefined;&lt;br /&gt;    }&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;async function createWikiPage({&lt;br /&gt;    adoUrl,&lt;br /&gt;    adoProject,&lt;br /&gt;    adoPat,&lt;br /&gt;    wikiId,&lt;br /&gt;    path,&lt;br /&gt;    data,&lt;br /&gt;}: {&lt;br /&gt;    adoUrl: string;&lt;br /&gt;    adoProject: string;&lt;br /&gt;    adoPat: string;&lt;br /&gt;    wikiId: string;&lt;br /&gt;    path: string;&lt;br /&gt;    data: WikiPageCreateOrUpdateParameters;&lt;br /&gt;}) {&lt;br /&gt;    try {&lt;br /&gt;        const url = `${makeBaseApiUrl({&lt;br /&gt;            adoUrl,&lt;br /&gt;            adoProject,&lt;br /&gt;        })}/wiki/wikis/${wikiId}/pages?${apiVersion}&amp;amp;path=${path}`;&lt;br /&gt;&lt;br /&gt;        const request = await axios({&lt;br /&gt;            method: &amp;#39;PUT&amp;#39;,&lt;br /&gt;            url,&lt;br /&gt;            headers: makeHeaders(adoPat),&lt;br /&gt;            data,&lt;br /&gt;        });&lt;br /&gt;&lt;br /&gt;        const newPage: WikiPage = request.data;&lt;br /&gt;        return newPage;&lt;br /&gt;    } catch (error) {&lt;br /&gt;        return undefined;&lt;br /&gt;    }&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;const apiVersion = &amp;quot;api-version=6.0&amp;quot;;&lt;br /&gt;&lt;br /&gt;/**&lt;br /&gt;* Create the headers necessary to ake Azure DevOps happy&lt;br /&gt;* @param adoPat Personal Access Token from ADO&lt;br /&gt;*/&lt;br /&gt;function makeHeaders(adoPat: string) {&lt;br /&gt;    return {&lt;br /&gt;        Accept: &amp;#39;application/json&amp;#39;,&lt;br /&gt;        &amp;#39;Content-Type&amp;#39;: &amp;#39;application/json&amp;#39;,&lt;br /&gt;        Authorization: `Basic ${Buffer.from(`PAT:${adoPat}`).toString(&amp;#39;base64&amp;#39;)}`,&lt;br /&gt;        &amp;#39;X-TFS-FedAuthRedirect&amp;#39;: &amp;#39;Suppress&amp;#39;,&lt;br /&gt;    };&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;/**&lt;br /&gt;* eg https://dev.azure.com/{organization}/{project}/_apis&lt;br /&gt;*/&lt;br /&gt;function makeBaseApiUrl({ adoUrl, adoProject }: { adoUrl: string; adoProject: string }) {&lt;br /&gt;    return `${adoUrl}/${adoProject}/_apis`;&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;With this I was able to write code like this:&lt;/p&gt;&lt;pre class="prettyprint ts"&gt;&lt;code class="lang-ts"&gt;    let topLevelPage = await getWikiPage({&lt;br /&gt;        adoUrl,&lt;br /&gt;        adoProject,&lt;br /&gt;        adoPat,&lt;br /&gt;        wikiId,&lt;br /&gt;        path: config.wikiTopLevelName,&lt;br /&gt;    });&lt;br /&gt;&lt;br /&gt;    if (!topLevelPage)&lt;br /&gt;        topLevelPage = await createWikiPage({&lt;br /&gt;            adoUrl,&lt;br /&gt;            adoProject,&lt;br /&gt;            adoPat,&lt;br /&gt;            wikiId,&lt;br /&gt;            path: config.wikiTopLevelName,&lt;br /&gt;            data: { content: &amp;#39;&amp;#39; },&lt;br /&gt;        });&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;and the wikis were ours!&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/6782298858132569584'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/6782298858132569584'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2020/10/azure-devops-node-api-missing-episodes.html' title='Azure DevOps Node API: The missing episodes'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8950848463978245571</id><published>2020-10-19T06:14:00.003+01:00</published><updated>2020-10-19T06:26:04.827+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>The Mysterious Case of Safari and the Empty Download</title><content type='html'>&lt;p&gt;&lt;strong&gt;TL;DR:&lt;/strong&gt; Safari wants a &lt;code&gt;Content-Type&lt;/code&gt; header in responses. Even if the response is &lt;code&gt;Content-Length: 0&lt;/code&gt;. Without this, Safari can attempt to trigger an empty download. Don&amp;#39;t argue; just go with it; some browsers are strange.&lt;/p&gt;&lt;h4 id="the-longer-version"&gt;The longer version&lt;/h4&gt;&lt;p&gt;Every now and then a mystery presents itself. A puzzle which just doesn&amp;#39;t make sense and yet stubbornly continues to exist. I happened upon one of these the other day and to say it was frustrating does it no justice at all.&lt;/p&gt;&lt;p&gt;It all came back to the default iOS and Mac browser; Safari. When our users log into our application, they are redirected to a shared login provider which, upon successful authentication, hands over a cookie containing auth details and redirects back to our application. A middleware in our app reads what it needs from the cookie and then creates a cookie of its own which is to be used throughout the session. As soon as the cookie is set, the page refreshes and the app boots up in an authenticated state.&lt;/p&gt;&lt;p&gt;That&amp;#39;s the background. This mechanism had long been working fine with Chrome (which the majority of our users browse with), Edge, Firefox and Internet Explorer. But we started to get reports from Safari users that, once they&amp;#39;d supplied their credentials, they&amp;#39;d not be authenticated and redirected back to our application. Instead they&amp;#39;d be prompted to download an empty document and the redirect would not take place.&lt;/p&gt;&lt;p&gt;As a team we could not fathom why this should be the case; it just didn&amp;#39;t make sense. There followed hours of experimentation before &lt;a href="https://twitter.com/hennie_spies" target="_blank"&gt;Hennie&lt;/a&gt; noticed something. It was at the point when the redirect back to our app from the login provider took place. Specifically the initial response that came back which contained our custom cookie and a &lt;code&gt;Refresh: 0&lt;/code&gt; header to trigger a refresh in the browser. There was no content in the response, save for headers. It was &lt;code&gt;Content-Length: 0&lt;/code&gt; all the way.&lt;/p&gt;&lt;p&gt;Hennie noticed that there was no &lt;code&gt;Content-Type&lt;/code&gt; set and wondered if that was significant. It didn&amp;#39;t seem like it would be a necessary header given there was no content. But Safari reckons not with logic. As an experiment we tried setting the response header to &lt;code&gt;Content-Type: text/html&lt;/code&gt;. It worked! No mystery download, no failed redirect (which it turned out was actually a successful redirect which wasn&amp;#39;t being surfaced in Safari&amp;#39;s network request tab).&lt;/p&gt;&lt;p&gt;It appears that always providing a &lt;code&gt;Content-Type&lt;/code&gt; header in your responses is wise if only for the case of Safari. In fact, it&amp;#39;s generally unlikely that this won&amp;#39;t be set anyway, but it can happen as we have experienced. Hopefully we&amp;#39;ve suffered so you don&amp;#39;t have to.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8950848463978245571'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8950848463978245571'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2020/10/safari-empty-download-content-type.html' title='The Mysterious Case of Safari and the Empty Download'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-740153860672488638</id><published>2020-10-02T06:15:00.001+01:00</published><updated>2020-10-02T06:15:13.230+01:00</updated><category scheme='http://www.blogger.com/atom/ns#' term='autofac'/><category scheme='http://www.blogger.com/atom/ns#' term='asp.net'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='ConfigureTestContainer'/><category scheme='http://www.blogger.com/atom/ns#' term='Integration Testing'/><title type='text'>Autofac 6, integration tests and .NET generic hosting</title><content type='html'>&lt;p&gt;I &lt;a href="https://blog.johnnyreilly.com/2020/05/autofac-webapplicationfactory-and.html"&gt;blogged a little while ago around to support integration tests using Autofac&lt;/a&gt;. This was specific to Autofac but documented a workaround for a &lt;a href="https://github.com/dotnet/aspnetcore/issues/14907"&gt;long standing issue with &lt;code&gt;ConfigureTestContainer&lt;/code&gt; that was introduced into .NET core 3.0&lt;/a&gt; which affects &lt;a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/dependency-injection?view=aspnetcore-3.1#default-service-container-replacement"&gt;all third-party containers&lt;/a&gt; that use &lt;code&gt;ConfigureTestContainer&lt;/code&gt; in their tests.&lt;/p&gt;&lt;p&gt;I&amp;#39;ll not repeat the contents of the previous post - it all still stands. However, with Autofac 6 the approach documented there will cease to work. This is because the previous approach relied upon &lt;code&gt;ContainerBuilder&lt;/code&gt; not being sealed.  &lt;a href="https://github.com/autofac/Autofac/issues/1120"&gt;As of Autofac 6 it is.&lt;/a&gt;&lt;/p&gt;&lt;p&gt;Happily the tremendous &lt;a href="https://twitter.com/evocationist"&gt;Alistair Evans&lt;/a&gt; came up with an &lt;a href="https://github.com/autofac/Autofac/issues/1207#issuecomment-701961371"&gt;alternative approach&lt;/a&gt; which is listed below:   &lt;/p&gt;&lt;pre class="prettyprint cs"&gt;&lt;code class="lang-cs"&gt;    /// &amp;lt;summary&amp;gt;&lt;br /&gt;    /// Based upon https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/test/integration-tests/samples/3.x/IntegrationTestsSample&lt;br /&gt;    /// &amp;lt;/summary&amp;gt;&lt;br /&gt;    /// &amp;lt;typeparam name=&amp;quot;TStartup&amp;quot;&amp;gt;&amp;lt;/typeparam&amp;gt;&lt;br /&gt;    public class AutofacWebApplicationFactory&amp;lt;TStartup&amp;gt; : WebApplicationFactory&amp;lt;TStartup&amp;gt; where TStartup : class&lt;br /&gt;    {&lt;br /&gt;        protected override IHost CreateHost(IHostBuilder builder)&lt;br /&gt;        {&lt;br /&gt;            builder.UseServiceProviderFactory&amp;lt;ContainerBuilder&amp;gt;(new CustomServiceProviderFactory());&lt;br /&gt;            return base.CreateHost(builder);&lt;br /&gt;        }&lt;br /&gt;    }&lt;br /&gt;&lt;br /&gt;    /// &amp;lt;summary&amp;gt;&lt;br /&gt;    /// Based upon https://github.com/dotnet/aspnetcore/issues/14907#issuecomment-620750841 - only necessary because of an issue in ASP.NET Core&lt;br /&gt;    /// &amp;lt;/summary&amp;gt;&lt;br /&gt;    public class CustomServiceProviderFactory : IServiceProviderFactory&amp;lt;ContainerBuilder&amp;gt;&lt;br /&gt;    {&lt;br /&gt;        private AutofacServiceProviderFactory _wrapped;&lt;br /&gt;        private IServiceCollection _services;&lt;br /&gt;&lt;br /&gt;        public CustomServiceProviderFactory()&lt;br /&gt;        {&lt;br /&gt;            _wrapped = new AutofacServiceProviderFactory();&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        public ContainerBuilder CreateBuilder(IServiceCollection services)&lt;br /&gt;        {&lt;br /&gt;            // Store the services for later.&lt;br /&gt;            _services = services;&lt;br /&gt;&lt;br /&gt;            return _wrapped.CreateBuilder(services);&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        public IServiceProvider CreateServiceProvider(ContainerBuilder containerBuilder)&lt;br /&gt;        {&lt;br /&gt;            var sp = _services.BuildServiceProvider();&lt;br /&gt;#pragma warning disable CS0612 // Type or member is obsolete&lt;br /&gt;            var filters = sp.GetRequiredService&amp;lt;IEnumerable&amp;lt;IStartupConfigureContainerFilter&amp;lt;ContainerBuilder&amp;gt;&amp;gt;&amp;gt;();&lt;br /&gt;#pragma warning restore CS0612 // Type or member is obsolete&lt;br /&gt;&lt;br /&gt;            foreach (var filter in filters)&lt;br /&gt;            {&lt;br /&gt;                filter.ConfigureContainer(b =&amp;gt; { })(containerBuilder);&lt;br /&gt;            }&lt;br /&gt;&lt;br /&gt;            return _wrapped.CreateServiceProvider(containerBuilder);&lt;br /&gt;        }        &lt;br /&gt;    }&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Using this in place of the previous approach should allow you continue running your integration tests with Autofac 6. Thanks Alistair!&lt;/p&gt; &lt;h4 id="concern-for-third-party-containers"&gt;Concern for third-party containers&lt;/h4&gt;&lt;p&gt;Whilst this gets us back up and running, &lt;a href="https://github.com/autofac/Autofac/issues/1207#issuecomment-702250044"&gt;Alistair pointed out that this approach depends upon a deprecated interface&lt;/a&gt;.  This is the &lt;a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.hosting.istartupconfigurecontainerfilter-1.configurecontainer?view=aspnetcore-3.1"&gt;&lt;code&gt;IStartupConfigureContainerFilter&lt;/code&gt;&lt;/a&gt; which &lt;a href="https://github.com/dotnet/aspnetcore/pull/11505"&gt;has been marked as &lt;code&gt;Obsolete&lt;/code&gt; since mid 2019&lt;/a&gt;. What this means is, at some point, this approach will stop working.&lt;/p&gt;&lt;p&gt;The marvellous David Fowler has said that &lt;a href="https://github.com/autofac/Autofac/issues/1207#issuecomment-702361608"&gt;&lt;code&gt;ConfigureTestContainer&lt;/code&gt; issue should be resolved in .NET&lt;/a&gt;. However it&amp;#39;s worth noting that this has been an issue since .NET Core 3 shipped and unfortunately the wonderful &lt;a href="https://github.com/dotnet/aspnetcore/issues/14907#issuecomment-702287717"&gt;Chris Ross has advised that it&amp;#39;s not likely to be fixed for .NET 5&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;I&amp;#39;m very keen this does get resolved in .NET.  Building tests upon an &lt;code&gt;Obsolete&lt;/code&gt; attribute doesn&amp;#39;t fill me with confidence. I&amp;#39;m a long time user of Autofac and I&amp;#39;d like to continue to be. Here&amp;#39;s hoping that&amp;#39;s made possible by a fix landing in .NET. If this is something you care about, it may be worth upvoting / commenting on &lt;a href="https://github.com/dotnet/aspnetcore/issues/14907"&gt;the issue in GitHub&lt;/a&gt; so the team are aware of desire around this being resolved.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/740153860672488638'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/740153860672488638'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2020/10/autofac-6-integration-tests-and-generic-hosting.html' title='Autofac 6, integration tests and .NET generic hosting'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-7531896186972577233</id><published>2020-09-04T06:25:00.003+01:00</published><updated>2020-09-04T06:25:32.502+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='newsfeed'/><title type='text'>Why your team needs a newsfeed</title><content type='html'>&lt;p&gt;I&amp;#39;m part of a team that builds an online platform. I&amp;#39;m often preoccupied by how to narrow the gap between our users and &amp;quot;us&amp;quot; - the people that build the platform. It&amp;#39;s important we understand how people use and interact with what we&amp;#39;ve built. If we don&amp;#39;t then we&amp;#39;re liable to waste our time and energy building the wrong things.  Or the wrong amount of the right things.&lt;/p&gt;&lt;p&gt;On a recent holiday I spent a certain amount of time pondering how to narrow the gap between our user and us. We have lots of things that help us; we use various analytics tools like &lt;a href="https://mixpanel.com/"&gt;mixpanel&lt;/a&gt;,  we&amp;#39;ve got a mini analytics platform of our own, we have teams notifications that pop up client feedback and so on. They are all great, but they&amp;#39;re somewhat disparate; they don&amp;#39;t give us a clear insight as to who uses our platform and how they do so. The information is there, but it&amp;#39;s tough to grok. It doesn&amp;#39;t make for a joined up story.&lt;/p&gt;&lt;p&gt;Reaching around for how to solve this I had an idea: what if our platform had a newsfeed? The kind of thing that social media platforms the likes of Twitter and Facebook have used to great effect; a stream of mini-activities which show how the community interacts with the product. People logging in and browsing around, using features on the platform. If we could see this in near real time we&amp;#39;d be brought closer to our users; we&amp;#39;d have something that would help us have real empathy and understanding. We&amp;#39;d see our product as the stories of users interacting with it.&lt;/p&gt;&lt;h4 id="how-do-you-build-a-newsfeed-"&gt;How do you build a newsfeed?&lt;/h4&gt;&lt;p&gt;This was an experiment that seemed worth pursuing. So I decided to build a proof of concept and see what happened. Now I intended to put the &amp;quot;M&amp;quot; into MVP with this; I went in with a number of intentional constraints:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;The news feed wouldn&amp;#39;t auto update (users have the F5 key for that)&lt;/li&gt;&lt;li&gt;We&amp;#39;d host the newsfeed in our own mini analytics platform (which is already used by the team to understand how people use the platform)&lt;/li&gt;&lt;li&gt;News stories wouldn&amp;#39;t be stored anywhere; we&amp;#39;d generate them on the fly by querying various databases / APIs. The cost of this would be that our news stories wouldn&amp;#39;t be &amp;quot;persistent&amp;quot;; you wouldn&amp;#39;t be able to address them with a URL; there&amp;#39;d be no way to build &amp;quot;like&amp;quot; or &amp;quot;share&amp;quot; functionality.&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;All of the above constraints are, importantly, reversable decisions. If we want auto update it could be built later. If we want the newsfeed to live somewhere else we could move it. If we wanted news stories to be persisted then we could do that.&lt;/p&gt;&lt;h4 id="implementation"&gt;Implementation&lt;/h4&gt;&lt;p&gt;With these constraints in mind, I turned my attention to the implementation. I built a &lt;code&gt;NewsFeedService&lt;/code&gt; that would be queried for news stories. The interface I decided to build looked like this:&lt;/p&gt;&lt;pre class="prettyprint ts"&gt;&lt;code&gt;NewsFeedService.getNewsFeed(from: Date, to: Date): NewsFeed&lt;br /&gt;&lt;br /&gt;type NewsFeed {&lt;br /&gt;    startedAt: Date;&lt;br /&gt;    ended at: Date;&lt;br /&gt;    stories: NewsStory[];&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;type NewsStory {&lt;br /&gt;    /** When the story happened */&lt;br /&gt;    happenedAt: Date;&lt;br /&gt;    /** A code that represents the type of story this is; eg USER_SESSION */&lt;br /&gt;    storyCode: string&lt;br /&gt;    /** The story details in markdown format */&lt;br /&gt;    story: string;&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Each query to &lt;code&gt;NewsFeedService.getNewsFeed&lt;/code&gt; would query various databases / APIs related to our product, looking for interesting events. Whether it be users logging in, users performing some kind of action, whatever. For each interested event a news story like this would be produced:&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;Jane Smith logged in at 10:03am for 25 minutes. They placed &lt;a href="https://my-glorious-platform.io/orders/janes-order"&gt;an order&lt;/a&gt; worth 3,000.&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;Now the killer feature here is &lt;a href="https://en.wikipedia.org/wiki/Markdown#:~:text=Markdown%20is%20a%20lightweight%20markup,using%20a%20plain%20text%20editor."&gt;Markdown&lt;/a&gt;. Our stories are written in Markdown. Why is Markdown cool? Well &lt;a href="https://web.archive.org/web/20040402182332/http://daringfireball.net/projects/markdown/"&gt;to quote the creators of Markdown&lt;/a&gt;:&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;Markdown allows you to write using an easy-to-read, easy-to-write plain text format, then convert it to structurally valid XHTML (or HTML).&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;This crucially includes the ability to include links. This was significant because I want us to be able to be able to click on pieces of information in the stories and be taken to the relevant place in the platform to see more details.  Just as you see status updates on, for example, Twitter which lead you on to more details: &lt;/p&gt; &lt;blockquote class="twitter-tweet"&gt;&lt;p lang="en" dir="ltr"&gt;This is the history of &lt;a href="https://twitter.com/DefinitelyTyped?ref_src=twsrc%5Etfw"&gt;@DefinitelyTyped&lt;/a&gt;: &lt;a href="https://t.co/AY6s3bWnKP"&gt;https://t.co/AY6s3bWnKP&lt;/a&gt; &lt;br&gt;&lt;br&gt;Thanks to &lt;a href="https://twitter.com/SeaRyanC?ref_src=twsrc%5Etfw"&gt;@SeaRyanC&lt;/a&gt; &amp;amp; &lt;a href="https://twitter.com/drosenwasser?ref_src=twsrc%5Etfw"&gt;@drosenwasser&lt;/a&gt; of the &lt;a href="https://twitter.com/typescript?ref_src=twsrc%5Etfw"&gt;@typescript&lt;/a&gt; team, &lt;a href="https://twitter.com/blakeembrey?ref_src=twsrc%5Etfw"&gt;@blakeembrey&lt;/a&gt; inventor of typings, &lt;a href="https://twitter.com/vvakame?ref_src=twsrc%5Etfw"&gt;@vvakame&lt;/a&gt;, &lt;a href="https://twitter.com/_stevefenton?ref_src=twsrc%5Etfw"&gt;@_stevefenton&lt;/a&gt;, &lt;a href="https://twitter.com/basarat?ref_src=twsrc%5Etfw"&gt;@basarat&lt;/a&gt;, and of course &lt;a href="https://twitter.com/borisyankov?ref_src=twsrc%5Etfw"&gt;@borisyankov&lt;/a&gt; for telling me their parts of the story&lt;/p&gt;&amp;mdash; John Reilly (@johnny_reilly) &lt;a href="https://twitter.com/johnny_reilly/status/1181542739994976256?ref_src=twsrc%5Etfw"&gt;October 8, 2019&lt;/a&gt;&lt;/blockquote&gt; &lt;script async src="https://platform.twitter.com/widgets.js" charset="utf-8"&gt;&lt;/script&gt; &lt;p&gt;Again consider this example news story:&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;Jane Smith logged in at 10:03am for 25 minutes. They placed &lt;a href="https://my-glorious-platform.io/orders/janes-order"&gt;an order&lt;/a&gt; worth 3,000.&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;Consider that story but without a link. It&amp;#39;s not the same is it? A newsfeed without links would be missing a trick. Markdown gives us links. And happily due to my extensive work down the open source mines, I speak it like a native.&lt;/p&gt;&lt;p&gt;The first consumer of the newsfeed was to be our own mini analytics platform, which is a React app. Converting the markdown stories to React is a solved problem thanks to the wonderful &lt;a href="https://github.com/rexxars/react-markdown"&gt;react-markdown&lt;/a&gt;. You can simply sling Markdown at it and out comes HTML. Et voil a news feed!&lt;/p&gt;&lt;h4 id="what-s-next-"&gt;What&amp;#39;s next?&lt;/h4&gt;&lt;p&gt;So that&amp;#39;s it!  We&amp;#39;ve built a (primitive) news feed.  We can now see in real time how are users are getting on.  We&amp;#39;re closer to them, we understand them better as a consequence. If we want to take it further there&amp;#39;s a number of things we could do:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;We could make the feed auto-update&lt;/li&gt;&lt;li&gt;We could push news stories to other destinations.  Markdown is a gloriously portable format which can be used in a variety of environments.  For instance the likes of Slack and &lt;a href="https://blog.johnnyreilly.com/2019/12/automating-teams-notifications-recently.html"&gt;Teams&lt;/a&gt; accept it and apps like these are generally open on people's desktops and phones all the time anyway.  Another way to narrow the gap between us and and our users.&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;It&amp;#39;s very exciting!&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7531896186972577233'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7531896186972577233'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2020/09/why-your-team-needs-newsfeed.html' title='Why your team needs a newsfeed'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3236560144551004278</id><published>2020-08-09T21:41:00.001+01:00</published><updated>2020-08-09T21:41:24.815+01:00</updated><category scheme='http://www.blogger.com/atom/ns#' term='git clone'/><category scheme='http://www.blogger.com/atom/ns#' term='devcontainer'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='performance'/><category scheme='http://www.blogger.com/atom/ns#' term='SSH'/><title type='text'>Devcontainers AKA performance in a secure sandbox</title><content type='html'>&lt;p&gt;Many corporate machines arrive in engineers hands with a preponderance of pre-installed background tools; from virus checkers to backup utilities to port blockers; the list is long.&lt;/p&gt;&lt;p&gt;The reason that these tools are installed is generally noble.  However, the implementation can often be problematic. The tools may be set up in such a way as they impact and interfere with one another.  Really powerful machines with 8 CPUs and hardy SSDs can be slowed to a crawl.  Put simply: the good people responsible for ensuring security are rarely encouraged to incentivise performance alongside it.  And so don&amp;#39;t.&lt;/p&gt;&lt;p&gt;The unfortunate consequence of considering the role of security without regard to performance is this: sluggish computers.  The further consequence (and this is the one I want you to think long and hard about) is &lt;em&gt;low developer productivity&lt;/em&gt;.  And that sucks.  It impacts what an organisation is able to do, how fast an organisation is able to move. Put simply: it can be the difference between success and failure.&lt;/p&gt;&lt;p&gt;The most secure computer is off. But you won&amp;#39;t ship much with it. Encouraging your organisation to consider tackling security with performance in mind is worthwhile. It&amp;#39;s a long game though.  In the meantime what can we do?&lt;/p&gt;&lt;h4 id="hide-from-the-virus-checkers-in-a-devcontainer"&gt;&amp;quot;Hide from the virus checkers&lt;em&gt;*&lt;/em&gt; in a devcontainer&amp;quot;&lt;/h4&gt;&lt;p&gt;Devcontainers, the infrastructure as code equivalent for developing software, have an underappreciated quality: unlocking your machine&amp;#39;s performance.  &lt;/p&gt;&lt;p&gt;Devcontainers are isolated secure sandboxes in which you can build software. To quote the &lt;a href="https://code.visualstudio.com/docs/remote/containers"&gt;docs&lt;/a&gt;:&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;A &lt;code&gt;devcontainer.json&lt;/code&gt; file in your project tells VS Code how to access (or create) a development container with a well-defined tool and runtime stack. This container can be used to run an application or to sandbox tools, libraries, or runtimes needed for working with a codebase.&lt;/p&gt;&lt;p&gt;Workspace files are mounted from the local file system or copied or &lt;em&gt;cloned into the container&lt;/em&gt;.  &lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;We&amp;#39;re going to set up a devcontainer to code an ASP.NET Core application with a JavaScript (well TypeScript) front end. If there&amp;#39;s one thing that&amp;#39;s sure to catch a virus checkers beady eye, it&amp;#39;s &lt;code&gt;node_modules&lt;/code&gt;.  &lt;code&gt;node_modules&lt;/code&gt; contains more files than a black hole has mass.  Consider a project with 5,000 source files. One trusty &lt;code&gt;yarn&lt;/code&gt; later and the folder now has a tidy 250,000 files.  The virus checker is now really sitting up and taking notice.&lt;/p&gt;&lt;p&gt;Our project has a &lt;code&gt;git commit&lt;/code&gt; hook set up with &lt;a href="https://github.com/typicode/husky"&gt;Husky&lt;/a&gt; that formats our TypeScript files with &lt;a href="https://prettier.io/"&gt;Prettier&lt;/a&gt;. Every commit the files are formatted to align with the project standard.  With all the virus checkers in place a &lt;code&gt;git commit&lt;/code&gt; takes around 45 seconds. Inside a devcontainer we can drop this to 5 seconds. That&amp;#39;s nine times faster.  I&amp;#39;ll repeat that: that&amp;#39;s &lt;strong&gt;nine times faster&lt;/strong&gt;!&lt;/p&gt;&lt;p&gt;The &amp;quot;cloned into a container&amp;quot; above is key to what we&amp;#39;re going to do. We&amp;#39;re &lt;em&gt;not&lt;/em&gt; going to mount our local file system into the devcontainer. Oh no.  We&amp;#39;re going to build a devcontainer with ASP.NET CORE and JavaScript in.  Then, inside there, we&amp;#39;re going to clone our repo.  Then we can develop, build and debug all inside the container.  It will feel like we&amp;#39;re working on our own machine because VS Code does such a damn fine job.  In reality, we&amp;#39;re connecting to another computer (a Linux computer to boot) that is running in isolation to our own.  In our case that machine is sharing our hardware; but that&amp;#39;s just an implementation detail.  It could be anywhere (and in the future may well be).&lt;/p&gt;&lt;h4 id="make-me-a-devcontainer-"&gt;Make me a devcontainer...&lt;/h4&gt;&lt;p&gt;Enough talk... We&amp;#39;re going to need a &lt;code&gt;.devcontainer/devcontainer.json&lt;/code&gt;:&lt;/p&gt;&lt;pre class="prettyprint"&gt;&lt;code class="lang-json"&gt;{&lt;br /&gt;  &amp;quot;name&amp;quot;: &amp;quot;my devcontainer&amp;quot;,&lt;br /&gt;  &amp;quot;dockerComposeFile&amp;quot;: &amp;quot;../docker-compose.devcontainer.yml&amp;quot;,&lt;br /&gt;  &amp;quot;service&amp;quot;: &amp;quot;my-devcontainer&amp;quot;,&lt;br /&gt;  &amp;quot;workspaceFolder&amp;quot;: &amp;quot;/workspace&amp;quot;,&lt;br /&gt;&lt;br /&gt;  // Set *default* container specific settings.json values on container create.&lt;br /&gt;  &amp;quot;settings&amp;quot;: {&lt;br /&gt;    &amp;quot;terminal.integrated.shell.linux&amp;quot;: &amp;quot;/bin/zsh&amp;quot;&lt;br /&gt;  },&lt;br /&gt;&lt;br /&gt;  // Add the IDs of extensions you want installed when the container is created.&lt;br /&gt;  &amp;quot;extensions&amp;quot;: [&lt;br /&gt;    &amp;quot;ms-dotnettools.csharp&amp;quot;,&lt;br /&gt;    &amp;quot;dbaeumer.vscode-eslint&amp;quot;,&lt;br /&gt;    &amp;quot;esbenp.prettier-vscode&amp;quot;,&lt;br /&gt;    &amp;quot;ms-mssql.mssql&amp;quot;,&lt;br /&gt;    &amp;quot;eamodio.gitlens&amp;quot;,&lt;br /&gt;    &amp;quot;ms-azuretools.vscode-docker&amp;quot;,&lt;br /&gt;    &amp;quot;k--kato.docomment&amp;quot;,&lt;br /&gt;    &amp;quot;Leopotam.csharpfixformat&amp;quot;&lt;br /&gt;  ],&lt;br /&gt;&lt;br /&gt;  // Use &amp;#39;postCreateCommand&amp;#39; to clone the repo into the workspace folder when the devcontainer starts&lt;br /&gt;  // and copy in the .env file&lt;br /&gt;  &amp;quot;postCreateCommand&amp;quot;: &amp;quot;git clone git@github.com:my-org/my-repo.git . &amp;amp;&amp;amp; cp /.env /workspace/.env&amp;quot;&lt;br /&gt;&lt;br /&gt;  // &amp;quot;remoteUser&amp;quot;: &amp;quot;vscode&amp;quot;&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt; &lt;p&gt;Now the &lt;code&gt;docker-compose.devcontainer.yml&lt;/code&gt; which lives in the root of the project.  It provisions a SQL Server container (using the official image) and our devcontainer:&lt;/p&gt; &lt;pre class="prettyprint"&gt;&lt;code&gt;version: &amp;quot;3.7&amp;quot;&lt;br /&gt;services:&lt;br /&gt;  my-devcontainer:&lt;br /&gt;    image: my-devcontainer&lt;br /&gt;    build: &lt;br /&gt;      context: .&lt;br /&gt;      dockerfile: Dockerfile.devcontainer&lt;br /&gt;    command: /bin/zsh -c &amp;quot;while sleep 1000; do :; done&amp;quot;&lt;br /&gt;    volumes:&lt;br /&gt;      # mount .zshrc from home - make sure it doesn&amp;#39;t contain Windows line endings&lt;br /&gt;      - ~/.zshrc:/root/.zshrc&lt;br /&gt;&lt;br /&gt;    # user: vscode&lt;br /&gt;    ports:&lt;br /&gt;      - &amp;quot;5000:5000&amp;quot;&lt;br /&gt;      - &amp;quot;8080:8080&amp;quot;&lt;br /&gt;    environment:&lt;br /&gt;      - CONNECTIONSTRINGS__MYDATABASECONNECTION&lt;br /&gt;    depends_on:&lt;br /&gt;      - db&lt;br /&gt;  db:&lt;br /&gt;    image: mcr.microsoft.com/mssql/server:2019-latest&lt;br /&gt;    privileged: true&lt;br /&gt;    ports:&lt;br /&gt;      - 1433:1433&lt;br /&gt;    environment:&lt;br /&gt;      SA_PASSWORD: &amp;quot;Your_password123&amp;quot;&lt;br /&gt;      ACCEPT_EULA: &amp;quot;Y&amp;quot;         &lt;br /&gt;&lt;/code&gt;&lt;/pre&gt; &lt;p&gt;The devcontainer will be built with the &lt;code&gt;Dockerfile.devcontainer&lt;/code&gt; in the root of our repo. It relies upon your SSH keys and a &lt;code&gt;.env&lt;/code&gt; file being available to be copied in:&lt;/p&gt; &lt;pre class="prettyprint"&gt;&lt;code&gt;&lt;br /&gt;#-----------------------------------------------------------------------------------------------------------&lt;br /&gt;# Based upon: https://github.com/microsoft/vscode-dev-containers/tree/master/containers/dotnetcore&lt;br /&gt;#-----------------------------------------------------------------------------------------------------------&lt;br /&gt;ARG VARIANT=&amp;quot;3.1-bionic&amp;quot;&lt;br /&gt;FROM mcr.microsoft.com/dotnet/core/sdk:${VARIANT}&lt;br /&gt;&lt;br /&gt;# Because MITM certificates&lt;br /&gt;COPY ./docker/certs/. /usr/local/share/ca-certificates/&lt;br /&gt;ENV NODE_EXTRA_CA_CERTS=/usr/local/share/ca-certificates/mitm.pem&lt;br /&gt;RUN update-ca-certificates &lt;br /&gt;&lt;br /&gt;# This Dockerfile adds a non-root user with sudo access. Use the &amp;quot;remoteUser&amp;quot;&lt;br /&gt;# property in devcontainer.json to use it. On Linux, the container user&amp;#39;s GID/UIDs&lt;br /&gt;# will be updated to match your local UID/GID (when using the dockerFile property).&lt;br /&gt;# See https://aka.ms/vscode-remote/containers/non-root-user for details.&lt;br /&gt;ARG USERNAME=vscode&lt;br /&gt;ARG USER_UID=1000&lt;br /&gt;ARG USER_GID=$USER_UID&lt;br /&gt;&lt;br /&gt;# Options for common package install script&lt;br /&gt;ARG INSTALL_ZSH=&amp;quot;true&amp;quot;&lt;br /&gt;ARG UPGRADE_PACKAGES=&amp;quot;true&amp;quot;&lt;br /&gt;ARG COMMON_SCRIPT_SOURCE=&amp;quot;https://raw.githubusercontent.com/microsoft/vscode-dev-containers/master/script-library/common-debian.sh&amp;quot;&lt;br /&gt;ARG COMMON_SCRIPT_SHA=&amp;quot;dev-mode&amp;quot;&lt;br /&gt;&lt;br /&gt;# Settings for installing Node.js.&lt;br /&gt;ARG INSTALL_NODE=&amp;quot;true&amp;quot;&lt;br /&gt;ARG NODE_SCRIPT_SOURCE=&amp;quot;https://raw.githubusercontent.com/microsoft/vscode-dev-containers/master/script-library/node-debian.sh&amp;quot;&lt;br /&gt;ARG NODE_SCRIPT_SHA=&amp;quot;dev-mode&amp;quot;&lt;br /&gt;&lt;br /&gt;# ARG NODE_VERSION=&amp;quot;lts/*&amp;quot;&lt;br /&gt;ARG NODE_VERSION=&amp;quot;14&amp;quot;&lt;br /&gt;ENV NVM_DIR=/usr/local/share/nvm&lt;br /&gt;&lt;br /&gt;# Have nvm create a &amp;quot;current&amp;quot; symlink and add to path to work around https://github.com/microsoft/vscode-remote-release/issues/3224&lt;br /&gt;ENV NVM_SYMLINK_CURRENT=true&lt;br /&gt;ENV PATH=${NVM_DIR}/current/bin:${PATH}&lt;br /&gt;&lt;br /&gt;# Configure apt and install packages&lt;br /&gt;RUN apt-get update \&lt;br /&gt;    &amp;amp;&amp;amp; export DEBIAN_FRONTEND=noninteractive \&lt;br /&gt;    #&lt;br /&gt;    # Verify git, common tools / libs installed, add/modify non-root user, optionally install zsh&lt;br /&gt;    &amp;amp;&amp;amp; apt-get -y install --no-install-recommends curl ca-certificates 2&amp;gt;&amp;amp;1 \&lt;br /&gt;    &amp;amp;&amp;amp; curl -sSL ${COMMON_SCRIPT_SOURCE} -o /tmp/common-setup.sh \&lt;br /&gt;    &amp;amp;&amp;amp; ([ &amp;quot;${COMMON_SCRIPT_SHA}&amp;quot; = &amp;quot;dev-mode&amp;quot; ] || (echo &amp;quot;${COMMON_SCRIPT_SHA} */tmp/common-setup.sh&amp;quot; | sha256sum -c -)) \&lt;br /&gt;    &amp;amp;&amp;amp; /bin/bash /tmp/common-setup.sh &amp;quot;${INSTALL_ZSH}&amp;quot; &amp;quot;${USERNAME}&amp;quot; &amp;quot;${USER_UID}&amp;quot; &amp;quot;${USER_GID}&amp;quot; &amp;quot;${UPGRADE_PACKAGES}&amp;quot; \&lt;br /&gt;    #&lt;br /&gt;    # Install Node.js&lt;br /&gt;    &amp;amp;&amp;amp; curl -sSL ${NODE_SCRIPT_SOURCE} -o /tmp/node-setup.sh \&lt;br /&gt;    &amp;amp;&amp;amp; ([ &amp;quot;${NODE_SCRIPT_SHA}&amp;quot; = &amp;quot;dev-mode&amp;quot; ] || (echo &amp;quot;${COMMON_SCRIPT_SHA} */tmp/node-setup.sh&amp;quot; | sha256sum -c -)) \&lt;br /&gt;    &amp;amp;&amp;amp; /bin/bash /tmp/node-setup.sh &amp;quot;${NVM_DIR}&amp;quot; &amp;quot;${NODE_VERSION}&amp;quot; &amp;quot;${USERNAME}&amp;quot; \&lt;br /&gt;    #&lt;br /&gt;    # Clean up&lt;br /&gt;    &amp;amp;&amp;amp; apt-get autoremove -y \&lt;br /&gt;    &amp;amp;&amp;amp; apt-get clean -y \&lt;br /&gt;    &amp;amp;&amp;amp; rm -f /tmp/common-setup.sh /tmp/node-setup.sh \&lt;br /&gt;    &amp;amp;&amp;amp; rm -rf /var/lib/apt/lists/* \&lt;br /&gt;    #&lt;br /&gt;    # Workspace&lt;br /&gt;    &amp;amp;&amp;amp; mkdir workspace \&lt;br /&gt;    &amp;amp;&amp;amp; chown -R ${NONROOT_USER}:root workspace&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;# Install Vim&lt;br /&gt;RUN apt-get update &amp;amp;&amp;amp; apt-get install -y \&lt;br /&gt;    vim \&lt;br /&gt;    &amp;amp;&amp;amp; rm -rf /var/lib/apt/lists/*&lt;br /&gt;&lt;br /&gt;# Set up a timezone in the devcontainer - necessary for anything timezone dependent&lt;br /&gt;ENV TZ=Europe/London&lt;br /&gt;RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime &amp;amp;&amp;amp; echo $TZ &amp;gt; /etc/timezone \&lt;br /&gt; &amp;amp;&amp;amp; apt-get update \&lt;br /&gt; &amp;amp;&amp;amp; apt-get install --no-install-recommends -y \&lt;br /&gt;    apt-utils \&lt;br /&gt;    tzdata  \&lt;br /&gt; &amp;amp;&amp;amp; apt-get autoremove -y \&lt;br /&gt; &amp;amp;&amp;amp; apt-get clean -y \&lt;br /&gt; &amp;amp;&amp;amp; rm -rf /var/lib/apt/lists/* &lt;br /&gt;&lt;br /&gt;ENV DOTNET_RUNNING_IN_CONTAINER=true &lt;br /&gt;&lt;br /&gt;# Copy across SSH keys so you can git clone&lt;br /&gt;RUN mkdir /root/.ssh&lt;br /&gt;RUN chmod 700 /root/.ssh&lt;br /&gt;&lt;br /&gt;COPY .ssh/id_rsa /root/.ssh&lt;br /&gt;RUN chmod 600 /root/.ssh/id_rsa&lt;br /&gt;&lt;br /&gt;COPY .ssh/id_rsa.pub /root/.ssh&lt;br /&gt;RUN chmod 644 /root/.ssh/id_rsa.pub&lt;br /&gt;&lt;br /&gt;COPY .ssh/known_hosts /root/.ssh&lt;br /&gt;RUN chmod 644 /root/.ssh/known_hosts  &lt;br /&gt;&lt;br /&gt;# Disable initial git clone prompt&lt;br /&gt;RUN echo &amp;quot;StrictHostKeyChecking no&amp;quot; &amp;gt;&amp;gt; /etc/ssh/ssh_config&lt;br /&gt;&lt;br /&gt;# Copy across .env file so you can customise environment variables&lt;br /&gt;# This will be copied into the root of the repo post git clone&lt;br /&gt;COPY .env /.env&lt;br /&gt;RUN chmod 644 /.env  &lt;br /&gt;&lt;br /&gt;# Install dotnet entity framework tools&lt;br /&gt;RUN dotnet tool install dotnet-ef --tool-path /usr/local/bin --version 3.1.2 &lt;br /&gt;&lt;/code&gt;&lt;/pre&gt; &lt;p&gt;With this devcontainer you&amp;#39;re good to go for an ASP.NET Core / JavaScript developer setup that is blazing fast!  Remember to fire up Docker and give it goodly access to the resources of your host machine.  All the CPUs, lots of memory and all the performance that there ought to be.&lt;/p&gt; &lt;p&gt;&lt;em&gt;* &amp;quot;virus checkers&amp;quot; is a euphemism here for all the background tools that may be running.  It was that or calling them &amp;quot;we are legion&amp;quot;&lt;/em&gt;&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3236560144551004278'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3236560144551004278'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2020/08/devcontainers-aka-performance-in-secure.html' title='Devcontainers AKA performance in a secure sandbox'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8714746353120316315</id><published>2020-07-11T20:10:00.001+01:00</published><updated>2020-07-11T20:10:42.705+01:00</updated><category scheme='http://www.blogger.com/atom/ns#' term='devcontainer'/><category scheme='http://www.blogger.com/atom/ns#' term='mitm certificate'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='ssl interception'/><title type='text'>Devcontainers and SSL interception</title><content type='html'>&lt;p&gt;&lt;a href="https://code.visualstudio.com/docs/remote/containers"&gt;Devcontainers&lt;/a&gt; are cool. They are the infrastructure as code equivalent for developing software.&lt;/p&gt;&lt;p&gt;Imagine your new starter joins the team, you&amp;#39;d like them to be contributing code on &lt;em&gt;day 1&lt;/em&gt;. But if the first thing that happens is you hand them a sheaf of paper upon which are the instructions for how to get their machines set up for development, well, maybe it&amp;#39;s going to be a while. But if your project has a devcontainer then you&amp;#39;re off to the races. One trusty &lt;code&gt;git clone&lt;/code&gt;, fire up VS Code and they can get going.&lt;/p&gt;&lt;p&gt;That&amp;#39;s the dream right?&lt;/p&gt;&lt;p&gt;I&amp;#39;ve recently been doing some work getting a project I work on set up with a devcontainer. As I&amp;#39;ve worked on that I&amp;#39;ve become aware of some of the hurdles that might hamper your adoption of devcontainers in a corporate environment.&lt;/p&gt;&lt;h4 id="certificates-i-m-starting-with-the-man-in-the-middle"&gt;Certificates: I&amp;#39;m starting with the man in the middle&lt;/h4&gt;&lt;p&gt;It is a common practice in company networks to perform &lt;a href="https://docs.citrix.com/en-us/citrix-adc/13/forward-proxy/ssl-interception.html"&gt;SSL interception&lt;/a&gt;. Not SSL inception; that&amp;#39;d be more fun.&lt;/p&gt; &lt;div style="width:100%;height:0;padding-bottom:56%;position:relative;"&gt;&lt;iframe src="https://giphy.com/embed/l7JDTHpsXM26k" width="100%" height="100%" style="position:absolute" frameBorder="0" class="giphy-embed" allowFullScreen&gt;&lt;/iframe&gt;&lt;/div&gt; &lt;p&gt;SSL interception is the practice of installing a &amp;quot;man-in-the-middle&amp;quot; (MITM) CA certificate on users machines. When SSL traffic takes place from a users machine, it goes through a proxy. That proxy performs the SSL on behalf of that user and, if it&amp;#39;s happy, supplies another certificate back to the users machine which satisfies the MITM CA certificate. So rather than seeing, for example, Google&amp;#39;s certificate from &lt;a href="https://google.com"&gt;https://google.com&lt;/a&gt; you&amp;#39;d see the one resulting from the SSL interception. You can read more &lt;a href="https://security.stackexchange.com/questions/107542/is-it-common-practice-for-companies-to-mitm-https-traffic"&gt;here&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;Now this is a little known and less understood practice. I barely understand it myself. Certificates are &lt;em&gt;hard&lt;/em&gt;. Even having read the above you may be none the wiser about why this is relevant. Let&amp;#39;s get to the broken stuff.&lt;/p&gt;&lt;h4 id="devcontainers-don-t-work-at-work-"&gt;&amp;quot;Devcontainers don&amp;#39;t work at work!&amp;quot;&lt;/h4&gt;&lt;p&gt;So, you&amp;#39;re ready to get going with your first devcontainer.  You fire up the &lt;a href="https://github.com/Microsoft/vscode-dev-containers"&gt;vscode-dev-containers&lt;/a&gt; repo and find the container that&amp;#39;s going to work for you.  Copy pasta the &lt;code&gt;.devcontainer&lt;/code&gt; into your repo, install the &lt;a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.vscode-remote-extensionpack"&gt;Remote Development&lt;/a&gt; extension into VS Code and enter the &lt;code&gt;Remote-Containers: Reopen Folder in Container&lt;/code&gt;. Here comes the future!&lt;/p&gt;&lt;p&gt;But when it comes to performing SSL inside the devcontainer, trouble awaits.  Here&amp;#39;s what a &lt;code&gt;yarn install&lt;/code&gt; results in:&lt;/p&gt;&lt;pre class="prettyprint"&gt;&lt;code&gt;yarn install v1.22.4&lt;br /&gt;[1/4] Resolving packages...&lt;br /&gt;[2/4] Fetching packages...&lt;br /&gt;error An unexpected error occurred: &amp;quot;https://registry.yarnpkg.com/@octokit/core/-/core-2.5.0.tgz: self signed certificate in certificate chain&amp;quot;.&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Oh no!&lt;/p&gt;&lt;p&gt;Gosh but it&amp;#39;s okay - you&amp;#39;re just bumping on the SSL interception. Why though? Well it&amp;#39;s like this: when you fire up your devcontainer it builds a new Docker container. It&amp;#39;s as well to imagine the container as a virtual operating system. So what&amp;#39;s the difference between this operating system and the one our machine is running? Well a number of things, but crucially our host operating system has the MITM CA certificate installed. So when we SSL, we have the certificate that will match up with what the proxy sends back to us certificate-wise. And inside our trusty devcontainer we don&amp;#39;t have that. Hence the sadness.&lt;/p&gt;&lt;h4 id="devcontainer-mitm-cert-working"&gt;Devcontainer + MITM cert = working&lt;/h4&gt;&lt;p&gt;We need to do two things to get this working:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;Acquire the requisite CA certificate(s) from your friendly neighbourhood networking team. Place them in a &lt;code&gt;certs&lt;/code&gt; folder inside your repo, in the &lt;code&gt;.devcontainer&lt;/code&gt; folder.&lt;/li&gt;&lt;li&gt;Add the following lines to your &lt;code&gt;.devcontainer/Dockerfile&lt;/code&gt;, just after the initial &lt;code&gt;FROM&lt;/code&gt; statement:&lt;/li&gt;&lt;/ol&gt;&lt;pre class="prettyprint"&gt;&lt;code&gt;# Because MITM certificates&lt;br /&gt;COPY certs/. /usr/local/share/ca-certificates/&lt;br /&gt;ENV NODE_EXTRA_CA_CERTS=/usr/local/share/ca-certificates/mitm.pem&lt;br /&gt;RUN update-ca-certificates&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt; &lt;p&gt;Which does the following:&lt;/p&gt; &lt;ul&gt;  &lt;li&gt;Copies the certs into the devcontainer&lt;/li&gt;  &lt;li&gt;This is a Node example and so we set an environment variable called &lt;a href="https://nodejs.org/api/cli.html#cli_node_extra_ca_certs_file"&gt;&lt;code&gt;NODE_EXTRA_CA_CERTS&lt;/code&gt;&lt;/a&gt; which points to the path of your MITM CA certificate file inside your devcontainer.&lt;/li&gt;  &lt;li&gt;updates the directory &lt;code&gt;/etc/ssl/certs&lt;/code&gt; to hold SSL certificates and generates &lt;code&gt;ca-certificates.crt&lt;/code&gt;&lt;/li&gt;&lt;/ul&gt; &lt;p&gt;With these in place then you should be able to build your devcontainer with no SSL trauma. Enjoy!&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8714746353120316315'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8714746353120316315'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2020/07/devcontainers-and-ssl-interception.html' title='Devcontainers and SSL interception'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1528655303350306993</id><published>2020-06-21T12:34:00.000+01:00</published><updated>2020-06-21T12:34:02.960+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Task.WhenAll / Select is a footgun </title><content type='html'>&lt;p&gt;This post differs from my typical fayre. Most often I write &amp;quot;here&amp;#39;s how to do a thing&amp;quot;. This is not that. It&amp;#39;s more &amp;quot;don&amp;#39;t do this thing I did&amp;quot;. And maybe also, &amp;quot;how can we avoid a situation like this happening again in future?&amp;quot;. On this topic I very much don&amp;#39;t have all the answers - but by putting my thoughts down maybe I&amp;#39;ll learn and maybe others will educate me. I would love that!&lt;/p&gt;&lt;h4 id="doing-things-that-don-t-scale"&gt;Doing things that don&amp;#39;t scale&lt;/h4&gt;&lt;p&gt;The platform that I work on once had zero users. We used to beg people to log in and see what we had built. Those days are (happily) but a memory. We&amp;#39;re getting popular.&lt;/p&gt;&lt;p&gt;As our platform has grown in popularity it has revealed some bad choices we made. Approaches that look fine on the surface (and that work just dandy when you have no users) may start to cause problems as your number of users grows.&lt;/p&gt;&lt;p&gt;I wanted to draw attention to one approach in particular that impacted us severely. In this case &amp;quot;impacted us severely&amp;quot; is a euphemism for &amp;quot;brought the site down and caused a critical incident&amp;quot;.&lt;/p&gt;&lt;p&gt;You don&amp;#39;t want this to happen to you. Trust me. So, what follows is a cautionary tale. The purpose of which is simply this: reader, do you have code of this ilk in your codebase? If you do: out, damn&amp;#39;d spot! out, I say!&lt;/p&gt;&lt;h4 id="so-cool-so-terrible"&gt;So cool, so terrible&lt;/h4&gt;&lt;p&gt;I love LINQ. I love a declarative / functional style of coding. It appeals to me on some gut level. I find it tremendously readable. Read any C# of mine and the odds are pretty good that you&amp;#39;ll find some LINQ in the mix.&lt;/p&gt;&lt;p&gt;Imagine this scenario: you have a collection of user ids. You want to load the details of each user represented by their id from an API. You want to bag up all of those users into some kind of collection and send it back to the calling code.&lt;/p&gt;&lt;p&gt;Reading that, if you&amp;#39;re like me, you&amp;#39;re imagining some kind of map operation which loads the user details for each user id. Something like this:&lt;/p&gt;&lt;pre class="prettyprint cs"&gt;&lt;code class="lang-cs"&gt;var users = userIds.Select(userId =&amp;gt; GetUserDetails(userId)).ToArray(); // users is User[]&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Lovely. But you&amp;#39;ll note that I&amp;#39;m loading users from an API. Oftentimes, APIs are asynchronous. Certainly, in my case they were. So rather than calling a &lt;code&gt;GetUserDetails&lt;/code&gt; function I found myself calling a &lt;code&gt;GetUserDetailsAsync&lt;/code&gt; function, behind which an HTTP request is being sent and, later, a response is being returned.&lt;/p&gt;&lt;p&gt;So how do we deal with this? &lt;a href="https://docs.microsoft.com/en-us/dotnet/api/system.threading.tasks.task.whenall?view=netcore-3.1#System_Threading_Tasks_Task_WhenAll__1_System_Collections_Generic_IEnumerable_System_Threading_Tasks_Task___0___"&gt;&lt;code&gt;Task.WhenAll&lt;/code&gt;&lt;/a&gt; my friends!&lt;/p&gt;&lt;pre class="prettyprint cs"&gt;&lt;code class="lang-cs"&gt;var userTasks = userIds.Select(userId =&amp;gt; GetUserDetailsAsync(userId));&lt;br /&gt;var users = await Task.WhenAll(tasks); // users is User[]&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;It worked great! Right up until to the point where it didn&amp;#39;t. These sorts of shenanigans were fine when we had a minimal number of users... But there came a point where problems arose. It got to the point where that simple looking mapping operation became a cause of many, many, &lt;em&gt;many&lt;/em&gt; HTTP requests being fired concurrently. Then bad things started to happen. Not only did we realise we were launching a denial of service attack on the API we were consuming, we were bringing our own application to collapse.&lt;/p&gt;&lt;p&gt;Not a proud day.&lt;/p&gt;&lt;h4 id="what-is-the-problem-"&gt;What is the problem?&lt;/h4&gt;&lt;p&gt;Through log analysis, code reading and speculation, (with the help of the invaluable &lt;a href="https://www.linkedin.com/in/robert-grzankowski-53618114"&gt;Robski&lt;/a&gt;) we came to realise that the cause of our woes was the &lt;code&gt;Task.WhenAll&lt;/code&gt; / &lt;code&gt;Select&lt;/code&gt; combination. Exercising that codepath was a surefire way to bring the application to its knees.&lt;/p&gt;&lt;p&gt;As I read around on the topic I happened upon &lt;a href="https://www.twitter.com/mark_heath"&gt;Mark Heath&lt;/a&gt;&amp;#39;s excellent list of &lt;a href="https://markheath.net/post/async-antipatterns"&gt;Async antipatterns&lt;/a&gt;. Number #6 on the list is &amp;quot;Excessive parallelization&amp;quot;. It describes a nearly identical scenario to my own:&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;Now, this does &amp;quot;work&amp;quot;, but what if there were 10,000 orders? We&amp;#39;ve flooded the thread pool with thousands of tasks, potentially preventing other useful work from completing. If &lt;code&gt;ProcessOrderAsync&lt;/code&gt; makes downstream calls to another service like a database or a microservice, we&amp;#39;ll potentially overload that with too high a volume of calls.&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;We&amp;#39;re definitely overloading the API we&amp;#39;re consuming with too high a volume of calls. I have to admit that I&amp;#39;m less clear on the direct reason that a &lt;code&gt;Task.WhenAll&lt;/code&gt; / &lt;code&gt;Select&lt;/code&gt; combination could prove fatal to our application. Mark suggests this approach will flood the thread pool with tasks. As I read around on &lt;code&gt;async&lt;/code&gt; and &lt;code&gt;await&lt;/code&gt; it&amp;#39;s repeated again and again that a &lt;code&gt;Task&lt;/code&gt; is not the same thing as a &lt;code&gt;Thread&lt;/code&gt;. I have to hold my hands up here and say that I don&amp;#39;t understand the implementation of &lt;code&gt;async&lt;/code&gt; / &lt;code&gt;await&lt;/code&gt; in C# well enough. &lt;a href="https://docs.microsoft.com/en-us/dotnet/standard/async-in-depth#deeper-dive-into-tasks-for-an-io-bound-operation"&gt;These docs are helpful but I still don&amp;#39;t think the penny has fully dropped for me yet.&lt;/a&gt;  I will continue to read.&lt;/p&gt;&lt;p&gt;One thing we learned as we debugged the production k8s pod was that, prior to its collapse, our app appeared to be opening up 1 million connections to the API we were consuming. Which seemed a bit much. Worthy of investigation. It&amp;#39;s worth saying that we&amp;#39;re not certain this is exactly what is happening; we have less instrumentation in place than we&amp;#39;d like. But some fancy wc grepping on Robski&amp;#39;s behalf suggested this was the case.&lt;/p&gt;&lt;h4 id="what-will-we-change-in-future-"&gt;What will we change in future?&lt;/h4&gt;&lt;p&gt;A learning that came out of this for us was this: we need more metrics exposed. We don&amp;#39;t understand our application&amp;#39;s behaviour under load as well as we&amp;#39;d like. So we&amp;#39;re planning to do some work with &lt;a href="https://www.app-metrics.io/"&gt;App Metrics&lt;/a&gt; and &lt;a href="https://grafana.com/"&gt;Grafana&lt;/a&gt; so we&amp;#39;ve a better idea of how our application performs. If you want to improve something, first measure it.&lt;/p&gt;&lt;p&gt;Another fly in the ointment was that we were unable to reproduce the issue when running locally. It&amp;#39;s worth saying here that I develop on a Windows machine and, when deployed, our application runs in a (Linux) Docker container. So there&amp;#39;s a difference and a distance between our development experience and our running one.&lt;/p&gt;&lt;p&gt;I&amp;#39;m planning to migrate to developing in a &lt;a href="https://code.visualstudio.com/docs/remote/containers"&gt;devcontainer&lt;/a&gt; where that&amp;#39;s possible. That should narrow the gap between our production experience and our development one. Reducing the difference between the two is always useful as it means you&amp;#39;re less likely to get different behaviour (ie &amp;quot;problems&amp;quot;) in production as compared to development. I&amp;#39;m curious as to whether I&amp;#39;ll be able to replicate that behaviour in a devcontainer.&lt;/p&gt;&lt;h4 id="what-did-we-do-right-now-"&gt;What did we do right now?&lt;/h4&gt;&lt;p&gt;To solve the immediate issue we were able to pivot away to a completely different approach. We moved aggregation from our ASP.NET Core web application to our TypeScript / React client with a (pretty sweet) custom hook. The topic for a subsequent blog post.&lt;/p&gt;&lt;p&gt;Moving to a different approach solved my immediate issue. But it left me puzzling. What was actually going wrong? Is it thread pool exhaustion? Is it something else? So many possibilities!&lt;/p&gt;&lt;p&gt;If anyone has any insights they&amp;#39;d like to share that would be incredible! I&amp;#39;ve also &lt;a href="https://stackoverflow.com/questions/62490098/task-whenall-with-select-is-a-footgun-but-why/62490705"&gt;asked a question on Stack Overflow&lt;/a&gt; which has kindly had answers from generous souls. &lt;a href="https://twitter.com/jamesskimming"&gt;James Skimming&lt;/a&gt;&amp;#39;s answer lead me to &lt;a href="https://www.stevejgordon.co.uk/httpclient-connection-pooling-in-dotnet-core"&gt;Steve Gordon&amp;#39;s excellent post on connection pooling&lt;/a&gt; which I&amp;#39;m still absorbing and seems like it could be relevant.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1528655303350306993'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1528655303350306993'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2020/06/taskwhenall-select-is-footgun.html' title='Task.WhenAll / Select is a footgun '/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3900810916190078063</id><published>2020-05-21T16:35:00.001+01:00</published><updated>2020-10-02T06:21:02.299+01:00</updated><category scheme='http://www.blogger.com/atom/ns#' term='autofac'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='ASP.Net Core'/><category scheme='http://www.blogger.com/atom/ns#' term='ConfigureTestContainer'/><category scheme='http://www.blogger.com/atom/ns#' term='Integration Testing'/><title type='text'>Autofac, WebApplicationFactory and integration tests</title><content type='html'>&lt;p&gt;&lt;strong&gt;Updated 2nd Oct 2020:&lt;/strong&gt; &lt;em&gt;for an approach that works with Autofac 6 see &lt;a href="https://blog.johnnyreilly.com/2020/10/autofac-6-integration-tests-and-generic-hosting.html"&gt;this post.&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;&lt;hr /&gt;&lt;p&gt;This is one of those occasions where I&amp;#39;m not writing up my own work so much as my discovery after in depth googling.&lt;/p&gt;&lt;p&gt;Integration tests with ASP.NET Core are the best. They spin up an in memory version of your application and let you fire requests at it. They&amp;#39;ve gone through a number of iterations since ASP.NET Core has been around. You may also be familiar with the &lt;code&gt;TestServer&lt;/code&gt; approach of earlier versions. For some time, the advised approach has been using &lt;code&gt;&lt;a href="https://docs.microsoft.com/en-us/aspnet/core/test/integration-tests?view=aspnetcore-3.1#basic-tests-with-the-default-webapplicationfactory"&gt;WebApplicationFactory&lt;/a&gt;&lt;/code&gt;.&lt;/p&gt;&lt;p&gt;What makes this approach particularly useful / powerful is that you can swap out dependencies of your running app with fakes / stubs etc. Just like unit tests! But potentially more useful because they run your whole app and hence give you a greater degree of confidence. What does this mean? Well, imagine you changed a piece of middleware in your application; this could potentially break functionality. Unit tests would probably not reveal this. Integration tests would.&lt;/p&gt;&lt;p&gt;There is a fly in the ointment. A hair in the gazpacho. ASP.NET Core ships with dependency injection in the box. It has its own Inversion of Control container which is perfectly fine. However, many people are accustomed to using other IOC containers such as &lt;a href="https://autofac.org/"&gt;Autofac&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;What&amp;#39;s the problem? Well, swapping out dependencies registered using ASP.NET Core&amp;#39;s IOC requires using a hook called &lt;a href="https://docs.microsoft.com/en-us/aspnet/core/test/integration-tests?view=aspnetcore-3.1#inject-mock-services"&gt;&lt;code&gt;ConfigureTestServices&lt;/code&gt;&lt;/a&gt;. There&amp;#39;s an equivalent hook for swapping out services registered using a custom IOC container: &lt;a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.testhost.webhostbuilderextensions.configuretestcontainer?view=aspnetcore-3.0"&gt;&lt;code&gt;ConfigureTestContainer&lt;/code&gt;&lt;/a&gt;. Unfortunately, there is a bug in ASP.NET Core as of version 3.0: &lt;a href="https://github.com/dotnet/aspnetcore/issues/14907"&gt;When using GenericHost, in tests &lt;code&gt;ConfigureTestContainer&lt;/code&gt; is not executed&lt;/a&gt;&lt;/p&gt;&lt;p&gt;This means you cannot swap out dependencies that have been registered with Autofac and the like. According to the tremendous &lt;a href="https://www.twitter.com/davidfowl"&gt;David Fowler&lt;/a&gt; of the ASP.NET team, &lt;a href="https://github.com/dotnet/aspnetcore/issues/14907#issuecomment-592102145"&gt;this will hopefully be resolved&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;In the meantime, &lt;a href="https://github.com/dotnet/aspnetcore/issues/14907#issuecomment-620750841"&gt;there&amp;#39;s a workaround thanks to various commenters on the thread&lt;/a&gt;.  Instead of using &lt;code&gt;WebApplicationFactory&lt;/code&gt; directly, subclass it and create a custom &lt;code&gt;AutofacWebApplicationFactory&lt;/code&gt; (the name is not important).  This custom class overrides the behavior of &lt;code&gt;ConfigureServices&lt;/code&gt; and &lt;code&gt;CreateHost&lt;/code&gt; with a &lt;code&gt;CustomServiceProviderFactory&lt;/code&gt;:&lt;/p&gt;&lt;pre class="prettyprint cs"&gt;&lt;code class="lang-cs"&gt;namespace My.Web.Tests.Helpers {&lt;br /&gt;    /// &amp;lt;summary&amp;gt;&lt;br /&gt;    /// Based upon https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/test/integration-tests/samples/3.x/IntegrationTestsSample&lt;br /&gt;    /// &amp;lt;/summary&amp;gt;&lt;br /&gt;    /// &amp;lt;typeparam name=&amp;quot;TStartup&amp;quot;&amp;gt;&amp;lt;/typeparam&amp;gt;&lt;br /&gt;    public class AutofacWebApplicationFactory&amp;lt;TStartup&amp;gt; : WebApplicationFactory&amp;lt;TStartup&amp;gt; where TStartup : class {&lt;br /&gt;        protected override void ConfigureWebHost(IWebHostBuilder builder) {&lt;br /&gt;            builder.ConfigureServices(services =&amp;gt; {&lt;br /&gt;                    services.AddSingleton&amp;lt;IAuthorizationHandler&amp;gt;(new PassThroughPermissionedRolesHandler());&lt;br /&gt;                })&lt;br /&gt;                .ConfigureTestServices(services =&amp;gt; {&lt;br /&gt;                }).ConfigureTestContainer&amp;lt;Autofac.ContainerBuilder&amp;gt;(builder =&amp;gt; {&lt;br /&gt;                    // called after Startup.ConfigureContainer&lt;br /&gt;                });&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        protected override IHost CreateHost(IHostBuilder builder) {&lt;br /&gt;            builder.UseServiceProviderFactory(new CustomServiceProviderFactory());&lt;br /&gt;            return base.CreateHost(builder);&lt;br /&gt;        }&lt;br /&gt;    }&lt;br /&gt;&lt;br /&gt;    /// &amp;lt;summary&amp;gt;&lt;br /&gt;    /// Based upon https://github.com/dotnet/aspnetcore/issues/14907#issuecomment-620750841 - only necessary because of an issue in ASP.NET Core&lt;br /&gt;    /// &amp;lt;/summary&amp;gt;&lt;br /&gt;    public class CustomServiceProviderFactory : IServiceProviderFactory&amp;lt;CustomContainerBuilder&amp;gt; {&lt;br /&gt;        public CustomContainerBuilder CreateBuilder(IServiceCollection services) =&amp;gt; new CustomContainerBuilder(services);&lt;br /&gt;&lt;br /&gt;        public IServiceProvider CreateServiceProvider(CustomContainerBuilder containerBuilder) =&amp;gt;&lt;br /&gt;        new AutofacServiceProvider(containerBuilder.CustomBuild());&lt;br /&gt;    }&lt;br /&gt;&lt;br /&gt;    public class CustomContainerBuilder : Autofac.ContainerBuilder {&lt;br /&gt;        private readonly IServiceCollection services;&lt;br /&gt;&lt;br /&gt;        public CustomContainerBuilder(IServiceCollection services) {&lt;br /&gt;            this.services = services;&lt;br /&gt;            this.Populate(services);&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        public Autofac.IContainer CustomBuild() {&lt;br /&gt;            var sp = this.services.BuildServiceProvider();&lt;br /&gt;#pragma warning disable CS0612 // Type or member is obsolete&lt;br /&gt;            var filters = sp.GetRequiredService&amp;lt;IEnumerable&amp;lt;IStartupConfigureContainerFilter&amp;lt;Autofac.ContainerBuilder&amp;gt;&amp;gt;&amp;gt;();&lt;br /&gt;#pragma warning restore CS0612 // Type or member is obsolete&lt;br /&gt;&lt;br /&gt;            foreach (var filter in filters) {&lt;br /&gt;                filter.ConfigureContainer(b =&amp;gt; { }) (this);&lt;br /&gt;            }&lt;br /&gt;&lt;br /&gt;            return this.Build();&lt;br /&gt;        }&lt;br /&gt;    }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;I&amp;#39;m going to level with you; I don&amp;#39;t understand all of this code.  I&amp;#39;m not au fait with the inner workings of ASP.NET Core or Autofac but I can tell you what this allows.  With this custom &lt;code&gt;WebApplicationFactory&lt;/code&gt; in play you get &lt;code&gt;ConfigureTestContainer&lt;/code&gt; back in the mix!  You get to write code like this:&lt;/p&gt;&lt;pre class="prettyprint cs"&gt;&lt;code class="lang-cs"&gt;using System;&lt;br /&gt;using System.Net;&lt;br /&gt;using System.Net.Http.Headers;&lt;br /&gt;using System.Threading.Tasks;&lt;br /&gt;using FakeItEasy;&lt;br /&gt;using FluentAssertions;&lt;br /&gt;using Microsoft.AspNetCore.TestHost;&lt;br /&gt;using Microsoft.Extensions.DependencyInjection;&lt;br /&gt;using Xunit;&lt;br /&gt;using Microsoft.Extensions.Options;&lt;br /&gt;using Autofac;&lt;br /&gt;using System.Net.Http;&lt;br /&gt;using Newtonsoft.Json;&lt;br /&gt;&lt;br /&gt;namespace My.Web.Tests.Controllers&lt;br /&gt;{&lt;br /&gt;    public class MyControllerTests : IClassFixture&amp;lt;AutofacWebApplicationFactory&amp;lt;My.Web.Startup&amp;gt;&amp;gt; {&lt;br /&gt;        private readonly AutofacWebApplicationFactory&amp;lt;My.Web.Startup&amp;gt; _factory;&lt;br /&gt;&lt;br /&gt;        public MyControllerTests(&lt;br /&gt;            AutofacWebApplicationFactory&amp;lt;My.Web.Startup&amp;gt; factory&lt;br /&gt;        ) {&lt;br /&gt;            _factory = factory;&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        [Fact]&lt;br /&gt;        public async Task My() {&lt;br /&gt;            var fakeSomethingService = A.Fake&amp;lt;IMySomethingService&amp;gt;();&lt;br /&gt;            var fakeConfig = Options.Create(new MyConfiguration {&lt;br /&gt;                SomeConfig = &amp;quot;Important thing&amp;quot;,&lt;br /&gt;                OtherConfigMaybeAnEmailAddress = &amp;quot;johnny_reilly@hotmail.com&amp;quot;&lt;br /&gt;            });&lt;br /&gt;&lt;br /&gt;            A.CallTo(() =&amp;gt; fakeSomethingService.DoSomething(A&amp;lt;string&amp;gt;.Ignored))&lt;br /&gt;                .Returns(Task.FromResult(true));&lt;br /&gt;&lt;br /&gt;            void ConfigureTestServices(IServiceCollection services) {&lt;br /&gt;                services.AddSingleton(fakeConfig);&lt;br /&gt;            }&lt;br /&gt;&lt;br /&gt;            void ConfigureTestContainer(ContainerBuilder builder) {&lt;br /&gt;                builder.RegisterInstance(fakeSomethingService);&lt;br /&gt;            }&lt;br /&gt;&lt;br /&gt;            var client = _factory&lt;br /&gt;                .WithWebHostBuilder(builder =&amp;gt; {&lt;br /&gt;                    builder.ConfigureTestServices(ConfigureTestServices);&lt;br /&gt;                    builder.ConfigureTestContainer&amp;lt;Autofac.ContainerBuilder&amp;gt;(ConfigureTestContainer);&lt;br /&gt;                })&lt;br /&gt;                .CreateClient();&lt;br /&gt;&lt;br /&gt;            // Act&lt;br /&gt;            var request = StringContent(&amp;quot;{\&amp;quot;sommat\&amp;quot;:\&amp;quot;to see\&amp;quot;}&amp;quot;);&lt;br /&gt;            request.Headers.ContentType = MediaTypeHeaderValue.Parse(&amp;quot;application/json&amp;quot;);&lt;br /&gt;            var response = await client.PostAsync(&amp;quot;/something/submit&amp;quot;, request);&lt;br /&gt;&lt;br /&gt;            // Assert&lt;br /&gt;            response.StatusCode.Should().Be(HttpStatusCode.OK);&lt;br /&gt;&lt;br /&gt;            A.CallTo(() =&amp;gt; fakeSomethingService.DoSomething(A&amp;lt;string&amp;gt;.Ignored))&lt;br /&gt;                .MustHaveHappened();&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;    }&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3900810916190078063'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3900810916190078063'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2020/05/autofac-webapplicationfactory-and.html' title='Autofac, WebApplicationFactory and integration tests'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-7827982904374625492</id><published>2020-05-10T19:18:00.000+01:00</published><updated>2020-05-10T19:18:04.703+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>From react-window to react-virtual</title><content type='html'>&lt;p&gt;The tremendous &lt;a href="https://twitter.com/tannerlinsley"&gt;Tanner Linsley&lt;/a&gt; recently released &lt;a href="https://github.com/tannerlinsley/react-virtual"&gt;&lt;code&gt;react-virtual&lt;/code&gt;&lt;/a&gt;. &lt;code&gt;react-virtual&lt;/code&gt; provides &amp;quot;hooks for virtualizing scrollable elements in React&amp;quot;.&lt;/p&gt;&lt;p&gt;I was already using the (also excellent) &lt;a href="https://github.com/bvaughn/react-window"&gt;&lt;code&gt;react-window&lt;/code&gt;&lt;/a&gt; for this purpose.  &lt;code&gt;react-window&lt;/code&gt; does the virtualising job and does it very well indeed However, I was both intrigued by the lure of the new shiny thing. I&amp;#39;ve also never been the biggest fan of &lt;code&gt;react-window&lt;/code&gt;'s API.  So I tried switching over from &lt;code&gt;react-window&lt;/code&gt; to &lt;code&gt;react-virtual&lt;/code&gt; as an experiment.  To my delight, the experiment went so well I didn&amp;#39;t look back!&lt;/p&gt;&lt;p&gt;What did I get out of the switch?&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Simpler code / nicer developer ergonomics.  The API for &lt;code&gt;react-virtual&lt;/code&gt; allowed me to simplify my code and lose a layer of components. &lt;/li&gt;&lt;li&gt;TypeScript support in the box&lt;/li&gt;&lt;li&gt;Improved perceived performance. I didn&amp;#39;t run any specific tests to quantify this, but I can say that the same functionality now feels snappier.&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;I tweeted my delight at this and Tanner asked if there was commit diff I could share.  I couldn&amp;#39;t as it&amp;#39;s a private codebase, but I thought it could form the basis of a blogpost.&lt;/p&gt; &lt;blockquote class="twitter-tweet"&gt;&lt;p lang="en" dir="ltr"&gt;Nice! Do you have a commit diff we could see?&lt;/p&gt;&amp;mdash; Tanner Linsley  (@tannerlinsley) &lt;a href="https://twitter.com/tannerlinsley/status/1259503283103608832?ref_src=twsrc%5Etfw"&gt;May 10, 2020&lt;/a&gt;&lt;/blockquote&gt; &lt;script async src="https://platform.twitter.com/widgets.js" charset="utf-8"&gt;&lt;/script&gt; &lt;p&gt;In case you hadn&amp;#39;t guessed, this is that blog post...&lt;/p&gt; &lt;h4 id="make-that-change"&gt;Make that change&lt;/h4&gt; &lt;p&gt;So what does the change look like?  Well first remove &lt;code&gt;react-window&lt;/code&gt; from your project:&lt;/p&gt;&lt;pre class="prettyprint"&gt;&lt;code&gt;yarn remove react-window @types/react-window&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Add the dependency to &lt;code&gt;react-virtual&lt;/code&gt;:&lt;/p&gt;&lt;pre class="prettyprint"&gt;&lt;code&gt;yarn add react-virtual&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Change your imports from:&lt;/p&gt;&lt;pre class="prettyprint"&gt;&lt;code class="lang-ts"&gt;import { FixedSizeList, ListChildComponentProps } from &amp;#39;react-window&amp;#39;;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;to:&lt;/p&gt;&lt;pre class="prettyprint"&gt;&lt;code class="lang-ts"&gt;import { useVirtual } from &amp;#39;react-virtual&amp;#39;;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Change your component code from:&lt;/p&gt;&lt;pre class="prettyprint"&gt;&lt;code class="lang-ts"&gt;type ImportantDataListProps = {&lt;br /&gt;    classes: ReturnType&amp;lt;typeof useStyles&amp;gt;;&lt;br /&gt;    importants: ImportantData[];&lt;br /&gt;};&lt;br /&gt;&lt;br /&gt;const ImportantDataList: React.FC&amp;lt;ImportantDataListProps&amp;gt; = React.memo(props =&amp;gt; (&lt;br /&gt;    &amp;lt;FixedSizeList&lt;br /&gt;        height={400}&lt;br /&gt;        width={&amp;#39;100%&amp;#39;}&lt;br /&gt;        itemSize={80}&lt;br /&gt;        itemCount={props.importants.length}&lt;br /&gt;        itemData={props}&lt;br /&gt;    &amp;gt;&lt;br /&gt;        {RenderRow}&lt;br /&gt;    &amp;lt;/FixedSizeList&amp;gt;&lt;br /&gt;));&lt;br /&gt;&lt;br /&gt;type ListItemProps = {&lt;br /&gt;    classes: ReturnType&amp;lt;typeof useStyles&amp;gt;;&lt;br /&gt;    importants: ImportantData[];&lt;br /&gt;};&lt;br /&gt;&lt;br /&gt;function RenderRow(props: ListChildComponentProps) {&lt;br /&gt;    const { index, style } = props;&lt;br /&gt;    const { importants, classes } = props.data as ListItemProps;&lt;br /&gt;    const important = importants[index];&lt;br /&gt;&lt;br /&gt;    return (&lt;br /&gt;        &amp;lt;ListItem button style={style} key={index}&amp;gt;&lt;br /&gt;            &amp;lt;ImportantThing classes={classes} important={important} /&amp;gt;&lt;br /&gt;        &amp;lt;/ListItem&amp;gt;&lt;br /&gt;    );&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Of the above you can delete the &lt;code&gt;ListItemProps&lt;/code&gt; type and the associate &lt;code&gt;RenderRow&lt;/code&gt; function.  You won&amp;#39;t need them again! There&amp;#39;s no longer a need to pass down data to the child element and then extract it for usage; it all comes down into a single simpler component. &lt;/p&gt;&lt;p&gt;Replace the &lt;code&gt;ImportantDataList&lt;/code&gt; component with this:&lt;/p&gt; &lt;pre class="prettyprint"&gt;&lt;code class="lang-ts"&gt;const ImportantDataList: React.FC&amp;lt;ImportantDataListProps&amp;gt; = React.memo(props =&amp;gt; {&lt;br /&gt;    const parentRef = React.useRef&amp;lt;HTMLDivElement&amp;gt;(null);&lt;br /&gt;&lt;br /&gt;    const rowVirtualizer = useVirtual({&lt;br /&gt;        size: props.importants.length,&lt;br /&gt;        parentRef,&lt;br /&gt;        estimateSize: React.useCallback(() =&amp;gt; 80, []), // This is just a best guess&lt;br /&gt;        overscan: 5&lt;br /&gt;    });&lt;br /&gt;&lt;br /&gt;    return (&lt;br /&gt;            &amp;lt;div&lt;br /&gt;                ref={parentRef}&lt;br /&gt;                style={{&lt;br /&gt;                    width: `100%`,&lt;br /&gt;                    height: `500px`,&lt;br /&gt;                    overflow: &amp;#39;auto&amp;#39;&lt;br /&gt;                }}&lt;br /&gt;            &amp;gt;&lt;br /&gt;                &amp;lt;div&lt;br /&gt;                    style={{&lt;br /&gt;                        height: `${rowVirtualizer.totalSize}px`,&lt;br /&gt;                        width: &amp;#39;100%&amp;#39;,&lt;br /&gt;                        position: &amp;#39;relative&amp;#39;&lt;br /&gt;                    }}&lt;br /&gt;                &amp;gt;&lt;br /&gt;                    {rowVirtualizer.virtualItems.map(virtualRow =&amp;gt; (&lt;br /&gt;                        &amp;lt;div&lt;br /&gt;                            key={virtualRow.index}&lt;br /&gt;                            ref={virtualRow.measureRef}&lt;br /&gt;                            className={props.classes.hoverRow}&lt;br /&gt;                            style={{&lt;br /&gt;                                position: &amp;#39;absolute&amp;#39;,&lt;br /&gt;                                top: 0,&lt;br /&gt;                                left: 0,&lt;br /&gt;                                width: &amp;#39;100%&amp;#39;,&lt;br /&gt;                                height: `${virtualRow.size}px`,&lt;br /&gt;                                transform: `translateY(${virtualRow.start}px)`&lt;br /&gt;                            }}&lt;br /&gt;                        &amp;gt;&lt;br /&gt;                            &amp;lt;ImportantThing&lt;br /&gt;                                classes={props.classes}&lt;br /&gt;                                important={props.importants[virtualRow.index]}&lt;br /&gt;                            /&amp;gt;&lt;br /&gt;                        &amp;lt;/div&amp;gt;&lt;br /&gt;                    ))}&lt;br /&gt;                &amp;lt;/div&amp;gt;&lt;br /&gt;            &amp;lt;/div&amp;gt;&lt;br /&gt;    );&lt;br /&gt;});&lt;br /&gt;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;And you are done!  Thanks Tanner for this tremendous library!&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7827982904374625492'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7827982904374625492'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2020/05/from-react-window-to-react-virtual.html' title='From &lt;code&gt;react-window&lt;/code&gt; to &lt;code&gt;react-virtual&lt;/code&gt;'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8332765096340527966</id><published>2020-04-04T10:29:00.000+01:00</published><updated>2020-04-04T10:29:49.200+01:00</updated><category scheme='http://www.blogger.com/atom/ns#' term='docker'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='kubernetes'/><category scheme='http://www.blogger.com/atom/ns#' term='asp net core'/><category scheme='http://www.blogger.com/atom/ns#' term='aws'/><title type='text'>Up to the clouds!</title><content type='html'>&lt;p&gt;This last four months has been quite the departure for me.  Most typically I find myself building applications; for this last period of time I&amp;#39;ve been taking the platform that I work on, and been migrating it from running on our on premise servers to running in the cloud.&lt;/p&gt;&lt;p&gt;This turned out to be much more difficult than I&amp;#39;d expected and for reasons that often surprised me.  We knew where we wanted to get to, but not all of what we&amp;#39;d need to do to get there.  So many things you can only learn by doing.  Whilst these experiences are still fresh in my mind I wanted to document some of the challenges we faced.&lt;/p&gt;&lt;h4 id="the-mission"&gt;The mission&lt;/h4&gt;&lt;p&gt;At the start of January, the team decided to make a concerted effort to take our humble ASP.NET Core application and migrate it to the cloud.  We sat down with some friends from the DevOps team who are part of our organisation.  We&amp;#39;re fortunate in that these marvellous people are very talented engineers indeed. It was going to be a collaboration between our two teams of budding cloudmongers that would make this happen.&lt;/p&gt;&lt;p&gt;Now our application is young. It is not much more than a year old.  However it is growing &lt;em&gt;fast&lt;/em&gt;. And as we did the migration from on premise to the cloud, that wasn&amp;#39;t going to stop.  Development of the application was to continue as is, shipping new versions daily.  Without impeding that, we were to try and get the application migrated to the cloud.&lt;/p&gt;&lt;p&gt;I would liken it to boarding a speeding train, fighting your way to the front, taking the driver hostage and then diverting the train onto a different track. It was challenging. Really, really challenging.&lt;/p&gt;&lt;p&gt;So many things had to change for us to get from on premise servers to the cloud, all the while keeping our application a going (and shipping) concern. Let&amp;#39;s go through them one by one.&lt;/p&gt;&lt;h4 id="kubernetes-and-docker"&gt;Kubernetes and Docker&lt;/h4&gt;&lt;p&gt;Our application was built using ASP.NET Core.  A technology that is entirely cloud friendly (that&amp;#39;s one of the reasons we picked it). We were running on a collection of hand installed, hand configured Windows servers. That had to change. We wanted to move our application to run on Kubernetes; so we didn&amp;#39;t have to manually configure servers.  Rather k8s would manage the provisioning and deployment of containers running our application.  Worth saying now: I knew &lt;em&gt;nothing&lt;/em&gt; about Kubernetes.  Or nearly nothing.  I learned a bunch along the way, but, as I&amp;#39;ve said, this was a collaboration between our team and the mighty site reliability engineers of the DevOps team.  They knew a &lt;em&gt;lot&lt;/em&gt; about this k8s stuff and moreoften than not, our team stood back and let them work their magic.&lt;/p&gt;&lt;p&gt;In order that we could migrate to running in k8s, we first needed to containerise our application. We needed a &lt;code&gt;Dockerfile&lt;/code&gt;. There followed a good amount of experimentation as we worked out how to build ourselves images.  There&amp;#39;s an art to building an optimal Docker image.  &lt;/p&gt;&lt;p&gt;So that we can cover a lot of ground, this post will remain relatively high level.  So here&amp;#39;s a number of things that we encountered along the way that are worth considering:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Multi-stage builds were an absolute necessity for us. We&amp;#39;d build the front end of our app (React / TypeScript) using one stage with a &lt;a href="https://hub.docker.com/_/node"&gt;Node base image&lt;/a&gt;. Then we&amp;#39;d build our app using a &lt;a href="https://hub.docker.com/_/microsoft-dotnet-core-sdk/"&gt;.NET Core SDK base image&lt;/a&gt;. Finally, we&amp;#39;d use a &lt;a href="https://hub.docker.com/_/microsoft-dotnet-core-aspnet"&gt;ASP.Net&lt;/a&gt; image to run the app; copying in the output of previous stages. &lt;/li&gt;&lt;li&gt;Our application accesses various SQL Server databases. We struggled to get our application to connect to them.  The issue related to the SSL configuration of our runner image.  The fix was simple but frustrating; use a &lt;code&gt;-bionic&lt;/code&gt; image as it has the configuration you need.  We found that gem &lt;a href="https://github.com/dotnet/SqlClient/issues/222#issuecomment-535802822"&gt;here&lt;/a&gt;. &lt;/li&gt;&lt;li&gt;Tests.  Automated tests.  We want to run them in our build; but how?  Once more multi-stage builds to the rescue.  We&amp;#39;d build our application, then in a separate stage we&amp;#39;d run the tests; copying in the app from the build stage.  If the tests failed, the build failed. If they passed then the intermediate stage containing the tests would be discarded by Docker. No unnecessary bloat of the image; all that testing goodness still; now in containerised form! &lt;/li&gt;&lt;/ul&gt;&lt;h4 id="jenkins"&gt;Jenkins&lt;/h4&gt;&lt;p&gt;Our on premise world used TeamCity for our continuous integration needs and Octopus for deployment.  We liked these tools well enough; particularly Octopus.  However, the DevOps team were very much of the mind that we should be use Jenkins instead.  And &lt;a href="https://jenkins.io/doc/book/pipeline/"&gt;Pipeline&lt;/a&gt;.  It was here that we initially struggled.  To quote the docs: &lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;Jenkins Pipeline (or simply &amp;quot;Pipeline&amp;quot; with a capital &amp;quot;P&amp;quot;) is a suite of plugins which supports implementing and integrating continuous delivery pipelines into Jenkins.&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;Whilst continuous delivery is super cool, and is something our team was interested in, we weren&amp;#39;t ready for it yet.  We didn&amp;#39;t yet have the kind of automated testing in place that gave us the confidence that we&amp;#39;d need to move to it. One day, but not today. For now there was still some manual testing done on each release, prior to shipping. Octopus suited us very well here as it allowed us to deploy, on demand, a build of our choice to a given environment.  So the question was: what to do? Fortunately the immensely talented Aby Egea came up with a mechanism that supported that very notion. A pipeline that would, optionally, deploy our build to a specified environment.  So we were good!&lt;/p&gt;&lt;p&gt;One thing we got to really appreciate about Jenkins was that the build is scripted with a &lt;a href="https://jenkins.io/doc/book/pipeline/jenkinsfile/"&gt;Jenkinsfile&lt;/a&gt;. This was in contrast to our TeamCity world where it was all manually configured.  &lt;a href="https://jenkins.io/projects/jcasc/"&gt;Configuration as code&lt;/a&gt; is truly a wonderful thing as your build pipeline becomes part of your codebase; open for everyone to see and understand. If anyone wants to change the build pipeline it has to get code reviewed like everything else.  It was as code in our &lt;code&gt;Jenkinsfile&lt;/code&gt; that the deployment mechanism lived.&lt;/p&gt;&lt;h4 id="vault"&gt;Vault&lt;/h4&gt;&lt;p&gt;Another thing that we used Octopus for was secrets.  Applications run on configuration; these are settings that drive the behaviour of your application.  A subset of configuration is &amp;quot;secrets&amp;quot;.  Secrets are configuration that can&amp;#39;t be stored in source code; they would represent a risk if they did.  For instance a database connection string.  We&amp;#39;d been merrily using Octopus for this; as Octopus deploys an application to a server it enriches the &lt;code&gt;appsettings.json&lt;/code&gt; file with any required secrets.&lt;/p&gt;&lt;p&gt;Without Octopus in the mix, how were we to handle our secrets? The answer is with &lt;a href="https://www.vaultproject.io/"&gt;Hashicorp Vault&lt;/a&gt;.  We&amp;#39;d store our secrets in there and, thanks to clever work by &lt;a href="https://uk.linkedin.com/in/robert-grzankowski-53618114"&gt;Robski&lt;/a&gt; of the DevOps team, when our container was brought up by Kubernetes, it would mount into the filesystem an &lt;code&gt;appsettings.Vault.json&lt;/code&gt; file which we read thanks to our trusty friend &lt;a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/configuration/?view=aspnetcore-3.1#json-configuration-provider"&gt;&lt;code&gt;.AddJsonFile&lt;/code&gt;&lt;/a&gt; with &lt;code&gt;optional: true&lt;/code&gt;. (As the file didn&amp;#39;t exist in our development environment.)&lt;/p&gt;&lt;p&gt;Hey presto! Safe secrets in k8s. &lt;/p&gt;&lt;h4 id="networking"&gt;Networking&lt;/h4&gt;&lt;p&gt;Our on premise servers sat on the company network. They could see &lt;em&gt;everything&lt;/em&gt; that there was to see. All the other servers around them on the network, bleeping and blooping. The opposite was true in AWS.  There was nothing to see.  Nothing to access.  As it should be.  It&amp;#39;s safer that way should a machine become compromised. For each database and each API our application depended upon, we needed to specifically whitelist access. &lt;/p&gt;&lt;h4 id="kerberos"&gt;Kerberos&lt;/h4&gt;&lt;p&gt;There&amp;#39;s always a fly in the ointment. A nasty surprise on a dark night. Ours was realising that our application depended upon an API that was secured using &lt;a href="https://docs.microsoft.com/en-us/iis/configuration/system.webserver/security/authentication/windowsauthentication/"&gt;Windows Authentication&lt;/a&gt;. Our application was accessing it by running under a service account which had been permissioned to access it.  However, in AWS, our application wasn&amp;#39;t running as under a service account on the company network.  Disappointingly, in the short term the API was not going to support an alternate authentication mechanism.&lt;/p&gt;&lt;p&gt;What to do?  Honestly it wasn&amp;#39;t looking good.  We were considering proxying through one of our Windows servers just to get access to that API.  I was tremendously disappointed.  At this point our hero arrived; one &lt;a href="https://twitter.com/foldr"&gt;JMac&lt;/a&gt; hacked together a Kerberos sidecar approach one weekend.  You can see a similar approach &lt;a href="https://github.com/edseymour/kinit-sidecar"&gt;here&lt;/a&gt;.  This got us to a point that allowed us to access the API we needed to.&lt;/p&gt;&lt;p&gt;I&amp;#39;m kind of amazed that there isn&amp;#39;t better documentation out there around have a Kerberos sidecar in a k8s setup.  Tragically Windows Authentication is a widely used authentication mechanism.  That being the case, having good docs to show how you can get a Kerberos sidecar in place would likely greatly advance the ability of enterprises to migrate to the cloud.  The best docs I&amp;#39;ve found are &lt;a href="https://blog.openshift.com/kerberos-sidecar-container/"&gt;here&lt;/a&gt;.  It is super hard though. &lt;em&gt;So hard!&lt;/em&gt; &lt;/p&gt;&lt;h4 id="hangfire"&gt;Hangfire&lt;/h4&gt;&lt;p&gt;We were using &lt;a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/host/hosted-services?view=aspnetcore-3.1&amp;amp;tabs=visual-studio"&gt;Hosted Services&lt;/a&gt; to perform background task running in our app. The nature of our background tasks meant that it was important to only run a single instance of a background task at a time. Or bad things would happen. This was going to become a problem since we had ambitions to be able to horizontally scale our application; to add new pods as running our app as demand determined.&lt;/p&gt;&lt;p&gt;So we started to use &lt;a href="https://www.hangfire.io/"&gt;Hangfire&lt;/a&gt; to perform task running in our app. With Hangfire, when a job is picked up it gets locked so other servers can&amp;#39;t pick it up. That&amp;#39;s what we need.  &lt;/p&gt;&lt;p&gt;Hangfire is pretty awesome. However it turns out that there&amp;#39;s quirks when you move to a containerised environment.  We have a number of recurring jobs that are scheduled to run at certain dates and times. In order that Hangfire can ascertain what time it is, it needs a timezone. It turns out that timezones on Windows != timezones in Docker / Linux.&lt;/p&gt;&lt;p&gt;This was a problem because, as we limbered up for the great migration, we were trying to run our cloud implementation side by side with our on premise one. And Windows picked a fight with Linux over timezones. You can see others bumping into this condition &lt;a href="https://github.com/HangfireIO/Hangfire/issues/1268"&gt;here&lt;/a&gt;. We learned this the hard way; jobs mysteriously stopping due to timezone related errors. Windows Hangfire not able to recognise Linux Hangfire timezones and vica versa.&lt;/p&gt;&lt;p&gt;The TL;DR is that we had to do a hard switch with Hangfire; it couldn&amp;#39;t run side by side. Not the end of the world, but surprising.&lt;/p&gt;&lt;h4 id="azure-active-directory-single-sign-on"&gt;Azure Active Directory Single Sign-On&lt;/h4&gt;&lt;p&gt;Historically our application had used two modes of authentication; Windows Authentication and cookies. Windows Authentication doesn&amp;#39;t generally play nicely with Docker. It&amp;#39;s doable, but it&amp;#39;s not the hill you want to die on.  So we didn&amp;#39;t; we swapped out Windows Authentication for &lt;a href="https://docs.microsoft.com/en-us/azure/active-directory/manage-apps/what-is-single-sign-on"&gt;Azure AD SSO&lt;/a&gt; and didn&amp;#39;t look back.&lt;/p&gt;&lt;p&gt;We also made some changes so our app would support cookies auth alongside Azure AD auth; &lt;a href="https://blog.johnnyreilly.com/2020/03/dual-boot-authentication-with-aspnetcore.html"&gt;I&amp;#39;ve written about this previously&lt;/a&gt;.&lt;/p&gt;&lt;h4 id="do-the-right-thing-and-tell-people-about-it"&gt;Do the right thing and tell people about it&lt;/h4&gt;&lt;p&gt;We&amp;#39;re there now; we&amp;#39;ve made the move. It was a difficult journey but one worth making; it sets up our platform for where we want to take it in the future. Having infrastructure as code makes all kinds of approaches possible that weren&amp;#39;t before.  Here&amp;#39;s some things we&amp;#39;re hoping to get out of the move:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;blue green deployments - shipping without taking down our platform&lt;/li&gt;&lt;li&gt;provision environments on demand - currently we have a highly contended situation when it comes to test environments.  With k8s and AWS we can look at spinning up environments as we need them and throwing them away also&lt;/li&gt;&lt;li&gt;autoscaling for need - we can start to look at spinning up new containers in times of high load and removing excessive containers in times of low load&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;We&amp;#39;ve also become more efficient as a team.  We are no longer maintaining servers, renewing certificates, installing software, RDPing onto boxes. All that time and effort we can plough back into making awesome experiences for our users.&lt;/p&gt;&lt;p&gt;There&amp;#39;s a long list of other benefits and it&amp;#39;s very exciting indeed!  It&amp;#39;s not enough for us to have done this though. It&amp;#39;s important that we tell the story of what we&amp;#39;ve done and how and why we&amp;#39;ve done it.  That way people have empathy for the work.  Also they can start to think about how they could start to reap similar benefits themselves.  By talking to others about the road we&amp;#39;ve travelled, we can save them time and help them to travel a similar road.  This is good for them and it&amp;#39;s good for us; it helps our relationships and it helps us all to move forwards together. &lt;/p&gt;&lt;p&gt;A rising tide lifts all boats. By telling others about our journey, we raise the water level.  Up to the clouds!&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8332765096340527966'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8332765096340527966'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2020/04/up-to-clouds.html' title='Up to the clouds!'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-7634030688661111653</id><published>2020-03-29T09:00:00.000+01:00</published><updated>2020-03-29T11:31:44.597+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Offline storage in a PWA</title><content type='html'>&lt;p&gt;When you are building any kind of application it's typical to want to store information which persists beyond a single user session. Sometimes that will be information that you'll want to live in some kind of centralised database, but not always.&lt;/p&gt;&lt;p&gt;Also, you may want that data to still be available if your user is offline.  Even if they can't connect to the network, the user may still be able to use the app to do meaningful tasks; but the app will likely require a certain amount of data to drive that.&lt;/p&gt;&lt;p&gt;How can we achieve this in the context of a PWA?&lt;/p&gt;&lt;h4&gt;The problem with &lt;code&gt;localStorage&lt;/code&gt;&lt;/h4&gt;&lt;p&gt;If you were building a classic web app you'd probably be reaching for &lt;a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage"&gt;&lt;code&gt;Window.localStorage&lt;/code&gt;&lt;/a&gt; at this point.  &lt;code&gt;Window.localStorage&lt;/code&gt; is a long existing API that stores data beyond a single session.  It has a simple API and is very easy to use.  However, it has a couple of problems:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;code&gt;Window.localStorage&lt;/code&gt; is synchronous.  Not a tremendous problem for every app, but if you're building something that has significant performance needs then this could become an issue.&lt;/li&gt;&lt;li&gt;&lt;code&gt;Window.localStorage&lt;/code&gt; cannot be used in the context of a &lt;code&gt;Worker&lt;/code&gt; or a &lt;code&gt;ServiceWorker&lt;/code&gt;.  The APIs are not available there.&lt;/li&gt;&lt;li&gt;&lt;code&gt;Window.localStorage&lt;/code&gt; stores only &lt;code&gt;string&lt;/code&gt;s. Given &lt;a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify"&gt;&lt;code&gt;JSON.stringify&lt;/code&gt;&lt;/a&gt; and &lt;a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/parse"&gt;&lt;code&gt;JSON.parse&lt;/code&gt;&lt;/a&gt; that's not a big problem. But it's an inconvenience.&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;The second point here is the significant one.  If we've a need to access our offline data in the context of a &lt;code&gt;ServiceWorker&lt;/code&gt; (and if you're offline you'll be using a &lt;code&gt;ServiceWorker&lt;/code&gt;) then what do you do?&lt;/p&gt;&lt;h4&gt;IndexedDB to the rescue?&lt;/h4&gt;&lt;p&gt;Fortunately, &lt;code&gt;localStorage&lt;/code&gt; is not the only game in town.  There's alternative offline storage mechanism available in browsers with the curious name of &lt;a href="https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API"&gt;IndexedDB&lt;/a&gt;. To quote the docs:&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;IndexedDB is a transactional database system, like an SQL-based RDBMS. However, unlike SQL-based RDBMSes, which use fixed-column tables, IndexedDB is a JavaScript-based object-oriented database. IndexedDB lets you store and retrieve objects that are indexed with a key; any objects supported by the structured clone algorithm can be stored. You need to specify the database schema, open a connection to your database, and then retrieve and update data within a series of transactions.&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;It's clear that IndexedDB is &lt;em&gt;very&lt;/em&gt; powerful.  But it doesn't sound very simple. A further look at the &lt;a href="https://github.com/mdn/to-do-notifications/blob/8b3e1708598e42062b0136608b1c5fbb66520f0a/scripts/todo.js#L48"&gt;MDN example&lt;/a&gt; of how to interact with IndexedDB does little to remove that thought.&lt;/p&gt;&lt;p&gt;We'd like to be able to access data offline; but in a simple fashion.  Like we could with &lt;code&gt;localStorage&lt;/code&gt; which has a wonderfully straightforward API. If only someone would build an astraction on top of IndexedDB to make our lives easier...&lt;/p&gt;&lt;p&gt;Someone did.&lt;/p&gt;&lt;h4&gt;IDB-Keyval to the rescue!&lt;/h4&gt;&lt;p&gt;The excellent &lt;a href="https://twitter.com/jaffathecake"&gt;Jake Archibald&lt;/a&gt; of Google has written &lt;a href="https://github.com/jakearchibald/idb-keyval"&gt;IDB-Keyval&lt;/a&gt; which is:&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;A super-simple-small promise-based keyval store implemented with IndexedDB&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;The API is essentially equivalent to &lt;code&gt;localStorage&lt;/code&gt; with a few lovely differences:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;The API is promise based; all functions return a &lt;code&gt;Promise&lt;/code&gt;; this makes it a non-blocking API.&lt;/li&gt;&lt;li&gt;The API is not restricted to &lt;code&gt;string&lt;/code&gt;s as &lt;code&gt;localStorage&lt;/code&gt; is. To quote the docs: &lt;em&gt;this is IDB-backed, you can store anything structured-clonable (numbers, arrays, objects, dates, blobs etc)&lt;/em&gt;&lt;/li&gt;&lt;li&gt;Because this is abstraction built on top of IndexedDB, it can be used both in the context of a typical web app and also in a &lt;code&gt;Worker&lt;/code&gt; or a &lt;code&gt;ServiceWorker&lt;/code&gt; if required.&lt;/li&gt;&lt;/ol&gt;&lt;h4&gt;Simple usage&lt;/h4&gt;&lt;p&gt;Let's take a look at what usage of &lt;code&gt;IDB-Keyval&lt;/code&gt; might be like. For that we're going to need an application. It would be good to be able to demonstrate both simple usage and also how usage in the context of an application might look.&lt;/p&gt;&lt;p&gt;Let's spin up a TypeScript React app with &lt;a href="https://create-react-app.dev/"&gt;Create React App&lt;/a&gt;:&lt;/p&gt;&lt;pre class="prettyprint tsx"&gt;&lt;code class="language-shell"&gt;npx create-react-app offline-storage-in-a-pwa --template typescript&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;This creates us a simple app. Now let's add IDB-Keyval to it:&lt;/p&gt;&lt;pre class="prettyprint tsx"&gt;&lt;code class="language-shell"&gt;yarn add idb-keyval&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Then, let's update the &lt;code&gt;index.tsx&lt;/code&gt; file to add a function that tests using IDB-Keyval:&lt;/p&gt;&lt;pre class="prettyprint tsx"&gt;&lt;code class="language-tsx"&gt;import React from 'react';&lt;br /&gt;import ReactDOM from 'react-dom';&lt;br /&gt;import { set, get } from 'idb-keyval';&lt;br /&gt;import './index.css';&lt;br /&gt;import App from './App';&lt;br /&gt;import * as serviceWorker from './serviceWorker';&lt;br /&gt;&lt;br /&gt;ReactDOM.render(&amp;lt;App /&amp;gt;, document.getElementById('root'));&lt;br /&gt;&lt;br /&gt;serviceWorker.register();&lt;br /&gt;&lt;br /&gt;async function testIDBKeyval() {&lt;br /&gt;    await set('hello', 'world');&lt;br /&gt;    const whatDoWeHave = await get('hello');&lt;br /&gt;    console.log(`When we queried idb-keyval for 'hello', we found: ${whatDoWeHave}`);&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;testIDBKeyval();&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;As you can see, we've added a &lt;code&gt;testIDBKeyval&lt;/code&gt; function which does the following:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;Adds a value of &lt;code&gt;'world'&lt;/code&gt; to IndexedDB using IDB-Keyval for the key of &lt;code&gt;'hello'&lt;/code&gt;&lt;/li&gt;&lt;li&gt;Queries IndexedDB using IDB-Keyval for the key of &lt;code&gt;'hello'&lt;/code&gt; and stores it in the variable &lt;code&gt;whatDoWeHave&lt;/code&gt;&lt;/li&gt;&lt;li&gt;Logs out what we found.&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;You'll also note that &lt;code&gt;testIDBKeyval&lt;/code&gt; is an &lt;code&gt;async&lt;/code&gt; function. This is so that we can use &lt;code&gt;await&lt;/code&gt; when we're interacting with IDB-Keyval.  Given that its API is &lt;code&gt;Promise&lt;/code&gt; based, it is &lt;code&gt;await&lt;/code&gt; friendly.  Where you're performing more than an a single asynchronous operation at a time, it's often valuable to use &lt;code&gt;async&lt;/code&gt; / &lt;code&gt;await&lt;/code&gt; to increase the readability of your codebase.&lt;/p&gt;&lt;p&gt;What happens when we run our application with &lt;code&gt;yarn start&lt;/code&gt;?  Let's do that and take a look at the devtools:&lt;/p&gt; &lt;a href="https://4.bp.blogspot.com/-b9-GrL0IXaY/Xmqj4GRhKXI/AAAAAAAAT5s/ZoceUInSY5EWXeCr2LkGV9Zvea8S6-mUgCPcBGAYYCw/s1600/hello_world_idb_keyval.png" imageanchor="1" &gt;&lt;img border="0" src="https://4.bp.blogspot.com/-b9-GrL0IXaY/Xmqj4GRhKXI/AAAAAAAAT5s/ZoceUInSY5EWXeCr2LkGV9Zvea8S6-mUgCPcBGAYYCw/s640/hello_world_idb_keyval.png" width="640" height="484" data-original-width="982" data-original-height="742" /&gt;&lt;/a&gt; &lt;p&gt;We successfully wrote something into IndexedDB, read it back and printed that value to the console.  Amazing!&lt;/p&gt;&lt;h4&gt;Usage in React&lt;/h4&gt;&lt;p&gt;What we've done so far is slightly abstract. It would be good to implement a real-world use case.  Let's create an application which gives users the choice between using a &amp;quot;Dark mode&amp;quot; version of the app or not.  To do that we'll replace our &lt;code&gt;App.tsx&lt;/code&gt; with this:&lt;/p&gt;&lt;pre class="prettyprint tsx"&gt;&lt;code class="language-tsx"&gt;import React, { useState } from &amp;quot;react&amp;quot;;&lt;br /&gt;import &amp;quot;./App.css&amp;quot;;&lt;br /&gt;&lt;br /&gt;const sharedStyles = {&lt;br /&gt;  height: &amp;quot;30rem&amp;quot;,&lt;br /&gt;  fontSize: &amp;quot;5rem&amp;quot;,&lt;br /&gt;  textAlign: &amp;quot;center&amp;quot;&lt;br /&gt;} as const;&lt;br /&gt;&lt;br /&gt;function App() {&lt;br /&gt;  const [darkModeOn, setDarkModeOn] = useState(true)&lt;br /&gt;  const handleOnChange = ({ target }: React.ChangeEvent&amp;lt;HTMLInputElement&amp;gt;) =&amp;gt; setDarkModeOn(target.checked);&lt;br /&gt;&lt;br /&gt;  const styles = {&lt;br /&gt;    ...sharedStyles,&lt;br /&gt;    ...(darkModeOn&lt;br /&gt;      ? {&lt;br /&gt;          backgroundColor: &amp;quot;black&amp;quot;,&lt;br /&gt;          color: &amp;quot;white&amp;quot;&lt;br /&gt;        }&lt;br /&gt;      : {&lt;br /&gt;          backgroundColor: &amp;quot;white&amp;quot;,&lt;br /&gt;          color: &amp;quot;black&amp;quot;&lt;br /&gt;        })&lt;br /&gt;  };&lt;br /&gt;&lt;br /&gt;  return (&lt;br /&gt;    &amp;lt;div style={styles}&amp;gt;&lt;br /&gt;      &amp;lt;input&lt;br /&gt;        type=&amp;quot;checkbox&amp;quot;&lt;br /&gt;        value=&amp;quot;darkMode&amp;quot;&lt;br /&gt;        checked={darkModeOn}&lt;br /&gt;        id=&amp;quot;darkModeOn&amp;quot;&lt;br /&gt;        name=&amp;quot;darkModeOn&amp;quot;&lt;br /&gt;        style={{ width: &amp;quot;3rem&amp;quot;, height: &amp;quot;3rem&amp;quot; }}&lt;br /&gt;        onChange={handleOnChange}&lt;br /&gt;      /&amp;gt;&lt;br /&gt;      &amp;lt;label htmlFor=&amp;quot;darkModeOn&amp;quot;&amp;gt;Use dark mode?&amp;lt;/label&amp;gt;&lt;br /&gt;    &amp;lt;/div&amp;gt;&lt;br /&gt;  );&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;export default App;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;When you run the app you can see how it works:&lt;/p&gt; &lt;a href="https://3.bp.blogspot.com/-xS6AYMXkqfw/Xmqk4QZQx0I/AAAAAAAAT54/ACHaHu6I9BsKSqQAIW7IgBH9D-UP6iHuACPcBGAYYCw/s1600/use-dark-mode.gif" imageanchor="1" &gt;&lt;img border="0" src="https://3.bp.blogspot.com/-xS6AYMXkqfw/Xmqk4QZQx0I/AAAAAAAAT54/ACHaHu6I9BsKSqQAIW7IgBH9D-UP6iHuACPcBGAYYCw/s640/use-dark-mode.gif" width="640" height="127" data-original-width="1126" data-original-height="224" /&gt;&lt;/a&gt; &lt;p&gt;Looking at the code you'll be able to see that this is implemented using React's &lt;code&gt;useState&lt;/code&gt; hook.  So any user preference selected will be lost on a page refresh.  Let's see if we can take this state and move it into IndexedDB using &lt;code&gt;IDB-Keyval&lt;/code&gt;.&lt;/p&gt;&lt;p&gt;We'll change the code like so:&lt;/p&gt;&lt;pre class="prettyprint tsx"&gt;&lt;code class="language-tsx"&gt;import React, { useState, useEffect } from &amp;quot;react&amp;quot;;&lt;br /&gt;import { set, get } from &amp;quot;idb-keyval&amp;quot;;&lt;br /&gt;import &amp;quot;./App.css&amp;quot;;&lt;br /&gt;&lt;br /&gt;const sharedStyles = {&lt;br /&gt;  height: &amp;quot;30rem&amp;quot;,&lt;br /&gt;  fontSize: &amp;quot;5rem&amp;quot;,&lt;br /&gt;  textAlign: &amp;quot;center&amp;quot;&lt;br /&gt;} as const;&lt;br /&gt;&lt;br /&gt;function App() {&lt;br /&gt;  const [darkModeOn, setDarkModeOn] = useState&amp;lt;boolean | undefined&amp;gt;(undefined);&lt;br /&gt;&lt;br /&gt;  useEffect(() =&amp;gt; {&lt;br /&gt;    get&amp;lt;boolean&amp;gt;(&amp;quot;darkModeOn&amp;quot;).then(value =&amp;gt;&lt;br /&gt;      // If a value is retrieved then use it; otherwise default to true&lt;br /&gt;      setDarkModeOn(value ?? true)&lt;br /&gt;    );&lt;br /&gt;  }, [setDarkModeOn]);&lt;br /&gt;&lt;br /&gt;  const handleOnChange = ({ target }: React.ChangeEvent&amp;lt;HTMLInputElement&amp;gt;) =&amp;gt; {&lt;br /&gt;    setDarkModeOn(target.checked);&lt;br /&gt;&lt;br /&gt;    set(&amp;quot;darkModeOn&amp;quot;, target.checked);&lt;br /&gt;  };&lt;br /&gt;&lt;br /&gt;  const styles = {&lt;br /&gt;    ...sharedStyles,&lt;br /&gt;    ...(darkModeOn&lt;br /&gt;      ? {&lt;br /&gt;          backgroundColor: &amp;quot;black&amp;quot;,&lt;br /&gt;          color: &amp;quot;white&amp;quot;&lt;br /&gt;        }&lt;br /&gt;      : {&lt;br /&gt;          backgroundColor: &amp;quot;white&amp;quot;,&lt;br /&gt;          color: &amp;quot;black&amp;quot;&lt;br /&gt;        })&lt;br /&gt;  };&lt;br /&gt;&lt;br /&gt;  return (&lt;br /&gt;    &amp;lt;div style={styles}&amp;gt;&lt;br /&gt;      {darkModeOn === undefined ? (&lt;br /&gt;        &amp;lt;&amp;gt;Loading preferences...&amp;lt;/&amp;gt;&lt;br /&gt;      ) : (&lt;br /&gt;        &amp;lt;&amp;gt;&lt;br /&gt;          &amp;lt;input&lt;br /&gt;            type=&amp;quot;checkbox&amp;quot;&lt;br /&gt;            value=&amp;quot;darkMode&amp;quot;&lt;br /&gt;            checked={darkModeOn}&lt;br /&gt;            id=&amp;quot;darkModeOn&amp;quot;&lt;br /&gt;            name=&amp;quot;darkModeOn&amp;quot;&lt;br /&gt;            style={{ width: &amp;quot;3rem&amp;quot;, height: &amp;quot;3rem&amp;quot; }}&lt;br /&gt;            onChange={handleOnChange}&lt;br /&gt;          /&amp;gt;&lt;br /&gt;          &amp;lt;label htmlFor=&amp;quot;darkModeOn&amp;quot;&amp;gt;Use dark mode?&amp;lt;/label&amp;gt;&lt;br /&gt;        &amp;lt;/&amp;gt;&lt;br /&gt;      )}&lt;br /&gt;    &amp;lt;/div&amp;gt;&lt;br /&gt;  );&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;export default App;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The changes here are:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;code&gt;darkModeOn&lt;/code&gt; is now initialised to &lt;code&gt;undefined&lt;/code&gt; and the app displays a loading message until &lt;code&gt;darkModeOn&lt;/code&gt; has a value.&lt;/li&gt;&lt;li&gt;The app attempts to app load a value from IDB-Keyval with the key &lt;code&gt;'darkModeOn'&lt;/code&gt; and set &lt;code&gt;darkModeOn&lt;/code&gt; with the retrieved value.  If no value is retrieved then it sets &lt;code&gt;darkModeOn&lt;/code&gt; to &lt;code&gt;true&lt;/code&gt;.&lt;/li&gt;&lt;li&gt;When the checkbox is changed, the corresponding value is both applied to &lt;code&gt;darkModeOn&lt;/code&gt; and saved to IDB-Keyval with the key &lt;code&gt;'darkModeOn'&lt;/code&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;As you can see, this means that we are persisting preferences beyond page refresh in a fashion that will work both online &lt;em&gt;and&lt;/em&gt; offline!&lt;/p&gt; &lt;a href="https://1.bp.blogspot.com/-ZBsWsQNFDVk/XmqledYAp4I/AAAAAAAAT6E/3ShBesSOuxsrJ34r1QIs0R3HsXGRFBBzgCPcBGAYYCw/s1600/use-dark-mode-with-idb-keyval.gif" imageanchor="1" &gt;&lt;img border="0" src="https://1.bp.blogspot.com/-ZBsWsQNFDVk/XmqledYAp4I/AAAAAAAAT6E/3ShBesSOuxsrJ34r1QIs0R3HsXGRFBBzgCPcBGAYYCw/s640/use-dark-mode-with-idb-keyval.gif" width="640" height="315" data-original-width="1126" data-original-height="554" /&gt;&lt;/a&gt; &lt;h4&gt;Usage as a React hook&lt;/h4&gt;&lt;p&gt;Finally it's time for bonus points.  Wouldn't it be nice if we could move this functionality into a reusable React hook?  Let's do it!&lt;/p&gt;&lt;p&gt;Let's create a new &lt;code&gt;usePersistedState.ts&lt;/code&gt; file:&lt;/p&gt;&lt;pre class="prettyprint tsx"&gt;&lt;code class="language-ts"&gt;import { useState, useEffect, useCallback } from &amp;quot;react&amp;quot;;&lt;br /&gt;import { set, get } from &amp;quot;idb-keyval&amp;quot;;&lt;br /&gt;&lt;br /&gt;export function usePersistedState&amp;lt;TState&amp;gt;(keyToPersistWith: string, defaultState: TState) {&lt;br /&gt;    const [state, setState] = useState&amp;lt;TState | undefined&amp;gt;(undefined);&lt;br /&gt;&lt;br /&gt;    useEffect(() =&amp;gt; {&lt;br /&gt;        get&amp;lt;TState&amp;gt;(keyToPersistWith).then(retrievedState =&amp;gt;&lt;br /&gt;            // If a value is retrieved then use it; otherwise default to defaultValue&lt;br /&gt;            setState(retrievedState ?? defaultState));&lt;br /&gt;    }, [keyToPersistWith, setState, defaultState]);&lt;br /&gt;    &lt;br /&gt;    const setPersistedValue = useCallback((newValue: TState) =&amp;gt; {&lt;br /&gt;        setState(newValue);&lt;br /&gt;        set(keyToPersistWith, newValue);&lt;br /&gt;    }, [keyToPersistWith, setState]);&lt;br /&gt;    &lt;br /&gt;    return [state, setPersistedValue] as const;&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;This new hook is modelled after the API of &lt;a href="https://reactjs.org/docs/hooks-reference.html#usestate"&gt;&lt;code&gt;useState&lt;/code&gt;&lt;/a&gt; and is named &lt;code&gt;usePersistentState&lt;/code&gt;.  It requires that a key be supplied which is the key that will be used to save the data.  It also requires a default value to use in the case that nothing is found during the lookup.&lt;/p&gt;&lt;p&gt;It returns (just like &lt;code&gt;useState&lt;/code&gt;) a stateful value, and a function to update it. Finally, let's switch over our &lt;code&gt;App.tsx&lt;/code&gt; to use our shiny new hook:&lt;/p&gt;&lt;pre class="prettyprint tsx"&gt;&lt;code class="language-tsx"&gt;import React from &amp;quot;react&amp;quot;;&lt;br /&gt;import &amp;quot;./App.css&amp;quot;;&lt;br /&gt;import { usePersistedState } from &amp;quot;./usePersistedState&amp;quot;;&lt;br /&gt;&lt;br /&gt;const sharedStyles = {&lt;br /&gt;  height: &amp;quot;30rem&amp;quot;,&lt;br /&gt;  fontSize: &amp;quot;5rem&amp;quot;,&lt;br /&gt;  textAlign: &amp;quot;center&amp;quot;&lt;br /&gt;} as const;&lt;br /&gt;&lt;br /&gt;function App() {&lt;br /&gt;  const [darkModeOn, setDarkModeOn] = usePersistedState&amp;lt;boolean&amp;gt;(&amp;quot;darkModeOn&amp;quot;, true);&lt;br /&gt;&lt;br /&gt;  const handleOnChange = ({ target }: React.ChangeEvent&amp;lt;HTMLInputElement&amp;gt;) =&amp;gt;&lt;br /&gt;    setDarkModeOn(target.checked);&lt;br /&gt;&lt;br /&gt;  const styles = {&lt;br /&gt;    ...sharedStyles,&lt;br /&gt;    ...(darkModeOn&lt;br /&gt;      ? {&lt;br /&gt;        backgroundColor: &amp;quot;black&amp;quot;,&lt;br /&gt;        color: &amp;quot;white&amp;quot;&lt;br /&gt;      }&lt;br /&gt;      : {&lt;br /&gt;        backgroundColor: &amp;quot;white&amp;quot;,&lt;br /&gt;        color: &amp;quot;black&amp;quot;&lt;br /&gt;      })&lt;br /&gt;  };&lt;br /&gt;&lt;br /&gt;  return (&lt;br /&gt;    &amp;lt;div style={styles}&amp;gt;&lt;br /&gt;      {darkModeOn === undefined ? (&lt;br /&gt;        &amp;lt;&amp;gt;Loading preferences...&amp;lt;/&amp;gt;&lt;br /&gt;      ) : (&lt;br /&gt;          &amp;lt;&amp;gt;&lt;br /&gt;            &amp;lt;input&lt;br /&gt;              type=&amp;quot;checkbox&amp;quot;&lt;br /&gt;              value=&amp;quot;darkMode&amp;quot;&lt;br /&gt;              checked={darkModeOn}&lt;br /&gt;              id=&amp;quot;darkModeOn&amp;quot;&lt;br /&gt;              name=&amp;quot;darkModeOn&amp;quot;&lt;br /&gt;              style={{ width: &amp;quot;3rem&amp;quot;, height: &amp;quot;3rem&amp;quot; }}&lt;br /&gt;              onChange={handleOnChange}&lt;br /&gt;            /&amp;gt;&lt;br /&gt;            &amp;lt;label htmlFor=&amp;quot;darkModeOn&amp;quot;&amp;gt;Use dark mode?&amp;lt;/label&amp;gt;&lt;br /&gt;          &amp;lt;/&amp;gt;&lt;br /&gt;        )}&lt;br /&gt;    &amp;lt;/div&amp;gt;&lt;br /&gt;  );&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;export default App;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h4&gt;Conclusion&lt;/h4&gt;&lt;p&gt;This post has demonstrate how a web application or a PWA can safely store data that is persisted between sessions using native browser capabilities easily.  IndexedDB powered the solution we've built.  We used used &lt;a href="https://github.com/jakearchibald/idb-keyval"&gt;IDB-Keyval&lt;/a&gt; for the delightful and familiar abstraction it offers over IndexedDB.  It's allowed us to come up with a solution with a similarly lovely API. It's worth knowing that there are alternatives to IDB-Keyval available such as &lt;a href="https://github.com/localForage/localForage"&gt;localForage&lt;/a&gt;. If you are building for older browsers which may lack good IndexedDB support then this would be a good choice.  But be aware that with greater backwards compatibility comes greater download size.  Do consider this and make the tradeoffs that make sense for you.&lt;/p&gt;&lt;p&gt;Finally, I've finished this post illustrating what usage would look like in a React context.  Do be aware that there's nothing React specific about our offline storage mechanism.  So if you're rolling with Vue, Angular or something else entirely: &lt;em&gt;this is for you too&lt;/em&gt;! Offline storage is a feature that provide much greater user experiences.  Please do consider making use of it in your applications.&lt;/p&gt; &lt;p&gt;&lt;a href="https://blog.logrocket.com/offline-storage-for-pwas/"&gt;This post was originally published on LogRocket.&lt;/a&gt;&lt;/p&gt; &lt;p&gt;&lt;a href="https://github.com/johnnyreilly/offline-storage-in-a-pwa"&gt;The source code for this project can be found here.&lt;/a&gt;&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7634030688661111653'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7634030688661111653'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2020/03/offline-storage-in-pwa.html' title='Offline storage in a PWA'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='https://4.bp.blogspot.com/-b9-GrL0IXaY/Xmqj4GRhKXI/AAAAAAAAT5s/ZoceUInSY5EWXeCr2LkGV9Zvea8S6-mUgCPcBGAYYCw/s72-c/hello_world_idb_keyval.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2406084703011195084</id><published>2020-03-22T17:52:00.002Z</published><updated>2020-03-22T17:55:16.344Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Dual boot authentication with ASP.Net Core</title><content type='html'>&lt;p&gt;This is a post about having two kinds of authentication working at the same time in ASP.Net Core.  But choosing which authentication method to use dynamically at runtime; based upon the criteria of your choice.&lt;/p&gt;&lt;p&gt;Already this sounds complicated; let&amp;#39;s fix that.  Perhaps I should describe my situation to you.  I&amp;#39;ve an app which has two classes of user.  One class, let&amp;#39;s call them &amp;quot;customers&amp;quot; (because... uh... they&amp;#39;re customers). The customers access our application via a public facing website.  Traffic rolls through Cloudflare and into our application.  The public facing URL is something fancy like &lt;a href="https://mega-app.com"&gt;https://mega-app.com&lt;/a&gt;.  That&amp;#39;s one class of user.&lt;/p&gt;&lt;p&gt;The other class of user we&amp;#39;ll call &amp;quot;our peeps&amp;quot;; because they are &lt;em&gt;us&lt;/em&gt;.  We use the app that we build.  Traffic from &amp;quot;us&amp;quot; comes from a different hostname; only addressable on our network.  So URLs from requests that we make are more along the lines of &lt;a href="https://strictly4mypeeps.io"&gt;https://strictly4mypeeps.io&lt;/a&gt;.  &lt;/p&gt;&lt;p&gt;So far, so uncontroversial.  Now it starts to get interesting.  Our customers log into our application using their super secret credentials.  It&amp;#39;s &lt;a href="https://docs.microsoft.com/en-us/aspnet/core/security/authentication/cookie?view=aspnetcore-3.1#create-an-authentication-cookie"&gt;cookie based authentication&lt;/a&gt;.  But for our peeps we do something different. Having to enter your credentials each time you use the app is friction.  It gets in the way. So for us we have &lt;a href="https://docs.microsoft.com/en-us/aspnet/core/security/authentication/azure-active-directory/?view=aspnetcore-3.1"&gt;Azure AD&lt;/a&gt; in the mix.  Azure AD is how we authenticate ourselves; and that means we don&amp;#39;t spend 5% of each working day entering credentials.&lt;/p&gt;&lt;h4 id="let-us-speak-of-the-past"&gt;Let us speak of the past&lt;/h4&gt;&lt;p&gt;Now our delightful little application grew up in a simpler time.  A time where you went to the marketplace, picked out some healthy looking servers, installed software upon them, got them attached to the internet, deployed an app onto them and said &amp;quot;hey presto, we&amp;#39;re live!&amp;quot;.&lt;/p&gt;&lt;p&gt;Way back when, we had some servers on the internet, that&amp;#39;s how our customers got to our app.  Our peeps, us, we went to other servers that lived on our network.  So we had multiple instances of our app, deployed to different machines.  The ones on the internet were configured to use cookie based auth, the ones on our internal network were Azure AD.&lt;/p&gt;&lt;p&gt;As I said, a simpler time. &lt;/p&gt;&lt;h4 id="a-new-hope"&gt;A new hope&lt;/h4&gt;&lt;p&gt;We&amp;#39;ve been going through the process of cloudifying our app.  Bye, bye servers, hello &lt;a href="https://www.docker.com/"&gt;Docker&lt;/a&gt; and &lt;a href="https://kubernetes.io/"&gt;Kubernetes&lt;/a&gt;.  So exciting! As we change the way our app is built and deployed; we&amp;#39;ve been thinking about whether the choices we make still make sense.&lt;/p&gt;&lt;p&gt;When it came to authentication, my initial thoughts were to continue the same road we&amp;#39;re travelling; just in containers and pods. So where we had &amp;quot;internal&amp;quot; servers, we&amp;#39;d have &amp;quot;internal&amp;quot; pods, and where we&amp;#39;d have &amp;quot;external&amp;quot; servers we&amp;#39;d have external pods.  I had the good fortune to be working with the amazingly talented &lt;a href="https://uk.linkedin.com/in/robert-grzankowski-53618114"&gt;Robski&lt;/a&gt;.  Robski knows far more about K8s and networking than I&amp;#39;m ever likely to.  He&amp;#39;d regularly say things like &amp;quot;ingress&amp;quot; and &amp;quot;MTLS&amp;quot; whilst I stared blankly at him. He definitely knows stuff.&lt;/p&gt;&lt;p&gt;Robski challenged my plans.  &amp;quot;We don&amp;#39;t need it.  Have one pod that does both sorts of auth. If you do that, your implementation is simpler and scaling is more straightforward.  You&amp;#39;ll only need half the pods because you won&amp;#39;t need internal &lt;em&gt;and&lt;/em&gt; external ones; one pod can handle both sets of traffic. You&amp;#39;ll save money.&amp;quot;&lt;/p&gt; &lt;p&gt;I loved the idea but I didn&amp;#39;t think that ASP.Net Core supported it.  &amp;quot;It&amp;#39;s just not a thing Robski; ASP.Net Core doesn&amp;#39;t suppport it.&amp;quot;  Robski didn&amp;#39;t believe me.  That turned out to a &lt;em&gt;very good thing&lt;/em&gt;. There followed a period of much googling and experimentation. One day of hunting in, I was still convinced there was no way to do it that would allow me to look in the mirror without self loathing. Then Robski sent me this:&lt;/p&gt; &lt;a href="https://4.bp.blogspot.com/-CjllrSY1e04/XneghUmKZ_I/AAAAAAAAUEA/WfZwU25wfQUWFVItCeC5l7FITgCaru9PgCPcBGAYYCw/s1600/robski-dynamic-auth.png" imageanchor="1" &gt;&lt;img border="0" src="https://4.bp.blogspot.com/-CjllrSY1e04/XneghUmKZ_I/AAAAAAAAUEA/WfZwU25wfQUWFVItCeC5l7FITgCaru9PgCPcBGAYYCw/s400/robski-dynamic-auth.png" width="400" height="365" data-original-width="1600" data-original-height="1458" /&gt;&lt;/a&gt; &lt;p&gt;It was a link to the amazing &lt;a href="https://twitter.com/davidfowl"&gt;David Fowler&lt;/a&gt; talking about &lt;a href="https://github.com/aspnet/Security/issues/1469#issuecomment-335027005"&gt;some API I&amp;#39;d never heard of called &lt;code&gt;SchemeSelector&lt;/code&gt;&lt;/a&gt;. It turned out that this was the starting point for exactly what we needed; a way to dynamically select an authentication scheme at runtime.&lt;/p&gt; &lt;h4&gt;Show me the code&lt;/h4&gt; &lt;p&gt;This API did end up landing in ASP.Net Core, but with the name &lt;code&gt;ForwardDefaultSelector&lt;/code&gt;.  Not the most descriptive of names and I&amp;#39;ve struggled to find any documentation on it at all.  What I did discover was &lt;a href="https://stackoverflow.com/a/51897159/761388"&gt;an answer on StackOverflow by the marvellous Barbara Post&lt;/a&gt;. I was able to take the approach Barbara laid out and use it to my own ends.  I ended up with this snippet of code added to my &lt;code&gt;Startup.ConfigureServices&lt;/code&gt;:&lt;/p&gt;&lt;pre class="prettyprint cs"&gt;&lt;code class="lang-cs"&gt;services&lt;br /&gt;    .AddAuthentication(sharedOptions =&amp;gt; {&lt;br /&gt;        sharedOptions.DefaultScheme = &amp;quot;WhichAuthDoWeUse&amp;quot;;&lt;br /&gt;        sharedOptions.DefaultAuthenticateScheme = &amp;quot;WhichAuthDoWeUse&amp;quot;;&lt;br /&gt;        sharedOptions.DefaultChallengeScheme = &amp;quot;WhichAuthDoWeUse&amp;quot;;&lt;br /&gt;    })&lt;br /&gt;    .AddPolicyScheme(&amp;quot;WhichAuthDoWeUse&amp;quot;, &amp;quot;Azure AD or Cookies&amp;quot;, options =&amp;gt; {&lt;br /&gt;        options.ForwardDefaultSelector = context =&amp;gt; {&lt;br /&gt;            var (isExternalRequest, requestUrl) = context.Request.GetIsExternalRequestAndDomain();&lt;br /&gt;            if (isExternalRequest) {&lt;br /&gt;                _logger.LogInformation(&lt;br /&gt;                    &amp;quot;Request ({RequestURL}) has come from external domain ({Domain}) so using Cookie Authentication&amp;quot;,&lt;br /&gt;                    requestUrl, ExternalBaseUrl);&lt;br /&gt;&lt;br /&gt;                return CookieAuthenticationDefaults.AuthenticationScheme;&lt;br /&gt;           }&lt;br /&gt;&lt;br /&gt;           _logger.LogInformation(&lt;br /&gt;               &amp;quot;Request ({RequestURL}) has not come from external domain ({Domain}) so using Azure AD Authentication&amp;quot;,&lt;br /&gt;               requestUrl, ExternalBaseUrl);&lt;br /&gt;&lt;br /&gt;            return AzureADDefaults.AuthenticationScheme;&lt;br /&gt;        };&lt;br /&gt;    })&lt;br /&gt;    .AddAzureAD(options =&amp;gt; {&lt;br /&gt;        Configuration.Bind(&amp;quot;AzureAd&amp;quot;, options);&lt;br /&gt;    })&lt;br /&gt;    .AddCookie(options =&amp;gt; {&lt;br /&gt;        options.Cookie.SecurePolicy = CookieSecurePolicy.Always;&lt;br /&gt;        options.Cookie.SameSite = SameSiteMode.Strict;&lt;br /&gt;        options.Cookie.HttpOnly = true;&lt;br /&gt;        options.Events.OnRedirectToAccessDenied = (context) =&amp;gt; {&lt;br /&gt;            context.Response.StatusCode = Microsoft.AspNetCore.Http.StatusCodes.Status401Unauthorized;&lt;br /&gt;            return Task.CompletedTask;&lt;br /&gt;        };&lt;br /&gt;&lt;br /&gt;        options.Events.OnRedirectToLogin = (context) =&amp;gt; {&lt;br /&gt;            context.Response.StatusCode = Microsoft.AspNetCore.Http.StatusCodes.Status401Unauthorized;&lt;br /&gt;            return Task.CompletedTask;&lt;br /&gt;        };&lt;br /&gt;    });&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;If you look at this code it&amp;#39;s doing these things:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;Registering three types of authentication: Cookie, Azure AD and &amp;quot;WhichAuthDoWeUse&amp;quot;&lt;/li&gt;&lt;li&gt;Registers the default &lt;code&gt;Scheme&lt;/code&gt; to be &amp;quot;WhichAuthDoWeUse&amp;quot;.&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;&amp;quot;WhichAuthDoWeUse&amp;quot; is effectively an &lt;code&gt;if&lt;/code&gt; statement that says, &lt;em&gt;&amp;quot;if this is an external &lt;code&gt;Request&lt;/code&gt; use Cookies authentication, otherwise use Azure AD&amp;quot;&lt;/em&gt;.  Given that &amp;quot;WhichAuthDoWeUse&amp;quot; is the default scheme, this code runs for each request, to determine which authentication method to use.&lt;/p&gt;&lt;p&gt;Alongside this mechanism I added these extension methods:&lt;/p&gt;&lt;pre class="prettyprint cs"&gt;&lt;code class="lang-cs"&gt;using System;&lt;br /&gt;using Microsoft.AspNetCore.Http;&lt;br /&gt;using Microsoft.AspNetCore.Http.Extensions;&lt;br /&gt;&lt;br /&gt;namespace My.App.Auth {&lt;br /&gt;    public static class AuthExtensions {&lt;br /&gt;        public const string ExternalBaseUrl = &amp;quot;https://mega-app.com&amp;quot;;&lt;br /&gt;        public const string InternalBaseUrl = &amp;quot;https://strictly4mypeeps.io&amp;quot;;&lt;br /&gt;&lt;br /&gt;        /// &amp;lt;summary&amp;gt;&lt;br /&gt;        /// Determines if a request is an &amp;quot;external&amp;quot; URL (eg begins &amp;quot;https://mega-app.com&amp;quot;)&lt;br /&gt;        /// or an &amp;quot;internal&amp;quot; URL (eg begins &amp;quot;https://strictly4mypeeps.io&amp;quot;)&lt;br /&gt;        /// &amp;lt;/summary&amp;gt;&lt;br /&gt;        public static (bool, string) GetIsExternalRequestAndDomain(this HttpRequest request) {&lt;br /&gt;            var (requestUrl, domain) = GetRequestUrlAndDomain(request);&lt;br /&gt;&lt;br /&gt;            var isExternalUrl = domain == ExternalBaseUrl;&lt;br /&gt;&lt;br /&gt;            var isUnknownPath = domain == null; // This scenario is extremely unlikely but has been observed once during testing so we will cater for it&lt;br /&gt;&lt;br /&gt;            var isExternalRequest = isExternalUrl || isUnknownPath; // If unknown we&amp;#39;ll treat as &amp;quot;external&amp;quot; for a safe fallback&lt;br /&gt;&lt;br /&gt;            return (isExternalRequest, requestUrl);&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        /// &amp;lt;summary&amp;gt;&lt;br /&gt;        /// Determines if a request is an &amp;quot;external&amp;quot; URL (eg begins &amp;quot;https://mega-app.com&amp;quot;)&lt;br /&gt;        /// or an &amp;quot;internal&amp;quot; URL (eg begins &amp;quot;https://strictly4mypeeps.io&amp;quot;)&lt;br /&gt;        /// &amp;lt;/summary&amp;gt;&lt;br /&gt;        public static (bool, string) GetIsInternalRequestAndDomain(this HttpRequest request) {&lt;br /&gt;            var (requestUrl, domain) = GetRequestUrlAndDomain(request);&lt;br /&gt;&lt;br /&gt;            var isInternalRequest = domain == InternalBaseUrl;&lt;br /&gt;&lt;br /&gt;            return (isInternalRequest, requestUrl);&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        private static (string, string) GetRequestUrlAndDomain(HttpRequest request) {&lt;br /&gt;            string requestUrl = null;&lt;br /&gt;            string domain = null;&lt;br /&gt;            if (request.Host.HasValue) {&lt;br /&gt;                requestUrl = request.GetEncodedUrl();&lt;br /&gt;                domain = new Uri(requestUrl).GetLeftPart(UriPartial.Authority);&lt;br /&gt;            }&lt;br /&gt;&lt;br /&gt;            return (requestUrl, domain);&lt;br /&gt;        }&lt;br /&gt;    }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Finally, I updated the &lt;code&gt;SpaController.cs&lt;/code&gt; (which serves initial requests to our Single Page Application) to cater for having two types of Auth in play:&lt;/p&gt;&lt;pre class="prettyprint cs"&gt;&lt;code class="lang-cs"&gt;        /// &amp;lt;summary&amp;gt;&lt;br /&gt;        /// ASP.NET will try and load the index.html using the FileServer if we don&amp;#39;t have a route&lt;br /&gt;        /// here to match `/`. These attributes can&amp;#39;t be on Index or the spa fallback doesn&amp;#39;t work&lt;br /&gt;        /// Note: this is almost perfect except that if someone actually calls /index.html they&amp;#39;ll get&lt;br /&gt;        /// the FileServer one, not the one from this file.&lt;br /&gt;        /// &amp;lt;/summary&amp;gt;&lt;br /&gt;        [HttpGet(&amp;quot;/&amp;quot;)]&lt;br /&gt;        [AllowAnonymous]&lt;br /&gt;        public async Task&amp;lt;IActionResult&amp;gt; SpaFallback([FromQuery] string returnUrl) {&lt;br /&gt;            var redirectUrlIfUserIsInternalAndNotAuthenticated = GetRedirectUrlIfUserIsInternalAndNotAuthenticated(returnUrl);&lt;br /&gt;&lt;br /&gt;            if (redirectUrlIfUserIsInternalAndNotAuthenticated != null)&lt;br /&gt;                return LocalRedirect(redirectUrlIfUserIsInternalAndNotAuthenticated);&lt;br /&gt;&lt;br /&gt;            return await Index(); // Index just serves up our SPA index.html&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        /// &amp;lt;summary&amp;gt;&lt;br /&gt;        /// SPA landing with authorisation - this endpoint will typically not be directly navigated to by a user; &lt;br /&gt;        /// rather it will be redirected to from the IndexWithoutAuthorisation and SpaFallback actions above&lt;br /&gt;        /// in the case where a user is *not* authenticated but has come from an internal URL eg https://strictlyformypeeps.io&lt;br /&gt;        /// &amp;lt;/summary&amp;gt;&lt;br /&gt;        [HttpGet(&amp;quot;/login-with-azure-ad&amp;quot;)]&lt;br /&gt;        [Authorize]&lt;br /&gt;        public async Task&amp;lt;IActionResult&amp;gt; IndexWithAuthorisation()&lt;br /&gt;        {&lt;br /&gt;            return await Index(); // Index just serves up our SPA index.html&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        /// &amp;lt;summary&amp;gt;&lt;br /&gt;        /// This method returns a RedirectURL if a request is coming from an internal URL&lt;br /&gt;        /// eg https://ix-web-int.prd.investec.cloud and is not authenticated.  In this case&lt;br /&gt;        /// we likely want to trigger authentication by redirecting to an authorized endpoint&lt;br /&gt;        /// &amp;lt;/summary&amp;gt;&lt;br /&gt;        string GetRedirectUrlIfUserIsInternalAndNotAuthenticated(string returnUrl)&lt;br /&gt;        {&lt;br /&gt;            // If a user is authenticated then we don&amp;#39;t need to trigger authentication&lt;br /&gt;            var isAuthenticated = User?.Identity?.Name != null;&lt;br /&gt;            if (isAuthenticated)&lt;br /&gt;                return null;&lt;br /&gt;&lt;br /&gt;            // This scenario is extremely unlikely but has been observed once during testing so we will cater for it&lt;br /&gt;            var (isInternalRequest, requestUrl) = Request.GetIsInternalRequestAndDomain();&lt;br /&gt;&lt;br /&gt;            if (isInternalRequest) {&lt;br /&gt;                var redirectUrl = $&amp;quot;/login-with-azure-ad{(string.IsNullOrEmpty(returnUrl) ? &amp;quot;&amp;quot; : &amp;quot;?returnUrl=&amp;quot; + WebUtility.UrlEncode(returnUrl))}&amp;quot;;&lt;br /&gt;                _logger.LogInformation(&lt;br /&gt;                    &amp;quot;Request ({RequestURL}) has come from internal domain ({InternalDomain}) but is not authenticated; redirecting to {RedirectURL}&amp;quot;,&lt;br /&gt;                    requestUrl, AuthExtensions.InternalBaseUrl, redirectUrl);&lt;br /&gt;&lt;br /&gt;                return redirectUrl;&lt;br /&gt;            }&lt;br /&gt;&lt;br /&gt;            return null;&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The code above allows anonymous requests to land in our app through the &lt;code&gt;AllowAnonymous&lt;/code&gt; attribute.  However, it checks the request when it comes in to see if:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;It&amp;#39;s an internal request (i.e. the Request URL starts &amp;quot;&lt;a href="https://strictly4mypeeps.io/&amp;quot;"&gt;https://strictly4mypeeps.io/&amp;quot;&lt;/a&gt;)&lt;/li&gt;&lt;li&gt;The current user is &lt;em&gt;not&lt;/em&gt; authenticated.&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;In this case the user is redirected to the &lt;a href="https://strictly4mypeeps.io/login-with-azure-ad"&gt;https://strictly4mypeeps.io/login-with-azure-ad&lt;/a&gt; route which is decorated with the &lt;code&gt;Authorize&lt;/code&gt; attribute.  This will trigger authentication for our unauthenticated internal users and drive them through the Azure AD login process.&lt;/p&gt;&lt;h4 id="the-mystery-of-no-documentation"&gt;The mystery of no documentation&lt;/h4&gt;&lt;p&gt;I&amp;#39;m so surprised that this approach hasn&amp;#39;t yet been better documented on the (generally superb) ASP.Net Core docs.  It&amp;#39;s such a potentially useful approach; and in our case, money saving too! I hope the official docs feature something on this in future.  If they do, and I&amp;#39;ve just missed it (possible!) then please hit me up in the comments.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2406084703011195084'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2406084703011195084'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2020/03/dual-boot-authentication-with-aspnetcore.html' title='Dual boot authentication with ASP.Net Core'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='https://4.bp.blogspot.com/-CjllrSY1e04/XneghUmKZ_I/AAAAAAAAUEA/WfZwU25wfQUWFVItCeC5l7FITgCaru9PgCPcBGAYYCw/s72-c/robski-dynamic-auth.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6819248093077473951</id><published>2020-02-21T07:33:00.000Z</published><updated>2020-02-21T07:33:03.811Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Web Workers, comlink, TypeScript and React</title><content type='html'>&lt;p&gt;JavaScript is famously single threaded.  However, if you're developing for the web, you may well know that this is not quite accurate.  There are &lt;a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Using_web_workers"&gt;&lt;code&gt;Web Workers&lt;/code&gt;&lt;/a&gt;:&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;A worker is an object created using a constructor (e.g. &lt;code&gt;Worker()&lt;/code&gt;) that runs a named JavaScript file  this file contains the code that will run in the worker thread; workers run in another global context that is different from the current window.&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;Given that there is a way to use other threads for background processing, why doesn't this happen all the time? Well there's a number of reasons; not the least of which is the ceremony involved in interacting with Web Workers. Consider the following example that illustrates moving a calculation into a worker:&lt;/p&gt;&lt;pre class="prettyprint ts"&gt;&lt;code class="language-js"&gt;// main.js&lt;br /&gt;function add2NumbersUsingWebWorker() {&lt;br /&gt;    const myWorker = new Worker(&amp;quot;worker.js&amp;quot;);&lt;br /&gt;&lt;br /&gt;    myWorker.postMessage([42, 7]);&lt;br /&gt;    console.log('Message posted to worker');&lt;br /&gt;&lt;br /&gt;    myWorker.onmessage = function(e) {&lt;br /&gt;        console.log('Message received from worker', e.data);&lt;br /&gt;    }&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;add2NumbersUsingWebWorker();&lt;br /&gt;&lt;br /&gt;// worker.js&lt;br /&gt;onmessage = function(e) {&lt;br /&gt;  console.log('Worker: Message received from main script');&lt;br /&gt;  const result = e.data[0] * e.data[1];&lt;br /&gt;  if (isNaN(result)) {&lt;br /&gt;    postMessage('Please write two numbers');&lt;br /&gt;  } else {&lt;br /&gt;    const workerResult = 'Result: ' + result;&lt;br /&gt;    console.log('Worker: Posting message back to main script');&lt;br /&gt;    postMessage(workerResult);&lt;br /&gt;  }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;em&gt;This is not simple.&lt;/em&gt;  It's hard to understand what's happening. Also, this approach only supports a single method call.  I'd much rather write something that looked more like this:&lt;/p&gt;&lt;pre class="prettyprint ts"&gt;&lt;code class="language-js"&gt;// main.js&lt;br /&gt;function add2NumbersUsingWebWorker() {&lt;br /&gt;    const myWorker = new Worker(&amp;quot;worker.js&amp;quot;);&lt;br /&gt;&lt;br /&gt;    const total = myWorker.add2Numbers([42, 7]);&lt;br /&gt;    console.log('Message received from worker', total);&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;add2NumbersUsingWebWorker();&lt;br /&gt;&lt;br /&gt;// worker.js&lt;br /&gt;export function add2Numbers(firstNumber, secondNumber) {&lt;br /&gt;  const result = firstNumber + secondNumber;&lt;br /&gt;  return (isNaN(result))&lt;br /&gt;    ? 'Please write two numbers'&lt;br /&gt;    : 'Result: ' + result;&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;There's a way to do this using a library made by Google called &lt;a href="https://github.com/GoogleChromeLabs/comlink"&gt;comlink&lt;/a&gt;. This post will demonstrate how we can use this.  We'll use TypeScript and webpack.  We'll also examine how to integrate this approach into a React app.&lt;/p&gt;&lt;h4&gt;A use case for a Web Worker&lt;/h4&gt;&lt;p&gt;Let's make ourselves a TypeScript web app. We're going to use &lt;code&gt;create-react-app&lt;/code&gt; for this:&lt;/p&gt;&lt;pre class="prettyprint"&gt;&lt;code class="language-shell"&gt;npx create-react-app webworkers-comlink-typescript-react --template typescript&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Create a &lt;code&gt;takeALongTimeToDoSomething.ts&lt;/code&gt; file alongside &lt;code&gt;index.tsx&lt;/code&gt;:&lt;/p&gt;&lt;pre class="prettyprint ts"&gt;&lt;code class="language-ts"&gt;export function takeALongTimeToDoSomething() {&lt;br /&gt;    console.log('Start our long running job...');&lt;br /&gt;    const seconds = 5;&lt;br /&gt;    const start = new Date().getTime();&lt;br /&gt;    const delay = seconds * 1000;&lt;br /&gt;&lt;br /&gt;    while (true) {&lt;br /&gt;        if ((new Date().getTime() - start) &amp;gt; delay) {&lt;br /&gt;            break;&lt;br /&gt;        }&lt;br /&gt;    }&lt;br /&gt;    console.log('Finished our long running job');&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;To &lt;code&gt;index.tsx&lt;/code&gt; add this code:&lt;/p&gt;&lt;pre class="prettyprint ts"&gt;&lt;code class="language-ts"&gt;import { takeALongTimeToDoSomething } from './takeALongTimeToDoSomething';&lt;br /&gt;&lt;br /&gt;// ...&lt;br /&gt;&lt;br /&gt;console.log('Do something');&lt;br /&gt;takeALongTimeToDoSomething();&lt;br /&gt;console.log('Do another thing');&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;When our application runs we see this behaviour:&lt;/p&gt; &lt;a href="https://3.bp.blogspot.com/-1NFBdptu-Mo/XjUqgCVVisI/AAAAAAAATa8/eYCZ_5XcmZoTAlykNW4Lp4m5uhXnr7KogCPcBGAYYCw/s1600/blocking.gif" imageanchor="1" &gt;&lt;img border="0" src="https://3.bp.blogspot.com/-1NFBdptu-Mo/XjUqgCVVisI/AAAAAAAATa8/eYCZ_5XcmZoTAlykNW4Lp4m5uhXnr7KogCPcBGAYYCw/s640/blocking.gif" width="640" height="245" data-original-width="1600" data-original-height="613" /&gt;&lt;/a&gt; &lt;p&gt;The app starts and logs &lt;code&gt;Do something&lt;/code&gt; and &lt;code&gt;Start our long running job...&lt;/code&gt; to the console. It then blocks the UI until the &lt;code&gt;takeALongTimeToDoSomething&lt;/code&gt; function has completed running.  During this time the screen is empty and unresponsive. This is a poor user experience.&lt;/p&gt;&lt;h4&gt;Hello &lt;code&gt;worker-plugin&lt;/code&gt; and &lt;code&gt;comlink&lt;/code&gt;&lt;/h4&gt;&lt;p&gt;To start using comlink we're going to need to eject our &lt;code&gt;create-react-app&lt;/code&gt; application.  The way &lt;code&gt;create-react-app&lt;/code&gt; works is by giving you a setup that handles a high percentage of the needs for a typical web app.  When you encounter an unsupported use case, you can run the &lt;code&gt;yarn eject&lt;/code&gt; command to get direct access to the configuration of your setup.&lt;/p&gt;&lt;p&gt;Web Workers are not that commonly used in day to day development at present. Consequently there isn't yet a &amp;quot;plug'n'play&amp;quot; solution for workers supported by &lt;code&gt;create-react-app&lt;/code&gt;.  There's a number of potential ways to support this use case and you can track the various discussions happening against &lt;code&gt;create-react-app&lt;/code&gt; that covers this.  For now, let's eject with:&lt;/p&gt;&lt;pre class="prettyprint"&gt;&lt;code&gt;yarn eject&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Then let's install the packages we're going to be using:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;a href="https://github.com/GoogleChromeLabs/worker-plugin"&gt;&lt;code&gt;worker-plugin&lt;/code&gt;&lt;/a&gt; - this webpack plugin automatically compiles modules loaded in Web Workers&lt;/li&gt;&lt;li&gt;&lt;code&gt;comlink&lt;/code&gt; - this library provides the RPC-like experience that we want from our workers&lt;/li&gt;&lt;/ul&gt;&lt;pre&gt;&lt;code&gt;yarn add comlink worker-plugin&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;We now need to tweak our &lt;code&gt;webpack.config.js&lt;/code&gt; to use the &lt;code&gt;worker-plugin&lt;/code&gt;:&lt;/p&gt;&lt;pre class="prettyprint ts"&gt;&lt;code class="language-js"&gt;const WorkerPlugin = require('worker-plugin');&lt;br /&gt;&lt;br /&gt;// ....&lt;br /&gt;&lt;br /&gt;    plugins: [&lt;br /&gt;      new WorkerPlugin(),&lt;br /&gt;&lt;br /&gt;// ....&lt;br /&gt;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Do note that there's a number of &lt;code&gt;plugins&lt;/code&gt; statements in the &lt;code&gt;webpack.config.js&lt;/code&gt;.  You want the top level one; look out for the &lt;code&gt;new HtmlWebpackPlugin&lt;/code&gt; statement and place your &lt;code&gt;new WorkerPlugin(),&lt;/code&gt; before that.&lt;/p&gt;&lt;h4&gt;Workerize our slow process&lt;/h4&gt;&lt;p&gt;Now we're ready to take our long running process and move it into a worker.  Inside the &lt;code&gt;src&lt;/code&gt; folder, create a new folder called &lt;code&gt;my-first-worker&lt;/code&gt;.  Our worker is going to live in here.  Into this folder we're going to add a &lt;code&gt;tsconfig.json&lt;/code&gt; file:&lt;/p&gt;&lt;pre class="prettyprint json"&gt;&lt;code&gt;{&lt;br /&gt;  &amp;quot;compilerOptions&amp;quot;: {&lt;br /&gt;    &amp;quot;strict&amp;quot;: true,&lt;br /&gt;    &amp;quot;target&amp;quot;: &amp;quot;esnext&amp;quot;,&lt;br /&gt;    &amp;quot;module&amp;quot;: &amp;quot;esnext&amp;quot;,&lt;br /&gt;    &amp;quot;lib&amp;quot;: [&lt;br /&gt;      &amp;quot;webworker&amp;quot;,&lt;br /&gt;      &amp;quot;esnext&amp;quot;&lt;br /&gt;    ],&lt;br /&gt;    &amp;quot;moduleResolution&amp;quot;: &amp;quot;node&amp;quot;,&lt;br /&gt;    &amp;quot;noUnusedLocals&amp;quot;: true,&lt;br /&gt;    &amp;quot;sourceMap&amp;quot;: true,&lt;br /&gt;    &amp;quot;allowJs&amp;quot;: false,&lt;br /&gt;    &amp;quot;baseUrl&amp;quot;: &amp;quot;.&amp;quot;&lt;br /&gt;  }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;This file exists to tell TypeScript that this is a Web Worker.  Do note the &lt;code&gt;&amp;quot;lib&amp;quot;: [ &amp;quot;webworker&amp;quot;&lt;/code&gt; usage which does exactly that.&lt;/p&gt;&lt;p&gt;Alongside the &lt;code&gt;tsconfig.json&lt;/code&gt; file, let's create an &lt;code&gt;index.ts&lt;/code&gt; file.  This will be our worker:&lt;/p&gt;&lt;pre class="prettyprint ts"&gt;&lt;code class="language-ts"&gt;import { expose } from 'comlink';&lt;br /&gt;import { takeALongTimeToDoSomething } from '../takeALongTimeToDoSomething';&lt;br /&gt;&lt;br /&gt;const exports = {&lt;br /&gt;    takeALongTimeToDoSomething&lt;br /&gt;};&lt;br /&gt;export type MyFirstWorker = typeof exports;&lt;br /&gt;&lt;br /&gt;expose(exports);&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;There's a number of things happening in our small worker file.  Let's go through this statement by statement:&lt;/p&gt;&lt;pre class="prettyprint ts"&gt;&lt;code class="language-ts"&gt;import { expose } from 'comlink';&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Here we're importing the &lt;code&gt;expose&lt;/code&gt; method from comlink.  Comlinks goal is to make &lt;em&gt;expose&lt;/em&gt;d values from one thread available in the other.  The &lt;code&gt;expose&lt;/code&gt; method can be viewed as the comlink equivalent of &lt;code&gt;export&lt;/code&gt;. It is used to export the RPC style signature of our worker.  We'll see it's use later.&lt;/p&gt;&lt;pre class="prettyprint ts"&gt;&lt;code class="language-ts"&gt;import { takeALongTimeToDoSomething } from '../takeALongTimeToDoSomething';&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Here we're going to import our &lt;code&gt;takeALongTimeToDoSomething&lt;/code&gt; function that we wrote previously, so we can use it in our worker.&lt;/p&gt;&lt;pre class="prettyprint ts"&gt;&lt;code class="language-ts"&gt;const exports = {&lt;br /&gt;    takeALongTimeToDoSomething&lt;br /&gt;};&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Here we're creating the public facing API that we're going to expose.&lt;/p&gt;&lt;pre class="prettyprint ts"&gt;&lt;code class="language-ts"&gt;export type MyFirstWorker = typeof exports;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;We're going to want our worker to be strongly typed.  This line creates a type called &lt;code&gt;MyFirstWorker&lt;/code&gt; which is derived from our &lt;code&gt;exports&lt;/code&gt; object literal.&lt;/p&gt;&lt;pre class="prettyprint ts"&gt;&lt;code class="language-ts"&gt;expose(exports);&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Finally we expose the &lt;code&gt;exports&lt;/code&gt; using comlink.  We're done; that's our worker finished.  Now let's consume it.  Let's change our &lt;code&gt;index.tsx&lt;/code&gt; file to use it.  Replace our import of &lt;code&gt;takeALongTimeToDoSomething&lt;/code&gt;:&lt;/p&gt;&lt;pre class="prettyprint ts"&gt;&lt;code class="language-ts"&gt;import { takeALongTimeToDoSomething } from './takeALongTimeToDoSomething';&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;With an import of &lt;code&gt;wrap&lt;/code&gt; from comlink that creates a local &lt;code&gt;takeALongTimeToDoSomething&lt;/code&gt; function that wraps interacting with our worker:&lt;/p&gt;&lt;pre class="prettyprint ts"&gt;&lt;code class="language-ts"&gt;import { wrap } from 'comlink';&lt;br /&gt;&lt;br /&gt;function takeALongTimeToDoSomething() {&lt;br /&gt;    const worker = new Worker('./my-first-worker', { name: 'my-first-worker', type: 'module' });&lt;br /&gt;    const workerApi = wrap&amp;lt;import('./my-first-worker').MyFirstWorker&amp;gt;(worker);&lt;br /&gt;    workerApi.takeALongTimeToDoSomething();    &lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Now we're ready to demo our application using our function offloaded into a Web Worker. It now behaves like this:&lt;/p&gt; &lt;a href="https://2.bp.blogspot.com/-UDxm0xHbJpY/XjUrg4BwgTI/AAAAAAAATbE/F2jZ2F4nI9c05puL6zP8n6VYvrPsEOjIQCLcBGAsYHQ/s1600/non-blocking.gif" imageanchor="1" &gt;&lt;img border="0" src="https://2.bp.blogspot.com/-UDxm0xHbJpY/XjUrg4BwgTI/AAAAAAAATbE/F2jZ2F4nI9c05puL6zP8n6VYvrPsEOjIQCLcBGAsYHQ/s640/non-blocking.gif" width="640" height="251" data-original-width="1600" data-original-height="627" /&gt;&lt;/a&gt; &lt;p&gt;There's a number of exciting things to note here:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;The application is now non-blocking.  Our long running function is now not preventing the UI from updating&lt;/li&gt;&lt;li&gt;The functionality is lazily loaded via a &lt;code&gt;my-first-worker.chunk.worker.js&lt;/code&gt; that has been created by the &lt;code&gt;worker-plugin&lt;/code&gt; and &lt;code&gt;comlink&lt;/code&gt;.&lt;/li&gt;&lt;/ol&gt;&lt;h4&gt;Using Web Workers in React&lt;/h4&gt;&lt;p&gt;The example we've showed so far demostrates how you could use Web Workers and why you might want to.  However, it's a far cry from a real world use case.  Let's take the next step and plug our Web Worker usage into our React application.  What would that look like?  Let's find out.&lt;/p&gt;&lt;p&gt;We'll return &lt;code&gt;index.tsx&lt;/code&gt; back to it's initial state.  Then we'll make a simple adder function that takes some values and returns their total.  To our &lt;code&gt;takeALongTimeToDoSomething.ts&lt;/code&gt; module let's add:&lt;/p&gt;&lt;pre class="prettyprint ts"&gt;&lt;code class="language-ts"&gt;export function takeALongTimeToAddTwoNumbers(number1: number, number2: number) {&lt;br /&gt;    console.log('Start to add...');&lt;br /&gt;    const seconds = 5;&lt;br /&gt;    const start = new Date().getTime();&lt;br /&gt;    const delay = seconds * 1000;&lt;br /&gt;    while (true) {&lt;br /&gt;        if ((new Date().getTime() - start) &amp;gt; delay) {&lt;br /&gt;            break;&lt;br /&gt;        }&lt;br /&gt;    }&lt;br /&gt;    const total = number1 + number2;&lt;br /&gt;    console.log('Finished adding');&lt;br /&gt;    return total;&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Let's start using our long running calculator in a React component.  We'll update our &lt;code&gt;App.tsx&lt;/code&gt; to use this function and create a simple adder component:&lt;/p&gt;&lt;pre class="prettyprint ts"&gt;&lt;code class="language-tsx"&gt;import React, { useState } from &amp;quot;react&amp;quot;;&lt;br /&gt;import &amp;quot;./App.css&amp;quot;;&lt;br /&gt;import { takeALongTimeToAddTwoNumbers } from &amp;quot;./takeALongTimeToDoSomething&amp;quot;;&lt;br /&gt;&lt;br /&gt;const App: React.FC = () =&amp;gt; {&lt;br /&gt;  const [number1, setNumber1] = useState(1);&lt;br /&gt;  const [number2, setNumber2] = useState(2);&lt;br /&gt;&lt;br /&gt;  const total = takeALongTimeToAddTwoNumbers(number1, number2);&lt;br /&gt;&lt;br /&gt;  return (&lt;br /&gt;    &amp;lt;div className=&amp;quot;App&amp;quot;&amp;gt;&lt;br /&gt;      &amp;lt;h1&amp;gt;Web Workers in action!&amp;lt;/h1&amp;gt;&lt;br /&gt;&lt;br /&gt;      &amp;lt;div&amp;gt;&lt;br /&gt;        &amp;lt;label&amp;gt;Number to add: &amp;lt;/label&amp;gt;&lt;br /&gt;        &amp;lt;input&lt;br /&gt;          type=&amp;quot;number&amp;quot;&lt;br /&gt;          onChange={e =&amp;gt; setNumber1(parseInt(e.target.value))}&lt;br /&gt;          value={number1}&lt;br /&gt;        /&amp;gt;&lt;br /&gt;      &amp;lt;/div&amp;gt;&lt;br /&gt;      &amp;lt;div&amp;gt;&lt;br /&gt;        &amp;lt;label&amp;gt;Number to add: &amp;lt;/label&amp;gt;&lt;br /&gt;        &amp;lt;input&lt;br /&gt;          type=&amp;quot;number&amp;quot;&lt;br /&gt;          onChange={e =&amp;gt; setNumber2(parseInt(e.target.value))}&lt;br /&gt;          value={number2}&lt;br /&gt;        /&amp;gt;&lt;br /&gt;      &amp;lt;/div&amp;gt;&lt;br /&gt;      &amp;lt;h2&amp;gt;Total: {total}&amp;lt;/h2&amp;gt;&lt;br /&gt;    &amp;lt;/div&amp;gt;&lt;br /&gt;  );&lt;br /&gt;};&lt;br /&gt;&lt;br /&gt;export default App;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;When you try it out you'll notice that entering a single digit locks the UI for 5 seconds whilst it adds the numbers. From the moment the cursor stops blinking to the moment the screen updates the UI is non-responsive:&lt;/p&gt; &lt;a href="https://2.bp.blogspot.com/-ngQ_wdVxKYw/XjUr33bOiWI/AAAAAAAATbM/kkMzEWKCu8w0NrD6CZeyNRW8CYQ78eRzgCLcBGAsYHQ/s1600/blocking-react.gif" imageanchor="1" &gt;&lt;img border="0" src="https://2.bp.blogspot.com/-ngQ_wdVxKYw/XjUr33bOiWI/AAAAAAAATbM/kkMzEWKCu8w0NrD6CZeyNRW8CYQ78eRzgCLcBGAsYHQ/s640/blocking-react.gif" width="640" height="293" data-original-width="544" data-original-height="249" /&gt;&lt;/a&gt; &lt;p&gt;So far, so classic. Let's Web Workerify this!&lt;/p&gt;&lt;p&gt;We'll update our &lt;code&gt;my-first-worker/index.ts&lt;/code&gt; to import this new function:&lt;/p&gt;&lt;pre class="prettyprint ts"&gt;&lt;code class="language-ts"&gt;import { expose } from &amp;quot;comlink&amp;quot;;&lt;br /&gt;import {&lt;br /&gt;  takeALongTimeToDoSomething,&lt;br /&gt;  takeALongTimeToAddTwoNumbers&lt;br /&gt;} from &amp;quot;../takeALongTimeToDoSomething&amp;quot;;&lt;br /&gt;&lt;br /&gt;const exports = {&lt;br /&gt;  takeALongTimeToDoSomething,&lt;br /&gt;  takeALongTimeToAddTwoNumbers&lt;br /&gt;};&lt;br /&gt;export type MyFirstWorker = typeof exports;&lt;br /&gt;&lt;br /&gt;expose(exports);&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Alongside our &lt;code&gt;App.tsx&lt;/code&gt; file let's create an &lt;code&gt;App.hooks.ts&lt;/code&gt; file.&lt;/p&gt;&lt;pre class="prettyprint ts"&gt;&lt;code class="language-ts"&gt;import { wrap, releaseProxy } from &amp;quot;comlink&amp;quot;;&lt;br /&gt;import { useEffect, useState, useMemo } from &amp;quot;react&amp;quot;;&lt;br /&gt;&lt;br /&gt;/**&lt;br /&gt; * Our hook that performs the calculation on the worker&lt;br /&gt; */&lt;br /&gt;export function useTakeALongTimeToAddTwoNumbers(&lt;br /&gt;  number1: number,&lt;br /&gt;  number2: number&lt;br /&gt;) {&lt;br /&gt;  // We'll want to expose a wrapping object so we know when a calculation is in progress&lt;br /&gt;  const [data, setData] = useState({&lt;br /&gt;    isCalculating: false,&lt;br /&gt;    total: undefined as number | undefined&lt;br /&gt;  });&lt;br /&gt;&lt;br /&gt;  // acquire our worker&lt;br /&gt;  const { workerApi } = useWorker();&lt;br /&gt;&lt;br /&gt;  useEffect(() =&amp;gt; {&lt;br /&gt;    // We're starting the calculation here&lt;br /&gt;    setData({ isCalculating: true, total: undefined });&lt;br /&gt;&lt;br /&gt;    workerApi&lt;br /&gt;      .takeALongTimeToAddTwoNumbers(number1, number2)&lt;br /&gt;      .then(total =&amp;gt; setData({ isCalculating: false, total })); // We receive the result here&lt;br /&gt;  }, [workerApi, setData, number1, number2]);&lt;br /&gt;&lt;br /&gt;  return data;&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;function useWorker() {&lt;br /&gt;  // memoise a worker so it can be reused; create one worker up front&lt;br /&gt;  // and then reuse it subsequently; no creating new workers each time&lt;br /&gt;  const workerApiAndCleanup = useMemo(() =&amp;gt; makeWorkerApiAndCleanup(), []);&lt;br /&gt;&lt;br /&gt;  useEffect(() =&amp;gt; {&lt;br /&gt;    const { cleanup } = workerApiAndCleanup;&lt;br /&gt;&lt;br /&gt;    // cleanup our worker when we're done with it&lt;br /&gt;    return () =&amp;gt; {&lt;br /&gt;      cleanup();&lt;br /&gt;    };&lt;br /&gt;  }, [workerApiAndCleanup]);&lt;br /&gt;&lt;br /&gt;  return workerApiAndCleanup;&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;/**&lt;br /&gt; * Creates a worker, a cleanup function and returns it&lt;br /&gt; */&lt;br /&gt;function makeWorkerApiAndCleanup() {&lt;br /&gt;  // Here we create our worker and wrap it with comlink so we can interact with it&lt;br /&gt;  const worker = new Worker(&amp;quot;./my-first-worker&amp;quot;, {&lt;br /&gt;    name: &amp;quot;my-first-worker&amp;quot;,&lt;br /&gt;    type: &amp;quot;module&amp;quot;&lt;br /&gt;  });&lt;br /&gt;  const workerApi = wrap&amp;lt;import(&amp;quot;./my-first-worker&amp;quot;).MyFirstWorker&amp;gt;(worker);&lt;br /&gt;&lt;br /&gt;  // A cleanup function that releases the comlink proxy and terminates the worker&lt;br /&gt;  const cleanup = () =&amp;gt; {&lt;br /&gt;    workerApi[releaseProxy]();&lt;br /&gt;    worker.terminate();&lt;br /&gt;  };&lt;br /&gt;&lt;br /&gt;  const workerApiAndCleanup = { workerApi, cleanup };&lt;br /&gt;&lt;br /&gt;  return workerApiAndCleanup;&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The &lt;code&gt;useWorker&lt;/code&gt; and &lt;code&gt;makeWorkerApiAndCleanup&lt;/code&gt; functions make up the basis of a shareable worker hooks approach.  It would take very little work to paramaterise them so this could be used elsewhere.  That's outside the scope of this post but would be extremely straightforward to accomplish.&lt;/p&gt;&lt;p&gt;Time to test!  We'll change our &lt;code&gt;App.tsx&lt;/code&gt; to use the new &lt;code&gt;useTakeALongTimeToAddTwoNumbers&lt;/code&gt; hook:&lt;/p&gt;&lt;pre class="prettyprint ts"&gt;&lt;code class="language-tsx"&gt;import React, { useState } from &amp;quot;react&amp;quot;;&lt;br /&gt;import &amp;quot;./App.css&amp;quot;;&lt;br /&gt;import { useTakeALongTimeToAddTwoNumbers } from &amp;quot;./App.hooks&amp;quot;;&lt;br /&gt;&lt;br /&gt;const App: React.FC = () =&amp;gt; {&lt;br /&gt;  const [number1, setNumber1] = useState(1);&lt;br /&gt;  const [number2, setNumber2] = useState(2);&lt;br /&gt;&lt;br /&gt;  const total = useTakeALongTimeToAddTwoNumbers(number1, number2);&lt;br /&gt;&lt;br /&gt;  return (&lt;br /&gt;    &amp;lt;div className=&amp;quot;App&amp;quot;&amp;gt;&lt;br /&gt;      &amp;lt;h1&amp;gt;Web Workers in action!&amp;lt;/h1&amp;gt;&lt;br /&gt;&lt;br /&gt;      &amp;lt;div&amp;gt;&lt;br /&gt;        &amp;lt;label&amp;gt;Number to add: &amp;lt;/label&amp;gt;&lt;br /&gt;        &amp;lt;input&lt;br /&gt;          type=&amp;quot;number&amp;quot;&lt;br /&gt;          onChange={e =&amp;gt; setNumber1(parseInt(e.target.value))}&lt;br /&gt;          value={number1}&lt;br /&gt;        /&amp;gt;&lt;br /&gt;      &amp;lt;/div&amp;gt;&lt;br /&gt;      &amp;lt;div&amp;gt;&lt;br /&gt;        &amp;lt;label&amp;gt;Number to add: &amp;lt;/label&amp;gt;&lt;br /&gt;        &amp;lt;input&lt;br /&gt;          type=&amp;quot;number&amp;quot;&lt;br /&gt;          onChange={e =&amp;gt; setNumber2(parseInt(e.target.value))}&lt;br /&gt;          value={number2}&lt;br /&gt;        /&amp;gt;&lt;br /&gt;      &amp;lt;/div&amp;gt;&lt;br /&gt;      &amp;lt;h2&amp;gt;&lt;br /&gt;        Total:{&amp;quot; &amp;quot;}&lt;br /&gt;        {total.isCalculating ? (&lt;br /&gt;          &amp;lt;em&amp;gt;Calculating...&amp;lt;/em&amp;gt;&lt;br /&gt;        ) : (&lt;br /&gt;          &amp;lt;strong&amp;gt;{total.total}&amp;lt;/strong&amp;gt;&lt;br /&gt;        )}&lt;br /&gt;      &amp;lt;/h2&amp;gt;&lt;br /&gt;    &amp;lt;/div&amp;gt;&lt;br /&gt;  );&lt;br /&gt;};&lt;br /&gt;&lt;br /&gt;export default App;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Now our calculation takes place off the main thread and the UI is no longer blocked!&lt;/p&gt; &lt;a href="https://3.bp.blogspot.com/-WOTMRZzhaVk/XjUsJTMXBxI/AAAAAAAATbU/6WXtrpk66mY6aFyxBcgvBktQScq_AhyZwCLcBGAsYHQ/s1600/non-blocking-react.gif" imageanchor="1" &gt;&lt;img border="0" src="https://3.bp.blogspot.com/-WOTMRZzhaVk/XjUsJTMXBxI/AAAAAAAATbU/6WXtrpk66mY6aFyxBcgvBktQScq_AhyZwCLcBGAsYHQ/s640/non-blocking-react.gif" width="640" height="293" data-original-width="544" data-original-height="249" /&gt;&lt;/a&gt; &lt;p&gt;&lt;a href="https://blog.logrocket.com/integrating-web-workers-in-a-react-app-with-comlink/"&gt;This post was originally published on LogRocket.&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a href="https://github.com/johnnyreilly/webworkers-comlink-typescript-react"&gt;The source code for this project can be found here.&lt;/a&gt;&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/6819248093077473951'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/6819248093077473951'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2020/02/web-workers-comlink-typescript-and-react.html' title='Web Workers, comlink, TypeScript and React'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='https://3.bp.blogspot.com/-1NFBdptu-Mo/XjUqgCVVisI/AAAAAAAATa8/eYCZ_5XcmZoTAlykNW4Lp4m5uhXnr7KogCPcBGAYYCw/s72-c/blocking.gif' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6339225671719497538</id><published>2020-01-31T07:59:00.000Z</published><updated>2020-01-31T07:59:02.619Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>From create-react-app to PWA</title><content type='html'>&lt;p&gt;Progressive Web Apps are a (terribly named) wonderful idea.  You can build an app &lt;em&gt;once&lt;/em&gt; using web technologies which serves all devices and form factors.  It can be accessible over the web, but also surface on the home screen of your Android / iOS device.   That app can work offline, have a splash screen when it launches and have notifications too.&lt;/p&gt;&lt;p&gt;PWAs can be a money saver for your business. The alternative, should you want an app experience for your users, is building the same application using three different technologies (one for web, one for Android and one for iOS).  When you take this path it's hard to avoid a multiplication of cost and complexity. It often leads to dividing up the team as each works on a different stack. It's common to lose a certain amount of focus as a consequence.  PWAs can help here; they are a compelling alternative, not just from a developers standpoint, but from a resourcing one too.&lt;/p&gt;&lt;p&gt;However, the downside of PWAs is that they are more complicated than normal web apps. Writing one from scratch is just less straightforward than a classic web app. There are easy onramps to building a PWA that help you fall into the pit of success.  This post will highlight one of these.  How you can travel from zero to a PWA of your very own using React and TypeScript.&lt;/p&gt;&lt;p&gt;This post presumes knowledge of:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;React&lt;/li&gt;&lt;li&gt;TypeScript&lt;/li&gt;&lt;li&gt;Node&lt;/li&gt;&lt;/ul&gt;&lt;h4&gt;From console to web app&lt;/h4&gt;&lt;p&gt;To create our PWA we're going to use &lt;a href="https://create-react-app.dev/"&gt;&lt;code&gt;create-react-app&lt;/code&gt;&lt;/a&gt;.  This excellent project has long had inbuilt support for making PWAs.  In recent months that support has matured to a very satisfactory level.  To create ourselves a TypeScript React app using &lt;code&gt;create-react-app&lt;/code&gt; enter this &lt;code&gt;npx&lt;/code&gt; command at the console:&lt;/p&gt;&lt;pre class="prettyprint"&gt;&lt;code class="language-shell"&gt;npx create-react-app pwa-react-typescript --template typescript&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;This builds you a react web app built with TypeScript; it can be tested locally with:&lt;/p&gt;&lt;pre class="prettyprint"&gt;&lt;code class="language-shell"&gt;cd pwa-react-typescript&lt;br /&gt;yarn start&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h4&gt;From web app to PWA&lt;/h4&gt;&lt;p&gt;From web app to PWA is incredibly simple; its just a question of opting in to offline behaviour.  If you open up the &lt;code&gt;index.tsx&lt;/code&gt; file in your newly created project you'll find this code:&lt;/p&gt;&lt;pre class="prettyprint"&gt;&lt;code class="language-ts"&gt;// If you want your app to work offline and load faster, you can change&lt;br /&gt;// unregister() to register() below. Note this comes with some pitfalls.&lt;br /&gt;// Learn more about service workers: https://bit.ly/CRA-PWA&lt;br /&gt;serviceWorker.unregister();&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;As the hint suggests, swap &lt;code&gt;serviceWorker.unregister()&lt;/code&gt; for &lt;code&gt;serviceWorker.register()&lt;/code&gt; and you now have a PWA.  Amazing! What does this mean?  Well to &lt;a href="https://create-react-app.dev/docs/making-a-progressive-web-app/#why-opt-in"&gt;quote the docs&lt;/a&gt;:&lt;/p&gt;&lt;blockquote&gt;&lt;ul&gt;&lt;li&gt;All static site assets are cached so that your page loads fast on subsequent visits, regardless of network connectivity (such as 2G or 3G). Updates are downloaded in the background.&lt;/li&gt;&lt;li&gt;Your app will work regardless of network state, even if offline. This means your users will be able to use your app at 10,000 feet and on the subway.&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;... it will take care of generating a service worker file that will automatically precache all of your local assets and keep them up to date as you deploy updates. The service worker will use a &lt;a href="https://developers.google.com/web/fundamentals/instant-and-offline/offline-cookbook/#cache-falling-back-to-network"&gt;cache-first strategy&lt;/a&gt;for handling all requests for local assets, including &lt;a href="https://developers.google.com/web/fundamentals/primers/service-workers/high-performance-loading#first_what_are_navigation_requests"&gt;navigation requests&lt;/a&gt; for your HTML, ensuring that your web app is consistently fast, even on a slow or unreliable network.&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;Under the bonnet, &lt;code&gt;create-react-app&lt;/code&gt; is achieving this through the use of technology called &lt;a href="https://developers.google.com/web/tools/workbox"&gt;&amp;quot;Workbox&amp;quot;&lt;/a&gt;. Workbox describes itself as:&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;a set of libraries and Node modules that make it easy to cache assets and take full advantage of features used to build &lt;a href="https://developers.google.com/web/progressive-web-apps/"&gt;Progressive Web Apps&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;The good folks of Google are aware that writing your own PWA can be tricky.  There's much new behaviour to configure and be aware of; it's easy to make mistakes.  Workbox is there to help ease the way forward by implementing default strategies for caching / offline behaviour which can be controlled through configuration.&lt;/p&gt;&lt;p&gt;A downside of the usage of &lt;code&gt;Workbox&lt;/code&gt; in &lt;code&gt;create-react-app&lt;/code&gt; is that (as with most things &lt;code&gt;create-react-app&lt;/code&gt;) there's little scope for configuration of your own if the defaults don't serve your purpose.  This may change in the future, indeed &lt;a href="https://github.com/facebook/create-react-app/pull/5369"&gt;there's an open PR that adds this support&lt;/a&gt;.&lt;/p&gt;&lt;h4&gt;Icons and splash screens and A2HS, oh my!&lt;/h4&gt;&lt;p&gt;But it's not just an offline experience that makes this a PWA.  Other important factors are:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;That the app can be added to your home screen (A2HS AKA &amp;quot;installed&amp;quot;).&lt;/li&gt;&lt;li&gt;That the app has a name and an icon which can be customised.&lt;/li&gt;&lt;li&gt;That there's a splash screen displayed to the user as the app starts up.&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;All of the above is &amp;quot;in the box&amp;quot; with &lt;code&gt;create-react-app&lt;/code&gt;. Let's start customizing these.&lt;/p&gt;&lt;p&gt;First of all, we'll give our app a name. Fire up &lt;code&gt;index.html&lt;/code&gt; and replace &lt;code&gt;&amp;lt;title&amp;gt;React App&amp;lt;/title&amp;gt;&lt;/code&gt; with &lt;code&gt;&amp;lt;title&amp;gt;My PWA&amp;lt;/title&amp;gt;&lt;/code&gt;.  (Feel free to concoct a more imaginative name than the one I've suggested.)  Next open up &lt;code&gt;manifest.json&lt;/code&gt; and replace:&lt;/p&gt;&lt;pre class="prettyprint"&gt;&lt;code class="language-json"&gt;  &amp;quot;short_name&amp;quot;: &amp;quot;React App&amp;quot;,&lt;br /&gt;  &amp;quot;name&amp;quot;: &amp;quot;Create React App Sample&amp;quot;,&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;with:&lt;/p&gt;&lt;pre class="prettyprint"&gt;&lt;code class="language-json"&gt;  &amp;quot;short_name&amp;quot;: &amp;quot;My PWA&amp;quot;,&lt;br /&gt;  &amp;quot;name&amp;quot;: &amp;quot;My PWA&amp;quot;,&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Your app now has a name.  The question you might be asking is: what is this &lt;code&gt;manifest.json&lt;/code&gt; file? Well to &lt;a href="https://developers.google.com/web/fundamentals/web-app-manifest"&gt;quote the good folks of Google&lt;/a&gt;:&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;The &lt;a href="https://developer.mozilla.org/en-US/docs/Web/Manifest"&gt;web app manifest&lt;/a&gt; is a simple JSON file that tells the browser about your web application and how it should behave when 'installed' on the user's mobile device or desktop. Having a manifest is required by Chrome to show the &lt;a href="https://developers.google.com/web/fundamentals/app-install-banners/"&gt;Add to Home Screen prompt&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;A typical manifest file includes information about the app name, icons it should use, the start_url it should start at when launched, and more.&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;So the &lt;code&gt;manifest.json&lt;/code&gt; is essentially metadata about your app.  Here's what it should look like right now:&lt;/p&gt;&lt;pre class="prettyprint"&gt;&lt;code class="language-json"&gt;{&lt;br /&gt;  &amp;quot;short_name&amp;quot;: &amp;quot;My PWA&amp;quot;,&lt;br /&gt;  &amp;quot;name&amp;quot;: &amp;quot;My PWA&amp;quot;,&lt;br /&gt;  &amp;quot;icons&amp;quot;: [&lt;br /&gt;    {&lt;br /&gt;      &amp;quot;src&amp;quot;: &amp;quot;favicon.ico&amp;quot;,&lt;br /&gt;      &amp;quot;sizes&amp;quot;: &amp;quot;64x64 32x32 24x24 16x16&amp;quot;,&lt;br /&gt;      &amp;quot;type&amp;quot;: &amp;quot;image/x-icon&amp;quot;&lt;br /&gt;    },&lt;br /&gt;    {&lt;br /&gt;      &amp;quot;src&amp;quot;: &amp;quot;logo192.png&amp;quot;,&lt;br /&gt;      &amp;quot;type&amp;quot;: &amp;quot;image/png&amp;quot;,&lt;br /&gt;      &amp;quot;sizes&amp;quot;: &amp;quot;192x192&amp;quot;&lt;br /&gt;    },&lt;br /&gt;    {&lt;br /&gt;      &amp;quot;src&amp;quot;: &amp;quot;logo512.png&amp;quot;,&lt;br /&gt;      &amp;quot;type&amp;quot;: &amp;quot;image/png&amp;quot;,&lt;br /&gt;      &amp;quot;sizes&amp;quot;: &amp;quot;512x512&amp;quot;&lt;br /&gt;    }&lt;br /&gt;  ],&lt;br /&gt;  &amp;quot;start_url&amp;quot;: &amp;quot;.&amp;quot;,&lt;br /&gt;  &amp;quot;display&amp;quot;: &amp;quot;standalone&amp;quot;,&lt;br /&gt;  &amp;quot;theme_color&amp;quot;: &amp;quot;#000000&amp;quot;,&lt;br /&gt;  &amp;quot;background_color&amp;quot;: &amp;quot;#ffffff&amp;quot;&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;You can use the above properties (and others not yet configured) to control how your app behaves.  For instance, if you want to replace icons your app uses then it's a simple matter of:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;placing new logo files in the &lt;code&gt;public&lt;/code&gt; folder&lt;/li&gt;&lt;li&gt;updating references to them in the &lt;code&gt;manifest.json&lt;/code&gt;&lt;/li&gt;&lt;li&gt;finally, for older Apple devices, updating the &lt;code&gt;&amp;lt;link rel=&amp;quot;apple-touch-icon&amp;quot; ... /&amp;gt;&lt;/code&gt; in the &lt;code&gt;index.html&lt;/code&gt;.&lt;/li&gt;&lt;/ul&gt;&lt;h4&gt;Where are we?&lt;/h4&gt;&lt;p&gt;So far, we have a basic PWA in place.  It's installable.  You can run it locally and develop it with &lt;code&gt;yarn start&lt;/code&gt;.  You can build it for deployment with &lt;code&gt;yarn build&lt;/code&gt;.&lt;/p&gt;&lt;p&gt;What this isn't, is recognisably a web app. In the sense that it doesn't have support for different pages / URLs. We're typically going to want to break up our application this way.  Let's do that now.  We're going to use &lt;a href="https://github.com/ReactTraining/react-router"&gt;&lt;code&gt;react-router&lt;/code&gt;&lt;/a&gt;; the de facto routing solution for React. To add it to our project (and the required type definitions for TypeScript) we use:&lt;/p&gt;&lt;pre class="prettyprint"&gt;&lt;code&gt;yarn add react-router-dom @types/react-router-dom&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Now let's split up our app into a couple of pages.  We'll replace the existing &lt;code&gt;App.tsx&lt;/code&gt; with this:&lt;/p&gt;&lt;pre class="prettyprint"&gt;&lt;code class="language-tsx"&gt;import React from &amp;quot;react&amp;quot;;&lt;br /&gt;import { BrowserRouter as Router, Switch, Route, Link } from &amp;quot;react-router-dom&amp;quot;;&lt;br /&gt;import About from &amp;quot;./About&amp;quot;;&lt;br /&gt;import Home from &amp;quot;./Home&amp;quot;;&lt;br /&gt;&lt;br /&gt;const App: React.FC = () =&amp;gt; (&lt;br /&gt;  &amp;lt;Router&amp;gt;&lt;br /&gt;    &amp;lt;nav&amp;gt;&lt;br /&gt;      &amp;lt;ul&amp;gt;&lt;br /&gt;        &amp;lt;li&amp;gt;&lt;br /&gt;          &amp;lt;Link to=&amp;quot;/&amp;quot;&amp;gt;Home&amp;lt;/Link&amp;gt;&lt;br /&gt;        &amp;lt;/li&amp;gt;&lt;br /&gt;        &amp;lt;li&amp;gt;&lt;br /&gt;          &amp;lt;Link to=&amp;quot;/about&amp;quot;&amp;gt;About&amp;lt;/Link&amp;gt;&lt;br /&gt;        &amp;lt;/li&amp;gt;&lt;br /&gt;      &amp;lt;/ul&amp;gt;&lt;br /&gt;    &amp;lt;/nav&amp;gt;&lt;br /&gt;    &amp;lt;Switch&amp;gt;&lt;br /&gt;      &amp;lt;Route path=&amp;quot;/about&amp;quot;&amp;gt;&lt;br /&gt;        &amp;lt;About /&amp;gt;&lt;br /&gt;      &amp;lt;/Route&amp;gt;&lt;br /&gt;      &amp;lt;Route path=&amp;quot;/&amp;quot;&amp;gt;&lt;br /&gt;        &amp;lt;Home /&amp;gt;&lt;br /&gt;      &amp;lt;/Route&amp;gt;&lt;br /&gt;    &amp;lt;/Switch&amp;gt;&lt;br /&gt;  &amp;lt;/Router&amp;gt;&lt;br /&gt;);&lt;br /&gt;&lt;br /&gt;export default App;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;This will be our root page. It has the responsiblity of using &lt;code&gt;react-router&lt;/code&gt; to render the pages we want to serve, and also to provide the links that allow users to navigate to those pages.  In making our changes we'll have broken our test (which checked for a link we've now deleted), so we'll fix it like so:&lt;/p&gt;&lt;p&gt;Replace the &lt;code&gt;App.test.tsx&lt;/code&gt; with this:&lt;/p&gt;&lt;pre class="prettyprint"&gt;&lt;code class="language-tsx"&gt;import React from 'react';&lt;br /&gt;import { render } from '@testing-library/react';&lt;br /&gt;import App from './App';&lt;br /&gt;&lt;br /&gt;test('renders about link', () =&amp;gt; {&lt;br /&gt;  const { getByText } = render(&amp;lt;App /&amp;gt;);&lt;br /&gt;  const linkElement = getByText(/about/i);&lt;br /&gt;  expect(linkElement).toBeInTheDocument();&lt;br /&gt;});&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;You'll have noticed that in our new &lt;code&gt;App.tsx&lt;/code&gt; we import two new components (or pages); &lt;code&gt;About&lt;/code&gt; and &lt;code&gt;Home&lt;/code&gt;.  Let's create those.  First &lt;code&gt;About.tsx&lt;/code&gt;:&lt;/p&gt;&lt;pre class="prettyprint"&gt;&lt;code class="language-tsx"&gt;import React from &amp;quot;react&amp;quot;;&lt;br /&gt;&lt;br /&gt;const About: React.FC = () =&amp;gt; (&lt;br /&gt;  &amp;lt;h1&amp;gt;This is a PWA&amp;lt;/h1&amp;gt;&lt;br /&gt;);&lt;br /&gt;&lt;br /&gt;export default About;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Then &lt;code&gt;Home.tsx&lt;/code&gt;:&lt;/p&gt;&lt;pre class="prettyprint"&gt;&lt;code class="language-tsx"&gt;import React from &amp;quot;react&amp;quot;;&lt;br /&gt;&lt;br /&gt;const Home: React.FC = () =&amp;gt; (&lt;br /&gt;  &amp;lt;h1&amp;gt;Welcome to your PWA!&amp;lt;/h1&amp;gt;&lt;br /&gt;);&lt;br /&gt;&lt;br /&gt;export default Home;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h4&gt;Code splitting&lt;/h4&gt;&lt;p&gt;Now we've split up our app into multiple sections, we're going to split the code too.  A good way to improve loading times for PWAs is to ensure that the code is not built into big files.  At the moment our app builds a &lt;code&gt;single-file.js&lt;/code&gt;. If you run &lt;code&gt;yarn build&lt;/code&gt; you'll see what this looks like:&lt;/p&gt;&lt;pre class="prettyprint"&gt;&lt;code&gt;  47.88 KB  build/static/js/2.89bc6648.chunk.js&lt;br /&gt;  784 B     build/static/js/runtime-main.9c116153.js&lt;br /&gt;  555 B     build/static/js/main.bc740179.chunk.js&lt;br /&gt;  269 B     build/static/css/main.5ecd60fb.chunk.css&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Notice the &lt;code&gt;build/static/js/main.bc740179.chunk.js&lt;/code&gt; file.  This is our &lt;code&gt;single-file.js&lt;/code&gt;.  It represents the compiled output of building the TypeScript files that make up our app.  It will grow and grow as our app grows, eventually becoming problematic from a user loading speed perspective.&lt;/p&gt;&lt;p&gt;&lt;code&gt;create-react-app&lt;/code&gt; is built upon webpack.  There is excellent support for code splitting in webpack and hence &lt;a href="https://reactjs.org/docs/code-splitting.html#code-splitting"&gt;create-react-app supports it by default&lt;/a&gt;.  Let's apply it to our app.  Again we're going to change &lt;code&gt;App.tsx&lt;/code&gt;.&lt;/p&gt;&lt;p&gt;Where we previously had:&lt;/p&gt;&lt;pre class="prettyprint"&gt;&lt;code class="language-tsx"&gt;import About from &amp;quot;./About&amp;quot;;&lt;br /&gt;import Home from &amp;quot;./Home&amp;quot;;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Let's replace with:&lt;/p&gt;&lt;pre class="prettyprint"&gt;&lt;code class="language-tsx"&gt;const About = lazy(() =&amp;gt; import('./About'));&lt;br /&gt;const Home = lazy(() =&amp;gt; import('./Home'));&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;This is the syntax to lazily load components in React.  You'll note that it internally uses the &lt;a href="https://github.com/tc39/proposal-dynamic-import"&gt;dynamic &lt;code&gt;import()&lt;/code&gt; syntax&lt;/a&gt; which webpack uses as a &amp;quot;split point&amp;quot;.&lt;/p&gt;&lt;p&gt;Let's also give React something to render whilst it waits for the dynamic imports to be resolved. Just inside our &lt;code&gt;&amp;lt;Router&amp;gt;&lt;/code&gt; component we'll add a &lt;code&gt;&amp;lt;Suspense&amp;gt;&lt;/code&gt; component too:&lt;/p&gt;&lt;pre class="prettyprint"&gt;&lt;code class="language-tsx"&gt;  &amp;lt;Router&amp;gt;&lt;br /&gt;    &amp;lt;Suspense fallback={&amp;lt;div&amp;gt;Loading...&amp;lt;/div&amp;gt;}&amp;gt;&lt;br /&gt;    {/*...*/}&lt;br /&gt;    &amp;lt;/Suspense&amp;gt;&lt;br /&gt;  &amp;lt;/Router&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The &lt;code&gt;&amp;lt;Suspense&amp;gt;&lt;/code&gt; component will render the &lt;code&gt;&amp;lt;div&amp;gt;Loading...&amp;lt;/div&amp;gt;&lt;/code&gt; whilst it waits for a routes code to be dynamically loaded. So our final &lt;code&gt;App.tsx&lt;/code&gt; component ends up looking like this:&lt;/p&gt;&lt;pre class="prettyprint"&gt;&lt;code class="language-tsx"&gt;import React, { lazy, Suspense } from &amp;quot;react&amp;quot;;&lt;br /&gt;import { BrowserRouter as Router, Switch, Route, Link } from &amp;quot;react-router-dom&amp;quot;;&lt;br /&gt;const About = lazy(() =&amp;gt; import(&amp;quot;./About&amp;quot;));&lt;br /&gt;const Home = lazy(() =&amp;gt; import(&amp;quot;./Home&amp;quot;));&lt;br /&gt;&lt;br /&gt;const App: React.FC = () =&amp;gt; (&lt;br /&gt;  &amp;lt;Router&amp;gt;&lt;br /&gt;    &amp;lt;Suspense fallback={&amp;lt;div&amp;gt;Loading...&amp;lt;/div&amp;gt;}&amp;gt;&lt;br /&gt;      &amp;lt;nav&amp;gt;&lt;br /&gt;        &amp;lt;ul&amp;gt;&lt;br /&gt;          &amp;lt;li&amp;gt;&lt;br /&gt;            &amp;lt;Link to=&amp;quot;/&amp;quot;&amp;gt;Home&amp;lt;/Link&amp;gt;&lt;br /&gt;          &amp;lt;/li&amp;gt;&lt;br /&gt;          &amp;lt;li&amp;gt;&lt;br /&gt;            &amp;lt;Link to=&amp;quot;/about&amp;quot;&amp;gt;About&amp;lt;/Link&amp;gt;&lt;br /&gt;          &amp;lt;/li&amp;gt;&lt;br /&gt;        &amp;lt;/ul&amp;gt;&lt;br /&gt;      &amp;lt;/nav&amp;gt;&lt;br /&gt;      &amp;lt;Switch&amp;gt;&lt;br /&gt;        &amp;lt;Route path=&amp;quot;/about&amp;quot;&amp;gt;&lt;br /&gt;          &amp;lt;About /&amp;gt;&lt;br /&gt;        &amp;lt;/Route&amp;gt;&lt;br /&gt;        &amp;lt;Route path=&amp;quot;/&amp;quot;&amp;gt;&lt;br /&gt;          &amp;lt;Home /&amp;gt;&lt;br /&gt;        &amp;lt;/Route&amp;gt;&lt;br /&gt;      &amp;lt;/Switch&amp;gt;&lt;br /&gt;    &amp;lt;/Suspense&amp;gt;&lt;br /&gt;  &amp;lt;/Router&amp;gt;&lt;br /&gt;);&lt;br /&gt;&lt;br /&gt;export default App;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;This is now a code split application.  How can we tell?  If we run &lt;code&gt;yarn build&lt;/code&gt; again we'll see something like this:&lt;/p&gt;&lt;pre class="prettyprint"&gt;&lt;code&gt;  47.88 KB          build/static/js/2.89bc6648.chunk.js&lt;br /&gt;  1.18 KB (+428 B)  build/static/js/runtime-main.415ab5ea.js&lt;br /&gt;  596 B (+41 B)     build/static/js/main.e60948bb.chunk.js&lt;br /&gt;  269 B             build/static/css/main.5ecd60fb.chunk.css&lt;br /&gt;  233 B             build/static/js/4.0c85e1cb.chunk.js&lt;br /&gt;  228 B             build/static/js/3.eed49094.chunk.js&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Note that we now have multiple &lt;code&gt;*.chunk.js&lt;/code&gt; files.  Our initial &lt;code&gt;main.*.chunk.js&lt;/code&gt; and then &lt;code&gt;3.*.chunk.js&lt;/code&gt; representing &lt;code&gt;Home.tsx&lt;/code&gt; and &lt;code&gt;4.*.chunk.js&lt;/code&gt; representing &lt;code&gt;About.tsx&lt;/code&gt;.&lt;/p&gt;&lt;p&gt;As we continue to build out our app from this point we'll have a great approach in place to ensure that users load files as they need to and that those files should not be too large.  Great performance which will scale.&lt;/p&gt;&lt;h4&gt;Deploy your PWA&lt;/h4&gt;&lt;p&gt;Now that we have our basic PWA in place, let's deploy it so the outside world can appreciate it.  We're going to use &lt;a href="https://www.netlify.com/"&gt;Netlify&lt;/a&gt; for this.&lt;/p&gt;&lt;p&gt;The source code of our PWA lives on GitHub here: https://github.com/johnnyreilly/pwa-react-typescript&lt;/p&gt;&lt;p&gt;We're going to log into Netlify, click on the &amp;quot;Create a new site&amp;quot; option and select GitHub as the provider.  We'll need to authorize Netlify to access our GitHub.&lt;/p&gt; &lt;a href="https://raw.githubusercontent.com/johnnyreilly/pwa-react-typescript/master/netlify-auth.png" imageanchor="1" &gt;&lt;img border="0" src="https://raw.githubusercontent.com/johnnyreilly/pwa-react-typescript/master/netlify-auth.png" width="485" height="640" data-original-width="606" data-original-height="800" /&gt;&lt;/a&gt; &lt;p&gt;You may need to click the &amp;quot;Configure Netlify on GitHub&amp;quot; button to grant permissions for Netlify to access your repo like so:&lt;/p&gt; &lt;a href="https://raw.githubusercontent.com/johnnyreilly/pwa-react-typescript/master/netlify-repo-permissions.png" imageanchor="1" &gt;&lt;img border="0" src="https://raw.githubusercontent.com/johnnyreilly/pwa-react-typescript/master/netlify-repo-permissions.png" width="474" height="640" data-original-width="592" data-original-height="800" /&gt;&lt;/a&gt; &lt;p&gt;Then you can select your repo from within Netlify. All of the default settings that Netlify provides should work for our use case:&lt;/p&gt; &lt;a href="https://raw.githubusercontent.com/johnnyreilly/pwa-react-typescript/master/netlify-deploy-settings.png" imageanchor="1" &gt;&lt;img border="0" src="https://raw.githubusercontent.com/johnnyreilly/pwa-react-typescript/master/netlify-deploy-settings.png" width="633" height="640" data-original-width="791" data-original-height="800" /&gt;&lt;/a&gt; &lt;p&gt;Let's hit the magic &amp;quot;Deploy site&amp;quot; button! In a matter of minutes you'll find that Netlify has deployed your PWA.&lt;/p&gt; &lt;a href="https://raw.githubusercontent.com/johnnyreilly/pwa-react-typescript/master/netlify-deployed.png" imageanchor="1" &gt;&lt;img border="0" src="https://raw.githubusercontent.com/johnnyreilly/pwa-react-typescript/master/netlify-deployed.png" width="640" height="214" data-original-width="800" data-original-height="267" /&gt;&lt;/a&gt; &lt;p&gt;If we browse to the URL provided by Netlify we'll be able to see the deployed PWA in action.  (You also have the opportunity to set up a custom domain name that you would typically want outside of a simple demo such as this.) Importantly this will be served over HTTPS which will allow our Service Worker to operate.&lt;/p&gt;&lt;p&gt;Now that we know it's there, let's see how what we've built holds up according to the professionals. We're going to run the Google Chrome Developer Tools Audit against our PWA:&lt;/p&gt; &lt;a href="https://raw.githubusercontent.com/johnnyreilly/pwa-react-typescript/master/pwa-audit.png" imageanchor="1" &gt;&lt;img border="0" src="https://raw.githubusercontent.com/johnnyreilly/pwa-react-typescript/master/pwa-audit.png" width="640" height="126" data-original-width="800" data-original-height="157" /&gt;&lt;/a&gt; &lt;p&gt;That is a good start for our PWA!&lt;/p&gt;&lt;p&gt;&lt;a href="https://blog.logrocket.com/from-create-react-app-to-pwa/"&gt;This post was originally published on LogRocket.&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a href="https://github.com/johnnyreilly/pwa-react-typescript"&gt;The source code for this project can be found here.&lt;/a&gt;&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/6339225671719497538'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/6339225671719497538'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2020/01/from-create-react-app-to-pwa.html' title='From &lt;code&gt;create-react-app&lt;/code&gt; to PWA'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8422914133064101635</id><published>2020-01-21T19:29:00.000Z</published><updated>2020-01-26T18:13:03.206Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>LICENSE to kill your PWA</title><content type='html'>&lt;h4&gt;Update: 26/01/2020 - LICENSE to kill revoked!&lt;/h4&gt; &lt;p&gt;Following the original publication of this post I received this tweet suggesting we should change the behaviour of the underlying &lt;code&gt;terser-webpack-plugin&lt;/code&gt;:&lt;/p&gt; &lt;blockquote class="twitter-tweet"&gt;&lt;p lang="en" dir="ltr"&gt;Send a PR to change the name to .LICENSE.txt by default.&lt;/p&gt;&amp;mdash; Tobias Koppers (@wSokra) &lt;a href="https://twitter.com/wSokra/status/1220069497660411904?ref_src=twsrc%5Etfw"&gt;January 22, 2020&lt;/a&gt;&lt;/blockquote&gt; &lt;script async src="https://platform.twitter.com/widgets.js" charset="utf-8"&gt;&lt;/script&gt; &lt;p&gt;That seemed like an excellent idea! I raised &lt;a href="https://github.com/webpack-contrib/terser-webpack-plugin/pull/210"&gt;this PR&lt;/a&gt; which changes the behaviour such that instead of &lt;code&gt;.LICENSE&lt;/code&gt; files being produced, &lt;code&gt;.LICENSE.txt&lt;/code&gt; files are pumped out instead.  Crucially they are IIS (and other servers) friendly.  The great news is that future users of webpack / create-react-app etc will not face this problem at all; result!&lt;/p&gt; &lt;h4&gt;The tragedy&lt;/h4&gt; &lt;p&gt;Recently my beloved PWA died.  I didn't realise it at first.  It wasn't until a week or so after the tragedy that I realised he'd gone.  In his place was the stale memory of service workers gone by.  Last week's code; cached and repeatedly served up to a disappointed audience. Terrible news.&lt;/p&gt; &lt;p&gt;What had happened?  What indeed.  The problem was quirky and (now that I know the answer) I'm going to share it with you. Because it's entirely non-obvious.&lt;/p&gt; &lt;h4&gt;The mystery&lt;/h4&gt; &lt;p&gt;Once I realised that I was repeatedly being served up an old version of my PWA, I got to wondering.... Why?  What's happening?  What's wrong?  What did I do?  I felt bad.  I stared at the ceiling.  I sighed and opened my Chrome devtools.  With no small amount of sadness I went to the &lt;code&gt;Application&lt;/code&gt; tab, hit &lt;code&gt;Service Workers&lt;/code&gt; and then &lt;code&gt;Unregister&lt;/code&gt;.&lt;/p&gt; &lt;p&gt;Then I hit refresh and took a look at console.  I saw this:&lt;/p&gt; &lt;a href="https://4.bp.blogspot.com/-nWKzYl8ffN8/XidQp44KPdI/AAAAAAAATSc/XsYpCMXSUk4CqcP82JKd1PGBmVYJp3YTACPcBGAYYCw/s1600/LICENSE%2Bcannot%2Bbe%2Bcached.png" imageanchor="1" &gt;&lt;img border="0" src="https://4.bp.blogspot.com/-nWKzYl8ffN8/XidQp44KPdI/AAAAAAAATSc/XsYpCMXSUk4CqcP82JKd1PGBmVYJp3YTACPcBGAYYCw/s640/LICENSE%2Bcannot%2Bbe%2Bcached.png" width="640" height="32" data-original-width="1600" data-original-height="81" /&gt;&lt;/a&gt; &lt;p&gt;What does this mean?  Something about a &amp;quot;bad-precaching-response&amp;quot;.  And apparently this was happening whilst trying to load this resource: &lt;code&gt;/static/js/6.20102e99.chunk.js.LICENSE?__WB_REVISION__=e2fc36&lt;/code&gt;&lt;/p&gt; &lt;p&gt;This &lt;code&gt;404&lt;/code&gt; was preventing pre-caching from executing successfully.  This was what was killing my PWA.  This was the perpetrator.  How to fix this?  Read on!&lt;/p&gt; &lt;h4&gt;The investigation&lt;/h4&gt; &lt;p&gt;Time to find out what's going on. I dropped that URL into my browser to see what would happen.  &lt;code&gt;404&lt;/code&gt; city man:&lt;/p&gt; &lt;a href="https://3.bp.blogspot.com/-B-49bVwTF5o/XidQ4jSUaEI/AAAAAAAATSg/X53fRFl8meE0oDD09L7PdeB0PgUmnh12QCLcBGAsYHQ/s1600/LICENSE%2Bfile%2Bscrewing%2Bme%2Bover.png" imageanchor="1" &gt;&lt;img border="0" src="https://3.bp.blogspot.com/-B-49bVwTF5o/XidQ4jSUaEI/AAAAAAAATSg/X53fRFl8meE0oDD09L7PdeB0PgUmnh12QCLcBGAsYHQ/s400/LICENSE%2Bfile%2Bscrewing%2Bme%2Bover.png" width="400" height="233" data-original-width="939" data-original-height="547" /&gt;&lt;/a&gt;  &lt;p&gt;So, to disk.  I took a look at what was actually on the server in that location.  Sure enough, the file existed.  When I opened it up I found this:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;code class="language-js"&gt;/**&lt;br /&gt;* A better abstraction over CSS.&lt;br /&gt;*&lt;br /&gt;* @copyright Oleg Isonen (Slobodskoi) / Isonen 2014-present&lt;br /&gt;* @website https://github.com/cssinjs/jss&lt;br /&gt;* @license MIT&lt;br /&gt;*/&lt;br /&gt; &lt;br /&gt;/*&lt;br /&gt;object-assign&lt;br /&gt;(c) Sindre Sorhus&lt;br /&gt;@license MIT&lt;br /&gt;*/&lt;br /&gt; &lt;br /&gt;/** @license React v16.12.0&lt;br /&gt;* react.production.min.js&lt;br /&gt;*&lt;br /&gt;* Copyright (c) Facebook, Inc. and its affiliates.&lt;br /&gt;*&lt;br /&gt;* This source code is licensed under the MIT license found in the&lt;br /&gt;* LICENSE file in the root directory of this source tree.&lt;br /&gt;*/&lt;br /&gt; &lt;br /&gt;/** @license React v16.12.0&lt;br /&gt;* react-dom.production.min.js&lt;br /&gt;*&lt;br /&gt;* Copyright (c) Facebook, Inc. and its affiliates.&lt;br /&gt;*&lt;br /&gt;* This source code is licensed under the MIT license found in the&lt;br /&gt;* LICENSE file in the root directory of this source tree.&lt;br /&gt;*/&lt;br /&gt; &lt;br /&gt;/** @license React v0.18.0&lt;br /&gt;* scheduler.production.min.js&lt;br /&gt;*&lt;br /&gt;* Copyright (c) Facebook, Inc. and its affiliates.&lt;br /&gt;*&lt;br /&gt;* This source code is licensed under the MIT license found in the&lt;br /&gt;* LICENSE file in the root directory of this source tree.&lt;br /&gt;*/&lt;br /&gt; &lt;br /&gt;/** @license React v16.12.0&lt;br /&gt;* react-is.production.min.js&lt;br /&gt;*&lt;br /&gt;* Copyright (c) Facebook, Inc. and its affiliates.&lt;br /&gt;*&lt;br /&gt;* This source code is licensed under the MIT license found in the&lt;br /&gt;* LICENSE file in the root directory of this source tree.&lt;br /&gt;*/&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt; &lt;p&gt;What is this?  Well, as the name of the file suggests, it's licenses.  For some reason, my build was scraping the licenses from the head of some of my files and placing them in a separate &lt;code&gt;6.20102e99.chunk.js.LICENSE&lt;/code&gt; file.  Doing some more digging I happened upon &lt;a href="https://github.com/facebook/create-react-app/issues/6441"&gt;this discussion against the &lt;code&gt;create-react-app&lt;/code&gt;&lt;/a&gt; project.  It's worth saying, that my PWA was an ejected &lt;code&gt;create-react-app&lt;/code&gt; project.&lt;/p&gt; &lt;p&gt;It turned out the the issue was related to the &lt;a href="https://github.com/webpack-contrib/terser-webpack-plugin"&gt;&lt;code&gt;terser-webpack-plugin&lt;/code&gt;&lt;/a&gt;. The default behaviour performs this kind of license file extraction.  The app was being served by an IIS server and it wasn't configured to support the &lt;code&gt;.LICENSE&lt;/code&gt; file type.&lt;/p&gt; &lt;h4&gt;The resolution&lt;/h4&gt; &lt;p&gt;The simplest solution was simply this: wave goodbye to &lt;code&gt;LICENSE&lt;/code&gt; files.  If you haven't ejected from your &lt;code&gt;create-react-app&lt;/code&gt; then this might be a problem.  But since I had, I was able to make this tweak to the terser settings in the &lt;code&gt;webpack.config.js&lt;/code&gt;:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;code class="language-js"&gt;new TerserPlugin({&lt;br /&gt;    /* TURN OFF LICENSE FILES - SEE https://github.com/facebook/create-react-app/issues/6441 */&lt;br /&gt;    extractComments: false,&lt;br /&gt;    /* TURN OFF LICENSE FILES - Tweak by John Reilly */&lt;br /&gt;    terserOptions: {&lt;br /&gt;        // ....           &lt;br /&gt;&lt;/code&gt;&lt;/pre&gt; &lt;p&gt;And with this we say goodbye to our &lt;code&gt;404&lt;/code&gt;s and hello to a resurrected PWA!&lt;/p&gt; </content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8422914133064101635'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8422914133064101635'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2020/01/license-to-kill-your-pwa.html' title='LICENSE to kill your PWA'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='https://4.bp.blogspot.com/-nWKzYl8ffN8/XidQp44KPdI/AAAAAAAATSc/XsYpCMXSUk4CqcP82JKd1PGBmVYJp3YTACPcBGAYYCw/s72-c/LICENSE%2Bcannot%2Bbe%2Bcached.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6336456761787908172</id><published>2020-01-02T07:12:00.001Z</published><updated>2020-01-02T07:20:23.695Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>EF Core 3.1 breaks left join with no navigation property</title><content type='html'>&lt;p&gt;Just recently my team took on the challenge of upgrading our codebase from .NET Core 2.2 to .NET Core 3.1.  Along the way we encountered a quirky issue which caused us much befuddlement.  Should you be befuddled too, then maybe this can help you.&lt;/p&gt; &lt;p&gt;Whilst running our app, we started encountering an error with an Entity Framework Query that looked like this:&lt;/p&gt; &lt;pre class="prettyprint"&gt;&lt;code&gt;var stuffWeCareAbout = await context.Things&lt;br /&gt;    .Include(thing =&amp;gt; thing.ThisIsFine)&lt;br /&gt;    .Include(thing =&amp;gt; thing.Problematic)&lt;br /&gt;    .Where(thing =&amp;gt; thing.CreatedOn &amp;gt; startFromThisTime &amp;amp;&amp;amp; thing.CreatedOn &amp;lt; endAtThisTime)&lt;br /&gt;    .OrderByDescending(thing =&amp;gt; thing.CreatedOn)&lt;br /&gt;    .ToArrayAsync();&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt; &lt;h4&gt;Join me!&lt;/h4&gt; &lt;p&gt;As EF Core tried to join from the &lt;code&gt;Things&lt;/code&gt; table to the &lt;code&gt;Problematic&lt;/code&gt; table (some obfuscation in table names here), that which worked in .NET Core 2.2 was &lt;em&gt;not&lt;/em&gt; working in .NET Core 3.1.  Digging into the issue, we discovered EF Core was generating an invalid &lt;code&gt;LEFT JOIN&lt;/code&gt;:&lt;/p&gt; &lt;pre class="prettyprint"&gt;&lt;code&gt;fail: Microsoft.EntityFrameworkCore.Database.Command[20102]&lt;br /&gt;      Failed executing DbCommand (18ms) [Parameters=[@__startFromThisTime_0='?' (DbType = DateTime2), @__endAtThisTime_1='?' (DbType = DateTime2)], CommandType='Text', CommandTimeout='30']&lt;br /&gt;      SELECT [o].[ThingId], [o].[AnonymousId], [o].[CreatedOn],  [o].[Status], [o].[UpdatedOn], [o0].[Id], [o0].[ThingId], [o0].[Name], [o1].[ThingId], [o1].[Status], [o1].[CreatedOn], [o1].[ThingThingId], [o1].[SentOn]&lt;br /&gt;      FROM [Things] AS [o]&lt;br /&gt;      LEFT JOIN [ThisIsFines] AS [o0] ON [o].[ThingId] = [o0].[ThingId]&lt;br /&gt;      LEFT JOIN [Problematic] AS [o1] ON [o].[ThingId] = [o1].[ThingThingId]&lt;br /&gt;      WHERE ([o].[CreatedOn] @__startFromThisTime_0) AND ([o].[CreatedOn] &amp;lt; @__endAtThisTime_1)&lt;br /&gt;      ORDER BY [o].[CreatedOn] DESC, [o].[ThingId], [o1].[ThingId], [o1].[Status]&lt;br /&gt;Microsoft.EntityFrameworkCore.Database.Command: Error: Failed executing DbCommand (18ms) [Parameters=[@__startFromThisTime_0='?' (DbType = DateTime2), @__endAtThisTime_1='?' (DbType = DateTime2)], CommandType='Text', CommandTimeout='30']&lt;br /&gt;SELECT [o].[ThingId], [o].[AnonymousId], [o].[CreatedOn], [o].[Status], [o].[UpdatedOn], [o0].[Id], [o0].[ThingId], [o0].[Name], [o1].[ThingId], [o1].[Status], [o1].[CreatedOn], [o1].[ThingThingId], [o1].[SentOn]&lt;br /&gt;FROM [Things] AS [o]&lt;br /&gt;LEFT JOIN [ThisIsFines] AS [o0] ON [o].[ThingId] = [o0].[ThingId]&lt;br /&gt;LEFT JOIN [Problematic] AS [o1] ON [o].[ThingId] = [o1].[ThingThingId]&lt;br /&gt;WHERE ([o].[CreatedOn] @__startFromThisTime_0) AND ([o].[CreatedOn] &amp;lt; @__endAtThisTime_1)&lt;br /&gt;ORDER BY [o].[CreatedOn] DESC, [o].[ThingId], [o1].[ThingId], [o1].[Status]&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt; &lt;p&gt;Do you see it? Probably not; it took us a while too... The issue lay here:&lt;/p&gt; &lt;pre class="prettyprint"&gt;&lt;code&gt;LEFT JOIN [Problematic] AS [o1] ON [o].[ThingId] = [o1].[ThingThingId]&lt;br /&gt;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt; &lt;p&gt;This should actually have been:&lt;/p&gt; &lt;pre class="prettyprint"&gt;&lt;code&gt;LEFT JOIN [Problematic] AS [o1] ON [o].[ThingId] = [o1].[ThingId]&lt;br /&gt;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt; &lt;p&gt;For some reason EF Core was looking for &lt;code&gt;ThingThingId&lt;/code&gt; where it should have looked for &lt;code&gt;ThingId&lt;/code&gt;. But why?&lt;/p&gt; &lt;h4&gt;Navigation properties to the rescue!&lt;/h4&gt; &lt;p&gt;This was the &lt;code&gt;Problematic&lt;/code&gt; class:&lt;/p&gt; &lt;pre class="prettyprint"&gt;&lt;code class="language-cs"&gt;using System;&lt;br /&gt;using System.ComponentModel.DataAnnotations;&lt;br /&gt;using System.ComponentModel.DataAnnotations.Schema;&lt;br /&gt;&lt;br /&gt;namespace Treasury.Data.Entities&lt;br /&gt;{&lt;br /&gt;    public class Problematic&lt;br /&gt;    {&lt;br /&gt;        [ForeignKey(&amp;quot;Thing&amp;quot;)]&lt;br /&gt;        [Required]&lt;br /&gt;        public Guid ThingId { get; set; }&lt;br /&gt;        [Required]&lt;br /&gt;        public DateTime CreatedOn { get; set; }&lt;br /&gt;        public DateTime SentOn { get; set; }&lt;br /&gt;    }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt; &lt;p&gt;If you look closely you'll see it has a &lt;code&gt;ForeignKey&lt;/code&gt; but &lt;em&gt;no&lt;/em&gt; accompanying Navigation property.  So let's add one:&lt;/p&gt; &lt;pre class="prettyprint"&gt;&lt;code class="language-cs"&gt;using System;&lt;br /&gt;using System.ComponentModel.DataAnnotations;&lt;br /&gt;using System.ComponentModel.DataAnnotations.Schema;&lt;br /&gt;&lt;br /&gt;namespace Our.App&lt;br /&gt;{&lt;br /&gt;    public class Problematic&lt;br /&gt;    {&lt;br /&gt;        [ForeignKey(&amp;quot;Thing&amp;quot;)]&lt;br /&gt;        [Required]&lt;br /&gt;        public Guid ThingId { get; set; }&lt;br /&gt;        [Required]&lt;br /&gt;        public DateTime CreatedOn { get; set; }&lt;br /&gt;        public DateTime SentOn { get; set; }&lt;br /&gt;&lt;br /&gt;        /* THIS NAVIGATION PROPERTY IS WHAT WE NEEDED!!! */&lt;br /&gt;        public virtual Thing Thing { get; set; }&lt;br /&gt;    }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt; &lt;p&gt;With this in place our app starts generating the SQL we need.&lt;/p&gt; </content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/6336456761787908172'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/6336456761787908172'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2020/01/ef-core-31-breaks-left-join-with-no-navigation-property.html' title='EF Core 3.1 breaks left join with no navigation property'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2595012404641338273</id><published>2019-12-18T13:47:00.000Z</published><updated>2019-12-18T13:48:16.717Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Notifications'/><category scheme='http://www.blogger.com/atom/ns#' term='Microsoft Teams'/><title type='text'>Automating Teams Notifications</title><content type='html'>&lt;p&gt;Recently, my team transitioned from using Slack to using Microsoft Teams.  It's fair to say that the team had a lot of love for Slack. Teams is a poorer product from the perspective of UI / UX.  Maybe as you read this in the future that's all changed.  But here on December 18th 2019, Teams is a solid 2 stars out of 5.&lt;/p&gt; &lt;p&gt;However, we are where we are, and the purpose of this post is not to complain. Because our team is now effectively using Microsoft Teams.  And one of the things that's helped us make the move is automating various Teams notifications in a similar fashion to how we used to with Slack.&lt;/p&gt; &lt;p&gt;This post will explain the following:&lt;/p&gt; &lt;ol&gt; &lt;li&gt;How you can automate the sending of notifications using Teams.&lt;/li&gt; &lt;li&gt;How Teams supports MarkDown in notifications.&lt;/li&gt; &lt;li&gt;How you can use ASP.Net Core to automate sending notifications.&lt;/li&gt; &lt;/ol&gt; &lt;h4&gt;Notifications via Webhooks&lt;/h4&gt; &lt;p&gt;Now, it's not obvious from Teams that there is a simple webhooks integration for Teams, but there is.  It's tucked away under &amp;quot;Connectors&amp;quot;.  If you want to create a webhook of your own, find your team, your channel, click on the menu, then connectors and create a hook.  Like so:&lt;/p&gt; &lt;a href="https://1.bp.blogspot.com/-vDUdt6EdpT4/XfotTYgHzfI/AAAAAAAASxc/YqMWUwUYp_wzIp_-abs1tKXvjwc_lOzZQCLcBGAsYHQ/s1600/teams-notification.gif" imageanchor="1" &gt;&lt;img border="0" src="https://1.bp.blogspot.com/-vDUdt6EdpT4/XfotTYgHzfI/AAAAAAAASxc/YqMWUwUYp_wzIp_-abs1tKXvjwc_lOzZQCLcBGAsYHQ/s1600/teams-notification.gif" data-original-width="791" data-original-height="569" /&gt;&lt;/a&gt; &lt;p&gt;With the URL you've just obtained, you are now free to send notifications to that channel via a simple &lt;code&gt;curl&lt;/code&gt;:&lt;/p&gt; &lt;pre class="prettyprint shell"&gt;&lt;code class="language-shell"&gt;curl -H &amp;quot;Content-Type: application/json&amp;quot; -d &amp;quot;{\&amp;quot;text\&amp;quot;: \&amp;quot;Hello World\&amp;quot;}&amp;quot; https://outlook.office.com/webhook/big-long-guid1/IncomingWebhook/big-long-guid2&lt;br /&gt;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt; &lt;h4&gt;MarkDown&lt;/h4&gt; &lt;p&gt;Let's see if we can make this more interesting.  It turns out that the the webhook can receive JSON as the body of the payload.  And there's 3 properties we'd like our JSON to contain:&lt;/p&gt; &lt;ol&gt; &lt;li&gt;&lt;code&gt;title&lt;/code&gt; - this is optional and is the title of your notification if supplied.&lt;/li&gt; &lt;li&gt;&lt;code&gt;textFormat&lt;/code&gt; - provide the value &lt;code&gt;&amp;quot;markdown&amp;quot;&lt;/code&gt; and then...&lt;/li&gt; &lt;li&gt;&lt;code&gt;text&lt;/code&gt; - provide your markdown notification content!&lt;/li&gt; &lt;/ol&gt; &lt;p&gt;So if we have a notification payload file called &lt;code&gt;down.json&lt;/code&gt;:&lt;/p&gt; &lt;pre class="prettyprint json"&gt;&lt;code class="language-JSON"&gt;{&lt;br /&gt;    &amp;quot;title&amp;quot;: &amp;quot;Your Notification Title&amp;quot;,&lt;br /&gt;    &amp;quot;textFormat&amp;quot;: &amp;quot;markdown&amp;quot;,&lt;br /&gt;    &amp;quot;text&amp;quot;: &amp;quot;*Wow*\nThis is [markdown](https://en.wikipedia.org/wiki/Markdown)!\n![do a little dance!](https://media.giphy.com/media/YJ5OlVLZ2QNl6/giphy.gif)\n**Huzzah**!&amp;quot;&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt; &lt;p&gt;We can trigger it with this &lt;code&gt;curl&lt;/code&gt;:&lt;/p&gt; &lt;pre class="prettyprint shell"&gt;&lt;code class="language-shell"&gt;curl -H &amp;quot;Content-Type: application/json&amp;quot; -d @down.json https://outlook.office.com/webhook/big-long-guid1/IncomingWebhook/big-long-guid2&lt;br /&gt;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt; &lt;p&gt;As you can see from the example above, you can use all the qualities of MarkDown that you know and love.  Text, bold text, italics, links and even images too.  It's &lt;em&gt;great&lt;/em&gt;!&lt;/p&gt; &lt;a href="https://2.bp.blogspot.com/-_6XeGIucQ5Y/Xfos-w5_EZI/AAAAAAAASxU/fz_O5yT6T4Qp-_B_0TGesBviP1-3ftxswCLcBGAsYHQ/s1600/teams-notification-2.gif" imageanchor="1" &gt;&lt;img border="0" src="https://2.bp.blogspot.com/-_6XeGIucQ5Y/Xfos-w5_EZI/AAAAAAAASxU/fz_O5yT6T4Qp-_B_0TGesBviP1-3ftxswCLcBGAsYHQ/s1600/teams-notification-2.gif" data-original-width="721" data-original-height="526" /&gt;&lt;/a&gt; &lt;h4&gt;ASP.Net Core&lt;/h4&gt; &lt;p&gt;Finally, I wanted to illustrate just how simple the WebHooks API makes plugging notifications into an existing app.  In our case we're going to use ASP.Net Core, but really there's nothing particular about how we're going to do this.&lt;/p&gt; &lt;p&gt;Here's a class called &lt;code&gt;TeamsNotificationService&lt;/code&gt;.  It exposes 2 methods:&lt;/p&gt; &lt;ul&gt; &lt;li&gt;&lt;code&gt;SendNotification&lt;/code&gt; which allows the consumer to just provide a &lt;code&gt;title&lt;/code&gt; and a &lt;code&gt;message&lt;/code&gt; - you could consume this from anywhere in your app and use it to publish the notification of your choice.&lt;/li&gt; &lt;li&gt;&lt;code&gt;SendExcitingNotification&lt;/code&gt; which actually uses &lt;code&gt;SendNotification&lt;/code&gt; and illustrates how you might provide an exciting notification to publish out.&lt;/li&gt; &lt;/ul&gt; &lt;pre class="prettyprint cs"&gt;&lt;code class="language-cs"&gt;using System;&lt;br /&gt;using System.Collections.Generic;&lt;br /&gt;using System.Net.Http;&lt;br /&gt;using System.Net.Http.Headers;&lt;br /&gt;using System.Threading.Tasks;&lt;br /&gt;&lt;br /&gt;namespace My.Services {&lt;br /&gt;    public interface ITeamsNotificationService {&lt;br /&gt;        Task SendNotification(string title, string message);&lt;br /&gt;        Task SendExcitingNotification(Guid someAppId, string person);&lt;br /&gt;    }&lt;br /&gt;&lt;br /&gt;    public class TeamsNotificationService : ITeamsNotificationService {&lt;br /&gt;&lt;br /&gt;        // in Startup.ConfigureServices you're going to want to add this line:&lt;br /&gt;        // services.AddHttpClient(TeamsNotificationService.TEAMS_NOTIFIER_CLIENT);&lt;br /&gt;&lt;br /&gt;        public const string TEAMS_NOTIFIER_CLIENT = &amp;quot;TEAMS_NOTIFIER_CLIENT&amp;quot;;&lt;br /&gt;&lt;br /&gt;        private readonly ILogger&amp;lt;TeamsNotificationService&amp;gt; logger;&lt;br /&gt;        private readonly IHttpClientFactory _clientFactory;&lt;br /&gt;&lt;br /&gt; &lt;br /&gt;        public TeamsNotificationService(&lt;br /&gt;            ILogger&amp;lt;TeamsNotificationService&amp;gt; logger,&lt;br /&gt;            IHttpClientFactory clientFactory&lt;br /&gt;        ) {&lt;br /&gt;            _logger = logger;&lt;br /&gt;            _clientFactory = clientFactory;&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        private HttpClient CreateClient() {&lt;br /&gt;            var client = _clientFactory.CreateClient(TEAMS_NOTIFIER);&lt;br /&gt;&lt;br /&gt;            client.DefaultRequestHeaders.Clear();&lt;br /&gt;            client.DefaultRequestHeaders.Accept.Clear();&lt;br /&gt;            client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue(&amp;quot;application/json&amp;quot;));&lt;br /&gt;&lt;br /&gt;            return client;&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        public async Task SendNotification(string title, string message) {&lt;br /&gt;            try {&lt;br /&gt;                var client = CreateClient();&lt;br /&gt; &lt;br /&gt;                var messageContents = string.IsNullOrEmpty(title)&lt;br /&gt;                    ? new JsonContent(new { text = message, textFormat = &amp;quot;markdown&amp;quot; })&lt;br /&gt;                    : new JsonContent(new { title = title, text = message, textFormat = &amp;quot;markdown&amp;quot; });&lt;br /&gt;&lt;br /&gt;                var webhookUrl = &amp;quot;https://outlook.office.com/webhook/big-long-guid1/IncomingWebhook/big-long-guid2&amp;quot;;&lt;br /&gt;                var response = await client.PostAsync(webhookUrl, messageContents);&lt;br /&gt;&lt;br /&gt;                _logger.LogInformation(&amp;quot;Sent {title} notification to Teams using {url}; received this response: {responseStatusCode}&amp;quot;, title, url, response.StatusCode);&lt;br /&gt;            }&lt;br /&gt;            catch (Exception exc) {&lt;br /&gt;                _logger.LogError(exc, $&amp;quot;Failed to send {title} notification to Teams&amp;quot;);&lt;br /&gt;            }&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        public async Task SendExcitingNotification(Guid someAppId, string person) {&lt;br /&gt;            var celebration = GetCelebration();&lt;br /&gt;            await SendNotification(&lt;br /&gt;                title: &amp;quot;Incredible Thing Alert!&amp;quot;,&lt;br /&gt;                message: $@&amp;quot;**{person}** has done something incredible! &amp;amp;#x1F44B;&lt;br /&gt;&lt;br /&gt;![celebration time!]({celebration})&lt;br /&gt;&lt;br /&gt;[Go see for yourself](https://my.app/some-page/{someAppId})&amp;quot;&lt;br /&gt;            );&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        string GetCelebration() =&amp;gt; GetRandomItem(_celebrations);&lt;br /&gt;        string GetRandomItem(string[] arrayOfStrings) =&amp;gt; arrayOfStrings[new Random().Next(0, arrayOfStrings.Length)];&lt;br /&gt;&lt;br /&gt;        string[] _celebrations = new string[] {&lt;br /&gt;            &amp;quot;https://media.giphy.com/media/KYElw07kzDspaBOwf9/giphy.gif&amp;quot;,&lt;br /&gt;            &amp;quot;https://media.giphy.com/media/GStLeae4F7VIs/giphy.gif&amp;quot;,&lt;br /&gt;            &amp;quot;https://media.giphy.com/media/NbXTwsoD7hvag/giphy.gif&amp;quot;,&lt;br /&gt;            &amp;quot;https://media.giphy.com/media/d86kftzaeizO8/giphy.gif&amp;quot;,&lt;br /&gt;            &amp;quot;https://media.giphy.com/media/YJ5OlVLZ2QNl6/giphy.gif&amp;quot;,&lt;br /&gt;            &amp;quot;https://media.giphy.com/media/kyLYXonQYYfwYDIeZl/giphy.gif&amp;quot;,&lt;br /&gt;            &amp;quot;https://media.giphy.com/media/KYElw07kzDspaBOwf9/giphy.gif&amp;quot;,&lt;br /&gt;            &amp;quot;https://media.giphy.com/media/6nuiJjOOQBBn2/giphy.gif&amp;quot;,&lt;br /&gt;            &amp;quot;https://media.giphy.com/media/hZj44bR9FVI3K/giphy.gif&amp;quot;,&lt;br /&gt;            &amp;quot;https://media.giphy.com/media/31lPv5L3aIvTi/giphy.gif&amp;quot;&lt;br /&gt;        };&lt;br /&gt;    }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt; &lt;p&gt;It's as simple as that :-)&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2595012404641338273'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2595012404641338273'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2019/12/automating-teams-notifications-recently.html' title='Automating Teams Notifications'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='https://1.bp.blogspot.com/-vDUdt6EdpT4/XfotTYgHzfI/AAAAAAAASxc/YqMWUwUYp_wzIp_-abs1tKXvjwc_lOzZQCLcBGAsYHQ/s72-c/teams-notification.gif' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2759212838967993268</id><published>2019-10-08T06:10:00.000+01:00</published><updated>2019-10-08T20:56:50.236+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='TypeScript'/><category scheme='http://www.blogger.com/atom/ns#' term='Definitely Typed'/><title type='text'>Definitely Typed: The Movie</title><content type='html'>&lt;p&gt;I'd like to tell you a story. It's the tale of the ecosystem that grew up around a language: TypeScript. TypeScript is, for want of a better description, JavaScript after a trip to Saville Row. Essentially the same language, but a little more together, a little less wild west. JS with a decent haircut and a new suit. These days, the world seems to be written in TypeScript. And when you pause to consider just how young the language is, well, that's kind of amazing.&lt;/p&gt;&lt;p&gt;Who could have predicted it would end up like this? When I was a boy I remember coming down the stairs in my childhood home. Shuffling to the edge of each step on my bottom before thumping down to the one beneath. When I look at those same stairs now they're so small. I barely notice the difference between one step and the next. But back then each step seemed giant, each one so far apart. Definitely Typed had any number of steps in its evolution. They all seemed so significant then; whereas now they're just a memory. Let's remember together&lt;/p&gt;&lt;h4&gt;Prolog(ue)&lt;/h4&gt;&lt;p&gt;When it was first unveiled to the world by Anders Hejlsberg back in 2012, there was nothing to suggest TypeScript was going to be seismic in its effects. The language brought two important things to the table. First of all, the ability to write JavaScript with optional static typing (imagine this as &amp;quot;belts and braces&amp;quot; for JS).  The second feature was interoperability with existing JavaScript.&lt;/p&gt;&lt;p&gt;The reason TypeScript has the traction that it does, is a consequence of the latter feature. The JavaScript ecosystem was already a roaring success by 2012. Many useful libraries were out there, authored in vanilla JavaScript. jQuery, Backbone, Knockout were all going concerns. People were building things.&lt;/p&gt;&lt;p&gt;Wisely, having TypeScript able to work with existing JavaScript libraries was a goal of the language right from the off. This made sense; otherwise it would have been like unveiling Netflix to the world whilst saying &amp;quot;sorry you can't use a television set to watch this&amp;quot;. Remember, JS was great as is - people wanted static typing so they could be more productive and so they could sleep better at night. (&amp;quot;Oh wait, did I write that unit test to check all the properties? Dammit, it's 3am!&amp;quot;) If TypeScript had hove onto the scene requiring that everything was written &lt;em&gt;in&lt;/em&gt; TypeScript then I would not be writing this. It didn't.&lt;/p&gt;&lt;p&gt;Interoperability was made possible by the concept of &amp;quot;type definitions&amp;quot;. Analogous to header files in C, these are TypeScript files with a &lt;code&gt;.d.ts&lt;/code&gt; suffix that tell the compiler about an existing JavaScript library which is in scope. This means you can write TypeScript and use jQuery or [insert your favourite library name here].  Even though they are not written in TypeScript.&lt;/p&gt;&lt;p&gt;At the time of the initial TypeScript announcement (v0.8.1) there was no concept of a repository of type definitions. I mean, there was every chance that TypeScript wasn't going to be a big deal. Success wasn't guaranteed. But it happened. You're reading this in a world where Definitely Typed is one of the most popular repos on GitHub and where type definitions from it are published out to npm for consumption by developers greedy for static types. A world where the TypeScript team has pretty much achieved its goal of &amp;quot;types on every desk&amp;quot;.&lt;/p&gt;&lt;p&gt;I want to tell you the story of the history of type definitions in the TypeScript world. I'm pretty well placed to do this since I've been involved since the early days. Others involved have been kind enough to give me their time and tell me their stories. There's likely to be errors and omissions, and that's on me. It's an amazing tale though; I'm fortunate to get to tell it.&lt;/p&gt;&lt;h4&gt;The First Type Definition&lt;/h4&gt;&lt;p&gt;I was hanging out for something like TypeScript. I'd been busily developing rich client applications in JS and, whilst I loved the language, I was dearly missing static typing. All the things broke all of the time and I wanted help. I wanted a compiler to take me by the hand and say &amp;quot;hey John, you just did a silly thing. Don't do it John; you'll only be filled with regret...&amp;quot;. The TypeScript team wrote that compiler.&lt;/p&gt;&lt;p&gt;When TypeScript was announced, it was important that the world could see that interop with JS was a first class citizen.  Accordingly, a jQuery type definition was demonstrated as well. At the time, jQuery was the number one JavaScript library downloaded on the internet. So naturally it was the obvious choice for a demo. The type definition was fairly rough and ready but it worked. &lt;a href="https://channel9.msdn.com/posts/Anders-Hejlsberg-Introducing-TypeScript"&gt;You can see Anders Hejlsberg showing off the jQuery definition 45 minutes into this presentation introducing TypeScript.&lt;/a&gt;&lt;/p&gt;&lt;p&gt;Consumption was straightforward, if perhaps quirky. You took the &lt;code&gt;jquery.d.ts&lt;/code&gt; file, copied it into your project location. Back then, to let the compiler know that a JS library had come to the party you had to use a kind of comment pragma in the header of your TypeScript files. For example: &lt;code&gt;/// &amp;lt;reference path=&amp;quot;jquery/jquery.d.ts&amp;quot; /&amp;gt;&lt;/code&gt;. This let TypeScript know that the type definition living at that path was relevant for the current script and it should scope it in.&lt;/p&gt;&lt;p&gt;There was no discussion of how do we type the world?  Even if they wanted to, the TypeScript team didn't really have the resources at that point to support this. They'd got as far as they had on the person power of four or five developers and some testers as well. There was a problem clearly waiting to be solved.  As luck would have it, in Bulgaria a man named Boris Yankov had been watching the TypeScript announcement.&lt;/p&gt; &lt;h4&gt;Boris Yankov&lt;/h4&gt; &lt;div class="separator" style="clear: both; text-align: center;"&gt;&lt;a href="https://3.bp.blogspot.com/-1xKIJvyRWWc/XZuLcK5E51I/AAAAAAAAR7M/jGCcWm1_mEAQmDUMhqGK0WOiZSg_ZFfhQCPcBGAYYCw/s1600/boris_yankov.jpeg" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"&gt;&lt;img border="0" src="https://3.bp.blogspot.com/-1xKIJvyRWWc/XZuLcK5E51I/AAAAAAAAR7M/jGCcWm1_mEAQmDUMhqGK0WOiZSg_ZFfhQCPcBGAYYCw/s320/boris_yankov.jpeg" width="320" height="320" data-original-width="400" data-original-height="400" /&gt;&lt;/a&gt;&lt;/div&gt; &lt;p&gt;Boris Yankov was a handsome thirty year old man, living in the historic Bulgarian city of Plovdiv. He was swarthy with dark hair; like Ben Affleck if had been hanging out in Eastern Europe for a couple of years.&lt;/p&gt;&lt;p&gt;Boris was a backend developer who'd found himself doing more and more frontend. More JavaScript. He was accustomed to C# on the backend with static typing a-gogo. From his point of view JS was brittle. It was super easy to break things and have no idea until runtime that you'd done so. It seemed so backward. He was ready for something TypeScript shaped.&lt;/p&gt;&lt;p&gt;&amp;quot;What people forget is how different it was back then. Microsoft made this announcement, but probably most of the people that were listening were part of the MS ecosystem. I certainly was. Remember, back then if you had a Mac or did Linux you probably didn't think about MS too much.&amp;quot;&lt;/p&gt;&lt;p&gt;Boris thought TypeScript just seemed like this interesting and weird thing that Microsoft were doing. He was excited by types; he was missing them and there was a real need there. A problem to solve. There were already people trying to address this. But the attempts so far had been underwhelming. Boris had encountered Google Closure Compiler; a tool built by Google which, amongst other things, introduces some measure of type safety to JavaScript by reading annotations in JSDoc format. Boris viewed GCC as a tentative first step. &lt;a href="https://github.com/google/closure-compiler/wiki/Annotating-JavaScript-for-the-Closure-Compiler"&gt;One which lead the way for things like TypeScript and Flow to follow.&lt;/a&gt;&lt;/p&gt;&lt;p&gt;The other aspect of TypeScript that excited Boris was transpilation. Transpilation is the term coined to describe what TypeScript does when it comes to emit output. It takes in TypeScript and pumps out JavaScript. The question is: what sort of JavaScript? One choice the TypeScript team could have made was just having the compiler stripping out types from the codebase. If it worked that way then you'd get out the JavaScript equivalent of the TypeScript you wrote. You wrote a &lt;code&gt;class&lt;/code&gt;? TypeScript emits a &lt;code&gt;class&lt;/code&gt;; just; one shorn of types and interfaces.&lt;/p&gt;&lt;p&gt;The TypeScript team made a different choice. They wrote the compiler such that the user could write ES6 style TypeScript syntax and have the TypeScript compiler transpile that down to ES5 or even ES3 syntax. This made TypeScript a much more interesting proposition than it already was, for a couple of reasons.&lt;/p&gt;&lt;p&gt;ES6 had been in the works for some time at this point. The release was shaping up to be the biggest incremental change to JavaScript that had so far happened. Or that would ever happen. Prior to this, JavaScript had experienced no small amount of tension and disagreement as it sought to evolve and develop. These played out in the form of the abandoned fourth edition of the language. There were arguments, harsh words, public disagreements and finally a failure to ship ECMAScript 4. In an alternate universe this was the end of the road for JavaScript. However, in our universe JavaScript got another throw of the dice.&lt;/p&gt;&lt;p&gt;It's telling that ES5 was for a long time known also as ES3.1; reflecting that it was initially planned to be the stepping stone between ES3 and ES4. In reality it ended up being the stepping stone between ES3 and ES6. As it turned out, it was a vital one too, &lt;a href="https://en.m.wikipedia.org/wiki/ECMAScript"&gt;it allowed the TC39 to recalibrate after a very public shelving of plans.&lt;/a&gt;&lt;/p&gt;&lt;p&gt;The band was back together (albeit with a new rhythm section) and ES6 was going to be &lt;em&gt;massive&lt;/em&gt;. JavaScript was going to get new constructs such as &lt;code&gt;Map&lt;/code&gt;, &lt;code&gt;Set&lt;/code&gt;, new scoping possibilities with &lt;code&gt;let&lt;/code&gt; and &lt;code&gt;const&lt;/code&gt;, &lt;code&gt;Promise&lt;/code&gt;s which paved the way for new kinds of async programming, the contentious &lt;code&gt;class&lt;/code&gt;es. And who can forget where they were when they first heard about &amp;quot;fat&amp;quot; arrow functions?&lt;/p&gt;&lt;p&gt;People salivated at the idea of it all. Such new shiny toys! But how could we use them? Whilst all this new hotness was on the way, where could you actually run your new style code? Complete browser implementations of ES6 wouldn't start to materialise until 2018. Given the slowness of people to upgrade and the need to support the lowest common denominator of browser this could have meant that all the excitement was trapped in a never tomorrow situation.&lt;/p&gt;&lt;p&gt;Back to TypeScript. The team had a solution for this issue. In their wisdom, the TypeScript team allowed us to write ES6 TypeScript and the compiler could (with some limitations) transpile it down to ES3 JavaScript. The audacity of this was immense. The TypeScript team brought the future back to the past. What's more, they made it work in Internet Explorer 6. Now that's rock'n'roll. It's nothing short of miraculous!&lt;/p&gt;&lt;p&gt;The significance of transpilation to TypeScript cannot be overstated.&lt;/p&gt;&lt;p&gt;You might be thinking to yourself, &amp;quot;that's just Babel, right?&amp;quot; Right. It's just that Babel didn't exist then. 6to5 was still an idea waiting for Sebastian McKenzie to think of. Even if you were kind of &amp;quot;meh&amp;quot; on types, the attraction of using a tool which allowed you to use new JavaScript constructs without breaking your customers was a significant draw. People may have come for types, but once they'd experienced the joy of a lexically bound &lt;code&gt;this&lt;/code&gt; in a fat arrow function they were &lt;em&gt;never&lt;/em&gt; going back.&lt;/p&gt;&lt;p&gt;Success has many parents. TypeScript is a successful project. One reason for this is that it's an excellent product that fills a definite need. Another reason is one that can't be banked upon; timing. TypeScript has enjoyed phenomenal timing. Appearing just when JavaScript was going off like a rocket and having the twin benefits of types and future JS today when nothing else offered anything close, that's perfect timing. It got people's curiosity. Now it got Boris's attention.&lt;/p&gt;&lt;h4&gt;Definitely Typed&lt;/h4&gt; &lt;div class="separator" style="clear: both; text-align: center;"&gt;&lt;a href="https://3.bp.blogspot.com/-FZrf9KEKVyI/XZuR_uN2AoI/AAAAAAAAR8Q/nLyjKThH5IAI0q475NjP8ecQYp6_g4ySQCLcBGAsYHQ/s1600/dt-logo-smallish.png" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"&gt;&lt;img border="0" src="https://3.bp.blogspot.com/-FZrf9KEKVyI/XZuR_uN2AoI/AAAAAAAAR8Q/nLyjKThH5IAI0q475NjP8ecQYp6_g4ySQCLcBGAsYHQ/s1600/dt-logo-smallish.png" data-original-width="140" data-original-height="140" /&gt;&lt;/a&gt;&lt;/div&gt; &lt;p&gt;Boris had been feeling unproductive. He would build applications in JS and watch them unaccountably break as he made simple tweaks to them. He was constantly changing things, breaking them, fixing them and hoping he hadn't broken something else along the way. It was exhausting. He saw the promise in what TypeScript was offering and decided to give it a go.&lt;/p&gt;&lt;p&gt;It was great. He fired up Visual Studio and converted a &lt;code&gt;.js&lt;/code&gt; file to end with the mystical TypeScript suffix of &lt;code&gt;.ts&lt;/code&gt;. In front of his eyes, red squiggly lines started to appear here and there in his code. As he looked at the visual noise he could see this was TypeScript delivering on its promise. It was finding the bugs he hadn't spotted. These migrations were also addictive; the more information you could feed the compiler, the more problems it found. Boris felt it was time to start writing type definitions, whatever they were.&lt;/p&gt;&lt;p&gt;Boris quickly learned how to write a type definition and set to work. Most libraries weren't well documented and so he found himself reading the source code of libraries he used in order that he could write the definitions. At first, the definitions were just files dropped in his ASP.NET MVC projects that he copied around. That wasn't going to scale; there needed to be somewhere he could go to grab type definitions when he needed them. And so on October 5th 2012 he created a repository under his profile at GitHub called &amp;quot;DefinitelyTyped&amp;quot;: &lt;a href="https://github.com/DefinitelyTyped/DefinitelyTyped/commit/647369a322be470d84f8d226e297267a7d1a0796"&gt;https://github.com/DefinitelyTyped/DefinitelyTyped/commit/647369a322be470d84f8d226e297267a7d1a0796&lt;/a&gt;&lt;/p&gt;&lt;p&gt;Boris took his type definitions and put them into this repository. Were you ever curious what the first definition added was? Close your eyes and think... You might imagine it was the (then number one JavaScript library on the web) jQuery. In fact it was Modernizr. Then Underscore followed, and then jQuery. Take a look:&lt;/p&gt;&lt;p&gt;&lt;a href="https://github.com/DefinitelyTyped/DefinitelyTyped/commits?after=4a4cf23ff4301835a45bb138bbb62bf5f0759255+699&amp;amp;author=borisyankov"&gt;https://github.com/DefinitelyTyped/DefinitelyTyped/commits?after=4a4cf23ff4301835a45bb138bbb62bf5f0759255+699&amp;amp;author=borisyankov&lt;/a&gt;&lt;/p&gt; &lt;a href="https://1.bp.blogspot.com/-0DbMi8aGa1c/XZwdP4VnoKI/AAAAAAAAR9k/33evIreTYEA4KTuZnNnZ9KhlgEAgVrskQCPcBGAYYCw/s1600/Initial-CommitsDefinitelyTyped.png" imageanchor="1" &gt;&lt;img border="0" src="https://1.bp.blogspot.com/-0DbMi8aGa1c/XZwdP4VnoKI/AAAAAAAAR9k/33evIreTYEA4KTuZnNnZ9KhlgEAgVrskQCPcBGAYYCw/s640/Initial-CommitsDefinitelyTyped.png" width="640" height="191" data-original-width="1494" data-original-height="445" /&gt;&lt;/a&gt; &lt;p&gt;It wasn't complicated; it was just a folder with subfolders underneath; each folder representing a project. One for jQuery, one for jQuery UI, one for Knockout.... You get the idea. It's not so different now.&lt;/p&gt;&lt;p&gt;Boris had laid simple but dependable foundations.  Definitely Typed had been born.&lt;/p&gt;&lt;h4&gt;How Do You Test a Type Definition?&lt;/h4&gt;&lt;p&gt;Boris was careful too. Right from the first type definition he added tests alongside them. Now tests for a type definition were a conundrum. How do you write a test for interfaces that don't exist in the runtime environment? Code that is expunged as part of the compilation process. Well, the answer Boris came to was this: a compilation test.&lt;/p&gt;&lt;p&gt;Someone once said: compilation is the first unit test... But it's a doozy. They're right. The value you get from compilation, from a computer checking the assertions your code makes, is significant. Simply put, it takes a large amount of tests to get the same level of developer confidence. Computers are wonderful at attention to detail in a way that puts even the most anally retentive human being to shame.&lt;/p&gt;&lt;p&gt;So if Boris had written a definition called &lt;code&gt;mylib.d.ts&lt;/code&gt;, he'd write a file that exercises this type definition. A &lt;code&gt;mylib.tests.ts&lt;/code&gt; if you will. This file would contain code that exercises the type definition in the way that it should correctly be used. This is code that will never be executed in the way that tests normally are; a test program is never actually run.  Rather these tests exist solely for compilation time. (In much the same way that TypeScript types only exist for compilation time.) Boris's plan was this: no compilation errors in &lt;code&gt;mylib.tests.ts&lt;/code&gt; represents passing tests. Compilation errors in &lt;code&gt;mylib.tests.ts&lt;/code&gt; represents failing tests. It was functional, brutal and also beautiful in it's simplicity.&lt;/p&gt;&lt;p&gt;So, imagine your definition looked like this:&lt;/p&gt;&lt;pre&gt;&lt;code&gt;declare function turnANumberIntoAString (numberToMakeStringOutOf: number): string&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;You might write a compilation test that looks like this:&lt;/p&gt;&lt;pre&gt;&lt;code&gt;const itIsAString: string = turnANumberIntoAString(42);&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;This test ensures that you can use your function in the way you'd expect. It returns the types you'd desire (a &lt;code&gt;string&lt;/code&gt; in this case) and it accepts the parameters you'd expect (a single &lt;code&gt;number&lt;/code&gt; for this example). If someone changed the definition in future, such that a different type was returned or a different set of parameters was required it would break the test. The test code wouldn't compile anymore. That's the nature of our &amp;quot;test&amp;quot;. It's blunt but effective.&lt;/p&gt;&lt;p&gt;This is the very first test committed to Definitely Typed; a test for Modernizr.&lt;/p&gt;&lt;p&gt;&lt;a href="https://github.com/DefinitelyTyped/DefinitelyTyped/blob/a976315cacbcfc151d5f57b25f4325dc7deca6f2/Tests/modernizr.ts"&gt;https://github.com/DefinitelyTyped/DefinitelyTyped/blob/a976315cacbcfc151d5f57b25f4325dc7deca6f2/Tests/modernizr.ts&lt;/a&gt;&lt;/p&gt;&lt;p&gt;This idea represents what tests look like throughout Definitely Typed today. They're now &amp;quot;run&amp;quot; as part of Continuous Integration and type definitions are tested in concert with one another to ensure that a change to one type definition doesn't break another. But there is nothing fundamentally different in place today to what Boris originally came up with.&lt;/p&gt;&lt;h4&gt;Independence&lt;/h4&gt;&lt;p&gt;Very quickly, Definitely Typed became a known project. People like Steve Fenton (author of the first book about TypeScript) were vocal supporters of the project. The TypeScript team talked up the project and were entirely supportive of its existence. In fact, at every given opportunity Anders Hejlsberg would sing its praises. For a while you could guarantee that any TypeScript talk by Anders would include a variant of &amp;quot;this guy called Boris started a project called Definitely Typed&amp;quot;. The impression he gave was that he was kind of amazed, and thoroughly delighted, the project existed.&lt;/p&gt;&lt;p&gt;The TypeScript team were completely uninvolved with Definitely Typed. That in itself is worth considering. The perception of Microsoft by developers generally in 2012 was at best, highly suspicious. &amp;quot;Embrace, extend, extinguish&amp;quot; - a strategy attributed to MS was very much a current perspective. This was born out in online comments and conversations at meetups. &lt;a href="https://news.ycombinator.com/item?id=4597716"&gt;The Hacker News comments on the TypeScript release were a mixed bag.&lt;/a&gt; The reaction on social media was rather less generous. Certainly it was harsh enough to prompt Scott Hanselman to write something of &lt;a href="https://www.hanselman.com/blog/WhyDoesTypeScriptHaveToBeTheAnswerToAnything.aspx"&gt;a defence of TypeScripts right to exist&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;Given that TypeScript had arrived with the promise of transforming the JavaScript developer experience, the developer community was understandably cautious. Was Microsoft doing a good or ill? Could they be trusted? There were already signs that MS was changing. For example, it had been shipping open source libraries such as jQuery with ASP.Net MVC for some time. Microsoft was starting to engage with the world of open source software.&lt;/p&gt;&lt;p&gt;How Microsoft interacted with the (very open source driven) JS community was going to be key to the success (or not) of TypeScript. What happened with the establishment of Definitely Typed very much indicated TypeScripts direction of travel.&lt;/p&gt;&lt;p&gt;On day one of its existence, Boris took type definitions written by Microsoft and made them available via Definitely Typed. A ballsy move. It would have been completely possible for MS to object to this. They didn't.&lt;/p&gt;&lt;p&gt;People like Diullei Gomes started submitting pull requests to improve the existing definitions and add new ones. Diullei even wrote the first command line tooling which allowed people to install type definitions: TSD. Within a surprisingly short period, DT had become the default home of type definitions on the web. There were briefly alternative Definitely Typed styled collections of type definitions elsewhere on GitHub but they didn't last.&lt;/p&gt;&lt;p&gt;This all happened completely independently of the TypeScript team. Definitely Typed existing actually allowed TypeScript itself to prosper. It was worth persevering with this bleeding edge language because of the interoperability Definitely Typed was providing to the community. So the hands off attitude of MS was both surprising and encouraging. It showed trust of the community; something that hadn't hitherto been a commonly noted characteristic of MS.&lt;/p&gt;&lt;p&gt;Boris started adding contributors to Definitely Typed to help him with the work. Definitely Typed was no longer a one man band, it had taken an important step. It was built and maintained by an increasing number of creative and generous people. All motivated by a simple aim: the best developer experience when working with TypeScript and existing JS libraries.&lt;/p&gt;&lt;h4&gt;Basarat Ali Syed&lt;/h4&gt; &lt;div class="separator" style="clear: both; text-align: center;"&gt;&lt;a href="https://3.bp.blogspot.com/-Q7a-LYiwvkw/XZuNKU7Gw4I/AAAAAAAAR7Y/FIjzp3FzECoRCOfuw1bcr_fexh-smYSZwCLcBGAsYHQ/s1600/basarat.jpg" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"&gt;&lt;img border="0" src="https://3.bp.blogspot.com/-Q7a-LYiwvkw/XZuNKU7Gw4I/AAAAAAAAR7Y/FIjzp3FzECoRCOfuw1bcr_fexh-smYSZwCLcBGAsYHQ/s320/basarat.jpg" width="320" height="320" data-original-width="400" data-original-height="400" /&gt;&lt;/a&gt;&lt;/div&gt; &lt;p&gt;Basarat Ali Syed was a 27 year old who had recently moved to Melbourne, Australia from Pakistan. You might know of him for a number of reasons, not least being the TypeScript equivalent of Jon Skeet. That, incidentally, is not a coincidence. Basarat had watched Jon Skeet's impressive work, being &lt;em&gt;the&lt;/em&gt; gold standard in C# answers and thought &amp;quot;there's something worth emulating here&amp;quot;.&lt;/p&gt;&lt;p&gt;Bas was working for a startup who had a JS frontend. About six months before TypeScript was announced to the world he watched Anders Hejlsberg do a presentation on JavaScript which included Anders saying to the audience &amp;quot;don't you just wish you had type safety?&amp;quot; with a twinkle in his eye. TypeScript was of course well underway by this time; just not yet public. Bas remembered the comment and, when TypeScript was announced, he was ready. He made it his personal mission to be the goto person answering questions about TypeScript on Stack Overflow.&lt;/p&gt;&lt;p&gt;In those early days of TypeScript, if you put a question about TypeScript onto Stack Overflow there was a very good chance that Bas would answer it. And Bas was more helpful than your typical SO answerer. Not only would he provide helpful commentary and useful guidance, he would often find him answering &amp;quot;yeah, the problem isn't your code, it's the type definition. It needs improvement. In fact, I've raised a PR to fix it here&amp;quot;&lt;/p&gt;&lt;p&gt;Boris saw the drip, drip of Basarat PRs turning into a flood. So, very quickly, he invited Basarat join Definitely Typed. Now Bas could not just suggest changes, he could ensure they were made. Step by step the quality of type definitions improved.&lt;/p&gt;&lt;p&gt;Basarat describes himself as a &amp;quot;serial OSS contributor and mover on-er&amp;quot;. It's certainly true. As well as his Stack Overflow work, he's been someone involved in the early days of any number of open source projects. Not just Definitely Typed. Bas also worked on the TypeScript port of the JavaScript task runner; Grunt TS. He met up with Pete Hunt (he of React) at a Decompress conference and together they hacked together a POC webpack TypeScript loader. (That POC ultimately lead to James Brantly creating ts-loader which I maintain.) Bas wrote the atom-typescript plugin which offers first class support for TypeScript in Atom. Not content with that he went on to write a full blown editor of his own called alm-tools.&lt;/p&gt;&lt;p&gt;This is not an exhaustive list of his achievements and already I'm tired. Besides this he wrote the TypeScript Deep Dive book and the VS Code TypeScript God extension. And more.&lt;/p&gt;&lt;p&gt;Bas had the level of self knowledge required to realise that getting others involved was key to the success of open source projects. Particularly given that he knew he had a predilection to eventually move on, to work on other things. So Bas kept his eyes open and welcomed in new maintainers for projects he was working on. Bas' actions in particular were to be crucial. Bas grew the Definitely Typed team; he invited others in, he got people involved.&lt;/p&gt;&lt;p&gt;On December 28th 2013 Basarat decided that a regular contributor to Definitely Typed might be a potential team member. Bas opened up Twitter and sent a Direct Message to John Reilly.&lt;/p&gt; &lt;a href="https://4.bp.blogspot.com/-IZzAtFiDQi8/XZuNoLYhMBI/AAAAAAAAR7k/i-khpa5KpDUjocNFhEfDALsXLCuhlffMACPcBGAYYCw/s1600/2019-10-02%2B21_51_58-basarat%2B_%2BTwitter.png" imageanchor="1" &gt;&lt;img border="0" src="https://4.bp.blogspot.com/-IZzAtFiDQi8/XZuNoLYhMBI/AAAAAAAAR7k/i-khpa5KpDUjocNFhEfDALsXLCuhlffMACPcBGAYYCw/s640/2019-10-02%2B21_51_58-basarat%2B_%2BTwitter.png" width="640" height="371" data-original-width="871" data-original-height="505" /&gt;&lt;/a&gt; &lt;h4&gt;John Reilly&lt;/h4&gt; &lt;div class="separator" style="clear: both; text-align: center;"&gt;&lt;a href="https://2.bp.blogspot.com/-crUiCOp78oI/XZuOf5gh5wI/AAAAAAAAR7s/d1nwVu3rhU8ZLs5TpHB3y_CjWIFAYKo7QCLcBGAsYHQ/s1600/johnny_reilly.jpg" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"&gt;&lt;img border="0" src="https://2.bp.blogspot.com/-crUiCOp78oI/XZuOf5gh5wI/AAAAAAAAR7s/d1nwVu3rhU8ZLs5TpHB3y_CjWIFAYKo7QCLcBGAsYHQ/s320/johnny_reilly.jpg" width="320" height="320" data-original-width="400" data-original-height="400" /&gt;&lt;/a&gt;&lt;/div&gt; &lt;p&gt;That's me. Or &lt;a href="https://twitter.com/johnny_reilly"&gt;johnny_reilly on Twitter&lt;/a&gt; and &lt;a href="https://github.com/johnnyreilly"&gt;johnnyreilly&lt;/a&gt; on GitHub (as John Papa and I have learned to our chagrin; GitHub don't support the &amp;quot;_&amp;quot; character in usernames). Relatively few people call me Johnny. I'm named that online because back when I applied for an email address, someone had already bagsied john_reilly@popularemailhotness.com. So rather than sully my handle with a number or a middle name I settled for johnny_reilly. I haven't looked back and have generally tried to keep that nom de plume wherever I lay my hat online.&lt;/p&gt;&lt;p&gt;In contrast to others I was a relatively late starter to TypeScript. I was intrigued right from the initial announcement, but held off from properly getting my hands dirty until generics was added to the language in 0.9. (This predisposition towards generics in a language perhaps explains why I didn't get too far with Golang.)&lt;/p&gt;&lt;p&gt;At that point I was working in London for a private equity house. It was based in the historic and affluent area of St James. St James is an interesting part of London, caught midway between the Government, Buckingham Palace and the heart of the West End. It's old fashioned, dripping with money and physically delightful. It's the sort of place film crews dash towards when they're called upon to show old fashioned London in all its pomp. It rocks.&lt;/p&gt;&lt;p&gt;My team hated JavaScript. Absolutely loathed it. I was the solo voice saying &amp;quot;but it's really cool!&amp;quot; whilst they all but burned effigies of Brendan Eich in each code review. However, to my delight (and their abject horror) the project we were working on could only be implemented using JS. Essentially the house wanted an application offering rich interactivity which had to be a web app. So JS. We were coding then with a combination of jQuery and Knockout JS. And, in large part due to the majority of the team being unfamiliar with JS, we were shipping bugs. The kind of bugs that could be caught by a compiler. By static typing. Not to put too fine a point on it; by TypeScript.&lt;/p&gt;&lt;p&gt;So I proposed an experiment: &amp;quot;Let's take one screen and develop it with TypeScript. Let's leave the rest of the app as is; JavaScript as usual. And then once we're done with that screen let's see how we feel about it. TypeScript might not be that great. But that's fine, if it isn't we'll take the generated JS, keep that and throw away the TypeScript. Deal?&amp;quot;&lt;/p&gt;&lt;p&gt;The team were on board and, one sprint review later, we decided that all future JS functionality would be implemented with TypeScript. We were in!&lt;/p&gt;&lt;p&gt;From day one of using TypeScript I was in love. I had the functionality of JavaScript, the future semantics of JavaScript and I was making less mistakes. Our team had become more productive. We were shipping faster and more reliably with fewer errors. People were noticing; our reputation as a team was improving, in part due to our usage of TypeScript. We had a jetpack.&lt;/p&gt;&lt;p&gt;However. I wasn't satisfied. As I tapped away at my keyboard I found type definitions to be imperfect. And that niggled. Did it ever niggle. By then &lt;a href="https://github.com/staxmanade"&gt;Jason Jarrett&lt;/a&gt; had wired up Definitely Typed packages to be published out to Nuget. Devs using ASP.NET MVC 4 (as I then was) were busily installing type definitions alongside AutoFac and other dependencies. Whilst most of those dependencies arrived like polished diamonds, finished products ready to be plugged into the project and start adding value. The type definitions by contrast felt very beta. And of course, they were. TypeScript was beta. The definitions reflected the newness of the language.&lt;/p&gt;&lt;p&gt;I could make it better.&lt;/p&gt;&lt;p&gt;I started submitting pull requests. The first problem I decided to solve was IntelliSense. I wanted IntelliSense for jQuery. If you went to &lt;a href="https://api.jquery.com"&gt;https://api.jquery.com&lt;/a&gt; there was rich documentation for every method jQuery exposed. I wanted to see that documentation inside Visual Studio as I coded. If I keyed in &lt;code&gt;$.appendTo(&lt;/code&gt; I wanted VS to be filled with the content from &lt;a href="https://api.jquery.com/appendTo/"&gt;https://api.jquery.com/appendTo/&lt;/a&gt; . That was my mission. For each overload of the method I'd add something akin to this to the type definition file:&lt;/p&gt;&lt;pre&gt;&lt;code&gt;   /**&lt;br /&gt;     * Insert every element in the set of matched elements to the end of the target.&lt;br /&gt;     *&lt;br /&gt;     * @param value A selector, element, HTML string, array of elements, or jQuery &lt;br /&gt;     *              object; the matched set of elements will be inserted at the end &lt;br /&gt;     *              of the element(s) specified by this parameter.&lt;br /&gt;     */&lt;br /&gt;    appendTo(target: string): JQuery;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;It was a tedious task plugging it all in, but the pleasure I got from having rich IntelliSense in VS more than made up for it to me. Along the way I added and fixed sections of the jQuery API that hadn't been implemented, or had been implemented incorrectly. It got to a point where jQuery was a good example of what a type definition should look like. That remains the case to this day; surprisingly few type definitions enjoy the JSDoc richness of jQuery. &lt;a href="https://blog.johnnyreilly.com/2014/05/typescript-jsdoc-and-intellisense.html"&gt;I have tried to encourage more use of this with blog posts code reviews and the like, but it's never got the traction I'd hoped.&lt;/a&gt;&lt;/p&gt;&lt;p&gt;I'm fairly relentless when I put my mind to something. I work very hard to make things come to pass. What this meant at one point was the Definitely Typed maintainers receiving multiple PRs a day. Which prompted Bas to wonder &amp;quot;I wonder if he'd like to join us?&amp;quot;&lt;/p&gt;&lt;p&gt;I happily accepted Bas' invitation and soon found myself reading this email:&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;From: Bas&lt;p&gt;&lt;p&gt;Sent: 28 December 2013 11:47&lt;/p&gt;&lt;p&gt;To: Boris Yankov; johnny_reilly@hotmail.com; Bas; vvakame; Bart van der Schoor; Diullei Gomes; steve fenton; Jason Jarret Subject: DefinitelyTyped team introduction&lt;/p&gt;&lt;p&gt;Dear All,&lt;/p&gt;&lt;p&gt;Meet John Reilly (github : https://github.com/johnnyreilly , twitter : https://twitter.com/johnny_reilly) who will be helping with Definitely Typed definitions.&lt;/p&gt;&lt;p&gt;Boris manages the project and he can add you as a collaborator.&lt;/p&gt;&lt;p&gt;Additional team member introductions:&lt;/p&gt;&lt;p&gt;Admin : Boris Yankov&lt;/p&gt;&lt;p&gt;TSD package manager : https://github.com/DefinitelyTyped/tsd : Diullei / Bart van der Schoor&lt;/p&gt;&lt;p&gt;NUGET: https://github.com/DefinitelyTyped/NugetAutomation : Json Jarret&lt;/p&gt;&lt;p&gt;Passionate TypeScript users like yourself: Wakame, Myself and SteveFenton .&lt;/p&gt;&lt;p&gt;Cheers, Bas (Basarat)&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;Some of those names you'll recognise; some perhaps not. Jason Jarrett wrote the Nuget distribution mechanism for type definitions that ended up existing for far longer than anyone (least of all Jason) anticipated. Steve Fenton was largely a cheerleader for Definitely Typed in its early days. Diullei and Bart, amongst other things, worked on the initial command line tooling for DT: TSD.&lt;/p&gt;&lt;p&gt;After being powered up in Definitely Typed, my contributions only increased. Anything that I was using in my day to day work, I wanted to have an amazing TypeScript experience. I wanted the language to thrive and I was pretty sure I could help by trying to get users the best-in-class developer experience as they used JS libraries. I've always found good developer experience a strong motivation; the idea being, if someone loves their tools, they'll do great work. The end customer (of whatever they're building) gets a better product sooner. Great developer experience is a force multiplier for building software.&lt;/p&gt;&lt;h4&gt;Policy time&lt;/h4&gt;&lt;p&gt;TypeScript was now at version 0.9.1. Still very much beta. Back then every release was breaking. Breaking. Very much with a capital &amp;quot;B&amp;quot;.&lt;/p&gt;&lt;p&gt;TypeScript had, since the very early days, made a commitment to track the ECMAScript standard. All JavaScript is valid TypeScript. However, there was briefly a period where this might not have been so. One of the things people most remember from the initial release is that they could now write classes. These were already the standardised classes of ES6 but it almost wasn't to be. For a brief period there had been consideration of doing something subtly different. In fact Anders would describe the TypeScript team's journey towards embracing the standards as a tale tinged with regret. In doing so they'd had to say goodbye to a different implementation of classes which he'd preferred but which they'd ditched because they weren't standard.&lt;/p&gt;&lt;p&gt;Alongside differences like this there were other delineations. Types had different names in the past which, as time went by, were renamed to align with standards. &lt;code&gt;boolean&lt;/code&gt; was originally &lt;code&gt;bool&lt;/code&gt; for instance; likely a reflection of Anders involvement with C#.&lt;/p&gt;&lt;p&gt;These sorts of changes, alongside any number of others, meant that each release of TypeScript sometimes entirely broke the definitions in Definitely Typed. Most notable was the 0.9.1 -&amp;gt; 0.9.5 migration. This was both an exercise in serious pain endurance and also a testament to the already strong commitment to TypeScript that existed. The reason people were willing to put the effort in to keep these migrations going was because they believed it was worth it. They believed in TypeScript. This PR is testament to that: &lt;a href="https://github.com/DefinitelyTyped/DefinitelyTyped/pull/1385"&gt;https://github.com/DefinitelyTyped/DefinitelyTyped/pull/1385&lt;/a&gt;&lt;/p&gt;&lt;p&gt;A level of flux meant that for a long time Definitely Typed committed only to support the latest version of TypeScript and the latest version of packages therein. These days it's not so brutal, but then it had to be as a matter of necessity.&lt;/p&gt;&lt;p&gt;The compiler was changing too fast and there were too few people involved to allow for any realistic alternative. As is often the case in software development, it was &amp;quot;good enough&amp;quot;. Any other choice would probably have increased the workload of maintainers to a point where the project would no longer be a going concern. It was a choice with downsides; trade-offs. But it was the choice that best served the future of Definitely Typed and TypeScript.&lt;/p&gt; &lt;h4&gt;Masahiro Wakame&lt;/h4&gt; &lt;div class="separator" style="clear: both; text-align: center;"&gt;&lt;a href="https://2.bp.blogspot.com/-Zj1NJaq0NRk/XZuPa20Y18I/AAAAAAAAR70/LTd4jgINbJIZqdWYiQpIsXWV4DnoDZ22gCLcBGAsYHQ/s1600/masahiro_wakame.jpg" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"&gt;&lt;img border="0" src="https://2.bp.blogspot.com/-Zj1NJaq0NRk/XZuPa20Y18I/AAAAAAAAR70/LTd4jgINbJIZqdWYiQpIsXWV4DnoDZ22gCLcBGAsYHQ/s320/masahiro_wakame.jpg" width="320" height="320" data-original-width="680" data-original-height="680" /&gt;&lt;/a&gt;&lt;/div&gt; &lt;p&gt;Time passed. Autumn turned into winter, winter into spring. TypeScript reached 1.0. It wasn't beta anymore. As each release came, the changes in the compiler became more gradual. This was a blessing for the Definitely Typed team. The projects popularity was ticking up and up. New definitions were added each day. The trickle of issues and PRs had become a stream, then a river. A river very much ready to burst its banks.&lt;/p&gt;&lt;p&gt;It was taking its toll. Inside Definitely Typed roles were shifting. Boris was starting to step back from day to day reviewing of PRs. New members were joining the project, like Igor Oleinikov. But the pace was insatiable.&lt;/p&gt;&lt;p&gt;Some people left the project entirely, burned out by the never ending issues and PRs. Basarat started contributing less, beginning to turn his attention to one of his many sidejams. Fortunately, it turned out that before Basarat stepped back, he had done a very fine thing. In Tokyo, Japan was a 28 year old developer named Masahiro Wakame.&lt;/p&gt;&lt;p&gt;Mas was using JS to build the web applications he worked on. But ECMAScript 5 wasn't hitting the mark for him. For a time Masahiro used CoffeeScript (Jeremy Ashkenas Ruby style JS alternative). He liked it, but, as he put it: &amp;quot;I was shooting my foot everyday&amp;quot;. Looking out for that elusive solution he landed on Dart. It looked amazing. But it wasn't ECMAScript. Masahiro worried he'd be locked in. He'd built some libraries and a testing framework using Dart. But he didn't feel he could suggest that his company adopted it; it was too different and only he knew it. He was left with the &amp;quot;what if I go under a bus?&amp;quot; problem. If he left the company, his colleagues would find it hard to move away from using Dart. This made him very hesitant. He didn't feel he could justify the choice.&lt;/p&gt;&lt;p&gt;Then Masahiro heard about TypeScript. Like Goldilocks and the three bears, this third language sounded just right. He loved the type safety. It also had a compelling proposition: the transpiled JS that TypeScript generated was human readable and idiomatic. Generating idiomatic JS as opposed to some kind of strange byte code was a goal of the language from the early days, as Anders Hejlsberg would repeatedly explain. This generation of &amp;quot;real JS&amp;quot; made test driving TypeScript a low risk proposition. One that appealed to the likes of Masahiro. No lock-in. You decide TypeScript isn't for you? Fine. Take the generated JS files and shake the TypeScript dust off your sandals. Masahiro consequently went all in on TypeScript. This was his bet. And he was going to cover his bet by trying to make the ecosystem even stronger.&lt;/p&gt;&lt;p&gt;Masahiro started out trying to improve the testing framework in DT; sending in pull requests. Before too long, Basarat messaged him to say &amp;quot;do you wanna become a committer?&amp;quot; &lt;a href="https://github.com/DefinitelyTyped/DefinitelyTyped/pull/1358"&gt;Masahiro became a committer.&lt;/a&gt;&lt;/p&gt;&lt;p&gt;It turned out that MH had a special qualities that DT was going to sorely need: he was willing and able to review PR after PR, day after day. His stamina was incredible.&lt;/p&gt;&lt;p&gt;Whilst it may not have been obvious from the outside, by now Definitely Typed was a slightly troubled project. The speed at which issues and PRs landed was relentless. Anyone who had once set GitHub to &amp;quot;watching&amp;quot; for Definitely Typed soon unsubscribed. It was becoming unmanageable. And whilst almost everyone else in the project was in the process of burning out / moving on / stepping back and similar, Masahiro kept going. He kept showing up. He kept reviewing. He kept merging. At his peek he was spending 2 hours a day, every day, glued to his screen in Tokyo and reviewing PRs for GitHub. The pulse of Definitely Typed may have slowed. But Masahiro kept the heart beating.&lt;/p&gt;&lt;p&gt;As Masahiro kept the lights on, in a hotel room in Buenos Aires an Australian named Blake Embrey was making plans...&lt;/p&gt; &lt;h4&gt;Blake Embrey&lt;/h4&gt; &lt;div class="separator" style="clear: both; text-align: center;"&gt;&lt;a href="https://3.bp.blogspot.com/-vT0QJJKcZK4/XZuQfkzbOgI/AAAAAAAAR8A/-tVQ-2Bo5mkdi6qdkZzNrD_A3jXA7lpqACLcBGAsYHQ/s1600/blake_embrey.jpeg" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"&gt;&lt;img border="0" src="https://3.bp.blogspot.com/-vT0QJJKcZK4/XZuQfkzbOgI/AAAAAAAAR8A/-tVQ-2Bo5mkdi6qdkZzNrD_A3jXA7lpqACLcBGAsYHQ/s320/blake_embrey.jpeg" width="320" height="320" data-original-width="400" data-original-height="400" /&gt;&lt;/a&gt;&lt;/div&gt; &lt;p&gt;Blake was a 21 year old Australian. He was a nomadic developer, travelling around the world and working remotely. He travelled from country to country armed with a suitcase and his trusty MacBook in search of WiFi. He found himself dialing into standups from cafs in Vietnam at 1am to provide Jira updates, coding from airports as he criss-crossed the globe. It was an unusual life.&lt;/p&gt;&lt;p&gt;A friend showed Blake TypeScript somewhere around the TypeScript 1.2 era. He was interested. He was mostly working on backend NodeJS at the time. He could see the potential that TypeScript had to help him. Around the TypeScript 1.5 era Blake started to take a really good look at what was possible. From his vantage point, there was good and there was also bad. And he thought he could help.&lt;/p&gt;&lt;p&gt;As a module author and developer, he loved TypeScript. It allowed him to write, publish and consume 100% type-safe JavaScript. Features like autocompletion, type validation and ES6 features became part of his typical workflow. It was so good!&lt;/p&gt;&lt;p&gt;However, one step in this development lifecycle was broken to his mind. The problem was module shaped. Yeah, modules. Wade into the controversy!&lt;/p&gt;&lt;p&gt;Thanks again to Basarat, Blake soon became a DT contributor. Of all the contributors to Definitely Typed, Blake was the first one who was looking hard at the module problem. This was because whilst he wanted TypeScript to solve the same problems as everyone else, he wanted to solve them in a world of package dependencies. He wanted to solve for Node.&lt;/p&gt;&lt;p&gt;Now it's worth taking a moment to draw a comparison between web development then, and web development now. Because it's changed. The phrase &amp;quot;web development fatigue&amp;quot; exists with good reason. Web development in 2014 as compared to web development in 2019 is a very different proposition. Historically, JavaScript has not had a good story around modularisation. The language meandered forwards without ever gaining an official approach to modularisation until ES6.  So for twenty years, if you wanted to write a large JS application you had to think hard about how to solve this problem. And even when modules were nailed down it was longer still until module loading was standardised.&lt;/p&gt;&lt;p&gt;But that didn't stop us. JavaScript apps were still being built on the frontend and the backend. On the frontend an approach to modularisation emerged called the Asynchronous Module Definition. It had some adoption but in the main that wasn't how people rolled. The frontend was generally a sea of global variables.  People would write programs that depended upon global variables and worked hard to make sure that they didnt collide. Everything did this.  Everything.  Underscore?  It was a global variable called &lt;code&gt;_&lt;/code&gt;.  jQuery?  It was two global variables: &lt;code&gt;$&lt;/code&gt; and &lt;code&gt;jQuery&lt;/code&gt;.  That's just what people did. I'm a person. I did that. If you were there you probably did too.&lt;/p&gt;&lt;p&gt;On the server side, in Node JS land, a different standard had emerged: CommonJS. Unlike AMD, CommonJS was simply how the Node JS community worked. Everything was a CommonJS module. Alongside Node, npm was growing and growing. Exposing Node developers to a rich ecosystem of modules or packages that they could drop into their apps with merely a tap tap tap of &lt;code&gt;npm install super-cool-package&lt;/code&gt; and then &lt;code&gt;var scp = require('super-cool-package')&lt;/code&gt;.&lt;/p&gt;&lt;p&gt;And therein, as the Bard would have it, lay the rub. You see, in the frontend it was simpler. Uglier but simpler. By and large, the global variables were fine. They weren't beautiful but they were functional. It may have impaired the development of frontend apps, but it certainly didn't stop it.&lt;/p&gt;&lt;p&gt;And since a design goal of TypeScript was to meet JavaScript developers where they were and try and make their lives better, the initial focus of Definitely Typed was necessarily types that existed in the global namespace. So &lt;code&gt;jquery.d.ts&lt;/code&gt; would declare global &lt;code&gt;$&lt;/code&gt; and &lt;code&gt;jQuery&lt;/code&gt; variables and underneath them all the jQuery methods and variables that were implemented. Alongside jQuery, maybe an application would have jQuery UI which would extend the &lt;code&gt;$&lt;/code&gt; variable and add extra functionality. In addition maybe there'd be a couple of jQuery plugins in play too. (It's worth saying that jQuery was the crack cocaine of web development back in the day. People just couldn't get enough.)&lt;/p&gt;&lt;p&gt;TypeScript catered for this world by allowing type definitions to extend interfaces created by other definition files. The focus of most of the Definitely Typed contributors up to this point was frontend and hence DT was an ocean of global type definitions.&lt;/p&gt;&lt;p&gt;Of course, this is not what the frontend world looks like these days. The frontend now is all about npm thanks to tools like Browserify, webpack, Rollup and the like. Client and server side development is mighty similar these days. Or at least, it's swimming in more of the same waters. There's a good TypeScript story to tell about this as well. But there wasn't always. Back to Blake.&lt;/p&gt;&lt;p&gt;Blake had published a bunch of modules on npm.  But no one had ever been able to consume the type definitions from them. Why was that? Well, without delving into great detail it comes down to type definitions of a package generally conflicting with type definitions that a user installs themselves.&lt;/p&gt;&lt;p&gt;This essentially came down to how TSD worked and what Definitely Typed contained. TSD was a pretty simple tool; by and large it worked by copying files from Definitely Typed into a users project. The files copied would contain type definitions which contained global types. So even though you cared solely about external modules, because of Definitely Typed you found yourself installing globals alongside which lead to conflicts between different type definitions. Different type definitions punching it out whilst the TypeScript compiler stood in between ineffectually shouting &amp;quot;leave it alone mate - it's not worth it!&amp;quot;&lt;/p&gt;&lt;p&gt;How could we have a world where external modules and global were treated distinctly? Blake had ideas  Plan one was to rewrite TSD to support external modules; the type of modules that were standard in Node land.  After working hard on that for some time, Blake came to conclusion that solving global variables alongside external modules was a hard problem.  A very hard problem.  And perhaps that just running with external modules, &lt;a href="https://github.com/DefinitelyTyped/tsd/issues/150"&gt;a new start if you will, represented the best way forwards&lt;/a&gt;.&lt;/p&gt; &lt;h4&gt;Typings&lt;/h4&gt; &lt;div class="separator" style="clear: both; text-align: center;"&gt;&lt;a href="https://4.bp.blogspot.com/-X4v-cjcPBrM/XZuRzt7XDII/AAAAAAAAR8M/6R0Jq7lNVSIDUwHPti2yO5vvhjxaUdKUQCLcBGAsYHQ/s1600/typings.jpg" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"&gt;&lt;img border="0" src="https://4.bp.blogspot.com/-X4v-cjcPBrM/XZuRzt7XDII/AAAAAAAAR8M/6R0Jq7lNVSIDUwHPti2yO5vvhjxaUdKUQCLcBGAsYHQ/s320/typings.jpg" width="320" height="320" data-original-width="400" data-original-height="400" /&gt;&lt;/a&gt;&lt;/div&gt; &lt;p&gt;Blake made &lt;a href="https://github.com/typings/typings"&gt;typings&lt;/a&gt;. Typings was a number of things; it was a new command line tool to replace TSD, it was a new approach to distributing type definitions and it was a registry.  But Typings was a registry which pointed out to the web. Typings installation was entirely decentralized and the typings themselves could be downloaded from almost anywhere - GitHub, NPM, Bower and even over HTTP or the filesystem.  Those type definitions could be external modules or globals.&lt;/p&gt;&lt;p&gt;It was radical.  From centralisation to decentralisation.  As Blake described it:&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;This decentralization solves the biggest pain point I see with maintaining DefinitelyTyped. How does an author of one typings package maintain their file in DefinitelyTyped when they get notifications on thousands of others? How do you make sure typings maintain quality when you have 1000s to review? The solution in typings is you dont, the community does. If typings are incorrect, I can just write and install my own from wherever I want, something that TSD doesnt really allow. Theres no merge or review process you need to wait for (300+ open pull requests!).&lt;/p&gt;&lt;p&gt;However, decentralization comes with the cost of discoverability. To solve this, a registry exists that maintains locations of where the best typing can currently be installed from, for any version. If theres a newer typing, patches, or the old typing author has somehow disappeared, you can replace the entry with your own so people will be directed to your typings from now on.&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;The world started to use Typings as the default CLI for type definitions. &lt;code&gt;typings.json&lt;/code&gt; files started appearing in people's repos. Typings allowed consumption of types both from the Typings registry and from Definitely Typed and so there was an easy on ramp for people to start using Typings.&lt;/p&gt;&lt;p&gt;Little by little, people started consuming type definitions that came from the typings registry rather than from Definitely Typed. Typings began to thrive whilst DT continued to choke. The community was beginning to diverge.&lt;/p&gt; &lt;h4&gt;The TypeScript Team&lt;/h4&gt; &lt;div class="separator" style="clear: both; text-align: center;"&gt;&lt;a href="https://1.bp.blogspot.com/-YYolmCDcgAA/XZuSsHp2H5I/AAAAAAAAR8g/0FG_WokLH_sgsxvwGQJD8DeLny0BEuWswCPcBGAYYCw/s1600/TypeScriptTeam.jpg" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"&gt;&lt;img border="0" src="https://1.bp.blogspot.com/-YYolmCDcgAA/XZuSsHp2H5I/AAAAAAAAR8g/0FG_WokLH_sgsxvwGQJD8DeLny0BEuWswCPcBGAYYCw/s640/TypeScriptTeam.jpg" width="640" height="327" data-original-width="1103" data-original-height="563" /&gt;&lt;/a&gt;&lt;/div&gt; &lt;p&gt;Over in Seattle, the TypeScript team was thinking hard about the type definition ecosystem. About Definitely Typed and Typings. And about tooling and distribution.&lt;/p&gt;&lt;p&gt;At this point, there wasn't a dedicated registry for type definitions. There was GitHub. By and large, all type definitions lived in GitHub. Since GitHub is a git based source control provider it was possible for it to be used as a makeshift registry. So that's exactly what Definitely Typed and Typings were doing; piggy backing on GitHub and MacGyvering &amp;quot;infrastructure&amp;quot;. It worked.&lt;/p&gt;&lt;p&gt;There wasn't a great versioning story. Definitely Typed just didn't do versioning. The latest and greatest was supported. Nothing else. The Typings approach was more nuanced. It did have an approach for versioning.  It supported it by dint of allowing a version number in the registry to point to a specific git hash in a repo. It was an elegant and smart approach. Blake Embrey was one sharp cat.&lt;/p&gt;&lt;p&gt;Innovative though it was, the decentralised Typings approach presented potential security risks as it pointed out to the web making auditing harder. Alongside this, The TypeScript team was pondering ways they could reduce friction for developers that wanted to use TypeScript.&lt;/p&gt;&lt;p&gt;By now, the JavaScript ecosystem had started to coalesce around npm as the registry du jour. Bower and jspm were starting to fade in popularity. NuGet (the .NET package manager) was no longer being encouraged as a place to house JS. npm was standard. TypeScript users found themselves using npm to install jQuery and reaching for tsd or Typings to install the associated type definitions. That's two commands. With two package managers. Each with subtly different syntax. And then perhaps you had to fiddle with the &lt;code&gt;tsconfig.json&lt;/code&gt; to get the compiler looking in the right places. It worked. But it didn't feel . idiomatic. It didn't feel like TypeScript was meeting their users where they were.&lt;/p&gt;&lt;p&gt;The likes of Daniel Rosenwasser, Mohamed Hegazy and Ryan Cavanaugh found themselves pondering the problem. Alongside this, they were thinking more about what a first class module support experience in TypeScript would look like, motivated in part by the critical mass around npm, which was entirely module / package based.&lt;/p&gt;&lt;p&gt;That wasnt the only thing on their minds; there was also the testing story.  Definitely Typed had a straightforward testing story due to being a real mega-repo.  Everything lived together and could be tested together.  Thanks to the hard work of the Definitely Typed team this was already in place; every PR spun up Travis and tested all the type definitions individually and in concert with one another. Typings didnt have this.  Whats more, it would be hard to build.  The decentralised nature of Typings meant that youd need to build infrastructure to crawl the Typings registry, download the type definitions and then perform the tests.  It was non-trivial and unlikely to be speedy.&lt;/p&gt;&lt;p&gt;There was one more factor in play.  The TypeScript team were aware that for the longest time they'd been working on the language. But they'd become distant from one of the most significant aspects of how the language was used.  They werent well enough informed about the rough edges in the type definition space.  They werent feeling their users pain.  They needed to address this and really there was only one thing to do... It was time for the TypeScript team to start eating their own dogfood.&lt;/p&gt;&lt;h4&gt;A Plan Emerges&lt;/h4&gt;&lt;p&gt;The TypeScript team reached out to Blake Embrey and started to talk about ways forward. They started collaborating over Slack.&lt;/p&gt; &lt;div class="separator" style="clear: both; text-align: center;"&gt;&lt;a href="https://4.bp.blogspot.com/-VR7Oce3avMs/XZuTjihWOZI/AAAAAAAAR8k/H0ELv0MtZ-Ur8ydUeNmyO8z7qCp5GxV4wCLcBGAsYHQ/s1600/typings_typescript_collaboration.jpg" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"&gt;&lt;img border="0" src="https://4.bp.blogspot.com/-VR7Oce3avMs/XZuTjihWOZI/AAAAAAAAR8k/H0ELv0MtZ-Ur8ydUeNmyO8z7qCp5GxV4wCLcBGAsYHQ/s320/typings_typescript_collaboration.jpg" width="314" height="320" data-original-width="1548" data-original-height="1580" /&gt;&lt;/a&gt;&lt;/div&gt; &lt;p&gt;The TypeScript team had also been in contact with the Definitely Typed team.  They were, at this point, aware that Definitely Typed was being kept going mainly due to the hard graft of Masahiro Wakame.  As Daniel observed vvakame was a champ.&lt;/p&gt;&lt;p&gt;At this point I have to stick my own hand up and confess to thinking that Definitely Typed was not long for this world.  Steve Ognibene (another DT member) and others were all feeling similarly.  It seemed inevitable.&lt;/p&gt; &lt;a href="https://1.bp.blogspot.com/-c9HAg6SjhoM/XZuUCF0ZYOI/AAAAAAAAR8s/_K-q62ccC54gjBr6JW1d7RAL1D_mYaLLgCPcBGAYYCw/s1600/steveognibe.png" imageanchor="1" &gt;&lt;img border="0" src="https://1.bp.blogspot.com/-c9HAg6SjhoM/XZuUCF0ZYOI/AAAAAAAAR8s/_K-q62ccC54gjBr6JW1d7RAL1D_mYaLLgCPcBGAYYCw/s640/steveognibe.png" width="640" height="542" data-original-width="888" data-original-height="752" /&gt;&lt;/a&gt; &lt;p&gt;The TypeScript team were about to change that.  After talking, thinking, thinking and talking they put together a plan.  It was going to change TypeScript and change Definitely Typed.  It was also going to effectively end Typings.&lt;/p&gt;&lt;p&gt;Its worth saying at this point that the TypeScript team didnt enter into this lightly.  They were hugely impressed by Typings.  It was, to quote Daniel Rosenwasser, an impressive piece of work.  It also had the most amazing command line experience.  Everyone on the team felt that it was an incredible endeavour and had their proverbial hats off to Blake Embrey.  But Definitely Typed had critical mass and, whilst it had known problems, they were problems that could be likely solved (or ameliorated) through automation.  The Typings approach was very innovative, but it presented other issues which seemed harder to solve.  The TypeScript team made a bet.  They placed their money on Definitely Typed.&lt;/p&gt;&lt;p&gt;To remove friction in the type acquisition space they decided to change the compiler.  It would now look out for a special scoped namespace on npm named @types.  Type definitions from Definitely Typed would be published out to @types.  They would land as type definition packages that matched the non @types package.  This meant that TypeScript was now sharing the same infrastructure as the rest of the JS ecosystem: npm.  And consequently, installation of a package like jQuery in a TypeScript workflow now looked like this: &lt;code&gt;npm install jquery @types/jquery&lt;/code&gt;.  One command, one tool, one registry.&lt;/p&gt;&lt;p&gt;They published their plans here: &lt;a href="https://github.com/Microsoft/TypeScript/issues/9184"&gt;https://github.com/Microsoft/TypeScript/issues/9184&lt;/a&gt;&lt;/p&gt;&lt;p&gt;There was more.  The TypeScript team had really enjoyed knowing that this open source project which ran completely independently from the TypeScript team existed.   And whilst they were focused directly on the language that was reasonable.  But with the changes that were being planned, TypeScript was about to start explicitly depending upon Definitely Typed.  It had been unofficially true up until that point.  But now it was different; TypeScript were going to automate publishing Definitely Typed packages to the special @types scope in npm which the TypeScript compiler gave preference to. TypeScript and Definitely Typed were going from dating to being engaged.&lt;/p&gt;&lt;p&gt;It was time for the TypeScript team to get involved.&lt;/p&gt;&lt;p&gt;The team committed to doing weekly rotations of a TypeScript team member working on Definitely Typed.  Reviewing PRs, merging them and, crucially, helping with automation and testing.&lt;/p&gt;&lt;p&gt;TypeScript was now part of Definitely Typed.  Definitely Typed was part of TypeScript.&lt;/p&gt;&lt;h4&gt;TypeScript 2.0 / Definitely Typed 2.0&lt;/h4&gt;&lt;p&gt;Blake was immensely disappointed. He'd put his heart and soul into Typings. It was a massive amount of work and he'd not only started a project, he'd started a community that he felt responsible for.&lt;/p&gt;&lt;p&gt;Although that work had arguably kickstarted the discussion of what the future of type acquisition in TypeScript should look like, Typings wouldn't be coming along for the ride. It was a burner rocket, carrying the good ship TypeScript into outer orbit, dropping back to Earth once it's job was done.&lt;/p&gt;&lt;p&gt;Very much, Blake had in mind all the people that had contributed to Typings. That all their work was going to be abandoned. He felt a sense of responsibility. It was both frustrating and heartbreaking.&lt;/p&gt;&lt;p&gt;When TypeScript 2.0 shipped, in the release announcement was the following statement: &lt;a href="https://devblogs.microsoft.com/typescript/announcing-typescript-2-0/"&gt;https://devblogs.microsoft.com/typescript/announcing-typescript-2-0/&lt;/a&gt;&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;Wed like to thank Blake Embrey for his work on Typings and helping us bring this solution forward.&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;Blake really appreciated the recognition. In years to come Blake would come to feel that the decisions made were the right ones. That they lead to TypeScripts continued success and served the community well. But he has regrets. He says now &amp;quot;I am disappointed we didn't get to integrate the two philosophies for managing types. It hurt Typings registry contributors without a story in place, I didnt want to let down and alienate potential contributors of type definitions.&amp;quot;&lt;/p&gt;&lt;p&gt;A young Australian man had helped change the direction of TypeScript. It was time for him to take a well earned rest.&lt;/p&gt;&lt;p&gt;In the meantime, the TypeScript team was starting to get stuck into the work of giving Definitely Typed a make-over.&lt;/p&gt; &lt;a href="https://3.bp.blogspot.com/--rEYhuJOjSw/XZuUpGM2eVI/AAAAAAAAR88/qXYMxPswi0cRXriaCx7nwlYCpMQdKHF1wCPcBGAYYCw/s1600/rotation.png" imageanchor="1" &gt;&lt;img border="0" src="https://3.bp.blogspot.com/--rEYhuJOjSw/XZuUpGM2eVI/AAAAAAAAR88/qXYMxPswi0cRXriaCx7nwlYCpMQdKHF1wCPcBGAYYCw/s1600/rotation.png" data-original-width="692" data-original-height="1260" /&gt;&lt;/a&gt; &lt;p&gt;At this point, Definitely Typed had more than 500 open pull requests. Most of which had been open for a very long time. The most urgent and pressing problem was getting that down. The TypeScript team committed to, in perpetuity, a weekly rotation where one team member would review PRs. This would, in future, mean that PRs were handled in a timely fashion and that the number of open PRs was generally kept beneath 100.&lt;/p&gt;&lt;p&gt;Alongside this, changes were being made to the TypeScript compiler. In large part these related to enabling automatic type acquisition through the @types scope. To make that work, the TypeScript team realised pretty quickly that many of the type definitions would not work as is. Ryan wrote up this report:&lt;/p&gt; &lt;a href="https://2.bp.blogspot.com/-VixlEWrjrg8/XZuVk6o1LmI/AAAAAAAAR9M/yNYln8kGI08eKe4Foh7D4Nx9wwQ_RYq2gCPcBGAYYCw/s1600/RyansDefTypReport.png" imageanchor="1" &gt;&lt;img border="0" src="https://2.bp.blogspot.com/-VixlEWrjrg8/XZuVk6o1LmI/AAAAAAAAR9M/yNYln8kGI08eKe4Foh7D4Nx9wwQ_RYq2gCPcBGAYYCw/s640/RyansDefTypReport.png" width="640" height="380" data-original-width="1177" data-original-height="699" /&gt;&lt;/a&gt; &lt;p&gt;At this point in time there were around 1700 type definitions. Pretty much all of them required some massaging. Roughly speaking, with TS 2.0, the language was going to move from a name based type acquisition approach to a file based one.  New features were added to TypeScript 2.0 such as the &lt;code&gt;export as namespace&lt;/code&gt; syntax to support a type definition supporting both being used in modules (where there are &lt;code&gt;import&lt;/code&gt; / &lt;code&gt;export&lt;/code&gt;s) but also in script files (where there aren't)&lt;/p&gt;&lt;p&gt;Ryan Cavanaugh put together scripts that migrated 1200 of the type definitions to TypeScript 2.0 syntax.  The remaining 500 were delicately transitioned by hand by diligent TypeScript team members. It was a task of utter drudgery that still sparks flickers of PTSD in those who were involved. It was like being in the digital equivalent of a Dickensian workhouse.&lt;/p&gt;&lt;p&gt;This was one of the reasons why going with the centralised approach of Definitely Typed instead of the decentralised one of Typings was necessary. Because the TypeScript team were involved in DT they could help make things happen. They could do the hard work. In a decentralised world that wouldn't be possible; everything would constantly be held up, waiting.&lt;/p&gt;&lt;p&gt;It took a long time to get the types 2.0 branch to a point where CI went green. All this time, merges we're taking place between the master branch and the future one. It was hard, unglamorous work. As Ryan put it, &amp;quot;I partied hard when CI went green for the first time on types 2.0.&amp;quot;&lt;/p&gt; &lt;a href="https://3.bp.blogspot.com/-8Y0e7jeMEgE/XZuWVTGTK9I/AAAAAAAAR9Q/VWVitGY2u6kgXRtYM4jJjgqyEstCANVlACLcBGAsYHQ/s1600/types20goinggreen.png" imageanchor="1" &gt;&lt;img border="0" src="https://3.bp.blogspot.com/-8Y0e7jeMEgE/XZuWVTGTK9I/AAAAAAAAR9Q/VWVitGY2u6kgXRtYM4jJjgqyEstCANVlACLcBGAsYHQ/s640/types20goinggreen.png" width="640" height="193" data-original-width="1195" data-original-height="361" /&gt;&lt;/a&gt; &lt;p&gt;The first and most obvious addition was the automation of TypeScript definitions being published out to npm.&lt;/p&gt;&lt;p&gt;Next came a solution for the &amp;quot;notification flood&amp;quot; issue. It was no longer feasible for a user to have Definitely Typed set up as &amp;quot;watching&amp;quot; in GitHub. That way lead an unstoppable deluge of information about issues and pull requests. The result of that was that users were generally unaware of changes / issues and so on. People, as much as they wanted to be, were becoming disconnected from the type definitions they were interested in in DT.&lt;/p&gt;&lt;p&gt;The solution for this problem was, as with so many problems, a bot. It would send notifications to the users who had historically worked on a type definition when someone sent a PR. This was hugely useful. It made it possible for people to become effective stewards of the type definitions they knew about. It meant people could effectively remain involved with DT; giving them targeted information. It was the solution to a communications problem.&lt;/p&gt;&lt;p&gt;As Ryan Cavanaugh put it when he looked back upon TypeScripts story, he had this to say:  Definitely Typed is the best thing that could exist from our perspective.&lt;/p&gt;&lt;p&gt;He was speaking from the perspective of a TypeScript team member.  He could as well be speaking for the developer world at large.  Definitely Typed is an organic monster of open source goodness; bringing types to the world thanks to nearly 10,000 contributors.  Each person of which has donated at least an hour or their time for the greater good.  Far more than that in many cases.  Its incredible.  Im glad I get to be part of it.  I never would have guessed it would have turned out like this.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2759212838967993268'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2759212838967993268'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2019/10/definitely-typed-movie.html' title='Definitely Typed: The Movie'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='https://3.bp.blogspot.com/-1xKIJvyRWWc/XZuLcK5E51I/AAAAAAAAR7M/jGCcWm1_mEAQmDUMhqGK0WOiZSg_ZFfhQCPcBGAYYCw/s72-c/boris_yankov.jpeg' height='72' width='72'/><georss:featurename>London, UK</georss:featurename><georss:point>51.5073509 -0.12775829999998223</georss:point><georss:box>51.1912379 -0.7732052999999822 51.8234639 0.5176887000000178</georss:box></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5285385686437926562</id><published>2019-09-30T19:33:00.000+01:00</published><updated>2019-10-01T06:00:34.270+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='.tsbuildinfo'/><category scheme='http://www.blogger.com/atom/ns#' term='TypeScript'/><title type='text'>Start Me Up: ts-loader meet .tsbuildinfo</title><content type='html'>&lt;p&gt;With TypeScript 3.4, &lt;a href="https://www.typescriptlang.org/docs/handbook/release-notes/typescript-3-4.html"&gt;a new behaviour landed and a magical new file type appeared; &lt;code&gt;.tsbuildinfo&lt;/code&gt;&lt;/a&gt;&lt;/p&gt; &lt;blockquote&gt;&lt;p&gt;TypeScript 3.4 introduces a new flag called &lt;code&gt;--incremental&lt;/code&gt; which tells TypeScript to save information about the project graph from the last compilation. The next time TypeScript is invoked with &lt;code&gt;--incremental&lt;/code&gt;, it will use that information to detect the least costly way to type-check and emit changes to your project.&lt;/p&gt;&lt;p&gt;...&lt;/p&gt;&lt;p&gt;These &lt;code&gt;.tsbuildinfo&lt;/code&gt; files can be safely deleted and dont have any impact on our code at runtime - theyre purely used to make compilations faster.&lt;/p&gt;&lt;/blockquote&gt; &lt;p&gt;This was all very exciting, but until the release of TypeScript 3.6 there were no APIs available to allow third party tools like &lt;code&gt;ts-loader&lt;/code&gt; to hook into them. The wait is over! Because with TypeScript 3.6 the APIs landed: &lt;a href="https://www.typescriptlang.org/docs/handbook/release-notes/typescript-3-6.html#apis-to-support---build-and---incremental"&gt;https://www.typescriptlang.org/docs/handbook/release-notes/typescript-3-6.html#apis-to-support---build-and---incremental&lt;/a&gt;&lt;/p&gt; &lt;p&gt;This was the handiwork of the very excellent &lt;a href="https://twitter.com/sheetalkamat"&gt;@sheetalkamat&lt;/a&gt; of the TypeScript team - you can see her PR here: &lt;a href="https://github.com/microsoft/TypeScript/pull/31432"&gt;https://github.com/microsoft/TypeScript/pull/31432&lt;/a&gt;&lt;/p&gt; &lt;p&gt;What's more, Sheetal took the PR for a test drive using &lt;code&gt;ts-loader&lt;/code&gt;, and her hard work has just shipped with &lt;code&gt;&lt;a href="https://github.com/TypeStrong/ts-loader/releases/tag/v6.2.0"&gt;v6.2.0&lt;/a&gt;&lt;/code&gt;:&lt;/p&gt; &lt;ul&gt;&lt;li&gt;&lt;a href="https://github.com/TypeStrong/ts-loader/pull/1012"&gt;https://github.com/TypeStrong/ts-loader/pull/1012&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="https://github.com/TypeStrong/ts-loader/pull/1017"&gt;https://github.com/TypeStrong/ts-loader/pull/1017&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt; &lt;p&gt;If you're a &lt;code&gt;ts-loader&lt;/code&gt; user, and you're using TypeScript 3.6+ then you can get the benefit of this now. That is, if you make use of the &lt;code&gt;experimentalWatchApi: true&lt;/code&gt; option. With this set:&lt;/p&gt; &lt;ol&gt;&lt;li&gt;&lt;p&gt;ts-loader will both emit and consume the &lt;code&gt;.tsbuildinfo&lt;/code&gt; artefact.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;This applies both when a project has &lt;code&gt;tsconfig.json&lt;/code&gt; options &lt;code&gt;composite&lt;/code&gt; or &lt;code&gt;incremental&lt;/code&gt; set to &lt;code&gt;true&lt;/code&gt;.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;The net result of people using this should be faster cold starts in build time where a previous compilation has taken place.&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt; &lt;h4&gt;&lt;code&gt;ts-loader v7.0.0&lt;/code&gt;&lt;/h4&gt; &lt;p&gt;We would love for you to take this new functionality for a spin. Partly because we think it will make your life better. And partly because we're planning to make using the watch API the default behaviour of &lt;code&gt;ts-loader&lt;/code&gt; when we come to ship &lt;code&gt;v7.0.0&lt;/code&gt;.&lt;/p&gt;&lt;p&gt;If you can take this for a spin before we make that change we'd be so grateful. Thanks so much to Sheetal for persevering away on this feature. It's amazing work and so very appreciated.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5285385686437926562'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5285385686437926562'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2019/09/start-me-up-ts-loader-meet-tsbuildinfo.html' title='Start Me Up: ts-loader meet .tsbuildinfo'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4097841638013117750</id><published>2019-09-14T09:17:00.000+01:00</published><updated>2019-09-14T09:17:09.729+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='TypeScript'/><category scheme='http://www.blogger.com/atom/ns#' term='Definitely Typed'/><title type='text'>Coming Soon: Definitely Typed</title><content type='html'>&lt;p&gt;A long time ago (well, 2012) in a galaxy far, far away (okay; Plovdiv, Bulgaria)....&lt;/p&gt;&lt;p&gt;&lt;a href="https://github.com/DefinitelyTyped/DefinitelyTyped"&gt;Definitely Typed&lt;/a&gt; began!&lt;/p&gt;&lt;p&gt;This is a project that set out to provide type definitions for every JavaScript library that lacked them.  An ambitious goal.  Have you ever wondered what the story that lay behind it was?&lt;/p&gt;&lt;p&gt;Perhaps you know that the project was started by a shadowy figure named &amp;quot;Boris Yankov&amp;quot;.  And maybe you know that the TypeScript team is now part of the Definitely Typed team. There's a lot more to tell.&lt;/p&gt;&lt;p&gt;This autumn, I'd like to tell you the story of how Definitely Typed came to be what it is.  From an individual commit in a repo that Boris created in 2012 to &lt;a href="https://octoverse.github.com/projects"&gt;the number 10 project by contributions on GitHub in 2018&lt;/a&gt;.  I'm part of that story.  Basarat Ali Syed is part of that story.  Masahi Wakame too.  Blake Embrey.  Steve Fenton.  Igor Oleinikov. It's an amazing and unexpected tale.  One that turns upon the actions of individuals. They changed your life and I'd love you to learn how.&lt;/p&gt;&lt;p&gt;So, coming soon to a blog post near you, is the story of Definitely Typed. It's very exciting!  Stay tuned...&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4097841638013117750'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4097841638013117750'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2019/09/coming-soon-definitely-typed.html' title='Coming Soon: Definitely Typed'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1764093309060862988</id><published>2019-08-17T22:42:00.001+01:00</published><updated>2021-03-14T05:39:37.514Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='TypeScript'/><category scheme='http://www.blogger.com/atom/ns#' term='react-testing-library'/><category scheme='http://www.blogger.com/atom/ns#' term='Definitely Typed'/><title type='text'>Symbiotic Definitely Typed</title><content type='html'>&lt;p&gt;I did ponder calling this post &amp;quot;how to enable a good TypeScript developer experience for npm modules that aren't written in TypeScript&amp;quot;... Not exactly pithy though.&lt;/p&gt;&lt;p&gt;Definitely Typed is the resource which allows developers to use TypeScript with existing JavaScript libraries that ship without their own type definitions.&lt;/p&gt;&lt;p&gt;DT began as a way to enable interop between JS and TS. When DT started, everything on npm was JavaScript. Over time it has become more common for libraries (eg &lt;a href="https://github.com/mobxjs/mobx"&gt;Mobx&lt;/a&gt; / &lt;a href="https://github.com/angular/angular"&gt;Angular&lt;/a&gt;) to be written (or rewritten) in TypeScript. For publishing, they are compiled down to JS with perfect type definitions generated from the TypeScript alongside the compiled JavaScript. These libraries do not need to exist in Definitely Typed anymore.&lt;/p&gt;&lt;p&gt;Another pattern that has emerged over time is that of type definitions being removed from Definitely Typed to live and be maintained alongside the libraries they support. An example of this is &lt;a href="https://github.com/moment/moment"&gt;MomentJS&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;This week, I think for the first time, there emerged another approach. &lt;a href="https://kentcdodds.com/"&gt;Kent C Dodds&lt;/a&gt;' &lt;code&gt;react-testing-library&lt;/code&gt; had started out with the MomentJS approach of hosting type definitions alongside the JavaScript source code. &lt;a href="https://github.com/testing-library/react-testing-library/pull/437"&gt;Alex Krolic raised a PR which proposed removing the type definitions from the RTL repo in favor of having the community maintain them at DefinitelyTyped.&lt;/a&gt;&lt;/p&gt;&lt;p&gt;I'll directly quote Kent's explanation of the motivation for this:&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;We were getting a lot of drive-by contributions to the TypeScript typings and many pull requests would either sit without being reviewed by someone who knows TypeScript well enough, or be merged by a maintainer who just hoped the contributor knew what they were doing. This resulted in a poor experience for TypeScript users who could experience type definition churn and delays, and it became a burden on project maintainers as well (most of us don't know TypeScript very well). Moving the type definitions to DefinitelyTyped puts the maintenance in much more capable hands.&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;I have to admit I was reticent about this idea in the first place. I like the idea that types ship with the package they support. It's a good developer experience; users install your package and it works with TypeScript straight out of the box. However Alex's PR addressed a real issue: what do you do when the authors of a package aren't interested / equipped / don't have the time to support TypeScript? Or don't want to deal with the noise of TypeScript related PRs which aren't relevant to them. What then?&lt;/p&gt;&lt;p&gt;Alex was saying, let's not force it. Let the types and the library be maintained separately. This can and is done well already; React is a case in point. The React team does not work on the type definitions for React, that's done (excellently) by a crew of dedicated React lovers in Definitely Typed.&lt;/p&gt;&lt;p&gt;It's a fair point. The thing that was sad about this move was that the developer experience was going to have more friction. Users would have to &lt;code&gt;yarn add -D @testing-library/react&lt;/code&gt; and then subsequently &lt;code&gt;yarn add -D @types/testing-library__react&lt;/code&gt; to get the types.&lt;/p&gt;&lt;p&gt;This two step process isn't the end of the world, but it does make it marginally harder for TypeScript users to get up and running. It reduces the developer joy. As a side note, this is made more unlovely by &lt;code&gt;@testing-library/react&lt;/code&gt; being a scoped package. &lt;a href="https://stackoverflow.com/questions/47296731/how-can-i-install-typescript-declarations-for-scoped-namespaced-packages-via-ty"&gt;Types for a scoped package have a quirky convention for publishing.&lt;/a&gt; A fictional scoped package of &lt;code&gt;@foo/bar&lt;/code&gt; would be published to npm as: &lt;code&gt;@types/foo__bar&lt;/code&gt;. This is functional but non-obvious; it's tricky to discover. A two step process instead of a one step process is a non-useful friction that it would be great to eliminate.&lt;/p&gt;&lt;p&gt;Fortunately, Kent and &lt;a href="https://github.com/FredyC"&gt;Daniel K&lt;/a&gt; had one of these moments:&lt;/p&gt; &lt;a href="https://4.bp.blogspot.com/-tmH5nbo_kGY/XG-8jmokKdI/AAAAAAAAN_U/umq24uPgdKAZgAlePU5teNs57i8RWOg7gCPcBGAYYCw/s1600/hang-on-lads-ive-got-a-great-idea.jpg" imageanchor="1" &gt;&lt;img border="0" src="https://4.bp.blogspot.com/-tmH5nbo_kGY/XG-8jmokKdI/AAAAAAAAN_U/umq24uPgdKAZgAlePU5teNs57i8RWOg7gCPcBGAYYCw/s640/hang-on-lads-ive-got-a-great-idea.jpg" width="640" height="271" data-original-width="915" data-original-height="387" /&gt;&lt;/a&gt; &lt;p&gt;Kent suggested that at the same time as dropping the type definitions that were shipped with the library, we try making &lt;code&gt;@types/testing-library__react&lt;/code&gt; a dependency of &lt;code&gt;@testing-library/react&lt;/code&gt;. This would mean that people installing &lt;code&gt;@testing-library/react&lt;/code&gt; would get &lt;code&gt;@types/testing-library__react&lt;/code&gt; installed &lt;em&gt;automatically&lt;/em&gt;. So from the developers point of view, it's as though the type definitions shipped with the package directly.&lt;/p&gt;&lt;p&gt;To cut a long story short reader, that's what happened. If you're using &lt;code&gt;@testing-library/react&lt;/code&gt; from 9.1.2 you're getting Definitely Typed under the covers. This was &lt;a href="https://github.com/testing-library/react-testing-library/pull/437#issuecomment-521763117"&gt;nicely illustrated by Kent&lt;/a&gt; showing what the TypeScript consumption experience looked like before the Definitely Typed switch:&lt;/p&gt; &lt;a href="https://1.bp.blogspot.com/-wJCLzg0uPuU/XVhqss-lXwI/AAAAAAAAQ48/SGCl9aEHGjUh1qE7OpyyY8MhqPkd2Rw4wCPcBGAYYCw/s1600/RTL-9.1.1.png" imageanchor="1" &gt;&lt;img border="0" src="https://1.bp.blogspot.com/-wJCLzg0uPuU/XVhqss-lXwI/AAAAAAAAQ48/SGCl9aEHGjUh1qE7OpyyY8MhqPkd2Rw4wCPcBGAYYCw/s640/RTL-9.1.1.png" width="640" height="385" data-original-width="1600" data-original-height="963" /&gt;&lt;/a&gt; &lt;p&gt;And here's what it looked like after:&lt;/p&gt; &lt;a href="https://4.bp.blogspot.com/-jeTQeQnKpVY/XVhrvq8D-0I/AAAAAAAAQ5E/tOieujozFZQ_pttgStAAj_zQwtpGl1AsgCLcBGAs/s1600/RTL-9.1.2.png" imageanchor="1" &gt;&lt;img border="0" src="https://4.bp.blogspot.com/-jeTQeQnKpVY/XVhrvq8D-0I/AAAAAAAAQ5E/tOieujozFZQ_pttgStAAj_zQwtpGl1AsgCLcBGAs/s640/RTL-9.1.2.png" width="640" height="403" data-original-width="1600" data-original-height="1008" /&gt;&lt;/a&gt; &lt;p&gt;Identical! i.e it worked. I grant you this is one of the more boring before / after comparisons there is But hopefully you can see it demonstrates that this is giving us exactly what we need.&lt;/p&gt; &lt;p&gt;To quote Kent once more:&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;By adding the type definitions to the dependencies of React Testing Library, the experience for users is completely unchanged. So it's a huge improvement for the maintenance of the type definitions without any breaking changes for the users of those definitions.&lt;/p&gt;&lt;/blockquote&gt; &lt;p&gt;This is clearly an approach that's useful; it adds value. It would be tremendous to see other libraries that aren't written in TypeScript but would like to enable a good TypeScript experience for those people that do use TS also adopting this approach.&lt;/p&gt; &lt;h4&gt;Update: Use a Loose Version Range in &lt;code&gt;package.json&lt;/code&gt;&lt;/h4&gt; &lt;p&gt;When I &lt;a href="https://twitter.com/johnny_reilly/status/1162843916661592064"&gt;tweeted this article&lt;/a&gt; it prompted this helpful response from &lt;a href="https://twitter.com/atcb"&gt;Andrew Branch&lt;/a&gt; of the TypeScript team:&lt;/p&gt; &lt;blockquote class="twitter-tweet"&gt;&lt;p lang="en" dir="ltr"&gt;&amp;gt; use a loose version range&lt;br&gt;&lt;br&gt;This is my advice as well and should probably be mentioned in the article TBH.&lt;/p&gt;&amp;mdash; Kent C. Dodds (@kentcdodds) &lt;a href="https://twitter.com/kentcdodds/status/1162876792287293440?ref_src=twsrc%5Etfw"&gt;August 18, 2019&lt;/a&gt;&lt;/blockquote&gt; &lt;script async src="https://platform.twitter.com/widgets.js" charset="utf-8"&gt;&lt;/script&gt; &lt;p&gt;Andrew makes the useful point that if you are adding support for TypeScript via an &lt;code&gt;@types/...&lt;/code&gt; dependency then it's wise to do so with a loose version range. &lt;a href="https://github.com/testing-library/react-testing-library/blob/c4ba755e42938018ec67dbc716037cfafca15e03/package.json#L46"&gt;In the case of RTL we did it like this:&lt;/a&gt;&lt;/p&gt; &lt;pre class="prettyprint json"&gt;&lt;br /&gt;&lt;code class="language-json"&gt;&lt;br /&gt;    "@types/testing-library__react": "^9.1.0"&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;i.e. Any type definition with a version of &lt;code&gt;9.1&lt;/code&gt; or greater (whilst still lower than &lt;code&gt;10.0.0&lt;/code&gt;) is considered valid. You could go even looser than that.  If you really don't want to think about TypeScript beyond adding the dependency then a completely loose version range would do:&lt;/p&gt; &lt;pre class="prettyprint json"&gt;&lt;br /&gt;&lt;code class="language-json"&gt;&lt;br /&gt;    "@types/testing-library__react": "*"&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;This will always install the latest version of the &lt;code&gt;@types/testing-library__react&lt;/code&gt; dependency and (importantly) allow users to override if there's a problematic &lt;code&gt;@types/testing-library__react&lt;/code&gt; out there. This level of looseness is not really advised though. As in the scenario when a library (and associated type definitions) do a major release, users of the old major would get the wrong definitions by default when installing or upgrading (in range).&lt;/p&gt; &lt;p&gt;Probably the most helpful approach is the approach followed by RTL; fixing the major version but allowing all minor and patch releases &lt;em&gt;inside&lt;/em&gt; a major version.&lt;/p&gt; &lt;h4&gt;Update 2: Further Discussions!&lt;/h4&gt; &lt;p&gt;The technique used in this blog post sparked an interesting conversation with members of the TypeScript team when it was applied to &lt;code&gt;&lt;a href="https://github.com/testing-library/jest-dom"&gt;https://github.com/testing-library/jest-dom&lt;/a&gt;&lt;/code&gt;.  &lt;a href="https://github.com/testing-library/jest-dom/issues/123#issuecomment-523586977"&gt;The conversation can be read here&lt;/a&gt;.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1764093309060862988'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1764093309060862988'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2019/08/symbiotic-definitely-typed.html' title='Symbiotic Definitely Typed'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='https://4.bp.blogspot.com/-tmH5nbo_kGY/XG-8jmokKdI/AAAAAAAAN_U/umq24uPgdKAZgAlePU5teNs57i8RWOg7gCPcBGAYYCw/s72-c/hang-on-lads-ive-got-a-great-idea.jpg' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8836035001694059761</id><published>2019-08-02T06:00:00.000+01:00</published><updated>2019-08-02T09:21:13.409+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='ASP.Net Core'/><category scheme='http://www.blogger.com/atom/ns#' term='Authentication'/><title type='text'>Hard-coding a Claim in Development Mode in ASP.Net Core</title><content type='html'>&lt;p&gt;I was recently part of a hackathon team that put together an API in just 30 hours.  We came second.  (Not bitter, not bitter...)&lt;/p&gt;&lt;p&gt;We were moving pretty quickly during the hackathon and, when we came to the end of it, we had a working API which we were able to demo.  The good news is that the API is going to graduate to be a product!  We're going to ship this.  Before we can do that though, there's a little tidy up to do.&lt;/p&gt;&lt;p&gt;The first thing I remembered / realised when I picked up the codebase again, was the shortcuts we'd made on the developer experience.  We'd put the API together using ASP.Net Core.  We're handling authentication using JWTs which is nicely supported.  When we're deployed, an external facing proxy calls our application with the appropriate JWT and everything works as you'd hope.&lt;/p&gt;&lt;p&gt;The question is, what's it like to develop against this on your laptop? Getting a JWT for when I'm debugging locally is too much friction. I want to be able to work on the problem at hand, going away to get a JWT each time is a timesuck.  So what to do?  Well, during the hackathon, we just commented out &lt;code&gt;[Authorize]&lt;/code&gt; attributes and hardcoded user ids in our controllers.  This works, but it's a messy developer experience; it's easy to forget to uncomment things you've commented and break things.  There must be a better way.&lt;/p&gt;&lt;p&gt;The solution I landed on was this: in development mode (which we only use whilst debugging) we hardcode an authenticated user.  The way our authentication works is that we have a claim on our principal called something like &lt;code&gt;&amp;quot;our-user-id&amp;quot;&lt;/code&gt;, the value of which is our authenticated user id.  So in the &lt;code&gt;ConfigureServices&lt;/code&gt; method of our &lt;code&gt;Startup.cs&lt;/code&gt; we have a conditional authentication registration like this:&lt;/p&gt;&lt;pre class="prettyprint cs"&gt;&lt;code class="language-cs"&gt;// Whilst developing, we don't want to authenticate; we hardcode to a particular users id&lt;br /&gt;if (Env.IsDevelopment()) {&lt;br /&gt;    services.AddAuthentication(nameof(DevelopmentModeAuthenticationHandler))&lt;br /&gt;        .AddScheme&amp;lt;DevelopmentModeAuthenticationOptions, DevelopmentModeAuthenticationHandler&amp;gt;(&lt;br /&gt;            nameof(DevelopmentModeAuthenticationHandler), &lt;br /&gt;            options =&amp;gt; {&lt;br /&gt;                options.UserIdToSetInClaims = &amp;quot;this-is-a-user-id&amp;quot;; &lt;br /&gt;            }&lt;br /&gt;        );&lt;br /&gt;}&lt;br /&gt;else {&lt;br /&gt;    // The application typically uses this&lt;br /&gt;    services.AddAuthentication(JwtBearerDefaults.AuthenticationScheme)&lt;br /&gt;        .AddJwtBearer(options =&amp;gt; {&lt;br /&gt;            // ...&lt;br /&gt;        });&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;As you can see, we're using a special &lt;code&gt;DevelopmentModeAuthenticationHandler&lt;/code&gt; authentication scheme in development mode, instead of JWT.  As we register that, we declare the user id that we want to use.  Whenever the app runs using the &lt;code&gt;DevelopmentModeAuthenticationHandler&lt;/code&gt; auth, all requests will arrive using a principal with an &lt;code&gt;&amp;quot;our-user-id&amp;quot;&lt;/code&gt; claim with a value of &lt;code&gt;&amp;quot;this-is-a-user-id&amp;quot;&lt;/code&gt; (or whatever you've set it to.)&lt;/p&gt;&lt;p&gt;The &lt;code&gt;DevelopmentModeAuthenticationHandler&lt;/code&gt; looks like this:&lt;/p&gt;&lt;pre class="prettyprint cs"&gt;&lt;code class="language-cs"&gt;using System.Collections.Generic;&lt;br /&gt;using System.Security.Claims;&lt;br /&gt;using System.Text.Encodings.Web;&lt;br /&gt;using System.Threading.Tasks;&lt;br /&gt;using Microsoft.AspNetCore.Authentication;&lt;br /&gt;using Microsoft.Extensions.Logging;&lt;br /&gt;using Microsoft.Extensions.Options;&lt;br /&gt;&lt;br /&gt;namespace OurApp&lt;br /&gt;{&lt;br /&gt;    public class DevelopmentModeAuthenticationOptions : AuthenticationSchemeOptions &lt;br /&gt;    {&lt;br /&gt;        public string UserIdToSetInClaims { get; set; }&lt;br /&gt;    }&lt;br /&gt;&lt;br /&gt;    public class DevelopmentModeAuthenticationHandler : AuthenticationHandler&amp;lt;DevelopmentModeAuthenticationOptions&amp;gt; {&lt;br /&gt;        private readonly ILoggingService _loggingService;&lt;br /&gt;&lt;br /&gt;        public DevelopmentModeAuthenticationHandler(&lt;br /&gt;            IOptionsMonitor&amp;lt;DevelopmentModeAuthenticationOptions&amp;gt; options,&lt;br /&gt;            ILoggerFactory logger,&lt;br /&gt;            UrlEncoder encoder,&lt;br /&gt;            ISystemClock clock&lt;br /&gt;        ) : base(options, logger, encoder, clock) {&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        protected override Task&amp;lt;AuthenticateResult&amp;gt; HandleAuthenticateAsync() {&lt;br /&gt;            var claims = new List&amp;lt;Claim&amp;gt; { new Claim(&amp;quot;our-user-id&amp;quot;, Options.UserIdToSetInClaims) };&lt;br /&gt;&lt;br /&gt;            var identity = new ClaimsIdentity(claims, nameof(DevelopmentModeAuthenticationHandler));&lt;br /&gt;            var ticket = new AuthenticationTicket(new ClaimsPrincipal(identity), Scheme.Name);&lt;br /&gt;            &lt;br /&gt;            return Task.FromResult(AuthenticateResult.Success(ticket));&lt;br /&gt;        }&lt;br /&gt;    }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Now, developing locally is frictionless!  We don't comment out &lt;code&gt;[Authorize]&lt;/code&gt; attributes, we don't hard code user ids in controllers.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8836035001694059761'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8836035001694059761'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2019/08/hard-coding-claim-in-development-mode.html' title='Hard-coding a Claim in Development Mode in ASP.Net Core'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4337992831157470290</id><published>2019-07-13T07:20:00.000+01:00</published><updated>2019-07-15T20:41:18.988+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='ESLint'/><category scheme='http://www.blogger.com/atom/ns#' term='TypeScript'/><category scheme='http://www.blogger.com/atom/ns#' term='fork-ts-checker-webpack-plugin'/><category scheme='http://www.blogger.com/atom/ns#' term='Webpack'/><title type='text'>Using TypeScript and ESLint with webpack (fork-ts-checker-webpack-plugin new feature!)</title><content type='html'>&lt;p&gt;The &lt;code&gt;fork-ts-checker-webpack-plugin&lt;/code&gt; has, since its inception, performed two classes of checking:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;Compilation errors which the TypeScript compiler surfaces up&lt;/li&gt;&lt;li&gt;Linting issues which TSLint reports&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;&lt;a href="https://eslint.org/blog/2019/01/future-typescript-eslint"&gt;You may have caught the announcement that TSLint is being deprecated and ESLint is the future of linting in the TypeScript world.&lt;/a&gt;  This plainly has a bearing on linting in &lt;code&gt;fork-ts-checker-webpack-plugin&lt;/code&gt;.&lt;/p&gt;&lt;p&gt;&lt;a href="https://github.com/TypeStrong/fork-ts-checker-webpack-plugin/pull/305"&gt;I've been beavering away at adding support for ESLint to the fork-ts-checker-webpack-plugin.&lt;/a&gt;  I'm happy to say, the plugin now supports ESLint. Do you want to get your arms all around ESLint with &lt;code&gt;fork-ts-checker-webpack-plugin&lt;/code&gt;? Read on!&lt;/p&gt;&lt;h4&gt;How do you migrate from TSLint to ESLint?&lt;/h4&gt;&lt;p&gt;Well, first of all you need the latest and greatest &lt;code&gt;fork-ts-checker-webpack-plugin&lt;/code&gt;. Support for ESLint shipped with &lt;a href="https://github.com/TypeStrong/fork-ts-checker-webpack-plugin/releases/tag/v1.4.0"&gt;v1.4.0&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;You need to change the options you supply to the plugin in your &lt;code&gt;webpack.config.js&lt;/code&gt; to look something like this:&lt;/p&gt;&lt;p&gt;&lt;pre class="prettyprint"&gt;&lt;code class="language-js"&gt;new ForkTsCheckerWebpackPlugin({ eslint: true })&lt;/code&gt;&lt;/pre&gt;&lt;/p&gt;&lt;p&gt;You'll also need the various ESLint related packages to your &lt;code&gt;package.json&lt;/code&gt;:&lt;/p&gt;&lt;p&gt;&lt;pre class="prettyprint"&gt;&lt;code class="language-js"&gt;yarn add eslint @typescript-eslint/parser @typescript-eslint/eslint-plugin --dev&lt;/code&gt;&lt;/pre&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;code&gt;eslint&lt;/code&gt;&lt;/li&gt;&lt;li&gt;&lt;code&gt;@typescript-eslint/parser&lt;/code&gt;: The parser that will allow ESLint to lint TypeScript code&lt;/li&gt;&lt;li&gt;&lt;code&gt;@typescript-eslint/eslint-plugin&lt;/code&gt;: A plugin that contains ESLint rules that are TypeScript specific&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;If you want, you can pass options to ESLint using the &lt;code&gt;eslintOptions&lt;/code&gt; option as well. These will be passed through to the underlying ESLint CLI Engine when it is instantiated. Docs on the supported options are &lt;a href="https://eslint.org/docs/developer-guide/nodejs-api#cliengine"&gt;documented here&lt;/a&gt;.&lt;/p&gt;&lt;h4&gt;Go Configure&lt;/h4&gt;&lt;p&gt;Now you're ready to use ESLint, you just need to give it some configuration. Typically, an &lt;code&gt;.eslintrc.js&lt;/code&gt; is what you want here.&lt;/p&gt;&lt;pre class="prettyprint"&gt;&lt;code class="language-js"&gt;const path = require('path');&lt;br /&gt;module.exports = {&lt;br /&gt;    parser: '@typescript-eslint/parser', // Specifies the ESLint parser&lt;br /&gt;    plugins: [&lt;br /&gt;        '@typescript-eslint',&lt;br /&gt;    ],&lt;br /&gt;    env: {&lt;br /&gt;        browser: true,&lt;br /&gt;        jest: true&lt;br /&gt;    },&lt;br /&gt;    extends: [&lt;br /&gt;        'plugin:@typescript-eslint/recommended', // Uses the recommended rules from the @typescript-eslint/eslint-plugin&lt;br /&gt;    ],&lt;br /&gt;    parserOptions: {&lt;br /&gt;        project: path.resolve(__dirname, './tsconfig.json'),&lt;br /&gt;        tsconfigRootDir: __dirname,&lt;br /&gt;        ecmaVersion: 2018, // Allows for the parsing of modern ECMAScript features&lt;br /&gt;        sourceType: 'module', // Allows for the use of imports&lt;br /&gt;    },&lt;br /&gt;    rules: {&lt;br /&gt;        // Place to specify ESLint rules. Can be used to overwrite rules specified from the extended configs&lt;br /&gt;        // e.g. &amp;quot;@typescript-eslint/explicit-function-return-type&amp;quot;: &amp;quot;off&amp;quot;,&lt;br /&gt;        '@typescript-eslint/explicit-function-return-type': 'off',&lt;br /&gt;        '@typescript-eslint/no-unused-vars': 'off',&lt;br /&gt;    },&lt;br /&gt;};&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;If you're a React person (and I am!) then you'll also need: &lt;code&gt;yarn add eslint-plugin-react&lt;/code&gt;. Then enrich your &lt;code&gt;eslintrc.js&lt;/code&gt; a little:&lt;/p&gt;&lt;pre class="prettyprint"&gt;&lt;code class="language-js"&gt;const path = require('path');&lt;br /&gt;module.exports = {&lt;br /&gt;    parser: '@typescript-eslint/parser', // Specifies the ESLint parser&lt;br /&gt;    plugins: [&lt;br /&gt;        '@typescript-eslint',&lt;br /&gt;        'react'&lt;br /&gt;        // 'prettier' commented as we don't want to run prettier through eslint because performance&lt;br /&gt;    ],&lt;br /&gt;    env: {&lt;br /&gt;        browser: true,&lt;br /&gt;        jest: true&lt;br /&gt;    },&lt;br /&gt;    extends: [&lt;br /&gt;        'plugin:@typescript-eslint/recommended', // Uses the recommended rules from the @typescript-eslint/eslint-plugin&lt;br /&gt;        'prettier/@typescript-eslint', // Uses eslint-config-prettier to disable ESLint rules from @typescript-eslint/eslint-plugin that would conflict with prettier&lt;br /&gt;        // 'plugin:react/recommended', // Uses the recommended rules from @eslint-plugin-react&lt;br /&gt;        'prettier/react', // disables react-specific linting rules that conflict with prettier&lt;br /&gt;        // 'plugin:prettier/recommended' // Enables eslint-plugin-prettier and displays prettier errors as ESLint errors. Make sure this is always the last configuration in the extends array.&lt;br /&gt;    ],&lt;br /&gt;    parserOptions: {&lt;br /&gt;        project: path.resolve(__dirname, './tsconfig.json'),&lt;br /&gt;        tsconfigRootDir: __dirname,&lt;br /&gt;        ecmaVersion: 2018, // Allows for the parsing of modern ECMAScript features&lt;br /&gt;        sourceType: 'module', // Allows for the use of imports&lt;br /&gt;        ecmaFeatures: {&lt;br /&gt;            jsx: true // Allows for the parsing of JSX&lt;br /&gt;        }&lt;br /&gt;    },&lt;br /&gt;    rules: {&lt;br /&gt;        // Place to specify ESLint rules. Can be used to overwrite rules specified from the extended configs&lt;br /&gt;        // e.g. &amp;quot;@typescript-eslint/explicit-function-return-type&amp;quot;: &amp;quot;off&amp;quot;,&lt;br /&gt;        '@typescript-eslint/explicit-function-return-type': 'off',&lt;br /&gt;        '@typescript-eslint/no-unused-vars': 'off',&lt;br /&gt;&lt;br /&gt;        // These rules don't add much value, are better covered by TypeScript and good definition files&lt;br /&gt;        'react/no-direct-mutation-state': 'off',&lt;br /&gt;        'react/no-deprecated': 'off',&lt;br /&gt;        'react/no-string-refs': 'off',&lt;br /&gt;        'react/require-render-return': 'off',&lt;br /&gt;&lt;br /&gt;        'react/jsx-filename-extension': [&lt;br /&gt;            'warn',&lt;br /&gt;            {&lt;br /&gt;                extensions: ['.jsx', '.tsx']&lt;br /&gt;            }&lt;br /&gt;        ], // also want to use with &amp;quot;.tsx&amp;quot;&lt;br /&gt;        'react/prop-types': 'off' // Is this incompatible with TS props type?&lt;br /&gt;    },&lt;br /&gt;    settings: {&lt;br /&gt;        react: {&lt;br /&gt;            version: 'detect' // Tells eslint-plugin-react to automatically detect the version of React to use&lt;br /&gt;        }&lt;br /&gt;    }&lt;br /&gt;};&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;You can add Prettier into the mix too.  You can see how it is used in the above code sample. But given the impact that has on performance I wouldn't recommend it; hence it's commented out.  &lt;a href="https://dev.to/robertcoopercode/using-eslint-and-prettier-in-a-typescript-project-53jb"&gt;There's a good piece by Rob Cooper's for more details on setting up Prettier and VS Code with TypeScript and ESLint.&lt;/a&gt;&lt;/p&gt;&lt;h4&gt;Performance and Power Tools&lt;/h4&gt;&lt;p&gt;It's worth noting that support for TypeScript in ESLint is still brand new. As such, the rule of "Make it Work, Make it Right, Make it Fast" applies.... ESLint with TypeScript still has some performance issues which should be ironed out in the fullness of time.  You can &lt;a href="https://github.com/typescript-eslint/typescript-eslint/issues/389"&gt;track them here&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;This is important to bear in mind as, when I converted a large codebase over to using ESLint, I discovered that initial performance of linting was terribly slow.  Something that's worth doing right now is identifying which rules are costing you most timewise and tweaking based on whether you think they're earning their keep.&lt;/p&gt;&lt;p&gt;The &lt;a href="https://eslint.org/docs/developer-guide/working-with-rules#per-rule-performance"&gt;&lt;code&gt;TIMING&lt;/code&gt; environment variable&lt;/a&gt; can be used to provide a report on the relative cost performance wise of running each rule.  A nice way to plug this into your workflow is to add the &lt;code&gt;cross-env&lt;/code&gt; package to your project: &lt;code&gt;yarn add cross-env -D&lt;/code&gt; and then add 2 scripts to your &lt;code&gt;package.json&lt;/code&gt;:&lt;/p&gt;&lt;pre class="prettyprint"&gt;&lt;code&gt;&amp;quot;lint&amp;quot;: &amp;quot;eslint ./&amp;quot;, &lt;br /&gt;&amp;quot;lint-rule-timings&amp;quot;: &amp;quot;cross-env TIMING=1 yarn lint&amp;quot;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;&lt;li&gt;&lt;code&gt;lint&lt;/code&gt; - just runs the linter standalone&lt;/li&gt;&lt;li&gt;&lt;code&gt;lint-rule-timings&lt;/code&gt; - does the same but with the &lt;code&gt;TIMING&lt;/code&gt; environment variable set to 1 so a report will be generated.&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;I'd advise, making use of &lt;code&gt;lint-rule-timings&lt;/code&gt; to identify which rules are costing you performance and then turning &lt;code&gt;off&lt;/code&gt; rules as you need to.  Remember, different rules have different value.&lt;/p&gt;&lt;p&gt;&lt;a href="https://github.com/TypeStrong/ts-loader/pull/960"&gt;Finally, if you'd like to see how it's done, here's an example of porting from TSLint to ESLint.&lt;/a&gt;&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4337992831157470290'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4337992831157470290'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2019/07/typescript-and-eslint-meet-fork-ts-checker-webpack-plugin.html' title='Using TypeScript and ESLint with webpack (fork-ts-checker-webpack-plugin new feature!)'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-139190519228738416</id><published>2019-06-07T07:19:00.004+01:00</published><updated>2021-03-03T21:47:10.501Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='TypeScript'/><category scheme='http://www.blogger.com/atom/ns#' term='yarn'/><category scheme='http://www.blogger.com/atom/ns#' term='Webpack'/><category scheme='http://www.blogger.com/atom/ns#' term='PnP'/><title type='text'>TypeScript / webpack - you down with PnP? Yarn, you know me!</title><content type='html'>&lt;p&gt;Yarn PnP is an innovation by the Yarn team designed to speed up module resolution by node. To quote the &lt;a href="https://yarnpkg.com/en/docs/pnp"&gt;(excellent) docs&lt;/a&gt;:&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;PlugnPlay is an alternative installation strategy unveiled in September 2018...&lt;/p&gt;&lt;p&gt;The way regular installs work is simple: Yarn generates a &lt;code&gt;node_modules&lt;/code&gt; directory that Node is then able to consume. In this context, Node doesnt know the first thing about what a package is: it only reasons in terms of files. Does this file exist here? No? Lets look in the parent &lt;code&gt;node_modules&lt;/code&gt; then. Does it exist here? Still no? Too bad parent folder it is! - and it does this until it matches something that matches one of the possibilities. Thats vastly inefficient.&lt;/p&gt;&lt;p&gt;When you think about it, Yarn knows everything about your dependency tree - it evens installs it! So why is Node tasked with locating your packages on the disk? Why dont we simply query Yarn, and let it tell us where to look for a package X required by a package Y? Thats what PlugnPlay (abbreviated PnP) is. Instead of generating a node_modules directory and leaving the resolution to Node, we now generate a single .pnp.js file and let Yarn tell us where to find our packages.&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;Yarn has been worked upon, amongst others, by the excellent &lt;a href="https://twitter.com/arcanis"&gt;Mal Nison&lt;/a&gt;. You can hear him talking about it in person &lt;a href="https://youtu.be/XePfzVs852s"&gt;in this talk at JSConfEU&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;Thanks particularly to Mal's work, it's possible to use Yarn PnP with TypeScript using webpack with &lt;code&gt;ts-loader&lt;/code&gt; &lt;em&gt;and&lt;/em&gt; &lt;code&gt;fork-ts-checker-webpack-plugin&lt;/code&gt;. This post intends to show you just how simple it is to convert a project that uses either to work with Yarn PnP.&lt;/p&gt;&lt;h4&gt;Vanilla &lt;code&gt;ts-loader&lt;/code&gt;&lt;/h4&gt;&lt;p&gt;Your project is built using standalone &lt;code&gt;ts-loader&lt;/code&gt;; i.e. a simple setup that handles both transpilation and type checking.&lt;/p&gt;&lt;p&gt;First things first, add this property to your &lt;code&gt;package.json&lt;/code&gt;: (this is only required if you are using Yarn 1; this tag will be optional starting from the v2, where projects will switch to PnP by default.)&lt;/p&gt;&lt;pre class="prettyprint json"&gt;&lt;code&gt;{&lt;br /&gt;    &amp;quot;installConfig&amp;quot;: {&lt;br /&gt;        &amp;quot;pnp&amp;quot;: true &lt;br /&gt;    }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Also, because this is webpack, we're going to need to add an extra dependency in the form of &lt;code&gt;pnp-webpack-plugin&lt;/code&gt;:&lt;/p&gt;&lt;pre class="prettyprint shell"&gt;&lt;code&gt;yarn add -D pnp-webpack-plugin&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;To quote the excellent docs, make the following amends to your &lt;code&gt;webpack.config.js&lt;/code&gt;:&lt;/p&gt;&lt;pre class="prettyprint js"&gt;&lt;code&gt;const PnpWebpackPlugin = require(`pnp-webpack-plugin`);&lt;br /&gt;&lt;br /&gt;module.exports = { &lt;br /&gt;    module: { &lt;br /&gt;        rules: [{ &lt;br /&gt;            test: /\.ts$/, &lt;br /&gt;            loader: require.resolve('ts-loader'), &lt;br /&gt;            options: PnpWebpackPlugin.tsLoaderOptions(), &lt;br /&gt;        }], &lt;br /&gt;    },&lt;br /&gt;    resolve: { &lt;br /&gt;        plugins: [ PnpWebpackPlugin, ], &lt;br /&gt;    },&lt;br /&gt;    resolveLoader: { &lt;br /&gt;        plugins: [ PnpWebpackPlugin.moduleLoader(module), ],&lt;br /&gt;    },&lt;br /&gt;};&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;If you have any options you want to pass to &lt;code&gt;ts-loader&lt;/code&gt;, just pass them as parameter of &lt;code&gt;pnp-webpack-plugin&lt;/code&gt;'s &lt;code&gt;tsLoaderOptions&lt;/code&gt; function and it will take care of forwarding them properly.  Behind the scenes the &lt;code&gt;tsLoaderOptions&lt;/code&gt; function is providing &lt;code&gt;ts-loader&lt;/code&gt; with the options necessary to switch into Yarn PnP mode.&lt;/p&gt;&lt;p&gt;Congratulations; you now have &lt;code&gt;ts-loader&lt;/code&gt; functioning with Yarn PnP support!&lt;/p&gt;&lt;h4&gt;&lt;code&gt;fork-ts-checker-webpack-plugin&lt;/code&gt; with &lt;code&gt;ts-loader&lt;/code&gt;&lt;/h4&gt;&lt;p&gt;You may well be using &lt;code&gt;fork-ts-checker-webpack-plugin&lt;/code&gt; to handle type checking whilst &lt;code&gt;ts-loader&lt;/code&gt; gets on with the transpilation. This workflow is also supported using &lt;code&gt;pnp-webpack-plugin&lt;/code&gt;. You'll have needed to follow the same steps as the &lt;code&gt;ts-loader&lt;/code&gt; setup. It's just the &lt;code&gt;webpack.config.js&lt;/code&gt; tweaks that will be different.&lt;/p&gt;&lt;pre class="prettyprint js"&gt;&lt;code&gt;const PnpWebpackPlugin = require(`pnp-webpack-plugin`);&lt;br /&gt;&lt;br /&gt;module.exports = { &lt;br /&gt;    plugins: {&lt;br /&gt;        new ForkTsCheckerWebpackPlugin(PnpWebpackPlugin.forkTsCheckerOptions({&lt;br /&gt;            useTypescriptIncrementalApi: false, // not possible to use this until: https://github.com/microsoft/TypeScript/issues/31056&lt;br /&gt;        })),&lt;br /&gt;    }&lt;br /&gt;    module: { &lt;br /&gt;        rules: [{ &lt;br /&gt;            test: /\.ts$/, &lt;br /&gt;            loader: require.resolve('ts-loader'), &lt;br /&gt;            options: PnpWebpackPlugin.tsLoaderOptions({ transpileOnly: true }), &lt;br /&gt;        }], &lt;br /&gt;    },&lt;br /&gt;    resolve: { &lt;br /&gt;        plugins: [ PnpWebpackPlugin, ], &lt;br /&gt;    },&lt;br /&gt;    resolveLoader: { &lt;br /&gt;        plugins: [ PnpWebpackPlugin.moduleLoader(module), ],&lt;br /&gt;    },&lt;br /&gt;};&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Again if you have any options you want to pass to &lt;code&gt;ts-loader&lt;/code&gt;, just pass them as parameter of &lt;code&gt;pnp-webpack-plugin&lt;/code&gt;'s &lt;code&gt;tsLoaderOptions&lt;/code&gt; function.  As we're using &lt;code&gt;fork-ts-checker-webpack-plugin&lt;/code&gt; we're going to want to stop &lt;code&gt;ts-loader&lt;/code&gt; doing type checking with the &lt;code&gt;transpileOnly: true&lt;/code&gt; option.&lt;/p&gt;&lt;p&gt;We're now initialising &lt;code&gt;fork-ts-checker-webpack-plugin&lt;/code&gt; with &lt;code&gt;pnp-webpack-plugin&lt;/code&gt;'s &lt;code&gt;forkTsCheckerOptions&lt;/code&gt; function. Behind the scenes the &lt;code&gt;forkTsCheckerOptions&lt;/code&gt; function is providing the &lt;code&gt;fork-ts-checker-webpack-plugin&lt;/code&gt; with the options necessary to switch into Yarn PnP mode.&lt;/p&gt;&lt;p&gt;And that's it! You now have &lt;code&gt;ts-loader&lt;/code&gt; and &lt;code&gt;fork-ts-checker-webpack-plugin&lt;/code&gt; functioning with Yarn PnP support!&lt;/p&gt; &lt;h4&gt;Living on the Bleeding Edge&lt;/h4&gt;&lt;p&gt;Whilst you can happily develop and build using Yarn PnP, it's worth bearing in mind that this is a new approach. As such, there's some rough edges right now.&lt;/p&gt; &lt;p&gt;If you're interested in Yarn PnP, it's worth taking the v2 of Yarn (Berry) for a spin.  You can find it here: &lt;a href="https://github.com/yarnpkg/berry"&gt;https://github.com/yarnpkg/berry&lt;/a&gt;. It's where most of the Yarn PnP work happens, and it includes zip loading - two birds, one stone!&lt;/p&gt; &lt;p&gt;Because there isn't first class support for Yarn PnP in TypeScript itself yet, you cannot make use of the Watch API through &lt;code&gt;fork-ts-checker-webpack-plugin&lt;/code&gt;. (You can read about that issue &lt;a href="https://github.com/microsoft/TypeScript/issues/31056"&gt;here&lt;/a&gt;)&lt;/p&gt; &lt;p&gt;As you've likely noticed, the webpack configuration required makes for a noisy &lt;code&gt;webpack.config.js&lt;/code&gt;. Further to that, VS Code (which is powered by TypeScript remember) has no support for Yarn PnP yet and so will present resolution errors to you. If you can ignore the sea of red squigglies all over your source files in the editor and just look at your webpack build you'll be fine.&lt;/p&gt; &lt;p&gt;There is a tool called &lt;code&gt;PnPify&lt;/code&gt; that adds support for PnP to TypeScript (in particular tsc). You can find more information here: &lt;a href="https://yarnpkg.github.io/berry/advanced/pnpify"&gt;https://yarnpkg.github.io/berry/advanced/pnpify&lt;/a&gt;. For tsc it would be:&lt;/p&gt; &lt;pre class="prettyprint shell"&gt;&lt;code&gt;&lt;br /&gt;$&gt; yarn pnpify tsc [...]&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;The gist is that it simulates the existence of &lt;code&gt;node_modules&lt;/code&gt; by leveraging the data from the PnP file. As such it's not a perfect fix (&lt;code&gt;pnp-webpack-plugin&lt;/code&gt; is a better integration), but it's a very useful tool to have to unblock yourself when using a project that doesn't support it.&lt;/p&gt; &lt;p&gt;PnPify actually allows us to use TypeScript in VSCode with PnP! Its documentation is here: &lt;a href="https://yarnpkg.github.io/berry/advanced/pnpify#vscode-support"&gt;https://yarnpkg.github.io/berry/advanced/pnpify#vscode-support&lt;/a&gt;&lt;/p&gt; &lt;p&gt;All of these hindrances should hopefully be resolved in future. Ideally, one day a good developer experience can be the default experience. In the meantime, you can still dev - just be prepared for the rough edges.  Here's some useful resources to track the future of support:&lt;/p&gt; &lt;ul&gt;&lt;li&gt;You can follow more on built in webpack support here: &lt;a href="https://github.com/webpack/enhanced-resolve/issues/162"&gt;https://github.com/webpack/enhanced-resolve/issues/162&lt;/a&gt;&lt;/li&gt;&lt;li&gt;And on built in TypeScript support here: &lt;a href="https://github.com/Microsoft/TypeScript/issues/18896"&gt;https://github.com/Microsoft/TypeScript/issues/18896&lt;/a&gt;&lt;/li&gt;&lt;li&gt;Finally, there it's worth watching the &lt;a href="https://github.com/nodejs/modules"&gt;nodejs/module&lt;/a&gt; repository, which debates amongst other things how to properly integrate loaders with Node.&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;This last one would be nice because:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;We'd stop having to patch require&lt;/li&gt;&lt;li&gt;We probably wouldn't have to use yarn node if Node itself was able to find the loader somehow (such as if it was listed in the package.json metadata)&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;Thanks to Mal for his tireless work on Yarn. To my mind Mal is certainly a candidate for the hardest worker in open source.  I've been shamelessly borrowing his excellent docs for this post - thanks for writing so excellently Mal!&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/139190519228738416'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/139190519228738416'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2019/06/typescript-webpack-you-down-with-pnp.html' title='TypeScript / webpack - you down with PnP? Yarn, you know me!'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8249358818128292879</id><published>2019-05-23T07:30:00.000+01:00</published><updated>2019-05-23T09:20:17.131+01:00</updated><category scheme='http://www.blogger.com/atom/ns#' term='cross-env'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='TypeScript'/><category scheme='http://www.blogger.com/atom/ns#' term='fork-ts-checker-webpack-plugin'/><category scheme='http://www.blogger.com/atom/ns#' term='watch API'/><category scheme='http://www.blogger.com/atom/ns#' term='Webpack'/><title type='text'>TypeScript and high CPU usage - watch don't stare!</title><content type='html'>&lt;p&gt;I'm one of the maintainers of the &lt;a href="https://github.com/Realytics/fork-ts-checker-webpack-plugin"&gt;fork-ts-checker-webpack-plugin&lt;/a&gt;.  Hi there!&lt;/p&gt;&lt;p&gt;Recently, various issues have been raised against create-react-app (which uses fork-ts-checker-webpack-plugin) as well as against the plugin itself. They've been related to the level of CPU usage in watch mode on idle; i.e. it's high!&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;a href="https://github.com/Realytics/fork-ts-checker-webpack-plugin/issues/236"&gt;https://github.com/Realytics/fork-ts-checker-webpack-plugin/issues/236&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="https://github.com/facebook/create-react-app/issues/6792"&gt;https://github.com/facebook/create-react-app/issues/6792&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h4&gt;Why High?&lt;/h4&gt;&lt;p&gt;Now, under the covers, the &lt;code&gt;fork-ts-checker-webpack-plugin&lt;/code&gt; uses the TypeScript watch API.&lt;/p&gt;&lt;p&gt;The marvellous &lt;a href="https://github.com/NeKJ"&gt;John&lt;/a&gt; (not me - another John) did some digging and discovered the root cause came down to the way that the TypeScript watch API watches files:&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;TS uses internally the &lt;code&gt;fs.watch&lt;/code&gt; and &lt;code&gt;fs.watchFile&lt;/code&gt; API functions of nodejs for their watch mode. The latter function &lt;a href="https://nodejs.org/api/fs.html#fs_fs_watchfile_filename_options_listener"&gt;is even not recommended by nodejs documentation&lt;/a&gt; for performance reasons, and urges to use &lt;code&gt;fs.watch&lt;/code&gt; instead.&lt;/p&gt; &lt;p&gt;&lt;strong&gt;NodeJS doc:&lt;/strong&gt;&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;Using fs.watch() is more efficient than fs.watchFile and fs.unwatchFile. fs.watch should be used instead of fs.watchFile and fs.unwatchFile when possible.&lt;/p&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;h4&gt;&amp;quot;there is another&amp;quot;&lt;/h4&gt;&lt;p&gt;John also found that there are other file watching behaviours offered by TypeScript. What's more, the file watching behaviour is &lt;em&gt;configurable with an environment variable&lt;/em&gt;. That's right, if an environment variable called &lt;code&gt;TSC_WATCHFILE&lt;/code&gt; is set, it controls the file watching approach used. Big news!&lt;/p&gt;&lt;p&gt;John did some rough benchmarking of the performance of the different options that be set on his PC running linux 64 bit. Here's how it came out:&lt;/p&gt;&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;Value&lt;/th&gt;&lt;th&gt;CPU usage on idle&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;TS default &lt;em&gt;(TSC_WATCHFILE not set)&lt;/em&gt;&lt;/td&gt;&lt;td&gt;&lt;strong&gt;7.4%&lt;/strong&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;UseFsEventsWithFallbackDynamicPolling&lt;/td&gt;&lt;td&gt;0.2%&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;UseFsEventsOnParentDirectory&lt;/td&gt;&lt;td&gt;0.2%&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;PriorityPollingInterval&lt;/td&gt;&lt;td&gt;&lt;strong&gt;6.2%&lt;/strong&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;DynamicPriorityPolling&lt;/td&gt;&lt;td&gt;0.5%&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;UseFsEvents&lt;/td&gt;&lt;td&gt;0.2%&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;As you can see, the default performs poorly. On the other hand, an option like &lt;code&gt;UseFsEventsWithFallbackDynamicPolling&lt;/code&gt; is comparative greasy lightning.&lt;/p&gt;&lt;h4&gt;workaround!&lt;/h4&gt;&lt;p&gt;To get this better experience into your world now, you could just set an environment variable on your machine. However, that doesn't scale; let's instead look at introducing the environment variable into your project explicitly.&lt;/p&gt;&lt;p&gt;We're going to do this in a cross platform way using &lt;code&gt;&lt;a href="https://github.com/kentcdodds/cross-env"&gt;cross-env&lt;/a&gt;&lt;/code&gt;. This is a mighty useful utility by Kent C Dodds which allows you to set environment variables in a way that will work on Windows, Mac and Linux. Imagine it as the jQuery of the environment variables world :-)&lt;/p&gt; &lt;p&gt;Let's add it as a &lt;code&gt;devDependency&lt;/code&gt;:&lt;/p&gt;&lt;pre class="prettyprint shell"&gt;&lt;code&gt;yarn add -D cross-env&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Then take a look at your &lt;code&gt;package.json&lt;/code&gt;. You've probably got a &lt;code&gt;start&lt;/code&gt; script that looks something like this:&lt;/p&gt;&lt;pre class="prettyprint shell"&gt;&lt;code&gt;&amp;quot;start&amp;quot;: &amp;quot;webpack-dev-server --progress --color --mode development --config webpack.config.development.js&amp;quot;,&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Or if you're a create-react-app user maybe this:&lt;/p&gt;&lt;pre class="prettyprint shell"&gt;&lt;code&gt;&amp;quot;start&amp;quot;: &amp;quot;react-scripts start&amp;quot;,&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Prefix your &lt;code&gt;start&lt;/code&gt; script with &lt;code&gt;cross-env TSC_WATCHFILE=UseFsEventsWithFallbackDynamicPolling&lt;/code&gt;. This will, when run, initialise an environment variable called &lt;code&gt;TSC_WATCHFILE&lt;/code&gt; with the value &lt;code&gt;UseFsEventsWithFallbackDynamicPolling&lt;/code&gt;. Then it will start your development server as it did before. When TypeScript is fired up by webpack it will see this environment variable and use it to configure the file watching behaviour to one of the more performant options.&lt;/p&gt;&lt;p&gt;So, in the case of a &lt;code&gt;create-react-app&lt;/code&gt; user, your finished &lt;code&gt;start&lt;/code&gt; script would look like this:&lt;/p&gt;&lt;pre class="prettyprint shell"&gt;&lt;code&gt;&amp;quot;start&amp;quot;: &amp;quot;cross-env TSC_WATCHFILE=UseFsEventsWithFallbackDynamicPolling react-scripts start&amp;quot;,&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h4&gt;The Future&lt;/h4&gt;&lt;p&gt;There's a possibility that the default watch behaviour may change in TypeScript in future. It's currently under discussion, you can read more &lt;a href="https://github.com/microsoft/TypeScript/issues/31048"&gt;here&lt;/a&gt;.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8249358818128292879'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8249358818128292879'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2019/05/typescript-and-high-cpu-usage-watch.html' title='TypeScript and high CPU usage - watch don&apos;t stare!'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4357542299727488207</id><published>2019-04-27T06:16:00.000+01:00</published><updated>2019-04-27T08:20:41.271+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='large lists'/><category scheme='http://www.blogger.com/atom/ns#' term='react-select'/><category scheme='http://www.blogger.com/atom/ns#' term='typing'/><title type='text'>react-select with less typing lag</title><content type='html'>&lt;p&gt;This is going out to all those people using &lt;a href="https://react-select.com"&gt;&lt;code&gt;react-select&lt;/code&gt;&lt;/a&gt; with 1000+ items to render. To those people typing into the select and saying out loud &amp;quot;it's &lt;em&gt;so&lt;/em&gt; laggy.... This can't be... It's 2019...  I mean, right?&amp;quot;  To the people who read this &lt;a href="https://github.com/JedWatson/react-select/issues/3128"&gt;GitHub issue&lt;/a&gt; top to bottom 30 times and still came back unsure of what to do.  This is for you.&lt;/p&gt;&lt;p&gt;I'm lying. Mostly this goes out to me.  I have a select box.  I need it to render 2000+ items.  I want it to be lovely.  I want my users to be delighted as they use it. I want them to type in and (&lt;em&gt;this is the crucial part!&lt;/em&gt;) for the control to feel responsive.  Not laggy. Not like each keypress is going to Jupiter and back before it renders to the screen.&lt;/p&gt;&lt;p&gt;Amongst the various gems on the GitHub issue are shared CodeSandboxes illustrating ways to integrate react-select with react-window. That's great and they do improve things.  However, they don't do much to improve the laggy typing feel.  There's &lt;a href="https://github.com/JedWatson/react-select/issues/3128#issuecomment-431397942"&gt;brief mention&lt;/a&gt; of a props tweak you can make to react-select; this:&lt;/p&gt;&lt;pre class="prettyprint js"&gt;&lt;code class="language-js"&gt;filterOption={createFilter({ ignoreAccents: false })}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;What does this do? Well, this improves the typing lag experience &lt;em&gt;massively&lt;/em&gt;.  For why? Well, &lt;a href="https://github.com/JedWatson/react-select/blob/292bad3298f2cafad6767f2134bd79a9c27e4073/src/filters.js#L21"&gt;if you look at the code&lt;/a&gt; you find that the default value is &lt;code&gt;ignoreAccents: true&lt;/code&gt;.  This default makes react-select invoke an expensive (and scary sounding) function called &lt;a href="https://github.com/JedWatson/react-select/blob/292bad3298f2cafad6767f2134bd79a9c27e4073/src/diacritics.js#L90"&gt;&lt;code&gt;stripDiacritics&lt;/code&gt;&lt;/a&gt;.  Not once but twice. Ouchy. And this kills performance.&lt;/p&gt;&lt;p&gt;But if you're okay with accents not being ignored (and &lt;em&gt;spoiler&lt;/em&gt;: I am) then this is the option for you.&lt;/p&gt;&lt;p&gt;Here's a CodeSandbox which also includes the &lt;code&gt;ignoreAccents: false&lt;/code&gt; tweak.  Enjoy!&lt;/p&gt;&lt;p&gt;&lt;a href="https://codesandbox.io/s/zn70lqp31m?fontsize=14"&gt;&lt;img src="https://codesandbox.io/static/img/play-codesandbox.svg" alt="Edit johnnyreilly/react-window-with-react-select-less-laggy"&gt;&lt;/a&gt;&lt;/p&gt;&lt;pre class="prettyprint js"&gt;&lt;code class="language-js"&gt;import React, { Component } from &amp;quot;react&amp;quot;;&lt;br /&gt;import ReactDOM from &amp;quot;react-dom&amp;quot;;&lt;br /&gt;import Select, { createFilter } from &amp;quot;react-select&amp;quot;;&lt;br /&gt;import { FixedSizeList as List } from &amp;quot;react-window&amp;quot;;&lt;br /&gt;&lt;br /&gt;import &amp;quot;./styles.css&amp;quot;;&lt;br /&gt;&lt;br /&gt;const options = [];&lt;br /&gt;for (let i = 0; i &amp;lt; 2500; i = i + 1) {&lt;br /&gt;  options.push({ value: i, label: `Option ${i}` });&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;const height = 35;&lt;br /&gt;&lt;br /&gt;class MenuList extends Component {&lt;br /&gt;  render() {&lt;br /&gt;    const { options, children, maxHeight, getValue } = this.props;&lt;br /&gt;    const [value] = getValue();&lt;br /&gt;    const initialOffset = options.indexOf(value) * height;&lt;br /&gt;&lt;br /&gt;    return (&lt;br /&gt;      &amp;lt;List&lt;br /&gt;        height={maxHeight}&lt;br /&gt;        itemCount={children.length}&lt;br /&gt;        itemSize={height}&lt;br /&gt;        initialScrollOffset={initialOffset}&lt;br /&gt;      &amp;gt;&lt;br /&gt;        {({ index, style }) =&amp;gt; &amp;lt;div style={style}&amp;gt;{children[index]}&amp;lt;/div&amp;gt;}&lt;br /&gt;      &amp;lt;/List&amp;gt;&lt;br /&gt;    );&lt;br /&gt;  }&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;const App = () =&amp;gt; (&lt;br /&gt;  &amp;lt;Select&lt;br /&gt;    filterOption={createFilter({ ignoreAccents: false })} // this makes all the difference!&lt;br /&gt;    components={{ MenuList }}&lt;br /&gt;    options={options}&lt;br /&gt;  /&amp;gt;&lt;br /&gt;);&lt;br /&gt;&lt;br /&gt;ReactDOM.render(&amp;lt;App /&amp;gt;, document.getElementById(&amp;quot;root&amp;quot;));&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4357542299727488207'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4357542299727488207'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2019/04/react-select-with-less-typing-lag.html' title='react-select with less typing lag'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-7889489548260537942</id><published>2019-03-24T09:16:00.001Z</published><updated>2021-03-03T22:16:23.774Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='DOM'/><category scheme='http://www.blogger.com/atom/ns#' term='template'/><category scheme='http://www.blogger.com/atom/ns#' term='Materialized'/><title type='text'>Template Tricks for a Dainty DOM</title><content type='html'>&lt;p&gt;I'm somewhat into code golf. Placing restrictions on what you're &amp;quot;allowed&amp;quot; to do in code and seeing what the happens as a result. I'd like to share with you something that came out of some recent dabblings.&lt;/p&gt;&lt;p&gt;Typically I spend a good amount of time playing with TypeScript. Either working on build tools or making web apps with it. (Usually with a portion of React on the side.) This is something different.&lt;/p&gt;&lt;p&gt;I have a side project on the go which is essentially a mini analytics dashboard. For the purposes of this piece let's call it &amp;quot;StatsDash&amp;quot;. When I was starting it I thought: let's try something different. Let's build StatsDash with HTML &lt;em&gt;only&lt;/em&gt;. The actual HTML is hand cranked by me and generated in ASP.Net Core / C# using a combination of LINQ and string interpolation. (Who needs Razor? ) I'll say it's pretty fun - but the back end is not what I want to focus on.&lt;/p&gt;&lt;p&gt;I got something up and running pretty quickly in pure HTML. The first lesson I learned was this: HTML alone is hella ugly.  So I relaxed my criteria; I allowed CSS to come play as long as I didn't have to write any / much myself. There followed some experimentation with different CSS frameworks. For a while I rolled with Bootstrap (old school!), then Bulma and finally I settled on &lt;a href="https://materializecss.com/"&gt;Materialized&lt;/a&gt;. Materialized is a heavily inspired by Google's Material Design and is hence quite beautiful. With my HTML and Materialize's CSS we were rolling.  Beautiful stats - no JS.&lt;/p&gt;&lt;h4&gt;&amp;quot;Oh All Right; Just a Splash&amp;quot;&lt;/h4&gt;&lt;p&gt;Lovely as things were, StatsDash quickly got to the point where there was too much information on the screen. It was time to make some changes. If data is to convey a message, it must first be comprehensible.&lt;/p&gt;&lt;p&gt;I needed a way to hide and show data as people interacted with StatsDash. I wanted to achieve this &lt;em&gt;without&lt;/em&gt; starting to render on the client side and also without going back to the server each time.&lt;/p&gt;&lt;p&gt;If you want interactions in your UI all roads lead to JS. It's certainly possible to do some tricks with CSS but that's a round of code golf I'm ill equipped to play. So, I took a look at what Materialized had to offer.  Usefully it has a &lt;a href="https://materializecss.com/modals.html"&gt;Modal&lt;/a&gt; component. With that in play I'd be able to separate the detailed information into different modals which the users could show and hide as required. Perfect!&lt;/p&gt;&lt;p&gt;It required a little JS.  What's a line or two between friends?  Dear reader, I compromised once more.&lt;/p&gt;&lt;h4&gt;The DOM Bunker&lt;/h4&gt;&lt;p&gt;With my handy modals, StatsDash was now a one stop shop for a great deal of information. Info which took the form of DOM nodes. Lots of them. And by &amp;quot;lots of them&amp;quot; I want you to think along the lines of &amp;quot;space is big, really big...&amp;quot;.&lt;/p&gt;&lt;p&gt;This was impacting users. Clicking to open a modal resulted in a noticeable lag. It would take 2+ seconds for the browser to respond. Users found themselves clicking multiple times; wondering why nothing seemed to occur. In the end the modal would shuffle into view. However, this wasn't the best experience. The lack of responsiveness was getting in the way of users enjoying all StatsDash had to offer.&lt;/p&gt;&lt;p&gt;Running an audit of StatsDash in Chrome DevTools there was no doubt we had a DOM problem:&lt;/p&gt; &lt;a href="https://1.bp.blogspot.com/-lrVKXxqAtmU/XJdHE509SCI/AAAAAAAAOhU/vxVhqlOMtFMbdm_HDpNkSW55B73Wxm86ACPcBGAYYCw/s1600/DOM-massive.png" imageanchor="1" &gt;&lt;img border="0" src="https://1.bp.blogspot.com/-lrVKXxqAtmU/XJdHE509SCI/AAAAAAAAOhU/vxVhqlOMtFMbdm_HDpNkSW55B73Wxm86ACPcBGAYYCw/s640/DOM-massive.png" width="640" height="298" data-original-width="1068" data-original-height="498" /&gt;&lt;/a&gt; &lt;p&gt;What to do? I still didn't want to go back to the server on each click in StatsDash. And I didn't want to start writing rendering code on the client as well either.  I have in the past mixed client and server side rendering and I know well that it's a first class ticket to a confusing codebase.&lt;/p&gt;&lt;h4&gt;Smuggling DOM in Templates&lt;/h4&gt;&lt;p&gt;There's a mechanism that supports this use case directly: the &lt;code&gt;&amp;lt;template&amp;gt;&lt;/code&gt; element. &lt;a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/template"&gt;To quote MDN&lt;/a&gt;:&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;The HTML Content Template (&lt;code&gt;&amp;lt;template&amp;gt;&lt;/code&gt;) element is a mechanism for holding client-side content that is not to be rendered when a page is loaded but may subsequently be instantiated during runtime using JavaScript.&lt;/p&gt;&lt;/blockquote&gt;&lt;blockquote&gt;&lt;p&gt;Think of a template as a content fragment that is being stored for subsequent use in the document.&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;This is &lt;em&gt;exactly&lt;/em&gt; what I'm after. I can keep my rendering server side, but instead wrap content that isn't immediately visible to users inside a &lt;code&gt;&amp;lt;template&amp;gt;&lt;/code&gt; element and render that only when users need it.&lt;/p&gt;&lt;p&gt;So in the case of my modals (where most of my DOM lives), I can tuck the contents of each modal into a &lt;code&gt;&amp;lt;template&amp;gt;&lt;/code&gt; element. Then, when the user clicks to open a modal we move that template content into the DOM so they can see it. Likewise, as they close a modal we can clear out the modal's DOM content to ease the load on the dear old browser.&lt;/p&gt;&lt;h4&gt;&amp;quot;That Sounds Complicated...&amp;quot;&lt;/h4&gt;&lt;p&gt;It's not. Let me show you how easily this is accomplished.  First of all, wrap all your modal contents into &lt;code&gt;&amp;lt;template&amp;gt;&lt;/code&gt; elements. They should look a little something like this:&lt;/p&gt;&lt;pre class="prettyprint html"&gt;&lt;code class="language-html"&gt;&amp;lt;div&amp;gt;&lt;br /&gt;    &amp;lt;button data-target=&amp;quot;modalId&amp;quot; class=&amp;quot;btn modal-trigger&amp;quot;&amp;gt;Open the Modal!&amp;lt;/button&amp;gt;&lt;br /&gt;&lt;br /&gt;    &amp;lt;template&amp;gt;&lt;br /&gt;        &amp;lt;!--&lt;br /&gt;        loads of DOM nodes&lt;br /&gt;        --&amp;gt;&lt;br /&gt;    &amp;lt;/template&amp;gt;&lt;br /&gt;&lt;br /&gt;    &amp;lt;div id=&amp;quot;modalId&amp;quot; class=&amp;quot;modal modal-fixed-footer&amp;quot;&amp;gt;&amp;lt;/div&amp;gt;&lt;br /&gt;&amp;lt;/div&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Next, where you initialise your modals you need to make a little tweak:&lt;/p&gt;&lt;pre class="prettyprint js"&gt;&lt;code class="language-js"&gt;document.addEventListener('DOMContentLoaded', function() {&lt;br /&gt;    M.Modal.init(document.querySelectorAll('.modal'), {&lt;br /&gt;        onOpenStart: modalDiv =&amp;gt; {&lt;br /&gt;            const template = modalDiv.parentNode.querySelector('template');&lt;br /&gt;&lt;br /&gt;            modalDiv.appendChild(document.importNode(template.content, true));&lt;br /&gt;        },&lt;br /&gt;        onCloseEnd: modalDiv =&amp;gt; {&lt;br /&gt;            while (modalDiv.firstChild) {&lt;br /&gt;                modalDiv.removeChild(modalDiv.firstChild);&lt;br /&gt;            }&lt;br /&gt;        }&lt;br /&gt;    });&lt;br /&gt;});&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;That's it! As you can see, before we open our modals, the &lt;code&gt;onOpenStart&lt;/code&gt; callback will fire which creates the actual DOM elements based upon the &lt;code&gt;template&lt;/code&gt;. And when the modals finish closing the &lt;code&gt;onCloseEnd&lt;/code&gt; callback runs to remove those DOM elements once more.&lt;/p&gt;&lt;p&gt;For this minimal change, the client gets a dramatically different user experience. StatsDash went from super laggy to satisfyingly fast. Using &lt;code&gt;template&lt;/code&gt;s, The number of initial DOM nodes dropped from more than &lt;em&gt;20,000&lt;/em&gt; to &lt;em&gt;200&lt;/em&gt;. That's right  times smaller!&lt;/p&gt;&lt;h4&gt;Do It Yourself&lt;/h4&gt;&lt;p&gt;The code examples above rely upon the Materialize modals. However the principles used here are broadly applicable. It's easy for you to take the approach outlined here and apply it in a different situation.&lt;/p&gt;&lt;p&gt;If you're interested in some of the other exciting things you can do with templates then I recommend &lt;a href="https://www.html5rocks.com/en/tutorials/webcomponents/template/"&gt;Eric Bidelman's post on the topic&lt;/a&gt;.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7889489548260537942'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7889489548260537942'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2019/03/template-tricks-for-dainty-dom.html' title='Template Tricks for a Dainty DOM'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='https://1.bp.blogspot.com/-lrVKXxqAtmU/XJdHE509SCI/AAAAAAAAOhU/vxVhqlOMtFMbdm_HDpNkSW55B73Wxm86ACPcBGAYYCw/s72-c/DOM-massive.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-874952266157346836</id><published>2019-03-22T05:30:00.000Z</published><updated>2019-03-23T10:23:00.907Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='asp net core'/><category scheme='http://www.blogger.com/atom/ns#' term='google analytics'/><title type='text'>Google Analytics API and ASP.Net Core</title><content type='html'>&lt;p&gt;Some of my posts are meaningful treaties on the nature of software development. Some are detailed explanations of approaches you can use. Some are effectively code dumps. This is one of those.&lt;/p&gt;&lt;p&gt;I recently had need to be able to access the API for Google Analytics from ASP.Net Core. Getting this up and running turned out to be surprisingly tough because of an absence of good examples. So here it is; an example of how you can access a simple page access stat using &lt;a href="https://www.nuget.org/packages/Google.Apis.AnalyticsReporting.v4/"&gt;the API&lt;/a&gt;:&lt;/p&gt;&lt;pre class="prettyprint cs"&gt;&lt;code&gt;async Task&amp;lt;SomeKindOfDataStructure[]&amp;gt; GetUsageFromGoogleAnalytics(DateTime startAtThisDate, DateTime endAtThisDate)&lt;br /&gt;{&lt;br /&gt;    // Create the DateRange object. Here we want data from last week.&lt;br /&gt;    var dateRange = new DateRange&lt;br /&gt;    {&lt;br /&gt;        StartDate = startAtThisDate.ToString(&amp;quot;yyyy-MM-dd&amp;quot;),&lt;br /&gt;        EndDate = endAtThisDate.ToString(&amp;quot;yyyy-MM-dd&amp;quot;)&lt;br /&gt;    };&lt;br /&gt;    // Create the Metrics and dimensions object.&lt;br /&gt;    // var metrics = new List&amp;lt;Metric&amp;gt; { new Metric { Expression = &amp;quot;ga:sessions&amp;quot;, Alias = &amp;quot;Sessions&amp;quot; } };&lt;br /&gt;    // var dimensions = new List&amp;lt;Dimension&amp;gt; { new Dimension { Name = &amp;quot;ga:pageTitle&amp;quot; } };&lt;br /&gt;    var metrics = new List&amp;lt;Metric&amp;gt; { new Metric { Expression = &amp;quot;ga:uniquePageviews&amp;quot; } };&lt;br /&gt;    var dimensions = new List&amp;lt;Dimension&amp;gt; { &lt;br /&gt;        new Dimension { Name = &amp;quot;ga:date&amp;quot; },&lt;br /&gt;        new Dimension { Name = &amp;quot;ga:dimension1&amp;quot; } &lt;br /&gt;    };&lt;br /&gt;&lt;br /&gt;    // Get required View Id from configuration&lt;br /&gt;    var viewId = $&amp;quot;ga:{&amp;quot;[VIEWID]&amp;quot;}&amp;quot;;&lt;br /&gt;&lt;br /&gt;    // Create the Request object.&lt;br /&gt;    var reportRequest = new ReportRequest&lt;br /&gt;    {&lt;br /&gt;        DateRanges = new List&amp;lt;DateRange&amp;gt; { dateRange },&lt;br /&gt;        Metrics = metrics,&lt;br /&gt;        Dimensions = dimensions,&lt;br /&gt;        FiltersExpression = &amp;quot;ga:pagePath==/index.html&amp;quot;,&lt;br /&gt;        ViewId = viewId&lt;br /&gt;    };&lt;br /&gt;&lt;br /&gt;    var getReportsRequest = new GetReportsRequest {&lt;br /&gt;        ReportRequests = new List&amp;lt;ReportRequest&amp;gt; { reportRequest }&lt;br /&gt;    };&lt;br /&gt;        &lt;br /&gt;    //Invoke Google Analytics API call and get report&lt;br /&gt;    var analyticsService = GetAnalyticsReportingServiceInstance();&lt;br /&gt;    var response = await (analyticsService.Reports.BatchGet(getReportsRequest)).ExecuteAsync();&lt;br /&gt;&lt;br /&gt;    var logins = response.Reports[0].Data.Rows.Select(row =&amp;gt; new SomeKindOfDataStructure {&lt;br /&gt;        Date = new DateTime(&lt;br /&gt;            year: Convert.ToInt32(row.Dimensions[0].Substring(0, 4)), &lt;br /&gt;            month: Convert.ToInt32(row.Dimensions[0].Substring(4, 2)), &lt;br /&gt;            day: Convert.ToInt32(row.Dimensions[0].Substring(6, 2))),&lt;br /&gt;        NumberOfLogins = Convert.ToInt32(row.Metrics[0].Values[0])&lt;br /&gt;    })&lt;br /&gt;    .OrderByDescending(login =&amp;gt; login.Date)&lt;br /&gt;    .ToArray();&lt;br /&gt;&lt;br /&gt;    return logins;&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;/// &amp;lt;summary&amp;gt;&lt;br /&gt;/// Intializes and returns Analytics Reporting Service Instance&lt;br /&gt;/// &amp;lt;/summary&amp;gt;&lt;br /&gt;AnalyticsReportingService GetAnalyticsReportingServiceInstance() {&lt;br /&gt;    var googleAuthFlow = new GoogleAuthorizationCodeFlow(new GoogleAuthorizationCodeFlow.Initializer {&lt;br /&gt;        ClientSecrets = new ClientSecrets {&lt;br /&gt;            ClientId = &amp;quot;[CLIENTID]&amp;quot;,&lt;br /&gt;            ClientSecret = &amp;quot;[CLIENTSECRET]&amp;quot;&lt;br /&gt;        }&lt;br /&gt;    });&lt;br /&gt;&lt;br /&gt;    var responseToken = new TokenResponse {&lt;br /&gt;        AccessToken = &amp;quot;[ANALYTICSTOKEN]&amp;quot;,&lt;br /&gt;        RefreshToken = &amp;quot;[REFRESHTOKEN]&amp;quot;,&lt;br /&gt;        Scope = AnalyticsReportingService.Scope.AnalyticsReadonly, //Read-only access to Google Analytics,&lt;br /&gt;        TokenType = &amp;quot;Bearer&amp;quot;,&lt;br /&gt;    };&lt;br /&gt;&lt;br /&gt;    var credential = new UserCredential(googleAuthFlow, &amp;quot;&amp;quot;, responseToken);&lt;br /&gt;&lt;br /&gt;    // Create the  Analytics service.&lt;br /&gt;    return new AnalyticsReportingService(new BaseClientService.Initializer {&lt;br /&gt;        HttpClientInitializer = credential,&lt;br /&gt;        ApplicationName = &amp;quot;my-super-applicatio&amp;quot;,&lt;br /&gt;    });&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;You can see above that you need various credentials to be able to use the API. You can acquire these by logging into GA. Enjoy!&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/874952266157346836'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/874952266157346836'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2019/03/google-analytics-api-and-aspnet-core.html' title='Google Analytics API and ASP.Net Core'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4941857569858799550</id><published>2019-03-06T21:01:00.000Z</published><updated>2019-03-06T22:12:23.387Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='TypeScript'/><category scheme='http://www.blogger.com/atom/ns#' term='fork-ts-checker-webpack-plugin'/><category scheme='http://www.blogger.com/atom/ns#' term='ts-loader'/><category scheme='http://www.blogger.com/atom/ns#' term='tslint'/><category scheme='http://www.blogger.com/atom/ns#' term='1.0.0'/><category scheme='http://www.blogger.com/atom/ns#' term='Webpack'/><title type='text'>The Big One Point Oh</title><content type='html'>&lt;p&gt;&lt;a href="https://github.com/Realytics/fork-ts-checker-webpack-plugin/releases/tag/v1.0.0"&gt;It's time for the first major version of &lt;code&gt;fork-ts-checker-webpack-plugin&lt;/code&gt;&lt;/a&gt;. It's been a long time coming :-)&lt;/p&gt;&lt;h4&gt;A Little History&lt;/h4&gt;&lt;p&gt;The &lt;code&gt;fork-ts-checker-webpack-plugin&lt;/code&gt; was originally the handiwork of &lt;a href="https://github.com/piotr-oles"&gt;Piotr Ole&lt;/a&gt;.  He raised an issue with &lt;a href="https://github.com/TypeStrong/ts-loader/issues/537"&gt;&lt;code&gt;ts-loader&lt;/code&gt;&lt;/a&gt; suggesting it could be the McCartney to &lt;code&gt;ts-loader&lt;/code&gt;'s Lennon:&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;Hi everyone!&lt;/p&gt;&lt;p&gt;I've created webpack plugin: &lt;a href="https://github.com/Realytics/fork-ts-checker-webpack-plugin"&gt;fork-ts-checker-webpack-plugin&lt;/a&gt; that plays nicely with &lt;code&gt;ts-loader&lt;/code&gt;. The idea is to compile project with &lt;code&gt;transpileOnly: true&lt;/code&gt; and check types on separate process (async). With this approach, webpack build is not blocked by type checker and we have semantic check with fast incremental build. More info on github repo :)&lt;/p&gt;&lt;p&gt;So if you like it and you think it would be good to add some info in README.md about this plugin, I would be greatful.&lt;/p&gt;&lt;p&gt;Thanks :)&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;We did like it.  We did think it would be good. We took him up on his kind offer.&lt;/p&gt;&lt;p&gt;Since that time many people have had their paws on the &lt;code&gt;fork-ts-checker-webpack-plugin&lt;/code&gt; codebase. We love them all.&lt;/p&gt;&lt;h4&gt;One Point Oh&lt;/h4&gt;&lt;p&gt;We could have had our first major release a long time ago.  The idea first occurred when webpack 5 alpha appeared. &amp;quot;Huh, look at that, a major version number.... Maybe we should do that?&amp;quot; &amp;quot;&lt;em&gt;Great&lt;/em&gt; idea chap - do it!&amp;quot; So here it is; fresh out the box: v1.0.0&lt;/p&gt;&lt;p&gt;There are actually no breaking changes that we're aware of; users of 0.x &lt;code&gt;fork-ts-checker-webpack-plugin&lt;/code&gt; should be be able to upgrade without any drama.&lt;/p&gt;&lt;h4&gt;Incremental Watch API on by Default&lt;/h4&gt;&lt;p&gt;Users of TypeScript 3+ may notice a performance improvement as by default the plugin now uses the &lt;a href="https://github.com/Microsoft/TypeScript/pull/20234"&gt;incremental watch API&lt;/a&gt; in TypeScript.&lt;/p&gt;&lt;p&gt;Should this prove problematic you can opt out of using it by supplying &lt;code&gt;useTypescriptIncrementalApi: false&lt;/code&gt;. We are aware of an &lt;a href="https://github.com/Realytics/fork-ts-checker-webpack-plugin/issues/219"&gt;issue with Vue and the incremental API&lt;/a&gt;.  We hope it will be fixed soon - a generous member of the community is taking a look. In the meantime, we will &lt;em&gt;not&lt;/em&gt; default to using the incremental watch API when in Vue mode.&lt;/p&gt;&lt;h4&gt;Compatibility&lt;/h4&gt;&lt;p&gt;As it stands, the plugin supports webpack 2, 3, 4 and 5 alpha.  It is compatible with TypeScript 2.1+ and TSLint 4+.&lt;/p&gt;&lt;p&gt;Right that's it - enjoy it! And thanks everyone for contributing - we really dig your help. Much love.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4941857569858799550'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4941857569858799550'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2019/03/the-big-one-point-oh.html' title='The Big One Point Oh'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1391981092955231296</id><published>2019-02-22T06:00:00.000Z</published><updated>2019-02-28T06:08:21.678Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='asp net core'/><category scheme='http://www.blogger.com/atom/ns#' term='proxy'/><category scheme='http://www.blogger.com/atom/ns#' term='http requests'/><category scheme='http://www.blogger.com/atom/ns#' term='whitelist'/><title type='text'>WhiteList Proxying with ASP.Net Core</title><content type='html'>&lt;p&gt;Once upon a time there lived a young team who were building a product.  They were ready to go live with their beta and so they set off on a journey to a mystical land they had heard tales of.  This magical kingdom was called &amp;quot;Production&amp;quot;.  However, Production was a land with walls and but one gate.  That gate was jealously guarded by a defender named &amp;quot;InfoSec&amp;quot;.  InfoSec was there to make sure that only the the right people, noble of thought and pure of deed were allowed into the promised land.  InfoSec would ask questions like &amp;quot;are you serving over HTTPS&amp;quot; and &amp;quot;what are you doing about cross site scripting&amp;quot;?&lt;/p&gt;&lt;p&gt;The team felt they had good answers to InfoSec's questions.  However, just as they were about to step through the gate, InfoSec held up their hand and said &amp;quot;your application wants to access a database... database access needs to take place on our own internal network.  Not over the publicly accessible internet. You shall not pass.&amp;quot;&lt;/p&gt;&lt;p&gt;The team, with one foot in the air, paused.  They swallowed and said &amp;quot;can you give us five minutes?&amp;quot;&lt;/p&gt; &lt;a href="https://3.bp.blogspot.com/-tmH5nbo_kGY/XG-8jmokKdI/AAAAAAAAN_Q/1zzN3IfRtlopNC9HTRio6HdpVCeO5jMkwCPcBGAYYCw/s1600/hang-on-lads-ive-got-a-great-idea.jpg" imageanchor="1" &gt;&lt;img border="0" src="https://3.bp.blogspot.com/-tmH5nbo_kGY/XG-8jmokKdI/AAAAAAAAN_Q/1zzN3IfRtlopNC9HTRio6HdpVCeO5jMkwCPcBGAYYCw/s640/hang-on-lads-ive-got-a-great-idea.jpg" width="640" height="271" data-original-width="915" data-original-height="387" /&gt;&lt;/a&gt; &lt;h4&gt;The Proxy Regroup&lt;/h4&gt;&lt;p&gt;And so it came to pass that the teams product (which took the form of ASP.Net Core web application) had to be changed.  Where once there had been a single application, there would now be two; one that lived on the internet (the &lt;em&gt;web&lt;/em&gt; app) and one that lived on the companies private network (the &lt;em&gt;API&lt;/em&gt; app).  The API app would do all the database access.  In fact the product team opted to move all significant operations into the API as well.  This left the web app with two purposes:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;the straightforward serving of HTML, CSS, JS and images&lt;/li&gt;&lt;li&gt;the proxying of API calls through to the API app&lt;/li&gt;&lt;/ol&gt;&lt;h4&gt;Proxy Part 1&lt;/h4&gt;&lt;p&gt;In the early days of this proxying the team reached for &lt;a href="https://github.com/twitchax/AspNetCore.Proxy"&gt;&lt;code&gt;AspNetCore.Proxy&lt;/code&gt;&lt;/a&gt;.  It's a great open source project that allows you to proxy HTTP requests. It gives you complete control over the construction of proxy requests, so that you can have a request come into your API and end up proxying it to a URL with a completely different path on the proxy server.&lt;/p&gt;&lt;h4&gt;Proxy Part 2&lt;/h4&gt;&lt;p&gt;The approach offered by &lt;code&gt;AspNetCore.Proxy&lt;/code&gt; is fantastically powerful in terms of control.  However, we didn't actually need that level of configurability.  In fact, it resulted in us writing a great deal of boilerplate code.  You see in our case we'd opted to proxy path for path, changing only the server name on each proxied request.  So if a GET request came in going to https://web.app.com/api/version then we would want to proxy it to a GET request to https://api.app.com/api/version.  You see?  All we did was swap https://web.app.com for https://api.app.com.  Nothing more. We did that as a rule.  We knew we &lt;em&gt;always&lt;/em&gt; wanted to do just this.&lt;/p&gt;&lt;p&gt;So we ended up spinning up our own solution which allowed just the specification of paths we wanted to proxy with their corresponding HTTP verbs.  Let's talk through it.  Usage of our approach ended up as a middleware within our web app's &lt;code&gt;Startup.cs&lt;/code&gt;:&lt;/p&gt;&lt;pre class="prettyprint cs"&gt;&lt;code&gt;        public void Configure(IApplicationBuilder app) {&lt;br /&gt;            // ...&lt;br /&gt;&lt;br /&gt;            app.UseProxyWhiteList(&lt;br /&gt;                // where ServerToProxyToBaseUrl is the server you want requests to be proxied to&lt;br /&gt;                proxyAddressTweaker: (requestPath) =&amp;gt; $&amp;quot;{ServerToProxyToBaseUrl}{requestPath}&amp;quot;,&lt;br /&gt;                whiteListProxyRoutes: new [] {&lt;br /&gt;                    // An anonymous request&lt;br /&gt;                    WhiteListProxy.AnonymousRoute(&amp;quot;api/version&amp;quot;, HttpMethod.Get),&lt;br /&gt;     &lt;br /&gt;                    // An authenticated request; to send this we must know who the user is&lt;br /&gt;                    WhiteListProxy.Route(&amp;quot;api/account/{accountId:int}/all-the-secret-info&amp;quot;, HttpMethod.Get, HttpMethod.Post),&lt;br /&gt;            });&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;            app.UseMvc();&lt;br /&gt;   &lt;br /&gt;            // ...&lt;br /&gt;        }&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;If you look at the code above you can see that we are proxing all our requests to a single server: &lt;code&gt;ServerToProxyToBaseUrl&lt;/code&gt;.  We're proxying 2 different requests:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;code&gt;GET&lt;/code&gt; requests to &lt;code&gt;api/version&lt;/code&gt; are proxied through as &lt;em&gt;anonymous&lt;/em&gt; &lt;code&gt;GET&lt;/code&gt; requests.&lt;/li&gt;&lt;li&gt;&lt;code&gt;GET&lt;/code&gt; and &lt;code&gt;POST&lt;/code&gt; requests to &lt;code&gt;api/account/{accountId:int}/all-the-secret-info&lt;/code&gt; are proxied through as &lt;code&gt;GET&lt;/code&gt; and &lt;code&gt;POST&lt;/code&gt; requests.  These requests require that a user be authenticated first.&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;The &lt;code&gt;WhiteListProxy&lt;/code&gt; proxy class we've been using looks like this:&lt;/p&gt;&lt;pre class="prettyprint cs"&gt;&lt;code&gt;using System;&lt;br /&gt;using System.Collections.Generic;&lt;br /&gt;using System.Net.Http;&lt;br /&gt;&lt;br /&gt;namespace My.Web.Proxy {&lt;br /&gt;    public class WhiteListProxy {&lt;br /&gt;        public string Path { get; set; }&lt;br /&gt;        public IEnumerable&amp;lt;HttpMethod&amp;gt; Methods { get; set; }&lt;br /&gt;        public bool IsAnonymous { get; set; }&lt;br /&gt;&lt;br /&gt;        private WhiteListProxy(string path, bool isAnonymous, params HttpMethod[] methods) {&lt;br /&gt;            if (methods == null || methods.Length == 0)&lt;br /&gt;                throw new ArgumentException($&amp;quot;You need at least a single HttpMethod to be specified for {path}&amp;quot;);&lt;br /&gt;&lt;br /&gt;            Path = path;&lt;br /&gt;            IsAnonymous = isAnonymous;&lt;br /&gt;            Methods = methods;&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        public static WhiteListProxy Route(string path, params HttpMethod[] methods) =&amp;gt; new WhiteListProxy(path, isAnonymous : false, methods: methods);&lt;br /&gt;        public static WhiteListProxy AnonymousRoute(string path, params HttpMethod[] methods) =&amp;gt; new WhiteListProxy(path, isAnonymous : true, methods: methods);&lt;br /&gt;    }&lt;br /&gt;&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The middleware for proxying (our &lt;code&gt;UseProxyWhiteList&lt;/code&gt;) looks like this:&lt;/p&gt;&lt;pre class="prettyprint cs"&gt;&lt;code&gt;using System;&lt;br /&gt;using System.Collections.Generic;&lt;br /&gt;using System.ComponentModel;&lt;br /&gt;using System.Linq;&lt;br /&gt;using System.Net.Http;&lt;br /&gt;using System.Reflection;&lt;br /&gt;using System.Threading.Tasks;&lt;br /&gt;using Microsoft.AspNetCore.Authentication;&lt;br /&gt;using Microsoft.AspNetCore.Builder;&lt;br /&gt;using Microsoft.AspNetCore.Http;&lt;br /&gt;using Microsoft.AspNetCore.Routing;&lt;br /&gt;using Microsoft.Extensions.DependencyModel;&lt;br /&gt;using Microsoft.Extensions.DependencyInjection;&lt;br /&gt;using Serilog;&lt;br /&gt;&lt;br /&gt;namespace My.Web.Proxy {&lt;br /&gt;    public static class ProxyRouteExtensions {&lt;br /&gt;        /// &amp;lt;summary&amp;gt;&lt;br /&gt;        /// Middleware which proxies the supplied whitelist routes&lt;br /&gt;        /// &amp;lt;/summary&amp;gt;&lt;br /&gt;        public static void UseProxyWhiteList(&lt;br /&gt;            this IApplicationBuilder app,&lt;br /&gt;            Func&amp;lt;string, string&amp;gt; proxyAddressTweaker,&lt;br /&gt;            Action&amp;lt;HttpContext, HttpRequestMessage&amp;gt; preSendProxyRequestAction,&lt;br /&gt;            IEnumerable&amp;lt;WhiteListProxy&amp;gt; whiteListProxyRoutes&lt;br /&gt;        ) {&lt;br /&gt;            app.UseRouter(builder =&amp;gt; {&lt;br /&gt;                foreach (var whiteListProxy in whiteListProxyRoutes) {&lt;br /&gt;                    foreach (var method in whiteListProxy.Methods) {&lt;br /&gt;                        builder.MapMiddlewareVerb(method.ToString(), whiteListProxy.Path, proxyApp =&amp;gt; {&lt;br /&gt;                            proxyApp.UseProxy_Challenge(whiteListProxy.IsAnonymous);&lt;br /&gt;                            proxyApp.UseProxy_Run(proxyAddressTweaker, preSendProxyRequestAction);&lt;br /&gt;                        });&lt;br /&gt;                    }&lt;br /&gt;                }&lt;br /&gt;            });&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        private static void UseProxy_Challenge(this IApplicationBuilder app, bool allowAnonymous) {&lt;br /&gt;            app.Use((context, next) =&amp;gt;&lt;br /&gt;            {&lt;br /&gt;                var routePath = context.Request.Path.Value;&lt;br /&gt;&lt;br /&gt;                var weAreAuthenticatedOrWeDontNeedToBe =&lt;br /&gt;                    context.User.Identity.IsAuthenticated || allowAnonymous;&lt;br /&gt;                if (weAreAuthenticatedOrWeDontNeedToBe)&lt;br /&gt;                    return next();&lt;br /&gt;&lt;br /&gt;                return context.ChallengeAsync();&lt;br /&gt;            });&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        private static void UseProxy_Run(&lt;br /&gt;            this IApplicationBuilder app,&lt;br /&gt;            Func&amp;lt;string, string&amp;gt; proxyAddressTweaker,&lt;br /&gt;            Action&amp;lt;HttpContext, HttpRequestMessage&amp;gt; preSendProxyRequestAction&lt;br /&gt;            )&lt;br /&gt;        {&lt;br /&gt;            app.Run(async context =&amp;gt; {&lt;br /&gt;                var proxyAddress = &amp;quot;&amp;quot;;&lt;br /&gt;                try {&lt;br /&gt;                    proxyAddress = proxyAddressTweaker(context.Request.Path.Value);&lt;br /&gt;                    &lt;br /&gt;                    var proxyRequest = context.Request.CreateProxyHttpRequest(proxyAddress);&lt;br /&gt;&lt;br /&gt;                    if (preSendProxyRequestAction != null)&lt;br /&gt;                        preSendProxyRequestAction(context, proxyRequest);&lt;br /&gt;&lt;br /&gt;                    var httpClients = context.RequestServices.GetService&amp;lt;IHttpClients&amp;gt;(); // IHttpClients is just a wrapper for HttpClient - insert your own here&lt;br /&gt;&lt;br /&gt;                    var proxyResponse = await httpClients.SendRequestAsync(proxyRequest,&lt;br /&gt;                            HttpCompletionOption.ResponseHeadersRead, context.RequestAborted)&lt;br /&gt;                        .ConfigureAwait(false);&lt;br /&gt;&lt;br /&gt;                    await context.CopyProxyHttpResponse(proxyResponse).ConfigureAwait(false);&lt;br /&gt;                }&lt;br /&gt;                catch (OperationCanceledException ex) {&lt;br /&gt;                    if (ex.CancellationToken.IsCancellationRequested)&lt;br /&gt;                        return;&lt;br /&gt;&lt;br /&gt;                    if (!context.Response.HasStarted)&lt;br /&gt;                    {&lt;br /&gt;                        context.Response.StatusCode = 408;&lt;br /&gt;                        await context.Response&lt;br /&gt;                            .WriteAsync(&amp;quot;Request timed out.&amp;quot;);&lt;br /&gt;                    }&lt;br /&gt;                }&lt;br /&gt;                catch (Exception e) {&lt;br /&gt;                    if (!context.Response.HasStarted)&lt;br /&gt;                    {&lt;br /&gt;                        context.Response.StatusCode = 500;&lt;br /&gt;                        await context.Response&lt;br /&gt;                            .WriteAsync(&lt;br /&gt;                                $&amp;quot;Request could not be proxied.\n\n{e.Message}\n\n{e.StackTrace}.&amp;quot;);&lt;br /&gt;                    }&lt;br /&gt;                }&lt;br /&gt;            });&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        public static void AddOrReplaceHeader(this HttpRequestMessage request, string headerName, string headerValue) {&lt;br /&gt;            // It's possible for there to be multiple headers with the same name; we only want a single header to remain.  Our one.&lt;br /&gt;            while (request.Headers.TryGetValues(headerName, out var existingAuthorizationHeader)) {&lt;br /&gt;                request.Headers.Remove(headerName);&lt;br /&gt;            }&lt;br /&gt;            request.Headers.TryAddWithoutValidation(headerName, headerValue);&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        public static HttpRequestMessage CreateProxyHttpRequest(this HttpRequest request, string uriString) {&lt;br /&gt;            var uri = new Uri(uriString + request.QueryString);&lt;br /&gt;&lt;br /&gt;            var requestMessage = new HttpRequestMessage();&lt;br /&gt;            var requestMethod = request.Method;&lt;br /&gt;            if (!HttpMethods.IsGet(requestMethod) &amp;amp;&amp;amp;&lt;br /&gt;                !HttpMethods.IsHead(requestMethod) &amp;amp;&amp;amp;&lt;br /&gt;                !HttpMethods.IsDelete(requestMethod) &amp;amp;&amp;amp;&lt;br /&gt;                !HttpMethods.IsTrace(requestMethod)) {&lt;br /&gt;                var streamContent = new StreamContent(request.Body);&lt;br /&gt;                requestMessage.Content = streamContent;&lt;br /&gt;            }&lt;br /&gt;&lt;br /&gt;            // Copy the request headers.&lt;br /&gt;            if (requestMessage.Content != null)&lt;br /&gt;                foreach (var header in request.Headers)&lt;br /&gt;                    if (!requestMessage.Headers.TryAddWithoutValidation(header.Key, header.Value.ToArray()))&lt;br /&gt;                        requestMessage.Content?.Headers.TryAddWithoutValidation(header.Key, header.Value.ToArray());&lt;br /&gt;&lt;br /&gt;            requestMessage.Headers.Host = uri.Authority;&lt;br /&gt;            requestMessage.RequestUri = uri;&lt;br /&gt;            requestMessage.Method = new HttpMethod(request.Method);&lt;br /&gt;&lt;br /&gt;            return requestMessage;&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        public static async Task CopyProxyHttpResponse(this HttpContext context, HttpResponseMessage responseMessage) {&lt;br /&gt;            var response = context.Response;&lt;br /&gt;&lt;br /&gt;            response.StatusCode = (int) responseMessage.StatusCode;&lt;br /&gt;            foreach (var header in responseMessage.Headers) {&lt;br /&gt;                response.Headers[header.Key] = header.Value.ToArray();&lt;br /&gt;            }&lt;br /&gt;&lt;br /&gt;            if (responseMessage.Content != null) {&lt;br /&gt;                foreach (var header in responseMessage.Content.Headers) {&lt;br /&gt;                    response.Headers[header.Key] = header.Value.ToArray();&lt;br /&gt;                }&lt;br /&gt;            }&lt;br /&gt;&lt;br /&gt;            response.Headers.Remove(&amp;quot;transfer-encoding&amp;quot;);&lt;br /&gt;&lt;br /&gt;            using(var responseStream = await responseMessage.Content.ReadAsStreamAsync().ConfigureAwait(false)) {&lt;br /&gt;                await responseStream.CopyToAsync(response.Body, 81920, context.RequestAborted).ConfigureAwait(false);&lt;br /&gt;            }&lt;br /&gt;        }&lt;br /&gt;    }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1391981092955231296'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1391981092955231296'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2019/02/whitelist-proxying-with-aspnet-core.html' title='WhiteList Proxying with ASP.Net Core'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='https://3.bp.blogspot.com/-tmH5nbo_kGY/XG-8jmokKdI/AAAAAAAAN_Q/1zzN3IfRtlopNC9HTRio6HdpVCeO5jMkwCPcBGAYYCw/s72-c/hang-on-lads-ive-got-a-great-idea.jpg' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-7833811128162940766</id><published>2019-01-13T15:25:00.001Z</published><updated>2021-03-03T21:47:33.355Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='TypeScript'/><category scheme='http://www.blogger.com/atom/ns#' term='watch API'/><category scheme='http://www.blogger.com/atom/ns#' term='Webpack'/><title type='text'>TypeScript and webpack: Watch It</title><content type='html'>&lt;p&gt;All I ask for is a compiler and a tight feedback loop. Narrowing the gap between making a change to a program and seeing the effect of that is a productivity boon. The TypeScript team are wise cats and dig this. They've taken strides to improve the developer experience of TypeScript users by &lt;a href="https://github.com/Microsoft/TypeScript/wiki/Using-the-Compiler-API#writing-an-incremental-program-watcher"&gt;introducing a &amp;quot;watch&amp;quot; API which can be leveraged by other tools&lt;/a&gt;. To quote the docs:&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;TypeScript 2.7 introduces two new APIs: one for creating &amp;quot;watcher&amp;quot; programs that provide set of APIs to trigger rebuilds, and a &amp;quot;builder&amp;quot; API that watchers can take advantage of... This can speed up large projects with many files.&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;Recently the wonderful &lt;a href="https://github.com/0xorial"&gt;0xorial&lt;/a&gt; &lt;a href="https://github.com/Realytics/fork-ts-checker-webpack-plugin/pull/198"&gt;opened a PR to add support for the watch API&lt;/a&gt; to the &lt;a href="https://github.com/Realytics/fork-ts-checker-webpack-plugin"&gt;&lt;code&gt;fork-ts-checker-webpack-plugin&lt;/code&gt;&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;I took this PR for a spin on a large project that I work on.  With my machine, I was averaging 12 seconds between incremental builds. (I will charitably describe the machine in question as &amp;quot;challenged&amp;quot;; hobbled by one of the most aggressive virus checkers known to mankind. Fist bump InfoSec ) Switching to using the watch API dropped this to a mere 1.5 seconds!&lt;/p&gt;&lt;h4&gt;You Can Watch Too&lt;/h4&gt;&lt;p&gt;0xorial's PR was merged toot suite and was been released as &lt;a href="https://github.com/Realytics/fork-ts-checker-webpack-plugin/releases/tag/v1.0.0-alpha.2"&gt;&lt;code&gt;fork-ts-checker-webpack-plugin@1.0.0-alpha.2&lt;/code&gt;&lt;/a&gt;.  If you'd like to take this for a spin then you can.  Just:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;Up your version of the plugin to &lt;code&gt;fork-ts-checker-webpack-plugin@next&lt;/code&gt; in your &lt;code&gt;package.json&lt;/code&gt;&lt;/li&gt;&lt;li&gt;Add &lt;code&gt;useTypescriptIncrementalApi: true&lt;/code&gt; to the plugin when you initialise it in your &lt;code&gt;webpack.config.js&lt;/code&gt;.&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;That's it.&lt;/p&gt;&lt;h4&gt;Mary Poppins&lt;/h4&gt;&lt;p&gt;Sorry, I was trying to paint a word picture of something you might watch that was also comforting.  Didn't quite work...&lt;/p&gt;&lt;p&gt;Anyway, you might be thinking &amp;quot;wait, just hold on a minute.... he said &lt;code&gt;@next&lt;/code&gt; - I am &lt;em&gt;not&lt;/em&gt; that bleeding edge.&amp;quot;  Well, it's not like that.  Don't be scared.&lt;/p&gt;&lt;p&gt;&lt;code&gt;fork-ts-checker-webpack-plugin&lt;/code&gt; has merely been updated for webpack 5 (which is in alpha) and the &lt;code&gt;@next&lt;/code&gt; reflects that.  To be clear, the &lt;code&gt;@next&lt;/code&gt; version of the plugin still supports (remarkably!) webpack 2, 3 and 4 as well as 5 alpha.  Users of current and historic versions of webpack should feel safe using the &lt;code&gt;@next&lt;/code&gt; version; for webpack 2, 3 and 4 expect stability.  webpack 5 users should expect potential changes to align with webpack 5 as it progresses.&lt;/p&gt;&lt;h4&gt;Roadmap&lt;/h4&gt;&lt;p&gt;This is available now and we'd love for you to try it out. As you can see, at the moment it's opt-in.  You have to explicitly choose to use the new behaviour.  Depending upon how testing goes, we may look to make this the default behaviour for the plugin in future (assuming users are running a high enough version of TypeScript). It would be great to hear from people if they have any views on that, or feedback in general.&lt;/p&gt;&lt;p&gt;Much  y'all. And many thanks to the very excellent &lt;a href="https://github.com/0xorial"&gt;0xorial&lt;/a&gt; for the hard work.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7833811128162940766'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7833811128162940766'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2019/01/typescript-and-webpack-watch-it.html' title='TypeScript and webpack: Watch It'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4043118336459160524</id><published>2019-01-05T20:02:00.001Z</published><updated>2021-03-13T13:59:49.741Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='docker'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='yarn'/><category scheme='http://www.blogger.com/atom/ns#' term='GitHub Actions'/><title type='text'>GitHub Actions and Yarn</title><content type='html'>&lt;p&gt;I'd been meaning to automate the npm publishing of &lt;a href="https://github.com/TypeStrong/ts-loader"&gt;&lt;code&gt;ts-loader&lt;/code&gt;&lt;/a&gt; for the longest time. I had attempted to use Travis to do this in the same way as &lt;a href="https://github.com/Realytics/fork-ts-checker-webpack-plugin"&gt;&lt;code&gt;fork-ts-checker-webpack-plugin&lt;/code&gt;&lt;/a&gt;. Alas using secure environment variables in Travis has unfortunate implications for ts-loader's test pack.&lt;/p&gt;&lt;p&gt;Be not afeard. I've heard there's a new shiny thing from GitHub that I could use instead... It's a sign; I must use it!&lt;/p&gt;&lt;p&gt;GitHub Actions are still in beta. Technically Actions are &lt;a href="https://developer.github.com/actions/creating-github-actions/"&gt;code run in Docker containers&lt;/a&gt; in response to events.  This didn't mean a great deal to me until I started thinking about what I wanted to do with &lt;code&gt;ts-loader&lt;/code&gt;'s publishing flow.&lt;/p&gt;&lt;h4&gt;Automate What?&lt;/h4&gt;&lt;p&gt;Each time I publish a release of &lt;code&gt;ts-loader&lt;/code&gt; I execute the following node commands by hand:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;code&gt;yarn install&lt;/code&gt; - to install &lt;code&gt;ts-loader&lt;/code&gt;'s dependencies&lt;/li&gt;&lt;li&gt;&lt;code&gt;yarn build&lt;/code&gt; - to build &lt;code&gt;ts-loader&lt;/code&gt;&lt;/li&gt;&lt;li&gt;&lt;code&gt;yarn test&lt;/code&gt; - to run &lt;code&gt;ts-loader&lt;/code&gt;'s test packs&lt;/li&gt;&lt;li&gt;&lt;code&gt;npm publish&lt;/code&gt; - to publish the release of &lt;code&gt;ts-loader&lt;/code&gt; to npm&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;Having read up on GitHub Actions it seemed like they were born to handle this sort of task.&lt;/p&gt;&lt;h4&gt;GitHub Action for &lt;code&gt;npm&lt;/code&gt;&lt;/h4&gt;&lt;p&gt;I quickly discovered that someone out there &lt;s&gt;loves me&lt;/s&gt; had &lt;a href="https://github.com/actions/npm"&gt;already written a GitHub Action for &lt;code&gt;npm&lt;/code&gt;&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;The example in the &lt;code&gt;README.md&lt;/code&gt; could be easily tweaked to meet my needs with one caveat: I had to use &lt;code&gt;npm&lt;/code&gt; in place of &lt;code&gt;yarn&lt;/code&gt;. I didn't want to switch from &lt;code&gt;yarn&lt;/code&gt;. What to do?&lt;/p&gt;&lt;p&gt;Well, remember when I said actions are code run in Docker containers? Another way to phrase that is to say: GitHub Actions are Docker images. Let's look under the covers of the &lt;code&gt;npm&lt;/code&gt; GitHub Action. As we peer inside the &lt;a href="https://github.com/actions/npm/blob/e7aaefed7c9f2e83d493ff810f17fa5ccd7ed437/Dockerfile#L1"&gt;&lt;code&gt;Dockerfile&lt;/code&gt;&lt;/a&gt; what do we find?&lt;/p&gt;&lt;pre class="prettyprint console"&gt;&lt;code&gt;FROM node:10-slim&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Hmmmm.... Interesting.  The base image of the &lt;code&gt;npm&lt;/code&gt; GitHub Action is &lt;code&gt;node:10-slim&lt;/code&gt;.  Looking it up, it seems the &lt;code&gt;-slim&lt;/code&gt; Docker images come with &lt;a href="https://github.com/nodejs/docker-node/blob/master/Dockerfile-slim.template"&gt;&lt;code&gt;yarn&lt;/code&gt; included&lt;/a&gt;.  Which means we should be able to use &lt;code&gt;yarn&lt;/code&gt; inside the &lt;code&gt;npm&lt;/code&gt; GitHub Action. Nice!&lt;/p&gt;&lt;h4&gt;GitHub Action for &lt;code&gt;npm&lt;/code&gt; for &lt;code&gt;yarn&lt;/code&gt;&lt;/h4&gt;&lt;p&gt;Using &lt;code&gt;yarn&lt;/code&gt; from the GitHub Action for &lt;code&gt;npm&lt;/code&gt; is delightfully simple. Here's what running &lt;code&gt;npm install&lt;/code&gt; looks like:&lt;/p&gt;&lt;pre class="prettyprint console"&gt;&lt;code&gt;# install with npm&lt;br /&gt;action &amp;quot;install&amp;quot; {&lt;br /&gt;  uses = &amp;quot;actions/npm@1.0.0&amp;quot;&lt;br /&gt;  args = &amp;quot;install&amp;quot;&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Pivoting to use &lt;code&gt;yarn install&lt;/code&gt; instead of &lt;code&gt;npm install&lt;/code&gt; is as simple as:&lt;/p&gt;&lt;pre class="prettyprint console"&gt;&lt;code&gt;# install with yarn&lt;br /&gt;action &amp;quot;install&amp;quot; {&lt;br /&gt;  uses = &amp;quot;actions/npm@1.0.0&amp;quot;&lt;br /&gt;  runs = &amp;quot;yarn&amp;quot;&lt;br /&gt;  args = &amp;quot;install&amp;quot;&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;You can see we've introduced the &lt;code&gt;runs = &amp;quot;yarn&amp;quot;&lt;/code&gt; and after that the &lt;code&gt;args&lt;/code&gt; are whatever you need them to be.&lt;/p&gt;&lt;h4&gt;Going With The Workflow&lt;/h4&gt;&lt;p&gt;A GitHub Workflow that implements the steps I need would look like this:&lt;/p&gt;&lt;pre class="prettyprint console"&gt;&lt;code&gt;workflow &amp;quot;build, test and publish on release&amp;quot; {&lt;br /&gt;  on = &amp;quot;push&amp;quot;&lt;br /&gt;  resolves = &amp;quot;publish&amp;quot;&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;# install with yarn&lt;br /&gt;action &amp;quot;install&amp;quot; {&lt;br /&gt;  uses = &amp;quot;actions/npm@1.0.0&amp;quot;&lt;br /&gt;  runs = &amp;quot;yarn&amp;quot;&lt;br /&gt;  args = &amp;quot;install&amp;quot;&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;# build with yarn&lt;br /&gt;action &amp;quot;build&amp;quot; {&lt;br /&gt;  needs = &amp;quot;install&amp;quot;&lt;br /&gt;  uses = &amp;quot;actions/npm@1.0.0&amp;quot;&lt;br /&gt;  runs = &amp;quot;yarn&amp;quot;&lt;br /&gt;  args = &amp;quot;build&amp;quot;&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;# test with yarn&lt;br /&gt;action &amp;quot;test&amp;quot; {&lt;br /&gt;  needs = &amp;quot;build&amp;quot;&lt;br /&gt;  uses = &amp;quot;actions/npm@1.0.0&amp;quot;&lt;br /&gt;  runs = &amp;quot;yarn&amp;quot;&lt;br /&gt;  args = &amp;quot;test&amp;quot;&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;# filter for a new tag&lt;br /&gt;action &amp;quot;check for new tag&amp;quot; {&lt;br /&gt;  needs = &amp;quot;Test&amp;quot;&lt;br /&gt;  uses = &amp;quot;actions/bin/filter@master&amp;quot;&lt;br /&gt;  args = &amp;quot;tag&amp;quot;&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;# publish with npm&lt;br /&gt;action &amp;quot;publish&amp;quot; {&lt;br /&gt;  needs = &amp;quot;check for new tag&amp;quot;&lt;br /&gt;  uses = &amp;quot;actions/npm@1.0.0&amp;quot;&lt;br /&gt;  args = &amp;quot;publish&amp;quot;&lt;br /&gt;  secrets = [&amp;quot;NPM_AUTH_TOKEN&amp;quot;]&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;As you can see, this is a direct automation of steps 1-4 I listed earlier.  Since all these actions are executed in the same container, we can skip from &lt;code&gt;yarn&lt;/code&gt; to &lt;code&gt;npm&lt;/code&gt; with gay abandon.&lt;/p&gt;&lt;p&gt;What's absolutely amazing is, when I got access to GitHub Actions &lt;a href="https://github.com/TypeStrong/ts-loader/blob/master/.github/main.workflow"&gt;my hand crafted workflow&lt;/a&gt; looked like it should work first time! I know, right? Don't you love it when that happens? &lt;a href="https://github.com/actions/bin/issues/13"&gt;Alas there's presently a problem with filters in GitHub Actions&lt;/a&gt;. But that's by the by, if you're just looking to use a GitHub Action with yarn instead of npm then you are home free.&lt;/p&gt;&lt;h4&gt;You Don't Actually Need the npm GitHub Action&lt;/h4&gt;&lt;p&gt;You heard me right. Docker containers be Docker containers.  You don't actually need to use this:&lt;/p&gt;&lt;pre class="prettyprint console"&gt;&lt;code&gt;  uses = &amp;quot;actions/npm@1.0.0&amp;quot;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;You can use &lt;em&gt;any&lt;/em&gt; Docker container which has node / npm installed! So if you'd like to use say node 11 instead you could just do this:&lt;/p&gt;&lt;pre class="prettyprint console"&gt;&lt;code&gt;  uses = &amp;quot;docker://node:11&amp;quot;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Which would use the node 11 image on &lt;a href="https://hub.docker.com/_/node"&gt;docker hub&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;Which is pretty cool.  You know what's even more incredible?  Inside a workflow you can switch &lt;code&gt;uses&lt;/code&gt; mid-workflow and keep the output.  That's right; you can have a work flow with say three actions running &lt;code&gt;uses = &amp;quot;docker://node:11&amp;quot;&lt;/code&gt; and then a fourth running &lt;code&gt;uses = &amp;quot;actions/npm@1.0.0&amp;quot;&lt;/code&gt;.  That's &lt;em&gt;so&lt;/em&gt; flexible and powerful!&lt;/p&gt;&lt;p&gt;Thanks to &lt;a href="https://github.com/mcolyer"&gt;Matt Colyer&lt;/a&gt; and &lt;a href="https://github.com/LandonSchropp"&gt;Landon Schropp&lt;/a&gt; for &lt;a href="https://github.com/actions/npm/issues/9"&gt;schooling me on the intricicies of GitHub Actions&lt;/a&gt;. Much &lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4043118336459160524'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4043118336459160524'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2019/01/github-actions-and-yarn.html' title='GitHub Actions and Yarn'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5158866196168152079</id><published>2018-12-22T21:51:00.001Z</published><updated>2021-03-14T05:38:34.950Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='HappyPack'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='thread-loader'/><category scheme='http://www.blogger.com/atom/ns#' term='fork-ts-checker-webpack-plugin'/><category scheme='http://www.blogger.com/atom/ns#' term='ts-loader'/><category scheme='http://www.blogger.com/atom/ns#' term='Webpack'/><category scheme='http://www.blogger.com/atom/ns#' term='fast builds'/><title type='text'>You Might Not Need thread-loader</title><content type='html'>&lt;p&gt;It all started with a GitHub issue. &lt;a href="https://github.com/namics/webpack-config-plugins/issues/24"&gt;Ernst Ammann reported&lt;/a&gt;:&lt;/p&gt; &lt;blockquote cite="https://github.com/namics/webpack-config-plugins/issues/24"&gt;&lt;p&gt;Without the thread-loader, compilation takes three to four times less time on changes. We could remove it.&lt;/p&gt;&lt;/blockquote&gt; &lt;p&gt;If you're not aware of the &lt;a href="https://github.com/namics/webpack-config-plugins"&gt;&lt;code&gt;webpack-config-plugins&lt;/code&gt;&lt;/a&gt; project then I commend it to you. Famously, webpack configuration can prove tricky.  &lt;code&gt;webpack-config-plugins&lt;/code&gt; borrows the idea of presets from Babel. It provides a number of pluggable webpack configurations which give a best practice setup for different webpack use cases. So if you're no expert with webpack and you want a good setup for building your TypeScript / Sass / JavaScript then &lt;code&gt;webpack-config-plugins&lt;/code&gt; has got your back.&lt;/p&gt; &lt;p&gt;One of the people behind the project is the very excellent &lt;a href="https://github.com/jantimon"&gt;Jan Nicklas&lt;/a&gt; who is well known for his work on the &lt;a href="https://github.com/jantimon/html-webpack-plugin"&gt;&lt;code&gt;html-webpack-plugin&lt;/code&gt;&lt;/a&gt;.&lt;/p&gt; &lt;p&gt;It was Jan who responded to Ernst's issue and decided to look into it.&lt;/p&gt; &lt;h4&gt;All I Want For Christmas is Faster Builds&lt;/h4&gt; &lt;p&gt;Everyone wants fast builds. I do. You do. We all do. &lt;code&gt;webpack-config-plugins&lt;/code&gt; is about giving these to the user in a precooked package.&lt;/p&gt; &lt;p&gt;There's a webpack loader called &lt;a href="https://github.com/webpack-contrib/thread-loader"&gt;&lt;code&gt;thread-loader&lt;/code&gt;&lt;/a&gt; which spawns multiple processes and splits up work between them. It was originally inspired by the work in the happypack project which does a similar thing.&lt;/p&gt; &lt;p&gt;I wrote &lt;a href="https://medium.com/p/83cc568dea79"&gt;a blog post&lt;/a&gt; some time ago which gave details about ways to speed up your TypeScript builds by combining the &lt;a href="https://github.com/TypeStrong/ts-loader"&gt;&lt;code&gt;ts-loader&lt;/code&gt;&lt;/a&gt; project (which I manage) with the &lt;a href="https://github.com/Realytics/fork-ts-checker-webpack-plugin"&gt;&lt;code&gt;fork-ts-checker-webpack-plugin&lt;/code&gt;&lt;/a&gt; project (which I'm heavily involved with).&lt;/p&gt; &lt;p&gt;That post was written back in the days of webpack 2 / 3.  It advocated use of both &lt;code&gt;happypack&lt;/code&gt; / &lt;code&gt;thread-loader&lt;/code&gt; to drop your build times even further. As you'll see, now that we're well into the world of webpack 4 (with webpack 5 waiting in the wings) the advantage of &lt;code&gt;happypack&lt;/code&gt; / &lt;code&gt;thread-loader&lt;/code&gt; are no longer so profound.&lt;/p&gt; &lt;p&gt;&lt;code&gt;webpack-config-plugins&lt;/code&gt; follows the advice I set out in my post; it uses &lt;code&gt;thread-loader&lt;/code&gt; in its pluggable configurations.  Now, back to Ernst's issue.&lt;/p&gt; &lt;h4&gt;&lt;code&gt;thread-loader&lt;/code&gt;: Infinity War&lt;/h4&gt; &lt;p&gt;Jan quickly identified the problem. He did that rarest of things; he read the documentation which said:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;      // timeout for killing the worker processes when idle&lt;br /&gt;      // defaults to 500 (ms)&lt;br /&gt;      // can be set to Infinity for watching builds to keep workers alive&lt;br /&gt;      poolTimeout: 2000,&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;The &lt;code&gt;webpack-config-plugins&lt;/code&gt; configurations (running in watch mode) were subject to the thread loaders being killed after 500ms. They got resurrected when they were next needed; but that's not as instant as you might hope.  Jan then did a test:&lt;/p&gt; &lt;pre class="prettyprint console"&gt;&lt;br /&gt;&lt;code class="language-sh"&gt;&lt;br /&gt;(default pool - 30 runs - 1000 components ) average: 2.668068965517241&lt;br /&gt;(no thread-loader - 30 runs - 1000 components ) average: 1.2674137931034484&lt;br /&gt;(Infinity pool - 30 runs - 1000 components ) average: 1.371827586206896&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;This demonstrates that using &lt;code&gt;thread-loader&lt;/code&gt; in watch mode with &lt;code&gt;poolTimeout: Infinity&lt;/code&gt; performs significantly better than when it defaults to 500ms.  But perhaps more significantly, not using &lt;code&gt;thread-loader&lt;/code&gt; performs even better still.&lt;/p&gt; &lt;h4&gt;"Maybe You've Thread Enough"&lt;/h4&gt; &lt;p&gt;When I tested using &lt;code&gt;thread-loader&lt;/code&gt; in watch mode with &lt;code&gt;poolTimeout: Infinity&lt;/code&gt; on my own builds I got the same benefit Jan had.  I also got &lt;em&gt;even&lt;/em&gt; more benefit from dropping &lt;code&gt;thread-loader&lt;/code&gt; entirely.&lt;/p&gt; &lt;p&gt;A likely reason for this benefit is that typically when you're developing, you're working on one file at a time. Hence you only transpile one file at a time:&lt;/p&gt; &lt;a href="https://2.bp.blogspot.com/-u2nbxnUAJXQ/XB8y1mF6hoI/AAAAAAAANRU/biYIfBaDsDwnNA2jp_YLNrLBcXWITAM1ACPcBGAYYCw/s1600/ts-profile2.png" imageanchor="1" &gt;&lt;img border="0" src="https://2.bp.blogspot.com/-u2nbxnUAJXQ/XB8y1mF6hoI/AAAAAAAANRU/biYIfBaDsDwnNA2jp_YLNrLBcXWITAM1ACPcBGAYYCw/s640/ts-profile2.png" width="640" height="173" data-original-width="1600" data-original-height="433" /&gt;&lt;/a&gt; &lt;p&gt;So there's not a great deal of value that &lt;code&gt;thread-loader&lt;/code&gt; can add here; mostly it's twiddling thumbs and adding an overhead. &lt;a href="https://github.com/webpack-contrib/thread-loader/blob/master/README.md#usage"&gt;To quote the docs:&lt;/a&gt;&lt;/p&gt; &lt;blockquote cite="https://github.com/webpack-contrib/thread-loader/blob/master/README.md#usage"&gt;&lt;p&gt;Each worker is a separate node.js process, which has an overhead of ~600ms. There is also an overhead of inter-process communication.&lt;/p&gt; &lt;p&gt;Use this loader only for expensive operations!&lt;/p&gt;&lt;/blockquote&gt; &lt;p&gt;Now, my build is not your build. I can't guarantee that you'll get the same results as Jan and I experienced; but I would encourage you to investigate if you're using &lt;code&gt;thread-loader&lt;/code&gt; correctly and whether it's actually helping you.  In these days of webpack 4+ perhaps it isn't.&lt;/p&gt; &lt;p&gt;There are still scenarios where &lt;code&gt;thread-loader&lt;/code&gt; still provides an advantage.  It can speed up production builds.  It can speed up the initial startup of watch mode.  &lt;a href="https://github.com/webpack-contrib/thread-loader/pull/52"&gt;In fact Jan has subsequently actually improved the &lt;code&gt;thread-loader&lt;/code&gt; to that specific end.&lt;/a&gt;  Yay Jan!&lt;/p&gt; &lt;p&gt;If this is all too much for you, and you want to hand off the concern to someone else then perhaps all of this serves as a motivation to just sit back, put your feet up and start using &lt;a href="https://github.com/namics/webpack-config-plugins"&gt;&lt;code&gt;webpack-config-plugins&lt;/code&gt;&lt;/a&gt; instead of doing your own configuration.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5158866196168152079'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5158866196168152079'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2018/12/you-might-not-need-thread-loader.html' title='You Might Not Need &lt;code&gt;thread-loader&lt;/code&gt;'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='https://2.bp.blogspot.com/-u2nbxnUAJXQ/XB8y1mF6hoI/AAAAAAAANRU/biYIfBaDsDwnNA2jp_YLNrLBcXWITAM1ACPcBGAYYCw/s72-c/ts-profile2.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1068853130426832827</id><published>2018-12-10T20:48:00.002Z</published><updated>2021-03-03T13:34:53.945Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='asp net core'/><category scheme='http://www.blogger.com/atom/ns#' term='cache'/><category scheme='http://www.blogger.com/atom/ns#' term='wu-tang'/><title type='text'>Cache Rules Everything Around Me</title><content type='html'>&lt;p&gt;One thing that ASP.Net Core really got right was caching. &lt;code&gt;&lt;a href="https://docs.microsoft.com/en-us/aspnet/core/performance/caching/memory"&gt;IMemoryCache&lt;/a&gt;&lt;/code&gt; is a caching implementation that does just what I want.  I love it.  I take it everywhere.  I've introduced it to my family.&lt;/p&gt; &lt;h4&gt;TimeSpan, TimeSpan Expiration Y'all&lt;/h4&gt; &lt;p&gt;To make usage of the &lt;code&gt;IMemoryCache&lt;/code&gt; &lt;em&gt;even&lt;/em&gt; more lovely I've written an extension method.  I follow pretty much one cache strategy: &lt;code&gt;SetAbsoluteExpiration&lt;/code&gt; and I just vary the expiration by an amount of time.  This extension method implements that in a simple way; I call it &lt;code&gt;GetOrCreateForTimeSpanAsync&lt;/code&gt; - catchy right? It looks like this:&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;using System;&lt;br /&gt;using System.Threading.Tasks;&lt;br /&gt;using Microsoft.Extensions.Caching.Memory;&lt;br /&gt;&lt;br /&gt;namespace My.Helpers {&lt;br /&gt;&lt;br /&gt;    public static class CacheHelpers {&lt;br /&gt;&lt;br /&gt;        public static async Task&amp;lt;TItem&amp;gt; GetOrCreateForTimeSpanAsync&amp;lt;TItem&amp;gt;(&lt;br /&gt;            this IMemoryCache cache,&lt;br /&gt;            string key,&lt;br /&gt;            Func&amp;lt;Task&amp;lt;TItem&amp;gt;&amp;gt; itemGetterAsync,&lt;br /&gt;            TimeSpan timeToCache&lt;br /&gt;        ) {&lt;br /&gt;            if (!cache.TryGetValue(key, out object result)) {&lt;br /&gt;                result = await itemGetterAsync();&lt;br /&gt;                if (result == null)&lt;br /&gt;                    return default(TItem);&lt;br /&gt;&lt;br /&gt;                var cacheEntryOptions = new MemoryCacheEntryOptions()&lt;br /&gt;                    .SetAbsoluteExpiration(timeToCache);&lt;br /&gt;&lt;br /&gt;                cache.Set(key, result, cacheEntryOptions);&lt;br /&gt;            }&lt;br /&gt;&lt;br /&gt;            return (TItem) result;&lt;br /&gt;        }&lt;br /&gt;    }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Usage looks like this:&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;private Task&lt;SuperInterestingThing&gt; GetSuperInterestingThingFromCache(Guid superInterestingThingId) =&gt; &lt;br /&gt;    _cache.GetOrCreateForTimeSpanAsync(&lt;br /&gt;        key: $"{nameof(MyClass)}:GetSuperInterestingThing:{superInterestingThingId}",&lt;br /&gt;        itemGetterAsync: () =&gt; GetSuperInterestingThing(superInterestingThingId),&lt;br /&gt;        timeToCache: TimeSpan.FromMinutes(5)&lt;br /&gt;    );&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;This helper allows the consumer to provide three things:&lt;/p&gt; &lt;ul&gt;  &lt;li&gt;The &lt;code&gt;key&lt;/code&gt; key for the item to be cached with&lt;/li&gt;  &lt;li&gt;A &lt;code&gt;itemGetterAsync&lt;/code&gt; which is the method that is used to retrieve a new value if an item cannot be found in the cache&lt;/li&gt;  &lt;li&gt;A &lt;code&gt;timeToCache&lt;/code&gt; which is the period of time that an item should be cached&lt;/li&gt;&lt;/ul&gt; &lt;p&gt;If an item can't be looked up by the &lt;code&gt;itemGetterAsync&lt;/code&gt; then &lt;em&gt;nothing&lt;/em&gt; will be cached and a the &lt;code&gt;default&lt;/code&gt; value of the expected type will be returned.  This is important because lookups can fail, and there's nothing worse than a lookup failing and you caching &lt;code&gt;null&lt;/code&gt; as a result.&lt;/p&gt; &lt;p&gt;Go on, ask me how I know.&lt;/p&gt; &lt;p&gt;This is a simple, clear and helpful API which makes interacting with &lt;code&gt;IMemoryCache&lt;/code&gt; even more lovely than it was. Peep it y'all.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1068853130426832827'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1068853130426832827'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2018/12/cache-rules-everything-around-me.html' title='Cache Rules Everything Around Me'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1707582170882138651</id><published>2018-11-17T08:53:00.002Z</published><updated>2021-03-03T13:40:10.964Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='snapshot testing'/><category scheme='http://www.blogger.com/atom/ns#' term='c#'/><category scheme='http://www.blogger.com/atom/ns#' term='jest'/><title type='text'>Snapshot Testing for C#</title><content type='html'>&lt;p&gt;If you're a user of Jest, you've no doubt heard of and perhaps made use of &lt;a href="https://jestjs.io/docs/en/snapshot-testing"&gt;snapshot testing&lt;/a&gt;.&lt;/p&gt; &lt;p&gt;Snapshot testing is an awesome tool that is generally discussed in the context of JavaScript React UI testing. But snapshot testing has a wider application than that. Essentially it is profoundly useful where you have functions which produce a complex structured output. It could be a React UI, it could be a list of FX prices. The type of data is immaterial; it's the amount of it that's key.&lt;/p&gt; &lt;p&gt;Typically there's a direct correlation between the size and complexity of the output of a method and the length of the tests that will be written for it. Let's say you're outputting a class that contains 20 properties. Congratulations! You get to write 20 assertions in one form or another for each test case. Or a single assertion whereby you supply the expected output by hand specifying each of the 20 properties. Either way, that's not going to be fun. And just imagine the time it would take to update multiple test cases if you wanted to change the behaviour of the method in question. Ouchy.&lt;/p&gt; &lt;p&gt;Time is money kid. What you need is snapshot testing. Say goodbye to handcrafted assertions and hello to JSON serialised output checked into source control. Let's unpack that a little bit. The usefulness of snapshot testing that I want in C# is predominantly about removing the need to write and maintain multiple assertions. Instead you write tests that compare the output of a call to your method with JSON serialised output you've generated on a previous occasion.&lt;/p&gt; &lt;p&gt;This approach takes less time to write, less time to maintain and the solid readability of JSON makes it more likely you'll pick up on bugs. It's so much easier to scan JSON than it is a list of assertions.&lt;/p&gt; &lt;h4&gt;Putting the Snapshot into C#&lt;/h4&gt; &lt;p&gt;Now if you're writing tests in JavaScript or TypeScript then Jest already has your back with CLI snapshot generation and &lt;code&gt;shouldMatchSnapshot&lt;/code&gt;. However getting to nearly the same place in C# is delightfully easy. What are we going to need? &lt;/p&gt; &lt;p&gt;First up, a serializer which can take your big bad data structures and render them as JSON. Also we'll use it to rehydrate our data structure into an object ready for comparison. We're going to use &lt;a href="https://www.newtonsoft.com/json"&gt;Json.NET&lt;/a&gt;.&lt;/p&gt; &lt;p&gt;Next up we need a way to compare our outputs with our rehydrated snapshots - we need a C# &lt;code&gt;shouldMatchSnapshot&lt;/code&gt;. There's many choices out there, but for my money &lt;a href="https://fluentassertions.com"&gt;Fluent Assertions&lt;/a&gt; is king of the hill.&lt;/p&gt; &lt;p&gt;Finally we're going to need Snapshot, a little helper utility I put together:&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;using System;&lt;br /&gt;using System.IO;&lt;br /&gt;using Newtonsoft.Json;&lt;br /&gt;using Newtonsoft.Json.Serialization;&lt;br /&gt;&lt;br /&gt;namespace Test.Utilities {&lt;br /&gt;    public static class Snapshot {&lt;br /&gt;        private static readonly JsonSerializer StubSerializer = new JsonSerializer { &lt;br /&gt;            ContractResolver = new CamelCasePropertyNamesContractResolver(),&lt;br /&gt;            NullValueHandling = NullValueHandling.Ignore &lt;br /&gt;        };&lt;br /&gt;&lt;br /&gt;        private static JsonTextWriter MakeJsonTextWriter(TextWriter sw) =&gt; new JsonTextWriter(sw) {&lt;br /&gt;            Formatting = Formatting.Indented,&lt;br /&gt;            IndentChar = ' ',&lt;br /&gt;            Indentation = 2&lt;br /&gt;        };&lt;br /&gt;&lt;br /&gt;        /// &amp;lt;summary&amp;gt;&lt;br /&gt;        /// Make yourself some JSON! Usage looks like this:&lt;br /&gt;        /// Stubs.Make($"{System.AppDomain.CurrentDomain.BaseDirectory}..\\..\\..\\data.json", myData);&lt;br /&gt;        /// &amp;lt;/summary&amp;gt;&lt;br /&gt;        public static void Make&amp;lt;T&amp;gt;(string stubPath, T data) {&lt;br /&gt;            try {&lt;br /&gt;                if (string.IsNullOrEmpty(stubPath))&lt;br /&gt;                    throw new ArgumentNullException(nameof(stubPath));&lt;br /&gt;                if (data == null)&lt;br /&gt;                    throw new ArgumentNullException(nameof(data));&lt;br /&gt;&lt;br /&gt;                using(var sw = new StreamWriter(stubPath))&lt;br /&gt;                using(var writer = MakeJsonTextWriter(sw)) {&lt;br /&gt;                    StubSerializer.Serialize(writer, data);&lt;br /&gt;                }&lt;br /&gt;            } catch (Exception exc) {&lt;br /&gt;                throw new Exception($"Failed to make {stubPath}", exc);&lt;br /&gt;            }&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        public static string Serialize&amp;lt;T&amp;gt;(T data) {&lt;br /&gt;            using (var sw = new StringWriter())&lt;br /&gt;            using(var writer = MakeJsonTextWriter(sw)) {&lt;br /&gt;                StubSerializer.Serialize(writer, data);&lt;br /&gt;                return sw.ToString();&lt;br /&gt;            }&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        public static string Load(string filename) {&lt;br /&gt;            var content = new StreamReader(&lt;br /&gt;                File.OpenRead(filename)&lt;br /&gt;            ).ReadToEnd();&lt;br /&gt;&lt;br /&gt;            return content;&lt;br /&gt;        }&lt;br /&gt;    }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Let's look at the methods: &lt;code&gt;Make&lt;/code&gt; and &lt;code&gt;Load&lt;/code&gt;. Make is what we're going to use to create our snapshots. Load is what we're going to use to, uh, load our snapshots.&lt;/p&gt; &lt;p&gt;What does usage look like?  Great question. Let's go through the process of writing a C# snapshot test.&lt;/p&gt; &lt;h4&gt;Taking Snapshot for a Spin&lt;/h4&gt; &lt;p&gt;First of all, we're going to need a method to test that outputs a data structure which is more than just a scalar value. Let's use this:&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;public class Leopard {&lt;br /&gt;    public string Name { get; set; }&lt;br /&gt;    public int Spots { get; set; }&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;public class LeopardService {&lt;br /&gt;    public Leopard[] GetTheLeopards() {&lt;br /&gt;        return new Leopard[] {&lt;br /&gt;            new Leopard { Spots = 42, Name = "Nimoy" },&lt;br /&gt;            new Leopard { Spots = 900, Name = "Dotty" }&lt;br /&gt;        };&lt;br /&gt;    }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Yes - our trusty &lt;code&gt;LeopardService&lt;/code&gt;.  As you can see, the &lt;code&gt;GetTheLeopards&lt;/code&gt; method returns an array of &lt;code&gt;Leopard&lt;/code&gt;s. For now, let's write a test using &lt;code&gt;Snapshot&lt;/code&gt;: (ours is an XUnit test; but &lt;code&gt;Snapshot&lt;/code&gt; is agnostic of this)&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;[Fact]&lt;br /&gt;public void GetTheLeopards_should_return_expected_Leopards() {&lt;br /&gt;    // Arrange&lt;br /&gt;    var leopardService = new LeopardService();&lt;br /&gt;&lt;br /&gt;    // Act&lt;br /&gt;    var leopards = leopardService.GetTheLeopards();&lt;br /&gt;    &lt;br /&gt;    // UNCOMMENT THE LINE BELOW *ONLY* WHEN YOU WANT TO GENERATE THE SNAPSHOT&lt;br /&gt;    Snapshot.Make($"{System.AppDomain.CurrentDomain.BaseDirectory}..\\..\\..\\Snapshots\\leopardsSnapshot.json", leopards);&lt;br /&gt;&lt;br /&gt;    // Assert&lt;br /&gt;    var snapshotLeopards = JsonConvert.DeserializeObject&lt;Leopard[]&gt;(Snapshot.Load("Snapshots/leopardsSnapshot.json"));&lt;br /&gt;    snapshotLeopards.Should().BeEquivalentTo(leopards);&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Before we run this for the first time we need to setup our testing project to be ready for snapshots.  First of all we add a &lt;code&gt;Snapshot&lt;/code&gt; folder to the test project.  The we also add the following to the &lt;code&gt;.csproj&lt;/code&gt;:&lt;/p&gt; &lt;pre class="prettyprint xml"&gt;&lt;br /&gt;&lt;code class="language-xml"&gt;&lt;br /&gt;  &amp;lt;ItemGroup&amp;gt;&lt;br /&gt;    &amp;lt;Content Include="Snapshots\**"&amp;gt;&lt;br /&gt;      &amp;lt;CopyToOutputDirectory&amp;gt;Always&amp;lt;/CopyToOutputDirectory&amp;gt;&lt;br /&gt;    &amp;lt;/Content&amp;gt;&lt;br /&gt;  &amp;lt;/ItemGroup&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;This includes the snapshots in the compile output for when tests are being run.&lt;/p&gt; &lt;p&gt;Now let's run the test.  It will generate a &lt;code&gt;leopardsSnapshot.json&lt;/code&gt; file:&lt;/p&gt; &lt;pre class="prettyprint json"&gt;&lt;br /&gt;&lt;code class="language-json"&gt;&lt;br /&gt;[&lt;br /&gt;  {&lt;br /&gt;    "name": "Nimoy",&lt;br /&gt;    "spots": 42&lt;br /&gt;  },&lt;br /&gt;  {&lt;br /&gt;    "name": "Dotty",&lt;br /&gt;    "spots": 900&lt;br /&gt;  }&lt;br /&gt;]&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;With our snapshot in place, we comment out the &lt;code&gt;Snapshot.Make...&lt;/code&gt; line and we have a passing test.  Let's commit our code, push and go about our business.&lt;/p&gt; &lt;h4&gt;Time Passes...&lt;/h4&gt; &lt;p&gt;Someone decides that the implementation of &lt;code&gt;GetTheLeopards&lt;/code&gt; needs to change. Defying expectations it seems that Dotty the leopard should now have 90 spots.  I know...  Business requirements, right?&lt;/p&gt; &lt;p&gt;If we make that change we'd ideally expect our trusty test to fail.  Let's see what happens:&lt;/p&gt; &lt;pre class="prettyprint console"&gt;&lt;br /&gt;&lt;code&gt;&lt;br /&gt;----- Test Execution Summary -----&lt;br /&gt;&lt;br /&gt;Leopard.Tests.Services.LeopardServiceTests.GetTheLeopards_should_return_expected_Leopards:&lt;br /&gt;    Outcome: Failed&lt;br /&gt;    Error Message:&lt;br /&gt;    Expected item[1].Spots to be 90, but found 900.&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Boom! We are protected!&lt;/p&gt; &lt;p&gt;Since this is a change we're completely happy with we want to update our &lt;code&gt;leopardsSnapshot.json&lt;/code&gt; file.  We could make our test pass by manually updating the JSON.  That'd be fine.  But why work when you don't have to?  Let's uncomment our &lt;code&gt;Snapshot.Make...&lt;/code&gt; line and run the test the once.&lt;/p&gt; &lt;pre class="prettyprint json"&gt;&lt;br /&gt;&lt;code class="language-json"&gt;&lt;br /&gt;[&lt;br /&gt;  {&lt;br /&gt;    "name": "Nimoy",&lt;br /&gt;    "spots": 42&lt;br /&gt;  },&lt;br /&gt;  {&lt;br /&gt;    "name": "Dotty",&lt;br /&gt;    "spots": 90&lt;br /&gt;  }&lt;br /&gt;]&lt;br /&gt;&lt;/pre&gt;&lt;/code&gt; &lt;p&gt;That's right, we have an updated snapshot!  Minimal effort.&lt;/p&gt; &lt;h4&gt;Next Steps&lt;/h4&gt; &lt;p&gt;This is a basic approach to getting the goodness of snapshot testing in C#.  It could be refined further.  To my mind the uncommenting / commenting of code is not the most elegant way to approach this and so there's some work that could be done around this area.&lt;/p&gt; &lt;p&gt;Happy snapshotting!&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1707582170882138651'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1707582170882138651'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2018/11/snapshot-testing-for-c.html' title='Snapshot Testing for C#'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3174259248023086407</id><published>2018-10-27T18:44:00.000+01:00</published><updated>2018-10-28T18:22:28.200Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='coding bootcamp'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='retrospective'/><category scheme='http://www.blogger.com/atom/ns#' term='learning'/><category scheme='http://www.blogger.com/atom/ns#' term='feedback'/><title type='text'>Making a Programmer</title><content type='html'>&lt;p&gt;I recently had the good fortune to help run a coding bootcamp. The idea was simple: there are many people around us who are interested in programming but don't know where to start. Let's take some folk who do and share the knowledge.&lt;/p&gt; &lt;p&gt;The bootcamp went tremendously! (Well, I say that... Frankly I had a blast.  )&lt;/p&gt; &lt;p&gt;Coding padawans walked in at the start with laptops and questions, and six weeks later they left with the groundwork of development experience. We ran a session for an hour during lunchtime once a week.  Between that, people would have the opportunity to learn online, do exercises and reach out to the facilitators and their fellow apprentices for help.&lt;/p&gt; &lt;p&gt;We'd never done this before. We were student teachers; learning how to teach as we ran the course. So what did we do? Are you curious? Read on, Macduff!&lt;/p&gt; &lt;h4&gt;Code Review&lt;/h4&gt; &lt;p&gt;It's worth saying now that we started our course with a plan: the plan was that we would be ready to change the plan. Or to put it another way, we were ready to pivot as we went.&lt;/p&gt; &lt;p&gt;We (by which I mean myself and the other course organisers) are interested in feedback. Sitting back and saying "Hey! We did this thing.... What do you think about it?" Because sometimes your plans are great. Do more of that hotness! But also, not all your ideas pan out... Maybe bail on those guys. Finally, never forget: other folk have brain tickling notions too.... We're with Picasso on this: good artists copy; great artists steal.&lt;/p&gt; &lt;p&gt;We're heavily invested in feedback in both what we build and how we build it. So we were totally going to apply this to doing something we'd never done before. So seized were we of this that we made feedback part of the session. For the last five minutes each week we'd run a short retrospective. We'd stick up happy, sad and "meh" emojis to the wall, hand out post-its and everyone got to stick up their thoughts. &lt;/p&gt; &lt;a href="https://4.bp.blogspot.com/-iMa4bY7-wQA/W9Scd3s1QYI/AAAAAAAAMpY/IqdRIhTAuekj-5e7Yt4VOt55gtWmkbmTQCPcBGAYYCw/s1600/not-so-sure-about-this-feedback.jpg" imageanchor="1" &gt;&lt;img border="0" src="https://4.bp.blogspot.com/-iMa4bY7-wQA/W9Scd3s1QYI/AAAAAAAAMpY/IqdRIhTAuekj-5e7Yt4VOt55gtWmkbmTQCPcBGAYYCw/s400/not-so-sure-about-this-feedback.jpg" width="400" height="341" data-original-width="1600" data-original-height="1362" /&gt;&lt;/a&gt; &lt;p&gt;From that we learned what was working, what wasn't and when we were very lucky there were suggestions too. We listened to all the feedback and the next week's session would be informed by what we'd just learned.&lt;/p&gt; &lt;h4&gt;Merging to Master&lt;/h4&gt; &lt;p&gt;So, what did we end up with? What did our coding bootcamp look like?&lt;/p&gt; &lt;p&gt;Well, to start each session we kicked off with an icebreaker. We very much wanted the sessions to be interactive experiences; we wanted them to feel playful and human. So an icebreaker was a good way to get things off on the right foot. &lt;/p&gt; &lt;p&gt;The IBs were connected with the subject at hand. For example: Human FizzBuzz.  We took the classic interview question and applied it to wannabe coders. We explained the rules, and went round in a circle, each person was the next iteration of the loop. As each dev-in-training opened their mouths they had to say a number or "Fizz" or "Buzz" or "FizzBuzz". (It turns out this is harder than you think; and makes for a surprisingly entertaining parlour game. I intend to do this at my next dinner party.)&lt;/p&gt; &lt;p&gt;After that we covered the rules of the game. (Yup, learning is a game and it's a good 'un.) Certainly the most important rule was this: &lt;u&gt;there are &lt;strong&gt;*no*&lt;/strong&gt; stupid questions&lt;/u&gt;. If people think there are, then they might be hesitant to ask. And any question benched is a learning opportunity lost. We don't want that.&lt;/p&gt; &lt;p&gt;"Ask any question!" we said each week. Kudos to the people who have the courage to pipe up. We salute you! You're likely putting voice to a common area of misunderstanding.&lt;/p&gt; &lt;p&gt;Then we'd move onto the main content. The initial plan was to make use of the excellent &lt;a href="https://www.edx.org/learn/python"&gt;EdX Python course&lt;/a&gt; Between each session our learners would do a module and then we'd come together and talk around that topic somewhat. Whilst this was a good initial plan it did make the learning experience somewhat passive and less interactive than we'd hoped.&lt;/p&gt; &lt;p&gt;One week we tried something different. It turns out that the amazing &lt;a href="https://twitter.com/foldr"&gt;JMac&lt;/a&gt; has quite the skill for writing programming exercises. Small coding challenges that people can tackle independently. JMac put together a &lt;a href="https://repl.it/"&gt;repl.it&lt;/a&gt; of exercises and encouraged the class to get stuck in. They did. So much so that at the end of the session it was hard to get everyone's attention to let them know the session was over. They were in the zone. When we did finally disrupt their flow, the feedback was pretty unanimous: we'd hit paydirt.&lt;/p&gt; &lt;a href="https://1.bp.blogspot.com/-vp4c9lrAXSc/W9Sc8-UeaRI/AAAAAAAAMpc/WtirbF3gNv0L1eni5eBVImjGA8DpQXJPgCLcBGAs/s1600/we-dug-this-feedback.jpg" imageanchor="1" &gt;&lt;img border="0" src="https://1.bp.blogspot.com/-vp4c9lrAXSc/W9Sc8-UeaRI/AAAAAAAAMpc/WtirbF3gNv0L1eni5eBVImjGA8DpQXJPgCLcBGAs/s400/we-dug-this-feedback.jpg" width="400" height="357" data-original-width="1600" data-original-height="1428" /&gt;&lt;/a&gt; &lt;p&gt;Consequently, that was the format going onwards. JMac would come up with a number of exercises for the class. Wisely they were constructed so that they gently levelled up in terms of complexity as you went on. You'd get the dopamine hit of satisfaction as you did the earliest challenges that would give you the confidence to tackle the more complex later problems. If peeps got stuck they could ask someone to advise them, a facilitator or a peer. Or they could google it.... Like any other dev.&lt;/p&gt; &lt;p&gt;Having the chance to talk with others when you're stuck is fantastic. You can talk through a problem. The act of doing that is a useful exercise. When you talk through a problem out loud you can unlock your understanding and often get to the point where you can tackle this yourself. This is &lt;a href="https://en.wikipedia.org/wiki/Rubber_duck_debugging"&gt;rubber duck debugging&lt;/a&gt;. Any dev does this in their everyday; it makes complete sense to have it as part of a coding bootcamp.&lt;/p&gt; &lt;p&gt;We learned that it was useful, very useful, to have repitition in the exercises. Repitition. Repitition. Repitition. As the exercises started each week they would typically begin by recapping and repeating the content covered the previous week. The best way to learn is to practice. It's not for nothing the Karate Kid had to "wax on, wax off".&lt;/p&gt; &lt;p&gt;Finally, we did this together. The course wasn't run by one person; we had a gang!  We had three facilitators who helped to run the sessions; JMac, Jonesy and myself.  We also had the amazing &lt;a href="https://twitter.com/janicewarden"&gt;Janice&lt;/a&gt; who handled the general organisation and logistics. And made us laugh. A lot. This was obviously great from a camaraderie and sharing the load perspective.  It turns out that having that number of facilitators in the session meant that everyone who needed help could get it.  It's worth noting that having more than a single facilitator is useful in terms of the dynamic it creates.  You can bounce things off one another; you can use each other for examples and illustrations. You can crack each other up. Done well it reduces the instructor / learner divide and that breaking down of barriers is something worth seeking.&lt;/p&gt; &lt;h4&gt;RTM&lt;/h4&gt; &lt;p&gt;We've run a bootcamp once now.  Where we are is informed by the experience we've just had. A different group of learners may well have resulted in a slightly different format; though I have a feeling not overly dissimilar. We feel pretty sure that what we've got is pretty solid.  That said, just as the attendees are learning about development, we're still learning about learning!&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3174259248023086407'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3174259248023086407'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2018/10/making-a-programmer.html' title='Making a Programmer'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='https://4.bp.blogspot.com/-iMa4bY7-wQA/W9Scd3s1QYI/AAAAAAAAMpY/IqdRIhTAuekj-5e7Yt4VOt55gtWmkbmTQCPcBGAYYCw/s72-c/not-so-sure-about-this-feedback.jpg' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3733275461627795849</id><published>2018-10-07T06:17:00.003+01:00</published><updated>2021-03-14T05:37:28.391Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='brand icons'/><category scheme='http://www.blogger.com/atom/ns#' term='React'/><category scheme='http://www.blogger.com/atom/ns#' term='font awesome'/><title type='text'>Brand New Fonting Awesomeness</title><content type='html'>&lt;p&gt;Love me some &lt;a href="https://fontawesome.com"&gt;Font Awesome&lt;/a&gt;.  Absolutely wonderful.  However, I came a cropper when following the instructions &lt;a href="https://fontawesome.com/how-to-use/on-the-web/using-with/react"&gt;on using the all new Font Awesome 5 with React&lt;/a&gt;.  The instructions for standard icons work &lt;em&gt;fine&lt;/em&gt;.  But if you want to use brand icons then this does not help you out much.  There's 2 problems:&lt;/p&gt; &lt;ol&gt;&lt;li&gt;Font Awesome's brand icons are not part of &lt;code&gt;&lt;a href="https://www.npmjs.com/package/@fortawesome/free-solid-svg-icons"&gt;@fortawesome/free-solid-svg-icons&lt;/a&gt;&lt;/code&gt; package&lt;/li&gt;&lt;li&gt;The method of icon usage illustrated (i.e. with the &lt;code&gt;FontAwesomeIcon&lt;/code&gt; component) doesn't work. It doesn't render owt.&lt;/li&gt;&lt;/ol&gt; &lt;h4&gt;Brand Me Up Buttercup&lt;/h4&gt; &lt;p&gt;You want brands?  Well you need the &lt;code&gt;&lt;a href="https://www.npmjs.com/package/@fortawesome/free-brands-svg-icons"&gt;@fortawesome/free-brands-svg-icons&lt;/a&gt;&lt;/code&gt;.  Obvs, right?&lt;/p&gt; &lt;pre class="prettyprint console"&gt;&lt;br /&gt;&lt;code class="language-sh"&gt;&lt;br /&gt;yarn add @fortawesome/fontawesome-svg-core&lt;br /&gt;yarn add @fortawesome/free-brands-svg-icons&lt;br /&gt;yarn add @fortawesome/react-fontawesome&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Now usage:&lt;/p&gt; &lt;pre class="prettyprint tsx"&gt;&lt;br /&gt;&lt;code class="language-jsx"&gt;&lt;br /&gt;import * as React from 'react'&lt;br /&gt;import { FontAwesomeIcon } from '@fortawesome/react-fontawesome';&lt;br /&gt;import { faReact } from '@fortawesome/free-brands-svg-icons';&lt;br /&gt;&lt;br /&gt;export const Framework = () =&gt; (&lt;br /&gt;  &amp;lt;div&amp;gt;&lt;br /&gt;    Favorite Framework: &amp;lt;FontAwesomeIcon icon={faReact} /&amp;gt;&lt;br /&gt;  &amp;lt;/div&amp;gt;&lt;br /&gt;)&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Here we've ditched the "library / magic-string" approach from the documentation for one which explicitly imports and uses the required icons.  I suspect this will be good for tree-shaking as well but, hand-on-heart, I haven't rigorously tested that. I'm not sure why the approach I'm using isn't documented actually.  Mysterious! I've seen no ill-effects from using it but perhaps YMMV.  Proceed with caution...&lt;/p&gt; &lt;h4&gt;Update: It is documented!&lt;/h4&gt; &lt;p&gt;Yup - information on this approach is out there; but it's less obvious than you might hope.  &lt;a href="https://github.com/FortAwesome/react-fontawesome#explicit-import"&gt;Read all about it here.&lt;/a&gt;  For what it's worth, the explicit import approach seems to be playing second fiddle to the library / magic-string one. I'm not too sure why. For my money, explicit imports are clearer, less prone to errors and better setup for optimisation. Go figure...&lt;/p&gt; &lt;p&gt;Feel free to set me straight in the comments!&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3733275461627795849'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3733275461627795849'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2018/10/font-awesome-brand-icons-react.html' title='Brand New Fonting Awesomeness'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1041771038991497498</id><published>2018-09-23T20:19:00.002+01:00</published><updated>2021-03-14T05:36:36.149Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='TypeScript'/><category scheme='http://www.blogger.com/atom/ns#' term='project references'/><category scheme='http://www.blogger.com/atom/ns#' term='ts-loader'/><category scheme='http://www.blogger.com/atom/ns#' term='Webpack'/><title type='text'>ts-loader Project References: First Blood</title><content type='html'>&lt;p&gt;So &lt;a href="https://www.typescriptlang.org/docs/handbook/project-references.html"&gt;project references&lt;/a&gt; eh? They shipped with &lt;a href="https://blogs.msdn.microsoft.com/typescript/2018/07/30/announcing-typescript-3-0/#project-references"&gt;TypeScript 3&lt;/a&gt;. We've just shipped initial support for project references in &lt;a href="https://github.com/TypeStrong/ts-loader/releases/tag/v5.2.0"&gt;&lt;code&gt;ts-loader v5.2.0&lt;/code&gt;&lt;/a&gt;. All the hard work was done by the amazing &lt;a href="https://twitter.com/atcb"&gt;Andrew Branch&lt;/a&gt;. In fact I'd recommend taking a gander at &lt;a href="https://github.com/TypeStrong/ts-loader/pull/817"&gt;the PR&lt;/a&gt;. Yay Andrew!&lt;/p&gt; &lt;p&gt;This post will take us through the nature of the support for project references in ts-loader now and what we hope the future will bring.  It &lt;strike&gt;rips off shamelessly&lt;/strike&gt; borrows from the &lt;a href="https://github.com/TypeStrong/ts-loader#projectreferences-boolean-defaultfalse"&gt;&lt;code&gt;README.md&lt;/code&gt;&lt;/a&gt; documentation that Andrew wrote as part of the PR. Because I am not above stealing.&lt;/p&gt; &lt;h4&gt;TL;DR&lt;/h4&gt; &lt;p&gt;Using project references currently requires building referenced projects outside of ts-loader. We dont want to keep it that way, but were releasing what weve got now. To try it out, youll need to pass &lt;code&gt;projectReferences: true&lt;/code&gt; to &lt;code&gt;loaderOptions&lt;/code&gt;.&lt;/p&gt; &lt;h4&gt;Like &lt;code&gt;tsc&lt;/code&gt;, but &lt;em&gt;not&lt;/em&gt; like &lt;code&gt;tsc --build&lt;/code&gt;&lt;/h4&gt; &lt;p&gt;ts-loader has partial support for &lt;a href="https://www.typescriptlang.org/docs/handbook/project-references.html"&gt;project references&lt;/a&gt; in that it will &lt;em&gt;load&lt;/em&gt; dependent composite projects that are already built, but will not currently &lt;em&gt;build/rebuild&lt;/em&gt; those upstream projects. The best way to explain exactly what this means is through an example. Say you have a project with a project reference pointing to the &lt;code&gt;lib/&lt;/code&gt; directory:&lt;/p&gt; &lt;pre class="prettyprint console"&gt;&lt;br /&gt;&lt;code class="language-sh"&gt;&lt;br /&gt;tsconfig.json&lt;br /&gt;app.ts&lt;br /&gt;lib/&lt;br /&gt;  tsconfig.json&lt;br /&gt;  niftyUtil.ts&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;And well assume that the root &lt;code&gt;tsconfig.json&lt;/code&gt; has &lt;code&gt;{ "references": { "path": "lib" } }&lt;/code&gt;, which means that any import of a file thats part of the &lt;code&gt;lib&lt;/code&gt; sub-project is treated as a reference to another project, not just a reference to a TypeScript file. Before discussing how ts-loader handles this, its helpful to review at a really basic level what &lt;code&gt;tsc&lt;/code&gt; itself does here. If you were to run &lt;code&gt;tsc&lt;/code&gt; on this tiny example project, the build would fail with the error:&lt;/p&gt; &lt;pre class="prettyprint console"&gt;&lt;br /&gt;&lt;code class="language-sh"&gt;&lt;br /&gt;error TS6305: Output file 'lib/niftyUtil.d.ts' has not been built from source file 'lib/niftyUtil.ts'.&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Using project references actually instructs &lt;code&gt;tsc&lt;/code&gt; &lt;em&gt;not&lt;/em&gt; to build anything thats part of another project from source, but rather to look for any &lt;code&gt;.d.ts&lt;/code&gt; and &lt;code&gt;.js&lt;/code&gt; files that have already been generated from a previous build. Since weve never built the project in &lt;code&gt;lib&lt;/code&gt; before, those files dont exist, so building the root project fails. Still just thinking about how &lt;code&gt;tsc&lt;/code&gt; works, there are two options to make the build succeed: either run &lt;code&gt;tsc -p lib/tsconfig.json&lt;/code&gt; &lt;em&gt;first&lt;/em&gt;, or simply run &lt;code&gt;tsc --build&lt;/code&gt;, which will figure out that &lt;code&gt;lib&lt;/code&gt; hasnt been built and build it first for you.&lt;/p&gt; &lt;p&gt;Ok, so how is that relevant to ts-loader? Because the best way to think about what ts-loader does with project references is that it acts like &lt;code&gt;tsc&lt;/code&gt;, but &lt;em&gt;not&lt;/em&gt; like &lt;code&gt;tsc --build&lt;/code&gt;. If you run ts-loader on a project thats using project references, and any upstream project hasnt been built, youll get the exact same &lt;code&gt;error TS6305&lt;/code&gt; that you would get with &lt;code&gt;tsc&lt;/code&gt;. If you modify a source file in an upstream project and dont rebuild that project, &lt;code&gt;ts-loader&lt;/code&gt; wont have any idea that youve changed anythingit will still be looking at the output from the last time you &lt;em&gt;built&lt;/em&gt; that file.&lt;/p&gt; &lt;h4&gt;Hey, dont you think that sounds kind of useless and terrible?&lt;/h4&gt; &lt;p&gt;Well, sort of. You can consider it a work-in-progress. Its true that on its own, as of today, ts-loader doesnt have everything you need to take advantage of project references in webpack. In practice, though, &lt;em&gt;consuming&lt;/em&gt; upstream projects and &lt;em&gt;building&lt;/em&gt; upstream projects are somewhat separate concerns. Building them will likely come in a future release. For background, see the &lt;a href="https://github.com/TypeStrong/ts-loader/issues/815"&gt;original issue&lt;/a&gt;.&lt;/p&gt; &lt;h4&gt;&lt;code&gt;outDir&lt;/code&gt; Windows problemo.&lt;/h4&gt; &lt;p&gt;At the moment, composite projects built using the &lt;a href="https://www.typescriptlang.org/docs/handbook/compiler-options.html"&gt;&lt;code&gt;outDir&lt;/code&gt; compiler option&lt;/a&gt; cannot be consumed using ts-loader on Windows. If you try to, ts-loader throws a "&lt;code&gt;has not been built from source file&lt;/code&gt;" error.  &lt;a href="https://github.com/TypeStrong/ts-loader/pull/817#issuecomment-422245998"&gt;You can see Andrew and I puzzling over it in the PR.&lt;/a&gt; We don't know why yet; it's possible there's a bug in &lt;code&gt;tsc&lt;/code&gt;. It's more likely there's a bug in &lt;code&gt;ts-loader&lt;/code&gt;. Hopefully it's going to get solved at some point. (Hey, maybe you're the one to solve it!) Either way, we didn't want to hold back from releasing. So if you're building on Windows then avoid building &lt;code&gt;composite&lt;/code&gt; projects using &lt;code&gt;outDir&lt;/code&gt;.&lt;/p&gt; </content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1041771038991497498'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1041771038991497498'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2018/09/ts-loader-project-references-first-blood.html' title='ts-loader Project References: First Blood'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5467447157877868223</id><published>2018-09-15T07:51:00.001+01:00</published><updated>2021-03-04T05:18:43.229Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='react-router'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='DefinitelyTyped'/><category scheme='http://www.blogger.com/atom/ns#' term='Ivan Drago'/><category scheme='http://www.blogger.com/atom/ns#' term='TypeScript'/><category scheme='http://www.blogger.com/atom/ns#' term='semantic versioning'/><title type='text'>Ivan Drago and Definitely Typed</title><content type='html'>&lt;p&gt;This a tale of things that are and things that aren't.  It's a tale of semantic versioning, the lack thereof and heartbreak.  It's a story of terror and failing builds.  But it has a bittersweet ending wherein our heroes learn a lesson and understand the need for compromise.  We all come out better and wiser people.  Hopefully there's something for everybody; let's start with an exciting opener and see where it goes...&lt;/p&gt; &lt;h4&gt;Definitely Typed&lt;/h4&gt; &lt;p&gt;This is often the experience people have of using type definitions from Definitely Typed:&lt;/p&gt; &lt;a href="https://1.bp.blogspot.com/-mG6pw3oJA4E/W5tD5vgfD4I/AAAAAAAAMQQ/upV1w2nJw1whI7MGp9HI5pniFEbVTJNxACPcBGAYYCw/s1600/i-must-break-you.jpg" imageanchor="1" &gt;&lt;img border="0" src="https://1.bp.blogspot.com/-mG6pw3oJA4E/W5tD5vgfD4I/AAAAAAAAMQQ/upV1w2nJw1whI7MGp9HI5pniFEbVTJNxACPcBGAYYCw/s1600/i-must-break-you.jpg" data-original-width="500" data-original-height="486" /&gt;&lt;/a&gt; &lt;p&gt;Specifically, people are used to the idea of semantic versioning and expect it from types published to npm by Definitely Typed.  They wait in vain.  &lt;a href="https://blog.johnnyreilly.com/2017/02/typescript-types-and-repeatable-builds.html"&gt;I've written before about the Definitely Typed / @types semantic version compromise.&lt;/a&gt;  And I wanted to talk about it a little further as (watching the issues raised on DT) I don't think the message has quite got out there. To summarise:&lt;/p&gt; &lt;ol&gt; &lt;li&gt;&lt;p&gt;npm is built on top of &lt;a href="http://semver.org/"&gt;semantic versioning&lt;/a&gt; and they &lt;a href="https://docs.npmjs.com/getting-started/semantic-versioning"&gt;take it seriously&lt;/a&gt;.  When a package is published it should be categorised as a major release (breaking changes), a minor release (extra functionality which is backwards compatible) or a patch release (backwards compatible bug fixes).&lt;/p&gt;&lt;/li&gt; &lt;li&gt;&lt;p&gt;Definitely Typed publishes type definitions to npm under the &lt;code&gt;@types&lt;/code&gt; namespace&lt;/p&gt;&lt;/li&gt; &lt;li&gt;&lt;p&gt;To make consumption of type definitions easier, the versioning of a type definition package will seek to emulate the versioning of the npm package it supports. For example, right now &lt;code&gt;&lt;a href="https://www.npmjs.com/package/react-router"&gt;react-router&lt;/a&gt;&lt;/code&gt;'s latest version is &lt;code&gt;4.3.1&lt;/code&gt;. The corresponding type definition &lt;code&gt;&lt;a href="https://www.npmjs.com/package/@types/react-router"&gt;@types/react-router&lt;/a&gt;&lt;/code&gt;'s latest version is &lt;code&gt;4.0.31&lt;/code&gt;. (It's fairly common for type definition versions to lag behind the package they type.)&lt;/p&gt; &lt;p&gt;If there's a breaking change to the &lt;code&gt;react-router&lt;/code&gt; type definition then the new version published will have a version number that begins &lt;code&gt;"4.0."&lt;/code&gt;.  If you are relying on semantic versioning this will break you.&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt; &lt;h4&gt;I Couldn't Help But Notice Your Pain&lt;/h4&gt; &lt;p&gt;If you're reading this and can't quite believe that @types would be so inconsiderate as to break the conventions of the ecosystem it lives in, I understand. But hopefully you can see there are reasons for this. In the end, being able to use npm as a delivery mechanism for versioned type definitions associated with another package has a cost; that cost is semantic versioning for the type definitions themselves. It wasn't a choice taken lightly; it's a pragmatic compromise.&lt;/p&gt; &lt;p&gt;"But what about my failing builds? Fine, people are going to change type definitions, but why should I burn because of their choices?"&lt;/p&gt; &lt;p&gt;Excellent question. Truly. Well here's my advice: don't expect semantic versioning where there is none. Use specific package versions. You can do that directly with your &lt;code&gt;package.json&lt;/code&gt;. For example replace something like this: &lt;code&gt;"@types/react-router": "^4.0.0"&lt;/code&gt; with a specific version number: &lt;code&gt;"@types/react-router": "4.0.31"&lt;/code&gt;.  With this approach it's a specific activity to upgrade your type definitions.  A chore if you will; but a chore that guarantees builds will not fail unexpectedly due to changing type defs.&lt;/p&gt; &lt;p&gt;My own personal preference is &lt;a href="https://yarnpkg.com/lang/en/"&gt;yarn&lt;/a&gt;.  Mother, I'm in love with a &lt;code&gt;yarn.lock&lt;/code&gt; file.  It is the alternative npm client that came out of Facebook.  It pins the exact versions of all packages used in your &lt;code&gt;yarn.lock&lt;/code&gt; file and guarantees to install the same versions each time.  Problem solved; and it even allows me to keep the semantic versioning in my &lt;code&gt;package.json&lt;/code&gt; as is.&lt;/p&gt; &lt;p&gt;This has some value in that when I upgrade I probably want to upgrade to a newer version following the semantic versioning convention. I should just expect that I'll need to check valid compilation when I do so.  yarn even has it's own built in utility that tells you when things are out of date: &lt;code&gt;yarn outdated&lt;/code&gt;:&lt;/p&gt;    &lt;a href="https://1.bp.blogspot.com/-CMAE-6BZQjQ/W5yfpzZG_iI/AAAAAAAAMRU/GkH9ZDr_SmMIzLwO1dlwS0Y0bVqWkhXyQCPcBGAYYCw/s1600/Screenshot%2B2018-09-15%2B06.56.20.png" imageanchor="1" &gt;&lt;img border="0" src="https://1.bp.blogspot.com/-CMAE-6BZQjQ/W5yfpzZG_iI/AAAAAAAAMRU/GkH9ZDr_SmMIzLwO1dlwS0Y0bVqWkhXyQCPcBGAYYCw/s640/Screenshot%2B2018-09-15%2B06.56.20.png" width="640" height="159" data-original-width="1600" data-original-height="397" /&gt;&lt;/a&gt; &lt;p&gt;So lovely&lt;/p&gt; &lt;h4&gt;You Were Already Broken - I Just Showed You How&lt;/h4&gt; &lt;p&gt;Before I finish I wanted to draw out one reason why breaking changes can be a reason for happiness. Because sometimes your code is wrong. An update to a type definition may highlight that. This is analogous to when the TypeScript compiler ships a new version.  When I upgrade to a newer version of TypeScript it lights up errors in my codebase that I hadn't spotted. Yay compiler!&lt;/p&gt; &lt;p&gt;An example of this is &lt;a href="https://github.com/DefinitelyTyped/DefinitelyTyped/pull/28868"&gt;a PR I submitted to DefinitelyTyped earlier this week&lt;/a&gt;. This PR changed how &lt;code&gt;react-router&lt;/code&gt; models the parameters of a &lt;code&gt;Match&lt;/code&gt;. Until now, an object was expected; the user could define any object they liked. However, &lt;code&gt;react-router&lt;/code&gt; will only produce &lt;code&gt;string&lt;/code&gt; values for a parameter.  &lt;a href="https://github.com/ReactTraining/react-router/blob/34ff1f8077d95edf01e9d5ca8ea4708b8d0290e2/packages/react-router/modules/matchPath.js#L36"&gt;If you look at the underlying code it's nothing more than an &lt;code&gt;exec&lt;/code&gt; on a regular expression.&lt;/a&gt;&lt;/p&gt; &lt;p&gt;My PR enforces this at type level by changing this:&lt;/p&gt; &lt;pre class="prettyprint ts"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;export interface match&amp;lt;P&amp;gt; {&lt;br /&gt;  params: P;&lt;br /&gt;  ...&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;To this&lt;/p&gt; &lt;pre class="prettyprint ts"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;export interface match&amp;lt;Params extends { [K in keyof Params]?: string } = {}&amp;gt; {&lt;br /&gt;  params: Params;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;So any object definition supplied must have &lt;code&gt;string&lt;/code&gt; values (and you don't actually need to supply an object definition; that's optional now).&lt;/p&gt; &lt;p&gt;I expected this PR to break people &lt;a href="https://github.com/DefinitelyTyped/DefinitelyTyped/issues/28894"&gt;and it did&lt;/a&gt;. But this is a useful break.   If they were relying upon their parameters to be types other than strings they would be experiencing some unexpected behaviour.  In fact, it's exactly this that prompted my PR in the first place.  A colleague had defined his parameters as &lt;code&gt;number&lt;/code&gt;s and couldn't understand why they weren't behaving like &lt;code&gt;number&lt;/code&gt;s. Because they weren't &lt;code&gt;number&lt;/code&gt;s!  And wonderfully, this will now be caught at compile time; not runtime. Yay!&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5467447157877868223'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5467447157877868223'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2018/09/ivan-drago-and-definitely-typed.html' title='Ivan Drago and Definitely Typed'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='https://1.bp.blogspot.com/-mG6pw3oJA4E/W5tD5vgfD4I/AAAAAAAAMQQ/upV1w2nJw1whI7MGp9HI5pniFEbVTJNxACPcBGAYYCw/s72-c/i-must-break-you.jpg' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-7169845619476893760</id><published>2018-08-21T05:00:00.001+01:00</published><updated>2021-03-04T05:26:04.104Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>ing Relative Paths with TypeScript and webpack</title><content type='html'>&lt;p&gt;I write a lot of TypeScript. Because I like modularity, I split up my codebases into discreet modules and &lt;code&gt;import&lt;/code&gt; from them as necessary.&lt;/p&gt; &lt;p&gt;Take a look at this &lt;code&gt;import&lt;/code&gt;:&lt;/p&gt; &lt;pre class="prettyprint ts"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;import * as utils from '../../../../../../../shared/utils';&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Now take a look at this import:&lt;/p&gt; &lt;pre class="prettyprint ts"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;import * as utils from 'shared/utils';&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Which do you prefer? If the answer was "the first" then read no further. You have all you need, go forth and be happy. If the answer was "the second" then stick around; I can help!&lt;/p&gt; &lt;h4&gt;TypeScript&lt;/h4&gt; &lt;p&gt;There's been a solution for this in TypeScript-land for some time. You can read the detail &lt;a href="https://www.typescriptlang.org/docs/handbook/module-resolution.html#path-mapping"&gt;in the "path mapping" docs here&lt;/a&gt;.&lt;/p&gt; &lt;p&gt;Let's take a slightly simpler example; we have a folder structure that looks like this:&lt;/p&gt; &lt;pre class="prettyprint console"&gt;&lt;br /&gt;&lt;code class="language-console"&gt;&lt;br /&gt;projectRoot &lt;br /&gt; components &lt;br /&gt;  page.tsx (imports '../shared/utils') &lt;br /&gt; shared &lt;br /&gt;  folder1 &lt;br /&gt;  folder2 &lt;br /&gt;  utils.ts &lt;br /&gt; tsconfig.json&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;We would like &lt;code&gt;page.tsx&lt;/code&gt; to import &lt;code&gt;'shared/utils'&lt;/code&gt; instead of &lt;code&gt;'../shared/utils'&lt;/code&gt;. We can, if we augment our &lt;code&gt;tsconfig.json&lt;/code&gt; with the following properties:&lt;/p&gt; &lt;pre class="prettyprint json"&gt;&lt;br /&gt;&lt;code class="language-json"&gt;&lt;br /&gt;{ &lt;br /&gt;  "compilerOptions": { &lt;br /&gt;    "baseUrl": ".", &lt;br /&gt;    "paths": { &lt;br /&gt;       "components/*": ["components/*"],&lt;br /&gt;       "shared/*": ["shared/*"]&lt;br /&gt;    }&lt;br /&gt;  }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Then we can use option 2. We can happily write:&lt;/p&gt; &lt;pre class="prettyprint ts"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;import * as utils from 'shared/utils';&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;My code compiles, yay.... Ship it!&lt;/p&gt; &lt;p&gt;Let's not get over-excited. Actually, we're only part-way there; you can compile this code with the TypeScript compiler.... But is that enough?&lt;/p&gt; &lt;p&gt;I bundle my TypeScript with &lt;a href="https://github.com/TypeStrong/ts-loader"&gt;ts-loader&lt;/a&gt; and webpack. If I try and use my new exciting import statement above with my build system then disappointment is in my future. webpack will be all like "import whuuuuuuuut?"&lt;/p&gt; &lt;p&gt;You see, webpack doesn't know what we told the TypeScript compiler in the &lt;code&gt;tsconfig.json&lt;/code&gt;. Why would it? It was our little secret.&lt;/p&gt; &lt;h4&gt;webpack &lt;code&gt;resolve.alias&lt;/code&gt; to the rescue!&lt;/h4&gt; &lt;p&gt;This same functionality has existed in webpack for a long time; actually much longer than it has existed in TypeScript. It's the &lt;a href="https://webpack.js.org/configuration/resolve/#resolve-alias"&gt;&lt;code&gt;resolve.alias&lt;/code&gt;&lt;/a&gt; functionality.&lt;/p&gt; &lt;p&gt;So, looking at that I should be able to augment my &lt;code&gt;webpack.config.js&lt;/code&gt; like so:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;module.exports = {&lt;br /&gt;  //...&lt;br /&gt;  resolve: {&lt;br /&gt;    alias: {&lt;br /&gt;      components: path.resolve(process.cwd(), 'components/'),&lt;br /&gt;      shared: path.resolve(process.cwd(), 'shared/'),&lt;br /&gt;    }&lt;br /&gt;  }&lt;br /&gt;};&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;And now both webpack and TypeScript are up to speed with how to resolve modules.&lt;/p&gt; &lt;h4&gt;DRY with the &lt;a href="https://github.com/dividab/tsconfig-paths-webpack-plugin"&gt;&lt;code&gt;tsconfig-paths-webpack-plugin&lt;/code&gt;&lt;/a&gt;&lt;/h4&gt; &lt;p&gt;When I look at the &lt;code&gt;tsconfig.json&lt;/code&gt; and the &lt;code&gt;webpack.config.js&lt;/code&gt; something occurs to me: I don't like to repeat myself. As well as that, I don't like to repeat myself. It's so... Repetitive.&lt;/p&gt; &lt;p&gt;The declarations you make in the &lt;code&gt;tsconfig.json&lt;/code&gt; are re-stated in the &lt;code&gt;webpack.config.js&lt;/code&gt;. Who wants to maintain two sets of code where one would do? Not me.&lt;/p&gt; &lt;p&gt;Fortunately, you don't have to. There's the &lt;a href="https://github.com/dividab/tsconfig-paths-webpack-plugin"&gt;&lt;code&gt;tsconfig-paths-webpack-plugin&lt;/code&gt;&lt;/a&gt; for webpack which will do the job for you. You can replace your verbose &lt;code&gt;resolve.alias&lt;/code&gt; with this:&lt;/p&gt; &lt;pre class="prettyprint ts"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;module.exports = {&lt;br /&gt;  //...&lt;br /&gt;  resolve: {&lt;br /&gt;    plugins: [new TsconfigPathsPlugin({ /*configFile: "./path/to/tsconfig.json" */ })]&lt;br /&gt;  }&lt;br /&gt;};&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;This does the hard graft of reading your &lt;code&gt;tsconfig.json&lt;/code&gt; and translating path mappings into webpack &lt;code&gt;alias&lt;/code&gt;es. From this point forward, you need only edit the &lt;code&gt;tsconfig.json&lt;/code&gt; and everything else will just work.&lt;/p&gt; &lt;p&gt;Thanks to &lt;a href="https://github.com/jonaskello"&gt;Jonas Kello&lt;/a&gt;, author of the plugin; it's tremendous! Thanks also to &lt;a href="https://twitter.com/TheLarkInn"&gt;Sean Larkin&lt;/a&gt; and &lt;a href="https://github.com/s-panferov"&gt;Stanislav Panferov&lt;/a&gt; (of &lt;a href="https://github.com/s-panferov/awesome-typescript-loader"&gt;awesome-typescript-loader&lt;/a&gt;) who together worked on the original plugin that I understand the &lt;code&gt;tsconfig-paths-webpack-plugin&lt;/code&gt; is based on. Great work!&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7169845619476893760'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7169845619476893760'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2018/08/killing-relative-paths-with-typescript-and.html' title='ing Relative Paths with TypeScript and webpack'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4330449641638434009</id><published>2018-07-28T09:13:00.001+01:00</published><updated>2021-03-04T05:27:37.682Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Docker and Configuration on Azure Web App for Containers: Whither Colons?</title><content type='html'>&lt;p&gt;App Services have long been a super simple way to spin up a web app in Azure.  The barrier to entry is low, maintenance is easy.  It just works.  App Services recently got a turbo boost in the form of &lt;a href="https://docs.microsoft.com/en-us/azure/app-service/containers/app-service-linux-intro"&gt;Azure App Service on Linux&lt;/a&gt;. Being able to deploy to Linux is exciting enough; but the real reason this is notable because &lt;a href="https://docs.microsoft.com/en-us/azure/app-service/containers/tutorial-custom-docker-image"&gt;you can deploy Docker images that will be run as app services&lt;/a&gt;.&lt;/p&gt; &lt;p&gt;I cannot over-emphasise just how easy this makes getting a Docker image into Production. Yay Azure!&lt;/p&gt; &lt;h4&gt;The Mystery of Configuration&lt;/h4&gt; &lt;p&gt;Applications need configuration.  ASP.Net Core applications are typically configured by an &lt;code&gt;appsettings.json&lt;/code&gt; file which might look like so:&lt;/p&gt; &lt;pre class="prettyprint json"&gt;&lt;br /&gt;&lt;code class="language-json"&gt;&lt;br /&gt;    {&lt;br /&gt;      "Parent": {&lt;br /&gt;        "ChildOne": "I'm a little teapot",&lt;br /&gt;        "ChildTwo": "Short and stout"&lt;br /&gt;      }&lt;br /&gt;    }&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;With a classic App Service you could override a setting in the &lt;code&gt;appsettings.json&lt;/code&gt; by updating "Application settings" within the Azure portal.  You'd do this in the style of creating an Application setting called &lt;code&gt;Parent:ChildOne&lt;/code&gt; or &lt;code&gt;Parent:ChildTwo&lt;/code&gt;.  To be clear: using colons to target a specific piece of config.&lt;/p&gt; &lt;a href="https://3.bp.blogspot.com/-LUlgZrW9Yc0/W1wg5AbUQNI/AAAAAAAALVU/NeLfdpy7MOI0tAOX6EN-JH3SKDBwbbflACPcBGAYYCw/s1600/appservice_classic.png" imageanchor="1" &gt;&lt;img border="0" src="https://3.bp.blogspot.com/-LUlgZrW9Yc0/W1wg5AbUQNI/AAAAAAAALVU/NeLfdpy7MOI0tAOX6EN-JH3SKDBwbbflACPcBGAYYCw/s640/appservice_classic.png" width="640" height="336" data-original-width="757" data-original-height="398" /&gt;&lt;/a&gt; &lt;p&gt;You can read about this approach &lt;a href="https://blogs.msdn.microsoft.com/waws/2018/06/12/asp-net-core-settings-for-azure-app-service/"&gt;here&lt;/a&gt;. Now there's something I want you to notice; consider the colons below:&lt;/p&gt; &lt;a href="https://2.bp.blogspot.com/-0YSRmySfNc4/W1whJuEieaI/AAAAAAAALVc/k1zloq14lzASVQL6HjHCk-zzDTD2a8LAwCLcBGAs/s1600/appservice_colons_fine.png" imageanchor="1" &gt;&lt;img border="0" src="https://2.bp.blogspot.com/-0YSRmySfNc4/W1whJuEieaI/AAAAAAAALVc/k1zloq14lzASVQL6HjHCk-zzDTD2a8LAwCLcBGAs/s640/appservice_colons_fine.png" width="640" height="105" data-original-width="584" data-original-height="96" /&gt;&lt;/a&gt; &lt;p&gt;If you try and follow the same steps when you're using Web App for Containers / i.e. &lt;a href="https://docs.microsoft.com/en-us/azure/app-service/containers/app-service-linux-intro"&gt;a Docker image deployed to an Azure App Service on Linux &lt;/a&gt; you &lt;strong&gt;cannot&lt;/strong&gt; use colons:&lt;/p&gt; &lt;a href="https://2.bp.blogspot.com/-hPNAcxRce0o/W1whYT9tINI/AAAAAAAALVg/YCCKzRE4E8opV5VZYmVFmSiOBLRWbep1ACLcBGAs/s1600/appservice_container_colons_bad.png" imageanchor="1" &gt;&lt;img border="0" src="https://2.bp.blogspot.com/-hPNAcxRce0o/W1whYT9tINI/AAAAAAAALVg/YCCKzRE4E8opV5VZYmVFmSiOBLRWbep1ACLcBGAs/s640/appservice_container_colons_bad.png" width="640" height="65" data-original-width="919" data-original-height="94" /&gt;&lt;/a&gt; &lt;p&gt;When you hover over the error you see this message: &lt;code&gt;This field can only contain letters, numbers (0-9), periods ("."), and underscores ("_")&lt;/code&gt;.  Using &lt;code&gt;.&lt;/code&gt; does not work alas.&lt;/p&gt; &lt;h4&gt;What do I do?&lt;/h4&gt; &lt;p&gt;So it turns out you just can't configure App Services on Linux.&lt;/p&gt; &lt;p&gt;Jokes!&lt;/p&gt; &lt;p&gt;No, of course you can and here I can help. After more experimentation than I'd like to admit I happened upon the answer. Here it is:&lt;/p&gt; &lt;p&gt;Where you use &lt;code&gt;:&lt;/code&gt; on a classic App Service, you should use a &lt;code&gt;__&lt;/code&gt; (double underscore) on an App Service with containers. So &lt;code&gt;Parent__ChildOne&lt;/code&gt; instead of &lt;code&gt;Parent:ChildOne&lt;/code&gt;.  It's as simple as that.&lt;p&gt; &lt;h4&gt;Why is it like this?&lt;/h4&gt; &lt;p&gt;Honestly?  No idea.  I can't find any information on the matter. Let me know if you find out.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4330449641638434009'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4330449641638434009'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2018/07/configuring-docker-azure-web-app-containers.html' title='Docker and Configuration on Azure Web App for Containers: Whither Colons?'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='https://3.bp.blogspot.com/-LUlgZrW9Yc0/W1wg5AbUQNI/AAAAAAAALVU/NeLfdpy7MOI0tAOX6EN-JH3SKDBwbbflACPcBGAYYCw/s72-c/appservice_classic.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2046585057149682061</id><published>2018-07-09T20:30:00.001+01:00</published><updated>2021-03-04T05:29:54.917Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='auth0-js'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Auth0'/><category scheme='http://www.blogger.com/atom/ns#' term='cypress'/><category scheme='http://www.blogger.com/atom/ns#' term='login'/><title type='text'>Cypress and Auth0</title><content type='html'>&lt;p&gt;&lt;a href="https://www.cypress.io/"&gt;Cypress&lt;/a&gt; is a fantastic way to write UI tests for your web apps. Just world class. Wait, no. Galaxy class. I'm going to go one further: universe class.  You get my drift.&lt;/p&gt; &lt;p&gt;Here's a pickle for you.  You have functionality that lies only behind the walled garden of authentication.  You want to write tests for these capabilities.  Assuming that authentication takes place within your application that's no great shakes.  Authentication is part of your app; it's no big deal using Cypress to automate logging in.&lt;/p&gt; &lt;p&gt;Auth is a serious business and, as Cypress is best in class for UI testing, I'll say that Auth0 is romping home with the same title in the auth-as-a-service space.   My app is using Auth0 for authentication.  What's important to note about this is the flow.  Typically when using auth-as-a-service, the user is redirected to the auth provider's site to authenticate and then be redirected back to the application post-login.&lt;/p&gt; &lt;p&gt;&lt;a href="https://github.com/brian-mann"&gt;Brian Mann&lt;/a&gt; (of Cypress fame) has been &lt;a href="https://github.com/cypress-io/cypress/issues/1342#issuecomment-366747803"&gt;fairly clear when talking about testing with this sort of authentication flow&lt;/a&gt;:&lt;/p&gt; &lt;blockquote cite="https://github.com/cypress-io/cypress/issues/1342#issuecomment-366747803"&gt;&lt;p&gt;You're trying to test SSO - and we have recipes showing you exactly how to do this.&lt;/p&gt; &lt;p&gt;Also best practice is never to visit or test 3rd party sites not under your control. You don't control &lt;code&gt;microsoftonline&lt;/code&gt;, so there's no reason to use the UI to test this. You can programmatically test the integration between it and your app with &lt;code&gt;cy.request&lt;/code&gt; - which is far faster, more reliable, and still gives you 100% confidence.&lt;/p&gt;&lt;/blockquote&gt; &lt;p&gt;I want to automate logging into Auth0 from my Cypress tests.  But hopefully in a good way.  Not a bad way.  Wouldn't want to make Brian sad.&lt;/p&gt; &lt;h4&gt;Commanding Auth0&lt;/h4&gt; &lt;p&gt;To automate our login, we're going to use the &lt;a href="https://github.com/auth0/auth0.js"&gt;auth0-js client library&lt;/a&gt;.  This is the same library the application uses; but we're going to do something subtly different with it.&lt;/p&gt; &lt;p&gt;The application uses &lt;a href="https://github.com/auth0/auth0.js#api"&gt;&lt;code&gt;authorize&lt;/code&gt;&lt;/a&gt; to log users in. This function redirects the user into the Auth0 lock screen, and then, post authentication, redirects the user back to the application with a token in the URL.  The app parses the token (using the auth0 client library) and sets the token and the expiration of said token in the browser sessionStorage.&lt;/p&gt; &lt;p&gt;What we're going to do is automate our login by using &lt;code&gt;login&lt;/code&gt; instead.  First of all, we need to add &lt;code&gt;auth0-js&lt;/code&gt; as a dependency of our e2e tests:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;yarn add auth0-js --dev&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Next, we're going to create ourselves a custom command called loginAsAdmin:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;const auth0 = require('auth0-js');&lt;br /&gt;&lt;br /&gt;Cypress.Commands.add('loginAsAdmin', (overrides = {}) =&gt; {&lt;br /&gt;    Cypress.log({&lt;br /&gt;        name: 'loginAsAdminBySingleSignOn'&lt;br /&gt;    });&lt;br /&gt;&lt;br /&gt;    const webAuth = new auth0.WebAuth({&lt;br /&gt;        domain: 'my-super-duper-domain.eu.auth0.com', // Get this from https://manage.auth0.com/#/applications and your application&lt;br /&gt;        clientID: 'myclientid', // Get this from https://manage.auth0.com/#/applications and your application&lt;br /&gt;        responseType: 'token id_token'&lt;br /&gt;    });&lt;br /&gt;&lt;br /&gt;    webAuth.client.login(&lt;br /&gt;        {&lt;br /&gt;            realm: 'Username-Password-Authentication',&lt;br /&gt;            username: 'mytestemail@something.co.uk',&lt;br /&gt;            password: 'SoVeryVeryVery$ecure',&lt;br /&gt;            audience: 'myaudience', // Get this from https://manage.auth0.com/#/apis and your api, use the identifier property&lt;br /&gt;            scope: 'openid email profile'&lt;br /&gt;        },&lt;br /&gt;        function(err, authResult) {&lt;br /&gt;            // Auth tokens in the result or an error&lt;br /&gt;            if (authResult &amp;&amp; authResult.accessToken &amp;&amp; authResult.idToken) {&lt;br /&gt;                const token = {&lt;br /&gt;                    accessToken: authResult.accessToken,&lt;br /&gt;                    idToken: authResult.idToken,&lt;br /&gt;                    // Set the time that the access token will expire at&lt;br /&gt;                    expiresAt: authResult.expiresIn * 1000 + new Date().getTime()&lt;br /&gt;                };&lt;br /&gt;&lt;br /&gt;                window.sessionStorage.setItem('my-super-duper-app:storage_token', JSON.stringify(token));&lt;br /&gt;            } else {&lt;br /&gt;                console.error('Problem logging into Auth0', err);&lt;br /&gt;    throw err;&lt;br /&gt;            }&lt;br /&gt;        }&lt;br /&gt;    );&lt;br /&gt;});&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;This command logs in using the &lt;code&gt;auth0-js&lt;/code&gt; API and then sets the result into &lt;code&gt;sessionStorage&lt;/code&gt; in the same way that our app does.  This allows our app to read the value out of &lt;code&gt;sessionStorage&lt;/code&gt; and use it.  We're also going to put together one other command:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;Cypress.Commands.add('visitHome', (overrides = {}) =&gt; {&lt;br /&gt;    cy.visit('/', {&lt;br /&gt;        onBeforeLoad: win =&gt; {&lt;br /&gt;            win.sessionStorage.clear();&lt;br /&gt;        }&lt;br /&gt;    })&lt;br /&gt;});&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;This visits the root of our application and wipes the &lt;code&gt;sessionStorage&lt;/code&gt;.  This is necessary because Cypress doesn't clear down &lt;code&gt;sessionStorage&lt;/code&gt; between tests.  (&lt;a href="https://github.com/cypress-io/cypress/issues/413"&gt;That's going to change though.&lt;/a&gt;)&lt;/p&gt; &lt;h4&gt;Using It&lt;/h4&gt; &lt;p&gt;Let's write a test that uses our new commands to see if it gets access to our admin functionality:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;describe('access secret admin functionality', () =&gt; {&lt;br /&gt;    it('should be able to navigate to', () =&gt; {&lt;br /&gt;        cy.visitHome()&lt;br /&gt;            .loginAsAdmin()&lt;br /&gt;            .get('[href="/secret-adminny-stuff"]') // This link should only be visible to admins&lt;br /&gt;            .click()&lt;br /&gt;            .url()&lt;br /&gt;            .should('contain', 'secret-adminny-stuff/'); // non-admins should be redirected away from this url&lt;br /&gt;    });&lt;br /&gt;});&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Well, the test looks good but it's failing.  If I fire up the Chrome Dev Tools in Cypress (did I mention that Cypress is absolutely fabulous?) then I see this response tucked away in the network tab:&lt;/p&gt; &lt;pre class="prettyprint json"&gt;&lt;br /&gt;&lt;code class="language-json"&gt;&lt;br /&gt;{error: "unauthorized_client",} error : "unauthorized_client" error_description : "Grant type 'http://auth0.com/oauth/grant-type/password-realm' not allowed for the client."&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Hmmm... So sad.  If you go to &lt;a href="https://manage.auth0.com/#/applications"&gt;https://manage.auth0.com/#/applications&lt;/a&gt;, select your application, &lt;code&gt;Show Advanced Settings&lt;/code&gt; and &lt;code&gt;Grant Types&lt;/code&gt; you'll see a &lt;code&gt;Password&lt;/code&gt; option is unselected.&lt;/p&gt; &lt;p&gt;Select it, Save Changes and try again.&lt;/p&gt; &lt;a href="https://4.bp.blogspot.com/-RhUKING4eYU/W0RxKvVMg2I/AAAAAAAALLM/QohX5jP5rZogoH27UGxVxYxAfTxgcUDXwCPcBGAYYCw/s1600/auth0-enable-password-grant-type.png" imageanchor="1" &gt;&lt;img border="0" src="https://4.bp.blogspot.com/-RhUKING4eYU/W0RxKvVMg2I/AAAAAAAALLM/QohX5jP5rZogoH27UGxVxYxAfTxgcUDXwCPcBGAYYCw/s640/auth0-enable-password-grant-type.png" width="640" height="449" data-original-width="837" data-original-height="587" /&gt;&lt;/a&gt; &lt;p&gt;You now have a test which automates your Auth0 login using Cypress and goes on to test your application functionality with it!&lt;/p&gt; &lt;h4&gt;One More Thing...&lt;/h4&gt; &lt;p&gt;It's worth saying that it's worth setting up different tenants in Auth0 to support your testing scenarios.  This is generally a good idea so you can separate your testing accounts from Production accounts.  Further to that, you don't need to have your Production setup supporting the &lt;code&gt;Password&lt;/code&gt; &lt;code&gt;Grant Type&lt;/code&gt;.&lt;/p&gt; &lt;p&gt;Also, if you're curious about what the application under test is like then read &lt;a href="https://blog.johnnyreilly.com/2018/01/auth0-typescript-and-aspnet-core.html"&gt;this&lt;/a&gt;.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2046585057149682061'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2046585057149682061'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2018/07/cypress-and-auth0.html' title='Cypress and Auth0'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='https://4.bp.blogspot.com/-RhUKING4eYU/W0RxKvVMg2I/AAAAAAAALLM/QohX5jP5rZogoH27UGxVxYxAfTxgcUDXwCPcBGAYYCw/s72-c/auth0-enable-password-grant-type.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6901407540953071264</id><published>2018-06-24T16:42:00.002+01:00</published><updated>2021-03-04T05:34:26.469Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='vsts'/><category scheme='http://www.blogger.com/atom/ns#' term='Entity Framework'/><category scheme='http://www.blogger.com/atom/ns#' term='ef core'/><title type='text'>VSTS and EF Core Migrations</title><content type='html'>&lt;p&gt;Let me start by telling you a dirty secret. I have an ASP.Net Core project that I build with VSTS.  It is deployed to Azure through a CI / CD setup in VSTS.  That part I'm happy with.  Proud of even.  Now to the sordid hiddenness: try as I might, I've never found a nice way to deploy Entity Framework database migrations as part of the deployment flow.  So I have [blushes with embarrassment] been using the &lt;code&gt;Startup&lt;/code&gt; of my ASP.Net core app to run the migrations on my database.  There.  I said it.  You all know. Absolutely filthy. Don't judge me.&lt;/p&gt;   &lt;p&gt;If you care to google, you'll find various discussions around this, and various ways to tackle it.  Most of which felt like too much hard work and so I never attempted.&lt;/p&gt; &lt;p&gt;It's also worth saying that being on VSTS made me less likely to give these approaches a go.  Why?  Well, the feedback loop for debugging a CI / CD setup is truly sucky.  Make a change.  Wait for it to trickle through the CI / CD flow (10 mins at least).  Spot a problem, try and fix.  Start waiting again.  Repeat until you succeed.  Or, if you're using the free tier of VSTS, repeat until you run out of build minutes.  You have a limited number of build minutes per month with VSTS.  Last time I fiddled with the build, I bled my way through a full month's minutes in 2 days. I have now adopted the approach of only playing with the setup in the last week of the month.  That way if I end up running out of minutes, at least I'll roll over to the new allowance in a matter of days.&lt;/p&gt; &lt;p&gt;Digression over.  I could take the guilt of my EF migrations secret no longer, I decided to try and tackle it another way.  I used the approach suggested by &lt;a href="https://github.com/broersa"&gt;Andre Broers&lt;/a&gt; &lt;a href="https://github.com/aspnet/EntityFrameworkCore/issues/9841#issuecomment-395712061"&gt;here&lt;/a&gt;:&lt;/p&gt; &lt;blockquote cite="https://github.com/aspnet/EntityFrameworkCore/issues/9841#issuecomment-395712061"&gt;&lt;p&gt;I worked around by adding a dotnetcore consoleapp project where I run the migration via the Context. In the Build I build this consoleapp in the release I execute it. &lt;/p&gt;&lt;/blockquote&gt; &lt;h4&gt;Console Yourself&lt;/h4&gt; &lt;p&gt;First things first, we need a console app added to our solution. Fire up PowerShell in the root of your project and:&lt;/p&gt; &lt;pre class="prettyprint console"&gt;&lt;br /&gt;&lt;code class="language-console"&gt;&lt;br /&gt;md MyAwesomeProject.MigrateDatabase&lt;br /&gt;cd .\MyAwesomeProject.MigrateDatabase\&lt;br /&gt;dotnet new console&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Next we need that project to know about Entity Framework and also our DbContext (which I store in a dedicated project):&lt;/p&gt; &lt;pre class="prettyprint console"&gt;&lt;br /&gt;&lt;code class="language-console"&gt;&lt;br /&gt;dotnet add package Microsoft.EntityFrameworkCore.Design&lt;br /&gt;dotnet add package Microsoft.EntityFrameworkCore.SqlServer&lt;br /&gt;dotnet add reference ..\MyAwesomeProject.Database\MyAwesomeProject.Database.csproj&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Add our new project to our solution: (I always forget to do this)&lt;/p&gt; &lt;pre class="prettyprint console"&gt;&lt;br /&gt;&lt;code class="language-console"&gt;&lt;br /&gt;cd ../&lt;br /&gt;dotnet sln add .\MyAwesomeProject.MigrateDatabase\MyAwesomeProject.MigrateDatabase.csproj&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;You should now be the proud possessor of a &lt;code&gt;.csproj&lt;/code&gt; file that looks like this:&lt;/p&gt; &lt;pre class="prettyprint xml"&gt;&lt;br /&gt;&lt;code class="language-xml"&gt;&lt;br /&gt;&amp;lt;Project Sdk="Microsoft.NET.Sdk"&amp;gt;&lt;br /&gt;&lt;br /&gt;  &amp;lt;PropertyGroup&amp;gt;&lt;br /&gt;    &amp;lt;OutputType&amp;gt;Exe&amp;lt;/OutputType&amp;gt;&lt;br /&gt;    &amp;lt;TargetFramework&amp;gt;netcoreapp2.1&amp;lt;/TargetFramework&amp;gt;&lt;br /&gt;  &amp;lt;/PropertyGroup&amp;gt;&lt;br /&gt;&lt;br /&gt;  &amp;lt;ItemGroup&amp;gt;&lt;br /&gt;    &amp;lt;PackageReference Include="Microsoft.EntityFrameworkCore.Design" Version="2.1.1" /&amp;gt;&lt;br /&gt;    &amp;lt;PackageReference Include="Microsoft.EntityFrameworkCore.SqlServer" Version="2.1.1" /&amp;gt;&lt;br /&gt;  &amp;lt;/ItemGroup&amp;gt;&lt;br /&gt;&lt;br /&gt;  &amp;lt;ItemGroup&amp;gt;&lt;br /&gt;    &amp;lt;ProjectReference Include="..\MyAwesomeProject.Database\MyAwesomeProject.Database.csproj" /&amp;gt;&lt;br /&gt;  &amp;lt;/ItemGroup&amp;gt;&lt;br /&gt;&lt;br /&gt;&amp;lt;/Project&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Replace the contents of the &lt;code&gt;Program.cs&lt;/code&gt; file with this:&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;using System;&lt;br /&gt;using System.IO;&lt;br /&gt;using MyAwesomeProject.Database;&lt;br /&gt;using Microsoft.EntityFrameworkCore;&lt;br /&gt;&lt;br /&gt;namespace MyAwesomeProject.MigrateDatabase {&lt;br /&gt;    class Program {&lt;br /&gt;        // Example usage:&lt;br /&gt;        // dotnet MyAwesomeProject.MigrateDatabase.dll "Server=(localdb)\\mssqllocaldb;Database=MyAwesomeProject;Trusted_Connection=True;"&lt;br /&gt;        static void Main(string[] args) {&lt;br /&gt;            if (args.Length == 0)&lt;br /&gt;                throw new Exception("No connection string supplied!");&lt;br /&gt;&lt;br /&gt;            var myAwesomeProjectConnectionString = args[0];&lt;br /&gt;&lt;br /&gt;            // Totally optional debug information&lt;br /&gt;            Console.WriteLine("About to migrate this database:");&lt;br /&gt;            var connectionBits = myAwesomeProjectConnectionString.Split(";");&lt;br /&gt;            foreach (var connectionBit in connectionBits) {&lt;br /&gt;                if (!connectionBit.StartsWith("Password", StringComparison.CurrentCultureIgnoreCase))&lt;br /&gt;                    Console.WriteLine(connectionBit);&lt;br /&gt;            }&lt;br /&gt;&lt;br /&gt;            try {&lt;br /&gt;                var optionsBuilder = new DbContextOptionsBuilder&amp;lt;MyAwesomeProjectContext&amp;gt;();&lt;br /&gt;                optionsBuilder.UseSqlServer(myAwesomeProjectConnectionString);&lt;br /&gt;&lt;br /&gt;                using(var context = new MyAwesomeProjectContext(optionsBuilder.Options)) {&lt;br /&gt;                    context.Database.Migrate();&lt;br /&gt;                }&lt;br /&gt;                Console.WriteLine("This database is migrated like it's the Serengeti!");&lt;br /&gt;            } catch (Exception exc) {&lt;br /&gt;                var failedToMigrateException = new Exception("Failed to apply migrations!", exc);&lt;br /&gt;                Console.WriteLine($"Didn't succeed in applying migrations: {exc.Message}");&lt;br /&gt;                throw failedToMigrateException;&lt;br /&gt;            }&lt;br /&gt;        }&lt;br /&gt;    }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;This code takes the database connection string passed as an argument, spins up a db context with that, and migrates like it's the Serengeti.&lt;/p&gt; &lt;h4&gt;Build It!&lt;/h4&gt; &lt;p&gt;The next thing we need is to ensure that this is included as part of the build process in VSTS. The following commands need to be run during the build to include the MigrateDatabase project in the build output in a &lt;code&gt;MigrateDatabase&lt;/code&gt; folder:&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;cd MyAwesomeProject.MigrateDatabase&lt;br /&gt;dotnet build&lt;br /&gt;dotnet publish --configuration Release --output $(build.artifactstagingdirectory)/MigrateDatabase&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;There's various ways to accomplish this which I wont reiterate now.  &lt;a href="https://blog.johnnyreilly.com/2018/06/vsts-yaml-up.html"&gt;I recommend YAML&lt;/a&gt;.&lt;/p&gt; &lt;h4&gt;Deploy It!&lt;/h4&gt; &lt;p&gt;Now to execute our console app as part of the deployment process we need to add a CommandLine task to our VSTS build definition. It should execute the following command:&lt;/p&gt; &lt;pre class="prettyprint console"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;dotnet MyAwesomeProject.MigrateDatabase.dll "$(ConnectionStrings.MyAwesomeProjectDatabaseConnection)"&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;In the following folder:&lt;/p&gt; &lt;pre class="prettyprint console"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;$(System.DefaultWorkingDirectory)/my-awesome-project-YAML/drop/MigrateDatabase&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Do note that the command uses the &lt;code&gt;ConnectionStrings.MyAwesomeProjectDatabaseConnection&lt;/code&gt; variable which you need to create and set to the value of your connection string.&lt;/p&gt; &lt;a href="https://3.bp.blogspot.com/-38rTxu20hPo/Wy-6lSU6OkI/AAAAAAAAK7E/0-sZ9D6Z_B8mYQMPia8kdQ9e4xzmXrNqQCPcBGAYYCw/s1600/Screenshot%2B2018-06-24%2B10.55.27.png" imageanchor="1" &gt;&lt;img border="0" src="https://3.bp.blogspot.com/-38rTxu20hPo/Wy-6lSU6OkI/AAAAAAAAK7E/0-sZ9D6Z_B8mYQMPia8kdQ9e4xzmXrNqQCPcBGAYYCw/s640/Screenshot%2B2018-06-24%2B10.55.27.png" width="640" height="293" data-original-width="1600" data-original-height="732" /&gt;&lt;/a&gt; &lt;h4&gt;Give It A Whirl&lt;/h4&gt; &lt;p&gt;Let's find out what happens when the rubber hits the road. I'll add a new entity to my database project:&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;using System;&lt;br /&gt;&lt;br /&gt;namespace MyAwesomeProject.Database.Entities {&lt;br /&gt;    public class NewHotness {&lt;br /&gt;        public Guid NewHotnessId { get; set; }&lt;br /&gt;    }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;And reference it in my DbContext:&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;using MyAwesomeProject.Database.Entities;&lt;br /&gt;using Microsoft.EntityFrameworkCore;&lt;br /&gt;&lt;br /&gt;namespace MyAwesomeProject.Database {&lt;br /&gt;    public class MyAwesomeProjectContext : DbContext {&lt;br /&gt;        public MyAwesomeProjectContext(DbContextOptions&amp;lt;MyAwesomeProjectContext&amp;gt; options) : base(options) { }&lt;br /&gt;&lt;br /&gt;        // ...&lt;br /&gt;  &lt;br /&gt;        public DbSet&amp;lt;NewHotness&amp;gt; NewHotnesses { get; set; }&lt;br /&gt;&lt;br /&gt;        // ...&lt;br /&gt;    }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Let's let EF know by adding a migration to my project:&lt;p&gt; &lt;pre class="prettyprint console"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;dotnet ef migrations add TestOurMigrationsApproach&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Commit my change, push it to VSTS, wait for the build to run and a deployment to take place.... Okay.  It's done.  Looks good.&lt;/p&gt; &lt;a href="https://3.bp.blogspot.com/-i0ESAvjWtEw/Wy-68vGEyLI/AAAAAAAAK7M/VaIiwevgN40cDcJmTMG2VK1NNem2InmjQCLcBGAs/s1600/Screenshot%2B2018-06-24%2B09.02.22.png" imageanchor="1" &gt;&lt;img border="0" src="https://3.bp.blogspot.com/-i0ESAvjWtEw/Wy-68vGEyLI/AAAAAAAAK7M/VaIiwevgN40cDcJmTMG2VK1NNem2InmjQCLcBGAs/s640/Screenshot%2B2018-06-24%2B09.02.22.png" width="640" height="269" data-original-width="1600" data-original-height="672" /&gt;&lt;/a&gt; &lt;p&gt;Let's take a look in the database:&lt;/p&gt; &lt;pre class="prettyprint console"&gt;&lt;br /&gt;&lt;code class="language-console"&gt;&lt;br /&gt;select * from NewHotnesses&lt;br /&gt;go&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;a href="https://3.bp.blogspot.com/-enEbqRGkfA0/Wy-7HHwHlRI/AAAAAAAAK7Q/VLYQfC5WU_kfj07zYJflnuAx1E0fkYnHwCLcBGAs/s1600/Screenshot%2B2018-06-24%2B08.59.00.png" imageanchor="1" &gt;&lt;img border="0" src="https://3.bp.blogspot.com/-enEbqRGkfA0/Wy-7HHwHlRI/AAAAAAAAK7Q/VLYQfC5WU_kfj07zYJflnuAx1E0fkYnHwCLcBGAs/s640/Screenshot%2B2018-06-24%2B08.59.00.png" width="640" height="436" data-original-width="1539" data-original-height="1048" /&gt;&lt;/a&gt; &lt;p&gt;It's there! We are migrating our database upon deployment; and not in our ASP.Net Core app itself.  I feel a burden lifted.&lt;/p&gt; &lt;h4&gt;Wrapping Up&lt;/h4&gt; &lt;p&gt;The EF Core team are aware of the lack of guidance around deploying migrations and have recently announced plans to fix that in the docs. You can track the progress of this issue &lt;a href="https://github.com/aspnet/EntityFramework.Docs/issues/691"&gt;here&lt;/a&gt;. There's good odds that once they come out with this I'll find there's a better way than the approach I've outlined in this post.  Until that glorious day!&lt;/p&gt;  </content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/6901407540953071264'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/6901407540953071264'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2018/06/vsts-and-ef-core-migrations.html' title='VSTS and EF Core Migrations'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='https://3.bp.blogspot.com/-38rTxu20hPo/Wy-6lSU6OkI/AAAAAAAAK7E/0-sZ9D6Z_B8mYQMPia8kdQ9e4xzmXrNqQCPcBGAYYCw/s72-c/Screenshot%2B2018-06-24%2B10.55.27.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3526827284243388498</id><published>2018-06-16T20:18:00.003+01:00</published><updated>2021-03-03T13:52:21.443Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='yaml'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='vsts'/><category scheme='http://www.blogger.com/atom/ns#' term='ci'/><category scheme='http://www.blogger.com/atom/ns#' term='travis'/><category scheme='http://www.blogger.com/atom/ns#' term='AppVeyor'/><title type='text'>VSTS... YAML up!</title><content type='html'>&lt;p&gt;For the longest time I've been using the likes of &lt;a href="https://travis-ci.org/"&gt;Travis&lt;/a&gt; and &lt;a href="https://www.appveyor.com/"&gt;AppVeyor&lt;/a&gt; to build open source projects that I work on. They rock. I've also recently been dipping my toes back in the water of &lt;a href="https://www.visualstudio.com/team-services/"&gt;Visual Studio Team Services&lt;/a&gt;.  VSTS offers a whole stack of stuff, but my own area of interest has been the Continuous Integration / Continuous Deployment offering.&lt;/p&gt; &lt;p&gt;Historically I have been underwhelmed by the CI proposition of Team Foundation Server / VSTS.  It was difficult to debug, difficult to configure, difficult to understand.  If it worked... Great! If it didn't (and it often didn't), you were toast.  But things done changed!  I don't know when it happened, but VSTS is now super configurable.  You add tasks / configure them, build and you're done!  It's really nice.&lt;/p&gt; &lt;p&gt;However, there's been something I've been missing from Travis, AppVeyor et al.  Keeping my build script with my code. Travis has &lt;code&gt;.travis.yml&lt;/code&gt;, AppVeyor has &lt;code&gt;appveyor.yml&lt;/code&gt;.  VSTS, what's up?&lt;/p&gt; &lt;h4&gt;The New Dawn&lt;/h4&gt; &lt;p&gt;Up until now, really not much.  It just wasn't possible. Until it was:&lt;/p&gt; &lt;blockquote class="twitter-tweet" data-lang="en"&gt;&lt;p lang="en" dir="ltr"&gt;If you prefer a build definition in YAML then were currently hard at work on that. You can enable it as a preview feature: &lt;a href="https://t.co/hau9Sv8brf"&gt;https://t.co/hau9Sv8brf&lt;/a&gt;&lt;/p&gt;&amp;mdash; Martin Woodward (@martinwoodward) &lt;a href="https://twitter.com/martinwoodward/status/970250739510534144?ref_src=twsrc%5Etfw"&gt;March 4, 2018&lt;/a&gt;&lt;/blockquote&gt;&lt;script async src="https://platform.twitter.com/widgets.js" charset="utf-8"&gt;&lt;/script&gt; &lt;p&gt;When I started testing it out I found things to like and some things I didn't understand. Crucially, my CI now builds based upon &lt;code&gt;.vsts-ci.yml&lt;/code&gt;. YAML baby!&lt;/p&gt; &lt;h4&gt;It Begins!&lt;/h4&gt; &lt;p&gt;You can get to "Hello World" by looking at &lt;a href="https://docs.microsoft.com/en-us/vsts/pipelines/build/yaml?view=vsts"&gt;the docs here&lt;/a&gt; and &lt;a href="https://github.com/Microsoft/vsts-agent/blob/master/docs/preview/yamlgettingstarted.md"&gt;the examples here&lt;/a&gt;.  But what you really want is your existing build, configured in the UI, exported to YAML.  That doesn't seem to quite exist, but there's something that gets you part way.  Take a look:&lt;/p&gt; &lt;a href="https://1.bp.blogspot.com/-DvGnGLL98Lc/WyVPlzFXozI/AAAAAAAAK1Y/ukRhpwRcRWckQI6QhrEjmmvCuhkYCxItACLcBGAs/s1600/Screenshot%2B2018-06-16%2B18.49.08.png" imageanchor="1" &gt;&lt;img border="0" src="https://1.bp.blogspot.com/-DvGnGLL98Lc/WyVPlzFXozI/AAAAAAAAK1Y/ukRhpwRcRWckQI6QhrEjmmvCuhkYCxItACLcBGAs/s640/Screenshot%2B2018-06-16%2B18.49.08.png" width="640" height="254" data-original-width="1600" data-original-height="635" /&gt;&lt;/a&gt; &lt;p&gt;If you notice, in the top right of the screen, each task now allows you click on a new "View YAML" button. It's kinda &lt;a href="https://en.wikipedia.org/wiki/Ronseal"&gt;Ronseal&lt;/a&gt;:&lt;/p&gt; &lt;a href="https://2.bp.blogspot.com/-fiYHNC0ASSk/WyVR7qvx8FI/AAAAAAAAK1k/1cSeQXhyGVYPxOtICiqQnQdGImKQuZQMQCPcBGAYYCw/s1600/Screenshot%2B2018-06-16%2B19.04.00.png" imageanchor="1" &gt;&lt;img border="0" src="https://2.bp.blogspot.com/-fiYHNC0ASSk/WyVR7qvx8FI/AAAAAAAAK1k/1cSeQXhyGVYPxOtICiqQnQdGImKQuZQMQCPcBGAYYCw/s400/Screenshot%2B2018-06-16%2B19.04.00.png" width="400" height="344" data-original-width="1224" data-original-height="1053" /&gt;&lt;/a&gt; &lt;p&gt;Using this hotness you can build yourself a &lt;code&gt;.vsts-ci.yml&lt;/code&gt; file task by task.&lt;/p&gt; &lt;h4&gt;A Bump in the Road&lt;/h4&gt; &lt;p&gt;If you look closely at the message above you'll see there's a message about an undefined variable.&lt;/p&gt; &lt;pre class="prettyprint yml"&gt;&lt;br /&gt;&lt;code class="language-yml"&gt;&lt;br /&gt;#Your build definition references an undefined variable named Parameters.RestoreBuildProjects. Create or edit the build definition for this YAML file, define the variable on the Variables tab. See https://go.microsoft.com/fwlink/?linkid=865972&lt;br /&gt;steps:&lt;br /&gt;- task: DotNetCoreCLI@2&lt;br /&gt;  displayName: Restore&lt;br /&gt;  inputs:&lt;br /&gt;    command: restore&lt;br /&gt;    projects: '$(Parameters.RestoreBuildProjects)'&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Try as I might, I couldn't locate &lt;code&gt;Parameters.RestoreBuildProjects&lt;/code&gt;.  So no working CI build for me.  Then I remembered &lt;a href="https://github.com/zerdos"&gt;Zoltan Erdos&lt;/a&gt;. He's hard to forget.  Or rather, I remembered an idea of his which I will summarise thusly: "Have a &lt;code&gt;package.json&lt;/code&gt; in the root of your repo, use the &lt;code&gt;scripts&lt;/code&gt; for individual tasks and you have a cross platform task runner".&lt;/p&gt; &lt;p&gt;This is a powerful idea and one I decided to put to work.  My project is React and TypeScript on the front end, and ASP.Net Core on the back.  I wanted a &lt;code&gt;package.json&lt;/code&gt; in the root of the repo which I could install dependencies, build, test and publish my whole app. I could call into that from my &lt;code&gt;.vsts-ci.yml&lt;/code&gt; file.  Something like this:&lt;/p&gt; &lt;pre class="prettyprint json"&gt;&lt;br /&gt;&lt;code class="language-json"&gt;&lt;br /&gt;{&lt;br /&gt;  "name": "my-amazing-project",&lt;br /&gt;  "version": "1.0.0",&lt;br /&gt;  "author": "John Reilly &lt;johnny_reilly@hotmail.com&gt;",&lt;br /&gt;  "license": "MIT",&lt;br /&gt;  "private": true,&lt;br /&gt;  "scripts": {&lt;br /&gt;    "preinstall": "yarn run install:clientapp &amp;&amp; yarn run install:web",&lt;br /&gt;    "install:clientapp": "cd MyAmazingProject.ClientApp &amp;&amp; yarn install",&lt;br /&gt;    "install:web": "dotnet restore",&lt;br /&gt;    "prebuild": "yarn install",&lt;br /&gt;    "build": "yarn run build:clientapp &amp;&amp; yarn run build:web",&lt;br /&gt;    "build:clientapp": "cd MyAmazingProject.ClientApp &amp;&amp; yarn run build",&lt;br /&gt;    "build:web": "dotnet build --configuration Release",&lt;br /&gt;    "postbuild": "yarn test",&lt;br /&gt;    "test": "yarn run test:clientapp &amp;&amp; yarn run test:web",&lt;br /&gt;    "test:clientapp": "cd MyAmazingProject.ClientApp &amp;&amp; yarn test",&lt;br /&gt;    "test:web": "cd MyAmazingProject.Web.Tests &amp;&amp; dotnet test",&lt;br /&gt;    "publish:web": "cd MyAmazingProject.Web &amp;&amp; dotnet publish MyAmazingProject.Web.csproj --configuration Release"&lt;br /&gt;  }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;It doesn't matter if I have "an undefined variable named Parameters.RestoreBuildProjects".  I now have no need to use all the individual tasks in a build.  I can convert them into a couple of scripts in my &lt;code&gt;package.json&lt;/code&gt;. So here's where I've ended up for now.  I've a &lt;code&gt;.vsts-ci.yml&lt;/code&gt; file which looks like this:&lt;/p&gt; &lt;pre class="prettyprint yml"&gt;&lt;br /&gt;&lt;code class="language-yml"&gt;&lt;br /&gt;queue: Hosted VS2017&lt;br /&gt;&lt;br /&gt;steps:&lt;br /&gt;- task: geeklearningio.gl-vsts-tasks-yarn.yarn-installer-task.YarnInstaller@2&lt;br /&gt;  displayName: install yarn itself&lt;br /&gt;  inputs:&lt;br /&gt;    checkLatest: true&lt;br /&gt;- task: geeklearningio.gl-vsts-tasks-yarn.yarn-task.Yarn@2&lt;br /&gt;  displayName: yarn build and test&lt;br /&gt;  inputs:&lt;br /&gt;    Arguments: build&lt;br /&gt;- task: geeklearningio.gl-vsts-tasks-yarn.yarn-task.Yarn@2&lt;br /&gt;  displayName: yarn publish:web&lt;br /&gt;  inputs:&lt;br /&gt;    Arguments: 'run publish:web --output $(build.artifactstagingdirectory)/MyAmazingProject'&lt;br /&gt;- task: PublishBuildArtifacts@1&lt;br /&gt;  displayName: publish build artifact&lt;br /&gt;  inputs:&lt;br /&gt;    PathtoPublish: '$(build.artifactstagingdirectory)'&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;This file does the following:&lt;/p&gt; &lt;ol&gt;&lt;li&gt;Installs yarn. (By the way VSTS, what's with not having yarn installed by default? I'll say this for the avoidance of doubt: in the npm cli space: yarn has won.)&lt;/li&gt;&lt;li&gt;Install our dependencies, build the front end and back end, run all the tests.  Effectively &lt;code&gt;yarn build&lt;/code&gt;.&lt;/li&gt;&lt;li&gt;Publish our web app to a directory.  Effectively &lt;code&gt;yarn run publish:web&lt;/code&gt;. This is only separate because we want to pass in the output directory and so it's just easier for it to be a separate step.&lt;/li&gt;&lt;li&gt;Publish the build artefact to TFS. (This will go on to be picked up by the continuous deployment mechanism and published out to Azure.)&lt;/li&gt;&lt;/ol&gt; &lt;p&gt;I much prefer this to what I had before.  I feel there's much more that can be done here as well.  I'm looking forward to the continuous deployment piece becoming scriptable too.&lt;/p&gt; &lt;p&gt;Thanks to Zoltan and props to the TFVS team!&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3526827284243388498'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3526827284243388498'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2018/06/vsts-yaml-up.html' title='VSTS... YAML up!'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='https://1.bp.blogspot.com/-DvGnGLL98Lc/WyVPlzFXozI/AAAAAAAAK1Y/ukRhpwRcRWckQI6QhrEjmmvCuhkYCxItACLcBGAs/s72-c/Screenshot%2B2018-06-16%2B18.49.08.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-601715248645445970</id><published>2018-05-13T09:05:00.000+01:00</published><updated>2018-05-13T09:05:23.190+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='compromise'/><category scheme='http://www.blogger.com/atom/ns#' term='empathy'/><category scheme='http://www.blogger.com/atom/ns#' term='developers'/><category scheme='http://www.blogger.com/atom/ns#' term='code style'/><category scheme='http://www.blogger.com/atom/ns#' term='teams'/><title type='text'>Compromising: A Guide for Developers</title><content type='html'>&lt;p&gt;It is a truth universally acknowledged, that a single developer, will not be short of an opinion.  Opinions on tabs vs spaces.  Upon OOP vs FP. Upon &lt;code&gt;class&lt;/code&gt;es vs &lt;code&gt;function&lt;/code&gt;s.  Just opinions, opinions, opinions. Opinions that are felt with all the sincerity of a Witchfinder General.  And, alas, not always the same level of empathy.&lt;/p&gt; &lt;p&gt;Given the wealth of strongly felt desires, it's kind of amazing that developers ever manage to work together.  It's rare to find a fellow dev that agrees entirely with your predilections.  So how do people ever get past the "you don't use semi-colons; what's wrong with you"?  Well, not easily to be honest.  It involves compromise.&lt;/p&gt; &lt;h4&gt;On Compromise&lt;/h4&gt; &lt;p&gt;We've all been in the position where we realise that there's something we don't like in a codebase.  The ordering of members in a &lt;code&gt;class&lt;/code&gt;, naming conventions, a lack of tests... Something.&lt;/p&gt; &lt;p&gt;Then comes the moment of trepidation.  You suggest a change.  You suggest difference.  It's time to find out if you're working with psychopaths.  It's not untypical to find that you just have to go with the flow.&lt;/p&gt; &lt;ul&gt;&lt;li&gt;"You've been using 3 spaces?"&lt;/li&gt;&lt;li&gt;"Yes we use 3 spaces."&lt;/li&gt;&lt;li&gt;"Okay... So we'll be using 3 spaces..." [backs away carefully]&lt;/li&gt;&lt;/ul&gt; &lt;p&gt;I've been in this position so many times I've learned to adapt.  It helps that I'm a malleable sort anyway.  But what if there were another way?&lt;/p&gt; &lt;h4&gt;Weighting Opinion&lt;/h4&gt; &lt;p&gt;Sometimes your opinion is... Well.... Just an opinion.  Other opinions are legitimate.  At least in theory.  If you can acknowledge that, you already have a level of self knowledge not gifted to all in the dev community.  If you're able to get that far I feel there's something you might want to consider.  &lt;/p&gt; &lt;p&gt;Let me frame this up: there's a choice to be made around an approach that could be used in a codebase.  There are 2 camps in the team; 1 camp advocating for 1 approach.  The other for a different approach.  Either one is functionally legitimate.  They work.  It's just a matter of preference of choice.  How do you choose now?  Let's look at a technique for splitting the difference.&lt;/p&gt; &lt;p&gt;Voting helps.  But let's say 50% of the team wants 1 approach and 50% wants the other.  What then?  Or, to take a more interesting idea, what say 25% want 1 approach and 75% want the other?  If it's just 1 person, 1 vote then the 75% wins and that's it.&lt;/p&gt; &lt;p&gt;But before we all move on, let's consider another factor.  How much do people care?  What if the 25% are really, really invested in the choice they're advocating for and the 75% just have a mild preference?  From that point forwards the 25% are likely going to be less happy.  Maybe they'll even burn inside.  They're certainly going to be less productive.&lt;/p&gt; &lt;p&gt;It's because of situations like this that weighting votes becomes useful.  Out of 5, how much do you care?  If one person cares "5 out of 5" and the other three are "1 out of 5".... Well go with the 25%  It matters to them and that it matters to them should matter to you.&lt;/p&gt; &lt;p&gt;I'll contend that rolling like this makes for more content, happier and more productive teams. Making strength of feeling a factor in choices reduces friction and increases the peace.&lt;/p&gt; &lt;a href="https://3.bp.blogspot.com/-mg_-2oAjkxE/WvfwNZe3bPI/AAAAAAAAJ7c/CrsL9e0J2pg_t0H3G4aevVAL-c0W0us8wCPcBGAYYCw/s1600/Bestival_2008_Increase_the_Peace_banner.jpg" imageanchor="1" &gt;&lt;img border="0" src="https://3.bp.blogspot.com/-mg_-2oAjkxE/WvfwNZe3bPI/AAAAAAAAJ7c/CrsL9e0J2pg_t0H3G4aevVAL-c0W0us8wCPcBGAYYCw/s640/Bestival_2008_Increase_the_Peace_banner.jpg" width="640" height="427" data-original-width="1161" data-original-height="774" /&gt;&lt;/a&gt; &lt;p&gt;I've only recently discovered this technique and I can't claim credit for it. I learned it from the awesome &lt;a href="https://twitter.com/foldr"&gt;Jamie McCrindle&lt;/a&gt;. I commend to you!  Be happier!&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/601715248645445970'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/601715248645445970'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2018/05/compromising-guide-for-developers.html' title='Compromising: A Guide for Developers'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='https://3.bp.blogspot.com/-mg_-2oAjkxE/WvfwNZe3bPI/AAAAAAAAJ7c/CrsL9e0J2pg_t0H3G4aevVAL-c0W0us8wCPcBGAYYCw/s72-c/Bestival_2008_Increase_the_Peace_banner.jpg' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-51151098989201624</id><published>2018-04-28T05:46:00.003+01:00</published><updated>2021-03-04T05:36:18.597Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='reflection'/><category scheme='http://www.blogger.com/atom/ns#' term='test'/><category scheme='http://www.blogger.com/atom/ns#' term='dependencies'/><title type='text'>Using Reflection to Identify Unwanted Dependencies</title><content type='html'>&lt;p&gt;I having a web app which is fairly complex.  It's made up of services, controllers and all sorts of things.  So far, so unremarkable.  However, I needed to ensure that the controllers did not attempt to access the database via any of their dependencies.  Or their dependencies, dependencies.  Or their dependencies.  You get my point.&lt;/p&gt; &lt;p&gt;The why is not important here.  What's significant is the idea of walking a dependency tree and identifying, via a reflection based test, when such unwelcome dependencies occur, and where.&lt;/p&gt; &lt;p&gt;When they do occur the test should fail, like this:&lt;/p&gt; &lt;pre class="prettyprint sh"&gt;&lt;br /&gt;&lt;code class="language-sh"&gt;&lt;br /&gt;[xUnit.net 00:00:01.6766691]     My.Web.Tests.HousekeepingTests.My_Api_Controllers_do_not_depend_upon_the_database [FAIL]&lt;br /&gt;[xUnit.net 00:00:01.6782295]       Expected dependsUponTheDatabase.Any() to be False because My.Api.Controllers.ThingyController depends upon the database through My.Data.Services.OohItsAService, but found True.&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;What follows is an example of how you can accomplish this.  It is exceedingly far from the most beautiful code I've ever written.  But it works.  One reservation I have about it is that it doesn't use the Dependency Injection mechanism used at runtime (AutoFac).  If I had more time I would amend the code to use that instead; it would become an easier test to read if I did.  Also it would better get round the limitations of the code below.  Essentially the approach relies on the assumption of there being 1 interface and 1 implementation.  That's often not true in complex systems.  But this is good enough to roll with for now.&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;using System;&lt;br /&gt;using System.Collections.Generic;&lt;br /&gt;using System.Linq;&lt;br /&gt;using System.Reflection;&lt;br /&gt;using FluentAssertions;&lt;br /&gt;using My.Data;&lt;br /&gt;using My.Web.Controllers;&lt;br /&gt;using Xunit;&lt;br /&gt;&lt;br /&gt;namespace My.Web.Tests {&lt;br /&gt;    public class OiYouThereGetOutTests {&lt;br /&gt;        [Fact]&lt;br /&gt;        public void My_Controllers_do_not_depend_upon_the_database() {&lt;br /&gt;            var myConcreteTypes = GetMyAssemblies()&lt;br /&gt;                .SelectMany(assembly =&amp;gt; assembly.GetTypes())&lt;br /&gt;                .ToArray();&lt;br /&gt;&lt;br /&gt;            var controllerTypes = typeof(My.Web.Startup).Assembly.GetTypes()&lt;br /&gt;                .Where(myWebType =&amp;gt;&lt;br /&gt;                    myWebType != typeof(Microsoft.AspNetCore.Mvc.Controller) &amp;&amp;&lt;br /&gt;                    typeof(Microsoft.AspNetCore.Mvc.Controller).IsAssignableFrom(myWebType));&lt;br /&gt;&lt;br /&gt;            foreach (var controllerType in controllerTypes) {&lt;br /&gt;                var allTheTypes = GetDependentTypes(controllerType, myConcreteTypes);&lt;br /&gt;                allTheTypes.Count.Should().BeGreaterThan(0);&lt;br /&gt;                var dependsUponTheDatabase = allTheTypes.Where(keyValue =&amp;gt; keyValue.Key == typeof(MyDbContext));&lt;br /&gt;                dependsUponTheDatabase.Any().Should().Be(false, because: $"{controllerType} depends upon the database through {string.Join(", ", dependsUponTheDatabase.Select(dod =&amp;gt; dod.Value))}");&lt;br /&gt;            }&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        private static Dictionary&amp;lt;Type, Type&amp;gt; GetDependentTypes(Type type, Type[] typesToCheck, Dictionary&amp;lt;Type, Type&amp;gt; typesSoFar = null) {&lt;br /&gt;            var types = typesSoFar ?? new Dictionary&amp;lt;Type, Type&amp;gt;();&lt;br /&gt;            foreach (var constructor in type.GetConstructors().Where(ctor =&amp;gt; ctor.IsPublic)) {&lt;br /&gt;                foreach (var parameter in constructor.GetParameters()) {&lt;br /&gt;                    if (parameter.ParameterType.IsInterface) {&lt;br /&gt;                        if (parameter.ParameterType.IsGenericType) {&lt;br /&gt;                            foreach (var genericType in parameter.ParameterType.GenericTypeArguments) {&lt;br /&gt;                                AddIfMissing(types, genericType, type);&lt;br /&gt;                            }&lt;br /&gt;                        } else {&lt;br /&gt;                            var typesImplementingInterface = TypesImplementingInterface(parameter.ParameterType, typesToCheck);&lt;br /&gt;                            foreach (var typeImplementingInterface in typesImplementingInterface) {&lt;br /&gt;                                AddIfMissing(types, typeImplementingInterface, type);&lt;br /&gt;                                AddIfMissing(types, GetDependentTypes(typeImplementingInterface, typesToCheck, types).Keys.ToList(), type);&lt;br /&gt;                            }&lt;br /&gt;                        }&lt;br /&gt;                    } else {&lt;br /&gt;                        AddIfMissing(types, parameter.ParameterType, type);&lt;br /&gt;                        AddIfMissing(types, GetDependentTypes(parameter.ParameterType, typesToCheck, types).Keys.ToList(), type);&lt;br /&gt;                    }&lt;br /&gt;                }&lt;br /&gt;            }&lt;br /&gt;            return types;&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        private static void AddIfMissing(Dictionary&amp;lt;Type, Type&amp;gt; types, Type typeToAdd, Type parentType) {&lt;br /&gt;            if (!types.Keys.Contains(typeToAdd))&lt;br /&gt;                types.Add(typeToAdd, parentType);&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        private static void AddIfMissing(Dictionary&amp;lt;Type, Type&amp;gt; types, IList&amp;lt;Type&amp;gt; typesToAdd, Type parentType) {&lt;br /&gt;            foreach (var typeToAdd in typesToAdd) {&lt;br /&gt;                AddIfMissing(types, typeToAdd, parentType);&lt;br /&gt;            }&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        private static Type[] TypesImplementingInterface(Type interfaceType, Type[] typesToCheck) =&amp;gt;&lt;br /&gt;            typesToCheck.Where(type =&amp;gt; !type.IsInterface &amp;&amp; interfaceType.IsAssignableFrom(type)).ToArray();&lt;br /&gt;&lt;br /&gt;        private static bool IsRealClass(Type testType) =&amp;gt;&lt;br /&gt;            testType.IsAbstract == false &amp;&amp;&lt;br /&gt;            testType.IsGenericType == false &amp;&amp;&lt;br /&gt;            testType.IsGenericTypeDefinition == false &amp;&amp;&lt;br /&gt;            testType.IsInterface == false;&lt;br /&gt;&lt;br /&gt;        private static Assembly[] GetMyAssemblies() =&amp;gt;&lt;br /&gt;            AppDomain&lt;br /&gt;            .CurrentDomain&lt;br /&gt;            .GetAssemblies()&lt;br /&gt;            // Not strictly necessary but it reduces the amount of types returned&lt;br /&gt;            .Where(assembly =&amp;gt; assembly.GetName().Name.StartsWith("My")) &lt;br /&gt;            .ToArray();&lt;br /&gt;    }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/51151098989201624'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/51151098989201624'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2018/04/using-reflection-to-identify-unwanted-dependencies.html' title='Using Reflection to Identify Unwanted Dependencies'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3099270398623348569</id><published>2018-03-26T17:59:00.001+01:00</published><updated>2021-03-04T05:37:49.287Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='uglifyjs'/><category scheme='http://www.blogger.com/atom/ns#' term='mobx'/><category scheme='http://www.blogger.com/atom/ns#' term='dead code elimination'/><category scheme='http://www.blogger.com/atom/ns#' term='Webpack'/><title type='text'>It's Not Dead 2: mobx-react-devtools and the undead</title><content type='html'>&lt;p&gt;I spent today digging through our webpack 4 config trying to work out why a production bundle contained code like this:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;if("production"!==e.env.NODE_ENV){//...&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;My expectation was that with webpack 4 and &lt;code&gt;'mode': 'production'&lt;/code&gt; this meant that behind the scenes all &lt;code&gt;process.env.NODE_ENV&lt;/code&gt; statements should be converted to &lt;code&gt;'production'&lt;/code&gt;.  Subsequently Uglify would automatically get its groove on with the resulting &lt;code&gt;if("production"!=="production") ...&lt;/code&gt; and et voil!... Strip the dead code.&lt;/p&gt; &lt;p&gt;It seemed that was not the case.  I was seeing (regrettably) undead code.  And who here actually likes the undead?&lt;/p&gt; &lt;h4&gt;Who Betrayed Me?&lt;/h4&gt; &lt;p&gt;My beef was with webpack.  It done did me wrong.  Or... So I thought. webpack did nothing wrong. It is pure and good and unjustly complained about.  It was my other love: &lt;a href="https://github.com/mobxjs/mobx"&gt;mobx&lt;/a&gt;.  Or to be more specific: &lt;a href="https://github.com/mobxjs/mobx-react-devtools"&gt;mobx-react-devtools&lt;/a&gt;.&lt;/p&gt; &lt;p&gt;It turns out that the way you use &lt;code&gt;mobx-react-devtools&lt;/code&gt; reliably makes the difference.  It's the cause of the stray &lt;code&gt;("production"!==e.env.NODE_ENV)&lt;/code&gt; statements in our bundle output.  After a &lt;strong&gt;long&lt;/strong&gt; time I happened upon &lt;a href="https://github.com/mobxjs/mobx-react-devtools/issues/66#issuecomment-365151531"&gt;this issue&lt;/a&gt; which contained a gem by one &lt;a href="https://github.com/gilesbutler"&gt;Giles Butler&lt;/a&gt;.  His suggested way to reference &lt;code&gt;mobx-react-devtools&lt;/code&gt; is (as far as I can tell) the solution!&lt;/p&gt; &lt;p&gt;On a dummy project I had the &lt;code&gt;mobx-react-devtools&lt;/code&gt; advised code in place:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;import * as React from 'react';&lt;br /&gt;import { Layout } from './components/layout';&lt;br /&gt;import DevTools from 'mobx-react-devtools';&lt;br /&gt;&lt;br /&gt;export const App: React.SFC&amp;lt;{}&amp;gt; = _props =&amp;gt; (&lt;br /&gt;    &amp;lt;div className="ui container"&amp;gt;&lt;br /&gt;        &amp;lt;Layout /&amp;gt;&lt;br /&gt;        {process.env.NODE_ENV !== 'production' ? &amp;lt;DevTools position={{ bottom: 20, right: 20 }} /&amp;gt; : null}&lt;br /&gt;    &amp;lt;/div&amp;gt;&lt;br /&gt;);&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;With this I had a build size of 311kb.  Closer examination of my bundle revealed that my &lt;code&gt;bundle.js&lt;/code&gt; was riddled with &lt;code&gt;("production"!==e.env.NODE_ENV)&lt;/code&gt; statements. Sucks, right?&lt;/p&gt; &lt;p&gt;Then I tried this instead:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;import * as React from 'react';&lt;br /&gt;import { Layout } from './components/layout';&lt;br /&gt;const { Fragment } = React;&lt;br /&gt;&lt;br /&gt;const DevTools = process.env.NODE_ENV !== 'production' ? require('mobx-react-devtools').default : Fragment;&lt;br /&gt;&lt;br /&gt;export const App: React.SFC&amp;lt;{}&amp;gt; = _props =&amp;gt; (&lt;br /&gt;    &amp;lt;div className="ui container"&amp;gt;&lt;br /&gt;        &amp;lt;Layout /&amp;gt;&lt;br /&gt;        &amp;lt;DevTools position={{ bottom: 20, right: 20 }} /&amp;gt;&lt;br /&gt;    &amp;lt;/div&amp;gt;&lt;br /&gt;);&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;With this approach I got a build size of 191kb.  This was thanks to the dead code being actually stripped.  That's a saving of 120kb!&lt;/p&gt; &lt;h4&gt;Perhaps We Change the Advice?&lt;/h4&gt; &lt;p&gt;There's a suggestion that the README should be changed to reflect this advice - until that happens, I wanted to share this solution. Also, I've a nagging feeling that I've missed something pertinent here; if someone knows something that I should... Tell me please!&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3099270398623348569'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3099270398623348569'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2018/03/its-not-dead-2-mobx-react-devtools-and-the-undead.html' title='It&apos;s Not Dead 2: mobx-react-devtools and the undead'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3102815771257755512</id><published>2018-03-25T17:39:00.001+01:00</published><updated>2021-03-04T05:39:20.175Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='React Dropzone'/><category scheme='http://www.blogger.com/atom/ns#' term='Cloudinary'/><category scheme='http://www.blogger.com/atom/ns#' term='Fetch API'/><title type='text'>Uploading Images to Cloudinary with the Fetch API</title><content type='html'>&lt;p&gt;I was recently checking out a &lt;a href="https://css-tricks.com/image-upload-manipulation-react/"&gt;very good post&lt;/a&gt; which explained how to upload images using &lt;a href="https://github.com/react-dropzone/react-dropzone"&gt;React Dropzone&lt;/a&gt; and &lt;a href="https://github.com/visionmedia/superagent"&gt;SuperAgent&lt;/a&gt; to &lt;a href="https://cloudinary.com/"&gt;Cloudinary&lt;/a&gt;.&lt;/p&gt; &lt;p&gt;It's a brilliant post; you should totally read it.  Even if you hate images, uploads and JavaScript.  However, there was one thing in there that I didn't want; SuperAgent.  It's lovely but I'm a &lt;a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API"&gt;Fetch&lt;/a&gt; guy. That's just how I roll.  The question is, how do I do the below using Fetch?&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;  handleImageUpload(file) {&lt;br /&gt;    let upload = request.post(CLOUDINARY_UPLOAD_URL)&lt;br /&gt;                     .field('upload_preset', CLOUDINARY_UPLOAD_PRESET)&lt;br /&gt;                     .field('file', file);&lt;br /&gt;&lt;br /&gt;    upload.end((err, response) =&gt; {&lt;br /&gt;      if (err) {&lt;br /&gt;        console.error(err);&lt;br /&gt;      }&lt;br /&gt;&lt;br /&gt;      if (response.body.secure_url !== '') {&lt;br /&gt;        this.setState({&lt;br /&gt;          uploadedFileCloudinaryUrl: response.body.secure_url&lt;br /&gt;        });&lt;br /&gt;      }&lt;br /&gt;    });&lt;br /&gt;  }&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Well it actually took me longer to work out than I'd like to admit.  But now I have, let me save you the bother.  To do the above using Fetch you just need this:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;  handleImageUpload(file) {&lt;br /&gt;    const formData = new FormData();&lt;br /&gt;    formData.append("file", file);&lt;br /&gt;    formData.append("upload_preset", CLOUDINARY_UPLOAD_PRESET); // Replace the preset name with your own&lt;br /&gt;&lt;br /&gt;    fetch(CLOUDINARY_UPLOAD_URL, {&lt;br /&gt;      method: 'POST',&lt;br /&gt;      body: formData&lt;br /&gt;    })&lt;br /&gt;      .then(response =&gt; response.json())&lt;br /&gt;      .then(data =&gt; {&lt;br /&gt;        if (data.secure_url !== '') {&lt;br /&gt;          this.setState({&lt;br /&gt;            uploadedFileCloudinaryUrl: data.secure_url&lt;br /&gt;          });&lt;br /&gt;        }&lt;br /&gt;      })&lt;br /&gt;      .catch(err =&gt; console.error(err))&lt;br /&gt;  }&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;To get a pre-canned project to try this with take a look at &lt;a href="https://github.com/damonbauer/react-cloudinary"&gt;Damon's repo&lt;/a&gt;.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3102815771257755512'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3102815771257755512'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2018/03/uploading-images-to-cloudinary-with-fetch.html' title='Uploading Images to Cloudinary with the Fetch API'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-7738690794697097990</id><published>2018-03-19T07:38:00.001Z</published><updated>2018-03-19T07:38:52.869Z</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Loggly, Serilog and ASP.Net Core</title><content type='html'>loggly source setup HTTP/S Event Endpoint  using System; using System.Collections.Generic; using System.IO; using System.Linq; using System.Threading.Tasks; using Microsoft.AspNetCore; using Microsoft.AspNetCore.Hosting; using Microsoft.Extensions.Configuration; using Microsoft.Extensions.Logging; using Autofac.Extensions.DependencyInjection; using Serilog; using Serilog.Events; using Loggly.Config; using Loggly; using Serilog.Sinks.Loggly; using System.Globalization;  namespace InvoCollect.Web {     public class Program     {         public static void Main(string[] args)         {             BuildWebHost(args).Run();         }          private static void MakeLogglyConfiguration(IHostingEnvironment hostingEnvironment, IConfigurationSection configSection)         {             // http://logs-01.loggly.com/inputs/937e3a73-ab15-4d70-9deb-9b60535938c2/tag/http/             var config = LogglyConfig.Instance;             config.CustomerToken = configSection.GetValue&lt;string&gt;("CustomerToken");             config.ApplicationName = $"{hostingEnvironment.ApplicationName}-{hostingEnvironment.EnvironmentName}";             config.Transport = new TransportConfiguration()             {                 EndpointHostname = configSection.GetValue&lt;string&gt;("EndpointHostname"),                 EndpointPort = 443,                 LogTransport = LogTransport.Https             };             config.ThrowExceptions = true;              // Define Tags sent to Loggly             config.TagConfig.Tags.AddRange(new ITag[]{                 new ApplicationNameTag {Formatter = "application-{0}"},                 new HostnameTag { Formatter = "host-{0}" }             });          }          static CultureInfo CreateLoggingCulture()         {             var loggingCulture = new CultureInfo("");              //with this DateTime and DateTimeOffset string representations will be sortable. By default,              // serialization without a culture or formater will use InvariantCulture. This may or may not be              // desirable, depending on the sorting needs you require or even the region your in. In this sample             // the invariant culture is used as a base, but the DateTime format is changed to a specific representation.             // Instead of the dd/MM/yyyy hh:mm:ss, we'll force yyyy-MM-dd HH:mm:ss.fff which is sortable and obtainable             // by overriding ShortDatePattern and LongTimePattern.             //             //Do note that they don't include the TimeZone by default, so a datetime will not have the TZ             // while a DateTimeOffset will in it's string representation.              // Both use the longTimePattern for time formatting, but including the time zone in the              // pattern will duplicate the TZ representation when using DateTimeOffset which serilog does             // for the timestamp.             //             //If you do not require specific formats, this method will not be required. Just pass in null (the default)              // for IFormatProvider in the Loggly() sink configuration method.              loggingCulture.DateTimeFormat.ShortDatePattern = "yyyy-MM-dd";             loggingCulture.DateTimeFormat.LongTimePattern = "HH:mm:ss.fff";              return loggingCulture;         }                  public static IWebHost BuildWebHost(string[] args) =&gt;            WebHost.CreateDefaultBuilder(args)                 .ConfigureServices(services =&gt; services.AddAutofac())                 .UseStartup&lt;Startup&gt;()                 .UseSerilog((hostingContext, loggerConfiguration) =&gt;                {                     MakeLogglyConfiguration(hostingContext.HostingEnvironment, hostingContext.Configuration.GetSection("LogglyConfig"));                      loggerConfiguration                         .ReadFrom.Configuration(hostingContext.Configuration)                         .Enrich.FromLogContext()                         .WriteTo.Console()                         .WriteTo.Loggly(formatProvider: CreateLoggingCulture())                         .WriteTo.File(                             @"D:\home\LogFiles\invo-collect-demo\invo-collect-demo.txt",                             fileSizeLimitBytes: 1_000_000,                             rollOnFileSizeLimit: true,                             shared: true,                             flushToDiskInterval: TimeSpan.FromSeconds(1)                         );                  })                 .Build();     } }    "LogglyConfig": {     "CustomerToken": "937e3a73-ab15-4d70-9deb-9b60535938c2",     "EndpointHostname": "logs-01.loggly.com"   },    loggly-csharp   Serilog.Sinks.Loggly  </content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7738690794697097990'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7738690794697097990'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5730909255972386338</id><published>2018-03-07T06:02:00.002Z</published><updated>2021-03-14T05:35:35.606Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='webpack; dead code elimination; process.env.NODE_ENV; DefinePlugin'/><title type='text'>It's Not Dead: webpack and dead code elimination limitations</title><content type='html'>&lt;p&gt;Every now and then you can be surprised. Your assumptions turn out to be wrong.&lt;/p&gt; &lt;p&gt;Webpack has long supported the notion of dead code elimination.  webpack facilitates this through use of the &lt;code&gt;DefinePlugin&lt;/code&gt;.  The compile time value of &lt;code&gt;process.env.NODE_ENV&lt;/code&gt; is set either to &lt;code&gt;'production'&lt;/code&gt; or something else.  If it's set to &lt;code&gt;'production'&lt;/code&gt; then some dead code hackery can happen.  &lt;a href="https://reactjs.org/docs/optimizing-performance.html#webpack"&gt;Libraries like React make use of this to serve up different, and crucially smaller, production builds.&lt;/a&gt;&lt;/p&gt; &lt;p&gt;A (pre-webpack 4) production config file will typically contain this code:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;new webpack.DefinePlugin({&lt;br /&gt;    'process.env.NODE_ENV': JSON.stringify('production')&lt;br /&gt;}),&lt;br /&gt;new UglifyJSPlugin(),&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;The result of the above config is that webpack will inject the value 'production' everywhere in the codebase where a &lt;code&gt;process.env.NODE_ENV&lt;/code&gt; can be found. (In fact, as of webpack 4 setting this magic value is out-of-the-box behaviour for Production mode; yay the #0CJS!)&lt;/p&gt; &lt;p&gt;What this means is, if you've written:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;if (process.env.NODE_ENV !== 'production') {&lt;br /&gt;  // Do a development mode only thing&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;webpack can and will turn this into&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;if ('production' !== 'production') {&lt;br /&gt;  // Do a development mode only thing&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;The &lt;a href="https://github.com/webpack-contrib/uglifyjs-webpack-plugin"&gt;UglifyJSPlugin&lt;/a&gt; is there to minify the JavaScript in your bundles.  As an added benefit, this plugin is smart enough to know that &lt;code&gt;'production' !== 'production'&lt;/code&gt; is always &lt;code&gt;false&lt;/code&gt;.  And because it's smart, it chops the code.  Dead code elimated.&lt;/p&gt; &lt;p&gt;You can read more about this &lt;a href="https://webpack.js.org/guides/production/#specify-the-environment"&gt;in the webpack docs&lt;/a&gt;.&lt;/p&gt; &lt;h4&gt;Limitations&lt;/h4&gt; &lt;p&gt;Given what I've said, consider the following code:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;export class Config {&lt;br /&gt;    // Other properties&lt;br /&gt;&lt;br /&gt;    get isDevelopment() {&lt;br /&gt;        return process.env.NODE_ENV !== 'production';&lt;br /&gt;    }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;This is a config class that exposes the expression &lt;code&gt;process.env.NODE_ENV !== 'production'&lt;/code&gt; with the friendly name &lt;code&gt;isDevelopment&lt;/code&gt;. You'd think that dead code elimination would be your friend here.  It's not.&lt;/p&gt; &lt;p&gt;My personal expection was that dead code elimination would treat &lt;code&gt;Config.isDevelopment&lt;/code&gt; and the expression &lt;code&gt;process.env.NODE_ENV !== 'production'&lt;/code&gt; identically.  Because they're identical.&lt;/p&gt; &lt;p&gt;However, this turns out not to be the case.  Dead code elimination works just as you would hope when using the expression &lt;code&gt;process.env.NODE_ENV !== 'production'&lt;/code&gt; directly in code. However webpack &lt;strong&gt;only&lt;/strong&gt; performs dead code elimination for the &lt;strong&gt;direct&lt;/strong&gt; usage of the &lt;code&gt;process.env.NODE_ENV !== 'production'&lt;/code&gt; expression. I'll say that again: if you want dead code elimination then use the injected values; not an encapsulated version of them. It turns out you cannot rely on webpack flowing values through and performing dead code elimination on that basis.&lt;/p&gt; &lt;p&gt;The TL;DR: if you want to elimate dead code then *always* use &lt;code&gt;process.env.NODE_ENV !== 'production'&lt;/code&gt;; don't abstract it.  It doesn't work.&lt;/p&gt; &lt;p&gt;UglifyJS is smart. But not that smart.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5730909255972386338'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5730909255972386338'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2018/03/its-not-dead-webpack-and-dead-code.html' title='It&apos;s Not Dead: webpack and dead code elimination limitations'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-7076776976362961257</id><published>2018-02-25T08:42:00.000Z</published><updated>2018-03-17T13:53:57.080Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='webpack 4'/><category scheme='http://www.blogger.com/atom/ns#' term='fork-ts-checker-webpack-plugin'/><category scheme='http://www.blogger.com/atom/ns#' term='ts-loader'/><title type='text'>ts-loader 4 / fork-ts-checker-webpack-plugin 0.4</title><content type='html'>&lt;p&gt;webpack 4 has shipped!&lt;/p&gt; &lt;h4&gt;&lt;code&gt;ts-loader&lt;/code&gt;&lt;/h4&gt; &lt;p&gt;The &lt;a href="https://github.com/TypeStrong/ts-loader"&gt;&lt;code&gt;ts-loader&lt;/code&gt;&lt;/a&gt; 4 is available too.  For details see our release &lt;a href="https://github.com/TypeStrong/ts-loader/releases/tag/v4.0.0"&gt;here&lt;/a&gt;.  To start using &lt;code&gt;ts-loader&lt;/code&gt; 4:&lt;/p&gt; &lt;ul&gt;&lt;li&gt;When using &lt;code&gt;yarn&lt;/code&gt;: &lt;code&gt;yarn add ts-loader@4.1.0 -D&lt;/code&gt;&lt;/li&gt;&lt;li&gt;When using &lt;code&gt;npm&lt;/code&gt;: &lt;code&gt;npm install ts-loader@4.1.0 -D&lt;/code&gt;&lt;/li&gt;&lt;/ul&gt; &lt;p&gt;Remember to use this in concert with the webpack 4.  To see a working example take a look at &lt;a href="https://github.com/johnnyreilly/ts-loader/tree/master/examples/vanilla"&gt;the "vanilla" example&lt;/a&gt;.&lt;/p&gt; &lt;h4&gt;&lt;code&gt;fork-ts-checker-webpack-plugin&lt;/code&gt;&lt;/h4&gt; &lt;p&gt;There's more! You may like to use the &lt;code&gt;&lt;a href="https://github.com/Realytics/fork-ts-checker-webpack-plugin"&gt;fork-ts-checker-webpack-plugin&lt;/a&gt;&lt;/code&gt;,  (aka the ts-loader turbo-booster).  The webpack compatible version has been &lt;a href="https://github.com/Realytics/fork-ts-checker-webpack-plugin/releases/tag/v0.4.1"&gt;released to npm as 0.4.1&lt;/a&gt;:&lt;/p&gt; &lt;ul&gt;&lt;li&gt;When using &lt;code&gt;yarn&lt;/code&gt;: &lt;code&gt;yarn add fork-ts-checker-webpack-plugin@0.4.1 -D&lt;/code&gt;&lt;/li&gt;&lt;li&gt;When using &lt;code&gt;npm&lt;/code&gt;: &lt;code&gt;npm install fork-ts-checker-webpack-plugin@0.4.1 -D&lt;/code&gt;&lt;/li&gt;&lt;/ul&gt; &lt;p&gt;To see a working example take a look at &lt;a href="https://github.com/johnnyreilly/ts-loader/tree/master/examples/fork-ts-checker"&gt;the "fork-ts-checker" example&lt;/a&gt;.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7076776976362961257'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7076776976362961257'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2018/02/ts-loader-400-fork-ts-checker-webpack.html' title='ts-loader 4 / fork-ts-checker-webpack-plugin 0.4'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8745756597807702726</id><published>2018-01-29T13:56:00.002Z</published><updated>2021-03-14T05:34:02.289Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='webpack 4'/><title type='text'>Finding webpack 4 (use a Map)</title><content type='html'>&lt;h4&gt;Update: 03/02/2018&lt;/h4&gt; &lt;p&gt;Tobias Koppers has written a migration guide for plugins / loaders as well - take a read &lt;a href="https://medium.com/webpack/webpack-4-migration-guide-for-plugins-loaders-20a79b927202"&gt;here&lt;/a&gt;.  It's very useful.&lt;/p&gt; &lt;h4&gt;webpack 4&lt;/h4&gt; &lt;p&gt;webpack 4 is on the horizon.  &lt;a href="https://medium.com/webpack/webpack-4-beta-try-it-today-6b1d27d7d7e2"&gt;The beta dropped last Friday&lt;/a&gt;. So what do you, as a plugin / loader author need to do?  What needs to change to make your loader / plugin webpack 4 friendly?&lt;/p&gt; &lt;p&gt;This is a guide that should inform you about the changes you might need to make. It's based on my own experiences migrating &lt;a href="https://github.com/TypeStrong/ts-loader"&gt;&lt;code&gt;ts-loader&lt;/code&gt;&lt;/a&gt; and the &lt;a href="https://github.com/Realytics/fork-ts-checker-webpack-plugin"&gt;&lt;code&gt;fork-ts-checker-webpack-plugin&lt;/code&gt;&lt;/a&gt;. If you'd like to see this in action then take a look at the PRs related to these.  The ts-loader PR can be found &lt;a href="https://github.com/TypeStrong/ts-loader/pull/710"&gt;here&lt;/a&gt;.  The fork-ts-checker-webpack-plugin PR can be found &lt;a href="https://github.com/Realytics/fork-ts-checker-webpack-plugin/pull/93"&gt;here&lt;/a&gt;.&lt;/p&gt; &lt;h4&gt;Plugins&lt;/h4&gt; &lt;p&gt;One of the notable changes to webpack with v4 is the change to the plugin architecture. In terms of implications it's worth reading the comments made by &lt;a href="https://twitter.com/wsokra"&gt;Tobias Koppers&lt;/a&gt; &lt;a href="https://github.com/webpack/webpack/issues/6244#issuecomment-357502113"&gt;here&lt;/a&gt; and &lt;a href="https://github.com/webpack/webpack/issues/6064#issuecomment-349405474"&gt;here&lt;/a&gt;.&lt;/p&gt; &lt;p&gt;Previously, if your plugin was tapping into a compiler hook you'd write code that looked something like this:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;this.compiler.plugin('watch-close', () =&gt; {&lt;br /&gt;   // do your thing here&lt;br /&gt;});&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;With webpack 4 things done changed. You'd now write something like this:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;this.compiler.hooks.watchClose.tap('name-to-identify-your-plugin-goes-here', () =&gt; {&lt;br /&gt;   // do your thing here&lt;br /&gt;});&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Hopefully that's fairly clear; we're using the new &lt;code&gt;hooks&lt;/code&gt; property and tapping into our event of choice by &lt;code&gt;camelCasing&lt;/code&gt; what was previously &lt;code&gt;kebab-cased&lt;/code&gt;.  So in this case &lt;code&gt;plugin('watch-close' =&gt; hooks.watchClose.tap&lt;/code&gt;.&lt;/p&gt; &lt;p&gt;In the example above we were attaching to a sync hook.  Now let's look at an async hook:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;this.compiler.plugin('watch-run', (watching, callback) =&gt; {&lt;br /&gt;   // do your thing here&lt;br /&gt;   callback();&lt;br /&gt;});&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;This would change to be:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;this.compiler.hooks.watchRun.tapAsync('name-to-identify-your-plugin-goes-here', (compiler, callback) =&gt; {&lt;br /&gt;   // do your thing here&lt;br /&gt;   callback();&lt;br /&gt;});&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Note that rather than using &lt;code&gt;tap&lt;/code&gt; here, we're using &lt;code&gt;tapAsync&lt;/code&gt;. If you're more into promises there's a &lt;code&gt;tapPromise&lt;/code&gt; you could use instead.&lt;/p&gt; &lt;h4&gt;Custom Hooks&lt;/h4&gt; &lt;p&gt;Prior to webpack 4, you could use your own custom hooks within your plugin.  Usage was as simple as this:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;this.compiler.applyPluginsAsync('fork-ts-checker-service-before-start', () =&gt; {&lt;br /&gt;   // do your thing here&lt;br /&gt;});&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;You can still use custom hooks with webpack 4, but there's a little more ceremony involved.  Essentially, you need to tell webpack up front what you're planning. Not hard, I promise you.&lt;/p&gt; &lt;p&gt;First of all, you'll need to add the package &lt;a href="https://www.npmjs.com/package/tapable"&gt;&lt;code&gt;tapable&lt;/code&gt;&lt;/a&gt; as a dependency. Then, inside your plugin you'll need to import the type of hook that you want to use; in the case of the &lt;code&gt;fork-ts-checker-webpack-plugin&lt;/code&gt; we used both a sync and an async hook:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;const AsyncSeriesHook = require("tapable").AsyncSeriesHook;&lt;br /&gt;const SyncHook = require("tapable").SyncHook;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Then, inside your &lt;code&gt;apply&lt;/code&gt; method you need to register your hooks:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;    if (this.compiler.hooks.forkTsCheckerServiceBeforeStart&lt;br /&gt;      || this.compiler.hooks.forkTsCheckerCancel&lt;br /&gt;      // other hooks...&lt;br /&gt;      || this.compiler.hooks.forkTsCheckerEmit) {&lt;br /&gt;      throw new Error('fork-ts-checker-webpack-plugin hooks are already in use');&lt;br /&gt;    }&lt;br /&gt;    this.compiler.hooks.forkTsCheckerServiceBeforeStart = new AsyncSeriesHook([]);&lt;br /&gt;&lt;br /&gt;    this.compiler.hooks.forkTsCheckerCancel = new SyncHook([]);&lt;br /&gt;    // other sync hooks...&lt;br /&gt;    this.compiler.hooks.forkTsCheckerDone = new SyncHook([]);&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;If you're interested in backwards compatibility then you should use the &lt;code&gt;_pluginCompat&lt;/code&gt; to wire that in:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;    this.compiler._pluginCompat.tap('fork-ts-checker-webpack-plugin', options =&gt; {&lt;br /&gt;      switch (options.name) {&lt;br /&gt;        case 'fork-ts-checker-service-before-start':&lt;br /&gt;          options.async = true;&lt;br /&gt;          break;&lt;br /&gt;        case 'fork-ts-checker-cancel':&lt;br /&gt;        // other sync hooks...&lt;br /&gt;        case 'fork-ts-checker-done':&lt;br /&gt;          return true;&lt;br /&gt;      }&lt;br /&gt;      return undefined;&lt;br /&gt;    });&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;With your registration in place, you just need to replace your calls to &lt;code&gt;compiler.applyPlugins('sync-hook-name', &lt;/code&gt; and &lt;code&gt;compiler.applyPluginsAsync('async-hook-name', &lt;/code&gt; with calls to &lt;code&gt;compiler.hooks.syncHookName.call(&lt;/code&gt; and &lt;code&gt;compiler.hooks.asyncHookName.callAsync(&lt;/code&gt;. So to migrate our &lt;code&gt;fork-ts-checker-service-before-start&lt;/code&gt; hook we'd write:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;this.compiler.hooks.forkTsCheckerServiceBeforeStart.callAsync(() =&gt; {&lt;br /&gt;   // do your thing here&lt;br /&gt;});&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;h4&gt;Loaders&lt;/h4&gt; &lt;p&gt;Loaders are impacted by the changes to the plugin architecture.  Mostly this means applying the same plugin changes as discussed above.  &lt;code&gt;ts-loader&lt;/code&gt; hooks into 2 plugin events:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;    loader._compiler.plugin("after-compile", /* callback goes here */);&lt;br /&gt;    loader._compiler.plugin("watch-run", /* callback goes here */);&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;With webpack 4 these become:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;    loader._compiler.hooks.afterCompile.tapAsync("ts-loader", /* callback goes here */);&lt;br /&gt;    loader._compiler.hooks.watchRun.tapAsync("ts-loader", /* callback goes here */);&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Note again, we're using the string &lt;code&gt;"ts-loader"&lt;/code&gt; to identify our loader.&lt;/p&gt; &lt;h4&gt;I need a &lt;code&gt;Map&lt;/code&gt;&lt;/h4&gt; &lt;p&gt;When I initially ported to webpack 4, &lt;code&gt;ts-loader&lt;/code&gt; simply wasn't working.  In the end I tied this down to problems in our &lt;code&gt;watch-run&lt;/code&gt; callback.  There's 2 things of note here.&lt;/p&gt; &lt;p&gt;Firstly, as per &lt;a href="https://github.com/webpack/webpack/releases/tag/v4.0.0-beta.0"&gt;the changelog&lt;/a&gt;, the &lt;code&gt;watch-run&lt;/code&gt; hook now has the &lt;code&gt;Compiler&lt;/code&gt; as the first parameter.  Previously this was a subproperty on the supplied &lt;code&gt;watching&lt;/code&gt; parameter.  So swapping over to use the compiler directly was necessary.  Incidentally, &lt;code&gt;ts-loader&lt;/code&gt; previously made use of the &lt;code&gt;watching.startTime&lt;/code&gt; property that was supplied in webpack's 1, 2 and 3.  It seems to be coping without it; so hopefully that's fine.&lt;/p&gt; &lt;p&gt;Secondly, with webpack 4 it's "ES2015 all the things!"  That is to say, with webpack now requiring a minimum of node 6, the codebase is free to start using ES2015.  So if you're a consumer of &lt;code&gt;compiler.fileTimestamps&lt;/code&gt; (and &lt;code&gt;ts-loader&lt;/code&gt; is) then it's time to make a change to cater for the different API that a &lt;code&gt;Map&lt;/code&gt; offers instead of indexing into an object literal with a &lt;code&gt;string&lt;/code&gt; key.&lt;/p&gt; &lt;p&gt;What this means is, code that would once have looked like this:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;Object.keys(watching.compiler.fileTimestamps)&lt;br /&gt; .filter(filePath =&gt;&lt;br /&gt;  watching.compiler.fileTimestamps[filePath] &gt; lastTimes[filePath]&lt;br /&gt; )&lt;br /&gt; .forEach(filePath =&gt; {&lt;br /&gt;  lastTimes[filePath] = times[filePath];&lt;br /&gt;  // ...&lt;br /&gt; });&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Now looks more like this:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;for (const [filePath, date] of compiler.fileTimestamps) {&lt;br /&gt; if (date &gt; lastTimes.get(filePath)) {&lt;br /&gt;  continue;&lt;br /&gt; }&lt;br /&gt;&lt;br /&gt; lastTimes.set(filePath, date);&lt;br /&gt; // ...&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;h4&gt;Happy Porting!&lt;/h4&gt; &lt;p&gt;I hope your own port to webpack 4 goes well.  Do let me know if there's anything I've missed out / any inaccuracies etc and I'll update this guide.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8745756597807702726'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8745756597807702726'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2018/01/finding-webpack-4-use-map.html' title='Finding webpack 4 (use a Map)'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8344654196403542748</id><published>2018-01-28T14:45:00.000Z</published><updated>2018-02-04T09:54:54.004Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='fork-ts-checker-webpack-plugin'/><category scheme='http://www.blogger.com/atom/ns#' term='ts-loader'/><category scheme='http://www.blogger.com/atom/ns#' term='Webpack'/><title type='text'>webpack 4 - ts-loader / fork-ts-checker-webpack-plugin betas</title><content type='html'>&lt;p&gt;&lt;a href="https://medium.com/webpack/webpack-4-beta-try-it-today-6b1d27d7d7e2"&gt;The first webpack 4 beta dropped on Friday&lt;/a&gt;.  Very exciting!  Following hot on the heels of those announcements, I've some news to share too.  Can you guess what it is?&lt;/p&gt; &lt;h4&gt;&lt;code&gt;ts-loader&lt;/code&gt;&lt;/h4&gt; &lt;p&gt;Yes! The &lt;a href="https://github.com/TypeStrong/ts-loader"&gt;&lt;code&gt;ts-loader&lt;/code&gt;&lt;/a&gt; beta to work with webpack 4 is available.  To get hold of the beta:&lt;/p&gt; &lt;ul&gt;&lt;li&gt;When using &lt;code&gt;yarn&lt;/code&gt;: &lt;code&gt;yarn add ts-loader@4.0.0-beta.0 -D&lt;/code&gt;&lt;/li&gt;&lt;li&gt;When using &lt;code&gt;npm&lt;/code&gt;: &lt;code&gt;npm install ts-loader@4.0.0-beta.0 -D&lt;/code&gt;&lt;/li&gt;&lt;/ul&gt; &lt;p&gt;Remember to use this in concert with the webpack 4 beta.  To see a working example take a look at &lt;a href="https://github.com/johnnyreilly/ts-loader/tree/master/examples/vanilla"&gt;the "vanilla" example&lt;/a&gt;.&lt;/p&gt; &lt;h4&gt;&lt;code&gt;fork-ts-checker-webpack-plugin&lt;/code&gt;&lt;/h4&gt; &lt;p&gt;There's more! You may like to use the &lt;code&gt;&lt;a href="https://github.com/Realytics/fork-ts-checker-webpack-plugin"&gt;fork-ts-checker-webpack-plugin&lt;/a&gt;&lt;/code&gt;,  (which goes lovely with &lt;code&gt;ts-loader&lt;/code&gt; and a biscuit).  There is a beta available for that too:&lt;/p&gt; &lt;ul&gt;&lt;li&gt;When using &lt;code&gt;yarn&lt;/code&gt;: &lt;code&gt;yarn add johnnyreilly/fork-ts-checker-webpack-plugin#4.0.0-beta.1 -D&lt;/code&gt;&lt;/li&gt;&lt;li&gt;When using &lt;code&gt;npm&lt;/code&gt;: &lt;code&gt;npm install johnnyreilly/fork-ts-checker-webpack-plugin#4.0.0-beta.1 -D&lt;/code&gt;&lt;/li&gt;&lt;/ul&gt; &lt;p&gt;To see a working example take a look at &lt;a href="https://github.com/johnnyreilly/ts-loader/tree/master/examples/fork-ts-checker"&gt;the "fork-ts-checker" example&lt;/a&gt;.&lt;/p&gt; &lt;h4&gt;PRs&lt;/h4&gt; &lt;p&gt;If you would like to track the progress of these betas then I encourage you to take a look at the PRs they were built from.  The ts-loader PR can be found &lt;a href="https://github.com/TypeStrong/ts-loader/pull/710"&gt;here&lt;/a&gt;.  The fork-ts-checker-webpack-plugin PR can be found &lt;a href="https://github.com/Realytics/fork-ts-checker-webpack-plugin/pull/93"&gt;here&lt;/a&gt;.&lt;/p&gt; &lt;p&gt;These are betas so things may change further; though hopefully not significantly.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8344654196403542748'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8344654196403542748'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2018/01/webpack-4-ts-loader-fork-ts-checker.html' title='webpack 4 - ts-loader / fork-ts-checker-webpack-plugin betas'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2780527354553848941</id><published>2018-01-14T07:14:00.004Z</published><updated>2021-03-03T13:56:40.521Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='ASP.Net Core'/><category scheme='http://www.blogger.com/atom/ns#' term='Auth0'/><category scheme='http://www.blogger.com/atom/ns#' term='TypeScript'/><category scheme='http://www.blogger.com/atom/ns#' term='OAuth'/><category scheme='http://www.blogger.com/atom/ns#' term='React'/><title type='text'>Auth0, TypeScript and ASP.NET Core</title><content type='html'>&lt;p&gt;Most applications I write have some need for authentication and perhaps authorisation too. In fact, most apps most people write fall into that bracket. Here's the thing: Auth done well is a *big* chunk of work. And the minute you start thinking about that you almost invariably lose focus on the thing you actually want to build and ship.&lt;/p&gt; &lt;p&gt;So this Christmas I decided it was time to take a look into offloading that particular problem onto someone else. I knew there were third parties who provided Auth-As-A-Service - time to give them a whirl. On the recommendation of a friend, I made Auth0 my first port of call. Lest you be expecting a full breakdown of the various players in this space, let me stop you now; I liked Auth0 so much I strayed no further. Auth0 kicks AAAS. (I'm so sorry)&lt;/p&gt; &lt;h4&gt;What I wanted to build&lt;/h4&gt; &lt;p&gt;My criteria for "auth success" was this:&lt;/p&gt; &lt;ul&gt;&lt;li&gt;I want to build a SPA, specifically a React SPA. Ideally, I shouldn't need a back end of my own at all&lt;/li&gt;&lt;li&gt;I want to use TypeScript on my client.&lt;/li&gt;&lt;/ul&gt; &lt;p&gt;But, for when I do implement a back end:&lt;/p&gt; &lt;ul&gt;&lt;li&gt;I want that to be able to use the client side's Auth tokens to allow access to Auth routes on my server.&lt;/li&gt;&lt;li&gt;I want to able to identify the user, given the token, to provide targeted data&lt;/li&gt;&lt;li&gt;Oh, and I want to use .NET Core 2 for my server.&lt;/li&gt;&lt;/ul&gt; &lt;p&gt;And in achieving all of the I want to add minimal code to my app. Not War and Peace. My code should remain focused on doing what it does.&lt;/p&gt; &lt;h4&gt;Boil a Plate&lt;/h4&gt; &lt;p&gt;I ended up with unqualified ticks for all my criteria, but it took some work to find out. I will say that Auth0 do travel the extra mile in terms of getting you up and running. When you create a new Client in Auth0 you're given the option to download a quick start using the technology of your choice.&lt;/p&gt; &lt;p&gt;This was a massive plus for me. I took the quickstart provided and ran with it to get me to the point of meeting my own criteria. You can use this boilerplate for your own ends. Herewith, a walkthrough:&lt;/p&gt; &lt;h4&gt;The Walkthrough&lt;/h4&gt; &lt;p&gt;Fork and clone the repo at this location: &lt;a href="https://github.com/johnnyreilly/auth0-react-typescript-asp-net-core"&gt;https://github.com/johnnyreilly/auth0-react-typescript-asp-net-core&lt;/a&gt;.&lt;/p&gt; &lt;p&gt;What have we got? 2 folders, ClientApp contains the React app, Web contains the ASP.NET Core app.  Now we need to get setup with Auth0 and customise our config.&lt;/p&gt; &lt;h4&gt;Setup Auth0&lt;/h4&gt; &lt;p&gt;Here's how to get the app set up with Auth0; you're going to need to sign up for a (free) Auth0 account. Then login into Auth0 and go to the management portal.&lt;/p&gt; &lt;h5&gt;Client&lt;/h5&gt; &lt;ul&gt;&lt;li&gt;Create a Client with the name of your choice and use the Single Page Web Applications template.&lt;/li&gt;&lt;li&gt;From the new Client Settings page take the Domain and Client ID and update the similarly named properties in the &lt;code&gt;appsettings.Development.json&lt;/code&gt; and &lt;code&gt;appsettings.Production.json&lt;/code&gt; files with these settings.&lt;/li&gt;&lt;li&gt;To the Allowed Callback URLs setting add the URLs: &lt;code&gt;http://localhost:3000/callback,http://localhost:5000/callback&lt;/code&gt; - the first of these faciliates running in Debug mode, the second in Production mode. If you were to deploy this you'd need to add other callback URLs in here too.&lt;/li&gt;&lt;/ul&gt; &lt;h5&gt;API&lt;/h5&gt; &lt;ul&gt;&lt;li&gt;Create an API with the name of your choice (I recommend the same as the Client to avoid confusion), an identifier which can be anything you like; I like to use the URL of my app but it's your call.&lt;/li&gt;&lt;li&gt;From the new API Settings page take the Identifier and update the Audience property in the &lt;code&gt;appsettings.Development.json&lt;/code&gt; and &lt;code&gt;appsettings.Production.json&lt;/code&gt; files with that value.&lt;/li&gt;&lt;/ul&gt; &lt;h4&gt;Running the App&lt;/h4&gt; &lt;h5&gt;Production build&lt;/h5&gt; &lt;p&gt;Build the client app with &lt;code&gt;yarn build&lt;/code&gt; in the &lt;code&gt;ClientApp&lt;/code&gt; folder. (Don't forget to &lt;code&gt;yarn install&lt;/code&gt; first.) Then, in the &lt;code&gt;Web&lt;/code&gt; folder &lt;code&gt;dotnet restore&lt;/code&gt;, &lt;code&gt;dotnet run&lt;/code&gt; and open your browser to &lt;a href="http://localhost:5000"&gt;&lt;code&gt;http://localhost:5000&lt;/code&gt;&lt;/a&gt;&lt;/p&gt; &lt;h5&gt;Debugging&lt;/h5&gt; &lt;p&gt;Run the client app using webpack-dev-server using &lt;code&gt;yarn start&lt;/code&gt; in the &lt;code&gt;ClientApp&lt;/code&gt; folder. Fire up VS Code in the root of the repo and hit F5 to debug the server. Then open your browser to &lt;a href="http://localhost:3000"&gt;&lt;code&gt;http://localhost:3000&lt;/code&gt;&lt;/a&gt;&lt;/p&gt; &lt;h4&gt;The Tour&lt;/h4&gt; &lt;p&gt;When you fire up the app you're presented with "you are not logged in!" message and the option to login. Do it, it'll take you to the Auth0 "lock" screen where you can sign up / login.  Once you do that you'll be asked to confirm access:&lt;/p&gt; &lt;a href="https://2.bp.blogspot.com/-gNCT_tnatho/Wlr776dvpeI/AAAAAAAAIEo/Fb4c9ViaXwEHwGR95eXW9CzpjWsHiPuvgCLcBGAs/s1600/Screenshot%2B2018-01-13%2B18.40.21.png" imageanchor="1" &gt;&lt;img border="0" src="https://2.bp.blogspot.com/-gNCT_tnatho/Wlr776dvpeI/AAAAAAAAIEo/Fb4c9ViaXwEHwGR95eXW9CzpjWsHiPuvgCLcBGAs/s400/Screenshot%2B2018-01-13%2B18.40.21.png" width="395" height="400" data-original-width="1298" data-original-height="1313" /&gt;&lt;/a&gt; &lt;p&gt;All this is powered by Auth0's &lt;a href="https://www.npmjs.com/package/auth0-js"&gt;auth0-js&lt;/a&gt; npm package. (Excellent type definition files are available from Definitely Typed; I'm using the &lt;a href="https://www.npmjs.com/package/@types/auth0-js"&gt;@types/auth0-js&lt;/a&gt; package DT publishes.)  Usage of which is super simple; it exposes an &lt;code&gt;authorize&lt;/code&gt; method that when called triggers the Auth0 lock screen. Once you've "okayed" you'll be taken back to the app which will use the &lt;code&gt;parseHash&lt;/code&gt; method to extract the access token that Auth0 has provided.  Take a look at how our &lt;code&gt;authStore&lt;/code&gt; makes use of auth0-js: (don't be scared; it uses mobx - but you could use anything)&lt;/p&gt; &lt;h5&gt;authStore.ts&lt;/h5&gt; &lt;pre class="ts prettyprint"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;import { Auth0UserProfile, WebAuth } from 'auth0-js';&lt;br /&gt;import { action, computed, observable, runInAction } from 'mobx';&lt;br /&gt;import { IAuth0Config } from '../../config';&lt;br /&gt;import { StorageFacade } from '../storageFacade';&lt;br /&gt;&lt;br /&gt;interface IStorageToken {&lt;br /&gt;  accessToken: string;&lt;br /&gt;  idToken: string;&lt;br /&gt;  expiresAt: number;&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;const STORAGE_TOKEN = 'storage_token';&lt;br /&gt;&lt;br /&gt;export class AuthStore {&lt;br /&gt;  @observable.ref auth0: WebAuth;&lt;br /&gt;  @observable.ref userProfile: Auth0UserProfile;&lt;br /&gt;  @observable.ref token: IStorageToken;&lt;br /&gt;&lt;br /&gt;  constructor(config: IAuth0Config, private storage: StorageFacade) {&lt;br /&gt;    this.auth0 = new WebAuth({&lt;br /&gt;      domain: config.domain,&lt;br /&gt;      clientID: config.clientId,&lt;br /&gt;      redirectUri: config.redirectUri,&lt;br /&gt;      audience: config.audience,&lt;br /&gt;      responseType: 'token id_token',&lt;br /&gt;      scope: 'openid email profile do:admin:thing' // the do:admin:thing scope is custom and defined in the scopes section of our API in the Auth0 dashboard&lt;br /&gt;    });&lt;br /&gt;  }&lt;br /&gt;&lt;br /&gt;  initialise() {&lt;br /&gt;    const token = this.parseToken(this.storage.getItem(STORAGE_TOKEN));&lt;br /&gt;    if (token) {&lt;br /&gt;      this.setSession(token);&lt;br /&gt;    }&lt;br /&gt;    this.storage.addEventListener(this.onStorageChanged);&lt;br /&gt;  }&lt;br /&gt;&lt;br /&gt;  parseToken(tokenString: string) {&lt;br /&gt;    const token = JSON.parse(tokenString || '{}');&lt;br /&gt;    return token;&lt;br /&gt;  }&lt;br /&gt;&lt;br /&gt;  onStorageChanged = (event: StorageEvent) =&gt; {&lt;br /&gt;    if (event.key === STORAGE_TOKEN) {&lt;br /&gt;      this.setSession(this.parseToken(event.newValue));&lt;br /&gt;    }&lt;br /&gt;  }&lt;br /&gt;&lt;br /&gt;  @computed get isAuthenticated() {&lt;br /&gt;    // Check whether the current time is past the &lt;br /&gt;    // access token's expiry time&lt;br /&gt;    return this.token &amp;&amp; new Date().getTime() &lt; this.token.expiresAt;&lt;br /&gt;  }&lt;br /&gt;&lt;br /&gt;  login = () =&gt; {&lt;br /&gt;    this.auth0.authorize();&lt;br /&gt;  }&lt;br /&gt;&lt;br /&gt;  handleAuthentication = () =&gt; {&lt;br /&gt;    this.auth0.parseHash((err, authResult) =&gt; {&lt;br /&gt;      if (authResult &amp;&amp; authResult.accessToken &amp;&amp; authResult.idToken) {&lt;br /&gt;        const token = {&lt;br /&gt;          accessToken: authResult.accessToken,&lt;br /&gt;          idToken: authResult.idToken,&lt;br /&gt;          // Set the time that the access token will expire at&lt;br /&gt;          expiresAt: authResult.expiresIn * 1000 + new Date().getTime()&lt;br /&gt;        };&lt;br /&gt;&lt;br /&gt;        this.setSession(token);&lt;br /&gt;      } else if (err) {&lt;br /&gt;        // tslint:disable-next-line:no-console&lt;br /&gt;        console.log(err);&lt;br /&gt;        alert(`Error: ${err.error}. Check the console for further details.`);&lt;br /&gt;      }&lt;br /&gt;    });&lt;br /&gt;  }&lt;br /&gt;&lt;br /&gt;  @action&lt;br /&gt;  setSession(token: IStorageToken) {&lt;br /&gt;    this.token = token;&lt;br /&gt;    this.storage.setItem(STORAGE_TOKEN, JSON.stringify(token));&lt;br /&gt;  }&lt;br /&gt;&lt;br /&gt;  getAccessToken = () =&gt; {&lt;br /&gt;    const accessToken = this.token.accessToken;&lt;br /&gt;    if (!accessToken) {&lt;br /&gt;      throw new Error('No access token found');&lt;br /&gt;    }&lt;br /&gt;    return accessToken;&lt;br /&gt;  }&lt;br /&gt;&lt;br /&gt;  @action&lt;br /&gt;  loadProfile = async () =&gt; {&lt;br /&gt;    const accessToken = this.token.accessToken;&lt;br /&gt;    if (!accessToken) {&lt;br /&gt;      return;&lt;br /&gt;    }&lt;br /&gt;&lt;br /&gt;    this.auth0.client.userInfo(accessToken, (err, profile) =&gt; {&lt;br /&gt;      if (err) { throw err; }&lt;br /&gt;&lt;br /&gt;      if (profile) {&lt;br /&gt;        runInAction(() =&gt; this.userProfile = profile);&lt;br /&gt;        return profile;&lt;br /&gt;      }&lt;br /&gt;&lt;br /&gt;      return undefined;&lt;br /&gt;    });&lt;br /&gt;  }&lt;br /&gt;&lt;br /&gt;  @action&lt;br /&gt;  logout = () =&gt; {&lt;br /&gt;    // Clear access token and ID token from local storage&lt;br /&gt;    this.storage.removeItem(STORAGE_TOKEN);&lt;br /&gt;    &lt;br /&gt;    this.token = null;&lt;br /&gt;    this.userProfile = null;&lt;br /&gt;  }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Once you're logged in the app offers you more in the way of navigation options. A "Profile" screen shows you the details your React app has retrieved from Auth0 about you.  This is backed by the &lt;code&gt;client.userInfo&lt;/code&gt; method on &lt;code&gt;auth0-js&lt;/code&gt;. There's also a "Ping" screen which is where your React app talks to your ASP.NET Core server. The screenshot below illustrates the result of hitting the "Get Private Data" button:&lt;/p&gt; &lt;a href="https://3.bp.blogspot.com/-g42g4gnwNYw/Wlr8HRlfdfI/AAAAAAAAIEs/5nvEnHIbvXst4KhBc_2NKMiBBDyfMR1RACPcBGAYYCw/s1600/Screenshot%2B2018-01-13%2B18.47.49.png" imageanchor="1" &gt;&lt;img border="0" src="https://3.bp.blogspot.com/-g42g4gnwNYw/Wlr8HRlfdfI/AAAAAAAAIEs/5nvEnHIbvXst4KhBc_2NKMiBBDyfMR1RACPcBGAYYCw/s400/Screenshot%2B2018-01-13%2B18.47.49.png" width="400" height="340" data-original-width="1539" data-original-height="1310" /&gt;&lt;/a&gt; &lt;p&gt;The "Get Server to Retrieve Profile Data" button is interesting as it illustrates that the server can get access to your profile data as well. There's nothing insecure here; it gets the details using the access token retrieved from Auth0 by the ClientApp and passed to the server.  It's the API we set up in Auth0 that is in play here.  The app uses the Domain and the access token to talk to Auth0 like so:&lt;/p&gt; &lt;h5&gt;UserController.cs&lt;/h5&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;    // Retrieve the access_token claim which we saved in the OnTokenValidated event&lt;br /&gt;    var accessToken = User.Claims.FirstOrDefault(c =&gt; c.Type == "access_token").Value;&lt;br /&gt;            &lt;br /&gt;    // If we have an access_token, then retrieve the user's information&lt;br /&gt;    if (!string.IsNullOrEmpty(accessToken))&lt;br /&gt;    {&lt;br /&gt;        var domain = _config["Auth0:Domain"];&lt;br /&gt;        var apiClient = new AuthenticationApiClient(domain);&lt;br /&gt;        var userInfo = await apiClient.GetUserInfoAsync(accessToken);&lt;br /&gt;&lt;br /&gt;        return Ok(userInfo);&lt;br /&gt;    }&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;We can also access the &lt;code&gt;sub&lt;/code&gt; claim, which uniquely identifies the user:&lt;/p&gt; &lt;h5&gt;UserController.cs&lt;/h5&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;    // We're not doing anything with this, but hey! It's useful to know where the user id lives&lt;br /&gt;    var userId = User.Claims.FirstOrDefault(c =&gt; c.Type == System.Security.Claims.ClaimTypes.NameIdentifier).Value; // our userId is the sub value&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;The reason our ASP.NET Core app works with Auth0 and that we have access to the access token here in the first place is because of our startup code:&lt;/p&gt; &lt;h5&gt;Startup.cs&lt;/h5&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;    public void ConfigureServices(IServiceCollection services)&lt;br /&gt;    {&lt;br /&gt;        var domain = $"https://{Configuration["Auth0:Domain"]}/";&lt;br /&gt;        services.AddAuthentication(options =&gt;&lt;br /&gt;        {&lt;br /&gt;            options.DefaultAuthenticateScheme = JwtBearerDefaults.AuthenticationScheme;&lt;br /&gt;            options.DefaultChallengeScheme = JwtBearerDefaults.AuthenticationScheme;&lt;br /&gt;        }).AddJwtBearer(options =&gt;&lt;br /&gt;        {&lt;br /&gt;            options.Authority = domain;&lt;br /&gt;            options.Audience = Configuration["Auth0:Audience"];&lt;br /&gt;            options.Events = new JwtBearerEvents&lt;br /&gt;            {&lt;br /&gt;                OnTokenValidated = context =&gt;&lt;br /&gt;                {&lt;br /&gt;                    if (context.SecurityToken is JwtSecurityToken token)&lt;br /&gt;                    {&lt;br /&gt;                        if (context.Principal.Identity is ClaimsIdentity identity)&lt;br /&gt;                        {&lt;br /&gt;                            identity.AddClaim(new Claim("access_token", token.RawData));&lt;br /&gt;                        }&lt;br /&gt;                    }&lt;br /&gt;&lt;br /&gt;                    return Task.FromResult(0);&lt;br /&gt;                }&lt;br /&gt;            };&lt;br /&gt;        });&lt;br /&gt;&lt;br /&gt;        // ....&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;h4&gt;Authorization&lt;/h4&gt; &lt;p&gt;We're pretty much done now; just one magic button to investigate: "Get Admin Data".  If you presently try and access the admin data you'll get a &lt;code&gt;403 Forbidden&lt;/code&gt;.  It's forbidden because that endpoint relies on the &lt;code&gt;"do:admin:thing"&lt;/code&gt; scope in our claims:&lt;/p&gt; &lt;h5&gt;UserController.cs&lt;/h5&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;    [Authorize(Scopes.DoAdminThing)]&lt;br /&gt;    [HttpGet("api/userDoAdminThing")]&lt;br /&gt;    public IActionResult GetUserDoAdminThing()&lt;br /&gt;    {&lt;br /&gt;        return Ok("Admin endpoint");&lt;br /&gt;    }&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;h5&gt;Scopes.cs&lt;/h5&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;    public static class Scopes&lt;br /&gt;    {&lt;br /&gt;         // the do:admin:thing scope is custom and defined in the scopes section of our API in the Auth0 dashboard&lt;br /&gt;        public const string DoAdminThing = "do:admin:thing";&lt;br /&gt;    }&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;This wired up in our ASP.NET Core app like so:&lt;/p&gt; &lt;h5&gt;Startup.cs&lt;/h5&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;    services.AddAuthorization(options =&gt;&lt;br /&gt;    {&lt;br /&gt;        options.AddPolicy(Scopes.DoAdminThing, policy =&gt; policy.Requirements.Add(new HasScopeRequirement(Scopes.DoAdminThing, domain)));&lt;br /&gt;    });&lt;br /&gt;&lt;br /&gt;    // register the scope authorization handler&lt;br /&gt;    services.AddSingleton&lt;IAuthorizationHandler, HasScopeHandler&gt;();&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;h5&gt;HasScopeHandler.cs&lt;/h5&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;    public class HasScopeHandler : AuthorizationHandler&lt;HasScopeRequirement&gt;&lt;br /&gt;    {&lt;br /&gt;        protected override Task HandleRequirementAsync(AuthorizationHandlerContext context, HasScopeRequirement requirement)&lt;br /&gt;        {&lt;br /&gt;            // If user does not have the scope claim, get out of here&lt;br /&gt;            if (!context.User.HasClaim(c =&gt; c.Type == "scope" &amp;&amp; c.Issuer == requirement.Issuer))&lt;br /&gt;                return Task.CompletedTask;&lt;br /&gt;&lt;br /&gt;            // Split the scopes string into an array&lt;br /&gt;            var scopes = context.User.FindFirst(c =&gt; c.Type == "scope" &amp;&amp; c.Issuer == requirement.Issuer).Value.Split(' ');&lt;br /&gt;&lt;br /&gt;            // Succeed if the scope array contains the required scope&lt;br /&gt;            if (scopes.Any(s =&gt; s == requirement.Scope))&lt;br /&gt;                context.Succeed(requirement);&lt;br /&gt;&lt;br /&gt;            return Task.CompletedTask;&lt;br /&gt;        }&lt;br /&gt;    }&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;The reason we're 403ing at present is because when our &lt;code&gt;HasScopeHandler&lt;/code&gt; executes, &lt;code&gt;requirement.Scope&lt;/code&gt; has the value of &lt;code&gt;"do:admin:thing"&lt;/code&gt; and our &lt;code&gt;scopes&lt;/code&gt; do not contain that value.  To add it, go to your API in the Auth0 management console and add it:&lt;p&gt; &lt;a href="https://1.bp.blogspot.com/-XWDZYx9Y9yU/WlsUqI_Tk0I/AAAAAAAAIE8/r2ksEOsqG8cf2mvza-1TuFFWXFaZusykACLcBGAs/s1600/Screenshot%2B2018-01-14%2B08.26.54.png" imageanchor="1" &gt;&lt;img border="0" src="https://1.bp.blogspot.com/-XWDZYx9Y9yU/WlsUqI_Tk0I/AAAAAAAAIE8/r2ksEOsqG8cf2mvza-1TuFFWXFaZusykACLcBGAs/s400/Screenshot%2B2018-01-14%2B08.26.54.png" width="400" height="261" data-original-width="1600" data-original-height="1042" /&gt;&lt;/a&gt; &lt;p&gt;Note that you can control how this scope is acquired using "Rules" in the Auth0 management portal.&lt;/p&gt; &lt;p&gt;You won't be able to access the admin endpoint yet because you're still rocking with the old access token; pre-newly-added scope. But when you next login to Auth0 you'll see a prompt like this:&lt;/p&gt; &lt;a href="https://3.bp.blogspot.com/-Bqom1m6bb9o/WlsV-lSG5QI/AAAAAAAAIFI/L4cCLbxjmmktBVAfXxsNsF-LXtaqNC5XACLcBGAs/s1600/Screenshot%2B2018-01-14%2B08.32.59.png" imageanchor="1" &gt;&lt;img border="0" src="https://3.bp.blogspot.com/-Bqom1m6bb9o/WlsV-lSG5QI/AAAAAAAAIFI/L4cCLbxjmmktBVAfXxsNsF-LXtaqNC5XACLcBGAs/s400/Screenshot%2B2018-01-14%2B08.32.59.png" width="327" height="400" data-original-width="1209" data-original-height="1481" /&gt;&lt;/a&gt; &lt;p&gt;Which demonstrates that you're being granted an extra scope. With your new shiny access token you can now access the oh-so-secret Admin endpoint.&lt;/p&gt; &lt;p&gt;I had some more questions about Auth0 as I'm still new to it myself.  To see my question (and the very helpful answer!) go here:&lt;br /&gt;&lt;a href="https://community.auth0.com/questions/13786/get-user-data-server-side-what-is-a-good-approach"&gt;https://community.auth0.com/questions/13786/get-user-data-server-side-what-is-a-good-approach&lt;/a&gt;&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2780527354553848941'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2780527354553848941'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2018/01/auth0-typescript-and-aspnet-core.html' title='Auth0, TypeScript and ASP.NET Core'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='https://2.bp.blogspot.com/-gNCT_tnatho/Wlr776dvpeI/AAAAAAAAIEo/Fb4c9ViaXwEHwGR95eXW9CzpjWsHiPuvgCLcBGAs/s72-c/Screenshot%2B2018-01-13%2B18.40.21.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3587032842032686238</id><published>2017-12-24T20:29:00.002Z</published><updated>2021-03-04T05:47:57.593Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Die Hard'/><category scheme='http://www.blogger.com/atom/ns#' term='TypeScript'/><category scheme='http://www.blogger.com/atom/ns#' term='ts-loader'/><category scheme='http://www.blogger.com/atom/ns#' term='Webpack'/><title type='text'>ts-loader 2017 retrospective</title><content type='html'>&lt;p&gt;2017 is drawing to a close, and it's been a big, big year in webpack-land. It's been a big year for &lt;code&gt;ts-loader&lt;/code&gt; too. At the start of the year v1.3.3 was the latest version available, officially supporting webpack 1. (Old school!)  We end the year with &lt;code&gt;ts-loader&lt;/code&gt; sitting pretty at v3.2.0 and supporting webpack 2 and 3.&lt;/p&gt; &lt;p&gt;Many releases were shipped and that was down to a whole bunch of folk. People helped out with bug fixes, features, advice and docs improvements. &lt;strong&gt;All of these help.&lt;/strong&gt; &lt;code&gt;ts-loader&lt;/code&gt; wouldn't be where it is without you so thanks to everyone that helped out - you rock!&lt;/p&gt; &lt;p&gt;&lt;a href="https://github.com/christiantinauer"&gt;&lt;img src="https://avatars.githubusercontent.com/christiantinauer" class="github-profile" title="@christiantinauer" /&gt;&lt;/a&gt;&lt;a href="https://github.com/Pajn"&gt;&lt;img src="https://avatars.githubusercontent.com/Pajn" class="github-profile" title="@Pajn" /&gt;&lt;/a&gt;&lt;a href="https://github.com/maier49"&gt;&lt;img src="https://avatars.githubusercontent.com/maier49" class="github-profile" title="@maier49" /&gt;&lt;/a&gt;&lt;a href="https://github.com/false"&gt;&lt;img src="https://avatars.githubusercontent.com/false" class="github-profile" title="@false" /&gt;&lt;/a&gt;&lt;a href="https://github.com/roddypratt"&gt;&lt;img src="https://avatars.githubusercontent.com/roddypratt" class="github-profile" title="@roddypratt" /&gt;&lt;/a&gt;&lt;a href="https://github.com/ldrick"&gt;&lt;img src="https://avatars.githubusercontent.com/ldrick" class="github-profile" title="@ldrick" /&gt;&lt;/a&gt;&lt;a href="https://github.com/mattlewis92"&gt;&lt;img src="https://avatars.githubusercontent.com/mattlewis92" class="github-profile" title="@mattlewis92" /&gt;&lt;/a&gt;&lt;a href="https://github.com/Venryx"&gt;&lt;img src="https://avatars.githubusercontent.com/Venryx" class="github-profile" title="@Venryx" /&gt;&lt;/a&gt;&lt;a href="https://github.com/WillMartin"&gt;&lt;img src="https://avatars.githubusercontent.com/WillMartin" class="github-profile" title="@WillMartin" /&gt;&lt;/a&gt;&lt;a href="https://github.com/Loilo"&gt;&lt;img src="https://avatars.githubusercontent.com/Loilo" class="github-profile" title="@Loilo" /&gt;&lt;/a&gt;&lt;a href="https://github.com/Brooooooklyn"&gt;&lt;img src="https://avatars.githubusercontent.com/Brooooooklyn" class="github-profile" title="@Brooooooklyn" /&gt;&lt;/a&gt;&lt;a href="https://github.com/mengxy"&gt;&lt;img src="https://avatars.githubusercontent.com/mengxy" class="github-profile" title="@mengxy" /&gt;&lt;/a&gt;&lt;a href="https://github.com/bsouthga"&gt;&lt;img src="https://avatars.githubusercontent.com/bsouthga" class="github-profile" title="@bsouthga" /&gt;&lt;/a&gt;&lt;a href="https://github.com/zinserjan"&gt;&lt;img src="https://avatars.githubusercontent.com/zinserjan" class="github-profile" title="@zinserjan" /&gt;&lt;/a&gt;&lt;a href="https://github.com/sokra"&gt;&lt;img src="https://avatars.githubusercontent.com/sokra" class="github-profile" title="@sokra" /&gt;&lt;/a&gt;&lt;a href="https://github.com/vhqtvn"&gt;&lt;img src="https://avatars.githubusercontent.com/vhqtvn" class="github-profile" title="@vhqtvn" /&gt;&lt;/a&gt;&lt;a href="https://github.com/HerringtonDarkholme"&gt;&lt;img src="https://avatars.githubusercontent.com/HerringtonDarkholme" class="github-profile" title="@HerringtonDarkholme" /&gt;&lt;/a&gt;&lt;a href="https://github.com/johnnyreilly"&gt;&lt;img src="https://avatars.githubusercontent.com/johnnyreilly" class="github-profile" title="@johnnyreilly" /&gt;&lt;/a&gt;&lt;a href="https://github.com/jbrantly"&gt;&lt;img src="https://avatars.githubusercontent.com/jbrantly" class="github-profile" title="@jbrantly" /&gt;&lt;/a&gt;&lt;a href="https://github.com/octref"&gt;&lt;img src="https://avatars.githubusercontent.com/octref" class="github-profile" title="@octref" /&gt;&lt;/a&gt;&lt;a href="https://github.com/rhyek"&gt;&lt;img src="https://avatars.githubusercontent.com/rhyek" class="github-profile" title="@rhyek" /&gt;&lt;/a&gt;&lt;a href="https://github.com/develar"&gt;&lt;img src="https://avatars.githubusercontent.com/develar" class="github-profile" title="@develar" /&gt;&lt;/a&gt;&lt;a href="https://github.com/donaldpipowitch"&gt;&lt;img src="https://avatars.githubusercontent.com/donaldpipowitch" class="github-profile" title="@donaldpipowitch" /&gt;&lt;/a&gt;&lt;a href="https://github.com/schmuli"&gt;&lt;img src="https://avatars.githubusercontent.com/schmuli" class="github-profile" title="@schmuli" /&gt;&lt;/a&gt;&lt;a href="https://github.com/longlho"&gt;&lt;img src="https://avatars.githubusercontent.com/longlho" class="github-profile" title="@longlho" /&gt;&lt;/a&gt;&lt;a href="https://github.com/Igorbek"&gt;&lt;img src="https://avatars.githubusercontent.com/Igorbek" class="github-profile" title="@Igorbek" /&gt;&lt;/a&gt;&lt;a href="https://github.com/aindlq"&gt;&lt;img src="https://avatars.githubusercontent.com/aindlq" class="github-profile" title="@aindlq" /&gt;&lt;/a&gt;&lt;a href="https://github.com/wearymonkey"&gt;&lt;img src="https://avatars.githubusercontent.com/wearymonkey" class="github-profile" title="@wearymonkey" /&gt;&lt;/a&gt;&lt;a href="https://github.com/bancek"&gt;&lt;img src="https://avatars.githubusercontent.com/bancek" class="github-profile" title="@bancek" /&gt;&lt;/a&gt;&lt;a href="https://github.com/mredbishop"&gt;&lt;img src="https://avatars.githubusercontent.com/mredbishop" class="github-profile" title="@mredbishop" /&gt;&lt;/a&gt;&lt;/p&gt; &lt;p&gt;I'm really grateful to all of you.  Thanks so much! (Apologies for those I've missed anyone out - I know there's more still.)&lt;/p&gt; &lt;h4&gt;&lt;code&gt;fork-ts-checker-webpack-plugin&lt;/code&gt; build speed improvements&lt;/h4&gt; &lt;p&gt;Alongside other's direct contributions to &lt;code&gt;ts-loader&lt;/code&gt;, other projects improved the experience of using &lt;code&gt;ts-loader&lt;/code&gt;. &lt;a href="https://github.com/piotr-oles"&gt;Piotr Ole&lt;/a&gt; dropped his &lt;code&gt;&lt;a href="https://github.com/Realytics/fork-ts-checker-webpack-plugin"&gt;fork-ts-checker-webpack-plugin&lt;/a&gt;&lt;/code&gt; this year which nicely increased build speed when used with &lt;code&gt;ts-loader&lt;/code&gt;.&lt;/p&gt;&lt;/p&gt; &lt;p&gt;That opened up the possibility of adding &lt;a href="https://github.com/amireh/happypack"&gt;HappyPack&lt;/a&gt; support. I had the good fortune to work with webpack's &lt;a href="https://github.com/sokra"&gt;Tobias Koppers&lt;/a&gt; and ExtraHop's &lt;a href="https://github.com/abirmingham"&gt;Alex Birmingham&lt;/a&gt; on &lt;a href="https://www.extrahop.com/company/blog/2017/extrahop-webpack-accelerating-build-times/"&gt;improving TypeScript build speed further&lt;/a&gt;.&lt;/p&gt; &lt;p&gt;So what does the future hold?&lt;/p&gt; &lt;h4&gt;ts-loader 4.0 (Live webpack or Die Hard)&lt;/h4&gt; &lt;p&gt;The web marches on and webpack gallops alongside. Here's what's in the pipeline for ts-loader in 2018:&lt;/p&gt; &lt;h5&gt;Start using the new watch API&lt;/h5&gt; &lt;p&gt;&lt;a href="https://github.com/Microsoft/TypeScript/pull/20234"&gt;A new watch API is being made available in the TypeScript API&lt;/a&gt;. We have &lt;a href="https://github.com/TypeStrong/ts-loader/pull/685"&gt;a PR&lt;/a&gt; from the amazing &lt;a href="https://github.com/sheetalkamat"&gt;Sheetal Nandi&lt;/a&gt; which adds support to ts-loader. Given that's quite a big PR we want to merge that before anything else lands. The watch API is still being finalised but once it lands in TypeScript we'll look to merge the PR and ship a new version of &lt;code&gt;ts-loader&lt;/code&gt;.&lt;/p&gt; &lt;h5&gt;Drop custom module resolution&lt;/h5&gt; &lt;p&gt;Historically &lt;code&gt;ts-loader&lt;/code&gt; has had it's own module resolution mechanism in place. We're going to look to move to use the TypeScript mechanism instead.  The old module resolution be deprecated but will remain available behind a flag for a time. In future we'll look to drop the old mechanism entirely.&lt;/p&gt; &lt;h5&gt;Drop support for TypeScript 2.3 and below&lt;/h5&gt; &lt;p&gt;The codebase can be made simpler if we drop support for older versions of TypeScript so that's what we plan to do with our next breaking changes release.&lt;/p&gt; &lt;h5&gt;webpack v4 is in alpha now&lt;/h5&gt; &lt;p&gt;If any changes need to happen to ts-loader to support webpack 4 then they will be. Personally I'm planning to help out with &lt;code&gt;&lt;a href="https://github.com/Realytics/fork-ts-checker-webpack-plugin"&gt;fork-ts-checker-webpack-plugin&lt;/a&gt;&lt;/code&gt; as there will likely be some changes required there.&lt;/p&gt; &lt;h5&gt;&lt;code&gt;contextAsConfigBasePath&lt;/code&gt; will be replaced with a &lt;code&gt;context&lt;/code&gt;&lt;/h5&gt; &lt;p&gt;The option that landed in the last month doesn't quite achieve the aims of the original PR's author &lt;a href="https://github.com/christiantinauer"&gt;Christian Tinauer&lt;/a&gt;. Consequently it's going to be replaced with a new option. This is queued up and ready to go &lt;a href="https://github.com/TypeStrong/ts-loader/pull/688"&gt;here&lt;/a&gt;.&lt;/p&gt; &lt;h5&gt;&lt;code&gt;reportFiles&lt;/code&gt; option to be added&lt;/h5&gt; &lt;p&gt;&lt;a href="https://github.com/freeman"&gt;Michel Rasschaert&lt;/a&gt; is presently working on adding a &lt;code&gt;reportFiles&lt;/code&gt; option to &lt;code&gt;ts-loader&lt;/code&gt;. You can see the PR in progress &lt;a href="https://github.com/TypeStrong/ts-loader/pull/701"&gt;here&lt;/a&gt;.&lt;/p&gt; &lt;h4&gt;Merry Christmas!&lt;/h4&gt; &lt;p&gt;You can expect to see the first releases of ts-loader 4.0 in 2018. In the meantime, I'd like to wish you Merry Christmas and a Happy New Year! And once more, thanks and thanks again to all you generous people who help build &lt;code&gt;ts-loader&lt;/code&gt;.  You're wonderful and so I'm glad you do what you do... joyeux Noel!&lt;/p&gt; </content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3587032842032686238'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3587032842032686238'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2017/12/ts-loader-2017-retrospective.html' title='ts-loader 2017 retrospective'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-565716004152848709</id><published>2017-11-19T22:09:00.001Z</published><updated>2021-03-04T05:49:57.373Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='workbox'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='TypeScript'/><category scheme='http://www.blogger.com/atom/ns#' term='PWA'/><category scheme='http://www.blogger.com/atom/ns#' term='Service Worker'/><category scheme='http://www.blogger.com/atom/ns#' term='Webpack'/><title type='text'>The TypeScript webpack PWA</title><content type='html'>&lt;p&gt;So, there you sit, conflicted. You've got a lovely build setup; it's a thing of beauty.  Precious, polished like a diamond, sharpened like a circular saw.  There at the core of your carefully crafted setup sits webpack.  Heaving, mysterious... powerful.&lt;/p&gt; &lt;p&gt;There's more.  Not only are you sold on webpack, you're all in TypeScript too.  But now you've heard tell of "Progressive Web Applications" and "Service Workers".... And you want to be dealt in.  You want to build web apps that work offline.  It can't work can it?  Your build setup's going to be like the creature in the episode where they've taken one too many jumps and it's gone into the foetal position.&lt;/p&gt; &lt;p&gt;So this is the plan kids.  Let's take a simple TypeScript, webpack setup and make it a PWA. Like Victoria Wood said...&lt;/p&gt; &lt;h4&gt;&lt;a href="https://youtu.be/lNU5KVa_Tu8"&gt;Let's Do It Tonight&lt;/a&gt;&lt;/h4&gt; &lt;p&gt;How to begin? Well first comes the plagiarism; &lt;a href="https://github.com/TypeStrong/ts-loader/tree/master/examples/core-js"&gt;here's a simple TypeScript webpack setup&lt;/a&gt;.  Rob it.  Stick a gun to its head and order it onto your hard drive. &lt;code&gt;yarn install&lt;/code&gt; to pick up your dependencies and then &lt;code&gt;yarn start&lt;/code&gt; to see what you've got. Something like this:&lt;/p&gt; &lt;a href="https://2.bp.blogspot.com/-Myu9uP3Vy3M/WhHN8AoAKLI/AAAAAAAAHOo/VtxOTu4S3bEhVIzkPvzt-BfV5c6anSidgCPcBGAYYCw/s1600/Screenshot%2B2017-11-19%2B18.29.15.png" imageanchor="1" &gt;&lt;img border="0" src="https://2.bp.blogspot.com/-Myu9uP3Vy3M/WhHN8AoAKLI/AAAAAAAAHOo/VtxOTu4S3bEhVIzkPvzt-BfV5c6anSidgCPcBGAYYCw/s320/Screenshot%2B2017-11-19%2B18.29.15.png" width="320" height="138" data-original-width="706" data-original-height="305" /&gt;&lt;/a&gt; &lt;p&gt;Beautiful right? And if we &lt;code&gt;yarn build&lt;/code&gt; we end up with a simple output:&lt;/p&gt; &lt;a href="https://4.bp.blogspot.com/-EVLkO9g-zSE/WhHPJYhCXJI/AAAAAAAAHO0/rBnRHqsjCE8cHvEPtuPyQqd5DtZDUCgdgCPcBGAYYCw/s1600/Screenshot%2B2017-11-19%2B18.34.12.png" imageanchor="1" &gt;&lt;img border="0" src="https://4.bp.blogspot.com/-EVLkO9g-zSE/WhHPJYhCXJI/AAAAAAAAHO0/rBnRHqsjCE8cHvEPtuPyQqd5DtZDUCgdgCPcBGAYYCw/s320/Screenshot%2B2017-11-19%2B18.34.12.png" width="320" height="119" data-original-width="1453" data-original-height="539" /&gt;&lt;/a&gt; &lt;p&gt;To test what we've built out we want to use a simple web server to serve up the &lt;code&gt;dist&lt;/code&gt; folder. I've got the npm package &lt;a href="https://www.npmjs.com/package/http-server"&gt;http-server&lt;/a&gt; installed globally for just such an eventuality. So let's &lt;code&gt;http-server ./dist&lt;/code&gt; and I'm once again looking at our simple app; it looks exactly the same as when I &lt;code&gt;yarn start&lt;/code&gt;. Smashing. What would we see if we were offline?  Well thanks to the magic of Chrome DevTools we can find out. Offline and refresh our browser...&lt;/p&gt; &lt;a href="https://2.bp.blogspot.com/-6AXev3DTAr8/WhHkJjtRHqI/AAAAAAAAHPI/aTaWZXWQPmIdXSIjoYjBXysWkSJ3wDUJACLcBGAs/s1600/Screenshot%2B2017-11-19%2B20.05.19.png" imageanchor="1" &gt;&lt;img border="0" src="https://2.bp.blogspot.com/-6AXev3DTAr8/WhHkJjtRHqI/AAAAAAAAHPI/aTaWZXWQPmIdXSIjoYjBXysWkSJ3wDUJACLcBGAs/s320/Screenshot%2B2017-11-19%2B20.05.19.png" width="230" height="320" data-original-width="765" data-original-height="1063" /&gt;&lt;/a&gt; &lt;p&gt;Not very user friendly.  Once we're done, we should be able to refresh and still see our app.&lt;/p&gt; &lt;h4&gt;&lt;a href="https://youtu.be/UODX_pYpVxk"&gt;Work(box) It&lt;/a&gt;&lt;/h4&gt; &lt;p&gt;&lt;a href="https://developers.google.com/web/tools/workbox/"&gt;Workbox&lt;/a&gt; is a project that makes the setting up of Service Workers (aka the magic that powers PWAs) easier. It supports webpack use cases through the &lt;a href="https://www.npmjs.com/package/workbox-webpack-plugin"&gt;workbox-webpack-plugin&lt;/a&gt;; so let's give it a whirl.  Incidentally, there's a &lt;a href="https://developers.google.com/web/tools/workbox/get-started/webpack"&gt;cracking example&lt;/a&gt; on the Workbox site.&lt;/p&gt; &lt;p&gt;&lt;code&gt;yarn add workbox-webpack-plugin --dev&lt;/code&gt; adds the plugin to our project. To make use of it, punt your way over to the &lt;code&gt;webpack.production.config.js&lt;/code&gt; and add an entry for the plugin.  We also need to set the &lt;code&gt;hash&lt;/code&gt; parameter of the html-webpack-plugin to be false; if it's true it'll cause problems for the ServiceWorker.&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;const WorkboxPlugin = require('workbox-webpack-plugin');&lt;br /&gt;&lt;br /&gt;//...&lt;br /&gt;&lt;br /&gt;module.exports = {&lt;br /&gt;&lt;br /&gt;    //...&lt;br /&gt;&lt;br /&gt;    plugins: [&lt;br /&gt;&lt;br /&gt;        //...&lt;br /&gt;&lt;br /&gt;        new HtmlWebpackPlugin({&lt;br /&gt;            hash: false,&lt;br /&gt;            inject: true,&lt;br /&gt;            template: 'src/index.html',&lt;br /&gt;            minify: {&lt;br /&gt;                removeComments: true,&lt;br /&gt;                collapseWhitespace: true,&lt;br /&gt;                removeRedundantAttributes: true,&lt;br /&gt;                useShortDoctype: true,&lt;br /&gt;                removeEmptyAttributes: true,&lt;br /&gt;                removeStyleLinkTypeAttributes: true,&lt;br /&gt;                keepClosingSlash: true,&lt;br /&gt;                minifyJS: true,&lt;br /&gt;                minifyCSS: true,&lt;br /&gt;                minifyURLs: true,&lt;br /&gt;            },&lt;br /&gt;        }),&lt;br /&gt;&lt;br /&gt;        new WorkboxPlugin({&lt;br /&gt;            // we want our service worker to cache the dist directory&lt;br /&gt;            globDirectory: 'dist',&lt;br /&gt;            // these are the sorts of files we want to cache&lt;br /&gt;            globPatterns: ['**/*.{html,js,css,png,svg,jpg,gif,json}'],&lt;br /&gt;            // this is where we want our ServiceWorker to be created&lt;br /&gt;            swDest: path.resolve('dist', 'sw.js'),&lt;br /&gt;            // these options encourage the ServiceWorkers to get in there fast &lt;br /&gt;            // and not allow any straggling "old" SWs to hang around&lt;br /&gt;            clientsClaim: true,&lt;br /&gt;            skipWaiting: true,&lt;br /&gt;        }),&lt;br /&gt;    ]&lt;br /&gt;&lt;br /&gt;    //...&lt;br /&gt;};&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;With this in place, &lt;code&gt;yarn build&lt;/code&gt; will generate a ServiceWorker. Now to alter our code to register it.  Open up &lt;code&gt;index.tsx&lt;/code&gt; and add this to the end of the file:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;if ('serviceWorker' in navigator) {&lt;br /&gt;  window.addEventListener('load', () =&gt; {&lt;br /&gt;    navigator.serviceWorker.register('/sw.js').then(registration =&gt; {&lt;br /&gt;      // tslint:disable:no-console&lt;br /&gt;      console.log('SW registered: ', registration);&lt;br /&gt;    }).catch(registrationError =&gt; {&lt;br /&gt;      console.log('SW registration failed: ', registrationError);&lt;br /&gt;    });&lt;br /&gt;  });&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Put it together and...  &lt;h4&gt;What Have We Got?&lt;/h4&gt; &lt;p&gt;Let's &lt;code&gt;yarn build&lt;/code&gt; again.&lt;/p&gt; &lt;a href="https://3.bp.blogspot.com/-qnRIwI47480/WhH97gl3IcI/AAAAAAAAHQE/cGiYHu46Fy4TpKkoy-DBzRnqIJuocFUdQCLcBGAs/s1600/Screenshot%2B2017-11-19%2B21.55.18.png" imageanchor="1" &gt;&lt;img border="0" src="https://3.bp.blogspot.com/-qnRIwI47480/WhH97gl3IcI/AAAAAAAAHQE/cGiYHu46Fy4TpKkoy-DBzRnqIJuocFUdQCLcBGAs/s640/Screenshot%2B2017-11-19%2B21.55.18.png" width="640" height="347" data-original-width="1600" data-original-height="867" /&gt;&lt;/a&gt;&lt;p&gt;Oooohh look! A service worker is with us. Does it work?  Let's find out... &lt;code&gt;http-server ./dist&lt;/code&gt; Browse to &lt;a href="http://localhost:8080"&gt;http://localhost:8080&lt;/a&gt; and let's have a look at the console.&lt;/p&gt; &lt;a href="https://2.bp.blogspot.com/-PuY_60KBBag/WhH5V7BSFEI/AAAAAAAAHP4/jeFJYz9TPXMYpQCiblVVIW1M1xJcS9WiwCLcBGAs/s1600/Screenshot%2B2017-11-19%2B21.34.54.png" imageanchor="1" &gt;&lt;img border="0" src="https://2.bp.blogspot.com/-PuY_60KBBag/WhH5V7BSFEI/AAAAAAAAHP4/jeFJYz9TPXMYpQCiblVVIW1M1xJcS9WiwCLcBGAs/s640/Screenshot%2B2017-11-19%2B21.34.54.png" width="640" height="266" data-original-width="1600" data-original-height="664" /&gt;&lt;/a&gt; &lt;p&gt;Looks very exciting. So now the test; let's go offline and refresh:&lt;/p&gt; &lt;a href="https://3.bp.blogspot.com/-uYJ4yOIuJro/WhH_Yj2xRGI/AAAAAAAAHQQ/hqMmJC-HwwkR6sMGbMJyxCpRms0wXccrgCLcBGAs/s1600/Screenshot%2B2017-11-19%2B22.01.37.png" imageanchor="1" &gt;&lt;img border="0" src="https://3.bp.blogspot.com/-uYJ4yOIuJro/WhH_Yj2xRGI/AAAAAAAAHQQ/hqMmJC-HwwkR6sMGbMJyxCpRms0wXccrgCLcBGAs/s640/Screenshot%2B2017-11-19%2B22.01.37.png" width="640" height="338" data-original-width="1600" data-original-height="846" /&gt;&lt;/a&gt; &lt;p&gt;You are looking at the 200s of success.  You're now running with webpack and TypeScript and you have built a Progressive Web Application.  Feel good about life.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/565716004152848709'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/565716004152848709'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2017/11/the-typescript-webpack-pwa.html' title='The TypeScript webpack PWA'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='https://2.bp.blogspot.com/-Myu9uP3Vy3M/WhHN8AoAKLI/AAAAAAAAHOo/VtxOTu4S3bEhVIzkPvzt-BfV5c6anSidgCPcBGAYYCw/s72-c/Screenshot%2B2017-11-19%2B18.29.15.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-7140496943619802528</id><published>2017-10-20T06:30:00.001+01:00</published><updated>2021-03-04T05:52:05.621Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='AMD'/><category scheme='http://www.blogger.com/atom/ns#' term='DefinitelyTyped'/><category scheme='http://www.blogger.com/atom/ns#' term='TypeScript'/><category scheme='http://www.blogger.com/atom/ns#' term='CommonJS'/><title type='text'>TypeScript Definitions, webpack and Module Types</title><content type='html'>&lt;p&gt;A funny thing happened on the way to the registry the other day. Something changed in an npm package I was using and confusion arose.  You can read my unfiltered confusion &lt;a href="https://github.com/Microsoft/TypeScript/issues/18791"&gt;here&lt;/a&gt; but here's the slightly clearer explanation.&lt;/p&gt; &lt;h4&gt;The TL;DR&lt;/h4&gt; &lt;p&gt;When modules are imported, your loader will decide which module format it wants to use. CommonJS / AMD etc.  The loader decides.  It's important that the export is of the same "shape" regardless of the module format.   For 2 reasons:&lt;/p&gt; &lt;ol&gt;&lt;li&gt;You want to be able to reliably use the module regardless of the choice that your loader has made for which export to use.&lt;/li&gt;&lt;li&gt;Because when it comes to writing type definition files for modules, there is support for a &lt;em&gt;single&lt;/em&gt; external definition.  Not one for each module format.&lt;/li&gt;&lt;/ol&gt; &lt;a href="https://2.bp.blogspot.com/-3yKFfse82vg/Wen3PsVsN6I/AAAAAAAAG1Q/OudrhuBvVs0BdzXt67OyMtxRB8peLwbeACPcBGAYYCw/s1600/one-definition-to-rule-them-all.jpg" imageanchor="1" &gt;&lt;img border="0" src="https://2.bp.blogspot.com/-3yKFfse82vg/Wen3PsVsN6I/AAAAAAAAG1Q/OudrhuBvVs0BdzXt67OyMtxRB8peLwbeACPcBGAYYCw/s1600/one-definition-to-rule-them-all.jpg" data-original-width="398" data-original-height="383" /&gt;&lt;/a&gt; &lt;h4&gt;The DR&lt;/h4&gt; &lt;p&gt;Once upon a time we decided to use &lt;a href="https://github.com/MikeMcl/big.js/"&gt;big.js&lt;/a&gt; in our project.  It's popular and my old friend &lt;a href="https://twitter.com/nycdotnet"&gt;Steve Ognibene&lt;/a&gt; apparently originally wrote the type definitions which can be found &lt;a href="https://github.com/DefinitelyTyped/DefinitelyTyped/tree/master/types/big.js"&gt;here&lt;/a&gt;.  Then the definitions were updated by &lt;a href="https://github.com/googol"&gt;Miika Hnninen&lt;/a&gt;. And then there was pain.&lt;/p&gt; &lt;h4&gt;UMD / CommonJS **and** Global exports oh my!&lt;/h4&gt; &lt;p&gt;My usage code was as simple as this:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;import * as BigJs from 'big.js';&lt;br /&gt;const lookABigJs = new BigJs(1);&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;If you execute it in a browser it works.  It makes me a &lt;code&gt;Big&lt;/code&gt;.  However the TypeScript compiler is **not** happy.  No siree.  Nope.  It's bellowing at me:&lt;/p&gt; &lt;pre class="prettyprint"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;[ts] Cannot use 'new' with an expression whose type lacks a call or construct signature.&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;So I think: "Huh! I guess Miika just missed something off when he updated the definition files.  No bother.  I'll fix it."  I take a look at how &lt;code&gt;big.js&lt;/code&gt; exposes itself to the outside world.  At the time, thusly:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;    //AMD.&lt;br /&gt;    if (typeof define === 'function' &amp;&amp; define.amd) {&lt;br /&gt;        define(function () {&lt;br /&gt;            return Big;&lt;br /&gt;        });&lt;br /&gt;        &lt;br /&gt;    // Node and other CommonJS-like environments that support module.exports.&lt;br /&gt;    } else if (typeof module !== 'undefined' &amp;&amp; module.exports) {&lt;br /&gt;        module.exports = Big;&lt;br /&gt;        module.exports.Big = Big;&lt;br /&gt;    //Browser.&lt;br /&gt;    } else {&lt;br /&gt;        global.Big = Big;&lt;br /&gt;    }&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Now, we were using webpack as our script bundler / loader. webpack is supersmart; it can take all kinds of module formats.  So although it's more famous for supporting CommonJS, it can roll with AMD.  That's exactly what's happening here.  When webpack encounters the above code, it goes with the AMD export.  So at runtime, &lt;code&gt;import * as BigJs from 'big.js';&lt;/code&gt; lands up resolving to the &lt;code&gt;return Big;&lt;/code&gt; above.&lt;/p&gt; &lt;p&gt;Now this turns out to be super-relevant. I took a look at the relevant portion of the definition file and found this:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;export const Big: BigConstructor;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Which tells me that &lt;code&gt;Big&lt;/code&gt; is being exported as a subproperty of the module.  That makes sense; that lines up with the &lt;code&gt;module.exports.Big = Big;&lt;/code&gt; statement in the the big.js source code. There's a "gotcha" coming; can you guess what it is?&lt;/p&gt; &lt;p&gt;The problem is that our type definition is not exposing &lt;code&gt;Big&lt;/code&gt; as a default export.  So even though it's there; TypeScript won't let us use it.  What's killing us further is that webpack is loading the AMD export which &lt;em&gt;doesn't&lt;/em&gt; have &lt;code&gt;Big&lt;/code&gt; as a subproperty of the module.  It only has it as a default.&lt;/p&gt; &lt;p&gt;&lt;a href="https://twitter.com/kitsonk"&gt;Kitson Kelly&lt;/a&gt; expressed the problem well when he said:&lt;/p&gt; &lt;blockquote&gt;&lt;p&gt;there is a different shape depending on which loader is being used and I am not sure that makes a huge amount of sense. The AMD shape is different than the CommonJS shape. While that is technically possible, that feels like that is an issue.&lt;/p&gt;&lt;/blockquote&gt; &lt;h4&gt;One Definition to Rule Them All&lt;/h4&gt; &lt;p&gt;He's right; it is an issue.  From a TypeScript perspective there is no way to write a definition file that allows for different module "shapes" depending upon the module type. If you really wanted to do that you're reduced to writing multiple definition files.  That's blind alley anyway; what you want is a module to expose itself with the same "shape" regardless of the module type.  What you want is this:&lt;/p&gt; &lt;p&gt;&lt;code&gt;AMD === CommonJS === Global&lt;/code&gt;&lt;/p&gt; &lt;p&gt;And that's what we now have!  Thanks to &lt;a href="https://github.com/mikemcl"&gt;Michael McLaughlin&lt;/a&gt;, author of big.js, &lt;a href="https://github.com/MikeMcl/big.js/pull/87#issuecomment-332663587"&gt;version 4.0 unified the export shape of the package&lt;/a&gt;.  Miika Hnninen submitted another &lt;a href="https://github.com/DefinitelyTyped/DefinitelyTyped/pull/20096"&gt;PR&lt;/a&gt; which fixed up the type definitions. And once again the world is a beautiful place!&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7140496943619802528'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7140496943619802528'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2017/10/typescript-definitions-webpack-and-module-types.html' title='TypeScript Definitions, webpack and Module Types'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='https://2.bp.blogspot.com/-3yKFfse82vg/Wen3PsVsN6I/AAAAAAAAG1Q/OudrhuBvVs0BdzXt67OyMtxRB8peLwbeACPcBGAYYCw/s72-c/one-definition-to-rule-them-all.jpg' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-533388473806840626</id><published>2017-10-19T05:43:00.000+01:00</published><updated>2017-10-19T05:53:09.751+01:00</updated><category scheme='http://www.blogger.com/atom/ns#' term='extrahop'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='ts-loader'/><category scheme='http://www.blogger.com/atom/ns#' term='Webpack'/><title type='text'>Working with Extrahop on webpack and ts-loader</title><content type='html'>&lt;p&gt;I'm quite proud of this: &lt;a href="https://www.extrahop.com/company/blog/2017/extrahop-webpack-accelerating-build-times/"&gt;https://www.extrahop.com/company/blog/2017/extrahop-webpack-accelerating-build-times/&lt;/a&gt;&lt;/p&gt; &lt;p&gt;If you didn't know, I spend a good amount of my spare time hacking on open source software. You may not know what that is. I would describe OSS as software made with  by people, for other people to use.&lt;/p&gt; &lt;p&gt;You are currently reading this on a platform that was built using OSS. It's all around you, every day. It's on your phone, on your computer, on your TV. It's everywhere. &lt;/p&gt; &lt;p&gt;It's my hobby, it's part of my work. This specifically was one of those tremendously rare occasions when I got paid directly to work on my hobby, with people much brighter than me. It was brilliant. I loved it; it was a privilege.&lt;/p&gt; &lt;p&gt;Here's to Open Source!&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/533388473806840626'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/533388473806840626'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2017/10/working-with-extrahop-on-webpack-and-ts.html' title='Working with Extrahop on webpack and ts-loader'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8250296478270773452</id><published>2017-09-12T06:43:00.001+01:00</published><updated>2021-03-04T05:54:07.486Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='VS Code'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='console'/><category scheme='http://www.blogger.com/atom/ns#' term='fork-ts-checker-webpack-plugin'/><category scheme='http://www.blogger.com/atom/ns#' term='ts-loader'/><category scheme='http://www.blogger.com/atom/ns#' term='Webpack'/><title type='text'>fork-ts-checker-webpack-plugin code clickability</title><content type='html'>&lt;p&gt;My name is John Reilly and I'm a VS Code addict.  There I said it. I'm also a big fan of TypeScript and webpack.  I've recently switched to using the awesome &lt;a href="https://www.npmjs.com/package/fork-ts-checker-webpack-plugin"&gt;&lt;code&gt;fork-ts-checker-webpack-plugin&lt;/code&gt;&lt;/a&gt; to speed up my builds.&lt;/p&gt; &lt;p&gt;One thing I love is using VS Code both as my editor and my terminal. Using the fork-ts-checker-webpack-plugin I noticed a problem when TypeScript errors showed up in the terminal:&lt;/p&gt; &lt;a href="https://2.bp.blogspot.com/-XRG_JvUHkTQ/Wbds0uKYYzI/AAAAAAAAGes/ol8enPs6lLwRTdv8Uhml3cQdfJPji6nvACLcBGAs/s1600/Screenshot%2B2017-09-12%2B06.12.25.png" imageanchor="1" &gt;&lt;img border="0" src="https://2.bp.blogspot.com/-XRG_JvUHkTQ/Wbds0uKYYzI/AAAAAAAAGes/ol8enPs6lLwRTdv8Uhml3cQdfJPji6nvACLcBGAs/s640/Screenshot%2B2017-09-12%2B06.12.25.png" width="640" height="317" data-original-width="1600" data-original-height="793" /&gt;&lt;/a&gt; &lt;p&gt;Take a look at the red file location in the console above.  What's probably not obvious from the above screenshot is that it is &lt;strong&gt;not clickable&lt;/strong&gt;.  I'm used to being able to click on link in the console and bounce straight to the error location.  It's a really productive workflow; see a problem, click on it, be taken to the cause, fix it.  &lt;/p&gt; &lt;p&gt;I want to click on "&lt;code&gt;C:/source/ts-loader/examples/fork-ts-checker/src/fileWithError.ts(2,7)&lt;/code&gt;" and have VS Code open up &lt;code&gt;fileWithError.ts&lt;/code&gt;, ideally at line 2 and column 7. But here it's not working. Why?&lt;/p&gt; &lt;p&gt;Well, I initially got this slightly wrong; I thought it was about the formatting of the file path. It is.  I thought that having the line number and column number in parentheses after the path (eg &lt;code&gt;"(2,7)"&lt;/code&gt;) was screwing over VS Code.  It isn't.  Something else is.  Look closely at the screenshot; what do you see?  Do you notice how the colour of the line number / column number is different to the path?  In the words of &lt;a href="https://youtu.be/281jMxOvP5k"&gt;Delbert Wilkins&lt;/a&gt;: that's crucial.&lt;/p&gt; &lt;p&gt;Yup, the colour change between the path and the line number / column number is the problem.  I've submitted a &lt;a href="https://github.com/Realytics/fork-ts-checker-webpack-plugin/pull/48"&gt;PR to fix this&lt;/a&gt; that I hope will get merged.  In the meantime you can avoid this issue by dropping this code into your &lt;code&gt;webpack.config.js&lt;/code&gt;:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;var chalk = require("chalk");&lt;br /&gt;var os = require("os");&lt;br /&gt;&lt;br /&gt;function clickableFormatter(message, useColors) {&lt;br /&gt;    var colors = new chalk.constructor({ enabled: useColors });&lt;br /&gt;    var messageColor = message.isWarningSeverity() ? colors.bold.yellow : colors.bold.red;&lt;br /&gt;    var fileAndNumberColor = colors.bold.cyan;&lt;br /&gt;    var codeColor = colors.grey;&lt;br /&gt;    return [&lt;br /&gt;        messageColor(message.getSeverity().toUpperCase() + " in ") +&lt;br /&gt;        fileAndNumberColor(message.getFile() + "(" + message.getLine() + "," + message.getCharacter() + ")") +&lt;br /&gt;        messageColor(':'),&lt;br /&gt;&lt;br /&gt;        codeColor(message.getFormattedCode() + ': ') + message.getContent()&lt;br /&gt;    ].join(os.EOL);&lt;br /&gt;};&lt;br /&gt;&lt;br /&gt;module.exports = {&lt;br /&gt;    // Other config...&lt;br /&gt;    module: {&lt;br /&gt;        rules: [&lt;br /&gt;            {&lt;br /&gt;                test: /\.tsx?$/,&lt;br /&gt;                loader: 'ts-loader',&lt;br /&gt;                options: { transpileOnly: true }&lt;br /&gt;            }&lt;br /&gt;        ]&lt;br /&gt;    },&lt;br /&gt;    resolve: {&lt;br /&gt;        extensions: [ '.ts', '.tsx', 'js' ]&lt;br /&gt;    },&lt;br /&gt;    plugins: [&lt;br /&gt;        new ForkTsCheckerWebpackPlugin({ formatter: clickableFormatter }) // Here we get our clickability back&lt;br /&gt;    ]&lt;br /&gt;};&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;With that in place, what do you we have? This:&lt;/p&gt; &lt;a href="https://2.bp.blogspot.com/-nCA_UAzk7jQ/WbdyV9bxZ1I/AAAAAAAAGe8/9d5RJ6DsF3opycHZcPDNYYMScezFGRXCQCLcBGAs/s1600/Screenshot%2B2017-09-12%2B06.35.48.png" imageanchor="1" &gt;&lt;img border="0" src="https://2.bp.blogspot.com/-nCA_UAzk7jQ/WbdyV9bxZ1I/AAAAAAAAGe8/9d5RJ6DsF3opycHZcPDNYYMScezFGRXCQCLcBGAs/s640/Screenshot%2B2017-09-12%2B06.35.48.png" width="640" height="317" data-original-width="1600" data-original-height="793" /&gt;&lt;/a&gt; &lt;p&gt;VS Code clickability; it's a beautiful thing.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8250296478270773452'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8250296478270773452'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2017/09/fork-ts-checker-webpack-plugin-code.html' title='fork-ts-checker-webpack-plugin code clickability'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='https://2.bp.blogspot.com/-XRG_JvUHkTQ/Wbds0uKYYzI/AAAAAAAAGes/ol8enPs6lLwRTdv8Uhml3cQdfJPji6nvACLcBGAs/s72-c/Screenshot%2B2017-09-12%2B06.12.25.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6001142421582401125</id><published>2017-09-07T06:03:00.002+01:00</published><updated>2021-03-04T05:55:57.680Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='HappyPack'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='TypeScript'/><category scheme='http://www.blogger.com/atom/ns#' term='cache-loader'/><category scheme='http://www.blogger.com/atom/ns#' term='thread-loader'/><category scheme='http://www.blogger.com/atom/ns#' term='fork-ts-checker-webpack-plugin'/><category scheme='http://www.blogger.com/atom/ns#' term='Webpack'/><title type='text'>TypeScript + Webpack: Super Pursuit Mode</title><content type='html'>&lt;p&gt;&lt;i&gt;&lt;a href="https://medium.com/webpack/typescript-webpack-super-pursuit-mode-83cc568dea79"&gt;This post also featured as a webpack Medium publication&lt;/a&gt;.&lt;/i&gt;&lt;/p&gt; &lt;p&gt;If you're like me then you'll like TypeScript and you'll like module bundling with webpack.  You may also like speedy builds.  That's completely understandable.  The fact of the matter is, you sacrifice a bit of build speed to have webpack in the mix.  Wouldn't it be great if we could even up the difference?&lt;/p&gt; &lt;p&gt;I'm the primary maintainer of ts-loader, a TypeScript loader for webpack.  Just recently a couple of PRs were submitted that said, in other words: ts-loader is like this:&lt;/p&gt; &lt;a href="https://3.bp.blogspot.com/-31rZcGTrXpk/WThjLBJlBfI/AAAAAAAAFQY/13XSYUVr27IPgtQr80KhQpdDVVKmwaxIgCPcB/s1600/KITT.jpg" imageanchor="1" &gt;&lt;img border="0" src="https://3.bp.blogspot.com/-31rZcGTrXpk/WThjLBJlBfI/AAAAAAAAFQY/13XSYUVr27IPgtQr80KhQpdDVVKmwaxIgCPcB/s400/KITT.jpg" width="400" height="233" data-original-width="1200" data-original-height="698" /&gt;&lt;/a&gt; &lt;p&gt;But it could be like this:&lt;/p&gt; &lt;a href="https://2.bp.blogspot.com/-Mktfora8HfA/WThj-Z-mm0I/AAAAAAAAFQc/stDPTjNiQmUlDIUaCfaN9qjqEUostR_YACLcB/s1600/webkitt.jpg" imageanchor="1" &gt;&lt;img border="0" src="https://2.bp.blogspot.com/-Mktfora8HfA/WThj-Z-mm0I/AAAAAAAAFQc/stDPTjNiQmUlDIUaCfaN9qjqEUostR_YACLcB/s400/webkitt.jpg" width="400" height="225" data-original-width="1280" data-original-height="720" /&gt;&lt;/a&gt; &lt;p&gt;Apologies for the image quality above; there appear to be no high quality pictures out there of KITT in Super Pursuit Mode for me to defame with &lt;a href="https://github.com/plemont"&gt;Garan Jenkin&lt;/a&gt;'s atrocious puns.&lt;/p&gt; &lt;h4&gt;fork-ts-checker-webpack-plugin&lt;/h4&gt; &lt;p&gt;&lt;a href="https://github.com/TypeStrong/ts-loader/issues/537"&gt;"Faster type checking with forked process"&lt;/a&gt; read the enticing name of the issue.  It turned out to be &lt;a href="https://github.com/piotr-oles"&gt;Piotr Ole&lt;/a&gt; (&lt;a href="https://twitter.com/OlesDev"&gt;@OlesDev&lt;/a&gt;) telling the world about his beautiful creation.  He'd put together a mighty fine plugin that can be used alongside ts-loader called the &lt;a href="https://github.com/Realytics/fork-ts-checker-webpack-plugin"&gt;fork-ts-checker-webpack-plugin&lt;/a&gt;.  The name is a bit of a mouthful but the purpose is mouth-watering. To quote the README, it is a:&lt;/p&gt; &lt;blockquote cite="https://github.com/Realytics/fork-ts-checker-webpack-plugin"&gt;&lt;p&gt;Webpack plugin that runs typescript type checker on a separate process.&lt;/p&gt;&lt;/blockquote&gt; &lt;p&gt;What does this mean and how does this fit with ts-loader? Well, ts-loader does 2 jobs:&lt;/p&gt; &lt;ol&gt;&lt;li&gt;It transpiles your TypeScript into JavaScript and hands it off to webpack&lt;/li&gt;&lt;li&gt;It collects any TypeScript compilation errors and reports them to webpack&lt;/li&gt;&lt;/ol&gt; &lt;p&gt;What this plugin does is say, "forget about #2 - we've got this."  It removes the responsibility for type checking from ts-loader, so the only work ts-loader does is transpilation.  In the meantime, the all important type checking is still happening. To be honest, there would be little reason to recommend this approach otherwise.  The difference is &lt;code&gt;fork-ts-checker-webpack-plugin&lt;/code&gt; is doing the heavy lifting &lt;strong&gt;in a separate process&lt;/strong&gt;.  This provides a nice performance boost to your workflow. ts-loader is doing &lt;strong&gt;less&lt;/strong&gt; and that's a &lt;u&gt;good thing&lt;/u&gt;.&lt;/p&gt; &lt;p&gt;The approach used here is similar to that employed by awesome-typescript-loader. ATL is another TypeScript loader for webpack by the excellent &lt;a href="https://github.com/s-panferov"&gt;Stanislav Panferov&lt;/a&gt;.  ATL also has a technique for performing typechecking in a forked process.  fork-ts-checker-webpack-plugin was an effort by Piotr to implement something similar but with improved incremental build performance.&lt;/p&gt; &lt;p&gt;How do we use it?  Add fork-ts-checker-webpack-plugin as a &lt;code&gt;devDependency&lt;/code&gt; of your project and then amend the &lt;code&gt;webpack.config.js&lt;/code&gt; to set ts-loader into &lt;code&gt;transpileOnly&lt;/code&gt; mode and drop the plugin into the mix:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;var ForkTsCheckerWebpackPlugin = require('fork-ts-checker-webpack-plugin');&lt;br /&gt;&lt;br /&gt;var webpackConfig = {&lt;br /&gt;  // other config...&lt;br /&gt;  context: __dirname, // to automatically find tsconfig.json&lt;br /&gt;  module: {&lt;br /&gt;    rules: [&lt;br /&gt;      {&lt;br /&gt;        test: /\.tsx?$/,&lt;br /&gt;        loader: 'ts-loader',&lt;br /&gt;        options: {&lt;br /&gt;          // disable type checker - we will use it in fork plugin&lt;br /&gt;          transpileOnly: true &lt;br /&gt;        }&lt;br /&gt;      }&lt;br /&gt;    ]&lt;br /&gt;  },&lt;br /&gt;  plugins: [&lt;br /&gt;    new ForkTsCheckerWebpackPlugin()&lt;br /&gt;  ]&lt;br /&gt;};&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;If you'd like to see an example of how to use the plugin then take a look at a &lt;a href="https://github.com/TypeStrong/ts-loader/tree/master/examples/fork-ts-checker"&gt;simple example&lt;/a&gt; and a &lt;a href="https://github.com/TypeStrong/ts-loader/tree/master/examples/react-babel-karma-gulp-fork-ts-checker"&gt;more involved one&lt;/a&gt;.&lt;/p&gt; &lt;h4&gt;HappyPack&lt;/h4&gt; &lt;p&gt;Not so long ago I didn't know what &lt;strike&gt;happyness&lt;/strike&gt; &lt;a href="https://github.com/amireh/happypack"&gt;HappyPack&lt;/a&gt; was. "Happiness in the form of faster webpack build times."  That's what it is.&lt;/p&gt; &lt;blockquote cite="https://github.com/amireh/happypack"&gt;&lt;p&gt;HappyPack makes webpack builds faster by allowing you to transform multiple files in parallel.&lt;/p&gt;&lt;/blockquote&gt; &lt;p&gt;It does this by spinning up multiple threads, each with their own loaders inside.  We wanted to do this with ts-loader; to have multiple instances of ts-loader running. Work can then be divided up across these separate loaders.  Isn't multi-threading great?&lt;/p&gt; &lt;p&gt;ts-loader did not initially play nicely with HappyPack; essentially this is because ts-loader touches parts of webpack's API that HappyPack replaces.  The entirely wonderful &lt;a href="https://github.com/aindlq"&gt;Artem Kozlov&lt;/a&gt; submitted a &lt;a href="https://github.com/TypeStrong/ts-loader/pull/547"&gt;PR which added HappyPack support to ts-loader&lt;/a&gt;. Support essentially amounts to switching ts-loader to run in &lt;code&gt;transpileOnly&lt;/code&gt; mode and ensuring that there is no attempt to talk to parts of the webpack API that HappyPack removes.&lt;/p&gt; &lt;p&gt;It would be hard to recommend using HappyPack as is because, as with &lt;code&gt;transpileOnly&lt;/code&gt; mode you lose all typechecking.  Where it becomes worthwhile is where it is combined with the fork-ts-checker-webpack-plugin so you keep the typechecking.&lt;/p&gt; &lt;p&gt;Enough with the chitter chatter; how can we achieve this? Add HappyPack as a &lt;code&gt;devDependency&lt;/code&gt; of your project and then amend the &lt;code&gt;webpack.config.js&lt;/code&gt; as follows:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;var HappyPack = require('happypack');&lt;br /&gt;var ForkTsCheckerWebpackPlugin = require('fork-ts-checker-webpack-plugin');&lt;br /&gt;&lt;br /&gt;module.exports = {&lt;br /&gt;    // other config...&lt;br /&gt;    context: __dirname, // to automatically find tsconfig.json&lt;br /&gt;    module: {&lt;br /&gt;        rules: [&lt;br /&gt;            {&lt;br /&gt;                test: /\.tsx?$/,&lt;br /&gt;                exclude: /node_modules/,&lt;br /&gt;                loader: 'happypack/loader?id=ts'&lt;br /&gt;            }&lt;br /&gt;        ]&lt;br /&gt;    },&lt;br /&gt;    plugins: [&lt;br /&gt;        new HappyPack({&lt;br /&gt;            id: 'ts',&lt;br /&gt;            threads: 2,&lt;br /&gt;            loaders: [&lt;br /&gt;                {&lt;br /&gt;                    path: 'ts-loader',&lt;br /&gt;                    query: { happyPackMode: true }&lt;br /&gt;                }&lt;br /&gt;            ]&lt;br /&gt;        }),&lt;br /&gt;        new ForkTsCheckerWebpackPlugin({ checkSyntacticErrors: true })&lt;br /&gt;    ]&lt;br /&gt;};&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Note that the ts-loader options are now configured via the HappyPack &lt;code&gt;query&lt;/code&gt; and that we're setting ts-loader with the &lt;code&gt;happyPackMode&lt;/code&gt; option set.&lt;/p&gt; &lt;p&gt;There's one other thing to note which is important; we're now passing the &lt;code&gt;checkSyntacticErrors&lt;/code&gt; option to the fork plugin. This ensures that the plugin checks for both syntactic errors (eg &lt;code&gt;const array = [{} {}];&lt;/code&gt;) and semantic errors (eg &lt;code&gt;const x: number = '1';&lt;/code&gt;). By default the plugin only checks for semantic errors. This is because when ts-loader is used with &lt;code&gt;transpileOnly&lt;/code&gt; set, ts-loader will still report syntactic errors. But when used in &lt;code&gt;happyPackMode&lt;/code&gt; it does not. &lt;/p&gt; &lt;p&gt;If you'd like to see an example of how to use HappyPack then once again we have a &lt;a href="https://github.com/TypeStrong/ts-loader/tree/master/examples/happypack"&gt;simple example&lt;/a&gt; and a &lt;a href="https://github.com/TypeStrong/ts-loader/tree/master/examples/react-babel-karma-gulp-happypack"&gt;more involved one&lt;/a&gt;.&lt;/p&gt; &lt;h4&gt;&lt;code&gt;thread-loader&lt;/code&gt; + &lt;code&gt;cache-loader&lt;/code&gt;&lt;/h4&gt; &lt;p&gt;You might have some reservations about using HappyPack.  First of all the quirky configuration required makes your webpack config rather less comprehensible.  Also, HappyPack is not officially blessed by webpack.  It is a side project developed externally from webpack and there's no guarantees that new versions of webpack won't break it.  Neither of these are reasons not to use HappyPack but they are things to bear in mind.&lt;/p&gt; &lt;p&gt;What if there were a way to parallelise our builds which dealt with these issues?  Well, there is! By using &lt;a href="https://github.com/webpack-contrib/thread-loader"&gt;thread-loader&lt;/a&gt; and &lt;a href="https://github.com/webpack-contrib/cache-loader"&gt;cache-loader&lt;/a&gt; in combination you can both feel happy that you're using an official webpack workflow and you can have a config that's less confusing.&lt;/p&gt; &lt;p&gt;What would that config look like?  This:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;var ForkTsCheckerWebpackPlugin = require('fork-ts-checker-webpack-plugin');&lt;br /&gt;&lt;br /&gt;module.exports = {&lt;br /&gt;    // other config...&lt;br /&gt;    context: __dirname, // to automatically find tsconfig.json&lt;br /&gt;    module: {&lt;br /&gt;        rules: {&lt;br /&gt;            test: /\.tsx?$/,&lt;br /&gt;            use: [&lt;br /&gt;                { loader: 'cache-loader' },&lt;br /&gt;                {&lt;br /&gt;                    loader: 'thread-loader',&lt;br /&gt;                    options: {&lt;br /&gt;                        // there should be 1 cpu for the fork-ts-checker-webpack-plugin&lt;br /&gt;                        workers: require('os').cpus().length - 1,&lt;br /&gt;                    },&lt;br /&gt;                },&lt;br /&gt;                {&lt;br /&gt;                    loader: 'ts-loader',&lt;br /&gt;                    options: {&lt;br /&gt;                        happyPackMode: true // IMPORTANT! use happyPackMode mode to speed-up compilation and reduce errors reported to webpack&lt;br /&gt;                    }&lt;br /&gt;                }&lt;br /&gt;            ]&lt;br /&gt;        }&lt;br /&gt;    },&lt;br /&gt;    plugins: [&lt;br /&gt;        new ForkTsCheckerWebpackPlugin({ checkSyntacticErrors: true })&lt;br /&gt;    ]&lt;br /&gt;};&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;As you can see the configuration is much cleaner than with HappyPack.  Interestingly ts-loader still needs to run in "&lt;code&gt;happyPackMode&lt;/code&gt;" and that's because thread-loader is essentially behaving in the same fashion as with HappyPack and so ts-loader needs to behave in the same way. Probably ts-loader should have a more generic flag name than "&lt;code&gt;happyPackMode&lt;/code&gt;". (Famously, naming things is hard; so if you've a good idea, tell me!)&lt;/p&gt; &lt;p&gt;These loaders are new and so tread carefully. My own experiences have been pretty positive but your mileage may vary. Do note that, as with HappyPack, the thread-loader is highly configurable.&lt;/p&gt; &lt;p&gt;If you'd like to see an example of how to use thread-loader and cache-loader then once again we have a &lt;a href="https://github.com/TypeStrong/ts-loader/tree/master/examples/thread-loader"&gt;simple example&lt;/a&gt; and a &lt;a href="https://github.com/TypeStrong/ts-loader/tree/master/examples/react-babel-karma-gulp-thread-loader"&gt;more involved one&lt;/a&gt;.&lt;/p&gt; &lt;h4&gt;All This Could Be Yours...&lt;/h4&gt; &lt;blockquote class="twitter-tweet" data-lang="en"&gt;&lt;p lang="en" dir="ltr"&gt;Wow! It looks like we can cut our build time by 4 minutes! &lt;a href="https://twitter.com/hashtag/webpack?src=hash"&gt;#webpack&lt;/a&gt; &lt;a href="https://twitter.com/typescriptlang"&gt;@typescriptlang&lt;/a&gt; // cc &lt;a href="https://twitter.com/johnny_reilly"&gt;@johnny_reilly&lt;/a&gt; &lt;a href="https://t.co/gjvy9SLBAT"&gt;pic.twitter.com/gjvy9SLBAT&lt;/a&gt;&lt;/p&gt;&amp;mdash; Donald Pipowitch (@PipoPeperoni) &lt;a href="https://twitter.com/PipoPeperoni/status/878148978356834304"&gt;June 23, 2017&lt;/a&gt;&lt;/blockquote&gt;&lt;script async src="//platform.twitter.com/widgets.js" charset="utf-8"&gt;&lt;/script&gt; &lt;p&gt;In this post we're improving build speeds with TypeScript and webpack in 3 ways:&lt;/p&gt; &lt;dl&gt;&lt;dt&gt;fork-ts-checker-webpack-plugin&lt;/dt&gt;&lt;dd&gt;With this plugin in play ts-loader only performs transpilation.  ts-loader is doing less so the build is faster.&lt;/dd&gt; &lt;dt&gt;HappyPack&lt;/dt&gt;&lt;dd&gt;With HappyPack in the mix, the build is parallelised.  That parallelisation means the build is faster.&lt;/dd&gt; &lt;dt&gt;thread-loader / cache-loader&lt;/dt&gt;&lt;dd&gt;With thread-loader and cache-loader, again the build is parallelised and the build is faster.&lt;/dd&gt;&lt;/dl&gt; &lt;iframe src="https://giphy.com/embed/Bo2WsocASVBm0" width="240" height="180" frameBorder="0" class="giphy-embed" allowFullScreen&gt;&lt;/iframe&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/6001142421582401125'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/6001142421582401125'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2017/09/typescript-webpack-super-pursuit-mode.html' title='TypeScript + Webpack: Super Pursuit Mode'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='https://3.bp.blogspot.com/-31rZcGTrXpk/WThjLBJlBfI/AAAAAAAAFQY/13XSYUVr27IPgtQr80KhQpdDVVKmwaxIgCPcB/s72-c/KITT.jpg' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1356432090447815789</id><published>2017-08-30T20:54:00.000+01:00</published><updated>2017-08-30T20:54:15.574+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Oh the Glamour of Open Source</title><content type='html'>&lt;p&gt;Here's how my life panned out in the early hours of Wednesday 30th September 2017:&lt;/p&gt; &lt;dl&gt;&lt;dt&gt;2 am&lt;/dt&gt;&lt;dd&gt;awoken by Lisette having a nightmare&lt;/dd&gt;&lt;dt&gt;3 am&lt;/dt&gt;&lt;dd&gt;gave up hope of getting back to sleep upstairs and headed for the sofa&lt;/dd&gt;&lt;dt&gt;4 am&lt;/dt&gt;&lt;dd&gt;still not asleep and discovered a serious gap in an open source project I help out with&lt;/dd&gt;&lt;dt&gt;4:30 am&lt;/dt&gt;&lt;dd&gt; come up with idea for a fix&lt;/dd&gt;&lt;dt&gt;4:45 am&lt;/dt&gt;&lt;dd&gt; accidentally delete a repo that I and many others care about from GitHub&lt;/dd&gt;&lt;dt&gt;4:50 am&lt;/dt&gt;&lt;dd&gt; recover said repo from backups (sweet mercy how could I be so stupid?)&lt;/dd&gt;&lt;dt&gt;4:55 am&lt;/dt&gt;&lt;dd&gt; actually succeed in cloning the repo I want to hack on &lt;/dd&gt;&lt;dt&gt;5:30 am&lt;/dt&gt;&lt;dd&gt; implement fix and &lt;a href="https://github.com/Realytics/fork-ts-checker-webpack-plugin/pull/43"&gt;send PR&lt;/a&gt;&lt;/dd&gt;&lt;dt&gt;5:35 am&lt;/dt&gt;&lt;dd&gt; go for a walk round the river&lt;/dd&gt;&lt;dt&gt;6:30 am&lt;/dt&gt;&lt;dd&gt; realise I didn't submit a test for the changed functionality&lt;/dd&gt;&lt;dt&gt;6:35 am&lt;/dt&gt;&lt;dd&gt; write test only to discover I can't run the test pack on Windows&lt;/dd&gt;&lt;dt&gt;6:40 am&lt;/dt&gt;&lt;dd&gt; add test to PR anyway so I can see test results when Travis runs on each commit.&lt;/dd&gt;&lt;dt&gt;7 am&lt;/dt&gt;&lt;dd&gt;despair at the duration of my feedback loop, totally fail to get my tests to pass&lt;/dd&gt;&lt;dt&gt;7:10 am&lt;/dt&gt;&lt;dd&gt; stub my toe really badly on a train set Benjamin has been busily assembling beneath my feet&lt;/dd&gt;&lt;dt&gt;7:11 am&lt;/dt&gt;&lt;dd&gt; give in and literally beg the project owner in Paris to fix the tests for me. He takes pity on me and agrees. Possibly because I gave him emoji tulips  &lt;/dd&gt;&lt;dt&gt;7:12 am&lt;/dt&gt;&lt;dd&gt; feel like a slight failure and profoundly tired.&lt;/dd&gt; &lt;/dl&gt; &lt;p&gt;Oh the glamour of open source.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1356432090447815789'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1356432090447815789'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2017/08/oh-glamour-of-open-source.html' title='Oh the Glamour of Open Source'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1460397371350386363</id><published>2017-08-27T19:36:00.004+01:00</published><updated>2021-03-14T05:32:32.264Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='Chrome'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Karma'/><category scheme='http://www.blogger.com/atom/ns#' term='PhantomJS'/><category scheme='http://www.blogger.com/atom/ns#' term='Headless'/><title type='text'>Karma: From PhantomJS to Headless Chrome </title><content type='html'>&lt;p&gt;Like pretty much everyone else I've been using PhantomJS to run my JavaScript (or compiled-to-JS) unit tests.  It's been great.  So when I heard the news that &lt;a href="https://news.ycombinator.com/item?id=14105489"&gt;PhantomJS was dead&lt;/a&gt; I was genuinely sad. However, the King is dead.... Long live the King!  For there is a new hope; it's called &lt;a href="https://developers.google.com/web/updates/2017/04/headless-chrome"&gt;Chrome Headless &lt;/a&gt;.  It's not a separate version of Chrome; rather the ability to run Chrome without a UI is now baked into Google's favourite browser as of v59. (For those history buffs I might as well be clear: the main reason PhantomJS died is because Chrome Headless was in the works.)&lt;/p&gt; &lt;h4&gt;Making the Switch&lt;/h4&gt; &lt;p&gt;As long as you're running Chrome v59 or greater then you can switch.  I've just made ts-loader's execution test pack run with Chrome Headless instead of PhantomJS and I've rarely been happier.  Honest.  Some context: the execution test pack runs Jasmine unit tests via the &lt;a href="https://karma-runner.github.io/1.0/index.html"&gt;Karma test runner&lt;/a&gt;.  The move was surprisingly easy and you can see just how minimal it was in the PR &lt;a href="https://github.com/TypeStrong/ts-loader/pull/611/files"&gt;here&lt;/a&gt;.  If you want to migrate a test that runs tests via Karma then this will take you through what you need to do.&lt;/p&gt; &lt;h4&gt;&lt;code&gt;package.json&lt;/code&gt;&lt;/h4&gt; &lt;p&gt;You no longer need &lt;code&gt;phantomjs-prebuilt&lt;/code&gt; as a dev dependency of your project.  That's the PhantomJS browser disappearing in the rear view mirror.  Next we need to replace &lt;code&gt;karma-phantomjs-launcher&lt;/code&gt; with &lt;code&gt;karma-chrome-launcher&lt;/code&gt;.  These packages are responsible for firing up the browser that the tests are run in and we no longer want to invoke PhantomJS; we're Chrome all the way baby.&lt;/p&gt; &lt;h4&gt;&lt;code&gt;karma.conf.js&lt;/code&gt;&lt;/h4&gt; &lt;p&gt;You need to tell Karma to use Chrome Headless instead of PhantomJS.  You do that by replacing&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;   browsers: [ 'PhantomJS' ],&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;with&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;   browsers: [ 'ChromeHeadless' ],&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;That's it; job done!&lt;/p&gt; &lt;h4&gt;Continuous Integration&lt;/h4&gt; &lt;p&gt;There's always one more thing isn't there?  Yup, ts-loader has CI builds that run on &lt;a href="https://ci.appveyor.com/project/JohnReilly/ts-loader/branch/master"&gt;Windows with AppVeyor&lt;/a&gt; and &lt;a href="https://travis-ci.org/TypeStrong/ts-loader"&gt;Linux with Travis&lt;/a&gt;.  The AppVeyor build went green on the first run; that's because Chrome is installed by default in the AppVeyor build environment. (yay!)&lt;/p&gt; &lt;p&gt;Travis went red. (boooo!) Travis doesn't have Chrome installed by default.  But it's no biggie; you just need to tweak your &lt;code&gt;.travis.yml&lt;/code&gt; like so:&lt;/p&gt; &lt;pre class="prettyprint yml"&gt;&lt;br /&gt;&lt;code class="language-yml"&gt;&lt;br /&gt;dist: trusty&lt;br /&gt;addons:&lt;br /&gt;  chrome: stable&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;This includes Chrome in the Travis build environment.  Green.  Boom!&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1460397371350386363'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1460397371350386363'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2017/08/karma-from-phantomjs-to-headless-chrome.html' title='Karma: From PhantomJS to Headless Chrome '/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-945114254376816844</id><published>2017-07-29T05:52:00.001+01:00</published><updated>2021-03-04T05:57:12.485Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='haiku'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='semantic versioning'/><title type='text'>A Haiku on the Problem with SemVer: Us</title><content type='html'>&lt;p&gt;Version numbers wrong&lt;br /&gt;We release breaking changes&lt;br /&gt;We don't know we do&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/945114254376816844'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/945114254376816844'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2017/07/a-haiku-on-problem-with-semver-us.html' title='A Haiku on the Problem with SemVer: Us'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2745016015214076259</id><published>2017-07-11T15:31:00.001+01:00</published><updated>2017-07-11T15:31:27.633+01:00</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Powershell stuff</title><content type='html'>param (     [parameter(Position = 0, Mandatory = $true)][string]$RootPath )  Set-StrictMode -Version Latest $ErrorActionPreference = "Stop"  # Example usage:  # Install-npmModulesAndCreateLinks -Modules bnpp-xap-fx-blotter-core,bnpp-xap-fx-core function Install-npmModulesAndCreateLinks {     param(         [string[]] $Modules,         [switch] $Build = $false     )          Write-Host "RootPath: $RootPath" -ForegroundColor Green      if (-not($Modules) -OR $Modules.Length -eq 0) {         Write-Host "`nNo modules supplied :-(`n" -ForegroundColor White -BackgroundColor Red         Write-Host "I was expecting something like this:`n"         Write-Host "Install-npmModulesAndCreateLinks -Modules bnpp-xap-fx-blotter-core,bnpp-xap-fx-core`n" -ForegroundColor Green         Write-Host "or maybe`n"         Write-Host "Install-npmModulesAndCreateLinks -Modules bnpp-xap-fx-controls -Build`n" -ForegroundColor Green         Write-Host "Try again?`n"         return     }      $ModulesPath = "$RootPath\Code\Modules"          Write-Host "`nModules to install and link:`n" -ForegroundColor Cyan      foreach ($Module in $Modules) {         write-host $Module          $ModulePath = "$ModulesPath\$Module"         if ((Test-Path $ModulePath) -eq $false) {             Write-Host "`nUnable to find module $Module; the following path does not exist :-(`n" -ForegroundColor White -BackgroundColor Red             Write-Host "$ModulePath`n" -ForegroundColor Green             Write-Host "Is there a typo in your module name?`n"             return         }     }      Write-Host "`nOff we go!`n" -ForegroundColor Cyan      Install-npmAndLinkFull -ModulesPath $ModulesPath -Modules $Modules      if ($Build -eq $true) {         Write-Host "`nWill now attempt to build the linked modules:`n" -ForegroundColor Cyan          $Modules | ForEach-Object { Build -Module $_ }     }      $FinalMessage = If ($Build -eq $true) {"`nFinished installing, linking and building the following modules:`n"} Else {"`nFinished installing and linking the following modules:`n"}     Write-Host $FinalMessage -ForegroundColor Cyan      foreach ($Module in $Modules) {         $ModulePath = "$ModulesPath\$Module"         write-host "$Module - $ModulePath" -ForegroundColor Green     }      Write-Host "`nHave a tip top day!`n" -ForegroundColor Cyan }  # blows away your node_modules folder and does a fresh npm install # uses rimraf to delete the folder quickly # deletes any package-lock.json file prior to the new install function Install-npm {     if (Test-Path node_modules) {         Write-Host "Deleting node_modules folder"         rimraf node_modules     }      if (Test-Path package-lock.json) {         Write-Host "Deleting package-lock.json"         Remove-Item package-lock.json     }      Write-Host "Running npm install..."     npm install --loglevel warn }  # the same as nredo, but re-instates any linked modules afterwards. function Install-npmKeepLinks {     $linksToRestore = Get-Links      Install-npm      $linksToRestore |          ForEach-Object { npm link $_.Name } }   function Start-Serve {     Show-Toast "Starting server! $(Get-Smiley)"      $HostPath = "$RootPath\Code\Modules\bnpp-xap-fx-host"     if ((Test-Path $HostPath) -eq $false) {         Write-Host "`nThe serve path does not exist :-(`n" -ForegroundColor White -BackgroundColor Red         Write-Host "$HostPath`n" -ForegroundColor Green         Write-Host "Try again?`n"         return     }      Set-Location $HostPath      grunt serve | Out-Default          Show-Toast "Server died $(Get-Frowny) Restarting... "      Start-Serve }  # gets any linked folders inside the node_modules folder.  Execute it in the root of a module function Get-Links() {     Get-ChildItem node_modules |         Where-Object { Test-ReparsePoint $_.FullName } }  # lists any linked folders inside the node_modules folder.  Execute it in the root of a module function Show-Links() {     $Links = Get-Links     if (@($Links).Count -eq 0) {         Write-Host "This modules has no links!`n" -ForegroundColor Cyan         return;     }      Write-Host "This modules has the following links:`n" -ForegroundColor Cyan     Get-Links |         ForEach-Object { Write-Host $_.Name } }  ## PRIVATE   # Displays a windows 10 toast notification with the given message function Show-Toast($text) {     $ErrorActionPreference = "Stop"      $notificationTitle = $text      [Windows.UI.Notifications.ToastNotificationManager, Windows.UI.Notifications, ContentType = WindowsRuntime] &gt; $null     $template = [Windows.UI.Notifications.ToastNotificationManager]::GetTemplateContent([Windows.UI.Notifications.ToastTemplateType]::ToastText01)      #Convert to .NET type for XML manipuration     $toastXml = [xml] $template.GetXml()     $toastXml.GetElementsByTagName("text").AppendChild($toastXml.CreateTextNode($notificationTitle)) &gt; $null      #Convert back to WinRT type     $xml = New-Object Windows.Data.Xml.Dom.XmlDocument     $xml.LoadXml($toastXml.OuterXml)      $uniqueId = "PS $(Get-Date -format hhmmss)"      $toast = [Windows.UI.Notifications.ToastNotification]::new($xml)     $toast.Tag = $uniqueId     $toast.Group = $uniqueId     $toast.ExpirationTime = [DateTimeOffset]::Now.AddMinutes(5)     #$toast.SuppressPopup = $true      $notifier = [Windows.UI.Notifications.ToastNotificationManager]::CreateToastNotifier($uniqueId)     $notifier.Show($toast); }  # Return the smiley character function Get-Smiley() {     return [char]0x263A }  function Get-Frowny() {     return [char]0x26FF     }  # tests to see if a path is a symbolic link function Test-ReparsePoint([string]$path) {     $file = Get-Item $path -Force -ea SilentlyContinue     return [bool]($file.Attributes -band [IO.FileAttributes]::ReparsePoint) }  function ClearAndInstall([string]$ModulesPath, [string]$Module) {     $ModulePath = "$ModulesPath\$Module"      Write-Host "Setting location to $ModulePath" -ForegroundColor Green     Push-Location $ModulePath     Write-Host "Location is $PWD. Starting install..." -ForegroundColor Green      Install-npm      Pop-Location     Write-Host "Finished installing. Location is $PWD" -ForegroundColor Green }  function Link([string]$ModulesPath, [string]$Module) {      $ModulePath = "$ModulesPath\$Module"      Write-Host "Setting location to $ModulePath" -ForegroundColor Green     Push-Location $ModulePath     Write-Host "Location is $PWD. Starting linking..." -ForegroundColor Green      Write-Host "npm linking $Module"     npm link      if (Test-Path package-lock.json) {         Write-Host "Deleting package-lock.json"         Remove-Item package-lock.json     }      Pop-Location     Write-Host "Finished linking. Location is $PWD" -ForegroundColor Green }  function LinkDependencies([string]$ModulesPath, [string]$Module, [string[]]$ModulesInDevelopment) {      $ModulePath = "$ModulesPath\$Module"      Write-Host "Setting location to $ModulePath" -ForegroundColor Green     Push-Location $ModulePath     Write-Host "Location is $PWD. Will read package.json to link any dependent modules which are also being worked on..." -ForegroundColor Green      $OtherModulesInDevelopment = $ModulesInDevelopment | Where-Object -FilterScript { $_ -ne $Module }          $DependencyModules = Get-Content './package.json' -raw |          ConvertFrom-Json |          Select-Object -expand dependencies |          get-member |         where-object { $_.MemberType -eq 'NoteProperty' } |         Select-Object -expandproperty Name      foreach ($DependencyModule in $DependencyModules) {         if ($OtherModulesInDevelopment -Contains $DependencyModule) {             Write-Host "$DependencyModule is a dependency in the $Module package.json - will npm link" -ForegroundColor Green             npm link $DependencyModule         }     }      Pop-Location     Write-Host "Finished linking dependent modules.  Location is $PWD" }  function LinkBack([string]$ModulesPath, [string]$ModuleReceivingLink, [string[]]$Modules) {      $ModulePath = "$ModulesPath\$ModuleReceivingLink"      Write-Host "Setting location to $ModulePath" -ForegroundColor Green     Push-Location $ModulePath     Write-Host "Location is $PWD. Will link back $ModuleReceivingLink..." -ForegroundColor Green      foreach ($Module in $Modules) {         Write-Host "npm linking $Module to $ModuleReceivingLink"         npm link $Module     }      Pop-Location     Write-Host "Finished linking back $ModuleReceivingLink. Location is $PWD" }  function Build([string]$Module) {      $ModulePath = "$ModulesPath\$Module"      Write-Host "Setting location to $ModulePath" -ForegroundColor Green     Push-Location $ModulePath     Write-Host "Location is $PWD. Will build $ModulesPath..." -ForegroundColor Green      grunt buildall      Pop-Location     Write-Host "Finished building. Location is $PWD" }  function Install-npmAndLinkFull() {     param(         [string] $ModulesPath,          [string[]] $Modules     )      foreach ($Module in $Modules) {         ClearAndInstall $ModulesPath $Module         Link $ModulesPath $Module         LinkDependencies $ModulesPath $Module $Modules     }      $FxHostModule = "bnpp-xap-fx-host"     ClearAndInstall $ModulesPath $FxHostModule     LinkBack $ModulesPath $FxHostModule $Modules }  ## EXPORTS  Export-ModuleMember -Function Install-npmModulesAndCreateLinks Export-ModuleMember -Function Install-npm Export-ModuleMember -Function Install-npmKeepLinks Export-ModuleMember -Function Start-Serve Export-ModuleMember -Function Get-Links Export-ModuleMember -Function Show-Links</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2745016015214076259'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2745016015214076259'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4162063892381265004</id><published>2017-07-02T22:30:00.001+01:00</published><updated>2021-03-04T05:59:02.535Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='await'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='async'/><category scheme='http://www.blogger.com/atom/ns#' term='TypeScript'/><category scheme='http://www.blogger.com/atom/ns#' term='Karma'/><category scheme='http://www.blogger.com/atom/ns#' term='Babel'/><category scheme='http://www.blogger.com/atom/ns#' term='Webpack'/><category scheme='http://www.blogger.com/atom/ns#' term='dynamic import'/><title type='text'>Dynamic import: I've been awaiting you...</title><content type='html'>&lt;p&gt;One of the most exciting features to ship with TypeScript 2.4 was support for the dynamic import expression. To quote the &lt;a href="https://blogs.msdn.microsoft.com/typescript/2017/06/27/announcing-typescript-2-4/#dynamic-import-expressions"&gt;release blog post&lt;/a&gt;:&lt;/p&gt; &lt;blockquote cite="https://blogs.msdn.microsoft.com/typescript/2017/06/27/announcing-typescript-2-4/"&gt;&lt;p&gt;Dynamic &lt;code&gt;import&lt;/code&gt; expressions are a new feature in ECMAScript that allows you to asynchronously request a module at any arbitrary point in your program. These modules come back as &lt;code&gt;Promise&lt;/code&gt;s of the module itself, and can be &lt;code&gt;await&lt;/code&gt;-ed in an async function, or can be given a callback with &lt;code&gt;.then&lt;/code&gt;.&lt;/p&gt; &lt;p&gt;...&lt;/p&gt; &lt;p&gt;Many bundlers have support for automatically splitting output bundles (a.k.a. code splitting) based on these &lt;code&gt;import()&lt;/code&gt; expressions, so consider using this new feature with the &lt;code&gt;esnext&lt;/code&gt; module target. Note that this feature wont work with the &lt;code&gt;es2015&lt;/code&gt; module target, since the feature is anticipated for ES2018 or later.&lt;/p&gt;&lt;/blockquote&gt; &lt;p&gt;As the post makes clear, this adds support for a very bleeding edge ECMAScript feature.  This is not fully standardised yet; it's currently at &lt;a href="https://github.com/tc39/proposals"&gt;stage 3&lt;/a&gt; on the TC39 proposals list.  That means it's at the  &lt;a href="https://tc39.github.io/process-document/"&gt;Candidate&lt;/a&gt; stage and is unlikely to change further.  If you'd like to read more about it then take a look at the official proposal &lt;a href="https://github.com/tc39/proposal-dynamic-import"&gt;here&lt;/a&gt;.&lt;/p&gt; &lt;p&gt;Whilst this is super-new, we are still able to use this feature.  We just have to jump through a few hoops first.&lt;/p&gt; &lt;h4&gt;TypeScript Setup&lt;/h4&gt; &lt;p&gt;First of all, you need to install TypeScript 2.4.  With that in place you need to make some adjustments to your &lt;code&gt;tsconfig.json&lt;/code&gt; in order that the relevant compiler switches are flipped.  What do you need?  First of all you need to be targeting ECMAScript 2015 as a minimum.  That's important specifically because ES2015 contained &lt;code&gt;Promise&lt;/code&gt;s which is what dynamic &lt;code&gt;import&lt;/code&gt;s produce.  The second thing you need is to target the module type of &lt;code&gt;esnext&lt;/code&gt;. You're likely targeting &lt;code&gt;es2015&lt;/code&gt; now, &lt;code&gt;esnext&lt;/code&gt; is that &lt;strong&gt;plus&lt;/strong&gt; dynamic &lt;code&gt;import&lt;/code&gt;s.&lt;/p&gt; &lt;p&gt;Here's a &lt;code&gt;tsconfig.json&lt;/code&gt; I made earlier which has the relevant settings set:&lt;/p&gt; &lt;pre class="prettyprint json"&gt;&lt;br /&gt;&lt;code class="language-json"&gt;&lt;br /&gt;{&lt;br /&gt;    "compilerOptions": {&lt;br /&gt;        "allowSyntheticDefaultImports": true,&lt;br /&gt;        "lib": [&lt;br /&gt;            "dom",&lt;br /&gt;            "es2015"&lt;br /&gt;        ],&lt;br /&gt;        "target": "es2015",&lt;br /&gt;        "module": "esnext",&lt;br /&gt;        "moduleResolution": "node",&lt;br /&gt;        "noImplicitAny": true,&lt;br /&gt;        "noUnusedLocals": true,&lt;br /&gt;        "noUnusedParameters": true,&lt;br /&gt;        "removeComments": false,&lt;br /&gt;        "preserveConstEnums": true,&lt;br /&gt;        "sourceMap": true,&lt;br /&gt;        "skipLibCheck": true&lt;br /&gt;    }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;h4&gt;Babel Setup&lt;/h4&gt; &lt;p&gt;At the time of writing, browser support for dynamic &lt;code&gt;import&lt;/code&gt; is non-existent.  This will likely be the case for some time but it needn't hold us back.  Babel can step in here and compile our super-new JS into JS that will run in our browsers today.&lt;/p&gt; &lt;p&gt;You'll need to decide for yourself how much you want Babel to do for you. In my case I'm targeting old school browsers which don't yet support   ES2015.  You may not need to.  However, the one thing that you'll certainly need is the &lt;a href="https://babeljs.io/docs/plugins/syntax-dynamic-import/"&gt;Syntax Dynamic Import&lt;/a&gt; plugin.  It's this that allows Babel to process dynamic &lt;code&gt;import&lt;/code&gt; statements.&lt;/p&gt; &lt;p&gt;These are the options I'm passing to Babel:&lt;/p&gt; &lt;pre class="prettyprint json"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;var babelOptions = {&lt;br /&gt;  "plugins": ["syntax-dynamic-import"],&lt;br /&gt;  "presets": [&lt;br /&gt;    [&lt;br /&gt;      "es2015",&lt;br /&gt;      {&lt;br /&gt;        "modules": false&lt;br /&gt;      }&lt;br /&gt;    ]&lt;br /&gt;  ]&lt;br /&gt;};&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;You're also going to need something that actually execute the &lt;code&gt;import&lt;/code&gt;s.  In my case I'm using webpack...&lt;/p&gt; &lt;h4&gt;webpack&lt;/h4&gt; &lt;p&gt;webpack 2 supports &lt;a href="https://webpack.js.org/api/module-methods/#import-"&gt;&lt;code&gt;import()&lt;/code&gt;&lt;/a&gt;. So if you webpack set up with  &lt;a href="https://github.com/TypeStrong/ts-loader"&gt;ts-loader&lt;/a&gt; (or awesome-typescript-loader etc), chaining into &lt;a href="https://github.com/babel/babel-loader"&gt;babel-loader&lt;/a&gt; you should find you have a setup that supports dynamic &lt;code&gt;import&lt;/code&gt;. That means a &lt;code&gt;webpack.config.js&lt;/code&gt; that looks something like this:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;var path = require('path');&lt;br /&gt;var webpack = require('webpack');&lt;br /&gt;&lt;br /&gt;var babelOptions = {&lt;br /&gt;  "plugins": ["syntax-dynamic-import"],&lt;br /&gt;  "presets": [&lt;br /&gt;    [&lt;br /&gt;      "es2015",&lt;br /&gt;      {&lt;br /&gt;        "modules": false&lt;br /&gt;      }&lt;br /&gt;    ]&lt;br /&gt;  ]&lt;br /&gt;};&lt;br /&gt;&lt;br /&gt;module.exports = {&lt;br /&gt;  entry: './app.ts',&lt;br /&gt;  output: {&lt;br /&gt;      filename: 'bundle.js'&lt;br /&gt;  },&lt;br /&gt;  module: {&lt;br /&gt;    rules: [{&lt;br /&gt;      test: /\.ts(x?)$/,&lt;br /&gt;      exclude: /node_modules/,&lt;br /&gt;      use: [&lt;br /&gt;        {&lt;br /&gt;          loader: 'babel-loader',&lt;br /&gt;          options: babelOptions&lt;br /&gt;        },&lt;br /&gt;        {&lt;br /&gt;          loader: 'ts-loader'&lt;br /&gt;        }&lt;br /&gt;      ]&lt;br /&gt;    }, {&lt;br /&gt;      test: /\.js$/,&lt;br /&gt;      exclude: /node_modules/,&lt;br /&gt;      use: [&lt;br /&gt;        {&lt;br /&gt;          loader: 'babel-loader',&lt;br /&gt;          options: babelOptions&lt;br /&gt;        }&lt;br /&gt;      ]&lt;br /&gt;    }]&lt;br /&gt;  },&lt;br /&gt;  resolve: {&lt;br /&gt;    extensions: ['.ts', '.tsx', '.js']&lt;br /&gt;  },&lt;br /&gt;};&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;h4&gt;ts-loader example&lt;/h4&gt; &lt;p&gt;I'm one of the maintainers of &lt;a href="https://github.com/TypeStrong/ts-loader"&gt;ts-loader&lt;/a&gt; which is a TypeScript loader for webpack. When support for dynamic &lt;code&gt;import&lt;/code&gt;s landed I wanted to add a test to cover usage of the new syntax with ts-loader.&lt;/p&gt; &lt;p&gt;We have 2 test packs for ts-loader, one of which is our "execution" test pack.  It is so named because it works by spinning up webpack with ts-loader and then using &lt;a href="https://github.com/karma-runner/karma"&gt;karma&lt;/a&gt; to execute a set of tests.  Each "test" in our execution test pack is actually a mini-project with its own test suite (generally &lt;a href="https://jasmine.github.io/"&gt;jasmine&lt;/a&gt; but that's entirely configurabe).  Each complete with its own &lt;code&gt;webpack.config.js&lt;/code&gt;, &lt;code&gt;karma.conf.js&lt;/code&gt; and either a &lt;code&gt;typings.json&lt;/code&gt; or &lt;code&gt;package.json&lt;/code&gt; for bringing in dependencies.  So it's a full test of whether code slung with ts-loader and webpack actually executes when the output is plugged into a browser.&lt;/p&gt; &lt;p&gt;This is the test pack for dynamic &lt;code&gt;import&lt;/code&gt;s:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;import a from "../src/a";&lt;br /&gt;import b from "../src/b";&lt;br /&gt;&lt;br /&gt;describe("app", () =&gt; {&lt;br /&gt;  it("a to be 'a' and b to be 'b' (classic)", () =&gt; {&lt;br /&gt;    expect(a).toBe("a");&lt;br /&gt;    expect(b).toBe("b");&lt;br /&gt;  });&lt;br /&gt;&lt;br /&gt;  it("import results in a module with a default export", done =&gt; {&lt;br /&gt;    import("../src/c").then(c =&gt; {&lt;br /&gt;      // .default is the default export&lt;br /&gt;      expect(c.default).toBe("c");&lt;br /&gt;&lt;br /&gt;      done();&lt;br /&gt;    }&lt;br /&gt;  });&lt;br /&gt;&lt;br /&gt;  it("import results in a module with an export", done =&gt; {&lt;br /&gt;    import("../src/d").then(d =&gt; {&lt;br /&gt;      // .default is the default export&lt;br /&gt;      expect(d.d).toBe("d");&lt;br /&gt;&lt;br /&gt;      done();&lt;br /&gt;    }&lt;br /&gt;  });&lt;br /&gt;&lt;br /&gt;  it("await import results in a module with a default export", async done =&gt; {&lt;br /&gt;    const c = await import("../src/c");&lt;br /&gt;&lt;br /&gt;    // .default is the default export&lt;br /&gt;    expect(c.default).toBe("c");&lt;br /&gt;&lt;br /&gt;    done();&lt;br /&gt;  });&lt;br /&gt;&lt;br /&gt;  it("await import results in a module with an export", async done =&gt; {&lt;br /&gt;    const d = await import("../src/d");&lt;br /&gt;&lt;br /&gt;    expect(d.d).toBe("d");&lt;br /&gt;&lt;br /&gt;    done();&lt;br /&gt;  });&lt;br /&gt;});&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;As you can see, it's possible to use the dynamic &lt;code&gt;import&lt;/code&gt; as a &lt;code&gt;Promise&lt;/code&gt; directly.  Alternatively, it's possible to consume the imported module using TypeScripts support for &lt;code&gt;async&lt;/code&gt; / &lt;code&gt;await&lt;/code&gt;.  For my money the latter option makes for much clearer code.&lt;/p&gt; &lt;p&gt;If you're looking for a complete example of how to use the new syntax then you could do worse than taking the existing test pack and tweaking it to your own ends. The only change you'd  need to make is to strip out the &lt;code&gt;resolveLoader&lt;/code&gt; statements in &lt;code&gt;webpack.config.js&lt;/code&gt; and &lt;code&gt;karma.conf.js&lt;/code&gt;. (They exist to lock the test in case to the freshly built ts-loader stored locally.  You'll not need this.)&lt;/p&gt; &lt;p&gt;You can find the test in question &lt;a href="https://github.com/TypeStrong/ts-loader/tree/master/test/execution-tests/2.4.1_babel-importCodeSplitting"&gt;here&lt;/a&gt;. Happy code splitting!&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4162063892381265004'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4162063892381265004'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2017/07/dynamic-import-ive-been-await-ing-you.html' title='Dynamic &lt;code&gt;import&lt;/code&gt;: I&apos;ve been &lt;code&gt;await&lt;/code&gt;ing you...'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-7576167287190580012</id><published>2017-06-11T14:11:00.001+01:00</published><updated>2021-03-14T05:31:06.943Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='VS Code'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='code'/><category scheme='http://www.blogger.com/atom/ns#' term='Windows'/><category scheme='http://www.blogger.com/atom/ns#' term='failed'/><category scheme='http://www.blogger.com/atom/ns#' term='npm install'/><category scheme='http://www.blogger.com/atom/ns#' term='windows defender'/><title type='text'>Windows Defender Step Away From npm</title><content type='html'>&lt;h4&gt;Update 18/06/2017&lt;/h4&gt; &lt;p&gt;Whilst things did improve by fiddling with Windows Defender it wasn't a 100% fix which makes me wary.  Interestingly, VS Code was always open when I did experience the issue and I haven't experienced it when it's been closed.  So it may be the cause.  I've opened &lt;a href="https://github.com/Microsoft/vscode/issues/28593"&gt;an issue for this against the VS Code repo&lt;/a&gt; - it sounds like other people may be affected as I was.  Perhaps this is VS Code and not Windows Defender. Watch that space...&lt;/p&gt; &lt;h4&gt;Update 12/07/2017&lt;/h4&gt; &lt;p&gt;The issue was VS Code.  The bug has now been fixed and shipped last night with &lt;a href="https://code.visualstudio.com/updates/v1_14"&gt;VS Code 1.14.0&lt;/a&gt;.  Yay!&lt;/p&gt; &lt;hr /&gt; &lt;p&gt;I've recently experienced many of my &lt;code&gt;npm install&lt;/code&gt;s failing for no consistent reason.  The error message would generally be something along the lines of:&lt;/p&gt; &lt;pre class="prettyprint" cite="https://github.com/react-community/create-react-native-app/issues/191"&gt;&lt;br /&gt;&lt;code class="language-sh"&gt;&lt;br /&gt;npm ERR! Error: EPERM: operation not permitted, rename 'C:\dev\training\drrug\node_modules\.staging\@exponent\ngrok-fc327f2a' -&gt; 'C:\dev\training\drrug\node_modules\@exponent\ngrok'&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt; &lt;p&gt;I spent a good deal of time changing the versions of node and npm I was running; all seemingly to no avail.  Regular flakiness which I ascribed to node / npm. I was starting to give up when I read of &lt;a href="https://github.com/react-community/create-react-native-app/issues/191#issuecomment-304073970"&gt;other people experiencing similar issues&lt;/a&gt;. Encouragingly &lt;a href="https://github.com/fmeira"&gt;Fernando Meira&lt;/a&gt; suggested a solution:&lt;/p&gt; &lt;blockquote cite="https://github.com/react-community/create-react-native-app/issues/191"&gt;I got the same problem just doing an npm install. Run with antivirus disabled (if you use Windows Defender, turn off Real-Time protection and Cloud-based protection). That worked for me! &lt;/blockquote&gt; &lt;p&gt;I didn't really expect this to work - Windows Defender has been running in the background of my Windows 10 laptop since I've had it.  There's been no problems with npm installs up until a week or so ago. But given the experience I and others have had I thought I should put it out there: it looks like Windows Defender has it in for npm.  Go figure.&lt;/p&gt; &lt;p&gt;Alas Windows Defender doesn't stay dead for long; it's like a zombie that rises from the grave no matter how many times you kill it.  So you might want to try configuring it to ignore node.exe:&lt;/p&gt;  &lt;a href="https://2.bp.blogspot.com/-Pfq0TRPVLrk/WT1O_ieEo3I/AAAAAAAAFSI/pOSO45HlLcwGFISihZ-t8D8aETjjn64_wCPcB/s1600/Screenshot%2B2017-06-11%2B15.05.47.png" imageanchor="1" &gt;&lt;img border="0" src="https://2.bp.blogspot.com/-Pfq0TRPVLrk/WT1O_ieEo3I/AAAAAAAAFSI/pOSO45HlLcwGFISihZ-t8D8aETjjn64_wCPcB/s640/Screenshot%2B2017-06-11%2B15.05.47.png" width="446" height="640" data-original-width="1114" data-original-height="1600" /&gt;&lt;/a&gt; &lt;p&gt;Or switching to Linux...&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7576167287190580012'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7576167287190580012'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2017/06/windows-defender-step-away-from-npm.html' title='Windows Defender Step Away From npm'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='https://2.bp.blogspot.com/-Pfq0TRPVLrk/WT1O_ieEo3I/AAAAAAAAFSI/pOSO45HlLcwGFISihZ-t8D8aETjjn64_wCPcB/s72-c/Screenshot%2B2017-06-11%2B15.05.47.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4032925017216846325</id><published>2017-05-20T06:18:00.001+01:00</published><updated>2021-03-04T06:00:26.955Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='tsconfig.json'/><category scheme='http://www.blogger.com/atom/ns#' term='TypeScript'/><title type='text'>TypeScript: Spare the Rod, Spoil the Code</title><content type='html'>&lt;p&gt;I've recently started a new role.  Perhaps unsurprisingly, part of the technology stack is TypeScript.  A couple of days into the new codebase I found a bug. Well, I say I found a bug, TypeScript and VS Code found the bug - I just let everyone else know.&lt;/p&gt; &lt;p&gt;The flexibility that TypeScript offers in terms of compiler settings is second to none.  You can turn up the dial of strictness to your hearts content.  Or down. I'm an "up" man myself.&lt;/p&gt; &lt;p&gt;The project that I am working on has the dial set fairly low; it's pretty much using the default compiler values which are (sensibly) not too strict.  I have to say this makes sense for helping people get on board with using TypeScript.  Start from a point of low strictness and turn it up when you're ready.  As you might have guessed, I cranked the dial up on day one on  my own machine.  I should say that as I did this, I didn't foist this on the project at large - I kept it just to my build... I'm not *&lt;strong&gt;that&lt;/strong&gt;* guy!&lt;/p&gt; &lt;p&gt;I made the below changes to the &lt;code&gt;tsconfig.json&lt;/code&gt; file. Details of what each of these settings does can be found in the documentation &lt;a href="https://www.typescriptlang.org/docs/handbook/compiler-options.html"&gt;here&lt;/a&gt;.&lt;/p&gt; &lt;pre class="prettyprint json"&gt;&lt;br /&gt;&lt;code class="language-json"&gt;&lt;br /&gt;    "noImplicitAny": true,&lt;br /&gt;    "noImplicitThis": true,&lt;br /&gt;    "noUnusedLocals": true,&lt;br /&gt;    "noImplicitReturns": true,&lt;br /&gt;    "noUnusedParameters": true,&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;I said I found a bug.  The nature of the bug was an unused variable; a variable was created in a function but then not used. Here's a super simple example:&lt;/p&gt; &lt;pre class="prettyprint ts"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;function sayHi(name: string) {&lt;br /&gt;    const greeting = `Hi ${ name }`;&lt;br /&gt;    return name;&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;It's an easy mistake to make. I've made this mistake before myself. But with the &lt;code&gt;noUnusedLocals&lt;/code&gt; compiler setting in place it's now an easy mistake to catch; VS Code lets you know loud and clear:&lt;/p&gt; &lt;a href="https://2.bp.blogspot.com/-EgsBVxOeD88/WR_NvmhT0dI/AAAAAAAAEzk/LXOWhJyGGDEhr-AmLGqPjRbARQEB6h_ZwCPcB/s1600/Screenshot%2B2017-05-20%2B05.58.54.png" imageanchor="1" &gt;&lt;img border="0" src="https://2.bp.blogspot.com/-EgsBVxOeD88/WR_NvmhT0dI/AAAAAAAAEzk/LXOWhJyGGDEhr-AmLGqPjRbARQEB6h_ZwCPcB/s400/Screenshot%2B2017-05-20%2B05.58.54.png" width="400" height="196" /&gt;&lt;/a&gt; &lt;p&gt;The other compiler settings will similarly highlight simple mistakes it's possible to make and I'd recommend using them.  I should say I've written this from the perspective of a VS Code user, but this really applies generally to TypeScript usage.  So whether you're an &lt;a href="http://alm.tools/"&gt;alm.tools&lt;/a&gt; guy, a WebStorm gal or something else entirely then this too can be yours!&lt;/p&gt; &lt;p&gt;I'd also say that the &lt;code&gt;strictNullChecks&lt;/code&gt; compiler setting is worth looking into.  However, switching an already established project to using that can involve fairly extensive code changes and will also require a certain amount of education of, and buy in from, your team.  So whilst I'd recommend it too, I'd save that one until last.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4032925017216846325'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4032925017216846325'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2017/05/typescript-spare-rod-spoil-code.html' title='TypeScript: Spare the Rod, Spoil the Code'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='https://2.bp.blogspot.com/-EgsBVxOeD88/WR_NvmhT0dI/AAAAAAAAEzk/LXOWhJyGGDEhr-AmLGqPjRbARQEB6h_ZwCPcB/s72-c/Screenshot%2B2017-05-20%2B05.58.54.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4766477979851675219</id><published>2017-04-25T11:00:00.001+01:00</published><updated>2017-04-25T11:00:24.080+01:00</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>How Contracting in the UK Has Changed</title><content type='html'>I am a UK based full-stack developer with 15 years of developing software on a contract basis.  Let me shorten that: I am a contractor.   I've recently come to realise that the life of a contractor these days is rather different than when I began.  Let's reflect upon how.  The "why" I'm a little less clear on.    I fell into contracting back in the early 2000's.  Unlike many it wasn't something I sought out.  Put simply, I was looking for a job and an agent put me forward for a 3 month contract role.  When I went along for the interview, I learned a project was just about to kick off and they needed someone who could sling some C#.  I could be that slinger. I slung.  It wasn't a demanding interview, really just a basic chat asking me about my skills.  There was no technical test.  There was no HR interview.  I got the gig.  I believe I was on 1 weeks notice (if it was as much as that) and I didn't expect it to last any more than the expected 3 months.   As it turned out, the contract was extended multiple times.  When the project I was working on concluded, they asked me to stick around to work on a different project that was just starting up.  In fact that happened a number of times.  In the end I decided to leave.  Not because I didn't like the place but because I was commuting 4 hours a day and decided I needed to spend less time travelling.  What I want you to notice about this is just how simple... how relaxed the interview process was.  Likewise, it's worth noting just how little security the contractor (me) was afforded by the contract terms.  To me this made complete sense.  Why invest truckloads of time in someone who will quite simply be shown the door if it turns out they can't cut it?  To be clear: I liked the simplicity of the arrangement.  I turned up for a straightforward chat.  I seemed plausible so they gave me a crack at it.  If I wasn't the real deal they could say goodbye with the minimum of fuss.  It was a low commitment, simple and professional approach to getting things done.  It worked and, in my opinion, worked well.  I should say that I wasn't just "lucky".[1]  Others who were taken on at the same time as me did not get to stick around.  Either they got shown the door or their contracts weren't renewed.    [1] Actually I'll be the first to acknowledge that good fortune has played a part in my career as well as it has anyone else's. By the way, if you ever encounter anyone who believes they're there based purely on their raw talent... Well they're deluded.  But you probably knew that anyway.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4766477979851675219'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4766477979851675219'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1918350758347072526</id><published>2017-04-25T06:02:00.001+01:00</published><updated>2021-03-03T14:03:02.347Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='powershell'/><category scheme='http://www.blogger.com/atom/ns#' term='Version'/><category scheme='http://www.blogger.com/atom/ns#' term='dot net core'/><category scheme='http://www.blogger.com/atom/ns#' term='AppVeyor'/><title type='text'>Setting Build Version Using AppVeyor and ASP.Net Core</title><content type='html'>&lt;p&gt;AppVeyor has &lt;a href="https://www.appveyor.com/docs/build-configuration/#assemblyinfo-patching"&gt;support for setting the version of a binary during a build&lt;/a&gt;. However - this deals with the classic ASP.Net world of &lt;code&gt;AssemblyInfo&lt;/code&gt;.  I didn't find any reference to support for doing the same with dot net core.  Remember, dot net core &lt;a href="https://docs.microsoft.com/en-us/dotnet/articles/core/tools/project-json-to-csproj#version"&gt;relies upon a &lt;code&gt;&amp;lt;Version&amp;gt;&lt;/code&gt; or a &lt;code&gt;&amp;lt;VersionPrefix&amp;gt;&lt;/code&gt; setting in the &lt;code&gt;.csproj&lt;/code&gt; file&lt;/a&gt;.  Personally, &lt;code&gt;&amp;lt;Version&amp;gt;&lt;/code&gt; is my jam.&lt;/p&gt; &lt;p&gt;However, coming up with your own bit of powershell that stamps the version during the build is a doddle; here we go:&lt;/p&gt; &lt;pre class="prettyprint ps"&gt;&lt;br /&gt;&lt;code class="language-ps"&gt;&lt;br /&gt;Param($projectFile, $buildNum)&lt;br /&gt;&lt;br /&gt;$content = [IO.File]::ReadAllText($projectFile)&lt;br /&gt;&lt;br /&gt;$regex = new-object System.Text.RegularExpressions.Regex ('(&lt;Version&gt;)([\d]+.[\d]+.[\d]+)(.[\d]+)(&lt;\/Version&gt;)', &lt;br /&gt;         [System.Text.RegularExpressions.RegexOptions]::MultiLine)&lt;br /&gt;&lt;br /&gt;$version = $null&lt;br /&gt;$match = $regex.Match($content)&lt;br /&gt;if($match.Success) {&lt;br /&gt;    # from "&lt;Version&gt;1.0.0.0&lt;/Version&gt;" this will extract "1.0.0"&lt;br /&gt;    $version = $match.groups[2].value&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;# suffix build number onto $version. eg "1.0.0.15"&lt;br /&gt;$version = "$version.$buildNum"&lt;br /&gt;&lt;br /&gt;# update "&lt;Version&gt;1.0.0.0&lt;/Version&gt;" to "&lt;Version&gt;$version&lt;/Version&gt;"&lt;br /&gt;$content = $regex.Replace($content, '${1}' + $version + '${4}')&lt;br /&gt;&lt;br /&gt;# update csproj file&lt;br /&gt;[IO.File]::WriteAllText($projectFile, $content)&lt;br /&gt;&lt;br /&gt;# update AppVeyor build&lt;br /&gt;Update-AppveyorBuild -Version $version&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;You can invoke this script as part of the build process in AppVeyor by adding something like this to your &lt;code&gt;appveyor.yml&lt;/code&gt;.&lt;/p&gt; &lt;pre class="prettyprint yml"&gt;&lt;br /&gt;&lt;code class="language-yml"&gt;&lt;br /&gt;before_build:&lt;br /&gt;- ps: .\ModifyVersion.ps1 $env:APPVEYOR_BUILD_FOLDER\src\Proverb.Web\Proverb.Web.csproj $env:APPVEYOR_BUILD_NUMBER&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;It will keep the first 3 parts of the version in your &lt;code&gt;.csproj&lt;/code&gt; (eg "1.0.0") and suffix on the build number supplied by AppVeyor.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1918350758347072526'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1918350758347072526'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2017/04/setting-build-version-using-appveyor.html' title='Setting Build Version Using AppVeyor and ASP.Net Core'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6032269342406048904</id><published>2017-04-14T08:09:00.000+01:00</published><updated>2017-04-14T08:09:34.939+01:00</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>EF Core - How to Scaffold on the CLI</title><content type='html'>Surprisingly hard to get this working.  But once you do... It's done!   Scaffolding db context.  The command that works:  dotnet ef dbcontext scaffold "Server=.\;Database=AdventureWorksLT2012;Trusted_Connection=True;" Microsoft.EntityFrameworkCore.SqlServer --output-dir Models  The packages you need in your csproj:    &lt;ItemGroup&gt;    &lt;PackageReference Include="Microsoft.EntityFrameworkCore.Tools" Version="1.1.0" /&gt;    &lt;PackageReference Include="Microsoft.EntityFrameworkCore.Design" Version="1.1.1" PrivateAssets="All" /&gt;    &lt;PackageReference Include="Microsoft.EntityFrameworkCore.SqlServer.Design" Version="1.1.1" PrivateAssets="All" /&gt;    &lt;PackageReference Include="Microsoft.EntityFrameworkCore.SqlServer" Version="1.1.1" /&gt;  &lt;/ItemGroup&gt;   &lt;ItemGroup&gt;    &lt;DotNetCliToolReference Include="Microsoft.EntityFrameworkCore.Tools.DotNet" Version="1.0.0" /&gt;  &lt;/ItemGroup&gt; https://docs.microsoft.com/en-us/aspnet/core/security/app-secrets  dotnet user-secrets set MySecret ValueOfMySecret</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/6032269342406048904'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/6032269342406048904'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4308864492061074502</id><published>2017-04-07T17:26:00.000+01:00</published><updated>2017-04-07T17:26:46.577+01:00</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Simple Splash Screen</title><content type='html'>&lt;p&gt;You ever wanted a simple splash screen to show up in your SPA whilst [insert framework of choice] bootstraps itself?  Something to make the users reassured your app is working and oh so slightly slick.  Something that makes them want to "view source" because it's *&lt;em&gt;so&lt;/em&gt;* slick.&lt;/p&gt; &lt;pre class="prettyprint xml"&gt;&lt;br /&gt;&amp;lt;div class="text-center"&amp;gt;&lt;br /&gt; &amp;lt;h1&amp;gt;Loading.....&amp;lt;/h1&amp;gt;&lt;br /&gt; &amp;lt;i class="fa fa-cog fa-spin fa-3x fa-fw"&amp;gt;&amp;lt;/i&amp;gt;&lt;br /&gt;&amp;lt;/div&amp;gt;&lt;br /&gt;&lt;/pre&gt; &lt;p data-height="265" data-theme-id="0" data-slug-hash="oZrBNZ" data-default-tab="html,result" data-user="johnnyreilly" data-embed-version="2" data-pen-title="Simple splash screen" class="codepen"&gt;See the Pen &lt;a href="https://codepen.io/johnnyreilly/pen/oZrBNZ/"&gt;Simple splash screen&lt;/a&gt; by johnnyreilly (&lt;a href="http://codepen.io/johnnyreilly"&gt;@johnnyreilly&lt;/a&gt;) on &lt;a href="http://codepen.io"&gt;CodePen&lt;/a&gt;.&lt;/p&gt;&lt;script async src="https://production-assets.codepen.io/assets/embed/ei.js"&gt;&lt;/script&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4308864492061074502'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4308864492061074502'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-7473944033213979746</id><published>2017-03-30T20:38:00.001+01:00</published><updated>2021-03-13T14:22:26.662Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>I'm looking for work!</title><content type='html'>&lt;p&gt;My name is John Reilly. I'm a full stack developer based in London, UK.  I'm just coming to the end of a contract (due to finish in April 2017) and I'm starting to look for my next role.&lt;/p&gt; &lt;p&gt;I have more than 15 years experience developing software commercially.  I've worked in a number of industries including telecoms, advertising, technology (I worked at Microsoft for a time) and, of course, finance.  The bulk of my experience is in the finance sector.  I've provided consultancy services, building and maintaining applications for both large and small companies; from enterprise to startup.&lt;/p&gt; &lt;p&gt;My most recent work has been full stack web work; using React on the front end and SignalR (ASP.Net) on the back end. I'm pragmatic about the tools that I use to deliver software solutions and not tied to any particular technology.  That said, I've gravitated towards the handiwork of &lt;a href="https://en.wikipedia.org/wiki/Anders_Hejlsberg"&gt;Anders Hejlsberg&lt;/a&gt;; starting out with Delphi and being both an early C# and TypeScript adopter.  I've built everything from high volume trade feeds with no UI beyond a log file, WinForms apps for call centres, to fully fledged rich web applications with a heavy emphasis on UX.&lt;/p&gt; &lt;p&gt;I enjoy the challenges of understanding problems and coming up with useful solutions to them. I'm thrilled when something I've built makes someone's life easier. I love to learn and to share my knowledge; both in person and also through writing this blog. (This is the first time I've used a post to seek work.)&lt;/p&gt; &lt;p&gt;In my spare time I'm involved with various open source projects including &lt;a href="https://github.com/typestrong/ts-loader"&gt;ts-loader&lt;/a&gt; and &lt;a href="https://github.com/DefinitelyTyped/DefinitelyTyped"&gt;DefinitelyTyped&lt;/a&gt; (&lt;a href="https://github.com/orgs/DefinitelyTyped/people"&gt;member of the core team&lt;/a&gt;). Get in contact with me if you're interested in learning more about me.  Mail me at &lt;a href="mailto:johnny_reilly@hotmail.com"&gt;johnny_reilly@hotmail.com&lt;/a&gt; and I can provide you with a CV. You can also find me on &lt;a href="https://github.com/johnnyreilly"&gt;GitHub&lt;/a&gt;.&lt;/p&gt; &lt;h4&gt;Update 25/04/2016: Position Filled&lt;/h4&gt; &lt;p&gt;I'm happy to say that I've lined up work for the next 6 months or so.  Once again I'll be working in the financial services industry with one interesting twist.  &lt;a href="https://blog.johnnyreilly.com/2014/02/wpf-and-mystic-meg-or-playing.html"&gt;In a blog post ages ago I bet that native apps would start to be replaced with SPAs.&lt;/a&gt;  This has started to happen.  I've started to see companies taking a "web-first-and-only" approach to building apps.  In that vein, that's exactly what I'm off to build.&lt;/p&gt; &lt;p&gt;As a result of publishing this blog post I've had some interesting conversations with companies and got to think hard about the direction the industry is taking.  I remain excited by JavaScript / TypeScript and React. I'm hopeful of the possibilities offered by the container world of Docker etc.  I'm enjoying .NET Core and have very high hopes for it.  I remain curious about Web Assembly.&lt;/p&gt; &lt;p&gt;Before I sign off, I know at some point I'll be looking for work once again.  If there's a system you'd like built, if there's some mentoring and training you'd like done or if you'd just like to have a conversation I'm always available to talk. Drop me a line at  &lt;a href="mailto:johnny_reilly@hotmail.com"&gt;johnny_reilly@hotmail.com&lt;/a&gt;.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7473944033213979746'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7473944033213979746'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2017/03/im-looking-for-work.html' title='I&apos;m looking for work!'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-23881425446803661</id><published>2017-03-28T19:45:00.001+01:00</published><updated>2021-03-04T06:01:44.162Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='VS Code'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='ASP.Net Core'/><category scheme='http://www.blogger.com/atom/ns#' term='Visual Studio'/><title type='text'>Debugging ASP.Net Core in VS or Code</title><content type='html'>&lt;p&gt;I've been using Visual Studio for a long time. Very good it is too.  However, it is heavyweight; it does far more than I need.  What I really want when I'm working is a fast snappy editor, with intellisense and debugging. What I've basically described is &lt;a href="https://code.visualstudio.com/"&gt;VS Code&lt;/a&gt;. It rocks and has long become my go-to editor for TypeScript. &lt;/p&gt; &lt;p&gt;Since I'm a big C# fan as well I was delighted that editing C# was also possible in Code.  What I want now is to be able to debug ASP.Net Core in Visual Studio OR VS Code.  Can it be done?  Let's see....&lt;/p&gt; &lt;p&gt;I fire up Visual Studio and &lt;code&gt;File -&gt; New Project&lt;/code&gt; (yes it's a verb now).  Select .NET Core and then ASP.Net Core Web Application.  OK.  We'll go for a Web Application. Let's not bother with authentication.  OK. Wait a couple of seconds and Visual Studio serves up a new project. Hit F5 and we're debugging in Visual Studio.&lt;/p&gt; &lt;p&gt;So far, so straightforward.  What will VS Code make of this?&lt;/p&gt; &lt;p&gt;I cd my way to the root of my new ASP.Net Core Web Application and type the magical phrase "code .". Up it fires.  I feel lucky, let's hit "F5". Huh, a dropdown shows up saying &lt;code&gt;"Select Environment"&lt;/code&gt; and offering me the options of Chrome and Node.  Neither do I want.  It's about this time I remember this is a clean install of VS Code and doesn't yet have the C# extension installed.  In fact, if I open a C# file it up it tells me and recommends that I install.  Well that's nice.  I take it up on the kind offer; install and reload.&lt;/p&gt; &lt;p&gt;When it comes back up I see the following entries in the "output" tab:&lt;/p&gt; &lt;pre class="prettyprint"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;Updating C# dependencies...&lt;br /&gt;Platform: win32, x86_64 (win7-x64)&lt;br /&gt;&lt;br /&gt;Downloading package 'OmniSharp (.NET 4.6 / x64)' (20447 KB) .................... Done!&lt;br /&gt;Downloading package '.NET Core Debugger (Windows / x64)' (39685 KB) .................... Done!&lt;br /&gt;&lt;br /&gt;Installing package 'OmniSharp (.NET 4.6 / x64)'&lt;br /&gt;Installing package '.NET Core Debugger (Windows / x64)'&lt;br /&gt;&lt;br /&gt;Finished&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Note that mention of "debugger" there?  Sounds super-promising. There's also some prompts: &lt;code&gt;"There are unresolved dependencies from 'WebApplication1/WebApplication1.csproj'. Please execute the restore command to continue"&lt;/code&gt;&lt;/p&gt; &lt;p&gt;So it wants me to &lt;code&gt;dotnet restore&lt;/code&gt;.  It's even offering to do that for me!  Have at you; I let it.&lt;/p&gt; &lt;pre class="prettyprint"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;Welcome to .NET Core!&lt;br /&gt;---------------------&lt;br /&gt;Learn more about .NET Core @ https://aka.ms/dotnet-docs. Use dotnet --help to see available commands or go to https://aka.ms/dotnet-cli-docs.&lt;br /&gt;&lt;br /&gt;Telemetry&lt;br /&gt;--------------&lt;br /&gt;The .NET Core tools collect usage data in order to improve your experience. The data is anonymous and does not include command-line arguments. The data is collected by Microsoft and shared with the community.&lt;br /&gt;You can opt out of telemetry by setting a DOTNET_CLI_TELEMETRY_OPTOUT environment variable to 1 using your favorite shell.&lt;br /&gt;You can read more about .NET Core tools telemetry @ https://aka.ms/dotnet-cli-telemetry.&lt;br /&gt;&lt;br /&gt;Configuring...&lt;br /&gt;-------------------&lt;br /&gt;A command is running to initially populate your local package cache, to improve restore speed and enable offline access. This command will take up to a minute to complete and will only happen once.&lt;br /&gt;Decompressing Decompressing 100% 4026 ms&lt;br /&gt;Expanding 100% 34814 ms&lt;br /&gt;  Restoring packages for c:\Source\Debugging\WebApplication1\WebApplication1\WebApplication1.csproj...&lt;br /&gt;  Restoring packages for c:\Source\Debugging\WebApplication1\WebApplication1\WebApplication1.csproj...&lt;br /&gt;  Restore completed in 734.05 ms for c:\Source\Debugging\WebApplication1\WebApplication1\WebApplication1.csproj.&lt;br /&gt;  Generating MSBuild file c:\Source\Debugging\WebApplication1\WebApplication1\obj\WebApplication1.csproj.nuget.g.props.&lt;br /&gt;  Writing lock file to disk. Path: c:\Source\Debugging\WebApplication1\WebApplication1\obj\project.assets.json&lt;br /&gt;  Restore completed in 1.26 sec for c:\Source\Debugging\WebApplication1\WebApplication1\WebApplication1.csproj.&lt;br /&gt;  &lt;br /&gt;  NuGet Config files used:&lt;br /&gt;      C:\Users\johnr\AppData\Roaming\NuGet\NuGet.Config&lt;br /&gt;      C:\Program Files (x86)\NuGet\Config\Microsoft.VisualStudio.Offline.config&lt;br /&gt;  &lt;br /&gt;  Feeds used:&lt;br /&gt;      https://api.nuget.org/v3/index.json&lt;br /&gt;      C:\Program Files (x86)\Microsoft SDKs\NuGetPackages\&lt;br /&gt;Done: 0.&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;The other prompt says &lt;code&gt;"Required assets to build and debug are missing from 'WebApplication1'. Add them?"&lt;/code&gt;.  This also sounds very promising and I give it the nod.  This creates a &lt;code&gt;.vscode&lt;/code&gt; directory and 2 enclosed files; &lt;code&gt;launch.json&lt;/code&gt; and &lt;code&gt;tasks.json&lt;/code&gt;.&lt;/p&gt; &lt;p&gt;So lets try that F5 thing again... http://localhost:5000/ is now serving the same app.  That looks pretty good.  So lets add a breakpoint to the &lt;code&gt;HomeController&lt;/code&gt; and see if we can hit it:&lt;/p&gt; &lt;a href="https://3.bp.blogspot.com/-iGUm3Cz8TzE/WNqNIEYnzUI/AAAAAAAAETU/p8NxbGTzJe8Zj5MbXuivzjGlWEvUPKOygCPcB/s1600/firstgo.png" imageanchor="1" &gt;&lt;img border="0" src="https://3.bp.blogspot.com/-iGUm3Cz8TzE/WNqNIEYnzUI/AAAAAAAAETU/p8NxbGTzJe8Zj5MbXuivzjGlWEvUPKOygCPcB/s640/firstgo.png" width="640" height="347" /&gt;&lt;/a&gt; &lt;p&gt;Well I can certainly add a breakpoint but all those red squigglies are unnerving me.  Let's clean the slate.  If you want to simply do that in VS Code hold down &lt;code&gt;CTRL+SHIFT+P&lt;/code&gt; and then type "reload".  Pick "Reload window".  A couple of seconds later we're back in and Code is looking much happier.  Can we hit our breakpoint?&lt;/p&gt; &lt;a href="https://3.bp.blogspot.com/-cOJHnIO0_io/WNqNe6a_94I/AAAAAAAAETc/DXsH0wkvbgIMIrUl04k_oj-VTA5-FS9TwCLcB/s1600/secondgo.png" imageanchor="1" &gt;&lt;img border="0" src="https://3.bp.blogspot.com/-cOJHnIO0_io/WNqNe6a_94I/AAAAAAAAETc/DXsH0wkvbgIMIrUl04k_oj-VTA5-FS9TwCLcB/s640/secondgo.png" width="640" height="347" /&gt;&lt;/a&gt; &lt;p&gt;Yes we can!  So you're free to develop in either Code or VS; the choice is yours.  I think that's pretty awesome - and well done to all the peeople behind Code who've made this a pretty seamless experience!&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/23881425446803661'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/23881425446803661'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2017/03/debugging-aspnet-core-in-vs-or-code.html' title='Debugging ASP.Net Core in VS or Code'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='https://3.bp.blogspot.com/-iGUm3Cz8TzE/WNqNIEYnzUI/AAAAAAAAETU/p8NxbGTzJe8Zj5MbXuivzjGlWEvUPKOygCPcB/s72-c/firstgo.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4961533141581019570</id><published>2017-03-17T09:56:00.002Z</published><updated>2017-03-17T09:56:56.783Z</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Writing Letters That You Don't Send</title><content type='html'>work through your thoughts allows time to reflect before action if you do take action it will be considered</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4961533141581019570'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4961533141581019570'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5255457512551192764</id><published>2017-02-23T06:29:00.001Z</published><updated>2021-03-14T05:29:54.631Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='breaking changes'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='ts-loader'/><category scheme='http://www.blogger.com/atom/ns#' term='Webpack'/><title type='text'>Under the Duck: An Afternoon in Open Source</title><content type='html'>&lt;p&gt;Have you ever wondered what happens behind the scenes of open source projects? One that I'm involved with is &lt;a href="https://github.com/typestrong/ts-loader"&gt;ts-loader&lt;/a&gt;; a TypeScript loader for webpack. Yesterday was an interesting day in the life of ts-loader and webpack; things unexpectedly broke. Oh and don't worry, they're fixed now.&lt;/p&gt; &lt;p&gt;How things panned out reflects well on the webpack community. I thought it might be instructive to take a look at the legs furiously paddling underneath the duck of open source. What follows is a minute by minute account of my life on the afternoon of Wednesday 22nd February 2017:&lt;/p&gt; &lt;h5&gt;3:55pm&lt;/h5&gt; I'm sat at my desk in the City of London. I have to leave at 4pm to go to the dentist. I'm working away on a project which is built and bundled using ts-loader and webpack. However, having just npm installed and tried to spin up webpack in watch mode, I discover that everything is broken. Watch mode is not working - there's an error being thrown in ts-loader.  It's to do with a webpack property called &lt;code&gt;mtimes&lt;/code&gt;. ts-loader depends upon it and it looks like it is no longer always passed through. Go figure.   &lt;h5&gt;4:01pm&lt;/h5&gt; &lt;p&gt;I've got to go. I'm 15 minutes from Bank station. So, I grab my bag and scarper out the door. On my phone I notice &lt;a href="https://github.com/TypeStrong/ts-loader/issues/479"&gt;an issue&lt;/a&gt; has been raised - other people are being affected by the problem too.  As I trot down the various alleys that lead to the station I wonder whether I can work around this issue. Using GitHub to fork, edit code and submit a PR on a mobile phone is possible. Just.  But it's certainly not easy...&lt;/p&gt; &lt;p&gt;&lt;a href="https://github.com/TypeStrong/ts-loader/pull/481"&gt;My PR is in&lt;/a&gt;, the various test packs are starting to execute somewhere out there in Travis and Appveyor-land. Then I notice &lt;a href="https://github.com/mredbishop"&gt;Ed Bishop&lt;/a&gt; has submitted a &lt;a href="https://github.com/TypeStrong/ts-loader/pull/480"&gt;near identical PR&lt;/a&gt;. Yay Ed! I'm always keen to encourage people to contribute and so I intend to merge that PR rather than my own.&lt;/p&gt; &lt;h5&gt;16:12&lt;/h5&gt; &lt;p&gt;Rubbish. The Waterloo and City Line is out of action. I need to get across London to reach Waterloo or I'll miss my appointment. It's time to start running....&lt;/p&gt; &lt;iframe width="560" height="315" src="https://www.youtube.com/embed/4IBGernmtKA" frameborder="0" allowfullscreen&gt;&lt;/iframe&gt; &lt;h5&gt;16:15&lt;/h5&gt; &lt;p&gt;It's rather nagging at me that behaviour has changed without warning. This has been reliably in place the entire time I've been involved with ts-loader / webpack. Why now? I don't see any obvious mentions on the webpack GitHub repo. So I head over to the webpack Slack channel and ask: (conversation slightly abridged)&lt;/p&gt; &lt;blockquote&gt; &lt;h6&gt;johnny_reilly&lt;/h6&gt; &lt;p&gt;Hey all, has something happened to &lt;code&gt;mtimes&lt;/code&gt;? Behaviour seems to have changed - now undefined occasionally during watch mode. A PR has been raised against ts-loader to work around this &lt;a href="https://github.com/TypeStrong/ts-loader/pull/480#issuecomment-281714600"&gt;https://github.com/TypeStrong/ts-loader/pull/480#issuecomment-281714600&lt;/a&gt;&lt;/p&gt; &lt;p&gt;However I'm wondering if this should actually be merged given behaviour has changed unexpectedly&lt;/p&gt; &lt;h6&gt;sokra&lt;/h6&gt; &lt;p&gt;ah...&lt;/p&gt; &lt;p&gt;i removed it. I thought it was unused.&lt;/p&gt; &lt;h6&gt;johnny_reilly&lt;/h6&gt; &lt;p&gt;It's definitely not!&lt;/p&gt; &lt;h6&gt;sokra&lt;/h6&gt; &lt;p&gt;it's not in the public API^^&lt;/p&gt; &lt;p&gt;Any reason why you are not using &lt;code&gt;getTimes()&lt;/code&gt;?&lt;/p&gt; &lt;p&gt;...&lt;/p&gt; &lt;h6&gt;johnny_reilly&lt;/h6&gt; Okay, I'm on a train and won't be near a computer for a while. ts-loader is presently broken because it depends on mtimes. Would it be possible for you to add this back at least for now. I'm aware many people depend on ts-loader and are now broken.  &lt;h6&gt;sokra&lt;/h6&gt; &lt;p&gt;sure, I readd it but deprecate it.&lt;/p&gt; &lt;p&gt;...&lt;/p&gt; &lt;h6&gt;sean.larkin&lt;/h6&gt; @sokra is this the change you just made for that watchpack bug fix?  Or unlrelated, just wanted to track if I didn't already have the change/issue  &lt;h6&gt;sokra&lt;/h6&gt; &lt;p&gt;&lt;a href="https://github.com/webpack/watchpack/pull/48"&gt;https://github.com/webpack/watchpack/pull/48&lt;/a&gt;&lt;/p&gt; &lt;h6&gt;johnny_reilly&lt;/h6&gt; &lt;p&gt;This is what the present code does:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;const watcher = watching.compiler.watchFileSystem.watcher || &lt;br /&gt;                watching.compiler.watchFileSystem.wfs.watcher&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt; &lt;p&gt;And then &lt;code&gt;.mtimes&lt;/code&gt;&lt;/p&gt; &lt;p&gt;Should I be able to do &lt;code&gt;.getTimes()&lt;/code&gt; instead?&lt;/p&gt; &lt;h6&gt;sokra&lt;/h6&gt; &lt;p&gt;actually you can't rely on &lt;code&gt;watchFileSystem&lt;/code&gt; being &lt;code&gt;NodeJsWatchFileSystem&lt;/code&gt;. But this is another topic&lt;/p&gt; &lt;p&gt;...&lt;/p&gt; &lt;p&gt;but yes&lt;/p&gt; &lt;h6&gt;johnny_reilly&lt;/h6&gt; &lt;p&gt;Thanks @sokra - when I get to a keyboard I'll swap &lt;code&gt;mtimes&lt;/code&gt; for &lt;code&gt;getTimes()&lt;/code&gt; and report back.&lt;/p&gt; &lt;/blockquote&gt; &lt;h5&gt;17:28&lt;/h5&gt; &lt;p&gt;Despite various trains being out of action / missing in action I've made it to the dentists; phew!  I go in for my checkup and plan to take a look at the issue later that evening.  In the meantime I've hoping that Tobias (&lt;a href="https://twitter.com/wsokra"&gt;Sokra&lt;/a&gt;) will get chance to republish so that ts-loader users aren't too impacted.&lt;/p&gt;  &lt;h5&gt;18:00&lt;/h5&gt; &lt;p&gt;Done at the dentist and I'm heading home.  Whilst I've been opening wide and squinting at the ceiling, &lt;a href="https://blogs.msdn.microsoft.com/typescript/2017/02/22/announcing-typescript-2-2/"&gt;TypeScript 2.2 has shipped&lt;/a&gt;.  Whilst this is super exciting, according to Greenkeeper, &lt;a href="https://github.com/TypeStrong/ts-loader/pull/483"&gt;the new version has broken the build&lt;/a&gt;.  Arrrrghhhh...&lt;/p&gt; &lt;p&gt;I start to look into this and realise we're not broken because of TypeScript 2.2; we were broken because of the &lt;code&gt;mtimes&lt;/code&gt;.  Tobias has now re-added &lt;code&gt;mtimes&lt;/code&gt; and published.  With that in place I requeue a build and.... drum roll.... we're green!&lt;/p&gt; &lt;p&gt;The good news just keeps on coming as &lt;a href="https://twitter.com/bancek"&gt;Luka Zakrajek&lt;/a&gt; has submitted a &lt;a href="https://github.com/TypeStrong/ts-loader/pull/482"&gt;PR which uses &lt;code&gt;getTimes()&lt;/code&gt; in place of &lt;code&gt;mtimes&lt;/code&gt;&lt;/a&gt;.  And the tests pass.  Awesome! MERGE. I just need to cut a release and we're done.&lt;/p&gt; &lt;h5&gt;18:15&lt;/h5&gt; &lt;p&gt;I'm home. My youngest son has been suffering from chicken pox all week and as a result my wife has been in isolation, taking care of him. We chat whilst the boys watch Paw Patrol as the bath runs. I flick open the laptop and start doing the various housekeeping tasks around cutting a release.  This is interrupted by various bathtime / bedtime activities and I abandon work for now.&lt;/p&gt; &lt;h5&gt;19:30&lt;/h5&gt; &lt;p&gt;The boys are down and I get on with the release; updating the changelog, bumping the version number and running the tests.  For various reasons this takes longer than it normally does.&lt;/p&gt; &lt;h5&gt;20:30&lt;/h5&gt; &lt;p&gt;Finally we're there; ts-loader 2.0.1 ships: &lt;a href="https://github.com/TypeStrong/ts-loader/releases/tag/v2.0.1"&gt;https://github.com/TypeStrong/ts-loader/releases/tag/v2.0.1&lt;/a&gt;.&lt;/p&gt; &lt;p&gt;I'm tremendously grateful to everyone that helped out - thank you all!&lt;/p&gt; &lt;blockquote class="twitter-tweet" data-lang="en"&gt;&lt;p lang="en" dir="ltr"&gt;ts-loader 2.0.1 has shipped; thanks &lt;a href="https://twitter.com/wSokra"&gt;@wsokra&lt;/a&gt; &lt;a href="https://twitter.com/bancek"&gt;@bancek&lt;/a&gt; and @mredbishop &lt;a href="https://t.co/I00c7sJyFo"&gt;https://t.co/I00c7sJyFo&lt;/a&gt; &lt;a href="https://twitter.com/hashtag/typescript?src=hash"&gt;#typescript&lt;/a&gt;&lt;/p&gt;&amp;mdash; John Reilly (@johnny_reilly) &lt;a href="https://twitter.com/johnny_reilly/status/834515296077627392"&gt;February 22, 2017&lt;/a&gt;&lt;/blockquote&gt;&lt;script async src="//platform.twitter.com/widgets.js" charset="utf-8"&gt;&lt;/script&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5255457512551192764'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5255457512551192764'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2017/02/under-duck-afternoon-in-open-source.html' title='Under the Duck: An Afternoon in Open Source'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='https://i.ytimg.com/vi/4IBGernmtKA/default.jpg' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2864373212604540243</id><published>2017-02-14T20:52:00.000Z</published><updated>2017-02-14T20:52:35.719Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>@types is rogue</title><content type='html'>&lt;p&gt;Or perhaps I should call this "@types and repeatable builds"....&lt;/p&gt; &lt;p&gt;The other day, on a React / TypeScript project I work on, the nightly CI build started failing.  But nothing had changed in the project...  What gives?  After digging I discovered the reason; spome of the type definitions which my project depends upon had changed.  Why did this break my build?  Lets learn some more...&lt;/p&gt; &lt;p&gt;We acquire type definitions via npm.  Type definitions from Definitely Typed are published to npm by an &lt;a href="https://github.com/Microsoft/types-publisher"&gt;automated process&lt;/a&gt; and they are all published under the @types namespace on npm.  So, the &lt;a href="https://www.npmjs.com/package/react"&gt;react type definition&lt;/a&gt; is published as the &lt;a href="https://www.npmjs.com/package/@types/react"&gt;@types/react&lt;/a&gt; package, the node type definition is published as the &lt;a href="https://www.npmjs.com/package/@types/node"&gt;@types/node&lt;/a&gt; package.  The hip bone's connected to the thigh bone. You get the picture.&lt;/p&gt; &lt;p&gt;The npm ecosystem is essentially built on top of &lt;a href="http://semver.org/"&gt;semantic versioning&lt;/a&gt; and they &lt;a href="https://docs.npmjs.com/getting-started/semantic-versioning"&gt;take it seriously&lt;/a&gt;.  Essentially, when a package is published it should be categorised as a major release (breaking changes), a minor release (extra functionality which is backwards compatible) or a patch release (backwards compatible bug fixes).&lt;/p&gt; &lt;p&gt;Now we get to the meat of the matter: @types is rogue. You cannot trust the version numbers on @types packages to respect semantic versioning.  They don't.&lt;/p&gt; &lt;p&gt;The main reason for this is that when it comes to versioning, the @types type definition essentially looks to mirror the version of the package they are seeking to type.  &lt;em&gt;THIS MEANS THE TYPE DEFINITION CANNOT DO ITS OWN SEMANTIC VERSIONING.&lt;/em&gt;  A simple change in a type definition can lead to breakages in consuming code.  That's what happened to me.  Let's say an exported interface name changes; all code that relies upon the old name will now break.  You see?  Pain.&lt;/p&gt; &lt;h4&gt;How do we respond to this?&lt;/h4&gt; &lt;p&gt;My own take has been to pin the version numbers of @types packages; fixing to specific definitions.  No &lt;code&gt;"~"&lt;/code&gt; or &lt;code&gt;"^"&lt;/code&gt; for my &lt;code&gt;@types devDependencies&lt;/code&gt;.&lt;/p&gt; &lt;p&gt;No respect semantic versioning?  No problem.  You can go much further with repeatable builds and made use of &lt;a href="https://code.facebook.com/posts/1840075619545360"&gt;facebook's new npm client yarn&lt;/a&gt; and &lt;a href="https://yarnpkg.com/blog/2016/11/24/lockfiles-for-all/"&gt;lockfiles&lt;/a&gt; (very popular BTW) but I haven't felt the need yet.  This should be ample for now.&lt;/p&gt; &lt;p&gt;The other question that may be nagging at your subconscious is this: whats an easy way to know when new packages are available for my project dependencies?  Well, the &lt;code&gt;Get-Package -Updates&lt;/code&gt; (nuget hat tip) for npm that Id recommend is this: &lt;a href="https://www.npmjs.com/package/npm-check-updates"&gt;npm-check-updates&lt;/a&gt;.  It does the job wonderfully.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2864373212604540243'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2864373212604540243'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2017/02/typescript-types-and-repeatable-builds.html' title='@types is rogue'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6469934495979948821</id><published>2017-02-01T06:49:00.000Z</published><updated>2017-02-01T06:49:59.100Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='TLS'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='free'/><category scheme='http://www.blogger.com/atom/ns#' term='HTTPS'/><category scheme='http://www.blogger.com/atom/ns#' term='CloudFlare'/><category scheme='http://www.blogger.com/atom/ns#' term='Troy Hunt'/><title type='text'>Hands-free HTTPS</title><content type='html'>&lt;p&gt;I have had a *&lt;strong&gt;great&lt;/strong&gt;* week.  You? Take a look at this blog. Can you see what I can see? Here's a clue:&lt;/p&gt; &lt;a href="https://3.bp.blogspot.com/-kGUtF6RJR-s/WI4BUnWu4qI/AAAAAAAABDE/8wOD9eHikMwQz5envUcg1tpHXxcJzegngCPcB/s1600/Screenshot%2B2017-01-29%2B14.45.57.png" imageanchor="1" &gt;&lt;img border="0" src="https://3.bp.blogspot.com/-kGUtF6RJR-s/WI4BUnWu4qI/AAAAAAAABDE/8wOD9eHikMwQz5envUcg1tpHXxcJzegngCPcB/s640/Screenshot%2B2017-01-29%2B14.45.57.png" width="640" height="428" /&gt;&lt;/a&gt; &lt;p&gt;Yup, look at the top left hand corner.... see that beautiful padlock? Yeah - that's what's thrilled me.  You see I have a dream; that one day on the red hills of the internet, the sons of former certificates and the sons of former certificate authorities will be able to sit down together at the table of HTTPS. Peace, love and TLS for all.&lt;/p&gt; &lt;p&gt;The world is turning and slowly but surely HTTPS is becoming the default of the web.  &lt;a href="https://security.googleblog.com/2014/08/https-as-ranking-signal_6.html"&gt;Search results get ranked higher if they're HTTPS.&lt;/a&gt; &lt;a href="https://en.wikipedia.org/wiki/HTTP/2#Encryption"&gt;HTTP/2 is, to all intents and purposes, a HTTPS-only game.&lt;/a&gt; &lt;a href="https://developer.mozilla.org/en/docs/Web/API/Service_Worker_API"&gt;Service Workers are HTTPS-only.&lt;/a&gt;&lt;/p&gt; &lt;p&gt;I care about all of these.  So it's &lt;em&gt;essential&lt;/em&gt; that I have HTTPS. But. But. But... Certificates, the administration that goes with them.  It's boring.  I mean, it just is.  I want to be building interesting apps, I don't want to be devoting my time to acquiring certificates and fighting my way through the (never simple) administration of them.  I'm dimly aware that there's free certificates to be had thanks to the fine work of &lt;a href="https://letsencrypt.org/"&gt;LetsEncrypt&lt;/a&gt;.  I believe that work is being done on reduce the onerous admin burden as well.  And that's great.  But I'm still avoiding it...&lt;/p&gt; &lt;p&gt;What if I told you you could have HTTPS on your blog, on your Azure websites, on your anywhere.... &lt;em&gt;FOR FREE.  IN FIVE MINUTES?&lt;/em&gt;. Well, you can thanks to &lt;a href="https://www.cloudflare.com/"&gt;CloudFlare&lt;/a&gt;.  I did; you should too.&lt;/p&gt; &lt;p&gt;This is where I point you off to a number of resources to help you on your HTTPS way:&lt;/p&gt; &lt;ol&gt;&lt;li&gt;&lt;a href="https://www.troyhunt.com/how-to-get-your-ssl-for-free-on-shared/"&gt;Read Troy Hunt's "How to get your SSL for free on a Shared Azure website with CloudFlare"&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="https://www.pluralsight.com/courses/cloudflare-security-getting-started"&gt;Watch Troy Hunt's Pluralsight course "Getting Started with CloudFlare Security"&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="https://www.cloudflare.com/"&gt;Go to Cloudflare's website and sign up&lt;/a&gt;&lt;/li&gt;&lt;/ol&gt; &lt;p&gt;It just works.  And that makes me very happy indeed.&lt;/p&gt; </content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/6469934495979948821'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/6469934495979948821'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2017/02/hands-free-https.html' title='Hands-free HTTPS'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='https://3.bp.blogspot.com/-kGUtF6RJR-s/WI4BUnWu4qI/AAAAAAAABDE/8wOD9eHikMwQz5envUcg1tpHXxcJzegngCPcB/s72-c/Screenshot%2B2017-01-29%2B14.45.57.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8226529230366598666</id><published>2017-01-11T09:46:00.001Z</published><updated>2017-01-11T09:46:01.847Z</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>marcus</title><content type='html'>Hey Marcus,  Happy new year!  Just thought I'd drop you a line to see how you were doing.    Tony mentioned that you'd finally parted ways with Pantheon once again.  I've no idea what the circumstances were for you but in case it was relevant I wanted relate my own experience.  I was properly down when I was effectively shown the door in summer.  It really got to me; partly pride I expect.  No-one had ever not wanted my services to continue before.    That said, I was really unhappy during my second stint at Pantheon.  I felt like I was trying to do good stuff and it wasn't appreciated.  I felt I was trying to highlight problems and the act of doing that was a problem in itself.  In the end that fed into my behaviour and led to some of my unfortunate interactions.  Long story short: I felt like a square peg in a round hole and by the time of my departure I was completely battered and deflated.  I'm pretty sure that showed.  Anyway, what I'm trying to say is: if you're feeling down right now, don't.  Or at least know that it will pass.  I went on to land some really interesting work with some really fun people.  I'm really enjoying it and I now rather regard Pantheon Round II as an unfortunate mistake.  Well, not entirely a mistake in that I learned from it.  But certainly something I never intend to repeat.  You're probably in a much better place than I was then.  I'm sure you handled yourself better than I did towards the end.  But in case you were a bit down I wanted to say: don't worry.  Life outside Pantheon is much better than life inside. That's certainly been true for me and I've no doubt it will be for you as well.  So if you need it, chin up!  And if not, all the better!  I hope life is treating you well.  John</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8226529230366598666'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8226529230366598666'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-735795429294214059</id><published>2017-01-06T19:30:00.001Z</published><updated>2021-03-04T06:02:50.694Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='enhanced-resolve'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Webpack'/><category scheme='http://www.blogger.com/atom/ns#' term='query'/><category scheme='http://www.blogger.com/atom/ns#' term='options'/><title type='text'>webpack: resolveLoader / alias with query / options</title><content type='html'>&lt;p&gt;Sometimes you write a post for the ages. Sometimes you write one you hope is out of date before you hit "publish".  This is one of those.&lt;/p&gt; &lt;p&gt;There's a &lt;a href="https://github.com/webpack/enhanced-resolve/issues/41"&gt;bug&lt;/a&gt; in webpack's enhanced-resolve.  It means that you cannot configure an aliased loader using the &lt;code&gt;query&lt;/code&gt; (or &lt;code&gt;options&lt;/code&gt; in the webpack 2 nomenclature). Let me illustrate; consider the following code:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;module.exports = {&lt;br /&gt;  // ...&lt;br /&gt;  module: {&lt;br /&gt;    loaders: [&lt;br /&gt;      {&lt;br /&gt;        test: /\.ts$/,&lt;br /&gt;        loader: 'ts-loader',&lt;br /&gt;        query: {&lt;br /&gt;            entryFileIsJs: true&lt;br /&gt;        }&lt;br /&gt;      }&lt;br /&gt;    ]&lt;br /&gt;  }&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;module.exports.resolveLoader = { alias: { 'ts-loader': require('path').join(__dirname, "../../index.js") &lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;At the time of writing, if you alias a loader as above, then the &lt;code&gt;query&lt;/code&gt; / &lt;code&gt;options&lt;/code&gt; will *&lt;em&gt;not&lt;/em&gt;* be passed along. This is bad, particularly given the requirement in webpack 2 that configuration is no longer possible through extending the &lt;a href="https://webpack.js.org/guides/migrating/#loader-configuration-is-through-options"&gt;&lt;code&gt;webpack.config.js&lt;/code&gt;&lt;/a&gt;. So what to do?  Well, when this was a problem previously the marvellous &lt;a href="https://www.twitter.com/jbrantly"&gt;James Brantly&lt;/a&gt; had a &lt;a href="https://github.com/webpack/webpack/issues/1289#issuecomment-125767499"&gt;workaround&lt;/a&gt;.  I've taken that and run with it:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;var config = {&lt;br /&gt;  // ...&lt;br /&gt;  module: {&lt;br /&gt;    loaders: [&lt;br /&gt;      {&lt;br /&gt;        test: /\.ts$/,&lt;br /&gt;        loader: 'ts-loader',&lt;br /&gt;        query: {&lt;br /&gt;          entryFileIsJs: true&lt;br /&gt;        }&lt;br /&gt;      }&lt;br /&gt;    ]&lt;br /&gt;  }&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;module.exports = config;&lt;br /&gt;&lt;br /&gt;var loaderAliasPath = require('path').join(__dirname, "../../../index.js");&lt;br /&gt;var rules = config.module.loaders || config.module.rules;&lt;br /&gt;rules.forEach(function(rule) {&lt;br /&gt;  var options = rule.query || rule.options;&lt;br /&gt;  rule.loader = rule.loader.replace('ts-loader', loaderAliasPath + (options ? '?' + JSON.stringify(options) : ''));&lt;br /&gt;});&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;This approach stringifies the &lt;code&gt;query&lt;/code&gt; / &lt;code&gt;options&lt;/code&gt; and suffixes it to the aliased path.  This works as long as the options you're passing are JSON-able (yes it's a word).&lt;/p&gt; &lt;p&gt;As I said earlier; hopefully by the time you read this the workaround will no longer be necessary again.  But just in case....&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/735795429294214059'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/735795429294214059'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2017/01/webpack-resolveloader-alias-with-query.html' title='webpack: resolveLoader / alias with query / options'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5471338151558102484</id><published>2017-01-01T08:28:00.001Z</published><updated>2021-03-04T06:04:27.095Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='webpack 2'/><category scheme='http://www.blogger.com/atom/ns#' term='Webpack'/><category scheme='http://www.blogger.com/atom/ns#' term='query'/><category scheme='http://www.blogger.com/atom/ns#' term='options'/><title type='text'>webpack: configuring a loader with query / options</title><content type='html'>&lt;p&gt;&lt;a href="https://medium.com/webpack/webpack-2-2-the-release-candidate-2e614d05d75f#.ntniu44u6"&gt;webpack 2 is on it's way&lt;/a&gt;. As one of the maintainers of &lt;a href="https://github.com/TypeStrong/ts-loader/"&gt;ts-loader&lt;/a&gt; I've been checking out that ts-loader works with webpack 2.  It does: phew!&lt;/p&gt; &lt;p&gt;ts-loader has a continuous integration build that runs against webpack 1.  When webpack 2 ships we're planning to move to running CI against webpack 2. However, webpack 2 has some breaking changes. The one that's particularly of relevance to our test packs is that a strict schema is now enforced for &lt;code&gt;webpack.config.js&lt;/code&gt; with webpack 2. This has been the case since webpack 2 hit beta 23.  Check the &lt;a href="https://github.com/webpack/webpack/pull/2974"&gt;PR that added it&lt;/a&gt;.  You can see some of the &lt;a href="https://github.com/webpack/webpack/issues/3018"&gt;frankly tortured discussion that this generated as well&lt;/a&gt;.&lt;/p&gt; &lt;p&gt;Let's all take a moment and realise that working on open source is sometimes a rather painful experience.  Take a breath. Breathe out.  Ready to carry on? Great.&lt;/p&gt; &lt;p&gt;There are 2 ways to configure loader options for ts-loader (and in fact this stands for most loaders). Loader options can be set either using a &lt;code&gt;query&lt;/code&gt; when specifying the loader or through the &lt;code&gt;ts&lt;/code&gt; (insert the name of alternative loaders here) property in the &lt;code&gt;webpack.config.js&lt;/code&gt;.&lt;/p&gt; &lt;p&gt;The implicatations of the breaking change are: with webpack 2 you can &lt;strong&gt;no longer&lt;/strong&gt; configure ts-loader (or any other loader) with a &lt;code&gt;ts&lt;/code&gt; (insert the name of alternative loaders here) property in the &lt;code&gt;webpack.config.js&lt;/code&gt;.  It &lt;strong&gt;must&lt;/strong&gt; be done through the &lt;code&gt;query&lt;/code&gt; / &lt;code&gt;options&lt;/code&gt;.  The following code is no longer valid with webpack 2:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;module.exports = {&lt;br /&gt;  ...&lt;br /&gt;  module: {&lt;br /&gt;    loaders: [{&lt;br /&gt;      test: /\.tsx?$/,&lt;br /&gt;      loader: 'ts-loader' &lt;br /&gt;    }]&lt;br /&gt;  },&lt;br /&gt;  // specify option using `ts` property - **only do this if you are using webpack 1**&lt;br /&gt;  ts: {&lt;br /&gt;    transpileOnly: false&lt;br /&gt;  }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;This change means that we have needed to adjust how our test pack works.  We can no longer make use of &lt;code&gt;ts&lt;/code&gt; for configuration.  Since I wasn't terribly aware of &lt;code&gt;query&lt;/code&gt; I thought it made sense to share my learnings.&lt;/p&gt; &lt;h4&gt;What exactly is &lt;code&gt;query&lt;/code&gt; / &lt;code&gt;options&lt;/code&gt;?&lt;/h4&gt; &lt;p&gt;Good question. Well, strictly speaking it's 2 possible things; both ways to configure a webpack loader.  Classically &lt;code&gt;query&lt;/code&gt; was a string which could be appended to the name of the loader much like a &lt;code&gt;&lt;a href="https://en.wikipedia.org/wiki/Query_string"&gt;query string&lt;/a&gt;&lt;/code&gt; but actually with &lt;a href="https://github.com/webpack/loader-utils#parsequery"&gt;greater powers&lt;/a&gt;:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;module.exports = {&lt;br /&gt;  ...&lt;br /&gt;  module: {&lt;br /&gt;    loaders: [{ &lt;br /&gt;      test: /\.tsx?$/,&lt;br /&gt;      loader: 'ts-loader?' + JSON.stringify({&lt;br /&gt;        transpileOnly: false&lt;br /&gt;      })&lt;br /&gt;    }]&lt;br /&gt;  }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;But it can also be a separately specified object that's supplied alongside a loader (I understand this is relatively new behaviour):&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;module.exports = {&lt;br /&gt;  ...&lt;br /&gt;  module: {&lt;br /&gt;    loaders: [{ &lt;br /&gt;      test: /\.tsx?$/,&lt;br /&gt;      loader: 'ts-loader'&lt;br /&gt;      query: {&lt;br /&gt;        transpileOnly: false&lt;br /&gt;      }&lt;br /&gt;    }]&lt;br /&gt;  }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;h4&gt;webpack 2 is coming - look busy!&lt;/h4&gt; &lt;p&gt;So if you're planning to move to webpack 2, be aware of this breaking change.  You can start moving to using configuration via query right now with webpack 1. You don't need to be using webpack 2 to make the jump.  So jump!&lt;/p&gt; &lt;p&gt;Finally, and by way of a PS, &lt;code&gt;query&lt;/code&gt; is renamed to &lt;code&gt;options&lt;/code&gt; in webpack 2; a much better name to my mind.  There's actually a bunch of other renames on the way as well - check out the &lt;a href="https://webpack.js.org/guides/migrating/#module-loaders-is-now-module-rules"&gt;migration guide&lt;/a&gt; for more on this. The important thing to note is that &lt;strong&gt;the old names work in webpack 2&lt;/strong&gt;. But you should plan to move to the new naming at some point as they'll likely disappear when webpack 3 ships.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5471338151558102484'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5471338151558102484'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2017/01/webpack-configuring-loader-with-query.html' title='webpack: configuring a loader with query / options'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3589344403007981324</id><published>2016-12-19T06:09:00.001Z</published><updated>2021-03-04T06:07:54.536Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='ts-loader'/><category scheme='http://www.blogger.com/atom/ns#' term='webpack 2'/><title type='text'>Using ts-loader with webpack 2</title><content type='html'>&lt;p&gt;Hands up, despite being one of the maintainers of &lt;a href="https://github.com/TypeStrong/ts-loader"&gt;ts-loader&lt;/a&gt; (a TypeScript loader for webpack) I have not been tracking webpack v2. My reasons?  Well, I'm keen on cutting edge but bleeding edge is often not a ton of fun as dealing with regularly breaking changes is frustrating.  I'm generally happy to wait for things to settle down a bit before leaping aboard.  However, &lt;a href="https://github.com/webpack/webpack/releases/tag/v2.2.0-rc.0"&gt;webpack 2 RC'd last week&lt;/a&gt; and so it's time to take a look!&lt;/p&gt; &lt;h4&gt;Porting our example&lt;/h4&gt; &lt;p&gt;Let's take &lt;a href="https://github.com/TypeStrong/ts-loader/tree/master/examples/webpack1-gulp-react-flux-babel-karma"&gt;ts-loader's webpack 1 example&lt;/a&gt; and try and port it to webpack 2.  Will it work?  Probably; I'm aware of other people using ts-loader with webpack 2.  It'll be a voyage of discovery.  Like Darwin on the Beagle, I shall document our voyage for a couple of reasons:&lt;/p&gt; &lt;ul&gt;&lt;li&gt;I'm probably going to get some stuff wrong.  That's fine; one of the best ways to learn is to make mistakes. So do let me know where I go wrong.&lt;/li&gt;&lt;li&gt;I'm doing this based on what I've read in the new docs; they're very much a work in progress and the mistakes I make here may lead to those docs improving even more.  That matters; &lt;strong&gt;documentation matters&lt;/strong&gt;.  I'll be leaning heavily on the &lt;a href="https://webpack.js.org/guides/migrating/"&gt;Migrating from v1 to v2&lt;/a&gt; guide.&lt;/li&gt;&lt;/ul&gt; &lt;p&gt;So here we go.  Our example is one which uses TypeScript for static typing and uses Babel to transpile from ES-super-modern (yes - it's a thing) to ES-older-than-that.  Our example also uses React; but that's somewhat incidental.  It only uses webpack for typescript / javascript and karma.  It uses gulp to perform various other tasks; so if you're reliant on webpack for less / sass compilation etc then I have no idea whether that works.&lt;/p&gt; &lt;p&gt;First of all, let's install the latest RC of webpack:&lt;/p&gt; &lt;pre class="prettyprint"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;npm install webpack@2.2.0-rc.1 --save-dev&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;h4&gt;&lt;code&gt;webpack.config.js&lt;/code&gt;&lt;/h4&gt; &lt;p&gt;Let's look at our existing &lt;code&gt;webpack.config.js&lt;/code&gt;:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;'use strict';&lt;br /&gt;&lt;br /&gt;var path = require('path');&lt;br /&gt;&lt;br /&gt;module.exports = {&lt;br /&gt;  cache: true,&lt;br /&gt;  entry: {&lt;br /&gt;    main: './src/main.tsx',&lt;br /&gt;    vendor: [&lt;br /&gt;      'babel-polyfill',&lt;br /&gt;      'fbemitter',&lt;br /&gt;      'flux',&lt;br /&gt;      'react',&lt;br /&gt;      'react-dom'&lt;br /&gt;    ]&lt;br /&gt;  },&lt;br /&gt;  output: {&lt;br /&gt;    path: path.resolve(__dirname, './dist/scripts'),&lt;br /&gt;    filename: '[name].js',&lt;br /&gt;    chunkFilename: '[chunkhash].js'&lt;br /&gt;  },&lt;br /&gt;  module: {&lt;br /&gt;    loaders: [{&lt;br /&gt;      test: /\.ts(x?)$/,&lt;br /&gt;      exclude: /node_modules/,&lt;br /&gt;      loader: 'babel-loader?presets[]=es2016&amp;presets[]=es2015&amp;presets[]=react!ts-loader'&lt;br /&gt;    }, {&lt;br /&gt;      test: /\.js$/,&lt;br /&gt;      exclude: /node_modules/,&lt;br /&gt;      loader: 'babel',&lt;br /&gt;      query: {&lt;br /&gt;        presets: ['es2016', 'es2015', 'react']&lt;br /&gt;      }&lt;br /&gt;    }]&lt;br /&gt;  },&lt;br /&gt;  plugins: [&lt;br /&gt;  ],&lt;br /&gt;  resolve: {&lt;br /&gt;    extensions: ['', '.webpack.js', '.web.js', '.ts', '.tsx', '.js']&lt;br /&gt;  },&lt;br /&gt;};&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;There's a number of things we need to do here. First of all, we can get rid of the empty extension under resolve; I understand that's unnecessary now.  Also, I'm going to get rid of &lt;code&gt;'.webpack.js'&lt;/code&gt; and &lt;code&gt;'.web.js'&lt;/code&gt;; I never used them anyway.  Also, just having &lt;code&gt;'babel'&lt;/code&gt; as a loader won't fly anymore. We need that suffix as well.&lt;/p&gt; &lt;p&gt;Now I could start renaming &lt;code&gt;loaders&lt;/code&gt; to &lt;code&gt;rules&lt;/code&gt; as the terminology is changing.  But I'd like to deal with that later since I know the old school names are still supported at present.  More interestingly, I seem to remember hearing that one of the super exciting things about webpack is that it supports modules directly now.  (I think that's supposed to be good for tree-shaking but I'm not totally certain.)&lt;/p&gt; &lt;p&gt;Initially I thought I was supposed to switch to a custom babel preset called &lt;code&gt;&lt;a href="https://www.npmjs.com/package/babel-preset-es2015-webpack"&gt;babel-preset-es2015-webpack&lt;/a&gt;&lt;/code&gt;.  However it has a big "DEPRECATED" mark at the top and it says I should just use &lt;code&gt;babel-preset-es2015&lt;/code&gt; (which I already am) with the following option specified:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;{&lt;br /&gt;    "presets": [&lt;br /&gt;        [&lt;br /&gt;            "es2015",&lt;br /&gt;            {&lt;br /&gt;                "modules": false&lt;br /&gt;            }&lt;br /&gt;        ]&lt;br /&gt;    ]&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Looking at our existing config you'll note that for &lt;code&gt;js&lt;/code&gt; files we're using &lt;code&gt;query&lt;/code&gt; (&lt;code&gt;options&lt;/code&gt; in the new world I understand) to configure babel usage.  We're using &lt;a href="https://webpack.github.io/docs/using-loaders.html#query-parameters"&gt;query parameters&lt;/a&gt; for &lt;code&gt;ts&lt;/code&gt; files.  I have &lt;em&gt;zero&lt;/em&gt; idea how to configure preset options using query parameters.  Fiddling with &lt;code&gt;query&lt;/code&gt; / &lt;code&gt;options&lt;/code&gt; didn't seem to work.  So, I've decided to abandon using query entirely and drop in a &lt;code&gt;&lt;a href="http://babeljs.io/docs/usage/babelrc/"&gt;.babelrc&lt;/a&gt;&lt;/code&gt; file using our presets combined with the &lt;code&gt;&lt;a href="https://babeljs.io/docs/plugins/#plugin-preset-options"&gt;modules&lt;/a&gt;&lt;/code&gt; setting:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;{&lt;br /&gt;   "presets": [&lt;br /&gt;      "react", &lt;br /&gt;      [&lt;br /&gt;         "es2015",&lt;br /&gt;         {&lt;br /&gt;            "modules": false&lt;br /&gt;         }&lt;br /&gt;      ],&lt;br /&gt;      "es2016"&lt;br /&gt;   ]&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;As an aside; apparently these are applied in reverse order. So &lt;code&gt;es2016&lt;/code&gt; is applied first, &lt;code&gt;es2015&lt;/code&gt; second and &lt;code&gt;react&lt;/code&gt; third.  I'm not totally certain this is correct; the &lt;code&gt;&lt;a href="http://babeljs.io/docs/usage/babelrc/"&gt;.babelrc&lt;/a&gt; docs&lt;/code&gt; are a little unclear.&lt;/p&gt; &lt;p&gt;With our query options extracted we're down to a simpler &lt;code&gt;webpack.config.js&lt;/code&gt;:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;'use strict';&lt;br /&gt;&lt;br /&gt;var path = require('path');&lt;br /&gt;&lt;br /&gt;module.exports = {&lt;br /&gt;  cache: true,&lt;br /&gt;  entry: {&lt;br /&gt;    main: './src/main.tsx',&lt;br /&gt;    vendor: [&lt;br /&gt;      'babel-polyfill',&lt;br /&gt;      'fbemitter',&lt;br /&gt;      'flux',&lt;br /&gt;      'react',&lt;br /&gt;      'react-dom'&lt;br /&gt;    ]&lt;br /&gt;  },&lt;br /&gt;  output: {&lt;br /&gt;    path: path.resolve(__dirname, './dist/scripts'),&lt;br /&gt;    filename: '[name].js',&lt;br /&gt;    chunkFilename: '[chunkhash].js'&lt;br /&gt;  },&lt;br /&gt;  module: {&lt;br /&gt;    loaders: [{&lt;br /&gt;      test: /\.ts(x?)$/,&lt;br /&gt;      exclude: /node_modules/,&lt;br /&gt;      loader: 'babel-loader!ts-loader'&lt;br /&gt;    }, {&lt;br /&gt;      test: /\.js$/,&lt;br /&gt;      exclude: /node_modules/,&lt;br /&gt;      loader: 'babel-loader'&lt;br /&gt;    }]&lt;br /&gt;  },&lt;br /&gt;  plugins: [&lt;br /&gt;  ],&lt;br /&gt;  resolve: {&lt;br /&gt;    extensions: ['.ts', '.tsx', '.js']&lt;br /&gt;  },&lt;br /&gt;};&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;h4&gt;&lt;code&gt;plugins&lt;/code&gt;&lt;/h4&gt; &lt;p&gt;In our example the &lt;code&gt;plugins&lt;/code&gt; section of our &lt;code&gt;webpack.config.js&lt;/code&gt; is extended in a separate process.  Whilst we're developing we also set the &lt;code&gt;debug&lt;/code&gt; flag to be &lt;code&gt;true&lt;/code&gt;.  &lt;a href="https://webpack.js.org/guides/migrating/#debug"&gt;It seems we need to introduce a &lt;code&gt;LoaderOptionsPlugin&lt;/code&gt; to do this for us.&lt;/a&gt;&lt;/p&gt; &lt;p&gt;As we introduce our &lt;code&gt;LoaderOptionsPlugin&lt;/code&gt; we also need to make sure that we provide it with &lt;code&gt;options&lt;/code&gt;.  How do I know this?  Well &lt;a href="https://github.com/TypeStrong/ts-loader/issues/283"&gt;someone raised an issue against ts-loader&lt;/a&gt;.  I don't think this is actually an issue with ts-loader; I think it's just a webpack 2 thing.  I could be wrong; answers on a postcard please.&lt;/p&gt; &lt;p&gt;Either way, to get up and running we just need the &lt;code&gt;LoaderOptionsPlugin&lt;/code&gt; in play.  Consequently, most of what follows in our &lt;code&gt;webpack.js&lt;/code&gt; file is unchanged:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;// .....&lt;br /&gt;&lt;br /&gt;var webpackConfig = require('../webpack.config.js');&lt;br /&gt;var packageJson = require('../package.json');&lt;br /&gt;&lt;br /&gt;// .....&lt;br /&gt;&lt;br /&gt;function buildProduction(done) {&lt;br /&gt;&lt;br /&gt;   // .....&lt;br /&gt;&lt;br /&gt;   myProdConfig.plugins = myProdConfig.plugins.concat(&lt;br /&gt;      // .....&lt;br /&gt;&lt;br /&gt;      // new webpack.optimize.DedupePlugin(), Not a thing anymore apparently&lt;br /&gt;      new webpack.optimize.UglifyJsPlugin(),&lt;br /&gt;&lt;br /&gt;      // I understand this here matters...&lt;br /&gt;      // but it doesn't seem to make any difference; perhaps I'm missing something?&lt;br /&gt;      new webpack.LoaderOptionsPlugin({&lt;br /&gt;        minimize: true,&lt;br /&gt;        debug: false&lt;br /&gt;      }),&lt;br /&gt;&lt;br /&gt;      failPlugin&lt;br /&gt;   );&lt;br /&gt;&lt;br /&gt;   // .....&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;function createDevCompiler() {&lt;br /&gt;   var myDevConfig = webpackConfig;&lt;br /&gt;   myDevConfig.devtool = 'inline-source-map';&lt;br /&gt;   // myDevConfig.debug = true; - not allowed in webpack 2&lt;br /&gt;&lt;br /&gt;   myDevConfig.plugins = myDevConfig.plugins.concat(&lt;br /&gt;      new webpack.optimize.CommonsChunkPlugin({ name: 'vendor', filename: 'vendor.js' }),&lt;br /&gt;      new WebpackNotifierPlugin({ title: 'Webpack build', excludeWarnings: true }),&lt;br /&gt;&lt;br /&gt;      // this is the Webpack 2 hotness!&lt;br /&gt;      new webpack.LoaderOptionsPlugin({&lt;br /&gt;         debug: true,&lt;br /&gt;         options: myDevConfig&lt;br /&gt;      })&lt;br /&gt;      // it ends here - there wasn't much really....&lt;br /&gt;&lt;br /&gt;   );&lt;br /&gt;&lt;br /&gt;   // create a single instance of the compiler to allow caching&lt;br /&gt;   return webpack(myDevConfig);&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;// .....&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;h4&gt;&lt;code&gt;LoaderOptionsPlugin&lt;/code&gt; we hardly new ya&lt;/h4&gt; &lt;p&gt;After a little more experimentation it seems that the &lt;code&gt;LoaderOptionsPlugin&lt;/code&gt; is not necessary at all for our own use case.  In fact it's probably not best practice to get used to using it as it's only intended to live a short while whilst people move from webpack 1 to webpack 2.  In that vein let's tweak our &lt;code&gt;webpack.js&lt;/code&gt; file once more:&lt;/p&gt;  &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;function buildProduction(done) {&lt;br /&gt;&lt;br /&gt;   // .....&lt;br /&gt;&lt;br /&gt;   myProdConfig.plugins = myProdConfig.plugins.concat(&lt;br /&gt;      // .....&lt;br /&gt;&lt;br /&gt;      new webpack.optimize.UglifyJsPlugin({&lt;br /&gt;         compress: {&lt;br /&gt;            warnings: true&lt;br /&gt;         }&lt;br /&gt;      }),&lt;br /&gt;&lt;br /&gt;      failPlugin&lt;br /&gt;   );&lt;br /&gt;&lt;br /&gt;   // .....&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;function createDevCompiler() {&lt;br /&gt;   var myDevConfig = webpackConfig;&lt;br /&gt;   myDevConfig.devtool = 'inline-source-map';&lt;br /&gt;&lt;br /&gt;   myDevConfig.plugins = myDevConfig.plugins.concat(&lt;br /&gt;      new webpack.optimize.CommonsChunkPlugin({ name: 'vendor', filename: 'vendor.js' }),&lt;br /&gt;      new WebpackNotifierPlugin({ title: 'Webpack build', excludeWarnings: true }),&lt;br /&gt;   );&lt;br /&gt;&lt;br /&gt;   // create a single instance of the compiler to allow caching&lt;br /&gt;   return webpack(myDevConfig);&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;// .....&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;h4&gt;&lt;code&gt;karma.conf.js&lt;/code&gt;&lt;/h4&gt; &lt;p&gt;Finally Karma. Our &lt;code&gt;karma.conf.js&lt;/code&gt; with webpack 1 looked like this:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;/* eslint-disable no-var, strict */&lt;br /&gt;'use strict';&lt;br /&gt;&lt;br /&gt;var webpackConfig = require('./webpack.config.js');&lt;br /&gt;&lt;br /&gt;module.exports = function(config) {&lt;br /&gt;  // Documentation: https://karma-runner.github.io/0.13/config/configuration-file.html&lt;br /&gt;  config.set({&lt;br /&gt;    browsers: [ 'PhantomJS' ],&lt;br /&gt;&lt;br /&gt;    files: [&lt;br /&gt;      // This ensures we have the es6 shims in place and then loads all the tests&lt;br /&gt;      'test/main.js'&lt;br /&gt;    ],&lt;br /&gt;&lt;br /&gt;    port: 9876,&lt;br /&gt;&lt;br /&gt;    frameworks: [ 'jasmine' ],&lt;br /&gt;&lt;br /&gt;    logLevel: config.LOG_INFO, //config.LOG_DEBUG&lt;br /&gt;&lt;br /&gt;    preprocessors: {&lt;br /&gt;      'test/main.js': [ 'webpack', 'sourcemap' ]&lt;br /&gt;    },&lt;br /&gt;&lt;br /&gt;    webpack: {&lt;br /&gt;      devtool: 'inline-source-map',&lt;br /&gt;      debug: true,&lt;br /&gt;      module: webpackConfig.module,&lt;br /&gt;      resolve: webpackConfig.resolve&lt;br /&gt;    },&lt;br /&gt;&lt;br /&gt;    webpackMiddleware: {&lt;br /&gt;      quiet: true,&lt;br /&gt;      stats: {&lt;br /&gt;        colors: true&lt;br /&gt;      }&lt;br /&gt;    },&lt;br /&gt;&lt;br /&gt;    // reporter options&lt;br /&gt;    mochaReporter: {&lt;br /&gt;      colors: {&lt;br /&gt;        success: 'bgGreen',&lt;br /&gt;        info: 'cyan',&lt;br /&gt;        warning: 'bgBlue',&lt;br /&gt;        error: 'bgRed'&lt;br /&gt;      }&lt;br /&gt;    }&lt;br /&gt;  });&lt;br /&gt;};&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;We just need to chop out the &lt;code&gt;debug&lt;/code&gt; statement from the &lt;code&gt;webpack&lt;/code&gt; section like so:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;module.exports = function(config) {&lt;br /&gt;&lt;br /&gt;  // .....&lt;br /&gt;&lt;br /&gt;    webpack: {&lt;br /&gt;      devtool: 'inline-source-map',&lt;br /&gt;      module: webpackConfig.module,&lt;br /&gt;      resolve: webpackConfig.resolve&lt;br /&gt;    },&lt;br /&gt;&lt;br /&gt;  // .....&lt;br /&gt;&lt;br /&gt;  });&lt;br /&gt;};&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;h4&gt;Compare and contrast&lt;/h4&gt; &lt;p&gt;We now have a repo that works with webpack 2 rc 1.  Yay!  If you'd like to see it then take a look &lt;a href="https://github.com/TypeStrong/ts-loader/tree/master/examples/webpack2-gulp-react-flux-babel-karma"&gt;here&lt;/a&gt;.&lt;/p&gt; &lt;p&gt;I thought I'd compare performance / output size of compiling with webpack 1 to webpack 2.  First of all in debug / development mode:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;// webpack 1&lt;br /&gt;&lt;br /&gt;Version: webpack 1.14.0&lt;br /&gt;Time: 5063ms&lt;br /&gt;    Asset     Size  Chunks             Chunk Names&lt;br /&gt;  main.js  37.2 kB       0  [emitted]  main&lt;br /&gt;vendor.js  2.65 MB       1  [emitted]  vendor&lt;br /&gt;&lt;br /&gt;// webpack 2&lt;br /&gt;&lt;br /&gt;Version: webpack 2.2.0-rc.1&lt;br /&gt;Time: 5820ms&lt;br /&gt;    Asset     Size  Chunks                    Chunk Names&lt;br /&gt;  main.js  38.7 kB       0  [emitted]         main&lt;br /&gt;vendor.js  2.63 MB       1  [emitted]  [big]  vendor&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Size and compilation time is not massively different from webpack 1 to webpack 2.  It's all about the same.  I'm not sure if that's to be expected or not....  Though I've a feeling in production mode I'm supposed to feel the benefits of tree shaking so let's have a go:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;// webpack 1&lt;br /&gt;&lt;br /&gt;Version: webpack 1.14.0&lt;br /&gt;Time: 5788ms&lt;br /&gt;                         Asset     Size  Chunks             Chunk Names&lt;br /&gt;  main.269c66e1bc13b7426cee.js  10.5 kB       0  [emitted]  main&lt;br /&gt;vendor.269c66e1bc13b7426cee.js   231 kB       1  [emitted]  vendor&lt;br /&gt;&lt;br /&gt;// webpack 2&lt;br /&gt;&lt;br /&gt;Version: webpack 2.2.0-rc.1&lt;br /&gt;Time: 5659ms&lt;br /&gt;                         Asset     Size  Chunks             Chunk Names&lt;br /&gt;  main.33e0d70eeec29206e9b6.js  9.22 kB       0  [emitted]  main&lt;br /&gt;vendor.33e0d70eeec29206e9b6.js   233 kB       1  [emitted]  vendor&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;To my surprise this looks pretty much unchanged before and after as well.  This may be a sign I have missed something crucial out.  Or maybe that's to be expected.  Do give me a heads up if I've missed something...&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3589344403007981324'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3589344403007981324'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2016/12/using-ts-loader-with-webpack-2.html' title='Using ts-loader with webpack 2'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3690138149393527896</id><published>2016-12-11T18:17:00.002Z</published><updated>2021-03-04T06:08:56.345Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='enhanced-resolve'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='mild trolling'/><category scheme='http://www.blogger.com/atom/ns#' term='resolver'/><category scheme='http://www.blogger.com/atom/ns#' term='Webpack'/><category scheme='http://www.blogger.com/atom/ns#' term='sync'/><title type='text'>webpack: syncing the enhanced-resolve</title><content type='html'>&lt;p&gt;Like Captain Ahab I resolve to sync the white whale that is webpack's &lt;code&gt;&lt;a href="https://github.com/webpack/enhanced-resolve"&gt;enhanced-resolve&lt;/a&gt;&lt;/code&gt;... English you say? Let me start again:&lt;/p&gt; &lt;p&gt;So, you're working on a webpack loader. (In my case the typescript loader; &lt;code&gt;&lt;a href="https://github.com/TypeStrong/ts-loader"&gt;ts-loader&lt;/a&gt;&lt;/code&gt;)  You have need of webpack's resolve capabilities. You dig around and you discover that that superpower is lodged in the very heart of the enhanced-resolve package. Fantastic. But wait, there's more: your needs are custom. You need a sync, not an async resolver. (Try saying that quickly.) You regard the description of &lt;code&gt;enhanced-resolve&lt;/code&gt; with some concern:&lt;/p&gt; &lt;blockquote cite="https://github.com/webpack/enhanced-resolve"&gt;&lt;p&gt;"Offers an async require.resolve function. It's highly configurable."&lt;/p&gt;&lt;/blockquote&gt; &lt;p&gt;Well that doesn't sound too promising. Let's have a look at the docs. Ah. Hmmm. You know how it goes with webpack. Why document anything clearly when people could just guess wildly until they near insanity and gibber? Right? It's well established that webpack's attitude to docs has been traditionally akin to Gordon Gecko's view on lunch.&lt;/p&gt; &lt;a href="https://3.bp.blogspot.com/-b3dUlC6AJjI/WE2U_wcJvrI/AAAAAAAAA_4/lciulxFqwrUAZxLol9FVybHCpCdgXSufgCLcB/s1600/documentation-is-for-wimps.png" imageanchor="1" &gt;&lt;img border="0" src="https://3.bp.blogspot.com/-b3dUlC6AJjI/WE2U_wcJvrI/AAAAAAAAA_4/lciulxFqwrUAZxLol9FVybHCpCdgXSufgCLcB/s1600/documentation-is-for-wimps.png" /&gt;&lt;/a&gt; &lt;p&gt;In all fairness, things are beginning to change on that front. In fact the &lt;a href="https://webpack.js.org/"&gt;new docs&lt;/a&gt; look very promising. But regrettably, the docs on the enhanced-resolve repo are old school. Which is to say: opaque. However, I'm here to tell you that if a sync resolver is your baby then, contrary to appearances, &lt;code&gt;enhanced-resolve&lt;/code&gt; has your back.&lt;/p&gt; &lt;h4&gt;Sync, for lack of a better word, is good&lt;/h4&gt; &lt;p&gt;Nestled inside enhanced-resolve is the &lt;code&gt;&lt;a href="https://github.com/webpack/enhanced-resolve/blob/3f3f4cd1fcbafa1e98c3c6470fed1277817ed607/lib/ResolverFactory.js"&gt;ResolverFactory.js&lt;/a&gt;&lt;/code&gt; which can be used to make a resolver. However, you can supply it with a million options and that's just like giving someone a gun with a predilection for feet.&lt;/p&gt; &lt;p&gt;What you want is an example of how you could make a sync resolver. Well, surprise surprise it's right in front of your nose.  Tucked away in &lt;code&gt;&lt;a href="https://github.com/webpack/enhanced-resolve/blob/3f3f4cd1fcbafa1e98c3c6470fed1277817ed607/lib/node.js"&gt;node.js&lt;/a&gt;&lt;/code&gt; (I do *&lt;strong&gt;not&lt;/strong&gt;* get the name) is exactly what you're after. It contains a number of factory functions which will construct a ready-made resolver for you; sync or async.  Perfect!  So here's how I'm rolling:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;const node = require("enhanced-resolve/lib/node");&lt;br /&gt;&lt;br /&gt;function makeSyncResolver(options) {&lt;br /&gt;    return node.create.sync(options.resolve);&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;const resolveSync = makeSyncResolver(loader.options);&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;The loader options used above you'll be familiar with as the &lt;code&gt;resolve&lt;/code&gt; section of your &lt;code&gt;webpack.config.js&lt;/code&gt;.  You can read more about them &lt;a href="https://github.com/webpack/enhanced-resolve/blob/master/README.md"&gt;here&lt;/a&gt; and &lt;a href="https://webpack.js.org/configuration/resolve/"&gt;here&lt;/a&gt;.&lt;/p&gt; &lt;p&gt;What you're left with at this point is a function; a &lt;code&gt;resolveSync&lt;/code&gt; function if you will that takes 3 arguments:&lt;/p&gt; &lt;dl&gt;&lt;dt&gt;context&lt;/dt&gt;&lt;dd&gt;I don't know what this is.  So when using the function I just supply &lt;code&gt;undefined&lt;/code&gt;; and that seems to be OK.  Weird, right?&lt;/dd&gt; &lt;dt&gt;path&lt;/dt&gt;&lt;dd&gt;This is the path to your code (I think).  So, a valid value to supply - handily lifted from the ts-loader test pack - would be: &lt;code&gt;C:\source\ts-loader\.test\babel-issue92&lt;/code&gt;&lt;/dd&gt; &lt;dt&gt;request&lt;/dt&gt;&lt;dd&gt;The actual module you're interested in; so using the same test the relevant value would be &lt;code&gt;./submodule/submodule&lt;/code&gt;&lt;/dd&gt;&lt;/dl&gt; &lt;p&gt;Put it all together and what have you got?&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;const resolvedFileName = resolveSync(&lt;br /&gt;    undefined,&lt;br /&gt;    'C:\source\ts-loader\.test\babel-issue92',&lt;br /&gt;    './submodule/submodule'&lt;br /&gt;);&lt;br /&gt;&lt;br /&gt;// resolvedFileName: C:\source\ts-loader\.test\babel-issue92\submodule\submodule.tsx&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Boom.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3690138149393527896'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3690138149393527896'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2016/12/webpack-syncing-enhanced-resolve.html' title='webpack: syncing the enhanced-resolve'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='https://3.bp.blogspot.com/-b3dUlC6AJjI/WE2U_wcJvrI/AAAAAAAAA_4/lciulxFqwrUAZxLol9FVybHCpCdgXSufgCLcB/s72-c/documentation-is-for-wimps.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1338389303235215633</id><published>2016-11-12T10:38:00.002Z</published><updated>2016-11-14T06:39:08.460Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>My Subconscious is a Better Developer Than I Am</title><content type='html'>&lt;p&gt;Occasionally I flatter myself that I'm alright at this development lark. Such egotistical talk is foolish. What makes me pause even more when I consider the proposition is this: my subconscious is a better developer than I am.&lt;/p&gt; &lt;p&gt;What's this fellow talking about?&lt;/p&gt; &lt;p&gt;There's 2 of me. Not identical twins; masquerading as a single man (spoiler: I am not a Christopher Nolan movie). No. There's me, the chap who's tapping away at his keyboard and solving a problem. And there's the other chap too.&lt;/p&gt; &lt;p&gt;I have days when I'm working away at something and I'll hit a brick wall. I produce solutions that work but are not elegant. I'm not proud of them. Or worse, I fail to come up with something that solves the problem I'm facing. So I go home. I see my family, I have some food, I do something else. I context switch. I go to sleep.&lt;/p&gt; &lt;p&gt;When I awake, sometimes (not always) I'll have waiting in my head a better solution.  I can see the solution in my head. I can turn it over and compare it to what, if anything, I currently have and see the reasons the new approach is better. Great, right? Up to a point.&lt;/p&gt; &lt;p&gt;What concerns me is this: I didn't work this out from first principles. The idea arrived sight unseen in my head. It totally works but whose work actually is it? I feel like I'm taking credit for someone else's graft. This is probably why I'm so keen on the MIT License. Don't want to be caught out.&lt;/p&gt; &lt;p&gt;I think I'd like it better if I was a better developer than my subconscious. I'd come up with the gold and mock the half baked ideas he shows me in the morning. Alas it is not to be.&lt;/p&gt; &lt;p&gt;I draw some comfort from the knowledge that I'm not alone in my experience. I've chatted to other devs in the same boat. There's probably 2 of you as well. Amarite? There's probably 3 of Jon Skeet; each more brilliant than the last...&lt;/p&gt; &lt;div class="separator" style="clear: both; text-align: center;"&gt;&lt;a href="https://2.bp.blogspot.com/-HeI5Fgd7AUU/WCW4Kg_QoGI/AAAAAAAAA_M/ykfAHKz1N9sTdEzGtQkIjebrPQInc3YlwCPcB/s1600/beingjohnm.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"&gt;&lt;img border="0" src="https://2.bp.blogspot.com/-HeI5Fgd7AUU/WCW4Kg_QoGI/AAAAAAAAA_M/ykfAHKz1N9sTdEzGtQkIjebrPQInc3YlwCPcB/s320/beingjohnm.png" width="293" height="320" /&gt;&lt;/a&gt;&lt;/div&gt; &lt;p&gt;PS I posted this to Hacker News and &lt;a href="https://news.ycombinator.com/item?id=12942461"&gt;the comments left by people are pretty fascinating&lt;/a&gt;.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1338389303235215633'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1338389303235215633'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2016/11/my-subconscious-is-better-developer.html' title='My Subconscious is a Better Developer Than I Am'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='https://2.bp.blogspot.com/-HeI5Fgd7AUU/WCW4Kg_QoGI/AAAAAAAAA_M/ykfAHKz1N9sTdEzGtQkIjebrPQInc3YlwCPcB/s72-c/beingjohnm.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5780969105337355481</id><published>2016-11-01T05:33:00.000Z</published><updated>2016-11-01T05:33:01.275Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='open source'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='TypeScript'/><category scheme='http://www.blogger.com/atom/ns#' term='ts-loader'/><title type='text'>But you can't die... I love you!</title><content type='html'>&lt;p&gt;That's how I was feeling on the morning of October 6th 2016. I'd been feeling that way for some time.  The target of my concern? &lt;a href="https://github.com/TypeStrong/ts-loader"&gt;ts-loader&lt;/a&gt;. ts-loader is a loader for &lt;a href="https://webpack.github.io/"&gt;webpack; the module bundler&lt;/a&gt;. ts-loader allows you use TypeScript with webpack.  I'd been a merry user of it for at least a year or so. But, at that point, all was not well in the land of ts-loader.  Come with me and I'll tell you a story...&lt;/p&gt; &lt;h4&gt;Going Red&lt;/h4&gt; &lt;p&gt;At some point, I became a member of the &lt;a href="https://github.com/TypeStrong"&gt;TypeStrong&lt;/a&gt; organisation on GitHub. I'm honestly not entirely sure how. I think it may have been down to the very excellent &lt;a href="https://github.com/basarat"&gt;Basarat&lt;/a&gt; (he of &lt;a href="http://alm.tools/"&gt;ALM&lt;/a&gt; / &lt;a href="https://github.com/TypeStrong/atom-typescript"&gt;atom-typescript&lt;/a&gt; / the list goes on fame) but I couldn't clearly say.&lt;/p&gt; &lt;p&gt;Either way, &lt;a href="https://github.com/jbrantly"&gt;James Brantly&lt;/a&gt;'s ts-loader was also one of TypeStrong's projects.  Since I used it, I occasionally contributed.  Not much to be honest; mostly it was documentation tweaks.  I mean I never really looked at the main code at all.  It worked (thanks to other people). I just plugged it into my projects and ploughed on my merry way. I liked it.  It was well established; with friendly maintainers.  It had a continuous integration test pack that ran against multiple versions of TypeScript on both Windows and Linux.  I trusted it.  Then one day the continuous integration tests went red.  And stayed red.&lt;/p&gt; &lt;p&gt;This is where we came in. On the morning of October 6th I was mulling what to do about this.  I knew there was another alternative out there (awesome-typescript-loader) but I was a little wary of it.  My understanding of ATL was that it targeted webpack 2.0 which has long been in beta.  Where I ply my trade (mostly developing software for the financial sector in the City of London) beta is not a word that people trust.  They don't do beta. What's more I was quite happy with ts-loader; I didn't want to switch if I didn't have to.  I also rather suspected (rightly) that there wasn't much wrong; ts-loader just needed a little bit of love.  So I thought: I bet I can help here.&lt;/p&gt; &lt;h4&gt;The Statement of Intent&lt;/h4&gt; &lt;p&gt;So that evening I raised &lt;a href="https://github.com/TypeStrong/ts-loader/issues/296"&gt;an issue against ts-loader&lt;/a&gt;.  Not a "sort it out chap" issue. No.  That wouldn't be terribly helpful.  I raised a "here's how I can help" issue.  I present an abridged version below:&lt;/p&gt; &lt;blockquote cite="https://github.com/TypeStrong/ts-loader/issues/296"&gt; &lt;p&gt;Okay here's the deal; I've been using ts-loader for a long time but my contributions up until now have mostly been documentation.  Fixing of tests etc.  As the commit history shows this is &lt;a href="https://github.com/jbrantly" class="user-mention"&gt;@jbrantly&lt;/a&gt;'s baby and kudos to him.&lt;/p&gt; &lt;p&gt;He's not been able to contribute much of late and since he's the main person who's worked on ts-loader not much has happened for a while; the code is a bit stale.  As I'm a member of TypeStrong I'm going to have a go at improving the state of the project.  I'm going to do this as carefully as I can.  This issue is intended as a meta issue to make it visible what I'm plannning to do / doing.&lt;/p&gt; &lt;p&gt;My immediate goal is to get a newer version of ts-loader built and shipped.  Essentially all the bug fixes / tweaks since the last release should ship.&lt;/p&gt; &lt;p&gt;...&lt;/p&gt; &lt;p&gt;I don't have npm publish rights for ts-loader.  Fortunately both &lt;a href="https://github.com/jbrantly" class="user-mention"&gt;@jbrantly&lt;/a&gt; and &lt;a href="https://github.com/blakeembrey" class="user-mention"&gt;@blakeembrey&lt;/a&gt; do - and hopefully one of them will either be able to help out with a publish or let me have the requisite rights to do it.&lt;/p&gt; &lt;p&gt;I can't promise this is all going to work; I've got a limited amount of spare time I'm afraid. Whatever happens it's going to take me a little while.  But I'm going to see where I can take this.  Best foot forward!  Please bear with me...&lt;/p&gt;&lt;/blockquote&gt; &lt;p&gt;I did wonder what would happen next. This happened next:&lt;/p&gt; &lt;blockquote class="twitter-tweet" data-lang="en"&gt;&lt;p lang="en" dir="ltr"&gt;My &lt;a href="https://twitter.com/hashtag/opensourceguilt?src=hash"&gt;#opensourceguilt&lt;/a&gt; has been lifted thanks to &lt;a href="https://twitter.com/johnny_reilly"&gt;@johnny_reilly&lt;/a&gt; stepping up to take over ts-loader. Thanks man!&lt;/p&gt;&amp;mdash; James Brantly (@jbrantly) &lt;a href="https://twitter.com/jbrantly/status/785931975064444928"&gt;October 11, 2016&lt;/a&gt;&lt;/blockquote&gt;&lt;script async src="//platform.twitter.com/widgets.js" charset="utf-8"&gt;&lt;/script&gt; &lt;h4&gt;Caretaker, not &lt;a href="https://en.wikipedia.org/wiki/Benevolent_dictator_for_life"&gt;BDFL&lt;/a&gt;&lt;/h4&gt; &lt;p&gt;So that's how it came to pass that I became the present main caretaker of ts-loader.  James very kindly gave me the rights to publish to npm and soon enough I did.  I fixed up the existing integration test pack; made it less brittle.  I wrote a new integration test pack (that performs a different sort of testing; execution rather than comparison). I merged pull requests, I closed issues.  I introduced a regression (whoops!), a community member helped me fix it (thanks &lt;a href="https://github.com/dopare"&gt;Mike Mazmanyan&lt;/a&gt;!).  In the last month ts-loader has shipped 6 times.&lt;/p&gt; &lt;p&gt;The thing that matters most in the last paragraph are the phrases "I merged pull requests" and "a community member helped me fix it".  I'm wary of one man bands; you should be to. I want projects to be a thing communally built and maintained.  If I go under a bus I want someone else to be able to carry on without me.  So be part of this; I want you to help!&lt;/p&gt; &lt;p&gt;I've got plans to do a lot more.  I'm in the process of &lt;a href="https://github.com/TypeStrong/ts-loader/pull/343"&gt;refactoring ts-loader to make it more modular and hence easier for others to contribute&lt;/a&gt;. (Also it must be said, refactoring something is an excellent way to try and learn a codebase.) Version 1.0 of ts-loader should ship this week.&lt;/p&gt; &lt;p&gt;I'm working with &lt;a href="https://github.com/HerringtonDarkholme"&gt;Herrington Darkholme&lt;/a&gt; (awesome name BTW!) to &lt;a href="https://github.com/TypeStrong/ts-loader/issues/270"&gt;add a hook-in point&lt;/a&gt; that will allow ts-loader to support &lt;a href="http://vuejs.org/"&gt;vuejs&lt;/a&gt;.  Stuff is happening and will continue to.  But don't be shy; be part of this!  ts-loader awaits your PRs and is happy to have as many caretakers as possible!&lt;/p&gt; &lt;div class="separator" style="clear: both; text-align: center;"&gt;&lt;a href="https://3.bp.blogspot.com/-7C3XJx27J3c/WBezEOoySXI/AAAAAAAAA-s/7ZKfaVDsHccr7CUmWZAd-bqjsGUhCFLNwCPcB/s1600/caretaker.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"&gt;&lt;img border="0" src="https://3.bp.blogspot.com/-7C3XJx27J3c/WBezEOoySXI/AAAAAAAAA-s/7ZKfaVDsHccr7CUmWZAd-bqjsGUhCFLNwCPcB/s400/caretaker.png" width="400" height="387" /&gt;&lt;/a&gt;&lt;/div&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5780969105337355481'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5780969105337355481'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2016/11/but-you-cant-die-i-love-you-ts-loader.html' title='But you can&apos;t die... I love you!'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='https://3.bp.blogspot.com/-7C3XJx27J3c/WBezEOoySXI/AAAAAAAAA-s/7ZKfaVDsHccr7CUmWZAd-bqjsGUhCFLNwCPcB/s72-c/caretaker.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5552487833701621146</id><published>2016-10-05T06:02:00.001+01:00</published><updated>2021-03-04T06:09:40.624Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='currying'/><category scheme='http://www.blogger.com/atom/ns#' term='jsx'/><category scheme='http://www.blogger.com/atom/ns#' term='React'/><category scheme='http://www.blogger.com/atom/ns#' term='stateless functional components'/><title type='text'>React Component Curry</title><content type='html'>&lt;p&gt;Everyone loves curry don't they? I don't know about you but I'm going for one on Friday.&lt;/p&gt; &lt;p&gt;When React 0.14 shipped, it came with a new way to write React components. Rather than as an ES2015 class or using &lt;code&gt;React.createClass&lt;/code&gt; there was now another way: stateless functional components.&lt;/p&gt; &lt;p&gt;These are components which have no state (the name gives it away) and a simple syntax; they are a function which takes your component props as a single parameter and they return JSX. Think of them as the render method of a standard component just with props as a parameter.&lt;/p&gt; &lt;p&gt;The advantage of these components is that they can reduce the amount of code you have to write for a component which requires no state. This is even more true if you're using ES2015 syntax as you have arrow functions and destructuring to help.Embrace the terseness!&lt;/p&gt; &lt;h4&gt;Mine's a Balti&lt;/h4&gt; &lt;p&gt;There is another advantage of this syntax. If you have a number of components which share similar implementation you can easily make component factories by currying:&lt;/p&gt; &lt;pre class="prettyprint jsx"&gt;&lt;br /&gt;&lt;code class="language-jsx"&gt;&lt;br /&gt;function iconMaker(fontAwesomeClassName: string) {&lt;br /&gt;   return props =&amp;gt; &amp;lt;i className={ `fa ${ fontAwesomeClassName }` }/&amp;gt;;&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;const ThumbsUpIcon = iconMaker("fa-thumbs-up");&lt;br /&gt;const TrophyIcon = iconMaker("fa-trophy");&lt;br /&gt;&lt;br /&gt;// Somewhere in else inside a render function:&lt;br /&gt;&lt;br /&gt;&amp;lt;p&amp;gt;This is totally &amp;lt;ThumbsUpIcon /&amp;gt;.... You should win a &amp;lt;TrophyIcon /&amp;gt;&amp;lt;/p&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;So our &lt;code&gt;iconMaker&lt;/code&gt; is a function which, when called with a &lt;a href="http://fontawesome.io/"&gt;Font Awesome&lt;/a&gt; class name produces a function which, when invoked, will return a the HTML required to render that icon.  This is a super simple example, a bhaji if you will, but you can imagine how useful this technique can be when you've more of a banquet in mind.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5552487833701621146'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5552487833701621146'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2016/10/react-component-curry.html' title='React Component Curry'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6367676349127043518</id><published>2016-09-22T21:47:00.002+01:00</published><updated>2021-03-13T14:44:06.421Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='TypeScript'/><category scheme='http://www.blogger.com/atom/ns#' term='Babel'/><category scheme='http://www.blogger.com/atom/ns#' term='ES2016'/><title type='text'>TypeScript 2.0, ES2016 and Babel</title><content type='html'>&lt;p&gt;&lt;a href="https://blogs.msdn.microsoft.com/typescript/2016/09/22/announcing-typescript-2-0/"&gt;TypeScript 2.0 has shipped!&lt;/a&gt;  Naturally I'm excited.  For some time I've been using TypeScript to emit ES2015 code which I pass onto Babel to transpile to ES "old school".  You can see how &lt;a href="https://blog.johnnyreilly.com/2015/12/es6-typescript-babel-react-flux-karma.html"&gt;here&lt;/a&gt;.&lt;/p&gt; &lt;p&gt;Merely upgrading my &lt;code&gt;package.json&lt;/code&gt; to use &lt;code&gt;"typescript": "^2.0.3"&lt;/code&gt; from &lt;code&gt;"typescript": "^1.8.10"&lt;/code&gt; was painless.  TypeScript now supports ES2016 (the previous major release 1.8 supported ES2015).  I wanted to move on from writing ES2015 to writing ES2016 using my chosen build process.  Fortunately, it's supported.  Phew.  However, due to some advances in ecmascript feature modularisation within the TypeScript compiler the upgrade path is slightly different. I figured that I'd just be able to update the &lt;code&gt;&lt;a href="https://www.typescriptlang.org/docs/handbook/compiler-options.html"&gt;target&lt;/a&gt;&lt;/code&gt; in my &lt;code&gt;tsconfig.json&lt;/code&gt; to &lt;code&gt;"es2016"&lt;/code&gt; from &lt;code&gt;"es2015"&lt;/code&gt;, add in the ES2016 preset for Babel and jobs a good 'un. Not so.  There were a few more steps to follow. Here's the recipe:&lt;/p&gt; &lt;h4&gt;&lt;code&gt;tsconfig.json&lt;/code&gt; changes&lt;/h4&gt; &lt;p&gt;Well, there's no &lt;code&gt;"es2016"&lt;/code&gt; target for TypeScript.  You carry on with a target of &lt;code&gt;"es2015"&lt;/code&gt;.  What I need is a new entry: &lt;code&gt;"lib": ["dom", "es2015", "es2016"]&lt;/code&gt;.  This tells the compiler that we're expecting to be emitting to an environment which supports a browser (&lt;code&gt;"dom"&lt;/code&gt;), and both ES2016 and ES2015.  Our "environment" is Babel and it's going to pick up the baton from this point.  My complete &lt;code&gt;tsconfig.json&lt;/code&gt; looks like this:&lt;/p&gt; &lt;pre class="prettyprint json"&gt;&lt;br /&gt;&lt;code class="language-json"&gt;&lt;br /&gt;{&lt;br /&gt;  "compileOnSave": false,&lt;br /&gt;  "compilerOptions": {&lt;br /&gt;    "allowSyntheticDefaultImports": true,&lt;br /&gt;    "lib": ["dom", "es2015", "es2016"],&lt;br /&gt;    "jsx": "preserve",&lt;br /&gt;    "module": "es2015",&lt;br /&gt;    "moduleResolution": "node",&lt;br /&gt;    "noEmitOnError": false,&lt;br /&gt;    "noImplicitAny": true,&lt;br /&gt;    "preserveConstEnums": true,&lt;br /&gt;    "removeComments": false,&lt;br /&gt;    "suppressImplicitAnyIndexErrors": true,&lt;br /&gt;    "target": "es2015"&lt;br /&gt;  }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;h4&gt;Babel changes&lt;/h4&gt; &lt;p&gt;I needed the Babel preset for ES2016; with a quick &lt;code&gt;&lt;a href="https://www.npmjs.com/package/babel-preset-es2016"&gt;npm install --save-dev babel-preset-es2016&lt;/a&gt;&lt;/code&gt; that was sorted.  Now just to kick Webpack into gear...&lt;/p&gt; &lt;h4&gt;Webpack changes&lt;/h4&gt; &lt;p&gt;My webpack config plugs together TypeScript and Babel with the help of &lt;a href="https://www.npmjs.com/package/ts-loader"&gt;ts-loader&lt;/a&gt; and &lt;a href="https://www.npmjs.com/package/babel-loader"&gt;babel-loader&lt;/a&gt;. It allows the transpilation of my (few) JavaScript files so I can write ES2015.  However, mainly it allows the transpilation of my (many) TypeScript files so I can write ES2015-flavoured TypeScript.  I'll now tweak the &lt;code&gt;loaders&lt;/code&gt; so they cater for ES2016 as well.&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;var webpack = require('webpack');&lt;br /&gt;&lt;br /&gt;module.exports = {&lt;br /&gt;  // ....&lt;br /&gt;&lt;br /&gt;  module: {&lt;br /&gt;    loaders: [{&lt;br /&gt;      // Now transpiling ES2016 TS&lt;br /&gt;      test: /\.ts(x?)$/,&lt;br /&gt;      exclude: /node_modules/,&lt;br /&gt;      loader: 'babel-loader?presets[]=es2016&amp;presets[]=es2015&amp;presets[]=react!ts-loader'&lt;br /&gt;    }, {&lt;br /&gt;      // Now transpiling ES2016 JS&lt;br /&gt;      test: /\.js$/,&lt;br /&gt;      exclude: /node_modules/,&lt;br /&gt;      loader: 'babel',&lt;br /&gt;      query: {&lt;br /&gt;        presets: ['es2016', 'es2015', 'react']&lt;br /&gt;      }&lt;br /&gt;    }]&lt;br /&gt;  },&lt;br /&gt;&lt;br /&gt;  // ....&lt;br /&gt;};&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;h4&gt;Wake Up and Smell the Jasmine&lt;/h4&gt; &lt;p&gt;And we're there; it works.  How do I know?  Well; here's the proof:&lt;/p&gt; &lt;pre class="prettyprint ts"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;  it("Array.prototype.includes works", () =&gt; {&lt;br /&gt;    const result = [1, 2, 3].includes(2);&lt;br /&gt;    expect(result).toBe(true);&lt;br /&gt;  });&lt;br /&gt;&lt;br /&gt;  it("Exponentiation operator works", () =&gt; {&lt;br /&gt;    expect(1 ** 2 === Math.pow(1, 2)).toBe(true);&lt;br /&gt;  });&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Much love to the TypeScript team for an awesome job; I can't wait to get stuck into some of the exciting new features of TypeScript 2.0. &lt;code&gt;strictNullChecks&lt;/code&gt; FTW!&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/6367676349127043518'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/6367676349127043518'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2016/09/typescript-20-es2016-and-babel.html' title='TypeScript 2.0, ES2016 and Babel'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2413786573937254172</id><published>2016-09-12T21:10:00.003+01:00</published><updated>2021-03-13T14:18:27.366Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Database Snapshots'/><category scheme='http://www.blogger.com/atom/ns#' term='Integration Testing'/><category scheme='http://www.blogger.com/atom/ns#' term='SQL Server'/><title type='text'>Integration Tests with SQL Server Database Snapshots</title><content type='html'>&lt;h4&gt;Once More With Feeling&lt;/h4&gt; &lt;p&gt;This is a topic that I have written about &lt;a href="https://blog.johnnyreilly.com/2014/01/integration-testing-with-entity.html"&gt;before&lt;/a&gt;.... But not well. I recently had cause to dust down my notes on how to use snapshotting in your integration tests. To my dismay, referring back to my original blog post was less helpful than I'd hoped. Now I've cracked the enigma code that my original scribings turned out to be, it's time to turn my relearnings back into something genuinely useful.&lt;/p&gt; &lt;h4&gt;What's the Scenario?&lt;/h4&gt; &lt;p&gt;You have a test database. You want to write integration tests. So what's the problem? Well, these tests will add records, delete records, update records within the tables of the database. They will mutate the data. And that's exactly what they ought to do; they're testing that our code uses the database in the way we would hope and expect.&lt;/p&gt; &lt;p&gt;So how do we handle this? Well, we could handle this by writing code at the end of each test that is responsible for reverting the database back to the state that it was in at the start of the test. So if we had a test that added a record and tested it, we'd need the test to be responsible for removing that record before any subsequent tests run. Now that's a totally legitimate approach but it adds tax. Each test becomes more complicated and requires more code.&lt;/p&gt; &lt;p&gt;So what's another approach? Perhaps we could take a backup of our database before our first test runs. Then, at the end of each test, we could restore our backup to roll the database back to its initial state. Perfect, right? Less code to write, less scope for errors. So what's the downside? Backups are slowwwww. Restores likewise. We could be waiting minutes between each test that runs. That's not acceptable.&lt;/p&gt; &lt;p&gt;There is another way though: &lt;a href="https://msdn.microsoft.com/en-us/library/ms175158.aspx"&gt;database snapshots&lt;/a&gt; - a feature that's been nestling inside SQL Server for a goodly number of years. For our use case, to all intents and purposes, database snapshots offers the same functionality as backups and restores. You can backup a database (take a snapshot of a database at a point in time), you can restore a database (roll back the database to the point of the snapshot). More importantly, you can do either operation in *&lt;em&gt;under a second&lt;/em&gt;*. As it happens, Microsoft advocate using this approach themselves:&lt;/p&gt; &lt;blockquote cite="https://msdn.microsoft.com/en-us/library/ms175158.aspx"&gt;In a testing environment, it can be useful when repeatedly running a test protocol for the database to contain identical data at the start of each round of testing. Before running the first round, an application developer or tester can create a database snapshot on the test database. After each test run, the database can be quickly returned to its prior state by reverting the database snapshot.&lt;/blockquote&gt; &lt;p&gt;Sold!&lt;/p&gt; &lt;h4&gt;Talk is cheap, show me the code&lt;/h4&gt; &lt;p&gt;In the end it comes down to 3 classes; &lt;code&gt;DatabaseSnapshot.cs&lt;/code&gt; which does the actual snapshotting work and 2 classes that make use of it.&lt;/p&gt; &lt;h5&gt;DatabaseSnapshot.cs&lt;/h5&gt; &lt;p&gt;This is our &lt;code&gt;DatabaseSnapshot&lt;/code&gt; class.  Isn't it pretty?&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;using System.Data;&lt;br /&gt;using System.Data.SqlClient;&lt;br /&gt;&lt;br /&gt;namespace Testing.Shared&lt;br /&gt;{&lt;br /&gt;    public class DatabaseSnapshot&lt;br /&gt;    {&lt;br /&gt;        private readonly string _dbName;&lt;br /&gt;        private readonly string _dbSnapShotPath;&lt;br /&gt;        private readonly string _dbSnapShotName;&lt;br /&gt;        private readonly string _dbConnectionString;&lt;br /&gt;&lt;br /&gt;        public DatabaseSnapshot(string dbName, string dbSnapshotPath, string dbSnapshotName, string dbConnectionString)&lt;br /&gt;        {&lt;br /&gt;            _dbName = dbName;&lt;br /&gt;            _dbSnapshotPath = dbSnapshotPath;&lt;br /&gt;            _dbSnapshotName = dbSnapshotName;&lt;br /&gt;            _dbConnectionString = dbConnectionString;&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        public void CreateSnapshot()&lt;br /&gt;        {&lt;br /&gt;            if (!System.IO.Directory.Exists(_dbSnapshotPath))&lt;br /&gt;                System.IO.Directory.CreateDirectory(_dbSnapshotPath);&lt;br /&gt;&lt;br /&gt;            var sql = $"CREATE DATABASE { _dbSnapshotName } ON (NAME=[{ _dbName }], FILENAME='{ _dbSnapshotPath }{ _dbSnapshotName }') AS SNAPSHOT OF [{_dbName }]";&lt;br /&gt;&lt;br /&gt;            ExecuteSqlAgainstMaster(sql);&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        public void DeleteSnapshot()&lt;br /&gt;        {&lt;br /&gt;            var sql = $"DROP DATABASE { _dbSnapshotName }";&lt;br /&gt;&lt;br /&gt;            ExecuteSqlAgainstMaster(sql);&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        public void RestoreSnapshot()&lt;br /&gt;        {&lt;br /&gt;            var sql = "USE master;\r\n" +&lt;br /&gt;&lt;br /&gt;                $"ALTER DATABASE {_dbName} SET SINGLE_USER WITH ROLLBACK IMMEDIATE;\r\n" +&lt;br /&gt;&lt;br /&gt;                $"RESTORE DATABASE {_dbName}\r\n" +&lt;br /&gt;                $"FROM DATABASE_SNAPSHOT = '{ _dbSnapshotName }';\r\n" +&lt;br /&gt;&lt;br /&gt;                $"ALTER DATABASE {_dbName} SET MULTI_USER;\r\n";&lt;br /&gt;&lt;br /&gt;            ExecuteSqlAgainstMaster(sql);&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        private void ExecuteSqlAgainstMaster(string sql, params SqlParameter[] parameters)&lt;br /&gt;        {&lt;br /&gt;            using (var conn = new SqlConnection(_dbConnectionString))&lt;br /&gt;            {&lt;br /&gt;                conn.Open();&lt;br /&gt;                var cmd = new SqlCommand(sql, conn) { CommandType = CommandType.Text };&lt;br /&gt;                cmd.Parameters.AddRange(parameters);&lt;br /&gt;                cmd.ExecuteNonQuery();&lt;br /&gt;                conn.Close();&lt;br /&gt;            }&lt;br /&gt;        }&lt;br /&gt;    }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;It exposes 3 methods:&lt;/p&gt; &lt;dl&gt;&lt;dt&gt;CreateSnapshot&lt;/dt&gt;&lt;dd&gt;This method creates the snapshot of the database. We will run this right at the start, before any of our tests run.&lt;/dd&gt; &lt;dt&gt;DeleteSnapshot&lt;/dt&gt;&lt;dd&gt;Deletes the snapshot we created. We will run this at the end, after all our tests have finished running.&lt;/dd&gt; &lt;dt&gt;RestoreSnapshot&lt;/dt&gt;&lt;dd&gt;Restores the database back to the snapshot we took earlier.  We run this after each test has completed. This method relies on a connection to the database (perhaps unsurprisingly). It switches the database in use away from the database that is being restored prior to actually running the restore. It happens to shift to the master database (I believe that's entirely incidental; although I haven't tested).&lt;/dd&gt;&lt;/dl&gt; &lt;h5&gt;SetupAndTeardown.cs&lt;/h5&gt; &lt;p&gt;This class is responsible for setting up the snapshot we're going to use in our tests right before any of the tests have run (in the &lt;code&gt;FixtureSetup&lt;/code&gt; method).  It's also responsible for deleting the snapshot once all the tests have finished running (in the &lt;code&gt;FixtureTearDown&lt;/code&gt; method).  It should be noted that in this example I'm using NUnit and this class is written to depend on the hooks NUnit exposes for running code at the very beginning and end of the test cycle.  All test frameworks have these hooks; if you're using something other than NUnit then it's just a case of swapping in the relevant attribute (everything tends to attribute driven in the test framework world).&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;using NUnit.Framework;&lt;br /&gt;&lt;br /&gt;namespace Testing.Shared&lt;br /&gt;{&lt;br /&gt;   [SetUpFixture]&lt;br /&gt;   public class SetupAndTeardown&lt;br /&gt;   {&lt;br /&gt;      public static DatabaseSnapshot DatabaseSnapshot;&lt;br /&gt;&lt;br /&gt;      [SetUp]&lt;br /&gt;      public void FixtureSetup()&lt;br /&gt;      {&lt;br /&gt;         DatabaseSnapshot = new DatabaseSnapshot("MyDbName", "C:\\", "MySnapshot", "Data Source=.;initial catalog=MyDbName;integrated security=True;");&lt;br /&gt;&lt;br /&gt;         try&lt;br /&gt;         {&lt;br /&gt;            // Try to delete the snapshot in case it was left over from aborted test runs&lt;br /&gt;            DatabaseSnapshot.DeleteSnapShot();&lt;br /&gt;         }&lt;br /&gt;         catch { /* this should fail with snapshot does not exist */ }&lt;br /&gt;&lt;br /&gt;         DatabaseSnapshot.CreateSnapShot();&lt;br /&gt;      }&lt;br /&gt;&lt;br /&gt;      [TearDown]&lt;br /&gt;      public void FixtureTearDown()&lt;br /&gt;      {&lt;br /&gt;         DatabaseSnapshot.DeleteSnapShot();&lt;br /&gt;      }&lt;br /&gt;   }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt;  &lt;h5&gt;TestBase.cs&lt;/h5&gt; &lt;p&gt;All of our test classes are made to inherit from this class:&lt;/dd&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;using NUnit.Framework;&lt;br /&gt;&lt;br /&gt;namespace Testing.Shared&lt;br /&gt;{&lt;br /&gt;   public class TestBase&lt;br /&gt;   {&lt;br /&gt;      [TearDown]&lt;br /&gt;      public void TearDown()&lt;br /&gt;      {&lt;br /&gt;         SetupAndTeardown.DatabaseSnapshot.RestoreSnapShot();&lt;br /&gt;      }&lt;br /&gt;   }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Which restores the database back to the snapshot position at the end of each test. And that... Is that!&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2413786573937254172'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2413786573937254172'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2016/09/integration-tests-with-sql-server.html' title='Integration Tests with SQL Server Database Snapshots'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3672612150521698305</id><published>2016-08-19T08:26:00.002+01:00</published><updated>2021-03-14T05:28:55.396Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Destructuring'/><category scheme='http://www.blogger.com/atom/ns#' term='Ternary Operator'/><category scheme='http://www.blogger.com/atom/ns#' term='TypeScript'/><category scheme='http://www.blogger.com/atom/ns#' term='ES2015'/><title type='text'>The Ternary Operator &lt;3 Destructuring</title><content type='html'>&lt;p&gt;I'm addicted to the &lt;a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Conditional_Operator"&gt;ternary operator&lt;/a&gt;.  For reasons I can't explain, I cannot get enough of:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;const thisOrThat = (someCondition) ? "this" : "or that"&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;The occasion regularly arises where I need to turn my lovely terse code into an if statement in order to set 2 variables instead of 1.  I've been heartbroken; I hate doing:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;let legWear: string, coat: boolean;&lt;br /&gt;if (weather === "good") {&lt;br /&gt;  legWear = "shorts";&lt;br /&gt;  coat = false;&lt;br /&gt;}&lt;br /&gt;else {&lt;br /&gt;  legWear = "jeans";&lt;br /&gt;  coat = true;&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Just going from setting one variable to setting two has been really traumatic:&lt;/p&gt; &lt;ul&gt;&lt;li&gt;I've had do stop using &lt;code&gt;const&lt;/code&gt; and moved to &lt;code&gt;let&lt;/code&gt;.  This has made my code less "truthful" in the sense that I never intend to reassign these variables again; they are intended to be immutable.&lt;/li&gt;&lt;li&gt;I've gone from 1 line of code to &lt;em&gt;9 lines of code&lt;/em&gt;.  That's 9x the code for increasing the number of variables in play by 1.  That's... heavy.&lt;/li&gt;&lt;li&gt;This third point only applies if you're using TypeScript (and I am): I have to specify the types of my variables up front if I want type safety.&lt;/li&gt;&lt;/ul&gt; &lt;p&gt;ES2015 gives us another option.  We can move back to the ternary operator if we change the return type of each branch to be an object sharing the same signature.  Then, using destructuring, we can pull out those object properties into &lt;code&gt;const&lt;/code&gt;s:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;const { legWear, coat } = (weather === "good") &lt;br /&gt;  ? { legWear: "shorts", coat: false }&lt;br /&gt;  : { legWear: "jeans", coat: true }&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;With this approach we're keeping usage of &lt;code&gt;const&lt;/code&gt; instead of &lt;code&gt;let&lt;/code&gt; and we're only marginally increasing the amount of code we're writing. If you're using TypeScript you're back to being able to rely on the compiler correctly inferring your types; you don't need to specify.  Awesome.&lt;/p&gt; &lt;h4&gt;Crowdfund You A Tuple&lt;/h4&gt; &lt;p&gt;I thought I was done and then I saw this:&lt;/p&gt; &lt;blockquote class="twitter-tweet" data-lang="en"&gt;&lt;p lang="en" dir="ltr"&gt;&lt;a href="https://twitter.com/johnny_reilly"&gt;@johnny_reilly&lt;/a&gt; even neater with tuples:&lt;br&gt;&lt;br&gt;const [str, num] = test ? [&amp;quot;yes&amp;quot;, 100] : [&amp;quot;no&amp;quot;, 50];&lt;/p&gt;&amp;mdash; Illustrated Pamphlet (@Rickenhacker) &lt;a href="https://twitter.com/Rickenhacker/status/766913766323781632"&gt;August 20, 2016&lt;/a&gt;&lt;/blockquote&gt;&lt;script async src="//platform.twitter.com/widgets.js" charset="utf-8"&gt;&lt;/script&gt; &lt;p&gt;&lt;a href="https://twitter.com/Rickenhacker"&gt;Daniel&lt;/a&gt; helpfully points out that there's an even terser syntax available to us:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;const [ legWear, coat ] = (weather === "good") &lt;br /&gt;  ? [ "shorts", false ]&lt;br /&gt;  : [ "jeans",  true  ]&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;The above is ES2015 array destructuring.  We get exactly the same effect but it's a little terser as we don't have to repeat the prop names as we do when using object destructuring.  From a TypeScript perspective the assignment side of the above is a &lt;a href="https://github.com/Microsoft/TypeScript/pull/428"&gt;Tuple&lt;/a&gt; which allows our type inference to flow through in the manner we'd hope.&lt;/p&gt; &lt;p&gt;Lovely. Thanks!&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3672612150521698305'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3672612150521698305'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2016/08/the-ternary-operator-meets-destructuring.html' title='The Ternary Operator &amp;lt;3 Destructuring'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-935210636724170619</id><published>2016-07-23T11:25:00.001+01:00</published><updated>2021-03-04T06:15:03.760Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='compile-time constants'/><category scheme='http://www.blogger.com/atom/ns#' term='TypeScript'/><category scheme='http://www.blogger.com/atom/ns#' term='defineplugin'/><category scheme='http://www.blogger.com/atom/ns#' term='Webpack'/><title type='text'>Understanding Webpack's DefinePlugin (and using with TypeScript)</title><content type='html'>&lt;p&gt;I've been searching for a way to describe what the DefinePlugin actually does.  The &lt;a href="https://github.com/webpack/docs/wiki/list-of-plugins#defineplugin"&gt;docs&lt;/a&gt; say*:&lt;/p&gt; &lt;blockquote cite="https://github.com/webpack/docs/wiki/list-of-plugins#defineplugin"&gt;&lt;p&gt;Define free variables. Useful for having development builds with debug logging or adding global constants.&lt;/p&gt;&lt;/blockquote&gt; &lt;sub&gt;* Actually that should read "used to say".  I've made some changes to the official docs.... (Surprisingly easy to do that by the way; it's just a wiki you can edit at will.)&lt;/sub&gt; &lt;p&gt;I think I would describe it thusly: the DefinePlugin allows you to create global constants which can be &lt;em&gt;configured at compile time&lt;/em&gt;.  I find this very useful for allowing different behaviour between development builds and release builds.  This post will demonstrate usage of this approach, talk about what's actually happening and how to get this working nicely with TypeScript.&lt;/p&gt; &lt;p&gt;If you just want to see this in action then take a look at this &lt;a href="https://github.com/johnnyreilly/poorclaresarundel/"&gt;repo&lt;/a&gt; and keep your eyes open for usage of &lt;a href="https://github.com/johnnyreilly/poorclaresarundel/search?utf8=%E2%9C%93&amp;q=__VERSION__"&gt;&lt;code&gt;__VERSION__&lt;/code&gt;&lt;/a&gt; and &lt;a href="https://github.com/johnnyreilly/poorclaresarundel/search?utf8=%E2%9C%93&amp;q=__IN_DEBUG__"&gt;&lt;code&gt;__IN_DEBUG__&lt;/code&gt;&lt;/a&gt;.&lt;/p&gt; &lt;h4&gt;What Globals?&lt;/h4&gt; &lt;p&gt;For our example we want to define 2 global constants; a string called &lt;code&gt;__VERSION__&lt;/code&gt; and a boolean called &lt;code&gt;__IN_DEBUG__&lt;/code&gt;.  The names are deliberately wacky to draw attention to the fact that these are not your everyday, common-or-garden variables.  Them's "special". These constants will be initialised with different values depending on whether we are in a debug build or a production build.  Usage of these constants in our code might look like this:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;    if (__IN_DEBUG__) {&lt;br /&gt;        console.log(`This app is version ${ __VERSION__ }`);&lt;br /&gt;    }&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;So, if &lt;code&gt;__IN_DEBUG__&lt;/code&gt; is set to &lt;code&gt;true&lt;/code&gt; this code would log out to the console the version of the app.&lt;/p&gt; &lt;h4&gt;Configuring our Globals&lt;/h4&gt; &lt;p&gt;To introduce these constants to webpack we're going to add this to our webpack configuration:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;var webpack = require('webpack');&lt;br /&gt;&lt;br /&gt;// ...&lt;br /&gt;&lt;br /&gt;  plugins: [ &lt;br /&gt;      new webpack.DefinePlugin({&lt;br /&gt;          __IN_DEBUG__: JSON.stringify(false),&lt;br /&gt;          __VERSION__: JSON.stringify('1.0.0.' + Date.now())&lt;br /&gt;      }),&lt;br /&gt;      // ...&lt;br /&gt;  ]&lt;br /&gt;// ...&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;What's going on here?  Well, each key of the object literal above represents one of our global constants.  When you look at the value, just imagine each outer &lt;code&gt;JSON.stringify( ... )&lt;/code&gt; is not there.  It's just noise.  Imagine instead that you're seeing this:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;          __IN_DEBUG__: false,&lt;br /&gt;          __VERSION__: '1.0.0.' + Date.now()&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;A little clearer, right?  &lt;code&gt;__IN_DEBUG__&lt;/code&gt; is given the boolean value &lt;code&gt;false&lt;/code&gt; and &lt;code&gt;__VERSION__&lt;/code&gt; is given the string value of &lt;code&gt;1.0.0.&lt;/code&gt; plus the ticks off of &lt;code&gt;Date.now()&lt;/code&gt;.  What's happening here is well explained in Pete Hunt's excellent &lt;a href="https://github.com/petehunt/webpack-howto#6-feature-flags"&gt;webpack howto&lt;/a&gt;: "definePlugin takes raw strings and inserts them". &lt;code&gt;JSON.stringify&lt;/code&gt; facilitates this; it produces a string representation of a value that can be inlined into code.  When the inlining takes place the actual output would be something like this:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;    if (false) { // Because at compile time, __IN_DEBUG__ === false&lt;br /&gt;        console.log(`This app is version ${ "1.0.0.1469268116580" }`); // And __VERSION__ === "1.0.0.1469268116580"&lt;br /&gt;    }&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;And if you've got some &lt;a href="https://github.com/mishoo/UglifyJS"&gt;UglifyJS&lt;/a&gt; or similar in the mix then, in the example above, this would actually strip out the statement above entirely since it's clearly a &lt;a href="https://en.wikipedia.org/wiki/NOP"&gt;NOOP&lt;/a&gt;. Yay the dead code removal!  If &lt;code&gt;__IN_DEBUG__&lt;/code&gt; was &lt;code&gt;false&lt;/code&gt; then (perhaps obviously) this statement would be left in place as it wouldn't be dead code.&lt;/p&gt; &lt;h4&gt;TypeScript and Define&lt;/h4&gt; &lt;p&gt;The final piece of the puzzle is making TypeScript happy.  It doesn't know anything about our global constants. So we need to tell it:&lt;/p&gt; &lt;pre class="prettyprint ts"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;declare var __IN_DEBUG__: boolean;&lt;br /&gt;declare var __VERSION__: string;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;And that's it.  Compile time constants are a go!&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/935210636724170619'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/935210636724170619'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2016/07/using-webpacks-defineplugin-with-typescript.html' title='Understanding Webpack&apos;s DefinePlugin (and using with TypeScript)'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1879344640099675061</id><published>2016-06-02T12:41:00.001+01:00</published><updated>2021-03-04T06:16:59.693Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='TypeScript'/><category scheme='http://www.blogger.com/atom/ns#' term='ES6'/><category scheme='http://www.blogger.com/atom/ns#' term='Array'/><category scheme='http://www.blogger.com/atom/ns#' term='ES2015'/><category scheme='http://www.blogger.com/atom/ns#' term='Map'/><title type='text'>Creating an ES2015 Map from an Array in TypeScript</title><content type='html'>&lt;p&gt;I'm a great lover of ES2015's &lt;code&gt;&lt;a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map"&gt;Map&lt;/a&gt;&lt;/code&gt;.  However, just recently I tumbled over something I find a touch inconvenient about how you initialise a new &lt;code&gt;Map&lt;/code&gt; from the contents of an &lt;code&gt;Array&lt;/code&gt; in TypeScript.&lt;/p&gt; &lt;h4&gt;This Doesn't Work&lt;/h4&gt; &lt;p&gt;We're going try to something like this: (pilfered from the MDN docs)&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;var kvArray = [["key1", "value1"], ["key2", "value2"]];&lt;br /&gt;&lt;br /&gt;// Use the regular Map constructor to transform a 2D key-value Array into a map&lt;br /&gt;var myMap = new Map(kvArray);&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Simple enough right? Well I'd rather assumed that I should be able to do something like this in TypeScript:&lt;/p&gt; &lt;pre class="prettyprint ts"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;const iAmAnArray [&lt;br /&gt;  { value: "value1", text: "hello" }&lt;br /&gt;  { value: "value2", text: "map" }&lt;br /&gt;];&lt;br /&gt;&lt;br /&gt;const iAmAMap = new Map&amp;lt;string, string&amp;gt;(&lt;br /&gt;  iAmAnArray.map(x =&gt; [x.value, x.text])&lt;br /&gt;);&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;However, to my surprise this errored out with:&lt;/p&gt; &lt;pre class="prettyprint"&gt;&lt;br /&gt;&lt;code class="language"&gt;&lt;br /&gt;[ts] Argument of type 'string[][]' is not assignable to parameter of type 'Iterable&amp;lt;[string, string]&amp;gt;'.&lt;br /&gt;  Types of property '[Symbol.iterator]' are incompatible.&lt;br /&gt;    Type '() =&amp;gt; IterableIterator&amp;lt;string[]&amp;gt;' is not assignable to type '() =&amp;gt; Iterator&amp;lt;[string, string]&amp;gt;'.&lt;br /&gt;      Type 'IterableIterator&amp;lt;string[]&amp;gt;' is not assignable to type 'Iterator&amp;lt;[string, string]&amp;gt;'.&lt;br /&gt;        Types of property 'next' are incompatible.&lt;br /&gt;          Type '(value?: any) =&amp;gt; IteratorResult&amp;lt;string[]&amp;gt;' is not assignable to type '(value?: any) =&amp;gt; IteratorResult&amp;lt;[string, string]&amp;gt;'.&lt;br /&gt;            Type 'IteratorResult&amp;lt;string[]&amp;gt;' is not assignable to type 'IteratorResult&amp;lt;[string, string]&amp;gt;'.&lt;br /&gt;              Type 'string[]' is not assignable to type '[string, string]'.&lt;br /&gt;                Property '0' is missing in type 'string[]'.&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Disappointing right? It's expecting &lt;code&gt;Iterable&amp;lt;[string, string]&amp;gt;&lt;/code&gt; and an &lt;code&gt;Array&lt;/code&gt; with 2 elements that are strings is &lt;em&gt;not&lt;/em&gt; inferred to be that.&lt;/p&gt; &lt;h4&gt;This Does&lt;/h4&gt; &lt;p&gt;It emerges that there is a way to do this though; you just need to give the compiler a clue.  You need to include a type assertion of &lt;code&gt; as [string, string]&lt;/code&gt; which tells the compiler that what you've just declared is a &lt;code&gt;Tuple&lt;/code&gt; of &lt;code&gt;string&lt;/code&gt; and &lt;code&gt;string&lt;/code&gt;. (Please note that &lt;code&gt;[string, string]&lt;/code&gt; corresponds to the types of the &lt;code&gt;Key&lt;/code&gt; and &lt;code&gt;Value&lt;/code&gt; of your &lt;code&gt;Map&lt;/code&gt; and should be set accordingly.)&lt;/p&gt; &lt;p&gt;So a working version of the code looks like this:&lt;/p&gt; &lt;pre class="prettyprint ts"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;const iAmAnArray [&lt;br /&gt;  { value: "value1", text: "hello" }&lt;br /&gt;  { value: "value2", text: "map" }&lt;br /&gt;];&lt;br /&gt;&lt;br /&gt;const iAmAMap = new Map&amp;lt;string, string&amp;gt;(&lt;br /&gt;  iAmAnArray.map(x =&gt; [x.value, x.text] as [string, string])&lt;br /&gt;);&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Or, to be terser, this:&lt;/p&gt; &lt;pre class="prettyprint ts"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;const iAmAnArray [&lt;br /&gt;  { value: "value1", text: "hello" }&lt;br /&gt;  { value: "value2", text: "map" }&lt;br /&gt;];&lt;br /&gt;&lt;br /&gt;const iAmAMap = new Map( // Look Ma!  No type annotations&lt;br /&gt;  iAmAnArray.map(x =&gt; [x.value, x.text] as [string, string])&lt;br /&gt;);&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;I've raised this as an issue with the TypeScript team; you can find details &lt;a href="https://github.com/Microsoft/TypeScript/issues/8936"&gt;here&lt;/a&gt;.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1879344640099675061'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1879344640099675061'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2016/06/create-es2015-map-from-array-in-typescript.html' title='Creating an ES2015 Map from an Array in TypeScript'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2292734720316736685</id><published>2016-05-24T06:30:00.001+01:00</published><updated>2021-03-04T06:18:20.292Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='provideplugin'/><category scheme='http://www.blogger.com/atom/ns#' term='jquery'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='jqlite'/><category scheme='http://www.blogger.com/atom/ns#' term='Angular'/><category scheme='http://www.blogger.com/atom/ns#' term='Webpack'/><title type='text'>The Mysterious Case of Webpack, Angular and jQuery</title><content type='html'>&lt;p&gt;You may know that &lt;a href="https://docs.angularjs.org/api/ng/function/angular.element"&gt;Angular ships with a cutdown version of jQuery called jQLite&lt;/a&gt;.  It's still possible to use the full-fat jQuery; to quote the docs:&lt;/p&gt; &lt;blockquote cite="https://docs.angularjs.org/api/ng/function/angular.element"&gt;&lt;p&gt;To use &lt;code&gt;jQuery&lt;/code&gt;, simply ensure it is loaded before the &lt;code&gt;angular.js&lt;/code&gt; file. &lt;/p&gt;&lt;/blockquote&gt; &lt;p&gt;Now the wording rather implies that you're not using any module loader / bundler.  Rather that all files are being loaded via &lt;code&gt;script&lt;/code&gt; tags and relies on the global variables that result from that.  True enough, if you take a look at the &lt;a href="https://github.com/angular/angular.js/blob/eaa1119d4252bed08dfa42f984ef9502d0f02775/src/Angular.js#L1791"&gt;Angular source&lt;/a&gt; you can see how this works:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;  // bind to jQuery if present;&lt;br /&gt;  var jqName = jq();&lt;br /&gt;  jQuery = isUndefined(jqName) ? window.jQuery :   // use jQuery (if present)&lt;br /&gt;           !jqName             ? undefined     :   // use jqLite&lt;br /&gt;                                 window[jqName];   // use jQuery specified by `ngJq`&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Amongst other things it looks for a &lt;code&gt;jQuery&lt;/code&gt; variable which has been placed onto the &lt;code&gt;window&lt;/code&gt; object.  If it is found then jQuery is used; if it is not then it's &lt;code&gt;jqLite&lt;/code&gt; all the way.&lt;/p&gt; &lt;h4&gt;But wait! I'm using webpack&lt;/h4&gt; &lt;p&gt;Me too! And one of the reasons is that we get to move away from reliance upon the global scope and towards proper modularisation. So how do we get Angular to use jQuery given the code we've seen above?  Well, your first thought might be to &lt;code&gt;npm install&lt;/code&gt; yourself some &lt;code&gt;jQuery&lt;/code&gt; and then make sure you've got something like this in your entry file:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;import "jquery"; // This'll fix it... Right?&lt;br /&gt;import * as angular from "angular";&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Wrong.&lt;/p&gt; &lt;h4&gt;You need the &lt;code&gt;ProvidePlugin&lt;/code&gt;&lt;/h4&gt; &lt;p&gt;In your &lt;code&gt;webpack.config.js&lt;/code&gt; you need to add the following entry to your plugins:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;      new webpack.ProvidePlugin({&lt;br /&gt;          "window.jQuery": "jquery"&lt;br /&gt;      }),&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;This uses the webpack &lt;code&gt;&lt;a href="https://github.com/webpack/docs/wiki/list-of-plugins#provideplugin"&gt;ProvidePlugin&lt;/a&gt;&lt;/code&gt; and, at the point of webpackification (&amp;copy; 2016 John Reilly) all references in the code to &lt;code&gt;window.jQuery&lt;/code&gt; will be replaced with a reference to the webpack module that contains jQuery.  So when you look at the bundled file you'll see that the code that checks the &lt;code&gt;window&lt;/code&gt; object for &lt;code&gt;jQuery&lt;/code&gt; has become this:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;  jQuery = isUndefined(jqName) ? __webpack_provided_window_dot_jQuery :   // use jQuery (if present)&lt;br /&gt;           !jqName             ? undefined     :   // use jqLite&lt;br /&gt;                                 window[jqName];   // use jQuery specified by `ngJq`&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;That's right; webpack is providing Angular with jQuery whilst still &lt;em&gt;not&lt;/em&gt; placing a &lt;code&gt;jQuery&lt;/code&gt; variable onto the &lt;code&gt;window&lt;/code&gt;.  Neat huh?&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2292734720316736685'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2292734720316736685'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2016/05/the-mysterious-case-of-webpack-angular-and-jquery.html' title='The Mysterious Case of Webpack, Angular and jQuery'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4726187146162979494</id><published>2016-05-13T06:37:00.001+01:00</published><updated>2021-03-04T06:24:06.861Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='raw-loader'/><category scheme='http://www.blogger.com/atom/ns#' term='Angular'/><category scheme='http://www.blogger.com/atom/ns#' term='templatecache'/><category scheme='http://www.blogger.com/atom/ns#' term='Webpack'/><title type='text'>Inlining Angular Templates with WebPack and TypeScript</title><content type='html'>&lt;p&gt;This technique actually applies to pretty much any web stack where you have to supply templates; it just so happens that I'm using Angular 1.x in this case. Also I have an extra technique which is useful to handle the &lt;a href="https://docs.angularjs.org/api/ng/directive/ngInclude"&gt;ng-include&lt;/a&gt; scenario.&lt;/p&gt; &lt;h4&gt;Preamble&lt;/h4&gt; &lt;p&gt;For some time I've been using webpack to bundle my front end.  I write ES6 TypeScript; import statements and all.  This is all sewn together using the glorious &lt;a href="https://www.npmjs.com/package/ts-loader"&gt;ts-loader&lt;/a&gt; to compile and emit ES6 code which is handed off to the wonderful &lt;a href="https://www.npmjs.com/package/babel-loader"&gt;babel-loader&lt;/a&gt; which transpiles it to ESold code.  All with full source map support.  It's wonderful.&lt;/p&gt; &lt;p&gt;However, up until now I've been leaving Angular to perform the relevant http requests at runtime when it needs to pull in templates.  That works absolutely fine but my preference is to preload those templates.  In fact I've &lt;a href="http://blog.johnnyreilly.com/2015/02/using-gulp-in-asp-net-instead-of-web-optimization.html"&gt;written before&lt;/a&gt; about using the &lt;a href="https://www.npmjs.com/package/gulp-angular-templatecache"&gt;gulp angular template cache&lt;/a&gt; to achieve just that aim.&lt;/p&gt; &lt;p&gt;So I was wondering; in this modular world what would be the equivalent approach?  Sure I could still use the gulp angular template cache approach but I would like something a little more deliberate and a little less magic. Also, I've discovered (to my cost) that when using the existing approach, it's possible to break the existing implementation without realising it; only finding out there's a problem in Production when unexpected http requests start happening.  Finding these problems out at compile time rather than runtime is always to be strived for.  So how?&lt;/p&gt; &lt;h4&gt;&lt;a href="https://www.npmjs.com/package/raw-loader"&gt;raw-loader&lt;/a&gt;!&lt;/h4&gt; &lt;p&gt;raw-loader allows you load file content using &lt;code&gt;require&lt;/code&gt; statements.  This works well with the use case of inlining html. So I drop it into my &lt;code&gt;webpack.config.js&lt;/code&gt; like so:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;var path = require('path');&lt;br /&gt;&lt;br /&gt;module.exports = {&lt;br /&gt;    cache: true,&lt;br /&gt;    entry: {&lt;br /&gt;        main: './src/main.ts',&lt;br /&gt;&lt;br /&gt;        vendor: [&lt;br /&gt;          'babel-polyfill',&lt;br /&gt;          'angular',&lt;br /&gt;          'angular-animate',&lt;br /&gt;          'angular-sanitize',&lt;br /&gt;          'angular-ui-bootstrap',&lt;br /&gt;          'angular-ui-router'&lt;br /&gt;        ]&lt;br /&gt;    },&lt;br /&gt;    output: {&lt;br /&gt;        path: path.resolve(__dirname, './dist/scripts'),&lt;br /&gt;        filename: '[name].js',&lt;br /&gt;        chunkFilename: '[chunkhash].js'&lt;br /&gt;    },&lt;br /&gt;    module: {&lt;br /&gt;        loaders: [{&lt;br /&gt;            test: /\.ts(x?)$/,&lt;br /&gt;            exclude: /node_modules/,&lt;br /&gt;            loader: 'babel-loader?presets[]=es2015!ts-loader'&lt;br /&gt;        }, {&lt;br /&gt;            test: /\.js$/,&lt;br /&gt;            exclude: /node_modules/,&lt;br /&gt;            loader: 'babel',&lt;br /&gt;            query: {&lt;br /&gt;                presets: ['es2015']&lt;br /&gt;            }&lt;br /&gt;        }, { // THIS IS THE MAGIC!&lt;br /&gt;            test: /\.html$/,&lt;br /&gt;            exclude: /node_modules/,&lt;br /&gt;            loader: 'raw'&lt;br /&gt;        }]  // THAT WAS THE MAGIC!&lt;br /&gt;    },&lt;br /&gt;    plugins: [&lt;br /&gt;      // ....&lt;br /&gt;    ],&lt;br /&gt;    resolve: {&lt;br /&gt;        extensions: ['', '.ts', '.tsx', '.js']&lt;br /&gt;    }&lt;br /&gt;};&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;With this in place, if someone requires a file with the &lt;code&gt;html&lt;/code&gt; suffix then raw-loader comes in. So now we can swap this:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;  $stateProvider&lt;br /&gt;    .state('state1', {&lt;br /&gt;      url: "/state1",&lt;br /&gt;      templateUrl: "partials/state1.html"&lt;br /&gt;    })&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;For this:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;  $stateProvider&lt;br /&gt;    .state('state1', {&lt;br /&gt;      url: "/state1",&lt;br /&gt;      template: require("./partials/state1.html")&lt;br /&gt;    })&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Now initially TypeScript is going to complain about your &lt;code&gt;require&lt;/code&gt; statement.  That's fair; outside of node-land it doesn't know what &lt;code&gt;require&lt;/code&gt; is.  No bother, you just need to drop in a one line simple definition file to sort this out; let me present &lt;code&gt;webpack-require.d.ts&lt;/code&gt;:&lt;/p&gt; &lt;pre class="prettyprint ts"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;declare var require: (filename: string) =&amp;gt; any;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;You've now inlined your template.  And for bonus points, if you were to make a mistake in your path then webpack would shout at you at compile time; which is a &lt;em&gt;good, good&lt;/em&gt; thing.&lt;/p&gt; &lt;h4&gt;ng-include&lt;/h4&gt; &lt;p&gt;The one use case that this doesn't cover is where your templates import other templates through use of the &lt;a href="https://docs.angularjs.org/api/ng/directive/ngInclude"&gt;ng-include&lt;/a&gt; directive.  They will still trigger http requests as the templates are served. The simple way to prevent that is by priming the angular &lt;code&gt;&lt;a href="https://docs.angularjs.org/api/ng/service/$templateCache"&gt;$templateCache&lt;/a&gt;&lt;/code&gt; like so:&lt;/p&gt; &lt;pre class="prettyprint ts"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;  app.run(["$templateCache",&lt;br /&gt;    ($templateCache: ng.ITemplateCacheService) =&amp;gt; {&lt;br /&gt;        $templateCache.put("justSome.html", require("./justSome.html"));&lt;br /&gt;        // Other templates go here...&lt;br /&gt;    }]);&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Now when the app spins up it already has everything it needs pre-cached.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4726187146162979494'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4726187146162979494'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2016/05/inlining-angular-templates-with-webpack.html' title='Inlining Angular Templates with WebPack and TypeScript'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-829140544558412499</id><published>2016-04-25T05:30:00.001+01:00</published><updated>2021-03-04T06:19:33.497Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='unit testing'/><category scheme='http://www.blogger.com/atom/ns#' term='stub data'/><category scheme='http://www.blogger.com/atom/ns#' term='json.net'/><category scheme='http://www.blogger.com/atom/ns#' term='mock data'/><title type='text'>Instant Stubs with JSON.Net (just add hot water)</title><content type='html'>&lt;p&gt;I'd like you to close your eyes and imagine a scenario.  You're handed a prototype system.  You're told it works.  It has no documentation.  It has 0 unit tests.  The hope is that you can take it on, refactor it, make it better and (crucially) not break it. Oh, and you don't really understand what the code does or why it does it either; information on that front is, alas, sorely lacking.&lt;/p&gt; &lt;p&gt;This has happened to me; it's alas not that unusual.  The common advice handed out in this situation is: "add unit tests before you change it".  That's good advice.  We need to take the implementation that embodies the correctness of the system and create unit tests that set that implementation in stone. However, what say the system that you're hoping to add tests to takes a number of large and complex inputs from some external source and produces a similarly large and complex output?&lt;/p&gt; &lt;p&gt;You could start with integration tests.  They're good but slow and crucially they depend upon the external inputs being available and unchanged (which is perhaps unlikely). What you could do (what I have done) is debug a working working system. At each point that an input is obtained I have painstakingly transcribed the data which allows me to subsequently hand code stub data.  There comes a point when this is plainly untenable; it's just too much data to transcribe.  At this point the temptation is to think "it's okay; I can live without the tests. I'll just be super careful with my refactoring... It'll be fine It'll be fine It'll be fine It'll be fine".&lt;/p&gt; &lt;p&gt;Actually, it probably won't be fine.  And even if it is (miracles do happen) you're going to be fairly stressed as you wonder if you've been careful enough.  What if there was another way?  A way that wasn't quite so hard but that allowed you to add tests without requiring 3 months hand coding....&lt;/p&gt; &lt;h4&gt;Instant Stubs&lt;/h4&gt; &lt;p&gt;What I've come up with is a super simple utility class for creating stubs / fakes. (I'm aware the naming of such things &lt;a href="http://martinfowler.com/articles/mocksArentStubs.html"&gt;can be a little contentious&lt;/a&gt;.)&lt;/p&gt;   &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;using Newtonsoft.Json;&lt;br /&gt;using System;&lt;br /&gt;using System.IO;&lt;br /&gt;&lt;br /&gt;namespace MakeFakeData.UnitTests&lt;br /&gt;{&lt;br /&gt;  public static class Stubs&lt;br /&gt;  {&lt;br /&gt;    private static JsonSerializer _serializer = new JsonSerializer { NullValueHandling = NullValueHandling.Ignore };&lt;br /&gt;&lt;br /&gt;    public static void Make&amp;lt;T&amp;gt;(string stubPath, T data)&lt;br /&gt;    {&lt;br /&gt;      try&lt;br /&gt;      {&lt;br /&gt;        if (string.IsNullOrEmpty(stubPath))&lt;br /&gt;          throw new ArgumentNullException(nameof(stubPath));&lt;br /&gt;        if (data == null)&lt;br /&gt;          throw new ArgumentNullException(nameof(data));&lt;br /&gt;&lt;br /&gt;        using (var sw = new StreamWriter(stubPath))&lt;br /&gt;        using (var writer = new JsonTextWriter(sw) { &lt;br /&gt;            Formatting = Formatting.Indented, &lt;br /&gt;            IndentChar = ' ', &lt;br /&gt;            Indentation = 2})&lt;br /&gt;        {&lt;br /&gt;          _serializer.Serialize(writer, data);&lt;br /&gt;        }&lt;br /&gt;      }&lt;br /&gt;      catch (Exception exc)&lt;br /&gt;      {&lt;br /&gt;        throw new Exception($"Failed to make {stubPath}", exc);&lt;br /&gt;      }&lt;br /&gt;    }&lt;br /&gt;&lt;br /&gt;    public static T Load&amp;lt;T&amp;gt;(string stubPath)&lt;br /&gt;    {&lt;br /&gt;      try&lt;br /&gt;      {&lt;br /&gt;        if (string.IsNullOrEmpty(stubPath))&lt;br /&gt;          throw new ArgumentNullException(nameof(stubPath));&lt;br /&gt;&lt;br /&gt;        using (var file = File.OpenText(stubPath))&lt;br /&gt;        using (var reader = new JsonTextReader(file))&lt;br /&gt;        {&lt;br /&gt;          return _serializer.Deserialize&amp;lt;T&amp;gt;(reader);&lt;br /&gt;        }&lt;br /&gt;      }&lt;br /&gt;      catch (Exception exc)&lt;br /&gt;      {&lt;br /&gt;        throw new Exception($"Failed to load {stubPath}", exc);&lt;br /&gt;      }&lt;br /&gt;    }&lt;br /&gt;  }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;As you can see this class uses &lt;a href="http://www.newtonsoft.com/json"&gt;JSON.Net&lt;/a&gt; and exposes 2 methods:&lt;/p&gt; &lt;dl&gt;&lt;dt&gt;Make&lt;/dt&gt;&lt;dd&gt;Takes a given piece of data and uses JSON.Net to serialise it as JSON to a file. (nb I choose to format the JSON for readability and exclude null values; both totally optional)&lt;/dd&gt;&lt;dt&gt;Load&lt;/dt&gt;&lt;dd&gt;Takes the given path and loads the associated JSON file and deserialises it back into an object.&lt;/dd&gt;&lt;/dl&gt; &lt;p&gt;The idea is this: we take our working implementation and, wherever it extracts data from an external source, we insert a temporary statement like this:&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;    var data = _dataService.GetComplexData();&lt;br /&gt;&lt;br /&gt;    // Just inserted so we can generate the stub data...&lt;br /&gt;    Stubs.Make($"{System.AppDomain.CurrentDomain.BaseDirectory}\\data.json", data);&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;The next time you run the implementation you'll find the app generates a &lt;code&gt;data.json&lt;/code&gt; file containing the complex data serialized to JSON.  Strip out your &lt;code&gt;Stubs.Make&lt;/code&gt; statements from the implementation and we're ready for the next stage.&lt;/p&gt; &lt;h4&gt;Using your JSON&lt;/h4&gt; &lt;p&gt;What you need to do now is to take the new and shiny &lt;code&gt;data.json&lt;/code&gt; file and move it to your unit test project.  It needs to be included within the unit test project.  Also, for each JSON file you have, the &lt;code&gt;Build Action&lt;/code&gt; in VS needs to be set to &lt;code&gt;Content&lt;/code&gt; and the &lt;code&gt;Copy to Output Directory&lt;/code&gt; to &lt;code&gt;Copy if newer&lt;/code&gt;.&lt;/p&gt; &lt;p&gt;Then within your unit tests you can write code like this:&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;    var dummyData = Stubs.Load&amp;lt;ComplexDataType&amp;gt;("Stubs/data.json");&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Which pulls in your data from the JSON file and deserialises it into the original types.  With this in hand you can plug together a unit test based on an existing implementation which depends on external data much faster than the hand-cranked method of old.&lt;/p&gt; &lt;p&gt;Finally, before the wildebeest of TDD descend upon me howling and wailing, let me say again; I anticipate this being useful when you're trying to add tests to something that already exists but is untested.  Clearly it would be better not to be in this situaion in the first place.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/829140544558412499'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/829140544558412499'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2016/04/instant-stubs-with-jsonnet.html' title='Instant Stubs with JSON.Net (just add hot water)'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8493868315940139281</id><published>2016-04-10T09:44:00.003+01:00</published><updated>2016-04-10T09:44:56.240+01:00</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Angular welcome to the Typings Registry</title><content type='html'>https://github.com/typings/generator-typings</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8493868315940139281'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8493868315940139281'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3170009327421538092</id><published>2016-04-08T12:28:00.000+01:00</published><updated>2016-04-08T12:28:04.090+01:00</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Dealing with Embarrassing Failure</title><content type='html'>failed technical interview probably wouldn't have been good for me working from home  kato sameroom  no feedback  Dealing with Embarrassing Failure</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3170009327421538092'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3170009327421538092'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5544935898450667752</id><published>2016-03-22T21:41:00.003Z</published><updated>2021-03-04T06:25:51.794Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Enumerable'/><category scheme='http://www.blogger.com/atom/ns#' term='Concat'/><title type='text'>Elvis and King Concat</title><content type='html'>&lt;p&gt;I hate LINQ's &lt;code&gt;&lt;a href="https://msdn.microsoft.com/en-us/library/bb302894%28v=vs.110%29.aspx?f=255&amp;MSPPError=-2147217396"&gt;Enumerable.Concat&lt;/a&gt;&lt;/code&gt; when bringing together &lt;code&gt;IEnumerable&lt;/code&gt;s.  Not the behaviour (I love that!) but rather how code ends up looking when you use it. Consider this:&lt;/p&gt;   &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;var concatenated = myCollection?.Select(x =&amp;gt; new ConcatObj(x)) ?? new ConcatObj[0].Concat(&lt;br /&gt;    myOtherCollection?.Select(x =&amp;gt; new ConcatObj(x)) ?? new ConcatObj[0]&lt;br /&gt; );&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;In this example I'm bringing together 2 collections, either of which may be null (more on that later).  I think we can all agree this doesn't represent a world of readability. I've also had to create a custom class &lt;code&gt;ConcatObj&lt;/code&gt; because you can't create an empty array for an anonymous type in C#.&lt;/p&gt; &lt;h4&gt;Attempt #1: &lt;code&gt;ConcatMany&lt;/code&gt;&lt;/h4&gt; &lt;p&gt;After toying around with a bunch of different ideas I created this extension method:&lt;/p&gt;  &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;public static class FunctionalExtensions&lt;br /&gt;{&lt;br /&gt;    public static IEnumerable&amp;lt;T&amp;gt; ConcatMany&amp;lt;T&amp;gt;(&lt;br /&gt;        this IEnumerable&amp;lt;T&amp;gt; original,&lt;br /&gt;        params IEnumerable&amp;lt;T&amp;gt;[] enumerablesToConcat) =&amp;gt; original.Concat(&lt;br /&gt;            enumerablesToConcat.Where(e =&amp;gt; e != null).SelectMany(c =&amp;gt; c)&lt;br /&gt;        );&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt;  &lt;p&gt;Thanks to the joy of &lt;code&gt;params&lt;/code&gt; this extension allows me to bring together multiple IEnumerables into a single one but has the advantage of considerably cleaner calling code:&lt;/p&gt;   &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;var concatenated = Enumerable.Empty&amp;lt;ConcatObj&amp;gt;().ConcatMany(&lt;br /&gt;    myCollection?.Select(x =&amp;gt; new ConcatObj(x)),&lt;br /&gt;    myOtherCollection?.Select(x =&amp;gt; new ConcatObj(x))&lt;br /&gt;    );&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt;  &lt;p&gt;For my money this is more readable and intent is clearer.  Particularly as the number of contributing IEnumerables goes up.  The downside is that I cant use anonymous objects because you need to tell the compiler what the type is when using &lt;code&gt;&lt;a href="https://msdn.microsoft.com/en-us/library/bb341042%28v=vs.110%29.aspx?f=255&amp;MSPPError=-2147217396"&gt;Enumerable.Empty&lt;/a&gt;&lt;/code&gt;.&lt;/p&gt; &lt;p&gt;Wouldn't it be nice to have both:&lt;/p&gt; &lt;ol&gt;&lt;li&gt;Readable code and&lt;/li&gt;&lt;li&gt;Anonymous objects?&lt;/li&gt;&lt;/ol&gt; &lt;h4&gt;Attempt #2: &lt;code&gt;EnumerableExtensions.Create&lt;/code&gt;&lt;/h4&gt; &lt;p&gt;After batting round a few ideas (thanks Matt) I settled on this implementation:&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;public static class EnumerableExtensions&lt;br /&gt;{&lt;br /&gt;    public static IEnumerable&amp;lt;TSource&amp;gt; Create&amp;lt;TSource&amp;gt;(params IEnumerable&amp;lt;TSource&amp;gt;[] enumerables)&lt;br /&gt;    {&lt;br /&gt;        return Concat(enumerables.Where(e =&amp;gt; e != null));&lt;br /&gt;    }&lt;br /&gt;&lt;br /&gt;    private static IEnumerable&amp;lt;TSource&amp;gt; Concat&amp;lt;TSource&amp;gt;(IEnumerable&amp;lt;IEnumerable&amp;lt;TSource&amp;gt;&amp;gt; enumerables)&lt;br /&gt;    {&lt;br /&gt;        foreach (var enumerable in enumerables)&lt;br /&gt;        {&lt;br /&gt;            foreach (var item in enumerable)&lt;br /&gt;            {&lt;br /&gt;                yield return item;&lt;br /&gt;            }&lt;br /&gt;        }&lt;br /&gt;    }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Which allows for calling code like this:&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;var concatenated = EnumerableExtensions.Create(&lt;br /&gt;    myCollection?.Select(x =&amp;gt; new { Anonymous = x.Types }),&lt;br /&gt;    myOtherCollection?.Select(x =&amp;gt; new { Anonymous = x.Types })&lt;br /&gt;    );&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;That's right; anonymous types are back! Strictly speaking the &lt;code&gt;Concat&lt;/code&gt; method above could be converted into a single &lt;code&gt;SelectMany&lt;/code&gt; (and boy does ReSharper like telling me) but I'm quite happy with it as is.  And to be honest, I so rarely get to use &lt;code&gt;yield&lt;/code&gt; in my own code; I thought it might be nice to give it a whirl &amp;#X1f60a &lt;/p&gt; &lt;h4&gt;What Gives Elvis?&lt;/h4&gt; &lt;p&gt;If you look closely at the implementation you'll notice that I purge all &lt;code&gt;null&lt;/code&gt;s when I'm bringing together the &lt;code&gt;Enumerable&lt;/code&gt;s.  For why?  Some may legitimately argue this is a bad idea. However, there is method in my "bad practice".&lt;/p&gt; &lt;p&gt;I've chosen to treat &lt;code&gt;null&lt;/code&gt; as "not important" for this use case.  I'm doing this because it emerges that ASP.NET MVC deserialises empty collections as nulls. (See &lt;a href="http://aspnetwebstack.codeplex.com/SourceControl/latest#src/System.Web.Mvc/ValueProviderResult.cs"&gt;here&lt;/a&gt; and play spot the &lt;code&gt;return null;&lt;/code&gt;)  Which is a pain.  But thanks to the null purging behaviour of &lt;code&gt;EnumerableExtensions.Create&lt;/code&gt; I can trust in the &lt;a href="https://csharp.today/c-6-features-null-conditional-and-and-null-coalescing-operators/"&gt;null-conditional (Elvis)&lt;/a&gt; operator to not do me wrong.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5544935898450667752'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5544935898450667752'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2016/03/elvis-and-king-concat.html' title='Elvis and King Concat'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6233873048987017860</id><published>2016-03-17T06:00:00.000Z</published><updated>2016-03-17T09:09:22.609Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='apm'/><category scheme='http://www.blogger.com/atom/ns#' term='Atom'/><category scheme='http://www.blogger.com/atom/ns#' term='packages'/><category scheme='http://www.blogger.com/atom/ns#' term='corrupt'/><title type='text'>Atom - Recovering from Corrupted Packages</title><content type='html'>&lt;p&gt;Every now and then when I try and update my packages in &lt;a href="https://atom.io/"&gt;Atom&lt;/a&gt; I find this glaring back at me:&lt;/p&gt; &lt;a href="https://4.bp.blogspot.com/-t69IWPvBvfw/VupxTQuJroI/AAAAAAAAA6c/LzSeSZ8axL0j6_vkjnYdMwlNhu5H4xdCw/s1600/Screenshot%2B2016-03-17%2B06.17.03.png" imageanchor="1" &gt;&lt;img border="0" src="https://4.bp.blogspot.com/-t69IWPvBvfw/VupxTQuJroI/AAAAAAAAA6c/LzSeSZ8axL0j6_vkjnYdMwlNhu5H4xdCw/s640/Screenshot%2B2016-03-17%2B06.17.03.png" /&gt;&lt;/a&gt; &lt;p&gt;Ug.  The problem is that my atom packages have become corrupt.  Quite how I couldn't say.  But that's the problem. Atom, as I know from bitter experience, will not recover from this. It just sits there feeling sorry for itself.  However, getting back to where you belong is simpler than you imagine:&lt;/p&gt; &lt;ol&gt;&lt;li&gt;Shutdown Atom&lt;/li&gt;&lt;li&gt;In the file system go to &lt;code&gt;[Your name]/.atom&lt;/code&gt; (and bear in mind this is Windows; Macs / Linux may be different) &lt;a href="https://3.bp.blogspot.com/--YVoZCafXII/VupysHGAoRI/AAAAAAAAA6o/xIYfPVYAk7QGlXlxBxxQn6JZh2KlUzHNg/s1600/Screenshot%2B2016-03-17%2B06.17.53.png" imageanchor="1" &gt;&lt;img border="0" src="https://3.bp.blogspot.com/--YVoZCafXII/VupysHGAoRI/AAAAAAAAA6o/xIYfPVYAk7QGlXlxBxxQn6JZh2KlUzHNg/s640/Screenshot%2B2016-03-17%2B06.17.53.png" /&gt;&lt;/a&gt;&lt;/li&gt;&lt;li&gt;You'll see an &lt;code&gt;.apm&lt;/code&gt; folder that contains all your packages.  Delete this.&lt;/li&gt;&lt;/ol&gt; &lt;p&gt;When you next fire up Atom these packages will automagically come back but this time they shouldn't be corrupt. Instead you should see the happiness of normality restored:&lt;/p&gt; &lt;a href="https://3.bp.blogspot.com/-jRAGtqbjKNQ/VupzSKpSd4I/AAAAAAAAA6w/xSi_VdF-_5UJD5nNkLZ8Z0ep6bHPXREnw/s1600/Screenshot%2B2016-03-17%2B06.23.18.png" imageanchor="1" &gt;&lt;img border="0" src="https://3.bp.blogspot.com/-jRAGtqbjKNQ/VupzSKpSd4I/AAAAAAAAA6w/xSi_VdF-_5UJD5nNkLZ8Z0ep6bHPXREnw/s640/Screenshot%2B2016-03-17%2B06.23.18.png" /&gt;&lt;/a&gt; </content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/6233873048987017860'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/6233873048987017860'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2016/03/atom-recovering-from-corrupted-packages.html' title='Atom - Recovering from Corrupted Packages'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='https://4.bp.blogspot.com/-t69IWPvBvfw/VupxTQuJroI/AAAAAAAAA6c/LzSeSZ8axL0j6_vkjnYdMwlNhu5H4xdCw/s72-c/Screenshot%2B2016-03-17%2B06.17.03.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-296938479665689244</id><published>2016-03-11T11:41:00.001Z</published><updated>2016-03-11T11:41:24.578Z</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>JSON.mappify</title><content type='html'>   function jsonObjectToMap&lt;TKey, TValue&gt;(     jsonObject: { [index: string]: TValue },     keyMaker: (key: string) =&gt; TKey) {      const map = new Map&lt;TKey, TValue&gt;();     for (let k of Object.keys(jsonObject)) {         map.set(keyMaker(k), jsonObject[k]);     }     return map; }  Original idea from here:  http://www.2ality.com/2015/08/es6-map-json.html  Server serves you up a Dictionary&lt;int, ComplexObject&gt; example usage:  JSON.parse('{"5335":{"GoodField": "GoneBad"}}')   jsonObjectToMap(Validations, parseInt)</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/296938479665689244'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/296938479665689244'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-258547961149215930</id><published>2016-03-04T05:52:00.003Z</published><updated>2021-03-13T14:19:51.927Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='BuildDefinitionName'/><category scheme='http://www.blogger.com/atom/ns#' term='BuildNumber'/><category scheme='http://www.blogger.com/atom/ns#' term='npm'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Karma'/><category scheme='http://www.blogger.com/atom/ns#' term='powershell'/><category scheme='http://www.blogger.com/atom/ns#' term='trx'/><category scheme='http://www.blogger.com/atom/ns#' term='TFS 2012'/><title type='text'>TFS 2012 meet PowerShell, Karma and BuildNumber</title><content type='html'>&lt;p&gt;To my lasting regret, TFS 2012 has no direct support for PowerShell.  Such a shame as PowerShell scripts can do a lot of heavy lifting in a build process.  Well, here we're going to brute force TFS 2012 into running PowerShell scripts.  And along the way we'll also get Karma test results publishing into TFS 2012 as an example usage.  Nice huh?  Let's go!&lt;/p&gt; &lt;h4&gt;PowerShell via &lt;code&gt;csproj&lt;/code&gt;&lt;/h4&gt; &lt;p&gt;It's time to hack the &lt;code&gt;csproj&lt;/code&gt; (or whatever project file you have) again. We're going to add an &lt;code&gt;AfterBuild&lt;/code&gt; target to the end of the file.  This target will be triggered after the build completes (as the name suggests):&lt;/p&gt; &lt;pre class="prettyprint xml" style="font-size: 0.7em; word-wrap: break-word;"&gt;&lt;br /&gt;&lt;code class="language-xml"&gt;&lt;br /&gt;  &amp;lt;Target Name="AfterBuild"&amp;gt;&lt;br /&gt;    &amp;lt;Message Importance="High" Text="AfterBuild: PublishUrl = $(PublishUrl), BuildUri = $(BuildUri), Configuration = $(Configuration), ProjectDir = $(ProjectDir), TargetDir = $(TargetDir), TargetFileName = $(TargetFileName), BuildNumber = $(BuildNumber), BuildDefinitionName = $(BuildDefinitionName)" /&amp;gt;&lt;br /&gt;    &amp;lt;Exec Command="powershell.exe -NonInteractive -ExecutionPolicy RemoteSigned &amp;quot;&amp;amp; '$(ProjectDir)AfterBuild.ps1' '$(Configuration)' '$(ProjectDir)' '$(TargetDir)' '$(PublishUrl)' '$(BuildNumber)' '$(BuildDefinitionName)'&amp;quot;" /&amp;gt;&lt;br /&gt;  &amp;lt;/Target&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;There's 2 things happening in this target:&lt;/p&gt; &lt;ol&gt;&lt;li&gt;A message is printed out during compilation which contains details of the various compile time variables.  This is nothing more than a &lt;code&gt;console.log&lt;/code&gt; statement really; it's useful for debugging and so I keep it around. You'll notice one of them is called &lt;code&gt;$(BuildNumber)&lt;/code&gt;; more on that later.&lt;/li&gt;&lt;li&gt;A command is executed; PowerShell!  This invokes PowerShell with the &lt;code&gt;-NonInteractive&lt;/code&gt; and &lt;code&gt;-ExecutionPolicy RemoteSigned&lt;/code&gt; flags. It passes a script to be executed called &lt;code&gt;AfterBuild.ps1&lt;/code&gt; that lives in the root of the project directory. To that script a number of parameters are supplied; compile time variables that we may use in the script.&lt;/li&gt;&lt;/ol&gt; &lt;h4&gt;Where's my &lt;code&gt;BuildNumber&lt;/code&gt; and &lt;code&gt;BuildDefinitionName&lt;/code&gt;?&lt;/h4&gt; &lt;p&gt;So you've checked in your changes and kicked off a build on the server.  You're picking over the log messages and you're thinking: "Where's my &lt;code&gt;BuildNumber&lt;/code&gt;?".  Well, TFS 2012 does not have that set as a variable at compile time by default.  This stumped me for a while but thankfully I wasn't the only person wondering... As ever, &lt;a href="http://stackoverflow.com/a/7330453/761388"&gt;Stack Overflow had the answer&lt;/a&gt;.  So, deep breath, it's time to hack the TFS build template file.&lt;/p&gt; &lt;p&gt;Checkout the &lt;code&gt;DefaultTemplate.11.1.xaml&lt;/code&gt; file from TFS and open it in your text editor of choice.  It's &lt;i&gt;find and replace&lt;/i&gt; time! (There are probably 2 instances that need replacement.) Perform a &lt;i&gt;find&lt;/i&gt; for the below&lt;/p&gt; &lt;pre class="prettyprint" style="font-size: 0.7em; word-wrap: break-word;"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;[String.Format(&amp;amp;quot;/p:SkipInvalidConfigurations=true {0}&amp;amp;quot;, MSBuildArguments)]&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;And &lt;i&gt;replace&lt;/i&gt; it with this:&lt;/p&gt; &lt;pre class="prettyprint" style="font-size: 0.7em; word-wrap: break-word;"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;[String.Format(&amp;quot;/p:SkipInvalidConfigurations=true /p:BuildNumber={1} /p:BuildDefinitionName={2} {0}&amp;quot;, MSBuildArguments, BuildDetail.BuildNumber, BuildDetail.BuildDefinition.Name)]&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Pretty long line eh? Let's try breaking that up to make it more readable: (but remember in the XAML it needs to be a one liner)&lt;/p&gt; &lt;pre class="prettyprint" style="font-size: 0.7em; word-wrap: break-word;"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;[String.Format(&amp;quot;/p:SkipInvalidConfigurations=true &lt;br /&gt;    /p:BuildNumber={1} &lt;br /&gt;    /p:BuildDefinitionName={2} {0}&amp;quot;, MSBuildArguments, BuildDetail.BuildNumber, BuildDetail.BuildDefinition.Name)]&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt;  &lt;p&gt;We're just adding 2 extra parameters of &lt;code&gt;BuildNumber&lt;/code&gt; and &lt;code&gt;BuildDefinitionName&lt;/code&gt; to the invocation of MSBuild. Once we've checked this back in, &lt;code&gt;BuildNumber&lt;/code&gt; and &lt;code&gt;BuildDefinitionName&lt;/code&gt; will be available on future builds.  Yay! &lt;em&gt;Important! You must have a build name that does not feature spaces; probably there's a way to pass spaces here but I'm not sure what it is.&lt;/em&gt; &lt;/p&gt; &lt;h4&gt;&lt;code&gt;AfterBuild.ps1&lt;/code&gt;&lt;/h4&gt; &lt;p&gt;You can use your &lt;code&gt;AfterBuild.ps1&lt;/code&gt; script to do any number of things. In my case I'm going to use MSTest to publish some test results which have been generated by Karma into TFS:&lt;/p&gt; &lt;pre class="prettyprint ps" style="font-size: 0.7em; word-wrap: break-word;"&gt;&lt;br /&gt;&lt;code class="language-ps"&gt;&lt;br /&gt;param ([string]$configuration, [string]$projectDir, [string]$targetDir, [string]$publishUrl, [string]$buildNumber, [string] $buildDefinitionName)&lt;br /&gt;&lt;br /&gt;$ErrorActionPreference = 'Stop'&lt;br /&gt;Clear&lt;br /&gt;&lt;br /&gt;function PublishTestResults([string]$resultsFile) {&lt;br /&gt; Write-Host 'PublishTests'&lt;br /&gt; $mstest = 'C:\Program Files (x86)\Microsoft Visual Studio 14.0\Common7\IDE\MSTest.exe'&lt;br /&gt;&lt;br /&gt; Write-Host "Using $mstest at $pwd"&lt;br /&gt; Write-Host "Publishing: $resultsFile"&lt;br /&gt;&lt;br /&gt; &amp; $mstest /publishresultsfile:$resultsFile /publish:http://my-tfs-server:8080/tfs /teamproject:MyProject /publishbuild:$buildNumber /platform:'Any CPU' /flavor:Release&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;function FailBuildIfThereAreTestFailures([string]$resultsFile) {&lt;br /&gt; $results = [xml](GC $resultsFile)&lt;br /&gt; $outcome = $results.TestRun.ResultSummary.outcome&lt;br /&gt; $fgColor = if($outcome -eq "Failed") { "Red" } else { "Green" }&lt;br /&gt; $total = $results.TestRun.ResultSummary.Counters.total&lt;br /&gt; $passed = $results.TestRun.ResultSummary.Counters.passed&lt;br /&gt; $failed = $results.TestRun.ResultSummary.Counters.failed&lt;br /&gt;&lt;br /&gt; $failedTests = $results.TestRun.Results.UnitTestResult | Where-Object { $_.outcome -eq "Failed" }&lt;br /&gt;&lt;br /&gt; Write-Host Test Results: $outcome -ForegroundColor $fgColor -BackgroundColor "Black"&lt;br /&gt; Write-Host Total tests: $total&lt;br /&gt; Write-Host Passed: $passed&lt;br /&gt; Write-Host Failed: $failed&lt;br /&gt; Write-Host&lt;br /&gt;&lt;br /&gt; $failedTests | % { Write-Host Failed test: $_.testName&lt;br /&gt;  Write-Host $_.Output.ErrorInfo.Message&lt;br /&gt;  Write-Host $_.Output.ErrorInfo.StackTrace }&lt;br /&gt;&lt;br /&gt; Write-Host&lt;br /&gt;&lt;br /&gt; if($outcome -eq "Failed") { &lt;br /&gt;  Write-Host "Failing build as there are broken tests"&lt;br /&gt;  $host.SetShouldExit(1)&lt;br /&gt; }&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;function Run() {&lt;br /&gt;  Write-Host "Running AfterBuild.ps1 using Configuration: $configuration, projectDir: $projectDir, targetDir: $targetDir, publishUrl: $publishUrl, buildNumber: $buildNumber, buildDefinitionName: $buildDefinitionName"&lt;br /&gt;&lt;br /&gt; if($buildNumber) {&lt;br /&gt;  $resultsFile = "$projectDir\test-results.trx"&lt;br /&gt;  PublishTestResults $resultsFile&lt;br /&gt;  FailBuildIfThereAreTestFailures $resultsFile&lt;br /&gt; }&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;# Off we go...&lt;br /&gt;Run&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Assuming we have a build number this script kicks off the &lt;code&gt;PublishTestResults&lt;/code&gt; function above.  So we won't attempt to publish test results when compiling in Visual Studio on our dev machine.  The script looks for &lt;code&gt;MSTest.exe&lt;/code&gt; in a certain location on disk (the default VS 2015 installation location in fact; it may be installed elsewhere on your build machine). MSTest is then invoked and passed a file called &lt;code&gt;test-results.trx&lt;/code&gt; which is is expected to live in the root of the project.  All being well, the test results will be registered with the running build and will be visible when you look at test results in TFS.&lt;/p&gt; &lt;p&gt;Finally in &lt;code&gt;FailBuildIfThereAreTestFailures&lt;/code&gt; we parse the &lt;code&gt;test-results.trx&lt;/code&gt; file (and for this I'm totally in the debt of &lt;a href="https://gist.github.com/davidroberts63/5655441"&gt;David Robert's helpful Gist&lt;/a&gt;).  We write out the results to the host so it'll show up in the MSBuild logs.  Also, and this is crucial, if there are any failures we fail the build by exiting PowerShell with a code of 1.  We are deliberately swallowing any error that Karma raises earlier when it detects failed tests.  We do this because we want to publish the failed test results to TFS &lt;em&gt;before&lt;/em&gt; we kill the build.&lt;/p&gt; &lt;h4&gt;Bonus Karma: &lt;code&gt;test-results.trx&lt;/code&gt;&lt;/h4&gt; &lt;p&gt;If you've read a &lt;a href="https://blog.johnnyreilly.com/2016/02/visual-studio-tsconfigjson-and-external.html"&gt;previous post of mine&lt;/a&gt; you'll be aware that it's possible to get MSBuild to kick off npm build tasks. Specifically I have MSBuild kicking off an &lt;code&gt;npm run build&lt;/code&gt;.  My &lt;code&gt;package.json&lt;/code&gt; looks like this:&lt;/p&gt; &lt;pre class="prettyprint json" style="font-size: 0.7em; word-wrap: break-word;"&gt;&lt;br /&gt;&lt;code class="language-json"&gt;&lt;br /&gt;  "scripts": {&lt;br /&gt;    "test": "karma start --reporters mocha,trx --single-run --browsers PhantomJS",&lt;br /&gt;    "clean": "gulp delete-dist-contents",&lt;br /&gt;    "watch": "gulp watch",&lt;br /&gt;    "build": "gulp build",&lt;br /&gt;    "postbuild": "npm run test"&lt;br /&gt;  },&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;You can see that the &lt;code&gt;postbuild&lt;/code&gt; hook kicks off the &lt;code&gt;test&lt;/code&gt; script in turn. And that &lt;code&gt;test&lt;/code&gt; script kicks off a single run of karma.  I'm not going to go over setting up Karma at all here; there are other posts out there that cover that admirably.  But I wanted to share news of the  &lt;a href="https://www.npmjs.com/package/karma-trx-reporter"&gt;karma trx reporter&lt;/a&gt;. This reporter is the thing that produces our &lt;code&gt;test-results.trx&lt;/code&gt; file; trx being the format that TFS likes to deal with.&lt;/p&gt; &lt;p&gt;So now we've got a PowerShell hook into our build process (something very useful in itself) which we are using to publish Karma test results into TFS 2012.  They said it couldn't be done.  They were wrong.  Huzzah!!!!!!!&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/258547961149215930'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/258547961149215930'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2016/03/tfs-2012-meet-powershell-karma-and-buildnumber.html' title='TFS 2012 meet PowerShell, Karma and BuildNumber'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6429429046632227717</id><published>2016-02-29T10:13:00.002Z</published><updated>2021-03-04T06:29:42.235Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='ng-href'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='UI Router'/><category scheme='http://www.blogger.com/atom/ns#' term='Angular'/><category scheme='http://www.blogger.com/atom/ns#' term='ui-sref'/><title type='text'>Creating Angular UI Routes in the Controller</title><content type='html'>&lt;p&gt;So you're creating a link with the Angular UI Router.  You're passing more than a few parameters and it's getting kinda big.  Something like this:&lt;/p&gt; &lt;pre class="prettyprint xml"&gt;&lt;br /&gt;&lt;code class="language-xml"&gt;&lt;br /&gt;    &amp;lt;a class="contains-icon" &lt;br /&gt;       ui-sref="Entity.Edit({ entityId: (vm.selectedEntityId ? vm.selectedEntityId: null), initialData: vm.initialData })"&amp;gt;&lt;br /&gt;         &amp;lt;i class="fa fa-pencil"&amp;gt;&amp;lt;/i&amp;gt;Edit&lt;br /&gt;    &amp;lt;/a&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;See?  It's too long to fit on the screen without wrapping.  It's clearly mad and bad.&lt;/p&gt; &lt;p&gt;Generally I try to keep the logic in a view to a minimum.  It makes the view harder to read, it makes behaviour of the app harder to reason about.  Also, it's not testable and (if you're using some kind of static typing like TypeScript) it is entirely out of the realms that a compiler can catch. So what to do?  Move the URL generation to the controller.  That's what I decided to do after I had a typo in my view which I didn't catch until post-commit.&lt;/p&gt; &lt;h4&gt;&lt;code&gt;ui-sref&lt;/code&gt; in the Controller&lt;/h4&gt; &lt;p&gt;Actually, that's not exactly what you want to do.  If you look at the &lt;a href="http://angular-ui.github.io/ui-router/site/#/api/ui.router.state.directive:ui-sref"&gt;Angular UI Router docs&lt;/a&gt; you will see that &lt;code&gt;ui-sref&lt;/code&gt; is:&lt;/p&gt; &lt;blockquote cite="http://angular-ui.github.io/ui-router/site/#/api/ui.router.state.directive:ui-sref"&gt;...a directive that binds a link (&lt;code&gt;&amp;lt;a&amp;gt;&lt;/code&gt; tag) to a state. If the state has an associated URL, the directive will automatically generate &amp; update the href attribute via the &lt;a href="http://angular-ui.github.io/ui-router/site/#/api/ui.router.state.$state#methods_href"&gt;&lt;code&gt;$state.href()&lt;/code&gt;&lt;/a&gt; method. &lt;/blockquote&gt; &lt;p&gt;So what we actually want to do is use the &lt;code&gt;$state.href()&lt;/code&gt; method in our controller. To take our example above we'll create another method on our controller called &lt;code&gt;getEditUrl&lt;/code&gt;&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;export class EntityController {&lt;br /&gt;&lt;br /&gt;    $state: angular.ui.IStateService;&lt;br /&gt;&lt;br /&gt;    static $inject = ["$state"];&lt;br /&gt;    constructor($state: angular.ui.IStateService) {&lt;br /&gt;        this.$state = $state;&lt;br /&gt;    }&lt;br /&gt;&lt;br /&gt;    //... Other stuff&lt;br /&gt;&lt;br /&gt;    getEditUrl() {&lt;br /&gt;        return this.$state.href("Entity.Edit", { &lt;br /&gt;            selectedEntityId: this.selectedEntityId ? this.selectedEntityId: null, &lt;br /&gt;            initialData: this.initialData &lt;br /&gt;        });&lt;br /&gt;    }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;You can see I'm using TypeScript here; but feel free to strip out the type annotations and go with raw ES6 classes; that'll still give you testability if not static typing.&lt;/p&gt; &lt;p&gt;Now we've added the &lt;code&gt;getEditUrl&lt;/code&gt; method we just need to reference it in our view:&lt;/p&gt; &lt;pre class="prettyprint xml"&gt;&lt;br /&gt;&lt;code class="language-xml"&gt;&lt;br /&gt;    &amp;lt;a class="contains-icon" ng-href="{{vm.getEditUrl()}}"&amp;gt;&amp;lt;i class="fa fa-pencil"&amp;gt;&amp;lt;/i&amp;gt;Edit&amp;lt;/a&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Note we've ditched usage of the &lt;code&gt;ui-sref&lt;/code&gt; directive and gone with Angular's native &lt;code&gt;&lt;a href="https://docs.angularjs.org/api/ng/directive/ngHref"&gt;ng-href&lt;/a&gt;&lt;/code&gt;.  Within that directive we execute our &lt;code&gt;getEditUrl&lt;/code&gt; as an expression which gives us our route. As a bonus, our view is much less cluttered and comprehensible as a result.  How lovely.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/6429429046632227717'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/6429429046632227717'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2016/02/creating-angular-ui-routes-in-controller.html' title='Creating Angular UI Routes in the Controller'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8275761095158290834</id><published>2016-02-19T07:30:00.003Z</published><updated>2021-03-13T14:43:30.482Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='TFS'/><category scheme='http://www.blogger.com/atom/ns#' term='Visual Studio'/><category scheme='http://www.blogger.com/atom/ns#' term='tsconfig.json'/><category scheme='http://www.blogger.com/atom/ns#' term='TypeScript'/><category scheme='http://www.blogger.com/atom/ns#' term='Webpack'/><title type='text'>Visual Studio, tsconfig.json and external TypeScript compilation</title><content type='html'>&lt;p&gt;TypeScript first gained support for &lt;a href="https://github.com/Microsoft/TypeScript/wiki/tsconfig.json"&gt;&lt;code&gt;tsconfig.json&lt;/code&gt;&lt;/a&gt; back with the &lt;a href="https://blogs.msdn.microsoft.com/typescript/2015/07/20/announcing-typescript-1-5/"&gt;1.5 release&lt;/a&gt;.  However, to my lasting regret and surprise Visual Studio will not be gaining meaningful support for it until &lt;a href="https://github.com/Microsoft/TypeScript/wiki/What%27s-new-in-TypeScript#improved-support-for-tsconfigjson-in-visual-studio-2015"&gt;TypeScript 1.8&lt;/a&gt; ships.  However, if you want it now, it's already available to use in &lt;a href="https://blogs.msdn.microsoft.com/typescript/2016/01/28/announcing-typescript-1-8-beta/"&gt;beta&lt;/a&gt;.&lt;/p&gt; &lt;p&gt;I've already leapt aboard.  Whilst there's a number of bugs in the beta it's still totally usable. So use it.&lt;/p&gt; &lt;h4&gt;External TypeScript Compilation and the VS build&lt;/h4&gt; &lt;p&gt;Whilst &lt;code&gt;tsconfig.json&lt;/code&gt; is useful and super cool it has limitations. It allows you to deactivate compilation upon file saving using &lt;a href="https://github.com/Microsoft/TypeScript/issues/2326#issuecomment-178294169"&gt;&lt;code&gt;compileOnSave&lt;/code&gt;&lt;/a&gt;.  &lt;a href="https://github.com/Microsoft/TypeScript/issues/7091"&gt;What it doesn't allow is deactivation of the TypeScript compilation that happens as part of a Visual Studio build.&lt;/a&gt; That may not matter for the vanilla workflow of just dropping TypeScript files in a Visual Studio web project and having VS invoke the TypeScript compilation. However it comes to matter when your workflow deviates from the norm, as mine does.  Using external compilation of TypeScript within Visual Studio is a little tricky. My own use case is somewhat atypical but perhaps not uncommon.&lt;/p&gt;    &lt;p&gt;I'm working on a project which has been built using TypeScript since TS 0.9.  Not surprisingly, this started off using the default Visual Studio / TypeScript workflow.  Active development on the project ceased around 9 months ago.  Now it's starting up again.  It's a reasonable sized web app and the existing functionality is, in the main, fine. But the users want to add some new screens.&lt;/p&gt; &lt;p&gt;Like any developer, I want to build with the latest and greatest.  In my case, this means I want to write modular ES6 using TypeScript.  With this approach my code can be leaner and I have less script ordering drama in my life. (Yay import statements!)  This can be done by bringing together webpack, TypeScript (&lt;a href="https://github.com/TypeStrong/ts-loader"&gt;ts-loader&lt;/a&gt;) and &lt;a href="http://babeljs.io/"&gt;Babel&lt;/a&gt; (&lt;a href="https://github.com/babel/babel-loader"&gt;babel-loader&lt;/a&gt;).  There's an example of this approach &lt;a href="https://blog.johnnyreilly.com/2015/12/es6-typescript-babel-react-flux-karma.html"&gt;here&lt;/a&gt;.  Given the size of the existing codebase I'd rather leave the legacy TypeScript as is and isolate my new approach to the screens I'm going to build.  Obviously I'd like to have a common build process for all the codebase at some point but I've got a deadline to meet and so a half-old / half-new approach is called for (at least for the time being).&lt;/p&gt; &lt;h4&gt;Goodbye TypeScript Compilation in VS&lt;/h4&gt; &lt;p&gt;Writing modular ES6 TypeScript which is fully transpiled to old-school JS is &lt;em&gt;not possible&lt;/em&gt; using the Visual Studio tooling at present.  For what it's worth I think that SystemJS compilation may make this more possible in the future but I don't really know enough about it to be sure.   That's why I'm bringing webpack / Babel into the mix right now.  I don't want Visual Studio to do anything for the ES6 code; I don't want it to compile.  I want to deactivate my TypeScript compilation for the ES6 code.  I can't do this from the &lt;code&gt;tsconfig.json&lt;/code&gt; so I'm in a bit of a hole.  What to do?&lt;/p&gt; &lt;p&gt;Well, as of (I think) TypeScript 1.7 it's possible to deactivate TypeScript compilation in Visual Studio.  To &lt;a href="https://github.com/Microsoft/TypeScript/issues/2294#issuecomment-129367578"&gt;quote&lt;/a&gt;:&lt;/p&gt; &lt;blockquote cite="https://github.com/Microsoft/TypeScript/issues/2294#issuecomment-129367578"&gt;&lt;p&gt;there is an easier way to disable TypeScriptCompile:&lt;/p&gt;&lt;p&gt;Just add &lt;code&gt;&amp;lt;TypeScriptCompileBlocked&amp;gt;true&amp;lt;/TypeScriptCompileBlocked&amp;gt;&lt;/code&gt; to the &lt;code&gt;.csproj&lt;/code&gt;, e.g. in the first &lt;code&gt;&amp;lt;PropertyGroup&amp;gt;&lt;/code&gt;.&lt;/p&gt;&lt;/blockquote&gt; &lt;p&gt;Awesomeness!&lt;/p&gt; &lt;p&gt;But wait, this means that the legacy TypeScript isn't being compiled any longer.  Bear in mind, I'm totally happy with the existing / legacy TypeScript compilation.  Nooooooooooooooo!!!!!!!!!!!!!!!&lt;/p&gt; &lt;h4&gt;Hello TypeScript Compilation outside VS&lt;/h4&gt; &lt;p&gt;Have no fear, I gotcha. What we're going to do is ensure that Visual Studio triggers 2 external TypeScript builds as part of its own build process:&lt;/p&gt; &lt;ul&gt;&lt;li&gt;The modular ES6 TypeScript (new)&lt;/li&gt;&lt;li&gt;The legacy TypeScript (old)&lt;/li&gt;&lt;/ul&gt; &lt;p&gt;How do we do this?  Through the magic of build targets.  We need to add this to our &lt;code&gt;.csproj&lt;/code&gt;: (I add it near the end; I'm not sure if location matters though)&lt;/p&gt; &lt;pre class="prettyprint xml"&gt;&lt;br /&gt;&lt;code class="language-xml"&gt;&lt;br /&gt;  &amp;lt;PropertyGroup&amp;gt;&lt;br /&gt;    &amp;lt;CompileDependsOn&amp;gt;&lt;br /&gt;      $(CompileDependsOn);&lt;br /&gt;      WebClientBuild;&lt;br /&gt;    &amp;lt;/CompileDependsOn&amp;gt;&lt;br /&gt;    &amp;lt;CleanDependsOn&amp;gt;&lt;br /&gt;      $(CleanDependsOn);&lt;br /&gt;      WebClientClean&lt;br /&gt;    &amp;lt;/CleanDependsOn&amp;gt;&lt;br /&gt;    &amp;lt;CopyAllFilesToSingleFolderForPackageDependsOn&amp;gt;&lt;br /&gt;      CollectGulpOutput;&lt;br /&gt;      CollectLegacyTypeScriptOutput;&lt;br /&gt;      $(CopyAllFilesToSingleFolderForPackageDependsOn);&lt;br /&gt;    &amp;lt;/CopyAllFilesToSingleFolderForPackageDependsOn&amp;gt;&lt;br /&gt;    &amp;lt;CopyAllFilesToSingleFolderForMsdeployDependsOn&amp;gt;&lt;br /&gt;      CollectGulpOutput;&lt;br /&gt;      CollectLegacyTypeScriptOutput;&lt;br /&gt;      $(CopyAllFilesToSingleFolderForPackageDependsOn);&lt;br /&gt;    &amp;lt;/CopyAllFilesToSingleFolderForMsdeployDependsOn&amp;gt;&lt;br /&gt;  &amp;lt;/PropertyGroup&amp;gt;&lt;br /&gt;  &amp;lt;Target Name="WebClientBuild"&amp;gt;&lt;br /&gt;    &amp;lt;Exec Command="npm install" /&amp;gt;&lt;br /&gt;    &amp;lt;Exec Command="npm run build-legacy-typescript" /&amp;gt;&lt;br /&gt;    &amp;lt;Exec Command="npm run build -- --mode $(ConfigurationName)" /&amp;gt;&lt;br /&gt;  &amp;lt;/Target&amp;gt;&lt;br /&gt;  &amp;lt;Target Name="WebClientClean"&amp;gt;&lt;br /&gt;    &amp;lt;Exec Command="npm run clean" /&amp;gt;&lt;br /&gt;  &amp;lt;/Target&amp;gt;&lt;br /&gt;  &amp;lt;Target Name="CollectGulpOutput"&amp;gt;&lt;br /&gt;    &amp;lt;ItemGroup&amp;gt;&lt;br /&gt;      &amp;lt;_CustomFiles Include="dist\**\*" /&amp;gt;&lt;br /&gt;      &amp;lt;FilesForPackagingFromProject Include="%(_CustomFiles.Identity)"&amp;gt;&lt;br /&gt;        &amp;lt;DestinationRelativePath&amp;gt;dist\%(RecursiveDir)%(Filename)%(Extension)&amp;lt;/DestinationRelativePath&amp;gt;&lt;br /&gt;      &amp;lt;/FilesForPackagingFromProject&amp;gt;&lt;br /&gt;    &amp;lt;/ItemGroup&amp;gt;&lt;br /&gt;    &amp;lt;Message Text="CollectGulpOutput list: %(_CustomFiles.Identity)" /&amp;gt;&lt;br /&gt;  &amp;lt;/Target&amp;gt;&lt;br /&gt;  &amp;lt;Target Name="CollectLegacyTypeScriptOutput"&amp;gt;&lt;br /&gt;    &amp;lt;ItemGroup&amp;gt;&lt;br /&gt;      &amp;lt;_CustomFiles Include="Scripts\**\*.js" /&amp;gt;&lt;br /&gt;      &amp;lt;FilesForPackagingFromProject Include="%(_CustomFiles.Identity)"&amp;gt;&lt;br /&gt;        &amp;lt;DestinationRelativePath&amp;gt;Scripts\%(RecursiveDir)%(Filename)%(Extension)&amp;lt;/DestinationRelativePath&amp;gt;&lt;br /&gt;      &amp;lt;/FilesForPackagingFromProject&amp;gt;&lt;br /&gt;    &amp;lt;/ItemGroup&amp;gt;&lt;br /&gt;    &amp;lt;Message Text="CollectLegacyTypeScriptOutput list: %(_CustomFiles.Identity)" /&amp;gt;&lt;br /&gt;  &amp;lt;/Target&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;There's a few things going on here; let's take them one by one.&lt;/p&gt; &lt;h4&gt;The &lt;code&gt;WebClientBuild&lt;/code&gt; Target&lt;/h4&gt; &lt;p&gt;This target triggers our external builds. One by one it runs the following commands:&lt;/p&gt; &lt;dl&gt;&lt;dt&gt;&lt;code&gt;npm install&lt;/code&gt;&lt;/dt&gt;&lt;dd&gt;Installs the npm packages.&lt;/dd&gt;&lt;dt&gt;&lt;code&gt;npm run build-legacy-typescript&lt;/code&gt;&lt;/dt&gt;&lt;dd&gt;Runs the &lt;code&gt;"build-legacy-typescript"&lt;/code&gt; &lt;code&gt;script&lt;/code&gt; in our &lt;code&gt;package.json&lt;/code&gt;&lt;/dd&gt;&lt;dt&gt;&lt;code&gt;npm run build -- --mode $(ConfigurationName)&lt;/code&gt;&lt;/dt&gt;&lt;dd&gt;Runs the &lt;code&gt;"build"&lt;/code&gt; &lt;code&gt;script&lt;/code&gt; in our &lt;code&gt;package.json&lt;/code&gt; and passes through a &lt;code&gt;mode&lt;/code&gt; parameter of either &lt;code&gt;"Debug"&lt;/code&gt; or &lt;code&gt;"Release"&lt;/code&gt; from MSBuild - indicating whether we're creating a debug or a release build.&lt;/dd&gt;&lt;/dl&gt; &lt;p&gt;As you've no doubt gathered, I'm following the convention of using the &lt;code&gt;scripts&lt;/code&gt; element of my &lt;code&gt;package.json&lt;/code&gt; as repository for the various build tasks I might have for a web project.  It looks like this:&lt;/p&gt; &lt;pre class="prettyprint json"&gt;&lt;br /&gt;&lt;code class="language-json"&gt;&lt;br /&gt;{&lt;br /&gt;  // ...&lt;br /&gt;  "scripts": {&lt;br /&gt;    "test": "karma start --reporters mocha,junit --single-run --browsers PhantomJS",&lt;br /&gt;    "build-legacy-typescript": "tsc -v&amp;&amp;tsc --project Scripts",&lt;br /&gt;    "clean": "gulp delete-dist-contents",&lt;br /&gt;    "watch": "gulp watch",&lt;br /&gt;    "build": "gulp build"&lt;br /&gt;  },&lt;br /&gt;  // ...&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;As you can see, &lt;code&gt;"build-legacy-typescript"&lt;/code&gt; invokes &lt;code&gt;tsc&lt;/code&gt; (which is registered as a &lt;code&gt;devDependency&lt;/code&gt;) to print out the version of the compiler.  Then it invokes &lt;code&gt;tsc&lt;/code&gt; again using the &lt;a href="https://github.com/Microsoft/TypeScript/wiki/Compiler-Options"&gt;&lt;code&gt;project&lt;/code&gt;&lt;/a&gt; flag directly on the &lt;code&gt;Scripts&lt;/code&gt; directory.  This is where the legacy TypeScript and its associated &lt;code&gt;tsconfig.json&lt;/code&gt; resides. Et voil, the old / existing TypeScript is compiled just as it was previously by VS itself.&lt;/p&gt; &lt;p&gt;Next, the &lt;code&gt;"build"&lt;/code&gt; invokes a &lt;code&gt;gulp&lt;/code&gt; task called, descriptively, &lt;code&gt;"build"&lt;/code&gt;.  This task caters for our brand new codebase of modular ES6 TypeScript.  When run, this task will invoke webpack, copy static files, build less etc.  Quick digression: you can see there's a &lt;code&gt;"watch"&lt;/code&gt; script that does the same thing on a file-watching basis; I use that during development.&lt;/p&gt; &lt;h4&gt;The &lt;code&gt;WebClientClean&lt;/code&gt; Target&lt;/h4&gt; &lt;p&gt;The task that runs to clean up artefacts created by &lt;code&gt;WebClientBuild&lt;/code&gt;.&lt;/p&gt; &lt;h4&gt;The &lt;code&gt;CollectLegacyTypeScriptOutput&lt;/code&gt; and &lt;code&gt;CollectGulpOutput&lt;/code&gt; Targets&lt;/h4&gt; &lt;p&gt;Since we're compiling our TypeScript outside of VS we need to tell MSBuild / MSDeploy about the externally compiled assets in order that they are included in the publish pipeline. Here I'm standing on the shoulders of &lt;a href="http://www.codecadwallader.com/2015/03/15/integrating-gulp-into-your-tfs-builds-and-web-deploy/"&gt;Steve Cadwallader's excellent post&lt;/a&gt;.  Thanks Steve!&lt;/p&gt; &lt;p&gt;&lt;code&gt;CollectLegacyTypeScriptOutput&lt;/code&gt; and &lt;code&gt;CollectGulpOutput&lt;/code&gt; respectively include all the built files contained in the &lt;code&gt;"Scripts"&lt;/code&gt; and &lt;code&gt;"dist"&lt;/code&gt; folders when a publish takes place.  You don't need this for when you're building on your own machine but if you're looking to publish (either from your machine or from TFS) then you will need exactly this. Believe me that last sentence was typed with a memory of &lt;em&gt;great&lt;/em&gt; pain and frustration.&lt;/p&gt; &lt;p&gt;So in the end, as far as TypeScript is concerned, I'm using Visual Studio solely as an editor.  It's the hooks in the &lt;code&gt;.csproj&lt;/code&gt; that ensure that compilation happens.  It seems a little quirky that we still need to have the original TypeScript targets in the &lt;code&gt;.csproj&lt;/code&gt; file as well; but it works. That's all that matters.&lt;/p&gt; </content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8275761095158290834'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8275761095158290834'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2016/02/visual-studio-tsconfigjson-and-external.html' title='Visual Studio, &lt;code&gt;tsconfig.json&lt;/code&gt; and external TypeScript compilation'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5725948668548892188</id><published>2016-02-01T06:30:00.000Z</published><updated>2016-02-01T06:30:23.752Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='C# 6'/><category scheme='http://www.blogger.com/atom/ns#' term='.Net 4.5'/><category scheme='http://www.blogger.com/atom/ns#' term='TFS 2012'/><title type='text'>TFS 2012, .NET 4.5 and C# 6</title><content type='html'>&lt;p&gt;So, you want to use C# 6 language features and youre working on an older project thats still rocking .NET 4.5.  Well, with &lt;a href="http://stackoverflow.com/a/28921749/761388"&gt;some caveats&lt;/a&gt;, you can.&lt;/p&gt; &lt;p&gt;The new compiler will compile targeting older framework versions.  Well thats all lovely; lets all go home.&lt;/p&gt; &lt;p&gt;Now.  What say youve got an old, old build server?  Its TFS 2012 Update 2, creaking away, still glad to alive and kind of wondering why it hasnt been upgraded or retired.  This is where you want to compile .NET 4.5 from C# 6.  Well it can be done.  Heres how its done: &lt;/p&gt; &lt;ol&gt;&lt;li&gt;Install Visual Studio 2015 on the build server (Im told this can be achieved using &lt;a href="https://www.microsoft.com/en-us/download/details.aspx?id=48159"&gt;Microsoft Build Tools 2015&lt;/a&gt; but I havent tried it myelf so caveat emptor)&lt;/li&gt;&lt;li&gt;set the &lt;code&gt;MSBuild Arguments&lt;/code&gt; in the build definition to &lt;code&gt;/p:VisualStudioVersion=14.0&lt;/code&gt; (i.e. Visual Studio 2015 mode) &lt;a href="http://4.bp.blogspot.com/-QBbNPXyPeHM/VquGppTit4I/AAAAAAAAA5U/myurEeB4Kdo/s1600/EditBuildConfiguration.png" imageanchor="1" &gt;&lt;img border="0" src="http://4.bp.blogspot.com/-QBbNPXyPeHM/VquGppTit4I/AAAAAAAAA5U/myurEeB4Kdo/s640/EditBuildConfiguration.png" /&gt;&lt;/a&gt;&lt;/li&gt;&lt;li&gt;in each project that uses C# 6 syntax, install the NuGet package &lt;a href="https://www.nuget.org/packages/Microsoft.Net.Compilers"&gt;Microsoft.Net.Compilers&lt;/a&gt; with a quick &lt;code&gt;install-package Microsoft.Net.Compilers&lt;/code&gt;&lt;/li&gt;&lt;/ol&gt; &lt;p&gt;Thats it; huzzah!  String interpolation here I come&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5725948668548892188'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5725948668548892188'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2016/02/tfs-2012-net-45-and-c-6.html' title='TFS 2012, .NET 4.5 and C# 6'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='http://4.bp.blogspot.com/-QBbNPXyPeHM/VquGppTit4I/AAAAAAAAA5U/myurEeB4Kdo/s72-c/EditBuildConfiguration.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5418481605198041913</id><published>2016-01-14T06:55:00.000Z</published><updated>2016-01-14T10:50:33.512Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='Docking station'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Surface Pro 3'/><category scheme='http://www.blogger.com/atom/ns#' term='Coded UI'/><category scheme='http://www.blogger.com/atom/ns#' term='Second monitor'/><title type='text'>Coded UI and the Curse of the Docking Station</title><content type='html'>&lt;p&gt;Ive a love / hate relationship with Coded UI.  Well hate / hate might be more accurate.  Hate perhaps married with a very grudging respect still underpinned by a wary bitterness.  Yes, thats about the size of it.  Why?  Well, when Coded UI works, its fab.  But its flaky as anything.  Anybody whos used the technology is presently nodding sagely and holding back the tears. Its all a bit... tough.&lt;/p&gt; &lt;p&gt;Ive recently discovered another quirk to add to the list.  Docking stations.  I was back working on a project which had a Coded UI test suite.  Id heard tell that there were problems with the tests and was just taking a look at them.  The first hurdle I fell at was getting the tests to run locally.  The tests had first been developed on a standard desktop build and, as much as this can ever be said of Coded UI tests, they worked.  However, the future had happened.  The company in question was no longer using the old school desktop towers.  Nope, theyd reached for the sky and equipped the whole office with Surface Pro 3s, hot desks, docking stations and big, big monitors.  It looked terribly flash.&lt;/p&gt; &lt;p&gt;Coded UI was not happy.&lt;/p&gt; &lt;p&gt;The &lt;code&gt;Mouse.Click&lt;/code&gt; behaviour wasnt working.  Most tests need the ability for users to click on buttons, dropdowns etc.  Thats part of a normal UI.  And so it was with these tests.  This is where they fell over.  The reason they fell over at this point didnt become clear for a while.  It wasnt until we tried tweaking our implementation of the tests that we realised what was happening.  The tests normally found buttons / dropdowns etc on the screen and then attempted to perform a &lt;code&gt;Mouse.Click&lt;/code&gt; upon them.  We changed the implementation to be subtly different.  Instead of just clicking on the element we amended the test to move the mouse to the button and then perform the click.&lt;/p&gt; &lt;p&gt;Aha!&lt;/p&gt; &lt;p&gt;Rather than steadily moving towards an element and clicking, the pointer was swerving like a drunk man crossing the road at 3am.  It completely missed the element it was aiming for and clicked upon a seemingly random area of the screen.  This is Coded UI doing pin the tail on the donkey.&lt;/p&gt; &lt;p&gt;After more time than I'd like to admit I happened upon the solution.  I tended to dock my Surface and then tune my monitor resolution to the one most optimal for coding. (ie really high res.)  This is what messes with Coded UI's head; the resolution change.  If I wanted to be able to run tests successfully all I had to do was switch back to the resolution I initially booted with.  Alternately I could restart my computer so it launched with the resolution I was presently using.&lt;/p&gt; &lt;p&gt;Once you do follow this guidance Coded UI has a moment of clarity, gets sober and starts &lt;code&gt;Mouse.Click&lt;/code&gt;-ing like a pro.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5418481605198041913'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5418481605198041913'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2016/01/coded-ui-and-curse-of-docking-station.html' title='Coded UI and the Curse of the Docking Station'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1341392665909986358</id><published>2016-01-10T17:46:00.000Z</published><updated>2016-01-10T17:46:08.477Z</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='TypeScript'/><category scheme='http://www.blogger.com/atom/ns#' term='gitignore'/><category scheme='http://www.blogger.com/atom/ns#' term='git'/><title type='text'>Useful gitignore</title><content type='html'>  http://git-scm.com/docs/gitignore  http://stackoverflow.com/a/19095988/761388  git rm -r --cached .  git add .  hierarchy example for typescript in a project</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1341392665909986358'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1341392665909986358'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8956272517026587943</id><published>2016-01-01T00:00:00.002Z</published><updated>2021-03-14T05:28:18.638Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='HTML5 History API'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Single Page Applications'/><category scheme='http://www.blogger.com/atom/ns#' term='UseStaticFiles'/><category scheme='http://www.blogger.com/atom/ns#' term='Routing'/><category scheme='http://www.blogger.com/atom/ns#' term='URL Rewrite'/><title type='text'>UseStaticFiles for ASP.Net vOld</title><content type='html'>&lt;p&gt;That's what we're calling the original ASP.Net now, right? This is a guide on how &lt;u&gt;not&lt;/u&gt; to expose all your static files to the world at large when working with the old (well, current) ASP.Net stack.  How to move from a blacklisting approach to a whitelisting approach.  Not clear?  Stick around; I'll get better.&lt;/p&gt; &lt;p&gt;Oh and that's not all, we've also got.... drumroll:&lt;/p&gt; &lt;h4&gt;Support for &lt;a href="https://html.spec.whatwg.org/multipage/browsers.html#the-history-interface"&gt;HTML5 History API&lt;/a&gt;!&lt;/h4&gt; &lt;p&gt;What that means, in as close to English as I can get it, is real URLs for Single Page Applications. None of that hash-based routing malarkey.  So, &lt;code&gt;https://i-am-your-domain.com/i-am-your-route&lt;/code&gt; rather than &lt;code&gt;https://i-am-your-domain.com/&lt;em&gt;#/&lt;/em&gt;i-am-your-route&lt;/code&gt;. (For a more in depth look at the different sorts of routing SPA's can use then take a look at the &lt;a href="http://rackt.org/history/stable/GettingStarted.html"&gt;excellent docs&lt;/a&gt; by the folk behind &lt;a href="https://github.com/rackt/react-router"&gt;React Router&lt;/a&gt;. These concepts are not React specific and can be applied to any SPA technology.)&lt;/p&gt; &lt;h4&gt;UseStaticFiles&lt;/h4&gt; &lt;p&gt;You may be aware that historically ASP.Net has been somewhat unusual in its approach to serving static files. Essentially, all the files in a project are theoretically servable.  Okay, that's not entirely true; things like the &lt;code&gt;web.config&lt;/code&gt; files etc are not going to be handed over to someone browsing your site.  But other files that you might well want kept away from prying eyes may be.  So your &lt;a href="http://www.typescriptlang.org/"&gt;TypeScript&lt;/a&gt; files, your &lt;a href="http://lesscss.org/"&gt;Less&lt;/a&gt; files are all up for grabs unless you take action to block access to them.  This is, and has always been, bad.&lt;/p&gt; &lt;p&gt;The ASP.Net team know this and things are changing with ASP.Net 5.  With the new stack you have to say "these are the static files we want people to access" in the form of an &lt;code&gt;&lt;a href="https://msdn.microsoft.com/en-us/library/dn782589(v=vs.113).aspx"&gt;app.UseStaticFiles()&lt;/a&gt;&lt;/code&gt; declaration.  This is mighty similar to how you do things in other frameworks such as &lt;a href="http://expressjs.com/en/starter/static-files.html"&gt;Express&lt;/a&gt;. To quote the &lt;a href="https://docs.asp.net/en/latest/fundamentals/static-files.html#serving-static-files"&gt;docs&lt;/a&gt;:&lt;/p&gt; &lt;blockquote cite="https://docs.asp.net/en/latest/fundamentals/static-files.html#serving-static-files"&gt;&lt;p&gt;By default, static files are stored in the webroot of your project. The location of the webroot is defined in the projects &lt;code&gt;project.json&lt;/code&gt; file where the default is wwwroot.&lt;/p&gt; &lt;pre class="prettyprint json"&gt;&lt;br /&gt;&lt;code class="language-json"&gt;&lt;br /&gt;"webroot": "wwwroot"&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Static files can be stored in any folder under the webroot and accessed with a relative path to that root. For example, when you create a default Web application project using Visual Studio, there are several folders created within the webroot folder - &lt;code&gt;css&lt;/code&gt;, &lt;code&gt;images&lt;/code&gt; and &lt;code&gt;js&lt;/code&gt;. In order to directly access an image in the images subfolder, the URL would look like the following:&lt;/p&gt; &lt;p&gt;&lt;code&gt;http://&amp;lt;yourApp&amp;gt;/images/&amp;lt;imageFileName&amp;gt;&lt;/code&gt;&lt;/p&gt;&lt;/blockquote&gt; &lt;p&gt;So how do we get this behaviour with ASP.Net vOld?  Well, it's just a matter of &lt;code&gt;web.config&lt;/code&gt; URL rewrite twiddling:&lt;/p&gt; &lt;pre class="prettyprint xml"&gt;&lt;br /&gt;&lt;code class="language-xml"&gt;&lt;br /&gt;&amp;lt;configuration&amp;gt;&lt;br /&gt;  &amp;lt;!-- other config --&amp;gt;&lt;br /&gt;&lt;br /&gt;  &amp;lt;system.webServer&amp;gt;&lt;br /&gt;    &amp;lt;rewrite&amp;gt;&lt;br /&gt;      &amp;lt;rules&amp;gt;&lt;br /&gt;        &amp;lt;rule name="Map empty URLs to the index.html"&amp;gt;&lt;br /&gt;          &amp;lt;match url="^$" /&amp;gt;&lt;br /&gt;          &amp;lt;action type="Rewrite" url="/index.html" /&amp;gt;&lt;br /&gt;        &amp;lt;/rule&amp;gt;&lt;br /&gt;        &amp;lt;rule name="Map all requests with a '.' in to the 'build' directory" stopProcessing="true"&amp;gt;&lt;br /&gt;          &amp;lt;match url="^(.*[.].*)$" /&amp;gt;&lt;br /&gt;          &amp;lt;action type="Rewrite" url="/build/{R:1}" /&amp;gt;&lt;br /&gt;        &amp;lt;/rule&amp;gt;&lt;br /&gt;      &amp;lt;/rules&amp;gt;&lt;br /&gt;    &amp;lt;/rewrite&amp;gt;&lt;br /&gt;  &amp;lt;/system.webServer&amp;gt;&lt;br /&gt;&amp;lt;/configuration&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;My &lt;code&gt;webroot&lt;/code&gt; is named &lt;code&gt;build&lt;/code&gt; rather than &lt;code&gt;wwwroot&lt;/code&gt;.  The 2 URL rewrite rules above do the following:&lt;/p&gt; &lt;dl&gt;&lt;dt&gt;Map empty URLs to the index.html&lt;/dt&gt;&lt;dd&gt;Empty URLs (ie the URL for the root of your site) are mapped to &lt;code&gt;index.html&lt;/code&gt;.  The &lt;code&gt;index.html&lt;/code&gt; in the &lt;code&gt;build&lt;/code&gt; folder is the home page of this particular site and the next rule will make sure that we hit that. (Since we haven't set &lt;code&gt;stopProcessing&lt;/code&gt; to &lt;code&gt;true&lt;/code&gt; for this particular rule the next rule will be processed after this one.)&lt;/dd&gt;&lt;dt&gt;Map all requests with a '.' in to the 'build' directory&lt;/dt&gt;&lt;dd&gt;All URLs with a "." in the title (including &lt;code&gt;index.html&lt;/code&gt;) are redirected to the &lt;code&gt;build&lt;/code&gt; folder.  All static files have a "." in them because filenames have suffixes. This essentially means all requests for files are served from the &lt;code&gt;build&lt;/code&gt; folder.  In this case we have set &lt;code&gt;stopProcessing&lt;/code&gt; to &lt;code&gt;true&lt;/code&gt; which means that any URLs that matched this rule will be not be affected by any subsequent rules.&lt;/dd&gt;&lt;/dl&gt; &lt;p&gt;So if anyone sneakily tries to sneakily browse to say, &lt;code&gt;http://&amp;lt;yourApp&amp;gt;/js/app.ts&lt;/code&gt; then they'll be nicely redirected to the non-existent &lt;code&gt;build/js/app.ts&lt;/code&gt;.  404 in your face!&lt;/p&gt; &lt;h4&gt;"I am SPArtucus"&lt;/h4&gt; &lt;p&gt;When you have a Single Page Application you want the same web experience as a server side rendered web app.  What I mean by this is: routing just works.  You want people to be able to go to &lt;code&gt;https://i-am-your-domain.com/i-am-your-route&lt;/code&gt; and get your site at the specified route.  Happily, whether you're using React Router, Angular UI Router or something else, the client side is covered. They can be configured to detect the route that you enter at and serve up the SPA in the relevant state. But you have to meet them halfway; the server needs to do its bit.&lt;/p&gt; &lt;p&gt;When a URL is requested that doesn't look like a request for a static file, let's make the (reasonable) assumption that this is a route URL and serve up the shell SPA page.  So, for my own example of an Angular 1.x app I want the server to hand over &lt;code&gt;/build/index.html&lt;/code&gt;.&lt;/p&gt; &lt;p&gt;This is the magic that makes real URLs and SPAs work.  Provided the client hasn't requested a static file, every request to the server will be responded to with our very own "I am SPArtucus"; the shell SPA page. This is catered for by the addition of another new rule to our &lt;code&gt;web.config&lt;/code&gt;:&lt;/p&gt; &lt;pre class="prettyprint xml"&gt;&lt;br /&gt;&lt;code class="language-xml"&gt;&lt;br /&gt;&amp;lt;configuration&amp;gt;&lt;br /&gt;  &amp;lt;!-- other config --&amp;gt;&lt;br /&gt;&lt;br /&gt;  &amp;lt;system.webServer&amp;gt;&lt;br /&gt;    &amp;lt;rewrite&amp;gt;&lt;br /&gt;      &amp;lt;rules&amp;gt;&lt;br /&gt;        &amp;lt;rule name="Map empty URLs to the index.html"&amp;gt;&lt;br /&gt;          &amp;lt;match url="^$" /&amp;gt;&lt;br /&gt;          &amp;lt;action type="Rewrite" url="/index.html" /&amp;gt;&lt;br /&gt;        &amp;lt;/rule&amp;gt;&lt;br /&gt;        &amp;lt;rule name="Map all requests with a '.' in to the 'build' directory" stopProcessing="true"&amp;gt;&lt;br /&gt;          &amp;lt;match url="^(.*[.].*)$" /&amp;gt;&lt;br /&gt;          &amp;lt;action type="Rewrite" url="/build/{R:1}" /&amp;gt;&lt;br /&gt;        &amp;lt;/rule&amp;gt;&lt;br /&gt;        &amp;lt;rule name="Map all other URLs to the index.html - this to support our SPA routes"&amp;gt;&lt;br /&gt;          &amp;lt;match url="^.*$" /&amp;gt;&lt;br /&gt;          &amp;lt;action type="Rewrite" url="/build/index.html" /&amp;gt;&lt;br /&gt;        &amp;lt;/rule&amp;gt;&lt;br /&gt;      &amp;lt;/rules&amp;gt;&lt;br /&gt;    &amp;lt;/rewrite&amp;gt;&lt;br /&gt;  &amp;lt;/system.webServer&amp;gt;&lt;br /&gt;&amp;lt;/configuration&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;dl&gt;&lt;dt&gt;Map all other URLs to the index.html - this to support our SPA routes&lt;/dt&gt;&lt;dd&gt;Our new rule says "whatever URL turns up, if it hasn't been catered for by an existing rule, well it must be a SPA route, so we'll serve up the shell SPA page of &lt;code&gt;build/index.html&lt;/code&gt;".&lt;/dd&gt;&lt;/dl&gt; &lt;h4&gt;Data! Data! Data!.. I can't make bricks without clay.&lt;/h4&gt; &lt;p&gt;Sherlock Holmes was onto something; most applications are nothing without data.  What you've got at present is an application that carefully restricts access to static files and, for all other requests, serves up our shell SPA page. So let's relax our final rule a little to make data access a thing:&lt;/p&gt; &lt;pre class="prettyprint xml"&gt;&lt;br /&gt;&lt;code class="language-xml"&gt;&lt;br /&gt;&amp;lt;configuration&amp;gt;&lt;br /&gt;  &amp;lt;!-- other config --&amp;gt;&lt;br /&gt;&lt;br /&gt;  &amp;lt;system.webServer&amp;gt;&lt;br /&gt;    &amp;lt;rewrite&amp;gt;&lt;br /&gt;      &amp;lt;rules&amp;gt;&lt;br /&gt;        &amp;lt;rule name="Map empty URLs to the index.html"&amp;gt;&lt;br /&gt;          &amp;lt;match url="^$" /&amp;gt;&lt;br /&gt;          &amp;lt;action type="Rewrite" url="/index.html" /&amp;gt;&lt;br /&gt;        &amp;lt;/rule&amp;gt;&lt;br /&gt;        &amp;lt;rule name="Map all requests with a '.' in to the 'build' directory" stopProcessing="true"&amp;gt;&lt;br /&gt;          &amp;lt;match url="^(.*[.].*)$" /&amp;gt;&lt;br /&gt;          &amp;lt;action type="Rewrite" url="/build/{R:1}" /&amp;gt;&lt;br /&gt;        &amp;lt;/rule&amp;gt;&lt;br /&gt;        &amp;lt;rule name="Map non-api URLs to the index.html - this to support our SPA routes"&amp;gt;&lt;br /&gt;          &amp;lt;match url="^(api/).*$" negate="true" ignoreCase="true" /&amp;gt;&lt;br /&gt;          &amp;lt;action type="Rewrite" url="/build/index.html" /&amp;gt;&lt;br /&gt;        &amp;lt;/rule&amp;gt;&lt;br /&gt;      &amp;lt;/rules&amp;gt;&lt;br /&gt;    &amp;lt;/rewrite&amp;gt;&lt;br /&gt;  &amp;lt;/system.webServer&amp;gt;&lt;br /&gt;&amp;lt;/configuration&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;dl&gt;&lt;dt&gt;Map non-api URLs to the index.html - this to support our SPA routes&lt;/dt&gt;&lt;dd&gt;This amended rule says "whatever URL turns up, &lt;em&gt;unless it begins &lt;code&gt;"api/"&lt;/code&gt;&lt;/em&gt;, if it hasn't been catered for by an existing rule, well it must be a SPA route, so we'll serve up the shell SPA page of &lt;code&gt;build/index.html&lt;/code&gt;".&lt;/dd&gt;&lt;/dl&gt; &lt;p&gt;This allows us to perform data access by prefixing all the Web API routes with &lt;code&gt;"api/"&lt;/code&gt;.  I've picked this because it is the default location for ASP.Net Web API routes. It is (like most things) entirely configurable. To see a working implementation of this complete approach then take a look at the PoorClaresAngular project &lt;a href="https://github.com/johnnyreilly/poorclaresarundel/tree/15e7d4ddc0f1c06fe326b44c3bdc71ceb554bf73"&gt;here&lt;/a&gt;.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8956272517026587943'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8956272517026587943'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2016/01/usestaticfiles-for-aspnet-vold.html' title='UseStaticFiles for ASP.Net vOld'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3801633432889227126</id><published>2015-12-20T20:54:00.000Z</published><updated>2015-12-21T09:43:43.653Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Live Reload Considered Harmful</title><content type='html'>&lt;p&gt;I've seen it go by many names; &lt;a href="http://livereload.com/"&gt;live reload&lt;/a&gt;, hot reload, &lt;a href="https://browsersync.io/"&gt;browser sync&lt;/a&gt;... the list goes on.  It's been the subject of a million demos.  It's the focus of a thousand npm packages.  Someone tweaks a file and... wait for it... &lt;em&gt;doesn't have to refresh their browser to see the changes&lt;/em&gt;...  The future is now!&lt;/p&gt; &lt;p&gt;Forgive me the sarcasm, but I have come to the conclusion that whilst live reload is impressive... for my own purposes, it is not actually that useful.  It certainly shouldn't be the default goto that it seems to have become.&lt;/p&gt; &lt;p&gt;Hear me out people, I may be the voice crying out in the wilderness but I'm right dammit.&lt;/p&gt; &lt;div class="separator" style="clear: both; text-align: center;"&gt;&lt;a href="http://38.media.tumblr.com/a0f1700e7b84665772f0085b57c4a3e8/tumblr_inline_nj5w5fPWxm1qcn3a6.gif" imageanchor="1" style="margin-left: 1em; margin-right: 1em; "&gt;&lt;img border="0" style="width:50%" src="http://img.xooimage.com/files110/d/0/c/tumblr_mxjpcobvcg...6_r2_250-4abb938.gif" /&gt;&lt;/a&gt;&lt;p&gt;&lt;strong&gt;Search your feelings, you know it to be true.&lt;/strong&gt;&lt;/p&gt;&lt;/div&gt; &lt;h4&gt;Why is Live Reload a Thing?&lt;/h4&gt; &lt;p&gt;What is live reload?  Well having to hit F5 after you've made a change... That seems like such hard work right?  To quote &lt;a href="http://haacked.com/archive/2011/12/13/better-git-with-powershell.aspx/"&gt;Phil Haack&lt;/a&gt;:&lt;/p&gt; &lt;blockquote cite="http://haacked.com/archive/2011/12/13/better-git-with-powershell.aspx/"&gt;&lt;p&gt;... were software developers.... Its time to AWW TOE  MATE!&lt;/p&gt;&lt;/blockquote&gt; &lt;p&gt;Yup, automation.  Anything that a developer can theoretically automate.... will be automated. Usually this is a good thing but automation can be addictive.  And on this occasion it's time for an intervention.&lt;/p&gt; &lt;p&gt;What else could be the attraction?  Well, this is speculation but I would say that the implementation actually has something to do with it.  Live reload is almost invariably powered by &lt;a href="https://en.wikipedia.org/wiki/WebSocket"&gt;WebSockets&lt;/a&gt; and they are certainly cool. Developers I know what you are like.   You're attracted by the new shiny thing.  You can't resist the allure of WS.  And there with live reload idling away in the background you're all bleeding edge.  I can say all this because this is exactly what I am like.&lt;/p&gt; &lt;h4&gt;Why is Live Reload a BAD Thing?&lt;/h4&gt; &lt;p&gt;Well the OCD part of me is instinctively repelled by the extra &lt;code&gt;script&lt;/code&gt; tag of alien code that live reload foists upon your app.  How very dare that &lt;code&gt;&amp;lt;script src="http://localhost:35729/livereload.js?snipver=1"&amp;gt;&amp;lt;/script&amp;gt;&lt;/code&gt; push its way into my pristine DOM.  It's an outrage.&lt;/p&gt; &lt;p&gt;Perhaps a more convincing rationale is how useful it is to have 2 different versions of your app up on screen at the same time.  I like to try things out when I'm working.  I get a screen working one way and then I tweak and play with my implementation.  I have the app of 10 minutes ago sat side by side with the newly adjusted one. Assess, compare and and declare a winner.  That's so useful and live reload does away with it.  That's a problem.&lt;/p&gt; &lt;p&gt;Finally, I'm an obsessive 'Ctrl-S'-er.  I've been burned by unsaved changes too many times.  I'm saving every couple of keypresses.  With live reload that usually means I have the noise of a dead application in the corner of my eye as LR obsessively forces the latest brokenness upon me.  That sucks.&lt;/p&gt; &lt;p&gt;I've no doubt there are situations where live reload is useful.  But for my money that's the exception rather than the rule.  Let the madness end now. Just say "no", kids.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3801633432889227126'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3801633432889227126'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2015/12/live-reload-considered-harmful.html' title='Live Reload Considered Harmful'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4083919089531972939</id><published>2015-12-16T21:58:00.002Z</published><updated>2021-03-13T14:17:33.189Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='ES6'/><category scheme='http://www.blogger.com/atom/ns#' term='Karma'/><category scheme='http://www.blogger.com/atom/ns#' term='React'/><category scheme='http://www.blogger.com/atom/ns#' term='ts-loader'/><category scheme='http://www.blogger.com/atom/ns#' term='Webpack'/><title type='text'>ES6 + TypeScript + Babel + React + Flux + Karma: The Secret Recipe</title><content type='html'>&lt;p&gt;I wrote &lt;a href="https://blog.johnnyreilly.com/2015/09/things-done-changed.html"&gt;a while ago&lt;/a&gt; about how I was using some different tools in a current project:&lt;/p&gt; &lt;ul&gt;&lt;li&gt;React with JSX&lt;/li&gt;&lt;li&gt;Flux&lt;/li&gt;&lt;li&gt;ES6 with Babel&lt;/li&gt;&lt;li&gt;Karma for unit testing&lt;/li&gt;&lt;/ul&gt; &lt;p&gt;I have fully come to love and appreciate all of the above.  I really like working with them.  However.  There was still an ache in my soul and a thorn in my side.  Whilst I love the syntax of ES6 and even though I've come to appreciate the clarity of JSX, I have been missing something.  Perhaps you can guess? It's static typing.&lt;/p&gt; &lt;p&gt;It's actually been really good to have the chance to work without it because it's made me realise what a productivity boost having static typing actually is.  The number of silly mistakes burning time that a compiler could have told me.... Sigh.&lt;/p&gt; &lt;p&gt;But the pain is over.  The dark days are gone. It's possible to have strong typing, courtesy of TypeScript, plugged into this workflow.  It's yours for the taking.  Take it.  Take it now!&lt;/p&gt; &lt;h4&gt;What a Guy Wants&lt;/h4&gt; &lt;p&gt;I decided a couple of months ago what I wanted to have in my setup:&lt;/p&gt; &lt;ol&gt;&lt;li&gt;I want to be able to write React / JSX in TypeScript.  Naturally I couldn't achieve that by myself but handily the TypeScript team decided to add support for JSX with &lt;a href="http://blogs.msdn.com/b/typescript/archive/2015/09/16/announcing-typescript-1-6.aspx"&gt;TypeScript 1.6&lt;/a&gt;.  Ooh yeah.&lt;/li&gt;&lt;li&gt;I wanted to be able to write ES6.  When I realised &lt;a href="https://github.com/Microsoft/TypeScript/issues/3956"&gt;the approach for writing ES6 and having the transpilation handled by TypeScript wasn't clear&lt;/a&gt; I had another idea.  I thought &lt;a href="https://github.com/Microsoft/TypeScript/issues/4765"&gt;"what if I write ES6 and hand off the transpilation to Babel?"&lt;/a&gt; i.e. Use TypeScript for type checking, not for transpilation.  I realised that &lt;a href="http://www.jbrantly.com/es6-modules-with-typescript-and-webpack/#configuringwebpack"&gt;James Brantly had my back&lt;/a&gt; here already.  Enter &lt;a href="https://webpack.github.io/"&gt;Webpack&lt;/a&gt; and &lt;a href="https://github.com/TypeStrong/ts-loader"&gt;ts-loader&lt;/a&gt;.&lt;/li&gt;&lt;li&gt;Debugging.  Being able to debug my code is non-negotiable for me.  If I can't debug it I'm less productive. (I'm also bitter and twisted inside.)  I should say that I wanted to be able to debug my &lt;em&gt;original&lt;/em&gt; source code.  Thanks to the magic of &lt;a href="https://docs.google.com/document/d/1U1RGAehQwRypUTovF1KRlpiOFze0b-_2gc6fAH0KY0k/edit?usp=sharing"&gt;sourcemaps&lt;/a&gt;, that mad thing is possible.&lt;/li&gt;&lt;li&gt;Karma for unit testing.  I've become accustomed to writing my tests in ES6 and running them on a continual basis with &lt;a href="https://karma-runner.github.io/0.13/index.html"&gt;Karma&lt;/a&gt;. This allows for a rather good debugging story as well.  I didn't want to lose this when I moved to TypeScript.  I didn't.&lt;/li&gt;&lt;/ol&gt; &lt;p&gt;So I've talked about what I want and I've alluded to some of the solutions that there are. The question now is how to bring them all together.  This post is, for the most part, going to be about correctly orchestrating a number of &lt;a href="http://gulpjs.com/"&gt;gulp tasks&lt;/a&gt; to achieve the goals listed above.  If you're after the &lt;a href="https://en.wikipedia.org/wiki/Blue_Peter"&gt;Blue Peter "here's one I made earlier"&lt;/a&gt; moment then take a look at &lt;a href="https://github.com/Microsoft/TypeScriptSamples/tree/master/es6-babel-react-flux-karma"&gt;the es6-babel-react-flux-karma repo&lt;/a&gt; in the &lt;a href="https://github.com/Microsoft/TypeScriptSamples"&gt;Microsoft/TypeScriptSamples repo on Github&lt;/a&gt;.&lt;/p&gt; &lt;h4&gt;gulpfile.js&lt;/h4&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;/* eslint-disable no-var, strict, prefer-arrow-callback */&lt;br /&gt;'use strict';&lt;br /&gt;&lt;br /&gt;var gulp = require('gulp');&lt;br /&gt;var gutil = require('gulp-util');&lt;br /&gt;var connect = require('gulp-connect');&lt;br /&gt;var eslint = require('gulp-eslint');&lt;br /&gt;var webpack = require('./gulp/webpack');&lt;br /&gt;var staticFiles = require('./gulp/staticFiles');&lt;br /&gt;var tests = require('./gulp/tests');&lt;br /&gt;var clean = require('./gulp/clean');&lt;br /&gt;var inject = require('./gulp/inject');&lt;br /&gt;&lt;br /&gt;var lintSrcs = ['./gulp/**/*.js'];&lt;br /&gt;&lt;br /&gt;gulp.task('delete-dist', function (done) {&lt;br /&gt;  clean.run(done);&lt;br /&gt;});&lt;br /&gt;&lt;br /&gt;gulp.task('build-process.env.NODE_ENV', function () {&lt;br /&gt;  process.env.NODE_ENV = 'production';&lt;br /&gt;});&lt;br /&gt;&lt;br /&gt;gulp.task('build-js', ['delete-dist', 'build-process.env.NODE_ENV'], function(done) {&lt;br /&gt;  webpack.build().then(function() { done(); });&lt;br /&gt;});&lt;br /&gt;&lt;br /&gt;gulp.task('build-other', ['delete-dist', 'build-process.env.NODE_ENV'], function() {&lt;br /&gt;  staticFiles.build();&lt;br /&gt;});&lt;br /&gt;&lt;br /&gt;gulp.task('build', ['build-js', 'build-other', 'lint'], function () {&lt;br /&gt;  inject.build();&lt;br /&gt;});&lt;br /&gt;&lt;br /&gt;gulp.task('lint', function () {&lt;br /&gt;  return gulp.src(lintSrcs)&lt;br /&gt;    .pipe(eslint())&lt;br /&gt;    .pipe(eslint.format());&lt;br /&gt;});&lt;br /&gt;&lt;br /&gt;gulp.task('watch', ['delete-dist'], function() {&lt;br /&gt;  process.env.NODE_ENV = 'development';&lt;br /&gt;  Promise.all([&lt;br /&gt;    webpack.watch()//,&lt;br /&gt;    //less.watch()&lt;br /&gt;  ]).then(function() {&lt;br /&gt;    gutil.log('Now that initial assets (js and css) are generated inject will start...');&lt;br /&gt;    inject.watch(postInjectCb);&lt;br /&gt;  }).catch(function(error) {&lt;br /&gt;    gutil.log('Problem generating initial assets (js and css)', error);&lt;br /&gt;  });&lt;br /&gt;&lt;br /&gt;  gulp.watch(lintSrcs, ['lint']);&lt;br /&gt;  staticFiles.watch();&lt;br /&gt;  tests.watch();&lt;br /&gt;});&lt;br /&gt;&lt;br /&gt;gulp.task('watch-and-serve', ['watch'], function() {&lt;br /&gt;  postInjectCb = stopAndStartServer;&lt;br /&gt;});&lt;br /&gt;&lt;br /&gt;var postInjectCb = null;&lt;br /&gt;var serverStarted = false;&lt;br /&gt;function stopAndStartServer() {&lt;br /&gt;  if (serverStarted) {&lt;br /&gt;    gutil.log('Stopping server');&lt;br /&gt;    connect.serverClose();&lt;br /&gt;    serverStarted = false;&lt;br /&gt;  }&lt;br /&gt;  startServer();&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;function startServer() {&lt;br /&gt;  gutil.log('Starting server');&lt;br /&gt;  connect.server({&lt;br /&gt;    root: './dist',&lt;br /&gt;    port: 8080&lt;br /&gt;  });&lt;br /&gt;  serverStarted = true;&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Let's start picking this apart; what do we actually have here?  Well, we have 2 gulp tasks that I want you to notice:&lt;/p&gt; &lt;dl&gt;&lt;dt&gt;build&lt;/dt&gt;&lt;dd&gt;&lt;p&gt;This is likely the task you would use when deploying. It takes all of your source code, builds it, provides cache-busting filenames (eg &lt;code&gt;main.dd2fa20cd9eac9d1fb2f.js&lt;/code&gt;), injects your shell SPA page with references to the files and deploys everything to the &lt;code&gt;./dist/&lt;/code&gt; directory.  So that's TypeScript, static assets like images and CSS all made ready for Production.&lt;/p&gt; &lt;p&gt;The build task also implements &lt;a href="https://facebook.github.io/react/blog/2015/09/10/react-v0.14-rc1.html"&gt;this advice&lt;/a&gt;:&lt;/p&gt; &lt;blockquote cite="https://facebook.github.io/react/blog/2015/09/10/react-v0.14-rc1.html"&gt;When deploying your app, set the &lt;code&gt;NODE_ENV&lt;/code&gt; environment variable to &lt;code&gt;production&lt;/code&gt; to use the production build of React which does not include the development warnings and runs significantly faster. &lt;/blockquote&gt;&lt;/dd&gt;&lt;dt&gt;watch-and-serve&lt;/dt&gt;&lt;dd&gt;&lt;p&gt;This task represents "development mode" or "debug mode". It's what you'll likely be running as you develop your app.  It does the same as the build task but with some important distinctions.&lt;/p&gt; &lt;ul&gt;&lt;li&gt;As well as building your source it also runs your tests using Karma&lt;/li&gt;&lt;li&gt;This task is not triggered on a once-only basis, rather your files are watched and each tweak of a file will result in a new build and a fresh run of your tests. Nice eh?&lt;/li&gt;&lt;li&gt;It spins up a simple web server and serves up the contents of &lt;code&gt;./dist&lt;/code&gt; (i.e. your built code) in order that you can easily test out your app.&lt;/li&gt;&lt;li&gt;In addition, whilst it builds your source it does &lt;em&gt;not&lt;/em&gt; minify your code and it emits sourcemaps.  For why?  For debugging!  You can go to &lt;code&gt;&lt;a href="http://localhost:8080/"&gt;http://localhost:8080/&lt;/a&gt;&lt;/code&gt; in your browser of choice, fire up the dev tools and you're off to the races; debugging like gangbusters. It also doesn't bother to provide cache-busting filenames as Chrome dev tools are smart enough to not cache localhost.&lt;/li&gt;&lt;li&gt;Oh and Karma.... If you've got problems with a failing test then head to &lt;code&gt;&lt;a href="http://localhost:9876/"&gt;http://localhost:9876/&lt;/a&gt;&lt;/code&gt; and you can debug the tests in your dev tools.&lt;/li&gt;&lt;li&gt;Finally, it runs ESLint in the console.  Not all of my files are TypeScript; essentially the build process (aka "gulp-y") files are all vanilla JS.  So they're easily breakable.  ESLint is there to provide a little reassurance on that front.&lt;/li&gt;&lt;/ul&gt;&lt;/dd&gt;&lt;/dl&gt; &lt;p&gt;Now let's dig into each of these in a little more detail&lt;/p&gt; &lt;h4&gt;WebPack&lt;/h4&gt; &lt;p&gt;Let's take a look at what's happening under the covers of &lt;code&gt;webpack.build()&lt;/code&gt; and &lt;code&gt;webpack.watch()&lt;/code&gt;.&lt;/p&gt; &lt;p&gt;&lt;a href="https://github.com/webpack/webpack"&gt;WebPack&lt;/a&gt; with &lt;a href="https://github.com/TypeStrong/ts-loader"&gt;ts-loader&lt;/a&gt; and &lt;a href="https://github.com/babel/babel-loader"&gt;babel-loader&lt;/a&gt; is what we're using to compile our ES6 TypeScript.  ts-loader uses the TypeScript compiler to, um, compile TypeScript and emit ES6 code.  This is then passed on to the babel-loader which transpiles it from ES6 down to ES-old-school. It all gets brought together in 2 files; &lt;code&gt;main.js&lt;/code&gt; which contains the compiled result of the code written by us and &lt;code&gt;vendor.js&lt;/code&gt; which contains the compiled result of 3rd party / vendor files. The reason for this separation is that vendor files are likely to change fairly rarely whilst our own code will constantly be changing.  This separation allows for quicker compile times upon file changes as, for the most part, the vendor files will not need to included in this process.&lt;/p&gt; &lt;p&gt;Our &lt;code&gt;gulpfile.js&lt;/code&gt; above uses the following task:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;'use strict';&lt;br /&gt;&lt;br /&gt;var gulp = require('gulp');&lt;br /&gt;var gutil = require('gulp-util');&lt;br /&gt;var webpack = require('webpack');&lt;br /&gt;var WebpackNotifierPlugin = require('webpack-notifier');&lt;br /&gt;var webpackConfig = require('../webpack.config.js');&lt;br /&gt;&lt;br /&gt;function buildProduction(done) {&lt;br /&gt;  // modify some webpack config options&lt;br /&gt;  var myProdConfig = Object.create(webpackConfig);&lt;br /&gt;  myProdConfig.output.filename = '[name].[hash].js';&lt;br /&gt;&lt;br /&gt;  myProdConfig.plugins = myProdConfig.plugins.concat(&lt;br /&gt;    // make the vendor.js file with cachebusting filename&lt;br /&gt;    new webpack.optimize.CommonsChunkPlugin({ name: 'vendor', filename: 'vendor.[hash].js' }),&lt;br /&gt;    new webpack.optimize.DedupePlugin(),&lt;br /&gt;    new webpack.optimize.UglifyJsPlugin()&lt;br /&gt;  );&lt;br /&gt;&lt;br /&gt;  // run webpack&lt;br /&gt;  webpack(myProdConfig, function(err, stats) {&lt;br /&gt;    if(err) { throw new gutil.PluginError('webpack:build', err); }&lt;br /&gt;    gutil.log('[webpack:build]', stats.toString({&lt;br /&gt;      colors: true&lt;br /&gt;    }));&lt;br /&gt;&lt;br /&gt;    if (done) { done(); }&lt;br /&gt;  });&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;function createDevCompiler() {&lt;br /&gt;  // show me some sourcemap love people&lt;br /&gt;  var myDevConfig = Object.create(webpackConfig);&lt;br /&gt;  myDevConfig.devtool = 'inline-source-map';&lt;br /&gt;  myDevConfig.debug = true;&lt;br /&gt;&lt;br /&gt;  myDevConfig.plugins = myDevConfig.plugins.concat(&lt;br /&gt;    // Make the vendor.js file&lt;br /&gt;    new webpack.optimize.CommonsChunkPlugin({ name: 'vendor', filename: 'vendor.js' }), &lt;br /&gt;    new WebpackNotifierPlugin({ title: 'Webpack build', excludeWarnings: true })&lt;br /&gt;  );&lt;br /&gt;&lt;br /&gt;  // create a single instance of the compiler to allow caching&lt;br /&gt;  return webpack(myDevConfig);&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;function buildDevelopment(done, devCompiler) {&lt;br /&gt;  // run webpack&lt;br /&gt;  devCompiler.run(function(err, stats) {&lt;br /&gt;    if(err) { throw new gutil.PluginError('webpack:build-dev', err); }&lt;br /&gt;    gutil.log('[webpack:build-dev]', stats.toString({&lt;br /&gt;      chunks: false, // dial down the output from webpack (it can be noisy)&lt;br /&gt;      colors: true&lt;br /&gt;    }));&lt;br /&gt;&lt;br /&gt;    if (done) { done(); }&lt;br /&gt;  });&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;function bundle(options) {&lt;br /&gt;  var devCompiler;&lt;br /&gt;&lt;br /&gt;  function build(done) {&lt;br /&gt;    if (options.shouldWatch) {&lt;br /&gt;      buildDevelopment(done, devCompiler);&lt;br /&gt;    } else {&lt;br /&gt;      buildProduction(done);&lt;br /&gt;    }&lt;br /&gt;  }&lt;br /&gt;&lt;br /&gt;  if (options.shouldWatch) {&lt;br /&gt;    devCompiler = createDevCompiler();&lt;br /&gt;&lt;br /&gt;    gulp.watch('src/**/*', function() { build(); });&lt;br /&gt;  }&lt;br /&gt;&lt;br /&gt;  return new Promise(function(resolve, reject) {&lt;br /&gt;    build(function (err) {&lt;br /&gt;      if (err) {&lt;br /&gt;        reject(err);&lt;br /&gt;      } else {&lt;br /&gt;        resolve('webpack built');&lt;br /&gt;      }&lt;br /&gt;    });&lt;br /&gt;  });&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;module.exports = {&lt;br /&gt;  build: function() { return bundle({ shouldWatch: false }); },&lt;br /&gt;  watch: function() { return bundle({ shouldWatch: true  }); }&lt;br /&gt;};&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Hopefully this is fairly self-explanatory; essentially &lt;code&gt;buildDevelopment&lt;/code&gt; performs the development build (providing sourcemap support) and &lt;code&gt;buildProduction&lt;/code&gt; builds for Production (providing minification support).  Both are driven by this &lt;code&gt;webpack.config.js&lt;/code&gt;:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;/* eslint-disable no-var, strict, prefer-arrow-callback */&lt;br /&gt;'use strict';&lt;br /&gt;&lt;br /&gt;var path = require('path');&lt;br /&gt;&lt;br /&gt;module.exports = {&lt;br /&gt;  cache: true,&lt;br /&gt;  entry: {&lt;br /&gt;    // The entry point of our application; the script that imports all other scripts in our SPA&lt;br /&gt;    main: './src/main.tsx', &lt;br /&gt;&lt;br /&gt;    // The packages that are to be included in vendor.js&lt;br /&gt;    vendor: [&lt;br /&gt;      'babel-polyfill',&lt;br /&gt;      'events',&lt;br /&gt;      'flux',&lt;br /&gt;      'react'&lt;br /&gt;    ]&lt;br /&gt;  },&lt;br /&gt;&lt;br /&gt;  // Where the output of our compilation ends up&lt;br /&gt;  output: {&lt;br /&gt;    path: path.resolve(__dirname, './dist/scripts'),&lt;br /&gt;    filename: '[name].js',&lt;br /&gt;    chunkFilename: '[chunkhash].js'&lt;br /&gt;  },&lt;br /&gt;&lt;br /&gt;  module: {&lt;br /&gt;    loaders: [{&lt;br /&gt;      // The loader that handles ts and tsx files.  These are compiled&lt;br /&gt;      // with the ts-loader and the output is then passed through to the&lt;br /&gt;      // babel-loader.  The babel-loader uses the es2015 and react presets&lt;br /&gt;      // in order that jsx and es6 are processed.&lt;br /&gt;      test: /\.ts(x?)$/,&lt;br /&gt;      exclude: /node_modules/,&lt;br /&gt;      loader: 'babel-loader?presets[]=es2015&amp;presets[]=react!ts-loader'&lt;br /&gt;    }, {&lt;br /&gt;      // The loader that handles any js files presented alone.&lt;br /&gt;      // It passes these to the babel-loader which (again) uses the es2015&lt;br /&gt;      // and react presets.&lt;br /&gt;      test: /\.js$/,&lt;br /&gt;      exclude: /node_modules/,&lt;br /&gt;      loader: 'babel',&lt;br /&gt;      query: {&lt;br /&gt;        presets: ['es2015', 'react']&lt;br /&gt;      }&lt;br /&gt;    }]&lt;br /&gt;  },&lt;br /&gt;  plugins: [&lt;br /&gt;  ],&lt;br /&gt;  resolve: {&lt;br /&gt;    // Files with the following extensions are fair game for webpack to process&lt;br /&gt;    extensions: ['', '.webpack.js', '.web.js', '.ts', '.tsx', '.js']&lt;br /&gt;  },&lt;br /&gt;};&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;h4&gt;Inject&lt;/h4&gt; &lt;p&gt;Your compiled output needs to be referenced from some kind of HTML page.  So we've got this:&lt;/p&gt; &lt;pre class="prettyprint html"&gt;&lt;br /&gt;&lt;code class="language-html"&gt;&lt;br /&gt;&amp;lt;!doctype html&amp;gt;&lt;br /&gt;&amp;lt;html lang="en"&amp;gt;&lt;br /&gt;  &amp;lt;head&amp;gt;&lt;br /&gt;    &amp;lt;meta charset="utf-8"&amp;gt;&lt;br /&gt;    &amp;lt;meta http-equiv="X-UA-Compatible" content="IE=edge"&amp;gt;&lt;br /&gt;    &amp;lt;meta name="viewport" content="width=device-width, initial-scale=1"&amp;gt;&lt;br /&gt;&lt;br /&gt;    &amp;lt;title&amp;gt;ES6 + Babel + React + Flux + Karma: The Secret Recipe&amp;lt;/title&amp;gt;&lt;br /&gt;&lt;br /&gt;    &amp;lt;!-- inject:css --&amp;gt;&lt;br /&gt;    &amp;lt;!-- endinject --&amp;gt;&lt;br /&gt;    &amp;lt;link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css"&amp;gt;&lt;br /&gt;    &amp;lt;/head&amp;gt;&lt;br /&gt;  &amp;lt;body&amp;gt;&lt;br /&gt;    &amp;lt;div id="content"&amp;gt;&amp;lt;/div&amp;gt;&lt;br /&gt;    &amp;lt;!-- inject:js --&amp;gt;&lt;br /&gt;    &amp;lt;!-- endinject --&amp;gt;&lt;br /&gt;  &amp;lt;/body&amp;gt;&lt;br /&gt;&amp;lt;/html&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Which is no more than a boilerplate HTML page with a couple of key features:&lt;/p&gt; &lt;ul&gt;&lt;li&gt;a single &lt;code&gt;&amp;lt;div /&amp;gt;&lt;/code&gt; element in the &lt;code&gt;&amp;lt;body /&amp;gt;&lt;/code&gt; which is where our React app is going to be rendered.&lt;/li&gt;&lt;li&gt;&lt;code&gt;&amp;lt;!-- inject:css --&amp;gt;&lt;/code&gt; and &lt;code&gt;&amp;lt;!-- inject:js --&amp;gt;&lt;/code&gt; placeholders where css and js is going to be injected by &lt;code&gt;gulp-inject&lt;/code&gt;.&lt;/li&gt;&lt;li&gt;a single &lt;code&gt;&amp;lt;link /&amp;gt;&lt;/code&gt; to the Bootstrap CDN.  This sample app doesn't actually serve up any css generated as part of the project.  It could but it doesn't. When it comes to injection time no css will actually be injected.  This has been left in place as, more typically, a project would have some styling served up.&lt;/li&gt;&lt;/ul&gt; &lt;p&gt;This is fed into our inject task in &lt;code&gt;inject.build()&lt;/code&gt; and &lt;code&gt;inject.watch()&lt;/code&gt;.  They take css and javascript and, using our shell template, create a new page which has the css and javascript dropped into their respective placeholders:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;'use strict';&lt;br /&gt;&lt;br /&gt;var gulp = require('gulp');&lt;br /&gt;var inject = require('gulp-inject');&lt;br /&gt;var glob = require('glob');&lt;br /&gt;&lt;br /&gt;function injectIndex(options) {&lt;br /&gt;  var postInjectCb = options.postInjectCb;&lt;br /&gt;  var postInjectCbTriggerId = null;&lt;br /&gt;  function run() {&lt;br /&gt;    var target = gulp.src('./src/index.html');&lt;br /&gt;    var sources = gulp.src([&lt;br /&gt;      //'./dist/styles/main*.css',&lt;br /&gt;      './dist/scripts/vendor*.js',&lt;br /&gt;      './dist/scripts/main*.js'&lt;br /&gt;    ], { read: false });&lt;br /&gt;&lt;br /&gt;    return target&lt;br /&gt;      .on('end', function() { // invoke postInjectCb after 1s&lt;br /&gt;        if (postInjectCbTriggerId || !postInjectCb) { return; }&lt;br /&gt;&lt;br /&gt;        postInjectCbTriggerId = setTimeout(function() {&lt;br /&gt;          postInjectCb();&lt;br /&gt;          postInjectCbTriggerId = null;&lt;br /&gt;        }, 1000);&lt;br /&gt;      })&lt;br /&gt;      .pipe(inject(sources, { ignorePath: '/dist/', addRootSlash: false, removeTags: true }))&lt;br /&gt;      .pipe(gulp.dest('./dist'));&lt;br /&gt;  }&lt;br /&gt;&lt;br /&gt;  var jsCssGlob = 'dist/**/*.{js,css}';&lt;br /&gt;&lt;br /&gt;  function checkForInitialFilesThenRun() {&lt;br /&gt;    glob(jsCssGlob, function (er, files) {&lt;br /&gt;      var filesWeNeed = ['dist/scripts/main', 'dist/scripts/vendor'/*, 'dist/styles/main'*/];&lt;br /&gt;&lt;br /&gt;      function fileIsPresent(fileWeNeed) {&lt;br /&gt;        return files.some(function(file) {&lt;br /&gt;          return file.indexOf(fileWeNeed) !== -1;&lt;br /&gt;        });&lt;br /&gt;      }&lt;br /&gt;&lt;br /&gt;      if (filesWeNeed.every(fileIsPresent)) {&lt;br /&gt;        run('initial build');&lt;br /&gt;      } else {&lt;br /&gt;        checkForInitialFilesThenRun();&lt;br /&gt;      }&lt;br /&gt;    });&lt;br /&gt;  }&lt;br /&gt;&lt;br /&gt;  checkForInitialFilesThenRun();&lt;br /&gt;&lt;br /&gt;  if (options.shouldWatch) {&lt;br /&gt;    gulp.watch(jsCssGlob, function(evt) {&lt;br /&gt;      if (evt.path &amp;&amp; evt.type === 'changed') {&lt;br /&gt;        run(evt.path);&lt;br /&gt;      }&lt;br /&gt;    });&lt;br /&gt;  }&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;module.exports = {&lt;br /&gt;  build: function() { return injectIndex({ shouldWatch: false }); },&lt;br /&gt;  watch: function(postInjectCb) { return injectIndex({ shouldWatch: true, postInjectCb: postInjectCb }); }&lt;br /&gt;};&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;This also triggers the server to serve up the new content.&lt;/p&gt; &lt;h4&gt;Static Files&lt;/h4&gt; &lt;p&gt;Your app will likely rely on a number of static assets; images, fonts and whatnot.  This script picks up the static assets you've defined and places them in the &lt;code&gt;dist&lt;/code&gt; folder ready for use:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;'use strict';&lt;br /&gt;&lt;br /&gt;var gulp = require('gulp');&lt;br /&gt;var cache = require('gulp-cached');&lt;br /&gt;&lt;br /&gt;var targets = [&lt;br /&gt;  // In my own example I don't use any of the targets below, they&lt;br /&gt;  // are included to give you more of a feel of how you might use this&lt;br /&gt;  { description: 'FONTS',   src: './fonts/*',     dest: './dist/fonts' },  &lt;br /&gt;  { description: 'STYLES',  src: './styles/*',    dest: './dist/styles' },&lt;br /&gt;  { description: 'FAVICON', src: './favicon.ico', dest: './dist' },  &lt;br /&gt;  { description: 'IMAGES',  src: './images/*',    dest: './dist/images' }&lt;br /&gt;];&lt;br /&gt;&lt;br /&gt;function copy(options) {&lt;br /&gt;  // Copy files from their source to their destination&lt;br /&gt;  function run(target) {&lt;br /&gt;    gulp.src(target.src)&lt;br /&gt;      .pipe(cache(target.description))&lt;br /&gt;      .pipe(gulp.dest(target.dest));&lt;br /&gt;  }&lt;br /&gt;&lt;br /&gt;  function watch(target) {&lt;br /&gt;    gulp.watch(target.src, function() { run(target); });&lt;br /&gt;  }&lt;br /&gt;&lt;br /&gt;  targets.forEach(run);&lt;br /&gt;&lt;br /&gt;  if (options.shouldWatch) {&lt;br /&gt;    targets.forEach(watch);&lt;br /&gt;  }&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;module.exports = {&lt;br /&gt;  build: function() { return copy({ shouldWatch: false }); },&lt;br /&gt;  watch: function() { return copy({ shouldWatch: true }); }&lt;br /&gt;};&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;h4&gt;Karma&lt;/h4&gt; &lt;p&gt;Finally, we're ready to get our tests set up to run continually with Karma. &lt;code&gt;tests.watch()&lt;/code&gt; triggers the following task:&lt;/p&gt; &lt;pre class="prettyprint"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;'use strict';&lt;br /&gt;&lt;br /&gt;var Server = require('karma').Server;&lt;br /&gt;var path = require('path');&lt;br /&gt;var gutil = require('gulp-util');&lt;br /&gt;&lt;br /&gt;module.exports = {&lt;br /&gt;  watch: function() {&lt;br /&gt;    // Documentation: https://karma-runner.github.io/0.13/dev/public-api.html&lt;br /&gt;    var karmaConfig = {&lt;br /&gt;      configFile: path.join(__dirname, '../karma.conf.js'),&lt;br /&gt;      singleRun: false,&lt;br /&gt;&lt;br /&gt;      plugins: ['karma-webpack', 'karma-jasmine', 'karma-mocha-reporter', 'karma-sourcemap-loader', 'karma-phantomjs-launcher', 'karma-phantomjs-shim'], // karma-phantomjs-shim only in place until PhantomJS hits 2.0 and has function.bind&lt;br /&gt;      reporters: ['mocha']&lt;br /&gt;    };&lt;br /&gt;&lt;br /&gt;    new Server(karmaConfig, karmaCompleted).start();&lt;br /&gt;&lt;br /&gt;    function karmaCompleted(exitCode) {&lt;br /&gt;      gutil.log('Karma has exited with:', exitCode);&lt;br /&gt;      process.exit(exitCode);&lt;br /&gt;    }&lt;br /&gt;  }&lt;br /&gt;};&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;When running in watch mode it's possible to debug the tests by going to: &lt;code&gt;&lt;a href="http://localhost:9876/"&gt;http://localhost:9876/&lt;/a&gt;&lt;/code&gt;.  It's also possible to run the tests standalone with a simple &lt;code&gt;npm run test&lt;/code&gt;.  Running them like this also outputs the results to an &lt;a href="http://stackoverflow.com/q/442556/761388"&gt;XML file in JUnit format&lt;/a&gt;; this can be useful for integrating into CI solutions that don't natively pick up test results.&lt;/p&gt;  &lt;p&gt;Whichever approach we use for running tests, we use the following &lt;code&gt;karma.conf.js&lt;/code&gt; file to configure Karma:&lt;/p&gt; &lt;pre class="prettyprint"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;/* eslint-disable no-var, strict */&lt;br /&gt;'use strict';&lt;br /&gt;&lt;br /&gt;var webpackConfig = require('./webpack.config.js');&lt;br /&gt;&lt;br /&gt;module.exports = function(config) {&lt;br /&gt;  // Documentation: https://karma-runner.github.io/0.13/config/configuration-file.html&lt;br /&gt;  config.set({&lt;br /&gt;    browsers: [ 'PhantomJS' ],&lt;br /&gt;&lt;br /&gt;    files: [&lt;br /&gt;      'test/import-babel-polyfill.js', // This ensures we have the es6 shims in place from babel&lt;br /&gt;      'test/**/*.tests.ts',&lt;br /&gt;      'test/**/*.tests.tsx'&lt;br /&gt;    ],&lt;br /&gt;&lt;br /&gt;    port: 9876,&lt;br /&gt;&lt;br /&gt;    frameworks: [ 'jasmine', 'phantomjs-shim' ],&lt;br /&gt;&lt;br /&gt;    logLevel: config.LOG_INFO, //config.LOG_DEBUG&lt;br /&gt;&lt;br /&gt;    preprocessors: {&lt;br /&gt;      'test/import-babel-polyfill.js': [ 'webpack', 'sourcemap' ],&lt;br /&gt;      'src/**/*.{ts,tsx}': [ 'webpack', 'sourcemap' ],&lt;br /&gt;      'test/**/*.tests.{ts,tsx}': [ 'webpack', 'sourcemap' ]&lt;br /&gt;    },&lt;br /&gt;&lt;br /&gt;    webpack: {&lt;br /&gt;      devtool: 'eval-source-map', //'inline-source-map', - inline-source-map doesn't work at present&lt;br /&gt;      debug: true,&lt;br /&gt;      module: webpackConfig.module,&lt;br /&gt;      resolve: webpackConfig.resolve&lt;br /&gt;    },&lt;br /&gt;&lt;br /&gt;    webpackMiddleware: {&lt;br /&gt;      quiet: true,&lt;br /&gt;      stats: {&lt;br /&gt;        colors: true&lt;br /&gt;      }&lt;br /&gt;    },&lt;br /&gt;&lt;br /&gt;    // reporter options&lt;br /&gt;    mochaReporter: {&lt;br /&gt;      colors: {&lt;br /&gt;        success: 'bgGreen',&lt;br /&gt;        info: 'cyan',&lt;br /&gt;        warning: 'bgBlue',&lt;br /&gt;        error: 'bgRed'&lt;br /&gt;      }&lt;br /&gt;    },&lt;br /&gt;&lt;br /&gt;    junitReporter: {&lt;br /&gt;      outputDir: 'test-results', // results will be saved as $outputDir/$browserName.xml&lt;br /&gt;      outputFile: undefined, // if included, results will be saved as $outputDir/$browserName/$outputFile&lt;br /&gt;      suite: ''&lt;br /&gt;    }&lt;br /&gt;  });&lt;br /&gt;};&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;As you can see, we're still using our webpack configuration from earlier to configure much of how the transpilation takes place.&lt;/p&gt; &lt;p&gt;And that's it; we have a workflow for developing in TypeScript using React with tests running in an automated fashion.  I appreciated this has been a rather long blog post but I hope I've clarified somewhat how this all plugs together and works.  Do leave a comment if you think I've missed something.&lt;/p&gt; &lt;h4&gt;Babel 5 -&gt; Babel 6&lt;/h4&gt; &lt;p&gt;This post has actually been sat waiting to be published for some time.  I'd got this solution up and running with Babel 5.  Then they shipped Babel 6 and (as is the way with "breaking changes") &lt;a href="https://phabricator.babeljs.io/T2864"&gt;broke sourcemap support&lt;/a&gt; and thus torpedoed this workflow.  Happily that's now &lt;a href="https://github.com/babel/babel/pull/3108"&gt;been resolved&lt;/a&gt;.  But if you should experience any wonkiness - it's worth checking that you're using the latest and greatest of Babel 6.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4083919089531972939'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4083919089531972939'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2015/12/es6-typescript-babel-react-flux-karma.html' title='ES6 + TypeScript + Babel + React + Flux + Karma: The Secret Recipe'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-7563417558171698800</id><published>2015-11-30T21:18:00.001Z</published><updated>2021-03-04T06:38:14.179Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='LINQ'/><category scheme='http://www.blogger.com/atom/ns#' term='IEnumerable vs IQueryable'/><title type='text'>IQueryable... IEnumerable... Hmmm...</title><content type='html'>&lt;p&gt;So there I was, tip-tapping away at my keyboard when I became aware of the slowly loudening noise of a debate.  It wasn't about poverty, war, civil rights or anything like that.  No; this was far more contentious.  It was about the behaviour of &lt;code&gt;&lt;a href="https://msdn.microsoft.com/en-gb/library/bb351562(v=vs.100).aspx"&gt;IQueryable&amp;lt;T&amp;gt;&lt;/a&gt;&lt;/code&gt; when mixed with &lt;code&gt;&lt;a href="https://msdn.microsoft.com/en-gb/library/9eekhta0(v=vs.100).aspx"&gt;IEnumerable&amp;lt;T&amp;gt;&lt;/a&gt;&lt;/code&gt;.  I know, right, how could I not get involved?&lt;/p&gt; &lt;p&gt;The code that was being debated was a database query that was being facilitated by Entity Framework.  Now let me ask you a question: what is the problem with the methods below?&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;private IEnumerable&amp;lt;Sage&amp;gt; GetSagesWithSayings()&lt;br /&gt;{&lt;br /&gt;    IQueryable&amp;lt;Sage&amp;gt; sageWithSayings = &lt;br /&gt;        from s in DbContext.Sages.Include(x =&amp;gt; x.Sayings)&lt;br /&gt;        select s;&lt;br /&gt;&lt;br /&gt;    return sageWithSayings;&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;public IEnumerable&amp;lt;Sage&amp;gt; GetSagesWithSayingsBornWithinTheLast100Years()&lt;br /&gt;{&lt;br /&gt;    var aHundredYearsAgo = DateTime.Now.AddYears(-100);&lt;br /&gt;    var sageWithSayings = GetSagesWithSayings().Where(x =&amp;gt; x.DateOfBirth &amp;gt; aHundredYearsAgo);&lt;br /&gt;&lt;br /&gt;    return sageWithSayings;&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;I've rather emphasised the problem by expressly declaring types in the &lt;code&gt;GetSagesWithSayings&lt;/code&gt; method.  More typically the &lt;code&gt;IQueryable&amp;lt;Sage&amp;gt;&lt;/code&gt; would be hiding itself beneath a &lt;code&gt;var&lt;/code&gt; making the problem less obvious. But you get the point; it's something to do with an &lt;code&gt;IQueryable&amp;lt;Sage&amp;gt;&lt;/code&gt; being passed back as an &lt;code&gt;IEnumerable&amp;lt;Sage&amp;gt;&lt;/code&gt;.&lt;/p&gt; &lt;p&gt;The debate was raging around what this piece of code (or one much like it) actually did.  One side positing "it'll get every record from the database and then throw away what it doesn't need in C#-land..."  The opposing view being "are you sure about that? Doesn't it just get the records from the last hundred years from the database?"&lt;/p&gt; &lt;p&gt;So it comes down the SQL that ends up being generated.  On the one hand it's going to get everything from the Sages table...&lt;/p&gt; &lt;pre class="prettyprint sql"&gt;&lt;br /&gt;&lt;code class="language-sql"&gt;&lt;br /&gt;select ... &lt;br /&gt;from Sages ...&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Or does it include a filter clause as well?&lt;/p&gt; &lt;pre class="prettyprint sql"&gt;&lt;br /&gt;&lt;code class="language-sql"&gt;&lt;br /&gt;select ... &lt;br /&gt;from Sages ...&lt;br /&gt;where DateOfBirth &gt; '1915-11-30'&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;You probably know the answer...  It gets everything.  Every record is brought back from the database and those that are older than 100 years are then casually thrown away.  So kinda wasteful.  That's the problem.  But why?  And what does that tell us?&lt;/p&gt; &lt;h4&gt;LINQ to Objects vs LINQ to ... ?&lt;/h4&gt; &lt;blockquote cite="https://msdn.microsoft.com/en-us/library/bb397919.aspx"&gt;&lt;p&gt;The term "LINQ to Objects" refers to the use of LINQ queries with any &lt;code&gt;IEnumerable&lt;/code&gt; or &lt;code&gt;IEnumerable&amp;lt;T&amp;gt;&lt;/code&gt; collection directly, without the use of an intermediate LINQ provider or API such as LINQ to SQL or LINQ to XML.&lt;/p&gt;&lt;/blockquote&gt; &lt;blockquote cite="https://msdn.microsoft.com/en-gb/library/bb351562(v=vs.100).aspx"&gt;&lt;p&gt;The &lt;code&gt;&lt;a href="https://msdn.microsoft.com/en-gb/library/bb351562(v=vs.100).aspx"&gt;IQueryable&amp;lt;T&amp;gt;&lt;/a&gt;&lt;/code&gt; interface is intended for implementation by query providers.&lt;/p&gt; &lt;p&gt;This interface inherits the &lt;code&gt;&lt;a href="https://msdn.microsoft.com/en-gb/library/9eekhta0(v=vs.100).aspx"&gt;IEnumerable&amp;lt;T&amp;gt;&lt;/a&gt;&lt;/code&gt; interface so that if it represents a query, the results of that query can be enumerated. Enumeration forces the expression tree associated with an &lt;code&gt;&lt;a href="https://msdn.microsoft.com/en-gb/library/bb351562(v=vs.100).aspx"&gt;IQueryable&amp;lt;T&amp;gt;&lt;/a&gt;&lt;/code&gt; object to be executed. Queries that do not return enumerable results are executed when the &lt;code&gt;&lt;a href="https://msdn.microsoft.com/en-gb/library/bb549414(v=vs.100).aspx"&gt;Execute&amp;lt;TResult&amp;gt;(Expression)&lt;/a&gt;&lt;/code&gt; method is called.&lt;/p&gt; &lt;p&gt;The definition of "executing an expression tree" is specific to a query provider. For example, it may involve translating the expression tree to a query language appropriate for an underlying data source.&lt;/p&gt;&lt;/blockquote&gt; &lt;p&gt;I know - check me out with my "quotes".&lt;/p&gt; &lt;p&gt;Now, &lt;code&gt;IEnumerable&lt;/code&gt; and &lt;code&gt;IQueryable&lt;/code&gt; are similar; for instance they are both considered "lazy" as they offer deferred execution.  But there is an important difference between &lt;code&gt;IEnumerable&lt;/code&gt; and &lt;code&gt;IQueryable&lt;/code&gt;; namely that &lt;code&gt;IQueryable&lt;/code&gt; hands off information about a query to another provider in order that they may decide how to do the necessary work.  &lt;code&gt;IEnumerable&lt;/code&gt; does not; its work is done in memory by operating on the data it has.&lt;/p&gt; &lt;p&gt;So let's apply this to our issue.  We have an &lt;code&gt;IQueryable&amp;lt;Sage&amp;gt;&lt;/code&gt; and we return it as an &lt;code&gt;IEnumerable&amp;lt;Sage&amp;gt;&lt;/code&gt;.  By doing this we haven't changed the underlying type; it's still an &lt;code&gt;IQueryable&amp;lt;Sage&amp;gt;&lt;/code&gt;.  But by upcasting to &lt;code&gt;IEnumerable&amp;lt;Sage&amp;gt;&lt;/code&gt; we have told the compiler that we don't have an &lt;code&gt;IQueryable&amp;lt;Sage&amp;gt;&lt;/code&gt;.  We've lied.  I trust you're feeling guilty.&lt;/p&gt; &lt;p&gt;No doubt whoever raised you told you not to tell lies.  This was probably the very situation they had in mind.  The implications of our dirty little fib come back to haunt us when we start to chain on subsequent filters.  So when we perform our filter of &lt;code&gt;.Where(x =&gt; x.DateOfBirth &amp;gt; aHundredYearsAgo)&lt;/code&gt; the compiler isn't going to get LINQ to Entities's extension methods in on this.  No, it's going to get the LINQ to object extension methods instead.&lt;/p&gt; &lt;p&gt;This is the cause of our problem.  When it comes to execution we're not getting the database to do the heavy lifting because we've moved away from using &lt;code&gt;IQueryable&lt;/code&gt;.&lt;/p&gt; &lt;h4&gt;Fixing the Problem&lt;/h4&gt; &lt;p&gt;There are 2 courses of action open to you.  The obvious course of action (and 99% of the time what you'd look to do) is change the signature of the &lt;code&gt;&lt;/code&gt; method to return an IQueryable like so:&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;private IQueryable&amp;lt;Sage&amp;gt; GetSagesWithSayings()&lt;br /&gt;    var sageWithSayings = // I prefer 'var', don't you?&lt;br /&gt;        from s in DbContext.Sages.Include(x =&amp;gt; x.Sayings)&lt;br /&gt;        select s;&lt;br /&gt;&lt;br /&gt;    return sageWithSayings;&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;The other alternative is what I like to think of as "the escape hatch": &lt;code&gt;&lt;a href="https://msdn.microsoft.com/en-gb/library/bb353734(v=vs.100).aspx"&gt;AsQueryable&lt;/a&gt;&lt;/code&gt;. This takes an &lt;code&gt;IEnumerable&lt;/code&gt;, checks if it's actually an &lt;code&gt;IQueryable&lt;/code&gt; slumming it and casts back to that if it is. You might use this in a situation where you didn't have control over the data access code.  Using it looks like this: (and would work whether &lt;code&gt;GetSagesWithSayings&lt;/code&gt; was returning &lt;code&gt;IEnumerable&lt;/code&gt; &lt;em&gt;or&lt;/em&gt; &lt;code&gt;IQueryable&lt;/code&gt;)&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;public IEnumerable&amp;lt;Sage&amp;gt; GetSagesWithSayingsBornWithinTheLast100Years()&lt;br /&gt;{&lt;br /&gt;    var aHundredYearsAgo = DateTime.Now.AddYears(-100);&lt;br /&gt;    var sageWithSayings =GetSagesWithSayings().AsQueryable().Where(x =&amp;gt; x.DateOfBirth &amp;gt; aHundredYearsAgo);&lt;br /&gt;&lt;br /&gt;    return sageWithSayings;&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7563417558171698800'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7563417558171698800'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2015/11/iqueryable-ienumerable-hmmm.html' title='IQueryable... IEnumerable... Hmmm...'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3431317707256387059</id><published>2015-10-23T17:48:00.000+01:00</published><updated>2015-10-23T17:48:32.478+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>The Names Have Been Changed...</title><content type='html'>&lt;p&gt;...to protect my wallet.&lt;/p&gt; &lt;p&gt;Subsequent to this blog getting &lt;a href="http://blog.johnnyreilly.com/2014/12/whats-in-a-name.html"&gt;a proper domain name a year ago&lt;/a&gt; it's now got a new one.  That's right, &lt;code&gt;blog.icanmakethiswork.io&lt;/code&gt; is dead!  Long live &lt;code&gt;blog.johnnyreilly.com&lt;/code&gt;!&lt;/p&gt; &lt;p&gt;There's nothing particularly exciting about this, it's more that &lt;code&gt;.io&lt;/code&gt; domain names are &lt;em&gt;wayyyyy&lt;/em&gt; expensive.  And also I noticed that johnnyreilly.com was available. By an accident of history I've ended up either being johnny_reilly or johnnyreilly online. ("johnreilly@hotmail.com" was already taken back in 2000 and "johnny_reilly@hotmail.com" was available.  I've subsequently become &lt;a href="https://twitter.com/johnny_reilly"&gt;@johnny_reilly&lt;/a&gt; on Twitter, &lt;a href="https://github.com/johnnyreilly"&gt;johnnyreilly&lt;/a&gt; on GitHub so I guess you could say it's stuck.)&lt;/p&gt; &lt;p&gt;So I thought I'd kill 2 birds with one stone and make the switch.  I've set up a redirect on &lt;a href="http://blog.icanmakethiswork.io"&gt;blog.icanmakethiswork.io&lt;/a&gt; and so, anyone who goes to the old site should be 301'd over here.  At least until my old domain name expires. Last time it'll change I promise.  Well.... until next time anyway...&lt;/p&gt; </content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3431317707256387059'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3431317707256387059'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2015/10/the-names-have-been-changed.html' title='The Names Have Been Changed...'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-134676306653949143</id><published>2015-10-05T10:50:00.002+01:00</published><updated>2021-03-13T14:42:01.115Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Globalize'/><category scheme='http://www.blogger.com/atom/ns#' term='jQuery Validation'/><title type='text'>jQuery Validation Globalize hits 1.0</title><content type='html'>&lt;p&gt;This is just a quick post - the tl;dr is this: jQuery Validation Globalize has been ported to Globalize 1.x.  Yay!  In one of those twists of fate I'm not actually using this plugin in my day job anymore but I thought it might be useful to other people.  So here you go.  You can read more about this plugin in an &lt;a href="https://blog.johnnyreilly.com/2012/09/globalize-and-jquery-validate.html"&gt;older post&lt;/a&gt; and you can see a demo of it in action &lt;a href="http://johnnyreilly.github.io/jQuery.Validation.Unobtrusive.Native/AdvancedDemo/Globalize.html"&gt;here&lt;/a&gt;.&lt;/p&gt; &lt;p&gt;The code did not change drastically - essentially it was just a question of swapping &lt;code&gt;parseFloat&lt;/code&gt; for &lt;code&gt;parseNumber&lt;/code&gt; and &lt;code&gt;parseDate&lt;/code&gt; for a slightly different &lt;code&gt;parseDate&lt;/code&gt;. So, we went from this:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;(function ($, Globalize) {&lt;br /&gt;&lt;br /&gt;    // Clone original methods we want to call into&lt;br /&gt;    var originalMethods = {&lt;br /&gt;        min: $.validator.methods.min,&lt;br /&gt;        max: $.validator.methods.max,&lt;br /&gt;        range: $.validator.methods.range&lt;br /&gt;    };&lt;br /&gt;&lt;br /&gt;    // Tell the validator that we want numbers parsed using Globalize&lt;br /&gt;&lt;br /&gt;    $.validator.methods.number = function (value, element) {&lt;br /&gt;        var val = Globalize.parseFloat(value);&lt;br /&gt;        return this.optional(element) || ($.isNumeric(val));&lt;br /&gt;    };&lt;br /&gt;&lt;br /&gt;    // Tell the validator that we want dates parsed using Globalize&lt;br /&gt;&lt;br /&gt;    $.validator.methods.date = function (value, element) {&lt;br /&gt;        var val = Globalize.parseDate(value);&lt;br /&gt;        return this.optional(element) || (val instanceof Date);&lt;br /&gt;    };&lt;br /&gt;&lt;br /&gt;    // Tell the validator that we want numbers parsed using Globalize, &lt;br /&gt;    // then call into original implementation with parsed value&lt;br /&gt;&lt;br /&gt;    $.validator.methods.min = function (value, element, param) {&lt;br /&gt;        var val = Globalize.parseFloat(value);&lt;br /&gt;        return originalMethods.min.call(this, val, element, param);&lt;br /&gt;    };&lt;br /&gt;&lt;br /&gt;    $.validator.methods.max = function (value, element, param) {&lt;br /&gt;        var val = Globalize.parseFloat(value);&lt;br /&gt;        return originalMethods.max.call(this, val, element, param);&lt;br /&gt;    };&lt;br /&gt;&lt;br /&gt;    $.validator.methods.range = function (value, element, param) {&lt;br /&gt;        var val = Globalize.parseFloat(value);&lt;br /&gt;        return originalMethods.range.call(this, val, element, param);&lt;br /&gt;    };&lt;br /&gt;&lt;br /&gt;}(jQuery, Globalize));&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;To this:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;(function ($, Globalize) {&lt;br /&gt;&lt;br /&gt;    // Clone original methods we want to call into&lt;br /&gt;    var originalMethods = {&lt;br /&gt;        min: $.validator.methods.min,&lt;br /&gt;        max: $.validator.methods.max,&lt;br /&gt;        range: $.validator.methods.range&lt;br /&gt;    };&lt;br /&gt;&lt;br /&gt;    // Globalize options - initially just the date format used for parsing&lt;br /&gt;    // Users can customise this to suit them&lt;br /&gt;    $.validator.methods.dateGlobalizeOptions = { dateParseFormat: { skeleton: "yMd" } };&lt;br /&gt;&lt;br /&gt;    // Tell the validator that we want numbers parsed using Globalize&lt;br /&gt;    $.validator.methods.number = function (value, element) {&lt;br /&gt;        var val = Globalize.parseNumber(value);&lt;br /&gt;        return this.optional(element) || ($.isNumeric(val));&lt;br /&gt;    };&lt;br /&gt;&lt;br /&gt;    // Tell the validator that we want dates parsed using Globalize&lt;br /&gt;    $.validator.methods.date = function (value, element) {&lt;br /&gt;        var val = Globalize.parseDate(value, $.validator.methods.dateGlobalizeOptions.dateParseFormat);&lt;br /&gt;        return this.optional(element) || (val instanceof Date);&lt;br /&gt;    };&lt;br /&gt;&lt;br /&gt;    // Tell the validator that we want numbers parsed using Globalize,&lt;br /&gt;    // then call into original implementation with parsed value&lt;br /&gt;&lt;br /&gt;    $.validator.methods.min = function (value, element, param) {&lt;br /&gt;        var val = Globalize.parseNumber(value);&lt;br /&gt;        return originalMethods.min.call(this, val, element, param);&lt;br /&gt;    };&lt;br /&gt;&lt;br /&gt;    $.validator.methods.max = function (value, element, param) {&lt;br /&gt;        var val = Globalize.parseNumber(value);&lt;br /&gt;        return originalMethods.max.call(this, val, element, param);&lt;br /&gt;    };&lt;br /&gt;&lt;br /&gt;    $.validator.methods.range = function (value, element, param) {&lt;br /&gt;        var val = Globalize.parseNumber(value);&lt;br /&gt;        return originalMethods.range.call(this, val, element, param);&lt;br /&gt;    };&lt;br /&gt;&lt;br /&gt;}(jQuery, Globalize));&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;All of which is pretty self-explanatory. The only thing I'd like to draw out is that Globalize 0.1.x didn't force you to specify a date parsing format and, as I recall, would attempt various methods of parsing.  For that reason jQuery Validation Globalize 1.0 exposes a &lt;code&gt;$.validator.methods.dateGlobalizeOptions&lt;/code&gt; which allows you to specify the data parsing format you want to use. This means, should you be using a different format than the out of the box one then you can tweak it like so:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;$.validator.methods.dateGlobalizeOptions.dateParseFormat = // your data parsing format goes here...&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Theoretically, this functionality could be tweaked to allow the user to specify multiple possible date parsing formats to attempt. I'm not certain if that's a good idea though, so it remains unimplemented for now.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/134676306653949143'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/134676306653949143'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2015/10/jquery-validation-globalize-hits-10.html' title='jQuery Validation Globalize hits 1.0'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1533204119843967619</id><published>2015-09-23T06:29:00.001+01:00</published><updated>2021-03-04T06:43:56.622Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='npm'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='DefinitelyTyped'/><category scheme='http://www.blogger.com/atom/ns#' term='TypeScript'/><category scheme='http://www.blogger.com/atom/ns#' term='atom-typescript'/><title type='text'>Definitely Typed Shouldn't Exist</title><content type='html'>&lt;p&gt;OK - the title's total clickbait but stay with me; there's a point here.&lt;/p&gt; &lt;p&gt;I'm a member of the Definitely Typed team - and hopefully I won't be kicked out for writing this.  My point is this: &lt;code&gt;.d.ts&lt;/code&gt; files should live with the package they provide typing information for, in npm / GitHub etc.  Not separately. TypeScript 1.6 has just been released.  Yay!  In the &lt;a href="http://blogs.msdn.com/b/typescript/archive/2015/09/16/announcing-typescript-1-6.aspx"&gt;release blog post&lt;/a&gt; it says this:&lt;/p&gt; &lt;blockquote cite="http://blogs.msdn.com/b/typescript/archive/2015/09/16/announcing-typescript-1-6.aspx"&gt;&lt;p&gt;Weve changed module resolution when doing CommonJS output to work more closely to how Node does module resolution.  If a module name is non-relative, we now follow these steps to find the associated typings:&lt;/p&gt; &lt;ol&gt;&lt;li&gt;Check in &lt;code&gt;node_modules&lt;/code&gt; for &lt;code&gt;&amp;lt;module name&amp;gt;.d.ts&lt;/code&gt;&lt;/li&gt;&lt;li&gt;Search &lt;code&gt;node_modules\&amp;lt;module name&amp;gt;\package.json&lt;/code&gt; for a &lt;code&gt;typings&lt;/code&gt; field&lt;/li&gt;&lt;li&gt;Look for &lt;code&gt;node_modules\&amp;lt;module name&amp;gt;\index.d.ts&lt;/code&gt;&lt;/li&gt;&lt;li&gt;Then we go one level higher and repeat the process&lt;/li&gt;&lt;/ol&gt; &lt;p&gt;&lt;strong&gt;Please note:&lt;/strong&gt; when we search through node_modules, we assume these are the packaged node modules which have type information and a corresponding &lt;code&gt;.js&lt;/code&gt; file.  As such, we resolve only &lt;code&gt;.d.ts&lt;/code&gt; files (not &lt;code&gt;.ts&lt;/code&gt; file) for non-relative names.&lt;/p&gt; &lt;p&gt;Previously, we  treated all module names as relative paths, and therefore we would never properly look in node_modules...  We will continue to improve module resolution, including improvements to AMD, in upcoming releases.&lt;/p&gt;&lt;/blockquote&gt; &lt;p&gt;The TL;DR is this: consuming npm packages which come with definition files should JUST WORK&amp;#8482;... npm is now a first class citizen in TypeScriptLand.  So everyone who has a package on npm should now feel duty bound to include a &lt;code&gt;.d.ts&lt;/code&gt; when they publish and Definitely Typed can shut up shop.  Simple right?&lt;/p&gt; &lt;h4&gt;Wrong!&lt;/h4&gt; &lt;p&gt;Yeah, it's never going to happen.  Surprising as it is, there are many people who are quite happy without TypeScript in their lives (I know - mad right?).  These poor unfortunates are unlikely to ever take the extra steps necessary to write definition files.  For this reason, there will probably &lt;em&gt;always&lt;/em&gt; be a need for a provider of typings such as Definitely Typed.  As well as that, the vast majority of people using TypeScript probably don't use npm to manage dependencies. There are, however, an increasing number of users who are using npm.  Some (like me) may even be using tools like &lt;a href="http://browserify.org/"&gt;Browserify&lt;/a&gt; (with the &lt;a href="https://github.com/smrq/tsify"&gt;TSIFY plugin&lt;/a&gt;) or &lt;a href="https://webpack.github.io/"&gt;WebPack&lt;/a&gt; (with the &lt;a href="https://github.com/jbrantly/ts-loader"&gt;TS loader&lt;/a&gt;) to bring it all together. My feeling is that, over time, using npm will become more common; particularly given the improvements being made to module resolution in the language.&lt;/p&gt; &lt;p&gt;An advantage of shipping typings with an npm package is this: those typings should accurately describe their accompanying package.  In Definitely Typed we only aim to support the latest and greatest typings.  So if you find yourself looking for the typings of an older version of a package you're going to have to pick your way back through the history of a &lt;code&gt;.d.ts&lt;/code&gt; file and hope you happen upon the version you're looking for.  Not a fantastic experience.&lt;/p&gt; &lt;p&gt;So I guess what I'm saying is this: if you're an npm package author then it would be fantastic to start shipping a package with typings in the box.  If you're using npm to consume packages then using Definitely Typed ought to be the second step you might take after installing a package; the step you only need to take if the package doesn't come with typings. Using DT should be a fallback, not a default.&lt;/p&gt; &lt;h4&gt;Authoring npm modules with TypeScript&lt;/h4&gt; &lt;p&gt;Yup - that's what this post is actually about. See how I lured you in with my mild trolling and pulled the old switcheroo?  That's edutainment my friend.  So, how do we write npm packages in TypeScript and publish them with their typings?  Apparently Gandhi &lt;a href="http://www.nytimes.com/2011/08/30/opinion/falser-words-were-never-spoken.html?_r=0"&gt;didn't actually say&lt;/a&gt; "Be the change you wish to see in the world."  Which is a shame.  But anyway, I'm going to try and embrace the sentiment here.&lt;/p&gt; &lt;p&gt;Not so long ago I wrote a small npm module called &lt;a href="https://www.npmjs.com/package/globalize-so-what-cha-want"&gt;globalize-so-what-cha-want&lt;/a&gt;.  It is used to determine what parts of Globalize 1.x you need depending on the modules you're planning to use. It also, contains a little demo UI / online tool written in React which powers &lt;a href="http://johnnyreilly.github.io/globalize-so-what-cha-want/"&gt;this&lt;/a&gt;.&lt;/p&gt; &lt;p&gt;For this post, the purpose of the package is rather irrelevant.  And even though I've just told you about it, I want you to pretend that the online tool doesn't exist.  Pretend I never mentioned it.&lt;/p&gt; &lt;p&gt;What is relevant, and what I want you to think about, is this: I wrote globalize-so-what-cha-want in plain old, honest to goodness JavaScript. Old school.&lt;/p&gt; &lt;p&gt;&lt;a href="https://www.youtube.com/watch?v=V4YPFHyGWaY&amp;feature=youtu.be&amp;t=49s"&gt;But, my love of static typing could be held in abeyance for only so long.&lt;/a&gt; Once the initial package was written, unit tested and published I got the itch.  THIS SHOULD BE WRITTEN IN TYPESCRIPT!!! Well, it didn't have to be but I wanted it to be.  Despite having used TypeScript since the early days I'd only been using it for front end work; not for writing npm packages.  My mission was clear: port globalize-so-what-cha-want to TypeScript and re-publish to npm.&lt;/p&gt; &lt;h4&gt;Port, port, port!!!&lt;/h4&gt; &lt;p&gt;At this point globalize-so-what-cha-want consisted of a single &lt;code&gt;index.js&lt;/code&gt; file in the root of the package.  My end goal was to end up with that file still sat there, but now generated from TypeScript.  Alongside it I wanted to see a &lt;code&gt;index.d.ts&lt;/code&gt; which was generated from the same TypeScript.&lt;/p&gt; &lt;p&gt;&lt;code&gt;index.js&lt;/code&gt; &lt;a href="https://github.com/johnnyreilly/globalize-so-what-cha-want/tree/6cce84289134a555fe8462247b43eddb051303e3"&gt;before&lt;/a&gt; looked like this:&lt;/p&gt; &lt;pre class="prettyprint js" style="font-size: 0.75em"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;/* jshint varstmt: false, esnext: false */&lt;br /&gt;var DEPENDENCY_TYPES = {&lt;br /&gt;  SHARED_JSON: 'Shared JSON (used by all locales)',&lt;br /&gt;  LOCALE_JSON: 'Locale specific JSON (supplied for each locale)'&lt;br /&gt;};&lt;br /&gt;&lt;br /&gt;var moduleDependencies = {&lt;br /&gt;  'core': {&lt;br /&gt;    dependsUpon: [],&lt;br /&gt;    cldrGlobalizeFiles: ['cldr.js', 'cldr/event.js', 'cldr/supplemental.js', 'globalize.js'],&lt;br /&gt;    json: [&lt;br /&gt;      { dependencyType: DEPENDENCY_TYPES.SHARED_JSON, dependency: 'cldr/supplemental/likelySubtags.json' }&lt;br /&gt;    ]&lt;br /&gt;  },&lt;br /&gt;&lt;br /&gt;  'currency': {&lt;br /&gt;    dependsUpon: ['number','plural'],&lt;br /&gt;    cldrGlobalizeFiles: ['globalize/currency.js'],&lt;br /&gt;    json: [&lt;br /&gt;      { dependencyType: DEPENDENCY_TYPES.LOCALE_JSON, dependency: 'cldr/main/{locale}/currencies.json' },&lt;br /&gt;      { dependencyType: DEPENDENCY_TYPES.SHARED_JSON, dependency: 'cldr/supplemental/currencyData.json' }&lt;br /&gt;    ]&lt;br /&gt;  },&lt;br /&gt;&lt;br /&gt;  'date': {&lt;br /&gt;    dependsUpon: ['number'],&lt;br /&gt;    cldrGlobalizeFiles: ['globalize/date.js'],&lt;br /&gt;    json: [&lt;br /&gt;      { dependencyType: DEPENDENCY_TYPES.LOCALE_JSON, dependency: 'cldr/main/{locale}/ca-gregorian.json' },&lt;br /&gt;      { dependencyType: DEPENDENCY_TYPES.LOCALE_JSON, dependency: 'cldr/main/{locale}/timeZoneNames.json' },&lt;br /&gt;      { dependencyType: DEPENDENCY_TYPES.SHARED_JSON, dependency: 'cldr/supplemental/timeData.json' },&lt;br /&gt;      { dependencyType: DEPENDENCY_TYPES.SHARED_JSON, dependency: 'cldr/supplemental/weekData.json' }&lt;br /&gt;    ]&lt;br /&gt;  },&lt;br /&gt;&lt;br /&gt;  'message': {&lt;br /&gt;    dependsUpon: ['core'],&lt;br /&gt;    cldrGlobalizeFiles: ['globalize/message.js'],&lt;br /&gt;    json: []&lt;br /&gt;  },&lt;br /&gt;&lt;br /&gt;  'number': {&lt;br /&gt;    dependsUpon: ['core'],&lt;br /&gt;    cldrGlobalizeFiles: ['globalize/number.js'],&lt;br /&gt;    json: [&lt;br /&gt;      { dependencyType: DEPENDENCY_TYPES.LOCALE_JSON, dependency: 'cldr/main/{locale}/numbers.json' },&lt;br /&gt;      { dependencyType: DEPENDENCY_TYPES.SHARED_JSON, dependency: 'cldr/supplemental/numberingSystems.json' }&lt;br /&gt;    ]&lt;br /&gt;  },&lt;br /&gt;&lt;br /&gt;  'plural': {&lt;br /&gt;    dependsUpon: ['core'],&lt;br /&gt;    cldrGlobalizeFiles: ['globalize/plural.js'],&lt;br /&gt;    json: [&lt;br /&gt;      { dependencyType: DEPENDENCY_TYPES.SHARED_JSON, dependency: 'cldr/supplemental/plurals.json' },&lt;br /&gt;      { dependencyType: DEPENDENCY_TYPES.SHARED_JSON, dependency: 'cldr/supplemental/ordinals.json' }&lt;br /&gt;    ]&lt;br /&gt;  },&lt;br /&gt;&lt;br /&gt;  'relativeTime': {&lt;br /&gt;    dependsUpon: ['number','plural'],&lt;br /&gt;    cldrGlobalizeFiles: ['globalize/relative-time.js'],&lt;br /&gt;    json: [&lt;br /&gt;      { dependencyType: DEPENDENCY_TYPES.LOCALE_JSON, dependency: 'cldr/main/{locale}/dateFields.json' }&lt;br /&gt;    ]&lt;br /&gt;  }&lt;br /&gt;};&lt;br /&gt;&lt;br /&gt;function determineRequiredCldrData(globalizeOptions) {&lt;br /&gt;  return determineRequired(globalizeOptions, _populateDependencyCurrier('json', function(json) { return json.dependency; }));&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;function determineRequiredCldrGlobalizeFiles(globalizeOptions) {&lt;br /&gt;  return determineRequired(globalizeOptions, _populateDependencyCurrier('cldrGlobalizeFiles', function(cldrGlobalizeFile) { return cldrGlobalizeFile; }));&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;function determineRequired(globalizeOptions, populateDependencies) {&lt;br /&gt;  var modules = Object.keys(globalizeOptions);&lt;br /&gt;  modules.forEach(function(module) {&lt;br /&gt;    if (!moduleDependencies[module]) {&lt;br /&gt;      throw new TypeError('There is no \'' + module + '\' module');&lt;br /&gt;    }&lt;br /&gt;  });&lt;br /&gt;&lt;br /&gt;  var requireds = [];&lt;br /&gt;  modules.forEach(function (module) {&lt;br /&gt;    if (globalizeOptions[module]) {&lt;br /&gt;      populateDependencies(module, requireds);&lt;br /&gt;    }&lt;br /&gt;  });&lt;br /&gt;&lt;br /&gt;  return requireds;&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;function _populateDependencyCurrier(requiredArray, requiredArrayGetter) {&lt;br /&gt;  var popDepFn = function(module, requireds) {&lt;br /&gt;    var dependencies = moduleDependencies[module];&lt;br /&gt;&lt;br /&gt;    dependencies.dependsUpon.forEach(function(requiredModule) {&lt;br /&gt;      popDepFn(requiredModule, requireds);&lt;br /&gt;    });&lt;br /&gt;&lt;br /&gt;    dependencies[requiredArray].forEach(function(required) {&lt;br /&gt;      var newRequired = requiredArrayGetter(required);&lt;br /&gt;      if (requireds.indexOf(newRequired) === -1) {&lt;br /&gt;        requireds.push(newRequired);&lt;br /&gt;      }&lt;br /&gt;    });&lt;br /&gt;&lt;br /&gt;    return requireds;&lt;br /&gt;  };&lt;br /&gt;&lt;br /&gt;  return popDepFn;&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;module.exports = {&lt;br /&gt;  determineRequiredCldrData: determineRequiredCldrData,&lt;br /&gt;  determineRequiredCldrGlobalizeFiles: determineRequiredCldrGlobalizeFiles&lt;br /&gt;};&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;You can even kind of tell that it was written in JavaScript thanks to the jshint rules at the top.&lt;/p&gt; &lt;p&gt;I fired up Atom and created a new folder &lt;code&gt;src/lib&lt;/code&gt; and inside there I created &lt;code&gt;index.ts&lt;/code&gt; (yes, &lt;code&gt;index.js&lt;/code&gt; renamed) and &lt;code&gt;tsconfig.json&lt;/code&gt;. By the way, you'll notice I'm not leaving Atom - I'm making use of the magnificent &lt;a href="https://atom.io/packages/atom-typescript"&gt;atom-typescript&lt;/a&gt; which you should totally be using too.  It rocks.&lt;/p&gt; &lt;a href="http://2.bp.blogspot.com/-HkCD9qNaoaU/VgIwn4WTBTI/AAAAAAAAA4g/U2E1Ybe6acI/s1600/Screenshot%2B2015-09-23%2B05.51.14.png" imageanchor="1" &gt;&lt;img border="0" src="http://2.bp.blogspot.com/-HkCD9qNaoaU/VgIwn4WTBTI/AAAAAAAAA4g/U2E1Ybe6acI/s640/Screenshot%2B2015-09-23%2B05.51.14.png" /&gt;&lt;/a&gt; &lt;p&gt;Now I'm not going to bore you with what I had to do to port the JS to TS (not much).  If you're interested, the source is &lt;a href="https://github.com/johnnyreilly/globalize-so-what-cha-want/blob/master/src/lib/index.ts"&gt;here&lt;/a&gt;.  What's more interesting is the &lt;code&gt;tsconfig.json&lt;/code&gt; - as it's this that is going to lead the generation of the JS and TS that we need:&lt;/p&gt; &lt;pre class="prettyprint json"&gt;&lt;br /&gt;&lt;code class="language-json"&gt;&lt;br /&gt;{&lt;br /&gt;    "compileOnSave": true,&lt;br /&gt;    "compilerOptions": {&lt;br /&gt;        "module": "commonjs",&lt;br /&gt;        "declaration": true,&lt;br /&gt;        "target": "es5",&lt;br /&gt;        "noImplicitAny": true,&lt;br /&gt;        "suppressImplicitAnyIndexErrors": true,&lt;br /&gt;        "removeComments": false,&lt;br /&gt;        "preserveConstEnums": true,&lt;br /&gt;        "sourceMap": false,&lt;br /&gt;        "outDir": "../../"&lt;br /&gt;    },&lt;br /&gt;    "files": [&lt;br /&gt;        "index.ts"&lt;br /&gt;    ]&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;The things to notice are:&lt;/p&gt; &lt;dl&gt;&lt;dt&gt;module&lt;/dt&gt;&lt;dd&gt;Publishing a commonjs module means it will play well with npm&lt;/dd&gt;&lt;dt&gt;declaration&lt;/dt&gt;&lt;dd&gt;This is what makes TypeScript generate &lt;code&gt;index.d.ts&lt;/code&gt;&lt;/dd&gt;&lt;dt&gt;outDir&lt;/dt&gt;&lt;dd&gt;We want to regenerate the &lt;code&gt;index.js&lt;/code&gt; in the root (2 directories above this)&lt;/dd&gt;&lt;/dl&gt; &lt;p&gt;So now, what do we get when we build in Atom? Well, we're generating an &lt;code&gt;&lt;a href="https://github.com/johnnyreilly/globalize-so-what-cha-want/blob/master/index.js"&gt;index.js&lt;/a&gt;&lt;/code&gt; file which looks like this:&lt;/p&gt; &lt;pre class="prettyprint js" style="font-size: 0.75em"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;var DEPENDENCY_TYPES = {&lt;br /&gt;  SHARED_JSON: 'Shared JSON (used by all locales)',&lt;br /&gt;  LOCALE_JSON: 'Locale specific JSON (supplied for each locale)'&lt;br /&gt;};&lt;br /&gt;var moduleDependencies = {&lt;br /&gt;  'core': {&lt;br /&gt;    dependsUpon: [],&lt;br /&gt;    cldrGlobalizeFiles: ['cldr.js', 'cldr/event.js', 'cldr/supplemental.js', 'globalize.js'],&lt;br /&gt;    json: [&lt;br /&gt;      { dependencyType: DEPENDENCY_TYPES.SHARED_JSON, dependency: 'cldr/supplemental/likelySubtags.json' }&lt;br /&gt;    ]&lt;br /&gt;  },&lt;br /&gt;  'currency': {&lt;br /&gt;    dependsUpon: ['number', 'plural'],&lt;br /&gt;    cldrGlobalizeFiles: ['globalize/currency.js'],&lt;br /&gt;    json: [&lt;br /&gt;      { dependencyType: DEPENDENCY_TYPES.LOCALE_JSON, dependency: 'cldr/main/{locale}/currencies.json' },&lt;br /&gt;      { dependencyType: DEPENDENCY_TYPES.SHARED_JSON, dependency: 'cldr/supplemental/currencyData.json' }&lt;br /&gt;    ]&lt;br /&gt;  },&lt;br /&gt;  'date': {&lt;br /&gt;    dependsUpon: ['number'],&lt;br /&gt;    cldrGlobalizeFiles: ['globalize/date.js'],&lt;br /&gt;    json: [&lt;br /&gt;      { dependencyType: DEPENDENCY_TYPES.LOCALE_JSON, dependency: 'cldr/main/{locale}/ca-gregorian.json' },&lt;br /&gt;      { dependencyType: DEPENDENCY_TYPES.LOCALE_JSON, dependency: 'cldr/main/{locale}/timeZoneNames.json' },&lt;br /&gt;      { dependencyType: DEPENDENCY_TYPES.SHARED_JSON, dependency: 'cldr/supplemental/timeData.json' },&lt;br /&gt;      { dependencyType: DEPENDENCY_TYPES.SHARED_JSON, dependency: 'cldr/supplemental/weekData.json' }&lt;br /&gt;    ]&lt;br /&gt;  },&lt;br /&gt;  'message': {&lt;br /&gt;    dependsUpon: ['core'],&lt;br /&gt;    cldrGlobalizeFiles: ['globalize/message.js'],&lt;br /&gt;    json: []&lt;br /&gt;  },&lt;br /&gt;  'number': {&lt;br /&gt;    dependsUpon: ['core'],&lt;br /&gt;    cldrGlobalizeFiles: ['globalize/number.js'],&lt;br /&gt;    json: [&lt;br /&gt;      { dependencyType: DEPENDENCY_TYPES.LOCALE_JSON, dependency: 'cldr/main/{locale}/numbers.json' },&lt;br /&gt;      { dependencyType: DEPENDENCY_TYPES.SHARED_JSON, dependency: 'cldr/supplemental/numberingSystems.json' }&lt;br /&gt;    ]&lt;br /&gt;  },&lt;br /&gt;  'plural': {&lt;br /&gt;    dependsUpon: ['core'],&lt;br /&gt;    cldrGlobalizeFiles: ['globalize/plural.js'],&lt;br /&gt;    json: [&lt;br /&gt;      { dependencyType: DEPENDENCY_TYPES.SHARED_JSON, dependency: 'cldr/supplemental/plurals.json' },&lt;br /&gt;      { dependencyType: DEPENDENCY_TYPES.SHARED_JSON, dependency: 'cldr/supplemental/ordinals.json' }&lt;br /&gt;    ]&lt;br /&gt;  },&lt;br /&gt;  'relativeTime': {&lt;br /&gt;    dependsUpon: ['number', 'plural'],&lt;br /&gt;    cldrGlobalizeFiles: ['globalize/relative-time.js'],&lt;br /&gt;    json: [&lt;br /&gt;      { dependencyType: DEPENDENCY_TYPES.LOCALE_JSON, dependency: 'cldr/main/{locale}/dateFields.json' }&lt;br /&gt;    ]&lt;br /&gt;  }&lt;br /&gt;};&lt;br /&gt;function determineRequired(globalizeOptions, populateDependencies) {&lt;br /&gt;  var modules = Object.keys(globalizeOptions);&lt;br /&gt;  modules.forEach(function (module) {&lt;br /&gt;    if (!moduleDependencies[module]) {&lt;br /&gt;      throw new TypeError('There is no \'' + module + '\' module');&lt;br /&gt;    }&lt;br /&gt;  });&lt;br /&gt;  var requireds = [];&lt;br /&gt;  modules.forEach(function (module) {&lt;br /&gt;    if (globalizeOptions[module]) {&lt;br /&gt;      populateDependencies(module, requireds);&lt;br /&gt;    }&lt;br /&gt;  });&lt;br /&gt;  return requireds;&lt;br /&gt;}&lt;br /&gt;function _populateDependencyCurrier(requiredArray, requiredArrayGetter) {&lt;br /&gt;  var popDepFn = function (module, requireds) {&lt;br /&gt;    var dependencies = moduleDependencies[module];&lt;br /&gt;    dependencies.dependsUpon.forEach(function (requiredModule) {&lt;br /&gt;      popDepFn(requiredModule, requireds);&lt;br /&gt;    });&lt;br /&gt;    dependencies[requiredArray].forEach(function (required) {&lt;br /&gt;      var newRequired = requiredArrayGetter(required);&lt;br /&gt;      if (requireds.indexOf(newRequired) === -1) {&lt;br /&gt;        requireds.push(newRequired);&lt;br /&gt;      }&lt;br /&gt;    });&lt;br /&gt;    return requireds;&lt;br /&gt;  };&lt;br /&gt;  return popDepFn;&lt;br /&gt;}&lt;br /&gt;/**&lt;br /&gt; * The string array returned will contain a list of the required cldr json data you need. I don't believe ordering matters for the json but it is listed in the same dependency order as the cldr / globalize files are.&lt;br /&gt; *&lt;br /&gt; * @param options The globalize modules being used.&lt;br /&gt; */&lt;br /&gt;function determineRequiredCldrData(globalizeOptions) {&lt;br /&gt;  return determineRequired(globalizeOptions, _populateDependencyCurrier('json', function (json) { return json.dependency; }));&lt;br /&gt;}&lt;br /&gt;exports.determineRequiredCldrData = determineRequiredCldrData;&lt;br /&gt;/**&lt;br /&gt; * The string array returned will contain a list of the required cldr / globalize files you need, listed in the order they are required.&lt;br /&gt; *&lt;br /&gt; * @param options The globalize modules being used.&lt;br /&gt; */&lt;br /&gt;function determineRequiredCldrGlobalizeFiles(globalizeOptions) {&lt;br /&gt;  return determineRequired(globalizeOptions, _populateDependencyCurrier('cldrGlobalizeFiles', function (cldrGlobalizeFile) { return cldrGlobalizeFile; }));&lt;br /&gt;}&lt;br /&gt;exports.determineRequiredCldrGlobalizeFiles = determineRequiredCldrGlobalizeFiles;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Aside from one method moving internally and me adding some JSDoc, the only really notable change is the end of the file.  TypeScript, when generating commonjs, doesn't use the &lt;code&gt;module.exports = {}&lt;/code&gt; approach.  Rather, it drops exported functions onto the &lt;code&gt;exports&lt;/code&gt; object as functions are exported.  Functionally this is &lt;em&gt;identical&lt;/em&gt;.&lt;/p&gt; &lt;p&gt;Now for our big finish: happily sat alongside is &lt;code&gt;index.js&lt;/code&gt; is the &lt;code&gt;&lt;a href="https://github.com/johnnyreilly/globalize-so-what-cha-want/blob/master/index.d.ts"&gt;index.d.ts&lt;/a&gt;&lt;/code&gt; file:&lt;/p&gt; &lt;pre class="prettyprint ts"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;export interface Options {&lt;br /&gt;  currency?: boolean;&lt;br /&gt;  date?: boolean;&lt;br /&gt;  message?: boolean;&lt;br /&gt;  number?: boolean;&lt;br /&gt;  plural?: boolean;&lt;br /&gt;  relativeTime?: boolean;&lt;br /&gt;}&lt;br /&gt;/**&lt;br /&gt; * The string array returned will contain a list of the required cldr json data you need. I don't believe ordering matters for the json but it is listed in the same dependency order as the cldr / globalize files are.&lt;br /&gt; *&lt;br /&gt; * @param options The globalize modules being used.&lt;br /&gt; */&lt;br /&gt;export declare function determineRequiredCldrData(globalizeOptions: Options): string[];&lt;br /&gt;/**&lt;br /&gt; * The string array returned will contain a list of the required cldr / globalize files you need, listed in the order they are required.&lt;br /&gt; *&lt;br /&gt; * @param options The globalize modules being used.&lt;br /&gt; */&lt;br /&gt;export declare function determineRequiredCldrGlobalizeFiles(globalizeOptions: Options): string[];&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;We're there, huzzah!  This has been now published to npm - anyone consuming this package can use TypeScript straight out of the box.  I really hope that publishing npm packages in this fashion becomes much more commonplace. Time will tell.&lt;/p&gt; &lt;h4&gt;PS I'm not the only one&lt;/h4&gt; &lt;p&gt;I was just about to hit "publish" when I happened upon &lt;a href="https://twitter.com/basarat"&gt;Basarat&lt;/a&gt;'s &lt;a href="https://github.com/basarat/ts-npm-module"&gt;ts-npm-module&lt;/a&gt; which is  a project on GitHub which demo's how to publish and consume TypeScript using npm.  I'd say great minds think alike but I'm pretty sure Basarat's mind is far greater than mine! (Cough, atom-typescript, cough.)  Either way, it's good to see validation for the approach I'm suggesting.&lt;/p&gt; &lt;h4&gt;PPS Update 23/09/2015 09:51&lt;/h4&gt; &lt;p&gt;One of the useful things about writing a blog is that you get to learn.  Since I published I've become aware of a few things somewhat relevant to this post.  First of all, there is still work ongoing in TypeScript land around this topic.  Essentially there are problems resolving dependency conflicts when different dependencies have different versions - you can take part in the ongoing discussion &lt;a href="https://github.com/Microsoft/TypeScript/issues/4665"&gt;here&lt;/a&gt;.  There's also some useful resources to look at:&lt;/p&gt; &lt;ul&gt;&lt;li&gt;&lt;a href="https://github.com/Microsoft/TypeScript/wiki/Typings-for-npm-packages"&gt;https://github.com/Microsoft/TypeScript/wiki/Typings-for-npm-packages&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="https://basarat.gitbooks.io/typescript/content/docs/node/nodejs.html"&gt;https://basarat.gitbooks.io/typescript/content/docs/node/nodejs.html&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1533204119843967619'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1533204119843967619'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2015/09/authoring-npm-modules-with-typescript.html' title='Definitely Typed Shouldn&apos;t Exist'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='http://2.bp.blogspot.com/-HkCD9qNaoaU/VgIwn4WTBTI/AAAAAAAAA4g/U2E1Ybe6acI/s72-c/Screenshot%2B2015-09-23%2B05.51.14.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-34993616929977275</id><published>2015-09-10T13:47:00.001+01:00</published><updated>2021-03-04T06:44:54.566Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Browserify'/><category scheme='http://www.blogger.com/atom/ns#' term='ES6'/><category scheme='http://www.blogger.com/atom/ns#' term='Atom'/><category scheme='http://www.blogger.com/atom/ns#' term='Babel'/><category scheme='http://www.blogger.com/atom/ns#' term='React'/><category scheme='http://www.blogger.com/atom/ns#' term='WebSockets'/><title type='text'>Things Done Changed</title><content type='html'>&lt;p&gt;Some people fear change.  Most people actually.  I'm not immune to that myself, but not in the key area of technology.  Any developer that fears change when it comes to the tools and languages that he / she is using is in the &lt;em&gt;wrong&lt;/em&gt; business.  Because what you're using to cut code today will not last.  The language will evolve, the tools and frameworks that you love will die out and be replaced by new ones that are different and strange.  In time, the language you feel you write as a native will fall out of favour, replaced by a new upstart.&lt;/p&gt; &lt;p&gt;My first gig was writing telecoms software using Delphi.  I haven't touched Delphi (or telecoms for that matter) for over 10 years now.  Believe me, I grok that things change.&lt;/p&gt; &lt;p&gt;That is the developer's lot.  If you're able to accept that then you'll be just fine.  For my part I've always rather relished the new and so I embrace it.  However, I've met a surprising number of devs that are outraged when they realise that the language and tools they have used since their first job are not going to last.  They do not go gentle into that good dawn.  They rage, rage against the death of WebForms.  My apologies to Dylan Thomas.&lt;/p&gt; &lt;p&gt;I recently started a new contract. This always brings a certain amount of change.  This is part of the fun of contracting.  However, the change was more significant in this case. As a result, the tools that I've been using for the last couple of months have been rather different to those that I'm used to.  I've been outside my comfort zone. I've loved it.  And now I want to reflect upon it.  Because, in the words of Socrates, "the unexamined life is not worth living".&lt;/p&gt; &lt;h4&gt;The Shock of the New (Toys)&lt;/h4&gt; &lt;p&gt;I'd been brought in to work on a full stack ASP.Net project.  However, I've initially been working on a separate project which is &lt;em&gt;entirely&lt;/em&gt; different.  A web client app which has nothing to do with ASP.Net at all.  It's a greenfield app which is built using the following:&lt;/p&gt; &lt;ol&gt;&lt;li&gt;&lt;a href="https://facebook.github.io/react/"&gt;React&lt;/a&gt; / &lt;a href="https://facebook.github.io/flux/docs/overview.html"&gt;Flux&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API"&gt;WebSockets&lt;/a&gt; / &lt;a href="https://developers.google.com/protocol-buffers/"&gt;Protocol Buffers&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="http://browserify.org/"&gt;Browserify&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="http://babeljs.io/"&gt;ES6 with Babel&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="https://karma-runner.github.io"&gt;Karma&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="http://gulpjs.com/"&gt;Gulp&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="https://atom.io/"&gt;Atom&lt;/a&gt;&lt;/li&gt;&lt;/ol&gt; &lt;p&gt;Where to begin? Perhaps at the end - Atom.&lt;/p&gt; &lt;h4&gt;How Does it Feel to be on Your Own?&lt;/h4&gt; &lt;p&gt;When all around you, as far as the eye can see, are monitors displaying Visual Studio in all its grey glory whilst I was hammering away on Atom. It felt pretty good actually.&lt;/p&gt; &lt;p&gt;The app I was working on was a React / Flux app.  You know what that means?  JSX!  At the time the project began Visual Studio did not have good editor support for JSX (something that the shipping of VS 2015 may have remedied but I haven't checked). So, rather than endure a life dominated with red squigglies I jumped ship and moved over to using GitHub's Atom to edit code.&lt;/p&gt; &lt;p&gt;I rather like it.  Whilst VS is a full blown IDE, Atom is a text editor.  A very pretty one.  And crucially, one that can be extended by plugins of which there is a rich ecosystem.  You want JSX support?  &lt;a href="https://atom.io/packages/jshint"&gt;There's a plugin for that&lt;/a&gt;.  You want something that formats JSON nicely for you? &lt;a href="https://atom.io/packages/pretty-json"&gt;There's a plugin for that too&lt;/a&gt;.&lt;/p&gt; &lt;p&gt;My only criticism of Atom really is that it doesn't handle large files well and it crashes a lot.  I'm quite surprised by both of these characteristics given that in contrast to VS it is so small.  You'd think the basics would be better covered.  Go figure.  It still rocks though. It looks so sexy - how could I not like it?&lt;/p&gt; &lt;h4&gt;Someone to watch over me&lt;/h4&gt; &lt;p&gt;I've been using Gulp for a while now.  It's a great JavaScript task runner and incredibly powerful.  Previously though, I've used it as part of a manual build step (even plumbing it into my csproj).  With the current project I've moved over to using the watch functionality of gulp.  So I'm scrapping triggering gulp tasks manually. Instead we have gulp configured to gaze lovingly at the source files and, when they change, re-run the build steps.&lt;/p&gt; &lt;p&gt;This is nice for a couple of reasons:&lt;/p&gt; &lt;ul&gt;&lt;li&gt;When I want to test out the app the build is already done - I don't have to wait for it to happen.&lt;/li&gt;&lt;li&gt;When I do bad things I find out faster.  So I've got JSHint being triggered by my watch.  If I write code that makes JSHint sad (and I haven't noticed the warnings from the &lt;a href="https://atom.io/packages/jshint"&gt;atom plugin&lt;/a&gt;) then they'll appear in the console.  Likewise, my unit tests are continuously running in response to file changes (in an &lt;a href="http://www.ncrunch.net/"&gt;ncrunch&lt;/a&gt;-y sorta style) and so I know straight away if I'm breaking tests.  Rather invaluable in the dynamic world of JavaScript.&lt;/li&gt;&lt;/ul&gt; &lt;h4&gt;Karma, Karma, Karma, Chameleon&lt;/h4&gt; &lt;p&gt;In the past, when using Visual Studio, it made sense to use the mighty &lt;a href="http://mmanela.github.io/chutzpah/"&gt;Chutzpah&lt;/a&gt; which allows you to run JS unit tests from within VS itself.  I needed a new way to run my Jasmine unit tests.  The obvious choice was Karma (built by the Angular team I think?).  It's really flexible.&lt;/p&gt; &lt;p&gt;You're using Browserify?  &lt;a href="https://www.npmjs.com/package/karma-browserify"&gt;No bother&lt;/a&gt;. You're writing ES6 and transpiling with Babel? Not a problem.  You want code coverage?  &lt;a href="https://www.npmjs.com/package/karma-coverage"&gt;That we can do&lt;/a&gt;. You want an integration for TeamCity?  &lt;a href="https://www.npmjs.com/package/karma-teamcity-reporter"&gt;That too is sorted&lt;/a&gt;....&lt;/p&gt; &lt;p&gt;Karma is fantastic. Fun fact: originally it was called Testacular. I kind of get why they changed the name but the world is all the duller for it.  A side effect of the name change is that due to invalid search results I know a lot more about Buddhism than I used to.&lt;/p&gt; &lt;h4&gt;I cry Babel, Babel, look at me now&lt;/h4&gt; &lt;p&gt;Can you not wait for the future?  Me neither.  Even though it's 2015 and Back to the Future II takes place  in &lt;a href="http://www.october212015.com/"&gt;only a month's time&lt;/a&gt;.  So I'm not waiting for a million and one browsers to implement ES6 and IE 8 to finally die dammit.  Nope, I have a plan and it's &lt;a href="http://babeljs.io/"&gt;Babel&lt;/a&gt;.  Transpile the tears away, write ES6 and have Babel spit out EStoday.&lt;/p&gt; &lt;p&gt;I've found this pretty addictive.  Once you've started using ES6 features it's hard to go back.  Take &lt;a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment"&gt;destructuring&lt;/a&gt; - I can't get enough of it. &lt;/p&gt; &lt;p&gt;Whilst I love Babel, it has caused me some sadness as well.  My beloved TypeScript is currently not in the mix, Babel is instead sat squarely where I want TS to be.  I'm without static types and rather bereft.  You can certainly live without them but having done so for a while I'm pretty clear now that static typing is a massive productivity win.  You don't have to hold the data structures that you're working on in your head so much, code completion gives you what you need there, you can focus more on the problem that you're trying to solve.  You also burn less time on silly mistakes.  If you accidentally change the return type of a function you're likely to know straight away.  Refactoring is so much harder without static types.  I could go on.&lt;/p&gt; &lt;p&gt;All this goes to say: I want my static typing back.  It wasn't really an option to use TypeScript in the beginning because we were using JSX and TS didn't support it.  However!  TypeScript is due to add support for JSX in &lt;a href="http://blogs.msdn.com/b/typescript/archive/2015/09/02/announcing-typescript-1-6-beta-react-jsx-better-error-checking-and-more.aspx"&gt;TS 1.6 (currently in beta)&lt;/a&gt;. I've plans to see if I can get TypeScript to emit ES6 and then keep using Babel to do the transpilation.  Whether this will work, I don't know yet.  But it seems likely.    So I'm hoping for a bright future.&lt;/p&gt; &lt;h4&gt;Browserify (there are no song lyrics that can be crowbarred in)&lt;/h4&gt; &lt;p&gt;Emitting scripts in the required order has been a perpetual pain for everyone in the web world for the longest time.  I've taken about 5 different approaches to solving this problem over the years.  None felt particularly good.  So Browserify.&lt;/p&gt; &lt;p&gt;Browserify solves the problem of script ordering for you by allowing you to define an entry point to your application and getting you to write &lt;code&gt;require&lt;/code&gt; (npm style)  or &lt;code&gt;import&lt;/code&gt; (&lt;a href="http://exploringjs.com/es6/ch_modules.html"&gt;ES6 modules&lt;/a&gt;) to bring in the modules that you need.  This allows Browserify (which we're using with Babel thanks to the &lt;a href="https://github.com/babel/babelify"&gt;babelify transform&lt;/a&gt;) to create a ginormous js file that contains the scripts served as needed.  Thanks to the magic of source maps it also allows us to debug our original code (yup, the original ES6!) Browserify has the added bonus of allowing us free reign to pull in npm packages to use in our app without a great deal of ceremony.&lt;/p&gt; &lt;p&gt;Browserify is pretty fab - my only real reservation is that if you step outside the normal use cases you can quickly find yourself in deep water.  Take for instance web workers.  We were briefly looking into using them as an optimisation (breaking IO onto a separate process from the UI).  A prime reason for backing away from this is that &lt;a href="https://github.com/substack/webworkify/issues/14"&gt;Web Workers don't play particularly well with Browserify&lt;/a&gt;.  And when you've got Babel (or &lt;a href="https://github.com/babel/babelify"&gt;Babelify&lt;/a&gt;) in the mix the problems just multiply.  That apart, I really dig Browserify.  I think I'd like to give WebPack a go as well as I understand it fulfills a similar purpose.&lt;/p&gt; &lt;h4&gt;WebSockets / Protocol Buffers&lt;/h4&gt; &lt;p&gt;The application I'm working on is plugging into an existing system which uses WebSockets for communication.  Since WebSockets are native to the web we've been able to plumb these straight into our app. We're also using Protocol Buffers as another optimisation; a way to save a few extra bytes from going down the wire. I don't have much to say about either, just some observations really:&lt;/p&gt; &lt;ol&gt;&lt;li&gt;WebSockets is a slightly different way of working - permanently open connections as opposed to the request / response paradigm of classic HTTP&lt;/li&gt;&lt;li&gt;WebSockets are wicked fast (due in part to those permanent connections).  So performance is &lt;em&gt;amazing&lt;/em&gt;.  Fast like native, type amazing. In our case performance is pretty important and so this has been really great.&lt;/li&gt;&lt;/ol&gt; &lt;h4&gt;React / Flux&lt;/h4&gt; &lt;p&gt;Finally, React and Flux.  I was completely new to these when I came onto the project and I quickly came to love them.  There was a prejudice for me to overcome and that was JSX.  When I first saw it I felt a little sick.  "Have we learned &lt;em&gt;NOTHING&lt;/em&gt;???" I wailed.  "Don't we know that embedding strings in our controllers is a &lt;em&gt;BAD&lt;/em&gt; thing?"  I was wrong.  I had an epiphany.  I discovered that JSX is not, as I first imagined, embedded HTML strings. Actually it's syntactic sugar for object creation.  A simple example:&lt;/p&gt; &lt;pre class="prettyprint jsx"&gt;&lt;br /&gt;&lt;code class="language-jsx"&gt;&lt;br /&gt;var App;&lt;br /&gt;&lt;br /&gt;// Some JSX:&lt;br /&gt;var app = &amp;lt;App version="1.0.0" /&amp;gt;;&lt;br /&gt;&lt;br /&gt;// What that JSX transpiles into:&lt;br /&gt;var app = React.createElement(App, {version:"1.0.0"});&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Now that I'm well used to JSX and React I've really got to like it.  I keep my views / components as dumb as possible and do all the complex logic in the stores.  The stores are just standard JavaScript and so, pretty testable (simple Jasmine gives you all you need - I haven't felt the need for &lt;a href="https://facebook.github.io/jest/"&gt;Jest&lt;/a&gt;).  The components / views are also completely testable.  I'd advise anyone coming to React afresh to make use of the &lt;code&gt;&lt;a href="https://facebook.github.io/react/docs/test-utils.html#shallow-rendering"&gt;ReactShallowRenderer&lt;/a&gt;&lt;/code&gt; for these purposes. This means you can test without a DOM - much better all round.&lt;/p&gt; &lt;p&gt;I don't have a great deal to say about Flux; I think my views on it aren't fully formed yet.  I do really like predictability that unidirectional data flow gives you. However, I'm mindful that the app that I've been writing is very much about displaying data and doesn't require much user input.  I know that I'm living without 2-way data binding and I do wonder if I would come to miss it.  Time will tell.&lt;/p&gt; &lt;p&gt;I really want to get back to static typing.  That either means TypeScript (which I know and love) or Facebook's Flow. (&lt;a href="https://github.com/facebook/flow/issues/6"&gt;A Windows version of Flow is in the works&lt;/a&gt;.)   I'll be very happy if I get either into the mix...  Watch this space.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/34993616929977275'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/34993616929977275'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2015/09/things-done-changed.html' title='Things Done Changed'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-982806512443541778</id><published>2015-08-31T06:56:00.001+01:00</published><updated>2015-08-31T06:56:48.818+01:00</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Karma'/><category scheme='http://www.blogger.com/atom/ns#' term='AppVeyor'/><title type='text'>Karma's Gonna Get AppVeyor</title><content type='html'>&lt;p&gt;Historically I thought of &lt;a href="http://www.appveyor.com/"&gt;AppVeyor&lt;/a&gt; as a continuous integration solution for .NET.  And it is.  But that's not all it is; it's generally just CI fabness.  I'm now using it as my go to solution for JavaScript builds - and it works really well.&lt;/p&gt; &lt;p&gt;A year ago I wrote about &lt;a href="/2014/09/running-javascript-unit-tests-in-appveyor.html"&gt;running JavaScript unit tests on AppVeyor with a little help from Chutzpah&lt;/a&gt;.  Over this last year I've been doing more and more in JavaScript and have started using more of the standard JS build and testing tools.  As a result of that I've moved away from using Chutzpah to run my tests (great though it is) and have started to use &lt;a href="https://karma-runner.github.io/"&gt;Karma&lt;/a&gt; instead.&lt;/p&gt; &lt;p&gt;This post documents the bare bones that you need in place for a simple JavaScript build setup in AppVeyor, including logging test results to the build.&lt;/p&gt; &lt;p&gt;If you'd like to see an example of this approach in action then take a look at this &lt;a href="https://github.com/johnnyreilly/globalize-so-what-cha-want"&gt;repo&lt;/a&gt;.&lt;/p&gt; &lt;pre class="prettyprint ps"&gt;&lt;br /&gt;write-host "Present working directory: $($pwd)"&lt;br /&gt;&lt;br /&gt;$testsuites = [xml](get-content .\test-results\*.xml)&lt;br /&gt;$anyFailures = $FALSE&lt;br /&gt;&lt;br /&gt;foreach ($testsuite in $testsuites.testsuite) {&lt;br /&gt;&lt;br /&gt;    write-host " $($testsuite.name)"&lt;br /&gt;&lt;br /&gt;    foreach ($testcase in $testsuite.testcase){&lt;br /&gt;        $failed = $testcase.failure&lt;br /&gt;        $time = [decimal]$testcase.time * 1000 # from seconds to milliseconds&lt;br /&gt;        $testName = "$($testcase.classname) $($testcase.name)"&lt;br /&gt;&lt;br /&gt;        if ($failed) {&lt;br /&gt;            write-host "Failed $($testcase.name) $($testcase.failure.message) in $($time) ms"&lt;br /&gt;            Add-AppveyorTest $testName -Outcome Failed -FileName $testsuite.name -ErrorMessage $testcase.failure.message -Duration $time&lt;br /&gt;            $anyFailures = $TRUE&lt;br /&gt;        }&lt;br /&gt;        else {&lt;br /&gt;            write-host "Passed $($testcase.name) in $($time) ms"&lt;br /&gt;            Add-AppveyorTest $testName -Outcome Passed -FileName $testsuite.name -Duration $time&lt;br /&gt;        }&lt;br /&gt;    }&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;if ($anyFailures -eq $TRUE){&lt;br /&gt;    write-host "Failing build as there are broken tests"&lt;br /&gt;    $host.SetShouldExit(1)&lt;br /&gt;}&lt;br /&gt;&lt;/pre&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;// Karma configuration&lt;br /&gt;// Generated on Thu Jul 16 2015 21:14:44 GMT+0100 (GMT Summer Time)&lt;br /&gt;&lt;br /&gt;module.exports = function(config) {&lt;br /&gt;  var gulpConfig = require("./gulpfile.config.js");&lt;br /&gt;  var scripts = [].concat(&lt;br /&gt;    gulpConfig.getBowerScriptsOrStyles('js'),&lt;br /&gt;    'bower_components/angular-mocks/angular-mocks.js',&lt;br /&gt;    gulpConfig.scripts.map(function(s) { return s.replace('.{ts,js.map,js}', '.js'); }),&lt;br /&gt;    gulpConfig.tests);&lt;br /&gt;&lt;br /&gt;  config.set({&lt;br /&gt;&lt;br /&gt;    // frameworks to use&lt;br /&gt;    // available frameworks: https://npmjs.org/browse/keyword/karma-adapter&lt;br /&gt;    frameworks: ['jasmine'],&lt;br /&gt;&lt;br /&gt;    // list of files / patterns to load in the browser&lt;br /&gt;    files: scripts,&lt;br /&gt;&lt;br /&gt;    // test results reporter to use&lt;br /&gt;    // possible values: 'dots', 'progress'&lt;br /&gt;    // available reporters: https://npmjs.org/browse/keyword/karma-reporter&lt;br /&gt;    reporters: ['progress', 'junit'],&lt;br /&gt;&lt;br /&gt;    // the default configuration&lt;br /&gt;    junitReporter: {&lt;br /&gt;      outputDir: 'test-results', // results will be saved as $outputDir/$browserName.xml&lt;br /&gt;      outputFile: undefined, // if included, results will be saved as $outputDir/$browserName/$outputFile&lt;br /&gt;      suite: ''&lt;br /&gt;    },&lt;br /&gt;&lt;br /&gt;    // level of logging&lt;br /&gt;    // possible values: config.LOG_DISABLE || config.LOG_ERROR || config.LOG_WARN || config.LOG_INFO || config.LOG_DEBUG&lt;br /&gt;    logLevel: config.LOG_DEBUG,&lt;br /&gt;&lt;br /&gt;    // start these browsers&lt;br /&gt;    // available browser launchers: https://npmjs.org/browse/keyword/karma-launcher&lt;br /&gt;    browsers: [/*'Chrome',*/ 'PhantomJS'],&lt;br /&gt;&lt;br /&gt;    // Continuous Integration mode&lt;br /&gt;    // if true, Karma captures browsers, runs the tests and exits&lt;br /&gt;    singleRun: true&lt;br /&gt;  });&lt;br /&gt;};&lt;br /&gt;&lt;/pre&gt; &lt;pre class="prettyprint"&gt;&lt;br /&gt;version: 1.0.{build}&lt;br /&gt;&lt;br /&gt;branches:&lt;br /&gt;  only:&lt;br /&gt;    - master&lt;br /&gt;&lt;br /&gt;# scripts to run before build&lt;br /&gt;before_build:&lt;br /&gt;- cmd: &gt;-&lt;br /&gt;    npm install&lt;br /&gt;&lt;br /&gt;    npm run bower-install&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;build_script:&lt;br /&gt;- cmd: &gt;-&lt;br /&gt;    npm run build-release&lt;br /&gt;&lt;br /&gt;before_test:&lt;br /&gt;- ps: &gt;-&lt;br /&gt;    ./registerTestResults.ps1&lt;br /&gt;&lt;/pre&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/982806512443541778'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/982806512443541778'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-7037317164126226462</id><published>2015-08-20T17:21:00.001+01:00</published><updated>2015-08-20T17:21:39.024+01:00</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://www.blogger.com/atom/ns#' term='Jasmine'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='custom matcher'/><title type='text'>toEqualAsObject</title><content type='html'>toEqualAsObject.js  import jsondiffpatch from 'jsondiffpatch';  const jdp = jsondiffpatch.create({   arrays: {     detectMove: true   } });  const customMatchers = {   toEqualAsObject(util, customEqualityTesters) {     return {       compare(actual, expected) {         const result = {           pass: util.equals(actual, expected, customEqualityTesters)         };          if (!result.pass) {           const delta = jdp.diff(actual, expected);           result.message = `The objects were different.  Expected:  ${ JSON.stringify(expected, null, 2) }  Actual: ${ JSON.stringify(actual, null, 2) }  Difference: ${ JSON.stringify(delta, null, 2) }  Difference format info can be found here: https://github.com/benjamine/jsondiffpatch/blob/master/docs/deltas.md `;         }          return result;       }     };   } };  export default customMatchers;   runs-before.tests.js  import customMatchers from './CustomMatchers';  beforeEach(() =&gt; {   jasmine.addMatchers(customMatchers); }); </content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7037317164126226462'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7037317164126226462'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6389159061227531431</id><published>2015-08-13T06:22:00.001+01:00</published><updated>2021-03-03T14:08:14.209Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='sort'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='javascript'/><category scheme='http://www.blogger.com/atom/ns#' term='OrderBy'/><category scheme='http://www.blogger.com/atom/ns#' term='LINQ'/><title type='text'>(Top One, Nice One) Get Sorted</title><content type='html'>&lt;p&gt;I was recently reading &lt;a href="http://www.barbarianmeetscoding.com/blog/2015/07/09/mastering-the-arcane-art-of-javascript-mancy-for-c-sharp-developers-chapter-7-using-linq-in-javascript/"&gt;a post by Jaime Gonzlez Garca&lt;/a&gt; which featured the following mind-bending proposition:&lt;/p&gt; &lt;blockquote cite="http://www.barbarianmeetscoding.com/blog/2015/07/09/mastering-the-arcane-art-of-javascript-mancy-for-c-sharp-developers-chapter-7-using-linq-in-javascript/"&gt;&lt;p&gt;What if I told you that JavaScript has &lt;a href="https://msdn.microsoft.com/en-us/library/bb397926.aspx"&gt;LINQ&lt;/a&gt;??&lt;/p&gt;&lt;/blockquote&gt; &lt;p&gt;It got me thinking about one of favourite features of LINQ: &lt;a href="http://www.dotnetperls.com/orderby-extension"&gt;ordering using OrderBy, ThenBy...&lt;/a&gt;  The ability to simply expose a collection of objects in a given order with a relatively terse and descriptive syntax. It is fantastically convenient, expressive and something I've been missing in JavaScript.  But if Jaime is right... Well, let's see what we can do.&lt;/p&gt; &lt;h4&gt;Sort&lt;/h4&gt; &lt;p&gt;JavaScript arrays have a &lt;a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/sort"&gt;sort&lt;/a&gt; method. To quote MDN:&lt;/p&gt; &lt;blockquote cite="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/sort"&gt; &lt;code&gt;arr.sort([compareFunction])&lt;/code&gt; &lt;h5&gt;&lt;code&gt;compareFunction&lt;/code&gt;&lt;/h5&gt;&lt;p&gt;Optional. Specifies a function that defines the sort order. If omitted, the array is sorted according to each character's Unicode code point value, according to the string conversion of each element.&lt;/p&gt;&lt;/blockquote&gt; &lt;p&gt;We want to use the &lt;code&gt;sort&lt;/code&gt; function to introduce some LINQ-ish ordering goodness. Sort of.  See what I did there?&lt;/p&gt; &lt;p&gt;Before we get going it's worth saying that LINQ's &lt;code&gt;OrderBy&lt;/code&gt; and JavaScript's &lt;code&gt;sort&lt;/code&gt; are not the same thing.  &lt;code&gt;sort&lt;/code&gt; actually changes the order of the array. However, &lt;code&gt;OrderBy&lt;/code&gt; returns an &lt;code&gt;IOrderedEnumerable&lt;/code&gt; which when iterated returns the items of the collection in a particular order. An important difference.  If preserving the original order of my array was important to me (spoiler: mostly it isn't) then I could make a call to &lt;code&gt;&lt;a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/slice"&gt;slice&lt;/a&gt;&lt;/code&gt; prior to calling &lt;code&gt;sort&lt;/code&gt;.&lt;/p&gt; &lt;p&gt;&lt;code&gt;sort&lt;/code&gt; also returns the array to the caller which is nice for chaining and means we can use it in a similar fashion to the way we use &lt;code&gt;OrderBy&lt;/code&gt;. With that in mind, we're going to create comparer functions which will take a lambda / arrow function (ES6 alert!) and return a function which will compare based on the supplied lambda.&lt;/p&gt; &lt;h4&gt;String Comparer&lt;/h4&gt; &lt;p&gt;Let's start with ordering by string properties:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;function stringComparer(propLambda) {&lt;br /&gt;  return (obj1, obj2) =&gt; {&lt;br /&gt;    const obj1Val = propLambda(obj1) || '';&lt;br /&gt;    const obj2Val = propLambda(obj2) || '';&lt;br /&gt;    return obj1Val.localeCompare(obj2Val);&lt;br /&gt;  };&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;We need some example data to sort: (I can only apologise for my lack of inspiration here)&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;const foodInTheHouse = [&lt;br /&gt;  { what: 'cake',   daysSincePurchase: 2 },&lt;br /&gt;  { what: 'apple',  daysSincePurchase: 8 },&lt;br /&gt;  { what: 'orange', daysSincePurchase: 6 },&lt;br /&gt;  { what: 'apple',  daysSincePurchase: 2 },&lt;br /&gt;];&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;If we were doing a sort by strings in LINQ we wouldn't need to implement our own comparer.  And the code we'd write would look something like this:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;var foodInTheHouseSorted = foodInTheHouse.OrderBy(x =&gt; x.what);&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;With that in mind, here's how it would look to use our shiny and new &lt;code&gt;stringComparer&lt;/code&gt;:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;const foodInTheHouseSorted = foodInTheHouse.sort(stringComparer(x =&gt; x.what));&lt;br /&gt;&lt;br /&gt;// foodInTheHouseSorted: [&lt;br /&gt;//   { what: 'apple',  daysSincePurchase: 8 },&lt;br /&gt;//   { what: 'apple',  daysSincePurchase: 2 },&lt;br /&gt;//   { what: 'cake',   daysSincePurchase: 2 },&lt;br /&gt;//   { what: 'orange', daysSincePurchase: 6 }&lt;br /&gt;// ]&lt;br /&gt;&lt;br /&gt;// PS Don't forget, for our JavaScript: foodInTheHouse === foodInTheHouseSorted&lt;br /&gt;//    But for the LINQ:                 foodInTheHouse !=  foodInTheHouseSorted&lt;br /&gt;//    &lt;br /&gt;//    However, if I'd done this:&lt;br /&gt;&lt;br /&gt;const foodInTheHouseSlicedAndSorted = foodInTheHouse.slice().sort(stringComparer(x =&gt; x.what));&lt;br /&gt;&lt;br /&gt;//    then:                             foodInTheHouse !== foodInTheHouseSlicedAndSorted &lt;br /&gt;//&lt;br /&gt;//    I shan't mention this again.&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;h4&gt;Number Comparer&lt;/h4&gt; &lt;p&gt;Well that's strings sorted (quite literally). Now, what about numbers?&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;function numberComparer(propLambda) {&lt;br /&gt;  return (obj1, obj2) =&gt; {&lt;br /&gt;    const obj1Val = propLambda(obj1);&lt;br /&gt;    const obj2Val = propLambda(obj2);&lt;br /&gt;    if (obj1Val &gt; obj2Val) {&lt;br /&gt;      return 1;&lt;br /&gt;    }&lt;br /&gt;    else if (obj1Val &lt; obj2Val) {&lt;br /&gt;      return -1;&lt;br /&gt;    }&lt;br /&gt;    return 0;&lt;br /&gt;  };&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;If we use the &lt;code&gt;numberComparer&lt;/code&gt; on our original array it looks like this:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;const foodInTheHouseSorted = foodInTheHouse.sort(numberComparer(x =&gt; x.daysSincePurchase));&lt;br /&gt;&lt;br /&gt;// foodInTheHouseSorted: [&lt;br /&gt;//   { what: 'cake',   daysSincePurchase: 2 },&lt;br /&gt;//   { what: 'apple',  daysSincePurchase: 2 },&lt;br /&gt;//   { what: 'orange', daysSincePurchase: 6 },&lt;br /&gt;//   { what: 'apple',  daysSincePurchase: 8 }&lt;br /&gt;// ]&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;h4&gt;Descending Into the Pit of Success&lt;/h4&gt; &lt;p&gt;Well this is all kinds of fabulous.  But something's probably nagging at you...  What about &lt;code&gt;OrderByDescending&lt;/code&gt;?  What about when I want to sort in the reverse order?  May I present the &lt;code&gt;reverse&lt;/code&gt; function:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;function reverse(comparer) {&lt;br /&gt;  return (obj1, obj2) =&gt; comparer(obj1, obj2) * -1;&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;As the name suggests, this function takes a given comparer that's handed to it and returns a function that inverts the results of executing that comparer.  Clear as mud?  A comparer can return 3 types of return values:&lt;/p&gt; &lt;ul&gt;&lt;li&gt;0 - implies equality for &lt;code&gt;obj1&lt;/code&gt; and &lt;code&gt;obj2&lt;/code&gt;&lt;/li&gt;&lt;li&gt;positive - implies &lt;code&gt;obj1&lt;/code&gt; is greater than &lt;code&gt;obj2&lt;/code&gt; by the ordering criterion&lt;/li&gt;&lt;li&gt;negative - implies &lt;code&gt;obj1&lt;/code&gt; is less than &lt;code&gt;obj2&lt;/code&gt; by the ordering criterion&lt;/li&gt;&lt;/ul&gt; &lt;p&gt;Our &lt;code&gt;reverse&lt;/code&gt; function takes the comparer it is given and returns a new comparer that will return a positive value where the old one would have returned a negative and vica versa.  (Equality is unaffected.)  An alternative implementation would have been this:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;function reverse(comparer) {&lt;br /&gt;  return (obj1, obj2) =&gt; comparer(obj2, obj1);&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Which is more optimal and even simpler as it just swaps the values supplied to the comparer.  Whatever tickles your fancy.  Either way, when used it looks like this:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;const foodInTheHouseSorted = foodInTheHouse.sort(reverse(stringComparer(x =&gt; x.what)));&lt;br /&gt;&lt;br /&gt;// foodInTheHouseSorted: [&lt;br /&gt;//   { what: 'orange', daysSincePurchase: 6 },&lt;br /&gt;//   { what: 'cake',   daysSincePurchase: 2 },&lt;br /&gt;//   { what: 'apple',  daysSincePurchase: 8 },&lt;br /&gt;//   { what: 'apple',  daysSincePurchase: 2 }&lt;br /&gt;// ]&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;If you'd rather not have a function wrapping a function inline then you could create &lt;code&gt;stringComparerDescending&lt;/code&gt;, a &lt;code&gt;numberComparerDescending&lt;/code&gt; etc implementations.  Arguably it might make for a nicer API. I'm not unhappy with the present approach myself and so I'll leave it as is.  But it's an option.&lt;/p&gt; &lt;h4&gt;&lt;code&gt;ThenBy&lt;/code&gt;&lt;/h4&gt; &lt;p&gt;So far we can sort arrays by strings, we can sort arrays by numbers and we can do either in descending order.  It's time to take it to the next level people. That's right &lt;code&gt;ThenBy&lt;/code&gt;; I want to be able to sort by one criteria and then by a subcriteria.  So perhaps I want to eat the food in the house in alphabetical order, but if I have multiple apples I want to eat the ones I bought most recently first (because the other ones look old, brown and yukky).  This may also be a sign I haven't thought my life through, but it's a choice that people make.  People that I know.  People I may have married.&lt;/p&gt; &lt;p&gt;It's time to compose our comparers together.  May I present... drum roll.... the &lt;code&gt;composeComparers&lt;/code&gt; function:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;function composeComparers(...comparers) {&lt;br /&gt;  return (obj1, obj2) =&gt; {&lt;br /&gt;    const comparer = comparers.find(c =&gt; c(obj1, obj2) !== 0);&lt;br /&gt;    return (comparer) ? comparer(obj1, obj2) : 0;&lt;br /&gt;  };&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;This fine function takes any number of comparers that have been supplied to it.  It then returns a comparer function which, when called, iterates through each of the original comparers and executes them until it finds one that returns a value that is not 0 (ie represents that the 2 items are not equal).  It then sends that non-zero value back or if all was equal then sends back 0.&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;const foodInTheHouseSorted = foodInTheHouse.sort(composeComparers(&lt;br /&gt;    stringComparer(x =&gt; x.what),&lt;br /&gt;    numberComparer(x =&gt; x.daysSincePurchase),&lt;br /&gt;));&lt;br /&gt;&lt;br /&gt;// foodInTheHouseSorted: [&lt;br /&gt;//   { what: 'apple',  daysSincePurchase: 2 },&lt;br /&gt;//   { what: 'apple',  daysSincePurchase: 8 },&lt;br /&gt;//   { what: 'cake',   daysSincePurchase: 2 },&lt;br /&gt;//   { what: 'orange', daysSincePurchase: 6 }&lt;br /&gt;// ]&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;h4&gt;&lt;code&gt;composeComparers&lt;/code&gt;: The Sequel&lt;/h4&gt; &lt;p&gt;I'm not gonna lie - I was feeling quite pleased with this approach.  I shared it with my friend (and repeated colleague) &lt;a href="http://blog.peterfoldi.com/"&gt;Peter Foldi&lt;/a&gt;.  The next day I found this in my inbox:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;function composeComparers(...comparers) {&lt;br /&gt;  return (obj1, obj2) =&gt; comparers.reduce((prev, curr) =&gt; prev || curr(obj1, obj2), 0);&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Dammit he's improved it.  It's down to 1 line of code, it doesn't execute a non-zero returning comparer twice and it doesn't rely on &lt;code&gt;&lt;a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/find"&gt;find&lt;/a&gt;&lt;/code&gt; which only arrives with ES6.  So if you wanted to backport to ES5 then this is a better choice.&lt;/p&gt; &lt;p&gt;The only criticism I can make of it is that it iterates through each of the comparers even when it doesn't need to execute them.  But that's just carping really.&lt;/p&gt; &lt;h4&gt;&lt;code&gt;composeComparers&lt;/code&gt;: The Ultimate&lt;/h4&gt; &lt;p&gt;So naturally I thought I was done.  Showing Peter's improvements to the estimable Matthew Horsley I learned that this was not so.  Because he reached for the keyboard and entered this:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;function composeComparers(...comparers) {&lt;br /&gt;  // README: &lt;a href="https://wiki.haskell.org/Function_composition"&gt;https://wiki.haskell.org/Function_composition&lt;/a&gt;&lt;br /&gt;  return comparers.reduce((prev, curr) =&gt; (a, b) =&gt; prev(a, b) || curr(a, b));&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;That's right, he's created a function which takes a number of comparers and reduced them up front into a single comparer function.  This means that when the sort takes place there is no longer a need to iterate through the comparers, just execute them.&lt;/p&gt; &lt;p&gt;I know.&lt;/p&gt; &lt;a href="http://i.qkme.me/3qknmj.jpg" imageanchor="1" &gt;&lt;img border="0" src="http://i.qkme.me/3qknmj.jpg" /&gt;&lt;/a&gt; &lt;p&gt;I'll get my coat...&lt;/p&gt; &lt;script src="https://gist.github.com/johnnyreilly/22f7c05b02c2129b89ef.js"&gt;&lt;/script&gt; &lt;h4&gt;Update 08/10/2018: Now TypeScript&lt;/h4&gt; &lt;p&gt;You want to do this with TypeScript? Use this:&lt;/p&gt; &lt;pre class="prettyprint ts"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;type Comparer&amp;lt;TObject&amp;gt; = (obj1: TObject, obj2: TObject) =&amp;gt; number;&lt;br /&gt;&lt;br /&gt;export function stringComparer&amp;lt;TObject&amp;gt;(propLambda: (obj: TObject) =&amp;gt; string): Comparer&amp;lt;TObject&amp;gt; {&lt;br /&gt;    return (obj1: TObject, obj2: TObject) =&amp;gt; {&lt;br /&gt;        const obj1Val = propLambda(obj1) || '';&lt;br /&gt;        const obj2Val = propLambda(obj2) || '';&lt;br /&gt;        return obj1Val.localeCompare(obj2Val);&lt;br /&gt;    };&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;export function numberComparer&amp;lt;TObject&amp;gt;(propLambda: (obj: TObject) =&amp;gt; number): Comparer&amp;lt;TObject&amp;gt; {&lt;br /&gt;    return (obj1: TObject, obj2: TObject) =&amp;gt; {&lt;br /&gt;        const obj1Val = propLambda(obj1);&lt;br /&gt;        const obj2Val = propLambda(obj2);&lt;br /&gt;        if (obj1Val &amp;gt; obj2Val) {&lt;br /&gt;            return 1;&lt;br /&gt;        } else if (obj1Val &amp;lt; obj2Val) {&lt;br /&gt;            return -1;&lt;br /&gt;        }&lt;br /&gt;        return 0;&lt;br /&gt;    };&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;export function reverse&amp;lt;TObject&amp;gt;(comparer: Comparer&amp;lt;TObject&amp;gt;) {&lt;br /&gt;    return (obj1: TObject, obj2: TObject) =&amp;gt; comparer(obj2, obj1);&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;export function composeComparers&amp;lt;TObject&amp;gt;(...comparers: Comparer&amp;lt;TObject&amp;gt;[]) {&lt;br /&gt;    return comparers.reduce((prev, curr) =&amp;gt; (a, b) =&amp;gt; prev(a, b) || curr(a, b));&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/6389159061227531431'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/6389159061227531431'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2015/08/top-one-nice-one-get-sorted.html' title='(Top One, Nice One) Get Sorted'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8376887339733395069</id><published>2015-07-30T21:35:00.001+01:00</published><updated>2021-03-04T06:47:56.349Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Globalize'/><category scheme='http://www.blogger.com/atom/ns#' term='migration'/><title type='text'>Upgrading to Globalize 1.x for Dummies</title><content type='html'>&lt;p&gt;Globalize has hit 1.0.  Anyone who reads my blog will likely be aware that I'm a long time user of &lt;a href="http://blog.icanmakethiswork.io/2012/05/globalizejs-number-and-date.html"&gt;Globalize 0.1.x&lt;/a&gt;.  I've been a little daunted by the leap that the move from 0.1.x to 1.x represents.  It appears to be the very definition of "breaking changes". :-) But hey, this is Semantic Versioning being used correctly so how could I complain? Either way, I've decided to write up the migration here as I'm not expecting this to be easy. &lt;/p&gt; &lt;p&gt;To kick things off I've set up a very &lt;a href="https://github.com/johnnyreilly/globalize-migration/tree/v0.1.x"&gt;simple repo&lt;/a&gt; that consists of a single page that depends upon Globalize 0.1.x to render a number and a date in German.  It looks like this:&lt;/p&gt; &lt;pre class="prettyprint html"&gt;&lt;br /&gt;&lt;code class="language-html"&gt;&lt;br /&gt;&amp;lt;html&amp;gt;&lt;br /&gt;  &amp;lt;head&amp;gt;&lt;br /&gt;    &amp;lt;title&amp;gt;Globalize demo&amp;lt;/title&amp;gt;&lt;br /&gt;    &amp;lt;link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet"&amp;gt;&lt;br /&gt;  &amp;lt;/head&amp;gt;&lt;br /&gt;  &amp;lt;body&amp;gt;&lt;br /&gt;    &amp;lt;div class="container-fluid"&amp;gt;&lt;br /&gt;      &amp;lt;h4&amp;gt;Globalize demo for the &amp;lt;em id="locale"&amp;gt;&amp;lt;/em&amp;gt; culture / locale&amp;lt;/h4&amp;gt;&lt;br /&gt;      &amp;lt;p&amp;gt;This is a the number &amp;lt;strong id="number"&amp;gt;&amp;lt;/strong&amp;gt; formatted by Globalize: &lt;br /&gt;          &amp;lt;strong id="numberFormatted"&amp;gt;&amp;lt;/strong&amp;gt;&amp;lt;/p&amp;gt;&lt;br /&gt;      &amp;lt;p&amp;gt;This is a the number &amp;lt;strong id="date"&amp;gt;&amp;lt;/strong&amp;gt; formatted by Globalize: &lt;br /&gt;          &amp;lt;strong id="dateFormatted"&amp;gt;&amp;lt;/strong&amp;gt;&amp;lt;/p&amp;gt;&lt;br /&gt;    &amp;lt;/div&amp;gt;&lt;br /&gt;&lt;br /&gt;    &amp;lt;script src="bower_components/globalize/lib/globalize.js"&amp;gt;&amp;lt;/script&amp;gt;&lt;br /&gt;    &amp;lt;script src="bower_components/globalize/lib/cultures/globalize.culture.de-DE.js"&amp;gt;&amp;lt;/script&amp;gt;&lt;br /&gt;    &amp;lt;script&amp;gt;&lt;br /&gt;      var locale = 'de-DE';&lt;br /&gt;      var number = 12345.67;&lt;br /&gt;      var date = new Date(2012, 5, 15);&lt;br /&gt;&lt;br /&gt;      Globalize.culture( locale );&lt;br /&gt;      document.querySelector('#locale').innerText = locale;&lt;br /&gt;      document.querySelector('#number').innerText = number;&lt;br /&gt;      document.querySelector('#date').innerText = date;&lt;br /&gt;      document.querySelector('#numberFormatted').innerText = Globalize.format(number, 'n2');&lt;br /&gt;      document.querySelector('#dateFormatted').innerText = Globalize.format(date, 'd');&lt;br /&gt;    &amp;lt;/script&amp;gt;&lt;br /&gt;  &amp;lt;/body&amp;gt;&lt;br /&gt;&amp;lt;/html&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;When it's run it looks like this:&lt;/p&gt; &lt;a href="http://4.bp.blogspot.com/-FPsorsaP9ek/VbheyWDCUbI/AAAAAAAAA3k/I_Wf5WVJ42s/s1600/Screenshot%2B2015-07-29%2B06.03.04.png" imageanchor="1" &gt;&lt;img border="0" src="http://4.bp.blogspot.com/-FPsorsaP9ek/VbheyWDCUbI/AAAAAAAAA3k/I_Wf5WVJ42s/s640/Screenshot%2B2015-07-29%2B06.03.04.png" /&gt;&lt;/a&gt; &lt;p&gt;Let's see how we go about migrating this super simple example.&lt;/p&gt; &lt;h4&gt;Update our Bower dependencies&lt;/h4&gt; &lt;p&gt;First things first, we want to move Globalize from 0.1.x to 1.x using Bower. To do that we update our &lt;code&gt;bower.json&lt;/code&gt;:&lt;/p&gt;   &lt;pre class="prettyprint"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;  "dependencies": {&lt;br /&gt;    "globalize": "^1.0.0"&lt;br /&gt;  }&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Now we enter: &lt;code&gt;bower update&lt;/code&gt;.  And we're off!&lt;/p&gt; &lt;pre class="prettyprint" style="font-size: 0.7em"&gt;&lt;br /&gt;&lt;code class="language-sh"&gt;&lt;br /&gt;bower globalize#^1.0.0          cached git://github.com/jquery/globalize.git#1.0.0&lt;br /&gt;bower globalize#^1.0.0        validate 1.0.0 against git://github.com/jquery/globalize.git#^1.0.0&lt;br /&gt;bower cldr-data#&gt;=25            cached git://github.com/rxaviers/cldr-data-bower.git#27.0.3&lt;br /&gt;bower cldr-data#&gt;=25          validate 27.0.3 against git://github.com/rxaviers/cldr-data-bower.git#&gt;=25&lt;br /&gt;bower cldrjs#0.4.1              cached git://github.com/rxaviers/cldrjs.git#0.4.1&lt;br /&gt;bower cldrjs#0.4.1            validate 0.4.1 against git://github.com/rxaviers/cldrjs.git#0.4.1&lt;br /&gt;bower globalize#^1.0.0         install globalize#1.0.0&lt;br /&gt;bower cldr-data#&gt;=25           install cldr-data#27.0.3&lt;br /&gt;bower cldrjs#0.4.1             install cldrjs#0.4.1&lt;br /&gt;&lt;br /&gt;globalize#1.0.0 bower_components\globalize&lt;br /&gt; cldr-data#27.0.3&lt;br /&gt; cldrjs#0.4.1&lt;br /&gt;&lt;br /&gt;cldr-data#27.0.3 bower_components\cldr-data&lt;br /&gt;&lt;br /&gt;cldrjs#0.4.1 bower_components\cldrjs&lt;br /&gt; cldr-data#27.0.3&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;This all looks happy enough.  Except it's actually not.&lt;/p&gt; &lt;h4&gt;We need fuel&lt;/h4&gt; &lt;p&gt;Or as I like to call it cldr-data.  We just pulled down Globalize 1.x but we didn't pull down the data that Globalize 1.x relies upon.  This is one of the differences between Globalize 0.1.x and 1.x.  Globalize 1.x does not include the "culture" data. By which I mean all the &lt;code&gt;globalize.culture.de-DE.js&lt;/code&gt; type files.  Instead Globalize 1.x relies upon &lt;a href="http://cldr.unicode.org/"&gt;CLDR - Unicode Common Locale Data Repository&lt;/a&gt;.  It does this in the form of &lt;a href="https://github.com/unicode-cldr/cldr-json"&gt;cldr-json&lt;/a&gt;.&lt;/p&gt; &lt;p&gt;Now before you start to worry, you shouldn't actually need to go and get this by yourself, the lovely &lt;a href="https://github.com/rxaviers"&gt;Rafael Xavier de Souza&lt;/a&gt; has saved you a job by putting together &lt;a href="https://github.com/rxaviers/cldr-data-bower"&gt;Bower&lt;/a&gt; and &lt;a href="https://github.com/rxaviers/cldr-data-npm"&gt;npm&lt;/a&gt; modules to do the hard work for you.&lt;/p&gt; &lt;p&gt;I'm using Bower for my client side package management and so I'll use that.  Looking at the Bower dependencies downloaded when I upgraded my package I can see there is a &lt;code&gt;cldr-data&lt;/code&gt; package.  Yay!  However it appears to be missing the associated json files.  Boo!&lt;/p&gt; &lt;p&gt;To the documentation Batman.  It says you need a &lt;code&gt;.bowerrc&lt;/code&gt; file in your repo which contains this:&lt;/p&gt; &lt;pre class="prettyprint js" style="font-size: 0.7em"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;{&lt;br /&gt;  "scripts": {&lt;br /&gt;    "preinstall": "npm install cldr-data-downloader@0.2.x",&lt;br /&gt;    "postinstall": "node ./node_modules/cldr-data-downloader/bin/download.js -i bower_components/cldr-data/index.json -o bower_components/cldr-data/"&lt;br /&gt;  }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Unfortunately, because I've already upgraded to v1 adding this file alone doesn't do anything for me.  To get round that I delete my &lt;code&gt;bower_components&lt;/code&gt; folder and enter &lt;code&gt;bower install&lt;/code&gt;.  Boom!&lt;/p&gt; &lt;pre class="prettyprint" style="font-size: 0.6em"&gt;&lt;br /&gt;&lt;code class="language"&gt;&lt;br /&gt;bower globalize#^1.0.0          cached git://github.com/jquery/globalize.git#1.0.0&lt;br /&gt;bower globalize#^1.0.0        validate 1.0.0 against git://github.com/jquery/globalize.git#^1.0.0&lt;br /&gt;bower cldrjs#0.4.1                        cached git://github.com/rxaviers/cldrjs.git#0.4.1&lt;br /&gt;bower cldrjs#0.4.1                      validate 0.4.1 against git://github.com/rxaviers/cldrjs.git#0.4.1&lt;br /&gt;bower cldr-data#&gt;=25                      cached git://github.com/rxaviers/cldr-data-bower.git#27.0.3&lt;br /&gt;bower cldr-data#&gt;=25                    validate 27.0.3 against git://github.com/rxaviers/cldr-data-bower.git#&gt;=25&lt;br /&gt;bower                                 preinstall npm install cldr-data-downloader@0.2.x&lt;br /&gt;bower                                 preinstall cldr-data-downloader@0.2.3 node_modules\cldr-data-downloader&lt;br /&gt;bower                                 preinstall  progress@1.1.8&lt;br /&gt;bower                                 preinstall  q@1.0.1&lt;br /&gt;bower                                 preinstall  request-progress@0.3.1 (throttleit@0.0.2)&lt;br /&gt;bower                                 preinstall  nopt@3.0.3 (abbrev@1.0.7)&lt;br /&gt;bower                                 preinstall  mkdirp@0.5.0 (minimist@0.0.8)&lt;br /&gt;bower                                 preinstall  adm-zip@0.4.4&lt;br /&gt;bower                                 preinstall  npmconf@2.0.9 (uid-number@0.0.5, ini@1.3.4, inherits@2.0.1, once@1.3.2, osenv@0.1.3, config-chain@1.1.9, semver@4.3.6)&lt;br /&gt;bower                                 preinstall  request@2.53.0 (caseless@0.9.0, forever-agent@0.5.2, aws-sign2@0.5.0, stringstream@0.0.4, tunnel-agent@0.4.1, oauth-sign@0.6.0, isstream@0.1.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.3, combined-stream@0.0.7, mime-types@2.0.14, form-data@0.2.0, tough-cookie@2.0.0, bl@0.9.4, http-signature@0.10.1, hawk@2.3.1)&lt;br /&gt;bower globalize#^1.0.0                   install globalize#1.0.0&lt;br /&gt;bower cldrjs#0.4.1                       install cldrjs#0.4.1&lt;br /&gt;bower cldr-data#&gt;=25                     install cldr-data#27.0.3&lt;br /&gt;bower                                postinstall node ./node_modules/cldr-data-downloader/bin/download.js -i bower_components/cldr-data/index.json -o bower_components/cldr-data/&lt;br /&gt;bower                                postinstall GET `https://github.com/unicode-cldr/cldr-core/archive/27.0.3.zip`&lt;br /&gt;bower                                postinstall GET `https://github.com/unicode-cldr/cldr-dates-modern/archive/27.0.3.zip`&lt;br /&gt;bower                                postinstall GET `https://github.com/unicode-cldr/cldr-cal-buddhist-modern/archive/27.0.3.zip`&lt;br /&gt;bower                                postinstall GET `https://github.com/unicode-cldr/cldr-cal-chinese-modern/archive/27.0.3.zip`&lt;br /&gt;bower                                postinstall GET `https://github.com/unicode-cldr/cldr-cal-coptic-modern/archive/27.0.3.zip`&lt;br /&gt;bower                                postinstall GET `https://github.com/unicode-cldr/cldr-cal-dangi-modern/archive/27.0.3.zip`&lt;br /&gt;bower                                postinstall GET `https://github.com/unicode-cldr/cldr-cal-ethiopic-modern/archive/27.0.3.zip`&lt;br /&gt;bower                                postinstall GET `https://github.com/unicode-cldr/cldr-cal-hebrew-modern/archive/27.0.3.zip`&lt;br /&gt;bower                                postinstall GET `https://github.com/unicode-cldr/cldr-cal-indian-modern/archive/27.0.3.zip`&lt;br /&gt;bower                                postinstall GET `https://github.com/unicode-cldr/cldr-cal-islamic-modern/archive/27.0.3.zip`&lt;br /&gt;bower                                postinstall GET `https://github.com/unicode-cldr/cldr-cal-japanese-modern/archive/27.0.3.zip`&lt;br /&gt;bower                                postinstall GET `https://github.com/unicode-cldr/cldr-cal-persian-modern/archive/27.0.3.zip`&lt;br /&gt;bower                                postinstall GET `https://github.com/unicode-cldr/cldr-cal-roc-modern/archive/27.0.3.zip`&lt;br /&gt;bower                                postinstall GET `https://github.com/unicode-cldr/cldr-localenames-modern/archive/27.0.3.zip`&lt;br /&gt;bower                                postinstall GET `https://github.com/unicode-cldr/cldr-misc-modern/archive/27.0.3.zip`&lt;br /&gt;bower                                postinstall GET `https://github.com/unicode-cldr/cldr-numbers-modern/archive/27.0.3.zip`&lt;br /&gt;bower                                postinstall GET `https://github.com/unicode-cldr/cldr-segments-modern/archive/27.0.3.zip`&lt;br /&gt;bower                                postinstall GET `https://github.com/unicode-cldr/cldr-units-modern/archive/27.0.3.zip`&lt;br /&gt;bower                                postinstall Received 28728K total.&lt;br /&gt;bower                                postinstall Received 28753K total.&lt;br /&gt;bower                                postinstall Unpacking it into `./bower_components\cldr-data`&lt;br /&gt;&lt;br /&gt;globalize#1.0.0 bower_components\globalize&lt;br /&gt; cldr-data#27.0.3&lt;br /&gt; cldrjs#0.4.1&lt;br /&gt;&lt;br /&gt;cldrjs#0.4.1 bower_components\cldrjs&lt;br /&gt; cldr-data#27.0.3&lt;br /&gt;&lt;br /&gt;cldr-data#27.0.3 bower_components\cldr-data&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;That's right - I'm golden.  And if I didn't want to do that I could have gone straight to the command line and entered this: (look familiar?)&lt;/p&gt; &lt;pre class="prettyprint" style="font-size: 0.7em"&gt;&lt;br /&gt;&lt;code class="language"&gt;&lt;br /&gt;npm install cldr-data-downloader@0.2.x&lt;br /&gt;node ./node_modules/cldr-data-downloader/bin/download.js -i bower_components/cldr-data/index.json -o bower_components/cldr-data/&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;h4&gt;Some bitching and moaning.&lt;/h4&gt; &lt;p&gt;If, like me, you were a regular user of Globalize 0.1.x then you know that you needed very little to get going.  As you can see from our example you just serve up &lt;code&gt;Globalize.js&lt;/code&gt; and the culture files you are interested in (eg &lt;code&gt;globalize.culture.de-DE.js&lt;/code&gt;).  That's it - you have all you need; job's a good'un.   This is all very convenient and entirely lovely.&lt;/p&gt; &lt;p&gt;Globalize 1.x has a different approach and one that (I have to be honest) I'm not entirely on board with.  The thing that you need to know about the new Globalize is that &lt;em&gt;nothing comes for free&lt;/em&gt;.  It's been completely modularised and &lt;a href="https://github.com/jquery/globalize#pick-the-modules-you-need"&gt;you have to include extra libraries depending on the functionality you require.&lt;/a&gt;  On top of that you then have to work out the &lt;a href="https://github.com/jquery/globalize#2-cldr-content"&gt;portions of the cldr data that you require for those modules&lt;/a&gt; and supply them.  This means that getting up and running with Globalize 1.x is much harder.  Frankly I think it's a little painful.&lt;/p&gt; &lt;p&gt;I realise this is a little &lt;a href="https://en.wikipedia.org/wiki/Who_Moved_My_Cheese%3F"&gt;"Who moved my cheese"&lt;/a&gt;.  I'll get over it.  I do actually see the logic of this.  It is certainly good that the culture date is not frozen in aspic but will evolve as the world does.  But it's undeniable that in our brave new world Globalize is no longer a doddle to pick up.  Or at least right now.&lt;/p&gt; &lt;h4&gt;Take the modules and run&lt;/h4&gt; &lt;p&gt;So.  What do we actually need?  Well I've consulted the &lt;a href="https://github.com/jquery/globalize#pick-the-modules-you-need"&gt;documentation&lt;/a&gt; and I think I'm clear. Our simple demo cares about dates and numbers.  So I'm going to guess that means I need:&lt;/p&gt; &lt;ul&gt;&lt;li&gt;&lt;code&gt;&lt;a href="https://github.com/jquery/globalize#core-module"&gt;globalize.js&lt;/a&gt;&lt;/code&gt;&lt;/li&gt;&lt;li&gt;&lt;code&gt;&lt;a href="https://github.com/jquery/globalize#date-module"&gt;globalize/date.js&lt;/a&gt;&lt;/code&gt;&lt;/li&gt;&lt;li&gt;&lt;code&gt;&lt;a href="https://github.com/jquery/globalize#number-module"&gt;globalize/number.js&lt;/a&gt;&lt;/code&gt;&lt;/li&gt;&lt;/ul&gt; &lt;p&gt;On top of that I'm also going to need the various cldr dependencies too.  That's not all.  Given that I've decided which modules I will use I now need to acquire the associated cldr data.  According to the docs &lt;a href="https://github.com/jquery/globalize#2-cldr-content"&gt;here&lt;/a&gt; we're going to need:&lt;/p&gt; &lt;ul&gt;&lt;li&gt;&lt;code&gt;cldr/supplemental/likelySubtags.json&lt;/code&gt;&lt;/li&gt;&lt;li&gt;&lt;code&gt;cldr/main/&lt;i&gt;locale&lt;/i&gt;/ca-gregorian.json&lt;/code&gt;&lt;/li&gt;&lt;li&gt;&lt;code&gt;cldr/main/&lt;i&gt;locale&lt;/i&gt;/timeZoneNames.json&lt;/code&gt;&lt;/li&gt;&lt;li&gt;&lt;code&gt;cldr/supplemental/timeData.json&lt;/code&gt;&lt;/li&gt;&lt;li&gt;&lt;code&gt;cldr/supplemental/weekData.json&lt;/code&gt;&lt;/li&gt;&lt;li&gt;&lt;code&gt;cldr/main/locale/numbers.json&lt;/code&gt;&lt;/li&gt;&lt;li&gt;&lt;code&gt;cldr/supplemental/numberingSystems.json&lt;/code&gt;&lt;/li&gt;&lt;/ul&gt; &lt;p&gt;Figuring that all out felt like really hard work.  But I think that now we're ready to do the actual migration.&lt;/p&gt; &lt;h5&gt;Update 30/08/2015: Globalize  So What'cha Want&lt;/h5&gt; &lt;p&gt;To make working out what you need when using Globalize I've built &lt;a href="http://johnnyreilly.github.io/globalize-so-what-cha-want/"&gt;Globalize  So What'cha Want&lt;/a&gt;.  You're so very welcome.&lt;/p&gt; &lt;h4&gt;The Actual Migration&lt;/h4&gt; &lt;p&gt;To do this I'm going to lean heavily upon &lt;a href="https://github.com/jquery/globalize/blob/master/examples/plain-javascript/index.html"&gt;an example put together by Rafael&lt;/a&gt;.  The migrated code looks like this:&lt;/p&gt; &lt;pre class="prettyprint html"&gt;&lt;br /&gt;&lt;code class="language-html"&gt;&lt;br /&gt;&amp;lt;html&amp;gt;&lt;br /&gt;  &amp;lt;head&amp;gt;&lt;br /&gt;    &amp;lt;title&amp;gt;Globalize demo&amp;lt;/title&amp;gt;&lt;br /&gt;    &amp;lt;link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet"&amp;gt;&lt;br /&gt;  &amp;lt;/head&amp;gt;&lt;br /&gt;  &amp;lt;body&amp;gt;&lt;br /&gt;    &amp;lt;div class="container-fluid"&amp;gt;&lt;br /&gt;      &amp;lt;h4&amp;gt;Globalize demo for the &amp;lt;em id="locale"&amp;gt;&amp;lt;/em&amp;gt; culture / locale&amp;lt;/h4&amp;gt;&lt;br /&gt;      &amp;lt;p&amp;gt;This is a the number &amp;lt;strong id="number"&amp;gt;&amp;lt;/strong&amp;gt; formatted by Globalize: &lt;br /&gt;          &amp;lt;strong id="numberFormatted"&amp;gt;&amp;lt;/strong&amp;gt;&amp;lt;/p&amp;gt;&lt;br /&gt;      &amp;lt;p&amp;gt;This is a the number &amp;lt;strong id="date"&amp;gt;&amp;lt;/strong&amp;gt; formatted by Globalize: &lt;br /&gt;          &amp;lt;strong id="dateFormatted"&amp;gt;&amp;lt;/strong&amp;gt;&amp;lt;/p&amp;gt;&lt;br /&gt;    &amp;lt;/div&amp;gt;&lt;br /&gt;&lt;br /&gt;    &amp;lt;!-- First, we load Globalize's dependencies (`cldrjs` and its supplemental module). --&amp;gt;&lt;br /&gt;    &amp;lt;script src="bower_components/cldrjs/dist/cldr.js"&amp;gt;&amp;lt;/script&amp;gt;&lt;br /&gt;    &amp;lt;script src="bower_components/cldrjs/dist/cldr/event.js"&amp;gt;&amp;lt;/script&amp;gt;&lt;br /&gt;    &amp;lt;script src="bower_components/cldrjs/dist/cldr/supplemental.js"&amp;gt;&amp;lt;/script&amp;gt;&lt;br /&gt;&lt;br /&gt;    &amp;lt;!-- Next, we load Globalize and its modules. --&amp;gt;&lt;br /&gt;    &amp;lt;script src="bower_components/globalize/dist/globalize.js"&amp;gt;&amp;lt;/script&amp;gt;&lt;br /&gt;    &amp;lt;script src="bower_components/globalize/dist/globalize/number.js"&amp;gt;&amp;lt;/script&amp;gt;&lt;br /&gt;&lt;br /&gt;    &amp;lt;!-- Load after globalize/number.js --&amp;gt;&lt;br /&gt;    &amp;lt;script src="bower_components/globalize/dist/globalize/date.js"&amp;gt;&amp;lt;/script&amp;gt;&lt;br /&gt;&lt;br /&gt;    &amp;lt;script&amp;gt;&lt;br /&gt;&lt;br /&gt;        var locale = 'de';&lt;br /&gt;&lt;br /&gt;        Promise.all([&lt;br /&gt;          // Core&lt;br /&gt;          fetch('bower_components/cldr-data/supplemental/likelySubtags.json'),&lt;br /&gt;&lt;br /&gt;          // Date&lt;br /&gt;          fetch('bower_components/cldr-data/main/' + locale + '/ca-gregorian.json'),&lt;br /&gt;          fetch('bower_components/cldr-data/main/' + locale + '/timeZoneNames.json'),&lt;br /&gt;          fetch('bower_components/cldr-data/supplemental/timeData.json'),&lt;br /&gt;          fetch('bower_components/cldr-data/supplemental/weekData.json'),&lt;br /&gt;&lt;br /&gt;          // Number&lt;br /&gt;          fetch('bower_components/cldr-data/main/' + locale + '/numbers.json'),&lt;br /&gt;          fetch('bower_components/cldr-data/supplemental/numberingSystems.json'),&lt;br /&gt;        ])&lt;br /&gt;        .then(function(responses) {&lt;br /&gt;            return Promise.all(responses.map(function(response) {&lt;br /&gt;                return response.json();&lt;br /&gt;            }));&lt;br /&gt;        })&lt;br /&gt;        .then(Globalize.load)&lt;br /&gt;        .then(function() {&lt;br /&gt;            var number = 12345.67;&lt;br /&gt;            var date = new Date(2012, 5, 15);&lt;br /&gt;&lt;br /&gt;            var globalize = Globalize( locale );&lt;br /&gt;            document.querySelector('#locale').innerText = locale;&lt;br /&gt;            document.querySelector('#number').innerText = number;&lt;br /&gt;            document.querySelector('#date').innerText = date;&lt;br /&gt;            document.querySelector('#numberFormatted').innerText = globalize.formatNumber(number, {&lt;br /&gt;              minimumFractionDigits: 2, &lt;br /&gt;              useGrouping: true &lt;br /&gt;            });&lt;br /&gt;            document.querySelector('#dateFormatted').innerText = globalize.formatDate(date, { &lt;br /&gt;              date: 'medium' &lt;br /&gt;            });&lt;br /&gt;        })&lt;br /&gt;    &amp;lt;/script&amp;gt;&lt;br /&gt;  &amp;lt;/body&amp;gt;&lt;br /&gt;&amp;lt;/html&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;By the way, I'm using &lt;a href="http://jakearchibald.com/2015/thats-so-fetch/"&gt;fetch&lt;/a&gt; and &lt;a href="http://www.html5rocks.com/en/tutorials/es6/promises/"&gt;promises&lt;/a&gt; to load the cldr-data.  This isn't mandatory - I use it because Chrome lets me.  (I'm so bleeding edge.)  Some standard jQuery ajax calls would do just as well.  There's an example of that approach &lt;a href="https://github.com/jquery/globalize/blob/master/doc/cldr.md#how-do-i-load-cldr-data-into-globalize"&gt;here&lt;/a&gt;.  &lt;h4&gt;Observations&lt;/h4&gt; &lt;p&gt;We've gone from not a lot of code to...  well, more than a little.  A medium amount.  Almost all of that extra code relates to getting Globalize 1.x to spin up so it's ready to work.  We've also gone from 2 HTTP requests to 13 which is unlucky for you.  6 of them took place via ajax after the page had loaded.  It's worth noting that we're not even loading all of Globalize either.  On top of that there's the old order-of-loading shenanigans to deal with.  All of these can be mitigated by introducing a custom build step of your own to concatenate and minify the associated cldr / Globalize files.&lt;/p&gt; &lt;p&gt;Loading the data via ajax isn't mandatory by the way.  If you wanted to you could create your own style of &lt;code&gt;globalize.culture.de.js&lt;/code&gt; files which would allow you load the page without recourse to post-page load HTTP requests.  Something like this Gulp task I've knocked up would do the trick:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;&lt;br /&gt;gulp.task("make-globalize-culture-de-js", function() {&lt;br /&gt;  var locale = 'de';&lt;br /&gt;  var jsonWeNeed = [&lt;br /&gt;    require('./bower_components/cldr-data/supplemental/likelySubtags.json'),&lt;br /&gt;    require('./bower_components/cldr-data/main/' + locale + '/ca-gregorian.json'),&lt;br /&gt;    require('./bower_components/cldr-data/main/' + locale + '/timeZoneNames.json'),&lt;br /&gt;    require('./bower_components/cldr-data/supplemental/timeData.json'),&lt;br /&gt;    require('./bower_components/cldr-data/supplemental/weekData.json'),&lt;br /&gt;    require('./bower_components/cldr-data/main/' + locale + '/numbers.json'),&lt;br /&gt;    require('./bower_components/cldr-data/supplemental/numberingSystems.json')&lt;br /&gt;  ];&lt;br /&gt;&lt;br /&gt;  var jsonStringWithLoad = 'Globalize.load(' + &lt;br /&gt;    jsonWeNeed.map(function(json){ return JSON.stringify(json); }).join(', ') + &lt;br /&gt;    ');';&lt;br /&gt;&lt;br /&gt;  var fs = require('fs');&lt;br /&gt;  fs.writeFile('./globalize.culture.' + locale + '.js', jsonStringWithLoad, function(err) {&lt;br /&gt;      if(err) {&lt;br /&gt;          console.log(err);&lt;br /&gt;      } else {&lt;br /&gt;          console.log("The file was created!");&lt;br /&gt;      }&lt;br /&gt;  });&lt;br /&gt;})&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;The above is standard node/io type code by the way; just take the contents of the function and run in node and you should be fine. If you do use this approach then you're very much back to the simplicity of Globalize 0.1.x's approach.&lt;/p&gt; &lt;p&gt;And here is the page in all its post migration glory:&lt;/p&gt; &lt;a href="http://2.bp.blogspot.com/-cBx66MK1tYI/Vbp5Rvch6zI/AAAAAAAAA30/HBiaN6risRg/s1600/Screenshot%2B2015-07-30%2B20.21.19.png" imageanchor="1" &gt;&lt;img border="0" src="http://2.bp.blogspot.com/-cBx66MK1tYI/Vbp5Rvch6zI/AAAAAAAAA30/HBiaN6risRg/s640/Screenshot%2B2015-07-30%2B20.21.19.png" /&gt;&lt;/a&gt; &lt;p&gt;It looks exactly the same except 'de-DE' has become simply 'de' (since that's how the cldr rolls).&lt;/p&gt; &lt;p&gt;The migrated code is &lt;a href="https://github.com/johnnyreilly/globalize-migration"&gt;there for the taking&lt;/a&gt;. Make sure you remember to &lt;code&gt;bower install&lt;/code&gt; - and you'll need to host the demo on a simple server since it makes ajax calls.&lt;/p&gt; &lt;p&gt;Before I finish off I wanted to say "well done!" to all the people who have worked on Globalize. It's an important project and I do apologise for my being a little critical of it here.  I should say that I think it's just the getting started that's hard.  Once you get over that hurdle you'll be fine.  Hopefully this post will help people do just that. Pip, pip!&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8376887339733395069'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8376887339733395069'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2015/07/upgrading-to-globalize-1x-for-dummies.html' title='Upgrading to Globalize 1.x for Dummies'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='http://4.bp.blogspot.com/-FPsorsaP9ek/VbheyWDCUbI/AAAAAAAAA3k/I_Wf5WVJ42s/s72-c/Screenshot%2B2015-07-29%2B06.03.04.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6953821903473056478</id><published>2015-07-13T13:55:00.002+01:00</published><updated>2015-07-13T13:55:55.411+01:00</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='tsconfig.json'/><category scheme='http://www.blogger.com/atom/ns#' term='jsx'/><category scheme='http://www.blogger.com/atom/ns#' term='react'/><category scheme='http://www.blogger.com/atom/ns#' term='atom-typescript'/><category scheme='http://www.blogger.com/atom/ns#' term='atom'/><title type='text'>TypeScript without Visual Studio</title><content type='html'>&lt;p&gt;I've been using TypeScript for a while now.  And because I'm a man that loves my tooling I've generally used Visual Studio for that purpose. Until recently it's been the best experience for coding TS.  Don't argue... that, my friend is what I call a &lt;em&gt;FACT&lt;/em&gt;. However, to quote my man Biggie: "things done changed".  &lt;/p&gt; &lt;p&gt;In my current assignment I'm currently working on a React project.  Which is cool.  We're coding in ES6 with Atom and using Babel to transpile back to ES5.  That's cool too.  This is actually not dissimilar from writing in TypeScript in the sense of using ES6 with a transpile step.  Just without types.  And I'm a chap that tends towards static typing.  I'm missing it.  Renaming a variable that is used in multiple files ought not to be a painful experience.  And in vanilla JS &lt;u&gt;it is&lt;/u&gt;.  Yes, I know.  Out there there are angry young coders bearing pitchforks and burning crosses screaming "it's purer, it's better, you don't need types, they're just holding you back....."  Yada yada yada.  They are wrong. Wrong, wrong, wrong.&lt;/p&gt; &lt;p&gt;Or to be more polite: other opinions are available.&lt;/p&gt; &lt;p&gt;After a particularly gruelling variable rename I decided to make a change.  I decided to give my current clients the gift of TypeScript.  Or at least the option.&lt;/p&gt; &lt;h4&gt;The Plan&lt;/h4&gt; &lt;p&gt;First of all I have to say this: it's not cricket for me to stop work on the clients requirements and start working on migrating to TypeScript.  So I'm not going to do that.&lt;/p&gt; &lt;p&gt;Rather, I'm going to take a side project of my own &lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/6953821903473056478'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/6953821903473056478'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5817710373485001624</id><published>2015-07-02T14:39:00.000+01:00</published><updated>2015-07-02T14:39:18.808+01:00</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Things you should learn for interviews</title><content type='html'>http://withouttheloop.com/articles/2015-04-17-mars-rover/  What is a Lambda expression?  Variety of explanations: - an in-line method - a delegate - an anonymous method  "Delegates are equivalent to function pointers/method pointers/callbacks (take your pick), and lambdas are pretty much simplified anonymous functions. At least that's what I tell people." - http://stackoverflow.com/a/73259/761388  Contra-variance / Covariance  http://blogs.msdn.com/b/csharpfaq/archive/2010/02/16/covariance-and-contravariance-faq.aspx  Wcf to interact with Java (WCF and Generics)  liskov open closed principle  inheritance vs composition  Composition over inheritance (or Composite Reuse Principle) in object-oriented programming is a technique by which classes may achieve polymorphic behavior and code reuse by containing other classes that implement the desired functionality instead of through inheritance.  To favour composition over inheritance is a design principle that gives the design higher flexibility, giving business-domain classes and more stable business domain in the long term. In other words, HAS-A can be better than an IS-A relationship  http://en.wikipedia.org/wiki/Composition_over_inheritance    model binding http://odetocode.com/blogs/scott/archive/2009/04/27/6-tips-for-asp-net-mvc-model-binding.aspx  http://www.hanselman.com/blog/NewInterviewQuestionsForSeniorSoftwareEngineers.aspx  Learn SOLID:  http://en.wikipedia.org/wiki/SOLID_(object-oriented_design)  DECIMAL, FLOAT AND DOUBLE  What is the difference between Decimal, Float and Double in C#?  float and double are floating binary point types. In other words, they represent a number like this:  10001.10010110011 The binary number and the location of the binary point are both encoded within the value.  decimal is a floating decimal point type. In other words, they represent a number like this:  12345.65789  Again, the number and the location of the decimal point are both encoded within the value - that's what makes decimal still a floating point type instead of a fixed point type.  Decimals have much higher precision and take up greater amount of space.  They are usually used within financial applications that require a high degree of accuracy. Decimals are much slower (up to 20X times in some tests) than a double/float. http://stackoverflow.com/a/618596/761388  OOP fundamentals  http://en.wikipedia.org/wiki/Object-oriented_programming  Dynamic dispatch  when a method is invoked on an object, the object itself determines what code gets executed by looking up the method at run time in a table associated with the object. This feature distinguishes an object from an abstract data type (or module), which has a fixed (static) implementation of the operations for all instances. It is a programming methodology that gives modular component development while at the same time being very efficient.  Encapsulation - A language mechanism for restricting access to some of the object's components.  Subtype polymorphism - Virtual functions (polymorphism) allow you to access derived class functions through a bass class. The classic example often cited in OO tutorials is that of a base class Shape, and derived classes Square, Circle, etc. Because of the "Is a" nature of inheritance, a Circle is a Shape, so you could have a container full of pointers to Shape objects that may contain Squares, Circles, Shapes or anything else derived from Shape. If a method (function) called Draw is defined in Shape and its derived classes and you call Draw through a Shape object. If the function is virtual, the appropriate derived class Draw will be called. If it's not virtual the Shape class Draw will be called.  Polymorphism allows you to work with classes at a higher level so you can deal with a collection of Shapes, for example, without knowing or caring what kind of Shape it is.  http://forums.codeguru.com/showthread.php?t=458608  Object inheritance (or delegation)  Open recursion  a special variable (syntactically it may be a keyword), usually called this or self, that allows a method body to invoke another method body of the same object. This variable is late-bound; it allows a method defined in one class to invoke another method that is defined later, in some subclass thereof.  IQUERYABLE VS IENUMERABLE  the extension methods defined for IQueryable take Expression objects instead of Func objects (which is what IEnumerable uses), meaning the delegate it receives is an expression tree instead of a method to invoke.  OR   IEnumerable&lt;T&gt; represents a forward-only cursor of T. .NET 3.5 added extension methods that included the LINQ standard query operators like Where and First, with any operators that require predicates or anonymous functions taking Func&lt;T&gt;.  IQueryable&lt;T&gt; implements the same LINQ standard query operators, but accepts Expression&lt;Func&lt;T&gt;&gt; for predicates and anonymous functions. Expression&lt;T&gt; is a compiled expression tree, a broken-up version of the method ("half-compiled" if you will) that can be parsed by the queryable's provider and used accordingly.  For example:  IEnumerable&lt;Person&gt; people = GetEnumerablePeople(); Person person = people.Where(x =&gt; x.Age &gt; 18).FirstOrDefault();  IQueryable&lt;Person&gt; people = GetQueryablePeople(); Person person = people.Where(x =&gt; x.Age &gt; 18).FirstOrDefault(); In the first block, x =&gt; x.Age &gt; 18 is an anonymous method (Func&lt;Person, bool&gt;), which can be executed like any other method. Enumerable.Where will execute the method once for each person, yielding values for which the method returned true.  In the second block, x =&gt; x.Age &gt; 18 is an expression tree (Expression&lt;Func&lt;Person, bool&gt;&gt;), which can be thought of as "is the 'Age' property &gt; 18".  This allows things like LINQ-to-SQL to exist because they can parse the expression tree and convert it into equivalent SQL. And because the provider doesn't need to execute until the IQueryable is enumerated (it implements IEnumerable&lt;T&gt;, after all), it can combine multiple query operators (in the above example Where and FirstOrDefault) to make smarter choices on how to execute the entire query against the underlying data source (like using SELECT TOP 1 in SQL).   http://stackoverflow.com/a/2433386/761388 http://stackoverflow.com/q/2876616/761388  Both will give you deferred execution.  The difference is that IQueryable&lt;T&gt; is the interface that allows LINQ-to-SQL (LINQ.-to-anything really) to work. So if you further refine your query on an IQueryable&lt;T&gt;, that query will be executed in the database, if possible.  For the IEnumerable&lt;T&gt; case, it will be LINQ-to-object, meaning that all objects matching the original query will have to be loaded into memory from the database.  EXCEPTION HANDLING  http://blogs.msdn.com/b/jmstall/archive/2007/02/15/throw-vs-rethrow.aspx          catch (Exception e)         {                         if (...)                  throw; //rethrow - can only happen within catch block             else                 throw e; //resets parameters on it like the Exception.StackWalk property.         }  DEADLOCKS  Deadlocking occurs when two or more SQL Server processes have locks on separate database objects and each process is trying to acquire a lock on an object that the other processes have previously locked.  http://www.notgoingdark.com/2011/05/sql-server-deadlocks-and-batfink.html  Optimistic / Pessimistic Locking  Optimistic Locking is a strategy where you read a record, take note of a version number and check that the version hasn't changed before you write the record back. When you write the record back you filter the update on the version to make sure it's atomic. (i.e. hasn't been updated between when you check the version and write the record to the disk) and update the version in one hit.  If the record is dirty (i.e. different version to yours) you abort the transaction and the user can re-start it.  This strategy is most applicable to high-volume systems and three-tier architectures where you do not necessarily maintain a connection to the database for your session. In this situation the client cannot actually maintain database locks as the connections are taken from a pool and you may not be using the same connection from one access to the next.  Pessimistic Locking is when you lock the record for your exclusive use until you have finished with it. It has much better integrity than optimistic locking but requires you to be careful with your application design to avoid Deadlocks. To use pessimistic locking you need either a direct connection to the database (as would typically be the case in a two tier client server application) or an externally available transaction ID that can be used independently of the connection.  In the latter case you open the transaction with the TxID and then reconnect using that ID. The DBMS maintains the locks and allows you to pick the session back up through the TxID. This is how distributed transactiona using two-phase commit protocols (such as XA or COM+ Transactions) work.  http://stackoverflow.com/a/129397/761388  BOXING AND UNBOXING  http://en.wikipedia.org/wiki/Common_Type_System#Boxing  Boxing: Converting value types to reference types (because objects are boxes!) Un-Boxing: Converting reference types to value types  http://stackoverflow.com/a/2111905/761388  DIFFERENCE BETWEEN INTERFACE AND ABSTRACT http://stackoverflow.com/questions/1913098/what-is-the-difference-between-an-interface-and-abstract-class  Abstract classes look a lot like interfaces, but they have something more : you can define a behavior for them. It's more about a guy saying "these classes should look like that, and they got that in common, so fill in the blanks !".  GENERICS  When would it be good to use Generics?  http://geekswithblogs.net/BlackRabbitCoder/archive/2011/01/13/c.net-little-wonders-constraining-generics-with-where-clause.aspx  http://www.c-sharpcorner.com/uploadfile/Ashush/generics-in-C-Sharp-part-i/  .NET BASICS  http://en.wikipedia.org/wiki/.NET_Framework  Programs written for the .NET Framework execute in a software environment known as the Common Language Runtime (CLR), an application virtual machine that provides important services such as security, memory management, and exception handling. The class library and the CLR together constitute the .NET Framework.  http://en.wikipedia.org/wiki/Common_Language_Runtime  The Common Language Runtime (CLR) is the virtual machine component of Microsoft's .NET framework and is responsible for managing the execution of .NET programs. In a process known as just-in-time (JIT) compilation, the CLR compiles the intermediate language code known as Common Intermediate Language (CIL) into the machine instructions that in turn are executed by the computer's CPU. The CLR provides additional services including memory management, type safety and exception handling. All programs written for the .NET framework, regardless of programming language, are executed by the CLR. It provides exception handling, Garbage collection and thread management.  http://en.wikipedia.org/wiki/Common_Intermediate_Language  MODEL BINDING  http://www.diaryofaninja.com/blog/2012/03/11/what-aspnet-mvc-developers-can-learn-from-githubrsquos-security-woes  TESTING  http://en.wikipedia.org/wiki/Dependency_injection http://msdn.microsoft.com/en-us/library/aa973811.aspx  OTHER  Strings immutable / string vs StringBuilder etc  Basically, an object is immutable if its state doesnt change once the object has been created.  http://blogs.msdn.com/b/ericlippert/archive/2007/11/13/immutability-in-c-part-one-kinds-of-immutability.aspx http://codebetter.com/patricksmacchia/2008/01/13/immutable-types-understand-them-and-use-them/  http://stackoverflow.com/a/73929/761388  http://stackoverflow.com/a/3428743/761388</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5817710373485001624'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5817710373485001624'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6648980070031899199</id><published>2015-06-29T17:18:00.001+01:00</published><updated>2021-03-14T05:27:22.826Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='rimraf'/><category scheme='http://www.blogger.com/atom/ns#' term='npm'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='long paths'/><category scheme='http://www.blogger.com/atom/ns#' term='Windows'/><title type='text'>npm please stop hurting Visual Studio</title><content type='html'>&lt;p&gt;I don't know about you but I personally feel that the following sentence may well be the saddest in the English language:&lt;/p&gt; &lt;p&gt;&lt;code&gt;2&gt;ASPNETCOMPILER : error ASPRUNTIME: The specified path, file name, or both are too long. The fully qualified file name must be less than 260 characters, and the directory name must be less than 248 characters.&lt;/code&gt;&lt;/p&gt; &lt;p&gt;The message above would suggest there is some kind of ASP.Net issue going on.  There isn't - the problem actually lies with Windows.  It's &lt;a href="http://blog.icanmakethiswork.io/2014/12/gulp-npm-long-paths-and-visual-studio-fight.html"&gt;not the first time it's come up&lt;/a&gt; but for those of you not aware there is something you need to know about Windows:  &lt;em&gt;It handles long paths badly.&lt;/em&gt;&lt;/p&gt; &lt;p&gt;There's a number of caveats which people may attach the above sentence.  But essentially what I have said is true.  And it becomes brutally apparent to you the moment you start using a few node / npm powered tools in your workflow.  You will likely see that horrible message and you won't be able to get much further forward. Sigh.  I thought this was the future...&lt;/p&gt; &lt;p&gt;This post is about how to deal with the long path issue when using npm with Visual Studio.  This should very much be a short term workaround as &lt;a href="https://github.com/npm/npm/releases/tag/v3.0.0"&gt;npm 3.0&lt;/a&gt; is planned to make long paths with npm a thing of the past.  But until that golden dawn....&lt;/p&gt; &lt;h4&gt;The Latest Infraction&lt;/h4&gt; &lt;p&gt;I'm a big fan of Gulp and Bower.  They rock.  &lt;a href="https://twitter.com/codecadwallader"&gt;Steve Cadwallader&lt;/a&gt; wrote an excellent blog post about &lt;a href="http://www.codecadwallader.com/2015/03/15/integrating-gulp-into-your-tfs-builds-and-web-deploy/"&gt;integrating Gulp into your Visual Studio build&lt;/a&gt;.  Essentially the Gist of his post is this: forget using &lt;a href="https://visualstudiogallery.msdn.microsoft.com/8e1b4368-4afb-467a-bc13-9650572db708"&gt;Task Runner Explorer&lt;/a&gt; to trigger your Gulp / Grunt jobs. No, actually plug it into the build process by tweaking your &lt;code&gt;.csproj&lt;/code&gt; file.  The first time I used this approach it was a dream come true.  It just worked and I was a very happy man.&lt;/p&gt; &lt;p&gt;Since this approach was so marvellous I took a look at the demo / docs part of &lt;a href="https://github.com/johnnyreilly/jQuery.Validation.Unobtrusive.Native"&gt;jQuery Validation Unobtrusive Native&lt;/a&gt; with a view to applying it there.  I originally wrote this back in 2013 and at the time used NuGet for both server and client side package management.  I decided to migrate it to use Bower for the client side packages (which I planned to combine with a Gulp script which was going to pull out the required JS / CSS etc as needed).  However it wasn't the plain sailing I'd imagined.  The actual switchover from NuGet to Bower was simple.  Just a case of removing NuGet packages and adding their associated Bower counterpart.  The problem came when the migration was done and I hit "compile". That's when I got to see &lt;code&gt;2&gt;ASPNETCOMPILER : error ASPRUNTIME: The specified path, file name, or both are too long...&lt;/code&gt; etc&lt;/p&gt; &lt;p&gt;For reasons that I don't fully understand, Visual Studio is really upset by the presence in the project structure of one almighty long path.  Oddly enough, not a path that's actually part of the Visual Studio project in question at all.  Rather one that has come along as a result of our Gulp / Bower / npm shenanigans. Quick as a flash, I whipped out Daniel Schroeder's &lt;a href="https://pathlengthchecker.codeplex.com/"&gt;Path Length Checker&lt;/a&gt; to see where the problem lay:&lt;/p&gt; &lt;a href="http://2.bp.blogspot.com/-uTcT2hLpRyA/VZFIiLX5n8I/AAAAAAAAA3M/lHA0TV2UVOM/s1600/bower-with-the-long-paths.png" imageanchor="1" &gt;&lt;img border="0" src="http://2.bp.blogspot.com/-uTcT2hLpRyA/VZFIiLX5n8I/AAAAAAAAA3M/lHA0TV2UVOM/s640/bower-with-the-long-paths.png" /&gt;&lt;/a&gt; &lt;p&gt;And lo, the fault lay with Bower. Poor show, Bower, poor show.&lt;/p&gt; &lt;h4&gt;rimraf to the Rescue&lt;/h4&gt; &lt;p&gt;&lt;a href="https://github.com/isaacs/rimraf"&gt;rimraf&lt;/a&gt; is "the &lt;a href="https://en.wikipedia.org/wiki/Rm_(Unix)"&gt;UNIX command&lt;/a&gt; &lt;code&gt;rm -rf&lt;/code&gt; for node".  (By the way, what is it with node and the pathological hatred of capital letters?)&lt;/p&gt; &lt;p&gt;What this means is: rimraf can delete.  Properly.  So let's get it: &lt;code&gt;npm install -g rimraf&lt;/code&gt;. Then at any time at the command line we can dispose of a long path in 2 shakes of lamb's tail.&lt;/p&gt; &lt;p&gt;In my current situation the contents of the &lt;code&gt;node_modules&lt;/code&gt; folder is causing me heartache.  But with rimraf in play I can get rid of it with the magic words: &lt;code&gt;rimraf ./node_modules&lt;/code&gt;.  Alakazam!  So let's poke this command into the extra commands that I've already shoplifted from Steve's blog post.  I'll end up with the following section of XML at the end of my &lt;code&gt;.csproj&lt;/code&gt;:&lt;/p&gt; &lt;pre class="prettyprint xml"&gt;&lt;br /&gt;&lt;code class="language-xml"&gt;&lt;br /&gt;  &amp;lt;PropertyGroup&amp;gt;&lt;br /&gt;    &amp;lt;CompileDependsOn&amp;gt;&lt;br /&gt;      $(CompileDependsOn);&lt;br /&gt;      GulpBuild;&lt;br /&gt;    &amp;lt;/CompileDependsOn&amp;gt;&lt;br /&gt;    &amp;lt;CleanDependsOn&amp;gt;&lt;br /&gt;      $(CleanDependsOn);&lt;br /&gt;      GulpClean&lt;br /&gt;    &amp;lt;/CleanDependsOn&amp;gt;&lt;br /&gt;    &amp;lt;CopyAllFilesToSingleFolderForPackageDependsOn&amp;gt;&lt;br /&gt;      CollectGulpOutput;&lt;br /&gt;      $(CopyAllFilesToSingleFolderForPackageDependsOn);&lt;br /&gt;    &amp;lt;/CopyAllFilesToSingleFolderForPackageDependsOn&amp;gt;&lt;br /&gt;    &amp;lt;CopyAllFilesToSingleFolderForMsdeployDependsOn&amp;gt;&lt;br /&gt;      CollectGulpOutput;&lt;br /&gt;      $(CopyAllFilesToSingleFolderForPackageDependsOn);&lt;br /&gt;    &amp;lt;/CopyAllFilesToSingleFolderForMsdeployDependsOn&amp;gt;&lt;br /&gt;  &amp;lt;/PropertyGroup&amp;gt;&lt;br /&gt;  &amp;lt;Target Name="GulpBuild"&amp;gt;&lt;br /&gt;    &amp;lt;Exec Command="npm install" /&amp;gt;&lt;br /&gt;    &amp;lt;Exec Command="bower install" /&amp;gt;&lt;br /&gt;    &amp;lt;Exec Command="gulp" /&amp;gt;&lt;br /&gt;    &amp;lt;Exec Command="rimraf ./node_modules" /&amp;gt;&lt;br /&gt;  &amp;lt;/Target&amp;gt;&lt;br /&gt;  &amp;lt;Target Name="GulpClean"&amp;gt;&lt;br /&gt;    &amp;lt;Exec Command="npm install" /&amp;gt;&lt;br /&gt;    &amp;lt;Exec Command="gulp clean" /&amp;gt;&lt;br /&gt;    &amp;lt;Exec Command="rimraf ./node_modules" /&amp;gt;&lt;br /&gt;  &amp;lt;/Target&amp;gt;&lt;br /&gt;  &amp;lt;Target Name="CollectGulpOutput"&amp;gt;&lt;br /&gt;    &amp;lt;ItemGroup&amp;gt;&lt;br /&gt;      &amp;lt;_CustomFiles Include="build\**\*" /&amp;gt;&lt;br /&gt;      &amp;lt;FilesForPackagingFromProject Include="%(_CustomFiles.Identity)"&amp;gt;&lt;br /&gt;        &amp;lt;DestinationRelativePath&amp;gt;build\%(RecursiveDir)%(Filename)%(Extension)&amp;lt;/DestinationRelativePath&amp;gt;&lt;br /&gt;      &amp;lt;/FilesForPackagingFromProject&amp;gt;&lt;br /&gt;    &amp;lt;/ItemGroup&amp;gt;&lt;br /&gt;    &amp;lt;Message Text="CollectGulpOutput list: %(_CustomFiles.Identity)" /&amp;gt;&lt;br /&gt;  &amp;lt;/Target&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt; &lt;p&gt;So let's focus on the important bits in the &lt;code&gt;GulpBuild&lt;/code&gt; target:&lt;/p&gt; &lt;ul&gt;&lt;li&gt;&lt;code&gt;&amp;lt;Exec Command="npm install" /&amp;gt;&lt;/code&gt; - install the node packages our project uses as specified in &lt;code&gt;package.json&lt;/code&gt;.  This will include Gulp and Bower.  The latter package is going to contain super-long, Windows wrecking paths.&lt;/li&gt;&lt;li&gt;&lt;code&gt;&amp;lt;Exec Command="bower install" /&amp;gt;&lt;/code&gt; - install the bower packages specified in &lt;code&gt;bower.json&lt;/code&gt; using Bower (which was installed by npm just now).&lt;/li&gt;&lt;li&gt;&lt;code&gt;&amp;lt;Exec Command="gulp" /&amp;gt;&lt;/code&gt; - do a little dance, make a little love, copy a few files, get down tonight.&lt;/li&gt;&lt;li&gt;&lt;code&gt;&amp;lt;Exec Command="rimraf ./node_modules" /&amp;gt;&lt;/code&gt; - remove the &lt;code&gt;node_modules&lt;/code&gt; folder populated by the &lt;code&gt;npm install&lt;/code&gt; command.&lt;/li&gt;&lt;/ul&gt; &lt;p&gt;With that addition of &lt;code&gt;rimraf ./node_modules&lt;/code&gt; to the build phase the problem goes away.  During each build a big, big Windows path is being constructed but then it's wiped again before it has chance to upset anyone.  I've also added the same to the &lt;code&gt;GulpClean&lt;/code&gt; target.&lt;/p&gt; &lt;p&gt;You are very welcome.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/6648980070031899199'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/6648980070031899199'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2015/06/npm-please-stop-hurting-visual-studio.html' title='npm please stop hurting Visual Studio'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='http://2.bp.blogspot.com/-uTcT2hLpRyA/VZFIiLX5n8I/AAAAAAAAA3M/lHA0TV2UVOM/s72-c/bower-with-the-long-paths.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-9089148032498223660</id><published>2015-06-19T13:57:00.000+01:00</published><updated>2015-06-19T13:57:56.841+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Emmett Brown'/><category scheme='http://www.blogger.com/atom/ns#' term='Entity Framework'/><category scheme='http://www.blogger.com/atom/ns#' term='Code First Migrations'/><title type='text'>Back to the Future with Code First Migrations</title><content type='html'>&lt;p&gt;Code First Migrations.  They look a little like this in Visual Studio:&lt;/p&gt; &lt;a href="http://1.bp.blogspot.com/-yTYSEsaVrT4/VYQBQrYVOoI/AAAAAAAAA2E/lNeZUc59gKc/s1600/Migrations.png" imageanchor="1" &gt;&lt;img border="0" src="http://1.bp.blogspot.com/-yTYSEsaVrT4/VYQBQrYVOoI/AAAAAAAAA2E/lNeZUc59gKc/s400/Migrations.png" /&gt;&lt;/a&gt;  &lt;p&gt;The thing I want you to notice about the image above is not the pithily named migrations.  It isn't the natty opacity on everything but the migration files (which I can assure you took me to the very limits of my &lt;a href="http://www.gimp.org/"&gt;GIMP&lt;/a&gt; expertise).  No, whilst exciting in themselves what I want you to think about is &lt;em&gt;the order in which migrations are applied&lt;/em&gt;.  Essentially how the &lt;code&gt;__MigrationHistory&lt;/code&gt; table in SQL Server ends up being populated in this manner:&lt;/p&gt; &lt;a href="http://1.bp.blogspot.com/-YWHwxvSeBUg/VYQEBPQCkAI/AAAAAAAAA2U/zZfPoosjyvo/s1600/MigrationHistory.png" imageanchor="1" &gt;&lt;img border="0" src="http://1.bp.blogspot.com/-YWHwxvSeBUg/VYQEBPQCkAI/AAAAAAAAA2U/zZfPoosjyvo/s640/MigrationHistory.png" /&gt;&lt;/a&gt; &lt;p&gt;Because, myself, I didn't really think about this until it came time for me to try and change the ordering of some migrations manually.  Do you know how migrations end up the order they do?  I bet you don't.  But either way, let's watch and see what happens to the pre-enlightenment me as I attempt to take a migration which appears &lt;em&gt;before&lt;/em&gt; a migration I have created locally and move it to &lt;em&gt;after&lt;/em&gt; that same migration.&lt;/p&gt; &lt;h4&gt;Great Scott! It's clearly filename driven&lt;/h4&gt; &lt;p&gt;That's right - it's blindingly obvious to me.  All I need do is take the migration I want to move forwards in time and rename it in Visual Studio.  So take our old migration ("2014 is so pass darling"):&lt;/p&gt; &lt;a href="http://4.bp.blogspot.com/-bN_-9vlXed0/VYQG76jMOMI/AAAAAAAAA2c/kddjFvDeMv0/s1600/Screenshot%2B2015-06-19%2B13.07.50.png" imageanchor="1" &gt;&lt;img border="0" src="http://4.bp.blogspot.com/-bN_-9vlXed0/VYQG76jMOMI/AAAAAAAAA2c/kddjFvDeMv0/s400/Screenshot%2B2015-06-19%2B13.07.50.png" /&gt;&lt;/a&gt; &lt;p&gt;And rename it to make it new and shiny ("2015! Gorgeous - I love it sweetie!"):&lt;/p&gt; &lt;a href="http://1.bp.blogspot.com/-9fmt1AGUiHI/VYQHY6Nvb7I/AAAAAAAAA2k/FpJYUAVr7E4/s1600/Screenshot%2B2015-06-19%2B13.08.46.png" imageanchor="1" &gt;&lt;img border="0" src="http://1.bp.blogspot.com/-9fmt1AGUiHI/VYQHY6Nvb7I/AAAAAAAAA2k/FpJYUAVr7E4/s400/Screenshot%2B2015-06-19%2B13.08.46.png" /&gt;&lt;/a&gt; &lt;p&gt;Perfection right? Wrong! What you've done makes not the slightest jot of difference.&lt;/p&gt; &lt;h4&gt;Whoa, this is heavy!  Gimme the project file&lt;/h4&gt; &lt;p&gt;How could I be so dim?  I mean it makes perfect sense - before the days of &lt;a href="http://blog.icanmakethiswork.io/2015/02/hey-tsconfigjson-where-have-you-been.html"&gt;TypeScript's tsconfig.json &lt;/a&gt; the default ordering of &lt;code&gt;*.ts&lt;/code&gt; files being passed to the TypeScript compiler was determined by the ordering of the &lt;code&gt;*.ts&lt;/code&gt; files in the &lt;code&gt;.csproj&lt;/code&gt; file.  It must be the same for Code First Migrations.&lt;/p&gt; &lt;p&gt;So, simply spin up &lt;a href="https://notepad-plus-plus.org/"&gt;Notepad++&lt;/a&gt; and let's play hack the XML until each file is referenced in the required order.&lt;/p&gt; &lt;p&gt;Well, I'm glad we sorted that out.  A quick test to reassure myself of my astuteness.  Drum roll.... Fail!! Things are just as they were. Shame on you John Reilly, shame on you.&lt;/p&gt; &lt;h4&gt;Designer.cs... Your kids are gonna love it&lt;/h4&gt; &lt;a href="http://3.bp.blogspot.com/-pPdPAw6Ov5A/VYQPKPBKwNI/AAAAAAAAA20/-lJvO9PPIek/s1600/Screenshot%2B2015-06-19%2B13.35.40.png" imageanchor="1" &gt;&lt;img border="0" src="http://3.bp.blogspot.com/-pPdPAw6Ov5A/VYQPKPBKwNI/AAAAAAAAA20/-lJvO9PPIek/s640/Screenshot%2B2015-06-19%2B13.35.40.png" /&gt;&lt;/a&gt; &lt;p&gt;I want you to look very carefully at this and tell me what you see.  We're looking at the mysterious &lt;code&gt;201508121401253_AddSagacityToSage.Designer.cs&lt;/code&gt; file that sits underneath the main &lt;code&gt;201508121401253_AddSagacityToSage.cs&lt;/code&gt; file.  What could it be.... Give in?&lt;/p&gt; &lt;p&gt;The &lt;code&gt;IMigrationMetadata.Id&lt;/code&gt; property is returning &lt;code&gt;&lt;u&gt;201408121401253&lt;/u&gt;_AddSagacityToSage&lt;/code&gt;.  That is the &lt;em&gt;old&lt;/em&gt; date! Remember? The pass one.  If you change that property to line up with the file name change you're done. It works.&lt;/p&gt; &lt;a href="https://upload.wikimedia.org/wikipedia/en/9/97/Doc_Brown.JPG" imageanchor="1" &gt;&lt;img border="0" src="https://upload.wikimedia.org/wikipedia/en/9/97/Doc_Brown.JPG" /&gt;&lt;/a&gt; &lt;p&gt;Let's say it together: "Automatic Migrations? Where we're going, we don't need Automatic Migrations."&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/9089148032498223660'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/9089148032498223660'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2015/06/Back-to-the-Future-with-Code-First-Migrations.html' title='Back to the Future with Code First Migrations'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='http://1.bp.blogspot.com/-yTYSEsaVrT4/VYQBQrYVOoI/AAAAAAAAA2E/lNeZUc59gKc/s72-c/Migrations.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3482359081925494747</id><published>2015-06-05T10:19:00.000+01:00</published><updated>2015-06-05T10:19:39.737+01:00</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>State of the Union</title><content type='html'>&lt;p&gt;Every now and then I like to sit back and have a think about what I'm doing as a developer.  What I'm using, what I'm liking, what I'm disliking, where I think things are going. I've been a professional dev for about 15 years now and so I've seen a fair amount of change.  I will see plenty more since I'm in this for the love of it and intend to be cutting code in some form for the rest of my days.  It's just too much fun not to.&lt;/p&gt; &lt;p&gt;The work I do tends to be what is often termed "full-stack".  That is to say, I'm involved from the "back-end" (invariably a database) through the middle tiers and to the "front-end" (whether that be a web app / a console app / a desktop app or a service).  It's not accidental that I do this work - essentially I don't like anything to hold me back if I'm working on something and so, in the absence of someone else being free, I can pitch in to any part of one of my applications and build it myself.  It's also very interesting to have a diverse range of problems to solve.&lt;/p&gt; &lt;h4&gt;Databases / Data Access&lt;/h4&gt; &lt;p&gt;It feels like the last 3 years has been the beginning of serious upheaval in the development world.  Particularly in the Microsoft space (which is where I've pitched my tent for most of my career).  Before that it had felt that things were quite slow moving and slow changing.  Most databases I worked on were some kind of relational SQL based database, typically SQL Server, Sybase or Oracle (all very popular in the finance world where I ply a lot of my trade).  Now a million and one databases are out there for the using and NoSQL is a very big thing.  I'm still mostly doing relational / SQL work but I'm firmly expecting that NoSQL is going to become part of the picture.  Whereas everyone used to dump all their data in a single database (of one type) it is more and more the case that there may be a mix of databases and a mix of database technologies.&lt;/p&gt; &lt;p&gt;I personally find this rather exciting since SQL is actually the area where I've seen the least innovation.  SQL databases (*cough* SQL Server) today is not radically different from the SQL Server when I was starting out.  My feeling is that this shake-up will encourage improvement in the SQL world.  Myself I'm starting to pay attention to things like &lt;a href="https://en.wikipedia.org/wiki/PostgreSQL"&gt;PostGres&lt;/a&gt; which show a lot of promise.  I mean to learn more.&lt;/p&gt; &lt;p&gt;Data access... Sigh.  &lt;a href="http://rob.conery.io/"&gt;Rob Conery&lt;/a&gt;, a developer that I hugely respect, recently &lt;a href="http://rob.conery.io/2015/02/21/its-time-to-get-over-that-stored-procedure-aversion-you-have/"&gt;said this&lt;/a&gt;:&lt;/p&gt; &lt;blockquote cite="http://rob.conery.io/2015/02/21/its-time-to-get-over-that-stored-procedure-aversion-you-have/"&gt;&lt;p&gt;I want to vault every ORM into the heart of the sun or, preferably, go back in time and smash all the computers responsible for their genesis.&lt;/p&gt;&lt;/blockquote&gt; &lt;p&gt;I understand where he is coming from.  I have a love/hate relationship with ORMs that I haven't eyt fully resolved to my own satisfaction.  Sometimes they seem to help.  Often they seem to hinder.  Very often they drop small bombs in your lap for no obvious good reason.  I'm still using Entity Framework and other ORMs, but always with hesitancy.  I'm always looking for the escape hatch.  I haven't found it yet.&lt;/p&gt; &lt;h4&gt;Languages and Tools&lt;/h4&gt;c# node go typ[escruipt ORMs  auth  databases  The last 10 year  editors debugging  &lt;h4&gt;The Web&lt;/h4&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3482359081925494747'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3482359081925494747'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4478420952570929473</id><published>2015-05-23T20:00:00.001+01:00</published><updated>2021-03-04T06:49:29.567Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Angular UI Bootstrap Datepicker'/><title type='text'>Angular UI Bootstrap Datepicker Weirdness</title><content type='html'>&lt;p&gt;The &lt;a href="https://angular-ui.github.io/bootstrap/#/datepicker"&gt;Angular UI Bootstrap Datepicker&lt;/a&gt; is fan-dabby-dozy.  But it has a ... pecularity.  You can use the picker like this:&lt;/p&gt; &lt;pre class="prettyprint html"&gt;&lt;br /&gt;&lt;code class="language-html"&gt;&lt;br /&gt;&amp;lt;div ng-app="peskyDatepicker"&amp;gt;&lt;br /&gt;    &amp;lt;div ng-controller="DatepickerDemoCtrl as vm"&amp;gt;&lt;br /&gt;        &amp;lt;input type="text" class="form-control"&lt;br /&gt;               datepicker-popup="mediumDate"&lt;br /&gt;               is-open="vm.valuationDatePickerIsOpen"&lt;br /&gt;               ng-click="vm.valuationDatePickerOpen()"&lt;br /&gt;               ng-model="vm.valuationDate" /&amp;gt;&lt;br /&gt;    &amp;lt;/div&amp;gt;&lt;br /&gt;&amp;lt;/div&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;angular&lt;br /&gt;.module('peskyDatepicker', ['ui.bootstrap'])&lt;br /&gt;.controller('DatepickerDemoCtrl', [&lt;br /&gt;function () {&lt;br /&gt;  &lt;br /&gt;  var vm = this;&lt;br /&gt;  &lt;br /&gt;  vm.valuationDate = new Date();&lt;br /&gt;  vm.valuationDatePickerIsOpen = false;&lt;br /&gt;  &lt;br /&gt;  vm.valuationDatePickerOpen = function () {&lt;br /&gt;&lt;br /&gt;      this.valuationDatePickerIsOpen = true;&lt;br /&gt;  };&lt;br /&gt;}]);&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;The above code produces a textbox which, when clicked upon, renders the datepicker popup (which vanishes upon date selection).  This works because the &lt;code&gt;ng-click&lt;/code&gt; directive calls the &lt;code&gt;valuationDatePickerOpen&lt;/code&gt; function on the controller which sets the &lt;code&gt;valuationDatePickerIsOpen&lt;/code&gt; property to be &lt;code&gt;true&lt;/code&gt; and that property happens to be bound to the &lt;code&gt;is-open&lt;/code&gt; attribute.  Your knee bone connected to your thigh bone,  Your thigh bone connected to your hip bone...  This makes sense. This works. Great.&lt;/p&gt; &lt;p&gt;But I want something a little prettier - I want to use the lovely calendar glyph to trigger the datepicker popup like in the docs.  That should be really easy right?  I just tweak the HTML to add a calendar button and the associated &lt;code&gt;ng-click="vm.valuationDatePickerOpen()"&lt;/code&gt;:&lt;/p&gt; &lt;pre class="prettyprint html"&gt;&lt;br /&gt;&lt;code class="language-html"&gt;&lt;br /&gt;&amp;lt;div ng-app="peskyDatepicker"&amp;gt;&lt;br /&gt;    &amp;lt;div ng-controller="DatepickerDemoCtrl as vm"&amp;gt;&lt;br /&gt;      &amp;lt;p class="input-group"&amp;gt;&lt;br /&gt;        &amp;lt;input type="text" class="form-control" &lt;br /&gt;               datepicker-popup="mediumDate" &lt;br /&gt;               is-open="vm.valuationDatePickerIsOpen" &lt;br /&gt;               ng-click="vm.valuationDatePickerOpen()" &lt;br /&gt;               ng-model="vm.valuationDate" /&amp;gt;&lt;br /&gt;        &amp;lt;span class="input-group-btn"&amp;gt;&lt;br /&gt;          &amp;lt;button type="button" class="btn btn-default" &lt;br /&gt;                  ng-click="vm.valuationDatePickerOpen()"&amp;gt;&lt;br /&gt;            &amp;lt;i class="glyphicon glyphicon-calendar"&amp;gt;&amp;lt;/i&amp;gt;&lt;br /&gt;          &amp;lt;/button&amp;gt;&lt;br /&gt;        &amp;lt;/span&amp;gt;&lt;br /&gt;      &amp;lt;/p&amp;gt;&lt;br /&gt;    &amp;lt;/div&amp;gt;&lt;br /&gt;&amp;lt;/div&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Miraculously, this &lt;em&gt;doesn't&lt;/em&gt; work. Which is strange - I mean it ought to... The same &lt;code&gt;ng-click&lt;/code&gt; directive is sat on our new calendar button as is in place on the datepicker itself. So what's happening?  Well let's do some investigation.  If you take a look at the docs you'll see that their example with the calendar glyph is subtly different to our own.  Namely, when the opener function is invoked, the official docs pass along &lt;code&gt;$event&lt;/code&gt;.  To what end?  Well, the docs opener function does something that our own does not.  This:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;  $scope.open = function($event) {&lt;br /&gt;    $event.preventDefault();&lt;br /&gt;    $event.stopPropagation();&lt;br /&gt;&lt;br /&gt;    $scope.opened = true;&lt;br /&gt;  };&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Ignore all the &lt;code&gt;$scope&lt;/code&gt; malarkey - I want you to pay attention to what is happening with &lt;code&gt;$event&lt;/code&gt;.  &lt;code&gt;preventDefault&lt;/code&gt; and &lt;code&gt;stopPropogation&lt;/code&gt; are being called.  This is probably relevant.&lt;/p&gt; &lt;p&gt;I decided to do a little experimentation.  I created a Plunk which demonstrates the datepicker and uses &lt;code&gt;$watch&lt;/code&gt; to track what happens to &lt;code&gt;valuationDatePickerIsOpen&lt;/code&gt;.  The Plunk featured 2 calendar glyphs - the left one doesn't pass along &lt;code&gt;$event&lt;/code&gt; to &lt;code&gt;valuationDatePickerOpen&lt;/code&gt; when it is clicked and the right one does. When &lt;code&gt;$event&lt;/code&gt; is passed we call &lt;code&gt;preventDefault&lt;/code&gt; and &lt;code&gt;stopPropogation&lt;/code&gt;.&lt;/p&gt; &lt;iframe src="http://embed.plnkr.co/dJyF531w0QRGiAScRf15/preview" width="100%" height="450"&gt;&lt;/iframe&gt; &lt;p&gt;After a little experimentation of my own I discovered that calling &lt;code&gt;$event.stopPropogation()&lt;/code&gt; is the magic bullet.  Without that in place &lt;code&gt;valuationDatePickerIsOpen&lt;/code&gt; gets set to &lt;code&gt;true&lt;/code&gt; and then immediately back to &lt;code&gt;false&lt;/code&gt; again.  I do not know why. There may be an entirely sane reason for this - if so then please do post a comment and let me know.  It wouldn't hurt for the Angular UI Bootstrap Datepicker docs to mention this.  &lt;a href="https://github.com/angular-ui/bootstrap/issues/3705"&gt;Perhaps it's time to submit a PR....&lt;/a&gt;&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4478420952570929473'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4478420952570929473'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2015/05/angular-ui-bootstrap-datepicker-weirdness.html' title='Angular UI Bootstrap Datepicker Weirdness'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5719835518329847363</id><published>2015-05-11T10:55:00.001+01:00</published><updated>2021-03-04T06:50:46.246Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='asp.net mvc'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='AngularJS'/><category scheme='http://www.blogger.com/atom/ns#' term='NgValidationFor'/><title type='text'>NgValidationFor Baby Steps</title><content type='html'>&lt;p&gt;I thought as I start the &lt;a href="http://blog.icanmakethiswork.io/2015/04/tonight-ill-start-open-source-project.html"&gt;NgValidationFor project&lt;/a&gt; I'd journal my progress.  I'm writing this with someone particular in mind: me.  Specifically, me in 2 years who will no doubt wonder why I made some of the choices I did.  Everyone else, move along now - nothing to see.  Unless the inner workings of someone else's mind are interesting to you... In which case: welcome!&lt;/p&gt; &lt;h4&gt;Getting up and running&lt;/h4&gt; &lt;p&gt;I've got a project on &lt;a href="https://github.com/johnnyreilly/NgValidationFor"&gt;GitHub&lt;/a&gt; and I'm starting to think about implementations. One thing that bit me on &lt;a href="http://johnnyreilly.github.io/jQuery.Validation.Unobtrusive.Native/"&gt;jVUN&lt;/a&gt; was being tied to a specific version of ASP.Net MVC.  For each major release of ASP.Net MVC I needed separate builds / NuGet packages and the like.  A pain.  Particularly when it came to bug fixes for prior versions - the breaking changes with each version of MVC meant far more work was required when it came to shipping fixes for MVC 4 / MVC 3.&lt;/p&gt; &lt;p&gt;So with that in mind I'm going to try and limit my dependencies.  I'm not saying I will never depend upon ASP.Net MVC - I may if I think it becomes useful to give the users a nicer API or if there's another compelling reason.  But to start with I'm just going to focus on the translation of data annotations to Angular validation directive attributes.&lt;/p&gt;    &lt;p&gt;To that end I'm going to begin with just a class library and an associated test project.  I'm going to try and minimise the dependencies that NgValidationFor has.  At least initially I may even see if I can sensibly avoid depending on &lt;code&gt;System.Web&lt;/code&gt; (mindful of the upcoming ASP.Net 5 changes). Let's see.&lt;/p&gt; &lt;p&gt;A little time passes.......&lt;/p&gt; &lt;h4&gt;So what have we got?&lt;/h4&gt; &lt;p&gt;My first efforts have resulted in the implementation of the &lt;code&gt;&lt;a href="https://msdn.microsoft.com/en-us/library/system.componentmodel.dataannotations.requiredattribute(v=vs.110).aspx"&gt;RequiredAttribute&lt;/a&gt;&lt;/code&gt;.  This is the &lt;a href="https://github.com/johnnyreilly/NgValidationFor/tree/6cf862a7638d3ed933cd0e075a1807b1414847da"&gt;code right now&lt;/a&gt;.  It's made up of:&lt;/p&gt; &lt;ol&gt;&lt;li&gt;NgValidationFor.Core - the core part of the project which converts data annotations into AngularJS 1.x validation directive attributes.&lt;/li&gt;&lt;li&gt;NgValidationFor.Core.UnitTests - the unit tests for the core&lt;/li&gt;&lt;li&gt;NgValidationFor.Documentation - this is an ASP.Net MVC project which will become a documentation site for NgValidationFor.  It also doubles as a way for me to try out NgValidationFor.&lt;/li&gt;&lt;li&gt;NgValidationFor.Documentation.UnitTests - unit tests for the documentation (there's none yet as I'm still spiking - but when I'm a little clearer, they will be)&lt;/li&gt;&lt;/ol&gt; &lt;p&gt;How can it be used? Well fairly easily.  Take this simple model:&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;using System.ComponentModel.DataAnnotations;&lt;br /&gt;&lt;br /&gt;namespace NgValidationFor.Documentation.Models&lt;br /&gt;{&lt;br /&gt;    public class RequiredDemoModel&lt;br /&gt;    {&lt;br /&gt;        [Required]&lt;br /&gt;        public string RequiredField { get; set; }&lt;br /&gt;    }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;When used in an MVC View for which &lt;code&gt;RequiredDemoModel&lt;/code&gt; is the Model, NgValiditionFor can be used thusly:&lt;/p&gt; &lt;pre class="prettyprint html"&gt;&lt;br /&gt;&lt;code class="language-html"&gt;&lt;br /&gt;@using NgValidationFor.Core&lt;br /&gt;@using NgValidationFor.Documentation.Models&lt;br /&gt;@model RequiredDemoModel&lt;br /&gt;&amp;lt;input type="text" &lt;br /&gt;       name="userName" &lt;br /&gt;       ng-model="user.name"&lt;br /&gt;       @Html.Raw(Model.GetAttributes(x =&amp;gt; Model.RequiredField))&lt;br /&gt;       &amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt; &lt;p&gt;Which results in this HTML:&lt;/p&gt; &lt;pre class="prettyprint html"&gt;&lt;br /&gt;&lt;code class="language-html"&gt;&lt;br /&gt;&amp;lt;input type="text"&lt;br /&gt;       name="userName" &lt;br /&gt;       ng-model="user.name"&lt;br /&gt;       required="required"&lt;br /&gt;       &amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt;  &lt;p&gt;Tada!!!!  It works.&lt;/p&gt; &lt;h4&gt;So what now?&lt;/h4&gt; &lt;p&gt;Yes it works, but I'm not going to pretend it's pretty. I don't like having to wrap the usage of NgValidationFor with &lt;code&gt;Html.Raw(...)&lt;/code&gt;.  I'm having to do that because &lt;code&gt;GetAttributes&lt;/code&gt; returns a &lt;code&gt;string&lt;/code&gt;. This string is then HTML encoded by MVC.  To avoid my quotation marks turning into &lt;code&gt;&amp;amp;quot;&lt;/code&gt; I need to actually be exposing an &lt;code&gt;&lt;a href="https://msdn.microsoft.com/en-us/library/system.web.ihtmlstring(v=vs.110).aspx"&gt;IHtmlString&lt;/a&gt;&lt;/code&gt;.  So I'm going to need to depend upon &lt;code&gt;System.Web&lt;/code&gt;.  That's not so bad - at least I'm not tied to a specific MVC version.&lt;/p&gt; &lt;p&gt;I'm not too keen on the implementation I've come up with for NgValidationFor either.  It's a single static method at the minute which does everything.  It breaks the &lt;a href="https://en.wikipedia.org/wiki/Single_responsibility_principle"&gt;Single Responsibility Priniciple&lt;/a&gt; and the &lt;a href="https://en.wikipedia.org/wiki/Open/closed_principle"&gt;Open/Closed Principle&lt;/a&gt;.  I need to take a look at that - I want people to be able to extend this and I need to think about a good and simple way to achieve that.&lt;/p&gt; &lt;p&gt;Finally, usage.  &lt;code&gt;Model.GetAttributes(x =&amp;gt; Model.RequiredField)&lt;/code&gt; feels wrong to me.  I think I'm happy with having this used as an extension method but it needs to be clearer what's happening. Perhaps &lt;code&gt;Model.NgValidationFor(x =&amp;gt; Model.RequiredField)&lt;/code&gt;  would be better.  I need to try a few things out and come up with a nicer way to use NgValidationFor.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5719835518329847363'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5719835518329847363'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2015/05/ngvalidationfor-baby-steps.html' title='NgValidationFor Baby Steps'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8607203368039364190</id><published>2015-05-05T06:21:00.001+01:00</published><updated>2021-03-04T06:52:27.828Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='asp.net mvc'/><category scheme='http://www.blogger.com/atom/ns#' term='asp.net'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='html5mode'/><category scheme='http://www.blogger.com/atom/ns#' term='AngularJS'/><category scheme='http://www.blogger.com/atom/ns#' term='ASP.Net Web API'/><title type='text'>A tale of Angular, html5mode, ASP.Net MVC and ASP.Net Web API</title><content type='html'>&lt;p&gt;So.  You want to kick hash based routing to the kerb.  You want &lt;em&gt;real&lt;/em&gt; URLs.  You've read the HTML5 mode section of the &lt;a href="https://docs.angularjs.org/guide/$location"&gt;Angular $location docs&lt;/a&gt; and you're good to go. It's just a matter of dropping &lt;code&gt;$locationProvider.html5Mode(true)&lt;/code&gt; into your app initialisation right?&lt;/p&gt; &lt;p&gt;Wrong.&lt;/p&gt; &lt;p&gt;You want your URLs to be shareable.  If, when you copy the URL out of your browser and send it someone else, they do not get taken to the same position in the application as you do then I've got news for you: THAT'S NOT REALLY A URL.  And just using &lt;code&gt;$locationProvider.html5Mode(true)&lt;/code&gt; has done nothing useful for you.  You want to ensure that, if the URL entered in the browser does not relate to a specific server-side end-point, the self-same HTML root page is &lt;em&gt;always&lt;/em&gt; served up.  Then Angular can load the correct resources for the URL you have entered and get you to the required state.&lt;/p&gt; &lt;p&gt;There are tips to be found in Angular UI's &lt;a href="https://github.com/angular-ui/ui-router/wiki/Frequently-Asked-Questions#how-to-configure-your-server-to-work-with-html5mode"&gt;How to: Configure your server to work with html5Mode&lt;/a&gt; doc.  However they required a little extra fiddling to get my ASP.Net back end working quite as I wanted.  To save you pain, here are my cultural learnings.&lt;/p&gt; &lt;h4&gt;ASP.Net MVC&lt;/h4&gt; &lt;p&gt;I had an ASP.Net MVC app which I wanted to use &lt;code&gt;html5mode&lt;/code&gt; with.  To do this is simply a matter of tweaking your &lt;code&gt;RouteConfig.cs&lt;/code&gt; like so:&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;    public class RouteConfig&lt;br /&gt;    {&lt;br /&gt;        public static void RegisterRoutes(RouteCollection routes)&lt;br /&gt;        {&lt;br /&gt;            routes.IgnoreRoute("{resource}.axd/{*pathInfo}");&lt;br /&gt;&lt;br /&gt;            // Here go the routes that you still want to be able to hit&lt;br /&gt;            routes.MapRoute(&lt;br /&gt;                name: "IAmARouteThatYouStillWantToHit",&lt;br /&gt;                url: "ThatsWhyIAmRegisteredFirst",&lt;br /&gt;                defaults: new { controller = "Hittable", action = "Index" }&lt;br /&gt;            );&lt;br /&gt;&lt;br /&gt;            // Everything else will hit Home/Index which serves up the root angular app page&lt;br /&gt;            routes.MapRoute(&lt;br /&gt;                name: "Default",&lt;br /&gt;                url: "{*anything}", // THIS IS THE MAGIC!!!!&lt;br /&gt;                defaults: new { controller = "Home", action = "Index" }&lt;br /&gt;            );&lt;br /&gt;        }&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;With this in place my existing routes work just as I would hope.  Any route that doesn't fit that registered can be assumed to be &lt;code&gt;html5mode&lt;/code&gt; related and will serve up the root angular app page as I'd hope.&lt;/p&gt; &lt;h4&gt;ASP.Net Web API&lt;/h4&gt; &lt;p&gt;Later I realised that the app in question was mostly static content.  Certainly the root angular app page was and so it seemed wasteful to require an ASP.Net MVC controller to serve up that static content.  So I stripped out MVC from the app entirely, choosing to serve raw HTML instead.  For the dynamic parts I switched to using Web API.  This was "hittable" as long as I had my &lt;code&gt;WebApiConfig.cs&lt;/code&gt; and my &lt;code&gt;system.webServer&lt;/code&gt; section in my &lt;code&gt;web.config&lt;/code&gt; lined up correctly, viz:&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;    public static class WebApiConfig&lt;br /&gt;    {&lt;br /&gt;        public static void Register(HttpConfiguration config)&lt;br /&gt;        {&lt;br /&gt;            // Web API routes&lt;br /&gt;            config.MapHttpAttributeRoutes();&lt;br /&gt;&lt;br /&gt;            config.Routes.MapHttpRoute(&lt;br /&gt;                name: "DefaultApi",&lt;br /&gt;                routeTemplate: "api/{controller}/{id}",&lt;br /&gt;                defaults: new { id = RouteParameter.Optional }&lt;br /&gt;            );&lt;br /&gt;&lt;br /&gt;            // other stuff&lt;br /&gt;        }&lt;br /&gt;    }&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;pre class="prettyprint xml"&gt;&lt;br /&gt;&lt;code class="language-xml"&gt;&lt;br /&gt;&amp;lt;configuration&amp;gt;&lt;br /&gt;&lt;br /&gt;    &amp;lt;system.webServer&amp;gt;&lt;br /&gt;&lt;br /&gt;        &amp;lt;defaultDocument&amp;gt;&lt;br /&gt;            &amp;lt;files&amp;gt;&lt;br /&gt;                &amp;lt;clear /&amp;gt;&lt;br /&gt;                &amp;lt;add value="build/index.html" /&amp;gt; &amp;lt;!-- This is the root document for the Angular app --&amp;gt;&lt;br /&gt;            &amp;lt;/files&amp;gt;&lt;br /&gt;        &amp;lt;/defaultDocument&amp;gt;&lt;br /&gt;        &lt;br /&gt;        &amp;lt;rewrite&amp;gt;&lt;br /&gt;            &amp;lt;rules&amp;gt;&lt;br /&gt;                &amp;lt;rule name="Main Rule" stopProcessing="true"&amp;gt;&lt;br /&gt;                    &amp;lt;match url=".*" /&amp;gt;&lt;br /&gt;                    &amp;lt;conditions logicalGrouping="MatchAll"&amp;gt;&lt;br /&gt;                        &amp;lt;!-- Allows "api/" prefixed URLs to still hit Web API controllers &lt;br /&gt;                             as defined in WebApiConfig --&amp;gt;&lt;br /&gt;                        &amp;lt;add input="{REQUEST_URI}" pattern="api/" ignoreCase="true" negate="true" /&amp;gt;&lt;br /&gt;                        &lt;br /&gt;                        &amp;lt;!-- Static files and directories can be served so partials etc can be loaded --&amp;gt;&lt;br /&gt;                        &amp;lt;add input="{REQUEST_FILENAME}" matchType="IsFile" negate="true" /&amp;gt;&lt;br /&gt;                        &amp;lt;add input="{REQUEST_FILENAME}" matchType="IsDirectory" negate="true" /&amp;gt;&lt;br /&gt;                    &amp;lt;/conditions&amp;gt;&lt;br /&gt;                    &amp;lt;action type="Rewrite" url="/" /&amp;gt;&lt;br /&gt;                &amp;lt;/rule&amp;gt;&lt;br /&gt;            &amp;lt;/rules&amp;gt;&lt;br /&gt;        &amp;lt;/rewrite&amp;gt;&lt;br /&gt;        &lt;br /&gt;    &amp;lt;/system.webServer&amp;gt;&lt;br /&gt;&lt;br /&gt;&amp;lt;/configuration&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt; &lt;p&gt;With this in place I can happily hit "api" prefixed URLs and still land on my Web API controllers whilst other URLs will serve up the root angular app page.  Lovely.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8607203368039364190'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8607203368039364190'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2015/05/a-tale-of-angular-html5mode-aspnet-mvc.html' title='A tale of Angular, html5mode, ASP.Net MVC and ASP.Net Web API'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1315115477013360114</id><published>2015-05-02T09:47:00.000+01:00</published><updated>2015-05-02T09:47:10.740+01:00</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Wiredep and Angular UI Bootstrap</title><content type='html'>You dont' need bootstrap.js</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1315115477013360114'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1315115477013360114'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-7326091180513516279</id><published>2015-04-24T06:07:00.003+01:00</published><updated>2021-03-13T14:40:52.437Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='asp.net mvc'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='validation'/><category scheme='http://www.blogger.com/atom/ns#' term='AngularJS'/><title type='text'>Tonight I'll Start an Open Source Project...</title><content type='html'>&lt;h5&gt;Further posts on this topic&lt;/h5&gt; &lt;ul&gt;&lt;li&gt;&lt;a href="https://blog.johnnyreilly.com/2015/05/ngvalidationfor-baby-steps.html"&gt;NgValidationFor Baby Steps&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt; &lt;p&gt;I'm excited. Are you?  I'm babysitting for a friend, I've my laptop, time to kill and (crucially) an idea...&lt;/p&gt; &lt;h4&gt;The Idea&lt;/h4&gt; &lt;p&gt;You're likely aware of the various form element directives that AngularJS offers.  For instance the &lt;a href="https://docs.angularjs.org/api/ng/directive/input"&gt;input directive&lt;/a&gt;:&lt;/p&gt; &lt;blockquote cite="https://docs.angularjs.org/api/ng/directive/input"&gt;HTML input element control. When used together with ngModel, it provides data-binding, input state control, and &lt;em&gt;validation&lt;/em&gt;. &lt;/blockquote&gt; &lt;p&gt;You'll notice that I emphasised the word "validation" there. That's important - that's my idea. I'm using AngularJS to build SPA's and for the server side I'm using ASP.Net MVC / Web API.  Crucially, my templates are actually ASP.Net MVC Partial Views.  That's key.&lt;/p&gt; &lt;p&gt;When I send data back from my SPA back to the server it gets unmarshalled / deserialized into a C# class (view model) of some kind.  When data goes the other way it's flowing back from a JSON'd view model and being used by my Angular code.&lt;/p&gt; &lt;p&gt;Now historically if I was building a fairly vanilla MVC app then I'd be making use of all the &lt;code&gt;TextboxFor&lt;/code&gt; extension methods etc to generate my input elements. For example, with a view model like this:&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;using System.ComponentModel.DataAnnotations;&lt;br /&gt;&lt;br /&gt;namespace App.ViewModels&lt;br /&gt;{&lt;br /&gt; public class RequiredModel&lt;br /&gt; {&lt;br /&gt;  [Required]&lt;br /&gt;  public string RequiredField{ get; set; }&lt;br /&gt; }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;I'd have a view like this:&lt;/p&gt; &lt;pre class="prettyprint html"&gt;&lt;br /&gt;&lt;code class="language-html"&gt;&lt;br /&gt;@model App.ViewModels.RequiredModel&lt;br /&gt;@using (Html.BeginForm())&lt;br /&gt;{&lt;br /&gt; &amp;lt;div class="row"&amp;gt;&lt;br /&gt;  @Html.LabelFor(x =&amp;gt; x.TextBox, "Something must be entered:")&lt;br /&gt;  @Html.TextBoxFor(x =&amp;gt; x.TextBox, true)&lt;br /&gt; &amp;lt;/div&amp;gt;&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;And that would generate HTML like this:&lt;/p&gt; &lt;pre class="prettyprint html"&gt;&lt;br /&gt;&lt;code class="language-html"&gt;&lt;br /&gt;&amp;lt;form action="/Demo/Required" method="post"&amp;gt;&lt;br /&gt; &amp;lt;div class="row"&amp;gt;&lt;br /&gt;  &amp;lt;label for="TextBox"&amp;gt;Something must be entered:&amp;lt;/label&amp;gt;&lt;br /&gt;  &amp;lt;input data-msg-required="The TextBox field is required." &lt;br /&gt;      data-rule-required="true" &lt;br /&gt;      id="TextBox" name="TextBox" type="text" value="" /&amp;gt;&lt;br /&gt; &amp;lt;/div&amp;gt;&lt;br /&gt;&amp;lt;/form&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;If you look at the HTML you'll see that the &lt;code&gt;Required&lt;/code&gt; data annotations have been propogated into the HTML in the HTML in the form of &lt;code&gt;data-rule-*&lt;/code&gt; and &lt;code&gt;data-msg-*&lt;/code&gt; attributes.  The code above is built using my &lt;a href="http://johnnyreilly.github.io/jQuery.Validation.Unobtrusive.Native/"&gt;jQuery.Validation.Unobtrusive.Native project&lt;/a&gt; which in turn was inspired by / based upon the &lt;a href="http://bradwilson.typepad.com/blog/2010/10/mvc3-unobtrusive-validation.html"&gt;Unobtrusive Client Validation in ASP.NET MVC&lt;/a&gt;.  That's right - I've done this before - or at least something quite like it.&lt;/p&gt; &lt;p&gt;There's clearly a strong crossover between AngularJS's input directive parameters and unobtrusive client validation.  I'm planning to take the principles (and maybe some of the code) that I used on that project and see if I can't make something useful with it here.  &lt;a href="https://blog.johnnyreilly.com/2014/08/angularjs-meet-aspnet-server-validation.html"&gt;Server side validation is jolly important&lt;/a&gt; but I can probably save a few compute cycles on the server by making use of client side validation as well.  If I'm right then I should able to come up with a mechanism that saves me from manually duplicating my server validation on the client.&lt;/p&gt; &lt;h4&gt;The Aim&lt;/h4&gt; &lt;p&gt;I want to be able to use HTML Helpers to propogate validation metadata from the server view models into angular form validation directive attributes.  Quite a mouthful I know.  What does that actually mean?  Well I've got 2 ideas.  Possibly I want to be able to code something like this:&lt;/p&gt; &lt;pre class="prettyprint html"&gt;&lt;br /&gt;&lt;code class="language-html"&gt;&lt;br /&gt;@model App.ViewModels.RequiredModel&lt;br /&gt;@using (Html.BeginForm())&lt;br /&gt;{&lt;br /&gt; &amp;lt;div class="row"&amp;gt;&lt;br /&gt;  @Html.LabelFor(x =&amp;gt; x.TextBox, "Something must be entered:")&lt;br /&gt;  @Html.NgTextBoxFor(x =&amp;gt; x.TextBox)&lt;br /&gt; &amp;lt;/div&amp;gt;&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;And have HTML like this generated:&lt;/p&gt; &lt;pre class="prettyprint html"&gt;&lt;br /&gt;&lt;code class="language-html"&gt;&lt;br /&gt;&amp;lt;form action="/Demo/Required" method="post"&amp;gt;&lt;br /&gt; &amp;lt;div class="row"&amp;gt;&lt;br /&gt;  &amp;lt;label for="TextBox"&amp;gt;Something must be entered:&amp;lt;/label&amp;gt;&lt;br /&gt;  &amp;lt;input&lt;br /&gt;      ng-required="true" &lt;br /&gt;      id="TextBox" name="TextBox" type="text" value="" /&amp;gt;&lt;br /&gt; &amp;lt;/div&amp;gt;&lt;br /&gt;&amp;lt;/form&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;The reservation I have about this approach is that it rather takes you away from the HTML.  Yes it works (and to your seasoned MVC-er it will feel quite natural in some ways) but it feels rather heavy handed.  But I'd like what I'm building to be easy for users to plug into existing code without a ton of rework. So, the other idea I'm toying with is having HTML helpers that just return a string of attributes.  So if I had an angular form that looked like this:&lt;/p&gt; &lt;pre class="prettyprint html"&gt;&lt;br /&gt;&lt;code class="language-html"&gt;&lt;br /&gt;&amp;lt;div ng-controller="ExampleController"&amp;gt;&lt;br /&gt;&amp;lt;form&amp;gt;&lt;br /&gt; &amp;lt;div class="row"&amp;gt;&lt;br /&gt;  &amp;lt;label&amp;gt;Something must be entered: &lt;br /&gt;    &amp;lt;input name="RequiredField" type="text" value="" /&amp;gt;&lt;br /&gt;  &amp;lt;/label&amp;gt;&lt;br /&gt; &amp;lt;/div&amp;gt;&lt;br /&gt;&amp;lt;/form&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;I could tweak it to push in the validation directive attributes like this:&lt;/p&gt; &lt;pre class="prettyprint html"&gt;&lt;br /&gt;&lt;code class="language-html"&gt;&lt;br /&gt;@model App.ViewModels.RequiredModel&lt;br /&gt;&amp;lt;div ng-controller="ExampleController"&amp;gt;&lt;br /&gt;&amp;lt;form&amp;gt;&lt;br /&gt; &amp;lt;div class="row"&amp;gt;&lt;br /&gt;  &amp;lt;label&amp;gt;Something must be entered: &lt;br /&gt;    &amp;lt;input name="RequiredField" type="text" value="" @Html.NgValidationFor(x =&amp;gt; x.RequiredField) /&amp;gt;&lt;br /&gt;  &amp;lt;/label&amp;gt;&lt;br /&gt; &amp;lt;/div&amp;gt;&lt;br /&gt;&amp;lt;/form&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;And end up with HTML like this:&lt;/p&gt; &lt;pre class="prettyprint html"&gt;&lt;br /&gt;&lt;code class="language-html"&gt;&lt;br /&gt;&amp;lt;div ng-controller="ExampleController"&amp;gt;&lt;br /&gt;&amp;lt;form&amp;gt;&lt;br /&gt; &amp;lt;div class="row"&amp;gt;&lt;br /&gt;  &amp;lt;label&amp;gt;Something must be entered: &lt;br /&gt;    &amp;lt;input name="RequiredField" type="text" value="" ng-required="true" /&amp;gt;&lt;br /&gt;  &amp;lt;/label&amp;gt;&lt;br /&gt; &amp;lt;/div&amp;gt;&lt;br /&gt;&amp;lt;/form&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;This is a simplified example of course - it's likely that any number of validation directive attributes might be returned from &lt;code&gt;NgValidationFor&lt;/code&gt;.  And crucially if these attributes were changed on the server view model then the validation changes would automatically end up in the client HTML with this approach.&lt;/p&gt; &lt;h4&gt;The Approach&lt;/h4&gt; &lt;p&gt;At least to start off with I'm going to aim at creating the second of my approaches.  I may come back and implement the first at some point but I think the second is a better place to start.&lt;/p&gt; &lt;p&gt;I'm kind of surprised no-one else has built this already actually - but I'm not aware of anything.  I've had a little duckduckgo around and found no takers.  The closest I've come is the excellent &lt;a href="http://www.breezejs.com/sites/all/apidocs/classes/Validator.html"&gt;BreezeJS&lt;/a&gt;.  BreezeJS does way more than I want it to - I'm planning to restrict the scope of this project to simply turning data annotations on my ASP.Net MVC server models into &lt;code&gt;ng-*&lt;/code&gt; directive attributes in HTML.  That's it.&lt;/p&gt; &lt;p&gt;So, general housekeeping.... I'm going to host this project on &lt;a href="http://www.github.com"&gt;GitHub&lt;/a&gt;, I'm going to have Continuous Integration with &lt;a href="http://www.appveyor.com/"&gt;AppVeyor&lt;/a&gt; and I'm planning to publish this via &lt;a href="http://www.nuget.org/"&gt;NuGet&lt;/a&gt; (when and if I've created something useful).&lt;/p&gt; &lt;p&gt;I just need a name and I'll begin.  What shall I call it?  Some options:&lt;/p&gt; &lt;ul&gt;&lt;li&gt;Angular ASP.Net MVC Extensions&lt;/li&gt;&lt;li&gt;angular-aspnet-mvc-extensions&lt;/li&gt;&lt;li&gt;Angular MVC Element Extensions&lt;/li&gt;&lt;li&gt;Angular Validation Html Helpers&lt;/li&gt;&lt;li&gt;NgValidationFor (the name of the HTML helper I made up)&lt;/li&gt;&lt;/ul&gt; &lt;p&gt;Hmmmm.... None of them is particularly lighting my fire.  The first four are all a bit &lt;a href="https://en.wikipedia.org/wiki/Ronseal"&gt;RonSeal&lt;/a&gt; - which is fine.... Ug.  The last one... It's a bit more pithy.  Okay - I'll go with "NgValidationFor" at least for now.  If something better occurs I can always change my mind.&lt;/p&gt; &lt;p&gt;&lt;a href="https://github.com/johnnyreilly/NgValidationFor"&gt;And we're off!&lt;/a&gt;&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7326091180513516279'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7326091180513516279'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2015/04/tonight-ill-start-open-source-project.html' title='Tonight I&apos;ll Start an Open Source Project...'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2648797317002975319</id><published>2015-04-17T19:34:00.001+01:00</published><updated>2015-04-17T19:34:19.846+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='emoji'/><category scheme='http://www.blogger.com/atom/ns#' term='android'/><title type='text'>How to activate your emoji keyboard on Android 5.0 (Lollipop)</title><content type='html'>&lt;p&gt;A departure from from my normal content - I need to tell you about &lt;a href="http://en.wikipedia.org/wiki/Emoji"&gt;emoji&lt;/a&gt;!  You'll probably already know about them - just imagine a emoticon but about 300,000 times better. They really add spice to to textual content.  Oh and they're Japanese - which is also way cool.&lt;/p&gt; &lt;p&gt;Since I've discovered emoji I've felt a pressing need to have them on my (Android) phone. This is harder than you might imagine. But totally do-able.... Here's how you get the emoji love on your Android Lollipop phone:&lt;/p&gt;   &lt;ul&gt;&lt;li&gt;goto settings (the cog)&lt;/li&gt;&lt;li&gt;select "Language and Input"&lt;/li&gt;&lt;li&gt;select your "Current keyboard" and then select the "Choose keyboards" option&lt;/li&gt;&lt;li&gt;look for a keyboard that says "iWnn IME Japanese". Select it&lt;/li&gt;&lt;li&gt;drop back to the "Language and Input" menu where you will see "iWnn IME Japanese" is now there.&lt;/li&gt;&lt;li&gt;select it and deactivate "Japanese" and activate "Emoji" like this:  &lt;p class="mobile-photo"&gt;&lt;a href="http://4.bp.blogspot.com/-toFgqIFcTs4/VTC6JXxwmtI/AAAAAAAAA0s/OT7O7MdGvSc/s1600/Screenshot_2015-04-16-07-21-06-741564.png"&gt;&lt;img src="http://4.bp.blogspot.com/-toFgqIFcTs4/VTC6JXxwmtI/AAAAAAAAA0s/OT7O7MdGvSc/s320/Screenshot_2015-04-16-07-21-06-741564.png"  border="0" alt="" id="BLOGGER_PHOTO_ID_6138610962270296786" /&gt;&lt;/a&gt;&lt;/p&gt; &lt;/li&gt;&lt;li&gt;now you should find your keyboard contains a little globe icon. When you select it.... Emoji!!!!   &lt;p class="mobile-photo"&gt;&lt;a href="http://2.bp.blogspot.com/-xtdHdGuc6YU/VTC6I-_43tI/AAAAAAAAA0g/JnlckIUnS48/s1600/Screenshot_2015-04-16-07-23-56%257E2-739197.jpg"&gt;&lt;img src="http://2.bp.blogspot.com/-xtdHdGuc6YU/VTC6I-_43tI/AAAAAAAAA0g/JnlckIUnS48/s320/Screenshot_2015-04-16-07-23-56%257E2-739197.jpg"  border="0" alt="" id="BLOGGER_PHOTO_ID_6138610955618672338" /&gt;&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2648797317002975319'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2648797317002975319'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2015/04/how-to-activate-your-emoji-keyboard-on.html' title='How to activate your emoji keyboard on Android 5.0 (Lollipop)'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='http://4.bp.blogspot.com/-toFgqIFcTs4/VTC6JXxwmtI/AAAAAAAAA0s/OT7O7MdGvSc/s72-c/Screenshot_2015-04-16-07-21-06-741564.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2079309339317922365</id><published>2015-04-02T07:10:00.001+01:00</published><updated>2015-04-02T07:10:44.115+01:00</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Hush! here comes a whizz-bang</title><content type='html'>&lt;p&gt;I wanted to write about the state of the JavaScript nation - as viewed from my position in the trenches.  About 5 years ago it seemed like jQuery would rule the earth forever and everything would be a jQuery plugin&lt;/p&gt; &lt;p&gt;Here in the jQuery Angular Aurelia Durandal React Fashion Backbone &lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2079309339317922365'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2079309339317922365'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2242567123709921842</id><published>2015-03-20T15:52:00.001Z</published><updated>2021-03-04T06:58:05.402Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='asp.net mvc'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='sward'/><category scheme='http://www.blogger.com/atom/ns#' term='PartialView'/><title type='text'>PartialView.ToString()</title><content type='html'>&lt;p&gt;In the name of &lt;a href="https://en.wikipedia.org/wiki/Don%27t_repeat_yourself"&gt;DRY&lt;/a&gt; I found myself puzzling how one could take a &lt;code&gt;PartialViewResult&lt;/code&gt; and render it as a &lt;code&gt;string&lt;/code&gt;.  Simple, right?&lt;/p&gt; &lt;p&gt;In fact, in my head this was already a solved problem.  I mean I've written about this &lt;a href="http://blog.icanmakethiswork.io/2012/07/rendering-partial-view-to-string.html"&gt;before&lt;/a&gt; already!  Except I haven't.  Not really - what I did back then was link to what someone else had written and say "yay! well done chap - like he said!". It turns out that was a bad move.  That blog appears to be gone and so I'm back to where I was.  Ug.  Lesson learned.&lt;/p&gt; &lt;h4&gt;What are we trying to do?&lt;/h4&gt; &lt;p&gt;So, for the second time of asking, here is how to take a &lt;code&gt;PartialViewResult&lt;/code&gt; and turn it into a &lt;code&gt;string&lt;/code&gt;.  It's an invaluable technique to deal with certain scenarios.&lt;/p&gt; &lt;p&gt;In my own case I have a toolbar in my application that is first pushed into the UI in my &lt;code&gt;_Layout.cshtml&lt;/code&gt; by means of a trusty &lt;code&gt;@Html.Action("Toolbar")&lt;/code&gt;.  I wanted to be able to re-use the &lt;code&gt;PartialViewResult&lt;/code&gt; returned by &lt;code&gt;Toolbar&lt;/code&gt; on my controller inside a &lt;code&gt;JSON&lt;/code&gt; payload. And despite the title of this post, &lt;code&gt;PartialView.ToString()&lt;/code&gt; &lt;em&gt;doesn't&lt;/em&gt; quite cut the mustard.  Obvious really, if it did then why would I be writing this and you be reading this?&lt;/p&gt; &lt;p&gt;The solution is actually fairly simple.  And, purely for swank, I'm going to offer it you 3 ways.  Whatever's your poison.&lt;/p&gt; &lt;h4&gt;Inheritance (it's so yesterday darling)&lt;/h4&gt; &lt;p&gt;Yes there was a time when everything was inheritance based.  You were rewarded handsomely for making sure that was the case.  However, times have changed and (with good reason) people tend to &lt;a href="https://en.wikipedia.org/wiki/Composition_over_inheritance"&gt;favour  composition over inheritance&lt;/a&gt;. So, perhaps just for the memories, let first offer you the inheritance based approach:&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;protected string ConvertPartialViewToString(PartialViewResult partialView)&lt;br /&gt;{&lt;br /&gt;  using (var sw = new StringWriter())&lt;br /&gt;  {&lt;br /&gt;    partialView.View = ViewEngines.Engines&lt;br /&gt;      .FindPartialView(ControllerContext, partialView.ViewName).View;&lt;br /&gt;&lt;br /&gt;    var vc = new ViewContext(&lt;br /&gt;      ControllerContext, partialView.View, partialView.ViewData, partialView.TempData, sw);&lt;br /&gt;    partialView.View.Render(vc, sw);&lt;br /&gt;&lt;br /&gt;    var partialViewString = sw.GetStringBuilder().ToString();&lt;br /&gt;&lt;br /&gt;    return partialViewString;&lt;br /&gt;  }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;The idea being that the above method is placed onto a base controller which your controllers subclass.  Thus using this method inside one of the controllers is as simple as:&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;var toolbarHtml = ConvertPartialViewToString(partialViewResult);&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;h4&gt;Extension method (sexier syntax)&lt;/h4&gt; &lt;p&gt;So the next choice is implementing this as an extension method.  Here's my static class which adds &lt;code&gt;ConvertToString&lt;/code&gt; onto &lt;code&gt;PartialViewResult&lt;/code&gt;:&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;using System.IO;&lt;br /&gt;using System.Web.Mvc;&lt;br /&gt;&lt;br /&gt;namespace My.Utilities.Extensions&lt;br /&gt;{&lt;br /&gt;  public static class PartialViewResultExtensions&lt;br /&gt;  {&lt;br /&gt;    public static string ConvertToString(this PartialViewResult partialView, &lt;br /&gt;                                              ControllerContext controllerContext)&lt;br /&gt;    {&lt;br /&gt;      using (var sw = new StringWriter())&lt;br /&gt;      {&lt;br /&gt;        partialView.View = ViewEngines.Engines&lt;br /&gt;          .FindPartialView(controllerContext, partialView.ViewName).View;&lt;br /&gt;&lt;br /&gt;        var vc = new ViewContext(&lt;br /&gt;          controllerContext, partialView.View, partialView.ViewData, partialView.TempData, sw);&lt;br /&gt;        partialView.View.Render(vc, sw);&lt;br /&gt;&lt;br /&gt;        var partialViewString = sw.GetStringBuilder().ToString();&lt;br /&gt;&lt;br /&gt;        return partialViewString;&lt;br /&gt;      }&lt;br /&gt;    }&lt;br /&gt;  }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;I don't know about you but I do love an extension method - it often makes for much more readable code.  In this case we can use:&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;var toolbarHtml = partialViewResult.ConvertToString(ControllerContext);&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Which I think we can all agree is really rather lovely.  Perhaps it would be more lovely if I didn't have to pass &lt;code&gt;ControllerContext&lt;/code&gt; - but hey!  Still quite nice.&lt;/p&gt; &lt;h4&gt;Favouring Composition over Inheritance (testable)&lt;/h4&gt; &lt;p&gt;Although ASP.Net MVC was designed to be testable there are times when you think "really? Can it be that hard?". In fact for a well thought through discussion on the topic I advise you read &lt;a href="http://volaresystems.com/blog/post/2010/08/19/Dont-mock-HttpContext"&gt;this&lt;/a&gt;.  (I'm aware of the irony implicit in linking to another blog post in a blog post that I only wrote because I first linked to another blog which vanished.... Infinite recursion anybody?)&lt;/p&gt; &lt;p&gt;The conclusion of the linked blog post is twofold&lt;/p&gt; &lt;ol&gt;&lt;li&gt;Don't mock HTTPContext&lt;/li&gt;&lt;li&gt;Use the &lt;a href="https://en.wikipedia.org/wiki/Facade_pattern"&gt;facade pattern&lt;/a&gt; instead&lt;/li&gt;&lt;/ol&gt; &lt;p&gt;Having testable code is not a optional bauble in my view - it's a necessity.  So with my final approach that's exactly what I'll do.&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;using System.Web.Mvc;&lt;br /&gt;&lt;br /&gt;namespace My.Interfaces&lt;br /&gt;{&lt;br /&gt;  public interface IMvcInternals&lt;br /&gt;  {&lt;br /&gt;    string ConvertPartialViewToString(PartialViewResult partialView, ControllerContext controllerContext);&lt;br /&gt;  }&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;// ....&lt;br /&gt;&lt;br /&gt;using System.IO;&lt;br /&gt;using System.Web.Mvc;&lt;br /&gt;using My.Interfaces;&lt;br /&gt;&lt;br /&gt;namespace My.Utilities&lt;br /&gt;{&lt;br /&gt;  public class MvcInternals : IMvcInternals&lt;br /&gt;  {&lt;br /&gt;    public string ConvertPartialViewToString(PartialViewResult partialView, &lt;br /&gt;                                             ControllerContext controllerContext)&lt;br /&gt;    {&lt;br /&gt;      using (var sw = new StringWriter())&lt;br /&gt;      {&lt;br /&gt;        partialView.View = ViewEngines.Engines&lt;br /&gt;          .FindPartialView(controllerContext, partialView.ViewName).View;&lt;br /&gt;&lt;br /&gt;        var vc = new ViewContext(&lt;br /&gt;          controllerContext, partialView.View, partialView.ViewData, partialView.TempData, sw);&lt;br /&gt;        partialView.View.Render(vc, sw);&lt;br /&gt;&lt;br /&gt;        var partialViewString = sw.GetStringBuilder().ToString();&lt;br /&gt;&lt;br /&gt;        return partialViewString;&lt;br /&gt;      }&lt;br /&gt;    }&lt;br /&gt;  }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;So here I have a simple interface with a &lt;code&gt;ConvertPartialViewToString&lt;/code&gt; method on it. This interface can be passed into a controller and then used like this:&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;var toolbarHtml = _mvcInternals.ConvertPartialViewToString(partialViewResult, ControllerContext);&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Ah... that's the sweet mellifluous sound of easily testable code.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2242567123709921842'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2242567123709921842'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2015/03/partialview-tostring.html' title='PartialView.ToString()'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1112541548584464531</id><published>2015-02-27T16:50:00.001Z</published><updated>2021-03-14T05:26:33.473Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='tsconfig.json'/><category scheme='http://www.blogger.com/atom/ns#' term='TypeScript'/><category scheme='http://www.blogger.com/atom/ns#' term='implicit references'/><title type='text'>Hey tsconfig.json, where have you been all my life?</title><content type='html'>&lt;p&gt;Sometimes, you just miss things.  Something seismic happens and you had no idea.  So it was with &lt;code&gt;tsconfig.json&lt;/code&gt;.&lt;/p&gt; &lt;p&gt;This blog post started life with the name "TypeScript: Some IDEs are more equal than others". I'd intended to use it summarise a discussion on the &lt;a href="https://github.com/Microsoft/TypeScript/issues/1066"&gt;TypeScript GitHub repo&lt;/a&gt; about implicit referencing including a fist shaken at the sky at the injustice of it all.  But whilst I was writing it I dicovered things had changed without my knowledge. That's a rather wonderful thing.&lt;/p&gt; &lt;h4&gt;Implicit Referencing&lt;/h4&gt; &lt;p&gt;Implicit referencing, if you're not aware, is the thing that separates Visual Studio from all other IDEs / text editors. Implicit referencing means that in Visual Studio you don't need to make use of comments at the head of each TypeScript file in order to tell the compiler where it can find the related TypeScript files.&lt;/p&gt; &lt;p&gt;The &lt;code&gt;reference&lt;/code&gt; comments aren't necessary when using Visual Studio because the VS project file is used to drive the files passed to the TypeScript compiler (tsc).&lt;/p&gt; &lt;p&gt;The upshot of this is that, at time of writing, you can generally look at a TypeScript codebase and tell whether it was written using Visual Studio by opening it up a file at random and eyeballing for something like this at the top:&lt;/p&gt; &lt;pre class="prettyprint ts"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;/// &amp;lt;reference path="other-file.ts" /&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;&lt;i&gt;"A-ha!  They're using "reference" comments Watson. From this I deduce that the individuals in question are using the internal module approach and using Visual Studio as their IDE.  Elementary, my dear fellow, quite elementary."&lt;/i&gt;&lt;/p&gt; &lt;p&gt;This has important implications.  Important I tell you, yes important! Well, important if you want to reduce the barriers between Visual Studio and everyone else.  And I do.  Whilst I love Visual Studio - it's been my daily workhorse for many years - I also love stepping away from it and using something more stripped down.  I also like working with other people without mandating that they need to use Visual Studio as well.  In the words of Rodney King, "can't we all get along?".&lt;/p&gt; &lt;h4&gt;Cross-IDE TypeScript projects&lt;/h4&gt; &lt;p&gt;I feel I should be clear - you can already set up TypeScript projects to work regardless of IDE. But there's friction.  It's not clear cut.  You can see a full on discussion around this &lt;a href="https://github.com/Microsoft/TypeScript/issues/1066"&gt;here&lt;/a&gt; but in the end it comes down to making a choice between these 3 options:&lt;/p&gt; &lt;ol&gt;&lt;li&gt;Set &amp;lt;TypeScriptEnabled&amp;gt;false&amp;lt;/TypeScriptEnabled&amp;gt; in a project file. &lt;a href="https://github.com/Microsoft/TypeScript/issues/1066#issuecomment-63727612"&gt;This flag effectively deactivates implicit referencing.&lt;/a&gt; This approach requires that all developers (regardless of IDE) use &lt;code&gt;/// &amp;lt;reference&lt;/code&gt;s to build context. Compiler options in VS can be controlled using the project file as is.&lt;/li&gt; &lt;li&gt;Using Visual Studio without any csproj tweaks. This approach requires that all files will need &lt;code&gt;/// &amp;lt;reference&lt;/code&gt;s at their heads in order to build compilation context &lt;em&gt;outside&lt;/em&gt; of Visual Studio. It's possible that &lt;code&gt;/// &amp;lt;reference&lt;/code&gt;s and the csproj could get out of line - care is required to avoid this. Compiler options in VS can be controlled using the project file as is.&lt;/li&gt; &lt;li&gt;Using just files in Visual Studio with &lt;code&gt;/// &amp;lt;reference&lt;/code&gt;s to build compilation context. This scenario also requires that all developers (regardless of IDE) use &lt;code&gt;/// &amp;lt;reference&lt;/code&gt;s to build context. In Visual Studio there will be no control over compiler options.&lt;/li&gt; &lt;/ol&gt; &lt;p&gt;As you can see - this is sub-optimal.  But don't worry - there's a new sheriff in town....&lt;/p&gt; &lt;h4&gt;&lt;code&gt;tsconfig.json&lt;/code&gt;&lt;/h4&gt; &lt;p&gt;I'd decided to give &lt;a href="https://github.com/TypeStrong/atom-typescript"&gt;Atom TypeScript plugin&lt;/a&gt; a go as I heard much enthusiastic noise about it.  I fired it up and pointed it at a a TypeScript AngularJS project built in Visual Studio.  I was mentally preparing myself for the job of adding all the /// references in when I suddenly noticed a file blinking at me:  &lt;a href="http://3.bp.blogspot.com/-cK80o3-ysP0/VPCV9fxtwXI/AAAAAAAAAzA/HC8uY9wjB7s/s1600/Screenshot%2B2015-02-27%2B16.05.29.png" imageanchor="1" &gt;&lt;img border="0" src="http://3.bp.blogspot.com/-cK80o3-ysP0/VPCV9fxtwXI/AAAAAAAAAzA/HC8uY9wjB7s/s640/Screenshot%2B2015-02-27%2B16.05.29.png" /&gt;&lt;/a&gt; &lt;p&gt;&lt;code&gt;tsconfig.json&lt;/code&gt;?  What's that?  Time to read &lt;a href="https://github.com/TypeStrong/atom-typescript#project-support"&gt;the docs&lt;/a&gt;:&lt;/p&gt; &lt;blockquote cite="https://github.com/TypeStrong/atom-typescript#project-support"&gt;Supported via tsconfig.json (&lt;a href="https://github.com/TypeStrong/atom-typescript/blob/master/docs/tsconfig.md"&gt;read more&lt;/a&gt;) which is going to be the defacto Project file format for the next versions of TypeScript. &lt;/blockquote&gt; &lt;p&gt;"read more"?  Oh yes indeedy - I think I will "read more"!&lt;/p&gt; &lt;blockquote cite="https://github.com/TypeStrong/atom-typescript/blob/master/docs/tsconfig.md"&gt;&lt;p&gt;A unified project format for TypeScript (&lt;a href="https://github.com/Microsoft/TypeScript/pull/1692"&gt;see merged PR on Microsoft/TypeScript&lt;/a&gt;). The TypeScript compiler (1.4 and above) only cares about compilerOptions and files. We add additional features to this &lt;a href="https://github.com/Microsoft/TypeScript/issues/1955"&gt;with the typescript team's approval to extend the file as long as we don't conflict:&lt;/a&gt;&lt;/p&gt; &lt;ul&gt;&lt;li&gt;&lt;a href="https://github.com/TypeStrong/atom-typescript/blob/e2fa67c4715189b71430f766ed9a92d9fb3255f9/lib/main/tsconfig/tsconfig.ts#L8-L35"&gt;compilerOptions&lt;/a&gt; similar to what you would pass on the commandline to tsc. &lt;li&gt;&lt;a href="https://github.com/TypeStrong/atom-typescript/blob/master/docs/tsconfig.md#filesglob"&gt;filesGlob&lt;/a&gt;: To make it easier for you to just add / remove files in your project we add filesGlob which accepts an array of glob / minimatch / RegExp patterns (similar to grunt)to specify source files.&lt;/li&gt;&lt;li&gt;&lt;a href="https://github.com/TypeStrong/atom-typescript/blob/master/docs/tsconfig.md#format"&gt;format&lt;/a&gt;: Code formatting options&lt;/li&gt;&lt;li&gt;&lt;a href="https://github.com/TypeStrong/atom-typescript/blob/master/docs/tsconfig.md#version"&gt;version&lt;/a&gt;: The TypeScript version&lt;/li&gt;&lt;/ul&gt;&lt;/blockquote&gt; &lt;p&gt;That's right folks, we don't need &lt;code&gt;/// &amp;lt;reference&lt;/code&gt;s comments anymore. In a blinding flash of light it all changes.  We're going from the dark end of the street, to the bright side of the road.  &lt;code&gt;tsconfig.json&lt;/code&gt; is here to ease away the pain and make it all better.  Let's enjoy it while we can.&lt;/p&gt; &lt;p&gt;This change should ship with TypeScript 1.5 (hopefully) for those using Visual Studio.  For those using Atom TypeScript (and as of today that's includes me) the carnival celebrations can begin now!&lt;/p&gt; &lt;p&gt;Thanks to &lt;a href="https://github.com/basarat"&gt;@basarat&lt;/a&gt; who have quoted at length and &lt;a href="https://smellegantcode.wordpress.com/"&gt;Daniel Earwicker&lt;/a&gt; who is the reason that I came to discover &lt;code&gt;tsconfig.json&lt;/code&gt;.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1112541548584464531'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1112541548584464531'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2015/02/hey-tsconfigjson-where-have-you-been.html' title='Hey &lt;code&gt;tsconfig.json&lt;/code&gt;, where have you been all my life?'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='http://3.bp.blogspot.com/-cK80o3-ysP0/VPCV9fxtwXI/AAAAAAAAAzA/HC8uY9wjB7s/s72-c/Screenshot%2B2015-02-27%2B16.05.29.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8595669217015947870</id><published>2015-02-17T16:15:00.002Z</published><updated>2021-03-13T14:39:56.341Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='asp.net'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='gulp-inject'/><category scheme='http://www.blogger.com/atom/ns#' term='Web Optimization'/><category scheme='http://www.blogger.com/atom/ns#' term='gulpjs'/><category scheme='http://www.blogger.com/atom/ns#' term='wiredep'/><title type='text'>Using Gulp to inject scripts and styles tags directly into your HTML</title><content type='html'>&lt;p&gt;This is very probably the dullest title for a blog post I've ever come up with.  Read on though folks - it's definitely going to pick up...&lt;/p&gt; &lt;p&gt;I &lt;a href="https://blog.johnnyreilly.com/2014/11/using-gulp-in-visual-studio-instead-of-web-optimization.html"&gt;wrote last year&lt;/a&gt; about my first usage of Gulp in an ASP.Net project.  I used Gulp to replace the Web Optimization functionality that is due to disappear when ASP.Net v5 ships.  What I came up with was an approach that provided pretty much the same functionality; raw source in debug mode, bundling + minification in release mode.&lt;/p&gt; &lt;p&gt;It worked by having a launch page which was straight HTML.  Embedded within this page was JavaScript that would, at runtime, load the required JavaScript / CSS and inject it dynamically into the document.  This approach worked but it had a number of downsides:&lt;/p&gt; &lt;ol&gt; &lt;li&gt;Each time you fired up the app the following sequence of events would happen:  &lt;ul&gt;&lt;li&gt;jQuery would load (purely there to simplify the making of various startup AJAX calls)&lt;/li&gt;&lt;li&gt;the page would make an AJAX call to the server to load various startup data, including whether the app is running in debug or release mode&lt;/li&gt;&lt;li&gt;Depending on the result of the startup data either the debug or release package manifest would be loaded.&lt;/li&gt;&lt;li&gt;For each entry in the package manifest &lt;code&gt;script&lt;/code&gt; and &lt;code&gt;link&lt;/code&gt; tags would be created and added to the document.  These would generate further requests to the server to load the resources.&lt;/li&gt;&lt;/ul&gt;Quite a lot going on here isn't there?  Accordingly, initial startup time was slower than you might hope.&lt;/li&gt; &lt;li&gt;The "F" word: &lt;a href="https://en.wikipedia.org/wiki/Flash_of_unstyled_content"&gt;FOUC&lt;/a&gt;. Flash Of Unstyled Content  - whilst all the hard work of the page load was going on (before the CSS had been loaded) the page would look rather ... bare.  Not a terrible thing but none too slick either.&lt;/li&gt; &lt;li&gt;The gulpfile built both the debug and the release package each time it was run.  This meant the gulp task generally did double the work that it needed to do.&lt;/li&gt; &lt;/ol&gt; &lt;p&gt;I wanted to see if I could tackle these issues.  I've recently been watching &lt;a href="https://twitter.com/John_Papa"&gt;John Papa&lt;/a&gt;'s excellent &lt;a href="http://www.pluralsight.com/courses/javascript-build-automation-gulpjs"&gt;Pluralsight course on Gulp&lt;/a&gt; and picked up a number of useful tips.  With that in hand let's see what we can come up with...&lt;/p&gt; &lt;h4&gt;Death to dynamic loading&lt;/h4&gt; &lt;p&gt;The main issue with the approach I've been using is the dynamic loading.  It makes the app slower and more complicated.  So the obvious solution is to have my gulpfile inject scripts and css into the template.  To that end it's &lt;a href="https://www.npmjs.com/package/wiredep"&gt;wiredep&lt;/a&gt; &amp; &lt;a href="https://www.npmjs.com/package/gulp-inject"&gt;gulp-inject&lt;/a&gt; to the rescue!&lt;/p&gt; &lt;p&gt;gulp-inject (as the name suggests) is used to inject &lt;code&gt;script&lt;/code&gt; and &lt;code&gt;link&lt;/code&gt; tags into source code. I'm using &lt;a href="http://bower.io/"&gt;Bower&lt;/a&gt; as my client side package manager and so I'm going to use wiredep to determine the vendor scripts I need. It will determine what packages my app is using from looking at my &lt;code&gt;bower.json&lt;/code&gt;, and give me a list of file paths in &lt;em&gt;dependency order&lt;/em&gt; (which I can then pass on to gulp-inject in combination with my own app script files).  This means I don't have to think about ordering bower dependencies myself and I no longer need to separately maintain a list of these files within my gulpfile.&lt;/p&gt; &lt;p&gt;So, let's get the launch page (&lt;code&gt;index.html&lt;/code&gt;) ready for gulp-inject:&lt;/p&gt; &lt;pre class="prettyprint html"&gt;&lt;br /&gt;&lt;code class="language-html"&gt;&lt;br /&gt;&amp;lt;!DOCTYPE html&amp;gt;&lt;br /&gt;&amp;lt;html&amp;gt;&lt;br /&gt;&amp;lt;head&amp;gt;&lt;br /&gt;    &amp;lt;meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" /&amp;gt;&lt;br /&gt;    &amp;lt;style&amp;gt;&lt;br /&gt;        .ng-hide {&lt;br /&gt;            display: none !important;&lt;br /&gt;        }&lt;br /&gt;    &amp;lt;/style&amp;gt;&lt;br /&gt;    &amp;lt;title ng-bind="title"&amp;gt;Proverb&amp;lt;/title&amp;gt;&lt;br /&gt;    &amp;lt;meta charset="utf-8" /&amp;gt;&lt;br /&gt;    &amp;lt;meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no" /&amp;gt;&lt;br /&gt;&lt;br /&gt;    &amp;lt;!-- inject:css --&amp;gt;&lt;br /&gt;    &amp;lt;!-- endinject --&amp;gt;&lt;br /&gt;&lt;br /&gt;    &amp;lt;link rel="icon" type="image/png" href="content/images/icon.png"&amp;gt;&lt;br /&gt;&amp;lt;/head&amp;gt;&lt;br /&gt;&amp;lt;body&amp;gt;&lt;br /&gt;    &amp;lt;div&amp;gt;&lt;br /&gt;        &amp;lt;div ng-include="'app/layout/shell.html'"&amp;gt;&amp;lt;/div&amp;gt;&lt;br /&gt;        &amp;lt;div id="splash-page" ng-show="false" class="dissolve-animation"&amp;gt;&lt;br /&gt;            &amp;lt;div class="page-splash"&amp;gt;&lt;br /&gt;                &amp;lt;div class="page-splash-message"&amp;gt;&lt;br /&gt;                    Proverb&lt;br /&gt;                &amp;lt;/div&amp;gt;&lt;br /&gt;&lt;br /&gt;                &amp;lt;div class="progress"&amp;gt;&lt;br /&gt;                    &amp;lt;div class="progress-bar progress-bar-striped active" role="progressbar" style="width: 20%;"&amp;gt;&lt;br /&gt;                        &amp;lt;span class="sr-only"&amp;gt;loading...&amp;lt;/span&amp;gt;&lt;br /&gt;                    &amp;lt;/div&amp;gt;&lt;br /&gt;                &amp;lt;/div&amp;gt;&lt;br /&gt;            &amp;lt;/div&amp;gt;&lt;br /&gt;        &amp;lt;/div&amp;gt;&lt;br /&gt;    &amp;lt;/div&amp;gt;&lt;br /&gt;&lt;br /&gt;    &amp;lt;script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"&amp;gt;&amp;lt;/script&amp;gt;&lt;br /&gt;    &amp;lt;script&amp;gt;window.jQuery || document.write('&amp;lt;script src="/build/jquery.min.js"&amp;gt;\x3C/script&amp;gt;')&amp;lt;/script&amp;gt;&lt;br /&gt;&lt;br /&gt;    &amp;lt;!-- inject:js --&amp;gt;&lt;br /&gt;    &amp;lt;!-- endinject --&amp;gt;&lt;br /&gt;&lt;br /&gt;    &amp;lt;script&amp;gt;&lt;br /&gt;        (function () {&lt;br /&gt;&lt;br /&gt;            // Load startup data from the server&lt;br /&gt;            $.getJSON("api/Startup")&lt;br /&gt;                .done(function (startUpData) {&lt;br /&gt;&lt;br /&gt;                    angularApp.start({&lt;br /&gt;                        thirdPartyLibs: {&lt;br /&gt;                            moment: window.moment,&lt;br /&gt;                            toastr: window.toastr,&lt;br /&gt;                            underscore: window._&lt;br /&gt;                        },&lt;br /&gt;                        appConfig: startUpData&lt;br /&gt;                    });&lt;br /&gt;                });&lt;br /&gt;        })();&lt;br /&gt;    &amp;lt;/script&amp;gt;&lt;br /&gt;&amp;lt;/body&amp;gt;&lt;br /&gt;&amp;lt;/html&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;The important thing to notice here are the &lt;code&gt;&amp;lt;!-- inject:css --&amp;gt;&lt;/code&gt; and &lt;code&gt;&amp;lt;!-- inject:js --&amp;gt;&lt;/code&gt; injection placeholders.  It's here that our script and style tags will be injected into the template. You'll notice that jQuery is &lt;em&gt;not&lt;/em&gt; being injected - and that's because I've opted to use a CDN for jQuery and then only fallback to serving jQuery myself if the CDN fails.&lt;/p&gt; &lt;p&gt;The other thing to notice here is that our launch page has become oh so much simpler in comparison with the dynamic loading approach.  Which is fab.&lt;/p&gt; &lt;p&gt;Now before we start looking at our gulpfile I want to split out the configuration into a standalone file called gulpfile.config.js:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;var tsjsmapjsSuffix = ".{ts,js.map,js}";&lt;br /&gt;&lt;br /&gt;var bower = "bower_components/";&lt;br /&gt;var app = "app/";&lt;br /&gt;&lt;br /&gt;var config = {&lt;br /&gt;&lt;br /&gt;    base: ".",&lt;br /&gt;    buildDir: "./build/",&lt;br /&gt;    debug: "debug",&lt;br /&gt;    release: "release",&lt;br /&gt;    css: "css",&lt;br /&gt;&lt;br /&gt;    bootFile: app + "index.html",&lt;br /&gt;    bootjQuery: bower + "jquery/dist/jquery.min.js",&lt;br /&gt;&lt;br /&gt;    // The fonts we want Gulp to process&lt;br /&gt;    fonts: [bower + "fontawesome/fonts/*.*"],&lt;br /&gt;&lt;br /&gt;    images: "images/**/*.{gif,jpg,png}",&lt;br /&gt;&lt;br /&gt;    // The scripts we want Gulp to process&lt;br /&gt;    scripts: [&lt;br /&gt;        // Bootstrapping&lt;br /&gt;        app + "app" + tsjsmapjsSuffix,&lt;br /&gt;        app + "config.route" + tsjsmapjsSuffix,&lt;br /&gt;&lt;br /&gt;        // common Modules&lt;br /&gt;        app + "common/common" + tsjsmapjsSuffix,&lt;br /&gt;        app + "common/logger" + tsjsmapjsSuffix,&lt;br /&gt;        app + "common/spinner" + tsjsmapjsSuffix,&lt;br /&gt;&lt;br /&gt;        // common.bootstrap Modules&lt;br /&gt;        app + "common/bootstrap/bootstrap.dialog" + tsjsmapjsSuffix,&lt;br /&gt;&lt;br /&gt;        // directives&lt;br /&gt;        app + "directives/**/*" + tsjsmapjsSuffix,&lt;br /&gt;&lt;br /&gt;        // services&lt;br /&gt;        app + "services/**/*" + tsjsmapjsSuffix,&lt;br /&gt;&lt;br /&gt;        // controllers&lt;br /&gt;        app + "about/**/*" + tsjsmapjsSuffix,&lt;br /&gt;        app + "admin/**/*" + tsjsmapjsSuffix,&lt;br /&gt;        app + "dashboard/**/*" + tsjsmapjsSuffix,&lt;br /&gt;        app + "layout/**/*" + tsjsmapjsSuffix,&lt;br /&gt;        app + "sages/**/*" + tsjsmapjsSuffix,&lt;br /&gt;        app + "sayings/**/*" + tsjsmapjsSuffix&lt;br /&gt;    ],&lt;br /&gt;&lt;br /&gt;    // The styles we want Gulp to process&lt;br /&gt;    styles: [&lt;br /&gt;        "content/styles.css"&lt;br /&gt;    ],&lt;br /&gt;&lt;br /&gt;    wiredepOptions: {&lt;br /&gt;        exclude: [/jquery/],&lt;br /&gt;        ignorePath: ".."&lt;br /&gt;    }&lt;br /&gt;};&lt;br /&gt;&lt;br /&gt;config.debugFolder = config.buildDir + config.debug + "/";&lt;br /&gt;config.releaseFolder = config.buildDir + config.release + "/";&lt;br /&gt;&lt;br /&gt;config.templateFiles = [&lt;br /&gt;    app + "**/*.html",&lt;br /&gt;    "!" + config.bootFile // Exclude the launch page&lt;br /&gt;];&lt;br /&gt;&lt;br /&gt;module.exports = config;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Now to the meat of the matter - let me present the gulpfile:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;/// &amp;lt;vs AfterBuild='default' /&amp;gt;&lt;br /&gt;var gulp = require("gulp");&lt;br /&gt;&lt;br /&gt;// Include Our Plugins&lt;br /&gt;var concat = require("gulp-concat");&lt;br /&gt;var ignore = require("gulp-ignore");&lt;br /&gt;var minifyCss = require("gulp-minify-css");&lt;br /&gt;var uglify = require("gulp-uglify");&lt;br /&gt;var rev = require("gulp-rev");&lt;br /&gt;var del = require("del");&lt;br /&gt;var path = require("path");&lt;br /&gt;var templateCache = require("gulp-angular-templatecache");&lt;br /&gt;var eventStream = require("event-stream");&lt;br /&gt;var order = require("gulp-order");&lt;br /&gt;var gulpUtil = require("gulp-util");&lt;br /&gt;var wiredep = require("wiredep");&lt;br /&gt;var inject = require("gulp-inject");&lt;br /&gt;&lt;br /&gt;// Get our config&lt;br /&gt;var config = require("./gulpfile.config.js");&lt;br /&gt;&lt;br /&gt;/**&lt;br /&gt; * Get the scripts or styles the app requires by combining bower dependencies and app dependencies&lt;br /&gt; * &lt;br /&gt; * @param {string} jsOrCss Should be "js" or "css"&lt;br /&gt; */&lt;br /&gt;function getScriptsOrStyles(jsOrCss) {&lt;br /&gt;&lt;br /&gt;    var bowerScriptsAbsolute = wiredep(config.wiredepOptions)[jsOrCss];&lt;br /&gt;&lt;br /&gt;    var bowerScriptsRelative = bowerScriptsAbsolute.map(function makePathRelativeToCwd(file) {&lt;br /&gt;        return path.relative('', file); &lt;br /&gt;    });&lt;br /&gt;&lt;br /&gt;    var appScripts = bowerScriptsRelative.concat(jsOrCss === "js" ? config.scripts : config.styles);&lt;br /&gt;&lt;br /&gt;    return appScripts;&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;/**&lt;br /&gt; * Get the scripts the app requires&lt;br /&gt; */&lt;br /&gt;function getScripts() {&lt;br /&gt;&lt;br /&gt;    return getScriptsOrStyles("js");&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;/**&lt;br /&gt; * Get the styles the app requires&lt;br /&gt; */&lt;br /&gt;function getStyles() {&lt;br /&gt;&lt;br /&gt;    return getScriptsOrStyles("css");&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;/**&lt;br /&gt; * Get the scripts and the templates combined streams&lt;br /&gt; * &lt;br /&gt; * @param {boolean} isDebug&lt;br /&gt; */&lt;br /&gt;function getScriptsAndTemplates(isDebug) {&lt;br /&gt;&lt;br /&gt;    var options = isDebug ? { base: config.base } : undefined;&lt;br /&gt;    var appScripts = gulp.src(getScripts(), options);&lt;br /&gt;&lt;br /&gt;    //Get the view templates for $templateCache&lt;br /&gt;    var templates = gulp.src(config.templateFiles)&lt;br /&gt;        .pipe(templateCache({ module: "app", root: "app/" }));&lt;br /&gt;&lt;br /&gt;    var combined = eventStream.merge(appScripts, templates);&lt;br /&gt;&lt;br /&gt;    return combined;&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;gulp.task("clean", function (cb) {&lt;br /&gt;&lt;br /&gt;    gulpUtil.log("Delete the build folder");&lt;br /&gt;&lt;br /&gt;    return del([config.buildDir], cb);&lt;br /&gt;});&lt;br /&gt;&lt;br /&gt;gulp.task("boot-dependencies", ["clean"], function () {&lt;br /&gt;&lt;br /&gt;    gulpUtil.log("Get dependencies needed for boot (jQuery and images)");&lt;br /&gt;&lt;br /&gt;    var jQuery = gulp.src(config.bootjQuery);&lt;br /&gt;    var images = gulp.src(config.images, { base: config.base });&lt;br /&gt;&lt;br /&gt;    var combined = eventStream.merge(jQuery, images)&lt;br /&gt;        .pipe(gulp.dest(config.buildDir));&lt;br /&gt;&lt;br /&gt;    return combined;&lt;br /&gt;});&lt;br /&gt;&lt;br /&gt;gulp.task("inject-debug", ["styles-debug", "scripts-debug"], function () {&lt;br /&gt;&lt;br /&gt;    gulpUtil.log("Inject debug links and script tags into " + config.bootFile);&lt;br /&gt;&lt;br /&gt;    var scriptsAndStyles = [].concat(getScripts(), getStyles());&lt;br /&gt;&lt;br /&gt;    return gulp&lt;br /&gt;        .src(config.bootFile)&lt;br /&gt;        .pipe(inject(&lt;br /&gt;                gulp.src([&lt;br /&gt;                        config.debugFolder + "**/*.{js,css}",&lt;br /&gt;                        "!build\\debug\\bower_components\\spin.js" // Exclude weird spin js path&lt;br /&gt;                    ], { read: false })&lt;br /&gt;                    .pipe(order(scriptsAndStyles))&lt;br /&gt;            ))&lt;br /&gt;        .pipe(gulp.dest(config.buildDir));&lt;br /&gt;});&lt;br /&gt;&lt;br /&gt;gulp.task("inject-release", ["styles-release", "scripts-release"], function () {&lt;br /&gt;&lt;br /&gt;    gulpUtil.log("Inject release links and script tags into " + config.bootFile);&lt;br /&gt;&lt;br /&gt;    return gulp&lt;br /&gt;        .src(config.bootFile)&lt;br /&gt;        .pipe(inject(gulp.src(config.releaseFolder + "**/*.{js,css}", { read: false })))&lt;br /&gt;        .pipe(gulp.dest(config.buildDir));&lt;br /&gt;});&lt;br /&gt;&lt;br /&gt;gulp.task("scripts-debug", ["clean"], function () {&lt;br /&gt;&lt;br /&gt;    gulpUtil.log("Copy across all JavaScript files to build/debug");&lt;br /&gt;&lt;br /&gt;    return getScriptsAndTemplates(true)&lt;br /&gt;        .pipe(gulp.dest(config.debugFolder));&lt;br /&gt;});&lt;br /&gt;&lt;br /&gt;gulp.task("scripts-release", ["clean"], function () {&lt;br /&gt;&lt;br /&gt;    gulpUtil.log("Concatenate &amp; Minify JS for release into a single file");&lt;br /&gt;&lt;br /&gt;    return getScriptsAndTemplates(false)&lt;br /&gt;        .pipe(ignore.exclude("**/*.{ts,js.map}")) // Exclude ts and js.map files - not needed in release mode&lt;br /&gt;        .pipe(concat("app.js"))                   // Make a single file                                                         &lt;br /&gt;        .pipe(uglify())                           // Make the file titchy tiny small&lt;br /&gt;        .pipe(rev())                              // Suffix a version number to it&lt;br /&gt;        .pipe(gulp.dest(config.releaseFolder));   // Write single versioned file to build/release folder&lt;br /&gt;});&lt;br /&gt;&lt;br /&gt;gulp.task("styles-debug", ["clean"], function () {&lt;br /&gt;&lt;br /&gt;    gulpUtil.log("Copy across all CSS files to build/debug");&lt;br /&gt;&lt;br /&gt;    return gulp&lt;br /&gt;        .src(getStyles(), { base: config.base })&lt;br /&gt;        .pipe(gulp.dest(config.debugFolder));&lt;br /&gt;});&lt;br /&gt;&lt;br /&gt;gulp.task("styles-release", ["clean"], function () {&lt;br /&gt;&lt;br /&gt;    gulpUtil.log("Copy across all files in config.styles to build/debug");&lt;br /&gt;&lt;br /&gt;    return gulp&lt;br /&gt;        .src(getStyles())&lt;br /&gt;        .pipe(concat("app.css"))                                   // Make a single file&lt;br /&gt;        .pipe(minifyCss())                                         // Make the file titchy tiny small&lt;br /&gt;        .pipe(rev())                                               // Suffix a version number to it&lt;br /&gt;        .pipe(gulp.dest(config.releaseFolder + "/" + config.css)); // Write single versioned file to build/release folder&lt;br /&gt;});&lt;br /&gt;&lt;br /&gt;gulp.task("fonts-debug", ["clean"], function () {&lt;br /&gt;&lt;br /&gt;    gulpUtil.log("Copy across all fonts in config.fonts to debug location");&lt;br /&gt;&lt;br /&gt;    return gulp&lt;br /&gt;        .src(config.fonts, { base: config.base })&lt;br /&gt;        .pipe(gulp.dest(config.debugFolder));&lt;br /&gt;});&lt;br /&gt;&lt;br /&gt;gulp.task("fonts-release", ["clean"], function () {&lt;br /&gt;&lt;br /&gt;    gulpUtil.log("Copy across all fonts in config.fonts to release location");&lt;br /&gt;&lt;br /&gt;    return gulp&lt;br /&gt;        .src(config.fonts)&lt;br /&gt;        .pipe(gulp.dest(config.releaseFolder + "/fonts"));&lt;br /&gt;});&lt;br /&gt;&lt;br /&gt;gulp.task("build-debug", [&lt;br /&gt;    "boot-dependencies", "inject-debug", "fonts-debug"&lt;br /&gt;]);&lt;br /&gt;&lt;br /&gt;gulp.task("build-release", [&lt;br /&gt;    "boot-dependencies", "inject-release", "fonts-release"&lt;br /&gt;]);&lt;br /&gt;&lt;br /&gt;// Use the web.config to determine whether the default task should create a debug or a release build&lt;br /&gt;// If the web.config contains this: '&amp;lt;compilation debug="true"' then we do a default build, otherwise&lt;br /&gt;// we do a release build.  It's a little hacky but generally works&lt;br /&gt;var fs = require('fs');&lt;br /&gt;var data = fs.readFileSync(__dirname + "/web.config", "UTF-8");&lt;br /&gt;var inDebug = !!data.match(/&amp;lt;compilation debug="true"/); &lt;br /&gt;&lt;br /&gt;gulp.task("default", [(inDebug ? "build-debug" : "build-release")]);&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;That's a big old lump of code.  So let's go through this a task by task...&lt;/p&gt;  &lt;h5&gt;clean&lt;/h5&gt; &lt;p&gt;Deletes the &lt;code&gt;build&lt;/code&gt; folder so we have a clean slate to build into.&lt;/p&gt; &lt;h5&gt;boot-dependencies&lt;/h5&gt; &lt;p&gt;Copy across all files that are needed to allow the page to "boot" / startup.  At present this is only jQuery and images.&lt;/p&gt; &lt;h5&gt;inject-debug and inject-release&lt;/h5&gt; &lt;p&gt;This is the magic. This picks up the launch page (&lt;code&gt;index.html&lt;/code&gt;), takes the JavaScript and CSS and injects the corresponding &lt;code&gt;script&lt;/code&gt; and &lt;code&gt;link&lt;/code&gt; tags into the page and writing it to the &lt;code&gt;build&lt;/code&gt; folder.  Either the original source code or the bundled / minified equivalent will be used depending on whether it's debug or release.&lt;/p&gt; &lt;h5&gt;scripts-debug and scripts-release&lt;/h5&gt; &lt;p&gt;Here we collect up the following:&lt;/p&gt; &lt;ul&gt;&lt;li&gt;the Bower specified JavaScript files&lt;/li&gt;&lt;li&gt;the TypeScript + associated JavaScript files&lt;/li&gt;&lt;li&gt;and we use our template files to construct a &lt;code&gt;templates.js&lt;/code&gt; file to prime the Angular template cache&lt;/li&gt;&lt;/ul&gt; &lt;p&gt;If it's the scripts-debug task we copy all these files into the &lt;code&gt;build/debug&lt;/code&gt; folder. If it's the scripts-release task we also bundle, minify and strip the TypeScript out too and copy into the &lt;code&gt;build/release&lt;/code&gt; folder.&lt;/p&gt; &lt;h5&gt;styles-debug and styles-release&lt;/h5&gt; &lt;p&gt;Here we collect up the following:&lt;/p&gt; &lt;ul&gt;&lt;li&gt;the Bower specified CSS files&lt;/li&gt;&lt;li&gt;our own app CSS&lt;/li&gt;&lt;/ul&gt; &lt;p&gt;If it's the styles-debug task we copy all these files into the &lt;code&gt;build/debug&lt;/code&gt; folder. If it's the styles-release task we also bundle and minify and copy into the &lt;code&gt;build/release&lt;/code&gt; folder.&lt;/p&gt; &lt;h5&gt;fonts-debug and fonts-release&lt;/h5&gt; &lt;p&gt;Whether it's the debug or the release build we copy across the font-awesome assets and place them in a location which works for the associated CSS (as the CSS will depend upon font-awesome).&lt;/p&gt; &lt;h5&gt;build-debug, build-release and default&lt;/h5&gt; &lt;p&gt;build-debug and build-release (as their name suggests) either perform a build for release or a build for debug.  If you remember, the web optimization library in ASP.Net serves up the raw code ("debug" code) if the &lt;code&gt;compilation debug&lt;/code&gt; flag in the &lt;code&gt;web.config&lt;/code&gt; is set to &lt;code&gt;true&lt;/code&gt;.  If it is set to &lt;code&gt;false&lt;/code&gt; then we get the bundled and minified code ("release" code) instead. Our default task tries its best to emulate this behaviour by doing a very blunt regex against the &lt;code&gt;web.config&lt;/code&gt;.  Simply, if it can match &lt;code&gt;&amp;lt;compilation debug="true"&lt;/code&gt; then it runs the debug build.  Otherwise, the release build.  It could be more elegant but there's a dearth of XML readers on npm that support synchronous parsing (which you kinda need for this scenario).&lt;/p&gt; &lt;p&gt;What I intend to do soon is switch from using the web.config to drive the gulp build to using the approach outlined &lt;a href="http://www.codecadwallader.com/2015/03/15/integrating-gulp-into-your-tfs-builds-and-web-deploy/"&gt;here&lt;/a&gt;.  Namely plugging the build directly into Visual Studio's build process and using the type of build there.&lt;/p&gt; &lt;p&gt;Hopefully what I've written here makes it fairly clear how to use Gulp to directly inject scripts and styles directly into your HTML.  If you want to look directly at the source then check out the Proverb.Web folder in &lt;a href="https://github.com/johnnyreilly/proverb-offline"&gt;this repo&lt;/a&gt;.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8595669217015947870'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8595669217015947870'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2015/02/using-gulp-in-asp-net-instead-of-web-optimization.html' title='Using Gulp to inject scripts and styles tags directly into your HTML'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5250825839218820608</id><published>2015-02-11T14:38:00.001Z</published><updated>2021-03-13T14:15:13.546Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Poor Clares'/><category scheme='http://www.blogger.com/atom/ns#' term='Continuous Delivery'/><category scheme='http://www.blogger.com/atom/ns#' term='Arundel'/><category scheme='http://www.blogger.com/atom/ns#' term='AppVeyor'/><title type='text'>The Convent with Continuous Delivery</title><content type='html'>&lt;p&gt;I've done it.  I've open sourced the &lt;a href="http://www.poorclaresarundel.org/"&gt;website that I maintain for my aunt what is a nun&lt;/a&gt;.  Because I think we can all agree that nuns need open source and continuous integration about as much as anyone else.&lt;/p&gt; &lt;p&gt;For a long time now I've been maintaining a website for one of my (many) aunts that is a Poor Clare. (&lt;a href="https://en.wikipedia.org/wiki/Subtyping"&gt;That's a subtype of "nun" you OO enthusiasts.&lt;/a&gt;) It's not a terribly exciting site - it's mostly static content. It's built with a combination of AngularJS / TypeScript / Bootstrap and ASP.Net MVC.  It's hosted on &lt;a href="http://azure.microsoft.com/en-us/documentation/services/websites/"&gt;Azure Websites&lt;/a&gt;.  In fact I have written about it (slightly more cagily) before &lt;a href="https://blog.johnnyreilly.com/2014/06/migrating-from-angularjs-to-angularts.html"&gt;here&lt;/a&gt;.&lt;/p&gt; &lt;p&gt;I'll say up front: presentation-wise the site is not a work of art.  However the nuns seem pretty happy with it. (Or perhaps secretly they're forgiving me the shonkiness and sparing my feelings - who can say?)  If I put my mind to it the site could look much more lovely.  But there's only so much time I can spare - and that's actually one of the reasons I've set up Continuous Delivery.&lt;/p&gt; &lt;h4&gt;Why on earth did you bother?&lt;/h4&gt; &lt;p&gt;Well, you'd be surprised how often tweaks can be requested.  Sometimes it appears to be forgotten for months at a time, and then all of a sudden my inbox is daily filled with a list of minor alterations.  You know, slight text changes and the like.&lt;/p&gt; &lt;p&gt;So what I was generally doing was getting home of an evening, waiting until the children were in bed, chomping down some food and then firing up Visual Studio to make the changes and hit "Publish".  Yes that's right; I was essentially using Visual Studio to edit text files and push a website out to Azure.  The very definition of using a sledgehammer to crack a nut I think we can all agree.&lt;/p&gt; &lt;p&gt;It occurred to me that if I had Continuous Delivery set up then I could make these tweaks and not have to worry about the site being published.  Which would be nice.  I wouldn't need Visual Studio anymore - any text editor would do.  Also nice.  Finally, if the source control was accessible online then I could probably get away with doing most tweaks on my mobile phone whilst I was travelling home.  Timesaver!&lt;/p&gt; &lt;h4&gt;How did you go about it?&lt;/h4&gt; &lt;p&gt;Since &lt;a href="http://www.visualstudioonline.com"&gt;Visual Studio Online (then "Team Foundation Service")&lt;/a&gt; was released I have been using it to host the source code.  So the obvious solution was to use the tools offered there to do the deployment.  However, this wasn't the smooth experience you might have hoped for.  I had quite a frustrating afternoon trying things out before deciding it was becoming more trouble than it was worth.  VSO appeared to make it supremely hard to customise builds.&lt;/p&gt; &lt;p&gt;Just recently though I have been having the most wonderful experience with &lt;a href="http://www.appveyor.com/"&gt;AppVeyor&lt;/a&gt;.  AppVeyor market themselves as &lt;i&gt;"#1 Continuous Delivery service for Windows"&lt;/i&gt; - I think they're right. Their build process is entirely flexible and customisable.  It is, in short, a joy to use. (The support is fantastic too - very helpful indeed.  Go &lt;a href="https://github.com/FeodorFitsner"&gt;Feodor&lt;/a&gt;!)&lt;/p&gt; &lt;p&gt;If you look just below the header you'll read a very important sentence: &lt;em&gt;"Free for open-source projects"&lt;/em&gt;.  You hear that? By the time I'd finished reading that sentence I'd decided that the Poor Clares website was about to become an open source project.&lt;/p&gt; &lt;p&gt;And now it is.&lt;/p&gt; &lt;h4&gt;Where is it?&lt;/h4&gt; &lt;p&gt;The source on &lt;a href="https://github.com/johnnyreilly/poorclaresarundel"&gt;GitHub&lt;/a&gt;. The builds and deployment are taken care of by &lt;a href="https://ci.appveyor.com/project/JohnReilly/poorclaresarundel"&gt;AppVeyor&lt;/a&gt;.&lt;/p&gt; &lt;h4&gt;Will you take pull requests?&lt;/h4&gt; &lt;p&gt;If they're serious, then yes, certainly!  My long term plan is to try and get the nuns set up as collaborators in GitHub.  That way they can make their own minor tweaks without me getting involved.&lt;/p&gt; &lt;p&gt;On another front, I do wonder if open-sourcing Poor Clares, Arundel might have other hidden benefits.  There's a number of things I'm not too keen on in the code.  Up until now I think my attitude was possibly "it works so that's good enough". It was only me aware of the shortcomings.  Now it's public I'll probably have more of an incentive to tidy up the rough edges.  That's the theory anyway - Embarrassment Driven Development anyone? :-)&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5250825839218820608'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5250825839218820608'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2015/02/the-convent-with-continuous-delivery.html' title='The Convent with Continuous Delivery'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1258770417472534670</id><published>2015-01-20T14:42:00.001Z</published><updated>2021-03-04T16:20:50.668Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='TypeScript'/><category scheme='http://www.blogger.com/atom/ns#' term='Option bags'/><category scheme='http://www.blogger.com/atom/ns#' term='Union Types'/><category scheme='http://www.blogger.com/atom/ns#' term='Function syntax'/><title type='text'>TypeScript: In Praise of Union Types</title><content type='html'>&lt;h4&gt;(&amp; How to Express Functions in UTs)&lt;/h4&gt; &lt;p&gt;Have you heard the good news my friend? I refer, of course, to the shipping of TypeScript 1.4 and my &lt;em&gt;favourite&lt;/em&gt; language feature since generics.... Union Types.&lt;/p&gt; &lt;p&gt;In the &lt;a href="http://blogs.msdn.com/b/typescript/archive/2015/01/16/announcing-typescript-1-4.aspx"&gt;1.4 announcement&lt;/a&gt; Jonathan Turner described Union Types thusly:&lt;/p&gt; &lt;blockquote cite="http://blogs.msdn.com/b/typescript/archive/2015/01/16/announcing-typescript-1-4.aspx"&gt;&lt;p&gt;JavaScript functions may take a number of possible argument types. Up to now, weve supported this using function overloads. Starting with TypeScript 1.4, weve generalized this capability and now allow you to specify that that a value is one of a number of different types using a union type:&lt;/p&gt;  &lt;pre class="prettyprint ts"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;function f(x: number | number[]) {&lt;br /&gt;  if (typeof x === "number") {&lt;br /&gt;    return x + 10;&lt;br /&gt;  }&lt;br /&gt;  else {&lt;br /&gt;    // return sum of numbers&lt;br /&gt;  }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Once you have a value of a union type, you can use a typeof and instanceof checks to use the value in a type-safe way. You'll notice we use this in the above example and can treat x as a number type inside of the if-block.&lt;/p&gt; &lt;p&gt;Union types are a new kind of type and work any place you specify a type.&lt;/p&gt;&lt;/blockquote&gt; &lt;p&gt;Lovely right?  But what's missing?  Well, to my mind, the most helpful aspect of Union Types.  Definition file creation.&lt;/p&gt; &lt;h4&gt;A little history&lt;/h4&gt;&lt;h5&gt;That's right - the days before Union Types are now "history" :-)&lt;/h5&gt; &lt;p&gt;When creating definition files (&lt;code&gt;*.d.ts&lt;/code&gt;) in the past there was a problem with TypeScript.  A limitation. JavaScript often relies on "option bags" to pass configuration into a method.  An "option bag" is essentially a JavaScript object literal which contains properties which are used to perform configuration.  A good example of this is the &lt;code&gt;route&lt;/code&gt; parameter passed into Angular's ngRoute &lt;code&gt;&lt;a href="https://docs.angularjs.org/api/ngRoute/provider/$routeProvider#when"&gt;when&lt;/a&gt;&lt;/code&gt; method.&lt;/p&gt;   &lt;p&gt;I'd like to draw your attention to 2 of the properties that can be passed in (quoted from the documentation):&lt;/p&gt; &lt;blockquote cite="https://docs.angularjs.org/api/ngRoute/provider/$routeProvider#when"&gt;&lt;ul&gt;&lt;li&gt;controller  &lt;code&gt;{(string|function()=}&lt;/code&gt;  Controller fn that should be associated with newly created scope or the name of a registered controller if passed as a string.&lt;/li&gt;&lt;li&gt;&lt;p&gt;template  &lt;code&gt;{string=|function()=}&lt;/code&gt;  html template as a string or a function that returns an html template as a string which should be used by ngView or ngInclude directives. This property takes precedence over templateUrl.&lt;/p&gt; &lt;p&gt;If template is a function, it will be called with the following parameters:&lt;/p&gt; &lt;p&gt;&lt;code&gt;{Array.&amp;lt;Object&amp;gt;}&lt;/code&gt; - route parameters extracted from the current $location.path() by applying the current route&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/blockquote&gt; &lt;p&gt;Both of these properties can be of more than 1 type.&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;code&gt;controller&lt;/code&gt; can be a &lt;code&gt;string&lt;/code&gt; &lt;em&gt;or&lt;/em&gt; a &lt;code&gt;function&lt;/code&gt;.&lt;/li&gt;&lt;li&gt;&lt;code&gt;template&lt;/code&gt; can be a &lt;code&gt;string&lt;/code&gt; &lt;em&gt;or&lt;/em&gt; a &lt;code&gt;function&lt;/code&gt; that returns a &lt;code&gt;string&lt;/code&gt; and has &lt;code&gt;$routeParams&lt;/code&gt; as a parameter.&lt;/li&gt;&lt;/ul&gt; &lt;p&gt;There's the rub.  Whilst it was possible to overload functions in TypeScript pre 1.4, it was &lt;u&gt;not&lt;/u&gt; possible to overload interface members. This meant the only way to model these sorts of properties was by seeking out a best common type which would fit all scenarios.  This invariably meant using the &lt;code&gt;any&lt;/code&gt; type.  Whilst that worked it didn't lend any consuming code a great deal of type safety.  Let's look at a truncated version of &lt;code&gt;&lt;a href="https://github.com/borisyankov/DefinitelyTyped/blob/c71628e0765eb8e240d8eabd2225f64ea2e2fdb8/angularjs/angular-route.d.ts"&gt;angular-route.d.ts&lt;/a&gt;&lt;/code&gt; for these properties prior to union types:&lt;/p&gt; &lt;pre class="prettyprint ts"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;declare module ng.route {&lt;br /&gt;&lt;br /&gt;  // ... &lt;br /&gt; &lt;br /&gt;  interface IRoute {&lt;br /&gt; &lt;br /&gt;    /**&lt;br /&gt;     * {(string|function()=}&lt;br /&gt;     * Controller fn that should be associated with newly created scope or &lt;br /&gt;     * the name of a registered controller if passed as a string.&lt;br /&gt;     */&lt;br /&gt;    controller?: any;&lt;br /&gt;&lt;br /&gt;    /**&lt;br /&gt;     * {string=|function()=}&lt;br /&gt;     * Html template as a string or a function that returns an html template &lt;br /&gt;     * as a string which should be used by ngView or ngInclude directives. This &lt;br /&gt;     * property takes precedence over templateUrl.&lt;br /&gt;     * &lt;br /&gt;     * If template is a function, it will be called with the following parameters:&lt;br /&gt;     * &lt;br /&gt;     * {Array.&amp;lt;Object&amp;gt;} - route parameters extracted from the current &lt;br /&gt;     * $location.path() by applying the current route&lt;br /&gt;     */&lt;br /&gt;    template?: any;&lt;br /&gt;&lt;br /&gt;    // ... &lt;br /&gt;  }&lt;br /&gt; &lt;br /&gt;  // ... &lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;It's &lt;code&gt;any&lt;/code&gt; city... Kind of sticks in the craw doesn't it?&lt;/p&gt; &lt;h4&gt;A new dawn&lt;/h4&gt; &lt;p&gt;TypeScript 1.4 has shipped and Union Types are with us.  We can do better than &lt;code&gt;any&lt;/code&gt;.  So what does &lt;code&gt;&lt;a href="https://github.com/borisyankov/DefinitelyTyped/blob/30ce45e0e706322f34608ab6fa5de141bba59c90/angularjs/angular-route.d.ts"&gt;angular-route.d.ts&lt;/a&gt;&lt;/code&gt; look like now we have Union Types?&lt;/p&gt; &lt;pre class="prettyprint ts"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;declare module ng.route {&lt;br /&gt;&lt;br /&gt;  // ... &lt;br /&gt; &lt;br /&gt;  interface IRoute {&lt;br /&gt; &lt;br /&gt;    /**&lt;br /&gt;     * {(string|function()=}&lt;br /&gt;     * Controller fn that should be associated with newly created scope or &lt;br /&gt;     * the name of a registered controller if passed as a string.&lt;br /&gt;     */&lt;br /&gt;    controller?: string|Function;&lt;br /&gt;&lt;br /&gt;    /**&lt;br /&gt;     * {string=|function()=}&lt;br /&gt;     * Html template as a string or a function that returns an html template &lt;br /&gt;     * as a string which should be used by ngView or ngInclude directives. This &lt;br /&gt;     * property takes precedence over templateUrl.&lt;br /&gt;     * &lt;br /&gt;     * If template is a function, it will be called with the following parameters:&lt;br /&gt;     * &lt;br /&gt;     * {Array.&amp;lt;Object&amp;gt;} - route parameters extracted from the current &lt;br /&gt;     * $location.path() by applying the current route&lt;br /&gt;     */&lt;br /&gt;    template?: string | { ($routeParams?: ng.route.IRouteParamsService) : string; }&lt;br /&gt;&lt;br /&gt;    // ... &lt;br /&gt;  }&lt;br /&gt; &lt;br /&gt;  // ... &lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;With these changes in place we are now accurately modelling the &lt;code&gt;route&lt;/code&gt; option bags in TypeScript. Hoorah!!!&lt;/p&gt; &lt;p&gt;Let's dig in a little.  If you look at the &lt;code&gt;controller&lt;/code&gt; definition it's pretty straightforward. &lt;code&gt;string|Function&lt;/code&gt; - clearly the &lt;code&gt;controller&lt;/code&gt; can be a &lt;code&gt;string&lt;/code&gt; &lt;em&gt;or&lt;/em&gt; a &lt;code&gt;Function&lt;/code&gt;.  Simple.&lt;/p&gt; &lt;p&gt;Now let's look at the &lt;code&gt;template&lt;/code&gt; definition by itself:&lt;/p&gt; &lt;pre class="prettyprint ts"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;    template?: string | { ($routeParams?: ng.route.IRouteParamsService) : string; }&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;As with the &lt;code&gt;controller&lt;/code&gt; the &lt;code&gt;template&lt;/code&gt; can be a string - that is pretty clear.  But what's that hovering on the other side of the "|"?  What could &lt;code&gt;{ ($routeParams?: ng.route.IRouteParamsService) : string; }&lt;/code&gt; be exactly?&lt;/p&gt; &lt;p&gt;Well, in a word, it's a &lt;code&gt;Function&lt;/code&gt;.  The &lt;code&gt;controller&lt;/code&gt; would allow any kind of function at all. However the &lt;code&gt;template&lt;/code&gt; definition is deliberately more restrictive. This defines a function which must return a &lt;code&gt;string&lt;/code&gt; and which receives an optional parameter of &lt;code&gt;$routeParams&lt;/code&gt; of type &lt;code&gt;ng.route.IRouteParamsService&lt;/code&gt;.&lt;/p&gt; &lt;h4&gt;State of the Union&lt;/h4&gt; &lt;p&gt;Hopefully you can now see just how useful Union Types are and how you can express specific sorts of function definitions as part of a Union Type.&lt;/p&gt; &lt;p&gt;The thing that prompted me first to write this post was seeing that there don't appear to be any examples out there of how to express functions inside Union Types.  I only landed on the syntax myself after a little experimentation in Visual Studio after I'd installed TS 1.4.  I've started work on bringing Union Types to the typings inside &lt;a href="https://github.com/borisyankov/DefinitelyTyped"&gt;DefinitelyTyped&lt;/a&gt; and so you'll start to see them appearing more and more. But since it's rather "hidden knowledge" at present I wanted to do my bit to make it a little better known.&lt;/p&gt; &lt;p&gt;As &lt;a href="https://twitter.com/Rickenhacker"&gt;Daniel&lt;/a&gt; helpfully points out in the comments there is an alternate syntax - lambda style.  So instead of this:&lt;/p&gt; &lt;pre class="prettyprint ts"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;    template?: string | { ($routeParams?: ng.route.IRouteParamsService) : string; }&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;You could write this:&lt;/p&gt; &lt;pre class="prettyprint ts"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;    template?: string | (($routeParams?: ng.route.IRouteParamsService) =&gt; string);&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Just remember to place parentheses around the lambda to clearly delineate it.&lt;/p&gt; &lt;h4&gt;Bonfire of the Overloads&lt;/h4&gt; &lt;p&gt;Before I sign off I should mention the ability Union Types give you to define a much terser definition file.  Basically the "|" operator makes for a bonfire of the overloads.  Where you previously may have had 6 overloads for the same method (each with identical JSDoc) you now only need 1.  Which is beautiful (and DRY).&lt;/p&gt; &lt;p&gt;It's surprising just what a difference it makes. This is &lt;code&gt;&lt;a href="https://github.com/borisyankov/DefinitelyTyped/blob/9bd7fe69d98337db56144c3da131d413f5b7e895/jquery/jquery.d.ts"&gt;jQuery.d.ts&lt;/a&gt;&lt;/code&gt; last week (pre TypeScript 1.4). This is &lt;code&gt;&lt;a href="https://github.com/borisyankov/DefinitelyTyped/blob/9f64372a065541fe2b8f6c5c5cd9b55a1d631f19/jquery/jquery.d.ts"&gt;jQuery.d.ts&lt;/a&gt;&lt;/code&gt; now - with Union Types aplenty.  Last week it was ~4000 lines of code.  This week it's ~3200 lines of code.  With the same functionality. Union Types are &lt;em&gt;FANTASTIC&lt;/em&gt;!&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1258770417472534670'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1258770417472534670'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2015/01/typescript-using-functions-with-union-types.html' title='TypeScript: In Praise of Union Types'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3921256843887336017</id><published>2015-01-07T12:17:00.002Z</published><updated>2021-03-13T14:14:22.326Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='GitHub Personal Access Token'/><category scheme='http://www.blogger.com/atom/ns#' term='Continuous Integration'/><category scheme='http://www.blogger.com/atom/ns#' term='powershell'/><category scheme='http://www.blogger.com/atom/ns#' term='github pages'/><category scheme='http://www.blogger.com/atom/ns#' term='AppVeyor'/><title type='text'>Deploying from ASP.Net MVC to GitHub Pages using AppVeyor part 2</title><content type='html'>&lt;p&gt;"Automation, automation, automation." Those were and are Tony Blair's priorities for keeping open source projects well maintained.&lt;/p&gt; &lt;p&gt;OK, that's not quite true... But what is certainly true is that maintaining an open source project takes time.  And there's only so much free time that anyone has.  For that reason, wherever you can it makes sense to &lt;em&gt;AUTOMATE&lt;/em&gt;!&lt;/p&gt; &lt;p&gt;&lt;a href="https://blog.johnnyreilly.com/2014/12/deploying-aspnet-mvc-to-github-pages-with-appveyor-part-1.html"&gt;Last time&lt;/a&gt; we looked at how you can take an essentially static ASP.Net MVC site (in this case my jVUNDemo documentation site) and generate an entirely static version using Wget.  This static site has been pushed to &lt;a href="https://pages.github.com/"&gt;GitHub Pages&lt;/a&gt; and is serving as the documentation for &lt;a href="http://johnnyreilly.github.io/jQuery.Validation.Unobtrusive.Native/"&gt;jQuery Validation Unobtrusive Native&lt;/a&gt; (and for bonus points is costing me no money at all).&lt;/p&gt; &lt;p&gt;So what next?  Well, automation clearly!  If I make a change to jQuery Validation Unobtrusive Native then AppVeyor already bounds in and performs a &lt;a href="https://ci.appveyor.com/project/JohnReilly/jquery-validation-unobtrusive-native"&gt;continuous integration build&lt;/a&gt; for me.  It picks up the &lt;a href="https://github.com/johnnyreilly/jQuery.Validation.Unobtrusive.Native"&gt;latest source&lt;/a&gt; from GitHub, pulls in my dependencies, performs a build and runs my tests.  Lovely.&lt;/p&gt; &lt;p&gt;So the obvious thing to do is to take this process and plug in the generation of my static site and the publication thereof to GitHub pages.  The minute a change is made to my project the documentation should be updated without me having to break sweat.  That's the goal.&lt;/p&gt; &lt;h4&gt;GitHub Personal Access Token&lt;/h4&gt; &lt;p&gt;In order to complete our chosen mission we're going to need a GitHub Personal Access Token.  We're going to use it when we clone, update and push our GitHub Pages branch.  To get one we biff over to Settings / Applications in GitHub and click the "Generate New Token" button.&lt;/p&gt; &lt;a href="http://1.bp.blogspot.com/-TN1tTkL_eoQ/VKwQfPn8_JI/AAAAAAAAAyI/EeF6XLcP8dg/s1600/GitHubApplicationSettings.png" imageanchor="1" &gt;&lt;img border="0" src="http://1.bp.blogspot.com/-TN1tTkL_eoQ/VKwQfPn8_JI/AAAAAAAAAyI/EeF6XLcP8dg/s640/GitHubApplicationSettings.png" /&gt;&lt;/a&gt; &lt;p&gt;The token I'm using for my project has the following scopes selected:&lt;/p&gt; &lt;a href="http://2.bp.blogspot.com/-2hsSnmHy_DY/VKwQo7MM0BI/AAAAAAAAAyQ/c5ZAT_mZi5w/s1600/GitHub%2BPersonal%2BAccess%2BToken.png" imageanchor="1" &gt;&lt;img border="0" src="http://2.bp.blogspot.com/-2hsSnmHy_DY/VKwQo7MM0BI/AAAAAAAAAyQ/c5ZAT_mZi5w/s640/GitHub%2BPersonal%2BAccess%2BToken.png" /&gt;&lt;/a&gt; &lt;h4&gt;&lt;code&gt;appveyor.yml&lt;/code&gt;&lt;/h4&gt; &lt;p&gt;With our token in hand we turn our attention to AppVeyor build configuration.  This is possible using a file called &lt;a href="http://www.appveyor.com/docs/build-configuration"&gt;&lt;code&gt;appveyor.yml&lt;/code&gt;&lt;/a&gt; stored in the root of your repo.  You can also use the AppVeyor web UI to do this.  However, for the purposes of ease of demonstration I'm using the file approach.  The &lt;a href="https://github.com/johnnyreilly/jQuery.Validation.Unobtrusive.Native/blob/master/appveyor.yml"&gt;jQuery Validation Unobtrusive Native &lt;code&gt;appveyor.yml&lt;/code&gt;&lt;/a&gt; looks like this:&lt;/p&gt; &lt;pre class="prettyprint yml"&gt;&lt;br /&gt;&lt;code class="language-yml"&gt;&lt;br /&gt;#---------------------------------#&lt;br /&gt;#      general configuration      #&lt;br /&gt;#---------------------------------#&lt;br /&gt;&lt;br /&gt;# version format&lt;br /&gt;version: 1.0.{build}&lt;br /&gt;&lt;br /&gt;#---------------------------------#&lt;br /&gt;#    environment configuration    #&lt;br /&gt;#---------------------------------#&lt;br /&gt;&lt;br /&gt;# environment variables&lt;br /&gt;environment:&lt;br /&gt;  GithubEmail: johnny_reilly@hotmail.com&lt;br /&gt;  GithubUsername: johnnyreilly&lt;br /&gt;  GithubPersonalAccessToken:&lt;br /&gt;    secure: T4M/N+e/baksVoeWoYKPWIpfahOsiSFw/+Zc81VuThZmWEqmrRtgEHUyin0vCWhl    &lt;br /&gt;&lt;br /&gt;branches:&lt;br /&gt;  only:&lt;br /&gt;    - master&lt;br /&gt;&lt;br /&gt;install:&lt;br /&gt;- ps: choco install wget&lt;br /&gt;&lt;br /&gt;build:&lt;br /&gt;  verbosity: minimal&lt;br /&gt;&lt;br /&gt;after_test:&lt;br /&gt;- ps: ./makeStatic.ps1 $env:APPVEYOR_BUILD_FOLDER&lt;br /&gt;- ps: ./pushStatic.ps1 $env:APPVEYOR_BUILD_FOLDER $env:GithubEmail $env:GithubUsername $env:GithubPersonalAccessToken&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;There's a number of things you should notice from the yml file:&lt;/p&gt; &lt;ul&gt;&lt;li&gt;We create 3 environment variables: GithubEmail, GithubUsername and GithubPersonalAccessToken (more on this in a moment).&lt;/li&gt;&lt;li&gt;We only build the master branch.&lt;/li&gt;&lt;li&gt;We use &lt;a href="https://chocolatey.org/packages/Wget"&gt;Chocolatey&lt;/a&gt; to install Wget which is used by the &lt;code&gt;makeStatic.ps1&lt;/code&gt; Powershell script.&lt;/li&gt;&lt;li&gt;After the tests have completed we run 2 Powershell scripts.  First &lt;code&gt;&lt;a href="https://github.com/johnnyreilly/jQuery.Validation.Unobtrusive.Native/blob/master/makeStatic.ps1"&gt;makeStatic.ps1&lt;/a&gt;&lt;/code&gt; which builds the static version of our site.  This is the exact same script we discussed in the previous post - we're just passing it the build folder this time (one of AppVeyor's environment variables).  Second, we run &lt;code&gt;&lt;a href="https://github.com/johnnyreilly/jQuery.Validation.Unobtrusive.Native/blob/master/pushStatic.ps1"&gt;pushStatic.ps1&lt;/a&gt;&lt;/code&gt; which publishes the static site to GitHub Pages.&lt;/li&gt;&lt;/ul&gt; &lt;p&gt;We pass 4 arguments to &lt;code&gt;pushStatic.ps1&lt;/code&gt;: the build folder, my email address, my username and my personal access token.  For the sake of security the GithubPersonalAccessToken has been encrypted as indicated by the &lt;code&gt;secure&lt;/code&gt; keyword.  This is a capability available in AppVeyor &lt;a href="https://ci.appveyor.com/tools/encrypt"&gt;here&lt;/a&gt;.  &lt;/p&gt; &lt;a href="http://1.bp.blogspot.com/-rQcNQPu2ass/VKwRC0QbQTI/AAAAAAAAAyY/8a8Qf5DGapA/s1600/AppVeyor%2Bencrypt.png" imageanchor="1" &gt;&lt;img border="0" src="http://1.bp.blogspot.com/-rQcNQPu2ass/VKwRC0QbQTI/AAAAAAAAAyY/8a8Qf5DGapA/s640/AppVeyor%2Bencrypt.png" /&gt;&lt;/a&gt; &lt;p&gt;This allows me to mask my personal access token rather than have it available as free text for anyone to grab.&lt;/p&gt; &lt;h4&gt;&lt;code&gt;pushStatic.ps1&lt;/code&gt;&lt;/h4&gt; &lt;p&gt;Finally we can turn our attention to how our Powershell script &lt;code&gt;pushStatic.ps1&lt;/code&gt; goes about pushing our changes up to GitHub Pages:&lt;/p&gt; &lt;pre class="prettyprint ps"&gt;&lt;br /&gt;&lt;code class="language-ps"&gt;&lt;br /&gt;param([string]$buildFolder, [string]$email, [string]$username, [string]$personalAccessToken)&lt;br /&gt;&lt;br /&gt;Write-Host "- Set config settings...."&lt;br /&gt;git config --global user.email $email&lt;br /&gt;git config --global user.name $username&lt;br /&gt;git config --global push.default matching&lt;br /&gt;&lt;br /&gt;Write-Host "- Clone gh-pages branch...."&lt;br /&gt;cd "$($buildFolder)\..\"&lt;br /&gt;mkdir gh-pages&lt;br /&gt;git clone --quiet --branch=gh-pages https://$($username):$($personalAccessToken)@github.com/johnnyreilly/jQuery.Validation.Unobtrusive.Native.git .\gh-pages\&lt;br /&gt;cd gh-pages&lt;br /&gt;git status&lt;br /&gt;&lt;br /&gt;Write-Host "- Clean gh-pages folder...."&lt;br /&gt;Get-ChildItem -Attributes !r | Remove-Item -Recurse -Force&lt;br /&gt;&lt;br /&gt;Write-Host "- Copy contents of static-site folder into gh-pages folder...."&lt;br /&gt;copy-item -path ..\static-site\* -Destination $pwd.Path -Recurse&lt;br /&gt;&lt;br /&gt;git status&lt;br /&gt;$thereAreChanges = git status | select-string -pattern "Changes not staged for commit:","Untracked files:" -simplematch&lt;br /&gt;if ($thereAreChanges -ne $null) { &lt;br /&gt;    Write-host "- Committing changes to documentation..."&lt;br /&gt;    git add --all&lt;br /&gt;    git status&lt;br /&gt;    git commit -m "skip ci - static site regeneration"&lt;br /&gt;    git status&lt;br /&gt;    Write-Host "- Push it...."&lt;br /&gt;    git push --quiet&lt;br /&gt;    Write-Host "- Pushed it good!"&lt;br /&gt;} &lt;br /&gt;else { &lt;br /&gt;    write-host "- No changes to documentation to commit"&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;So what's happening here? Let's break it down:&lt;/p&gt; &lt;ul&gt;&lt;li&gt;Git is configured with the passed in username and email address.&lt;/li&gt;&lt;li&gt;A folder is created that sits alongside the build folder called "gh-pages".&lt;/li&gt;&lt;li&gt;We clone the "gh-pages" branch of jQuery Validation Unobtrusive Native into our "gh-pages" directory.  You'll notice that we are using our GitHub personal access token in the clone URL itself.&lt;/li&gt;&lt;li&gt;We delete the contents of the "gh-pages" directory leaving it empty.&lt;/li&gt;&lt;li&gt;We copy across the contents of the "static-site" folder (created by &lt;code&gt;makeStatic.ps1&lt;/code&gt;) into the "gh-pages".&lt;/li&gt;&lt;li&gt;We use &lt;code&gt;git status&lt;/code&gt; to check if there are any changes. (This method is completely effective but a little crude to my mind - there's probably better approaches to this.... shout me in the comments if you have a suggestion.)&lt;/li&gt;&lt;li&gt;If we have no changes then we do nothing.&lt;/li&gt;&lt;li&gt;If we have changes then we stage them, commit them and push them to GitHub Pages.  Then we sign off with an allusion to &lt;a href="https://en.wikipedia.org/wiki/Push_It_(Salt-n-Pepa_song)"&gt;80's East Coast hip-hop&lt;/a&gt;... 'Cos that's how we roll.&lt;/li&gt;&lt;/ul&gt; &lt;p&gt;With this in place, any changes to the docs will be automatically published out to our "gh-pages" branch.  Our documentation will always be up to date thanks to the goodness of AppVeyor's Continuous Integration service.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3921256843887336017'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3921256843887336017'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2015/01/deploying-aspnet-mvc-to-github-pages-with-appveyor-part-2.html' title='Deploying from ASP.Net MVC to GitHub Pages using AppVeyor part 2'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='http://1.bp.blogspot.com/-TN1tTkL_eoQ/VKwQfPn8_JI/AAAAAAAAAyI/EeF6XLcP8dg/s72-c/GitHubApplicationSettings.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-7789126370484854671</id><published>2014-12-29T08:01:00.002Z</published><updated>2021-03-13T14:13:38.480Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='wget'/><category scheme='http://www.blogger.com/atom/ns#' term='powershell'/><category scheme='http://www.blogger.com/atom/ns#' term='github pages'/><category scheme='http://www.blogger.com/atom/ns#' term='AppVeyor'/><title type='text'>Deploying from ASP.Net MVC to GitHub Pages using AppVeyor part 1</title><content type='html'>&lt;p&gt;There's a small open source project I'm responsible for called &lt;a href="https://github.com/johnnyreilly/jQuery.Validation.Unobtrusive.Native"&gt;jQuery Validation Unobtrusive Native&lt;/a&gt;. (A catchy name is a must for any good open source project. Alas I'm not quite meeting my own exacting standards on this particular point...  I should have gone with my gut and called it "Livingstone" instead. Too late now...)&lt;/p&gt;   &lt;p&gt;The project itself is fairly simple in purpose.  It's essentially a bridge between ASP.Net MVC's inbuilt support for driving validation from data attributes and jQuery Validation's native support for the same. It is, in the end, a collection of ASP.Net MVC HTML helper extensions.  It is not massively complicated.&lt;/p&gt; &lt;p&gt;I believe it was Tony Blair that said "documentation, documentation, documentation" were his priorities for open source projects.  Or maybe it was someone else... Anyway, the point stands.  Documentation is supremely important if you want your project to be in any way useful to anyone other than yourself.  A project, no matter how fantastic, which lacks decent documentation is a missed opportunity.&lt;/p&gt; &lt;p&gt;Anyway I'm happy to say that jQuery Validation Unobtrusive Native &lt;em&gt;has&lt;/em&gt; documentation!  And pretty good documentation at that.  The documentation takes the form of the &lt;a href="https://github.com/johnnyreilly/jQuery.Validation.Unobtrusive.Native/tree/master/jVUNDemo"&gt;jVUNDemo&lt;/a&gt; project which is part of the jQuery Validation Unobtrusive Native repo.  jVUNDemo is an ASP.Net MVC web application which is built on top of the jQuery Validation Unobtrusive Native helpers.  It demonstrates the helpers in action and documents how you might go about using them.  It looks a bit like this:&lt;/p&gt; &lt;a href="http://1.bp.blogspot.com/-5p7fD3Q9dc8/VKDzTV1wYDI/AAAAAAAAAxE/LowxrVAxeXI/s1600/Screenshot%2B2014-12-29%2B06.22.46.png" imageanchor="1" &gt;&lt;img border="0" src="http://1.bp.blogspot.com/-5p7fD3Q9dc8/VKDzTV1wYDI/AAAAAAAAAxE/LowxrVAxeXI/s640/Screenshot%2B2014-12-29%2B06.22.46.png" /&gt;&lt;/a&gt; &lt;p&gt;When I first put jVUNDemo together I hosted it on Azure so the world could see it in all it's finery.  And that worked just fine.  However, there's something you ought to know about me:&lt;/p&gt; &lt;h4&gt;I'm quite cheap&lt;/h4&gt; &lt;p&gt;No really, I am.  My attention was grabbed by the essentially "free" nature of &lt;a href="https://pages.github.com/"&gt;GitHub Pages&lt;/a&gt;.  I was immediately seized by the desire to somehow deploy jVUNDemo to GitHub Pages and roll around joyfully in all that lovely free hosting.&lt;/p&gt; &lt;p&gt;"But", I hear you cry, "you can't deploy an ASP.Net MVC application to Git Hub Pages... It only hosts static sites!"  Quite right.  Sort of. This is where I get to pull my ace of spades: jVUNDemo is not really an "app" so much as a static site. Yup, once the HTML that makes up each page is generated there isn't any app like business to do.  It's just a collection of text and 1 screen demo's really.  &lt;/p&gt; &lt;p&gt;That being the case, there's no reason why I shouldn't be able to make use of GitHub Pages. So that's what I decided to do.  Whilst I was at it I also wanted to automate the deployment process.  When I tweak jVUNDemo I don't want to have to manually push out a new version of jVUNDemo to wherever it's being hosted.  No, I'm a developer so I'll automate it.&lt;/p&gt; &lt;p&gt;I've broken this up into 2 posts.  This first one will cover how you generate a static site from an ASP.Net MVC site.  The second will be about how to use &lt;a href="http://www.appveyor.com/"&gt;AppVeyor&lt;/a&gt; to ensure that on each build your documentation is getting republished.&lt;/p&gt; &lt;h4&gt;You Wget me?&lt;/h4&gt; &lt;p&gt;So, static site generation.  There's a well known Unix utility called &lt;a href="https://en.wikipedia.org/wiki/Wget"&gt;Wget&lt;/a&gt; which covers exactly that ground and so we're going to use it.  It downloads and saves HTML, it recursively walks the links inside the site and grabs those pages too and it converts our routes so they are locally browsable ("Demo/Required" becomes "Demo/Required.html"). &lt;/p&gt; &lt;p&gt;You can use &lt;a href="https://chocolatey.org/packages/Wget"&gt;Chocolatey&lt;/a&gt; to get a copy of Wget.  We're also going to need IIS Express to host jVUNDemo whilst Wget converts it.  Once jVUNDemo has been built successfully you should be be able to kick off the process like so:&lt;/p&gt; &lt;pre class="prettyprint ps"&gt;&lt;br /&gt;&lt;code class="language-ps"&gt;&lt;br /&gt;cd C:\projects\jquery-validation-unobtrusive-native&lt;br /&gt;.\makeStatic.ps1 $pwd.path&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;This invokes the &lt;code&gt;makeStatic&lt;/code&gt; Powershell script in the root of the jQuery Validation Unobtrusive Native repo:&lt;/p&gt; &lt;pre class="prettyprint ps"&gt;&lt;br /&gt;&lt;code class="language-ps"&gt;&lt;br /&gt;param([string]$buildFolder)&lt;br /&gt;&lt;br /&gt;$jVUNDemo = "$($buildFolder)\jVUNDemo"&lt;br /&gt;$staticSiteParentPath = (get-item $buildFolder).Parent.FullName&lt;br /&gt;$staticSite = "static-site"&lt;br /&gt;$staticSitePath = "$($staticSiteParentPath)\$($staticSite)"&lt;br /&gt;$wgetLogPath = "$($staticSiteParentPath)\wget.log"&lt;br /&gt;$port = 57612&lt;br /&gt;$servedAt = "http://localhost:$($port)/"&lt;br /&gt;write-host "jVUNDemo location: $jVUNDemo"&lt;br /&gt;write-host "static site parent location: $staticSiteParentPath"&lt;br /&gt;write-host "static site location: $staticSitePath"&lt;br /&gt;write-host "wget log path: $wgetLogPath"&lt;br /&gt;&lt;br /&gt;write-host "Spin up jVUNDemo site at $($servedAt)"&lt;br /&gt;$process = Start-Process 'C:\Program Files (x86)\IIS Express\iisexpress.exe' -NoNewWindow -ArgumentList "/path:$($jVUNDemo) /port:$($port)"&lt;br /&gt;&lt;br /&gt;write-host "Wait a moment for IIS to startup"&lt;br /&gt;Start-sleep -s 15&lt;br /&gt;&lt;br /&gt;if (Test-Path $staticSitePath) { &lt;br /&gt;    write-host "Removing $($staticSitePath)..."&lt;br /&gt;    Remove-Item -path $staticSitePath -Recurse -Force&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;write-host "Create static version of demo site here: $($staticSitePath)"&lt;br /&gt;Push-Location $staticSiteParentPath&lt;br /&gt;# 2&gt;&amp;1 used to combine stderr and stdout&lt;br /&gt;wget.exe --recursive --convert-links -E --directory-prefix=$staticSite --no-host-directories $servedAt &gt; $wgetLogPath 2&gt;&amp;1&lt;br /&gt;write-host "lastExitCode: $($lastExitCode)"&lt;br /&gt;cat $wgetLogPath&lt;br /&gt;Pop-Location&lt;br /&gt;&lt;br /&gt;write-host "Shut down jVUNDemo site"&lt;br /&gt;stop-process -Name iisexpress&lt;br /&gt;&lt;br /&gt;if (Test-Path $staticSitePath) { &lt;br /&gt;    write-host "Contents of $($staticSitePath)"&lt;br /&gt;    ls $staticSitePath&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;The above Powershell does the following:&lt;/p&gt; &lt;ol&gt;&lt;li&gt;Starts up IIS Express serving jVUNDemo on http://localhost:57612/&lt;/li&gt;&lt;li&gt;Waits 15 seconds for IIS Express to get itself together (probably a shorter wait time would be sufficient)&lt;/li&gt;&lt;li&gt;Points Wget at jVUNDemo and bellows "go!!!!"&lt;/li&gt;&lt;li&gt;Wget downloads and saves the static version of jVUNDemo to a directory called "static-site"&lt;/li&gt;&lt;li&gt;Stops IIS Express&lt;/li&gt;&lt;li&gt;Prints out the contents of the "static-site" directory&lt;/li&gt;&lt;/ol&gt; &lt;p&gt;When run, it pumps something like this out:&lt;/p&gt; &lt;pre class="prettyprint"&gt;&lt;br /&gt;&lt;code class="language"&gt;&lt;br /&gt;jVUNDemo location: C:\projects\jquery-validation-unobtrusive-native\jVUNDemo &lt;br /&gt;static site parent location: C:\projects &lt;br /&gt;static site location: C:\projects\static-site &lt;br /&gt;wget log path: C:\projects\wget.log &lt;br /&gt;Spin up jVUNDemo site at http://localhost:57612/ &lt;br /&gt;Wait a moment for IIS to startup &lt;br /&gt;Create static version of demo site here: C:\projects\static-site &lt;br /&gt;wget.exe : --2014-12-29 07:49:56--  http://localhost:57612/&lt;br /&gt;Resolving localhost... &lt;br /&gt;127.0.0.1&lt;br /&gt;Connecting to localhost|127.0.0.1|:57612... connected.&lt;br /&gt;HTTP request sent, awaiting response... &lt;br /&gt;200 OK&lt;br /&gt;&lt;br /&gt;..... lots of HTTP requests.....&lt;br /&gt;&lt;br /&gt;Downloaded: 30 files, 1.0M in 0.09s (10.8 MB/s)&lt;br /&gt;Converting static-site/Demo/CreditCard.html... 34-0&lt;br /&gt;Converting static-site/Demo/Number.html... 34-0&lt;br /&gt;Converting static-site/Demo/Range.html... 34-0&lt;br /&gt;Converting static-site/Demo/Email.html... 34-0&lt;br /&gt;Converting static-site/AdvancedDemo/CustomValidation.html... 35-0&lt;br /&gt;Converting static-site/Demo/Date.html... 36-0&lt;br /&gt;Converting static-site/Home/License.html... 27-0&lt;br /&gt;Converting static-site/index.html... 29-0&lt;br /&gt;Converting static-site/AdvancedDemo/Dynamic.html... 35-0&lt;br /&gt;Converting static-site/Demo/MaxLengthMinLength.html... 34-0&lt;br /&gt;Converting static-site/Demo/Required.html... 34-0&lt;br /&gt;Converting static-site/AdvancedDemo.html... 32-0&lt;br /&gt;Converting static-site/Demo/Remote.html... 35-0&lt;br /&gt;Converting static-site/Demo/EqualTo.html... 34-0&lt;br /&gt;Converting static-site/AdvancedDemo/Globalize.html... 38-0&lt;br /&gt;Converting static-site/Demo/Url.html... 34-0&lt;br /&gt;Converting static-site/Demo.html... 37-0&lt;br /&gt;Converting static-site/Home/GettingStarted.html... 29-0&lt;br /&gt;Converting static-site/Home/Download.html... 27-0&lt;br /&gt;Converting static-site/AdvancedDemo/Tooltip.html... 34-0&lt;br /&gt;Converted 20 files in 0.03 seconds.&lt;br /&gt; &lt;br /&gt;Shut down jVUNDemo site &lt;br /&gt;Contents of C:\projects\static-site &lt;br /&gt; &lt;br /&gt; &lt;br /&gt;    Directory: C:\projects\static-site&lt;br /&gt; &lt;br /&gt; &lt;br /&gt;Mode                LastWriteTime     Length Name&lt;br /&gt;----                -------------     ------ ----&lt;br /&gt;d----        12/29/2014   7:50 AM            AdvancedDemo&lt;br /&gt;d----        12/29/2014   7:50 AM            Content&lt;br /&gt;d----        12/29/2014   7:50 AM            Demo&lt;br /&gt;d----        12/29/2014   7:50 AM            Home&lt;br /&gt;d----        12/29/2014   7:50 AM            Scripts&lt;br /&gt;-a---        12/29/2014   7:50 AM       5967 AdvancedDemo.html&lt;br /&gt;-a---        12/29/2014   7:50 AM       6802 Demo.html&lt;br /&gt;-a---        12/29/2014   7:47 AM      12862 favicon.ico&lt;br /&gt;-a---        12/29/2014   7:50 AM       8069 index.html&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt;  &lt;p&gt;And that's it for part 1 my friends! You now have a static version of the ASP.Net MVC site to dazzle the world with.  I should say for the purposes of full disclosure that there are 2 pages in the site which are not entirely "static" friendly.  For these 2 pages I've put messages in that are displayed when the page is served up in a static format explaining the limitations.  Their full glory can still be experienced by cloning the project and running locally.&lt;/p&gt; &lt;p&gt;&lt;a href="https://blog.johnnyreilly.com/2015/01/deploying-aspnet-mvc-to-github-pages-with-appveyor-part-2.html"&gt;Next time&lt;/a&gt; we'll take the mechanism detailed above and plug it into AppVeyor for some Continuous Integration happiness.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7789126370484854671'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7789126370484854671'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2014/12/deploying-aspnet-mvc-to-github-pages-with-appveyor-part-1.html' title='Deploying from ASP.Net MVC to GitHub Pages using AppVeyor part 1'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='http://1.bp.blogspot.com/-5p7fD3Q9dc8/VKDzTV1wYDI/AAAAAAAAAxE/LowxrVAxeXI/s72-c/Screenshot%2B2014-12-29%2B06.22.46.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2744623444161380944</id><published>2014-12-12T14:16:00.003Z</published><updated>2021-03-04T16:29:41.859Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='npm'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Visual Studio'/><category scheme='http://www.blogger.com/atom/ns#' term='long paths'/><category scheme='http://www.blogger.com/atom/ns#' term='gulp-angular-templatecache'/><title type='text'>Gulp, npm, long paths and Visual Studio.... Fight!</title><content type='html'>&lt;h4&gt;&lt;sub&gt;How I managed to gulp-angular-templatecache working inside Visual Studio&lt;/sub&gt;&lt;/h4&gt; &lt;p&gt;Every now and then something bites you unexpectedly.  After a certain amount of pain, the answer comes to you and you know you want to save others from falling into the same deathtrap.&lt;/p&gt; &lt;p&gt;There I was minding my own business and having a play with a Gulp plugin called &lt;a href="https://www.npmjs.com/package/gulp-angular-templatecache"&gt;gulp-angular-templatecache&lt;/a&gt;. If you're not aware of it, it "Concatenates and registers AngularJS templates in the $templateCache".  I was planning to use it so that all the views in an &lt;a href="https://github.com/johnnyreilly/proverb-offline"&gt;Angular app of mine&lt;/a&gt; were loaded up-front rather than on demand.  (It's a first step in making an "offline-first" version of that particular app.)&lt;/p&gt; &lt;p&gt;I digress already.  No sooner had I tapped in:&lt;/p&gt; &lt;pre class="prettyprint ps"&gt;&lt;br /&gt;&lt;code class="language-ps"&gt;&lt;br /&gt;npm install gulp-angular-templatecache --saveDev&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Then I noticed my Visual Studio project was no longer compiling.  It was dying a death on build with this error:&lt;/p&gt; &lt;pre class="prettyprint ps"&gt;&lt;br /&gt;&lt;code class="language-ps"&gt;&lt;br /&gt;ASPNETCOMPILER : error ASPRUNTIME: The specified path, file name, or both are too long. The fully qualified file name must be less than 260 characters, and the directory name must be less than 248 characters.&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;I was dimly aware that there were issues with the nested &lt;a href="https://github.com/joyent/node/issues/6960"&gt;node_modules&lt;/a&gt; leading to Windows-killing paths.  This sounded just like that.... And it was! &lt;code&gt;gulp-angular-templatecache&lt;/code&gt; had a dependency on &lt;code&gt;gulp-footer&lt;/code&gt; which had a dependency on &lt;code&gt;lodash.assign&lt;/code&gt; which had a dependency on &lt;code&gt;lodash._basecreatecallback&lt;/code&gt; which had.... You see where I'm going?  It seems that the lovely lodash has created the path from hell.&lt;/p&gt; &lt;p&gt;For reasons that aren't particularly clear this kills Visual Studio's build process.  This is slightly surprising given that our rogue path is sat in the &lt;code&gt;node_modules&lt;/code&gt; directory which isn't part of the project in Visual Studio.  That being the case you'd imagine that you could do what you liked there.  But no, it seems VS is a delicate flower and we must be careful not to offend.  Strange.&lt;/p&gt; &lt;h4&gt;It's Workaround Time!&lt;/h4&gt; &lt;p&gt;After a &lt;em&gt;great deal&lt;/em&gt; of digging I found the answer nestled in the middle of an &lt;a href="http://stackoverflow.com/a/24144479/761388"&gt;answer on Stack Overflow&lt;/a&gt;.  To quote:&lt;/p&gt; &lt;blockquote cite="http://stackoverflow.com/a/24144479/761388"&gt;&lt;p&gt;If you will add "lodash.bind" module to your project's package.json as dependency it will be installed in one level with gulp and not as gulp's dependency&lt;/p&gt;&lt;/blockquote&gt; &lt;p&gt;That's right, I just needed to tap enter this at the root of my project:&lt;/p&gt; &lt;pre class="prettyprint ps"&gt;&lt;br /&gt;&lt;code class="language-ps"&gt;&lt;br /&gt;npm install lodash.bind --saveDev&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;And all was sweetness and light once more - no more complaints from VS.&lt;/p&gt; &lt;h4&gt;The Future&lt;/h4&gt; &lt;p&gt;It looks like lodash are &lt;a href="https://github.com/lodash/lodash-cli/issues/23"&gt;on course to address this issue&lt;/a&gt;.  So one day this this workaround won't be necessary anymore which is good.&lt;/p&gt; &lt;p&gt;However, the general long path issue concerning node / npm hasn't vanished for Windows users.  Given VS 2015 is planning to make Gulp and Grunt 1st class citizens of Visual Studio I'm going to guess that sort of issue is likely to arise again and again for other packages.  I'm hoping that means that someone will actually fix the underlying path issues that upset Windows with npm.&lt;/p&gt; &lt;p&gt;It sounds like npm are planning to take &lt;a href="https://github.com/joyent/node/issues/6960#issuecomment-46704998"&gt;some steps&lt;/a&gt; which is great.  But I can't be alone in having a slightly nagging feeling that Windows isn't quite a first class citizen for node / io / npm yet.  I really hope it will become one.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2744623444161380944'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2744623444161380944'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2014/12/gulp-npm-long-paths-and-visual-studio-fight.html' title='Gulp, npm, long paths and Visual Studio.... Fight!'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6809794867531515399</id><published>2014-12-08T14:03:00.000Z</published><updated>2014-12-08T14:03:47.708Z</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://www.blogger.com/atom/ns#' term='Chrome'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Service worker'/><title type='text'>Going Offline Online</title><content type='html'>&lt;p&gt;I've long believed that the web was going to win the battle of the app-platforms.  The current situation of building an app for Android, for iOS, for Windows, for (insert another and another and another platform) .... just doesn't seem sustainable in the long term.  &lt;a href="https://en.wikipedia.org/wiki/Don't_repeat_yourself"&gt;DRY&lt;/a&gt; will out in the end.&lt;/p&gt; &lt;p&gt;One thing that I think is going to help massively is &lt;a href="https://github.com/slightlyoff/ServiceWorker/"&gt;Service Worker&lt;/a&gt;.  There's a &lt;a href="http://jakearchibald.com/2014/service-worker-first-draft/"&gt;fascinating introduction to Service Worker by Jake Archibald&lt;/a&gt;.  To quote him:&lt;/p&gt; &lt;blockquote cite="http://jakearchibald.com/2014/service-worker-first-draft/"&gt;&lt;p&gt;The service worker is like a shared worker, but whereas pages control a shared worker, a service worker controls pages.&lt;/p&gt; &lt;p&gt;Being able to run JavaScript before a page exists opens up many possibilities, and the first feature we're adding is interception and modification of navigation and resource requests. This lets you tweak the serving of content, all the way up to treating network-connectivity as an enhancement. It's like having a proxy server running on the client.&lt;/p&gt;&lt;/blockquote&gt; &lt;p&gt;This is a feature that's tiptoeing into Chrome as I type this.  But it should (I hope) one day be part of the web platform as standard.  You can see how far things have progressed down that path at &lt;a href="https://jakearchibald.github.io/isserviceworkerready/"&gt;Is Service Worker ready?&lt;/a&gt;&lt;/p&gt; &lt;h4&gt;Making Proverb work Offline-First&lt;/h4&gt; &lt;p&gt;Jake Archibald's &lt;a href="https://github.com/jakearchibald/trained-to-thrill/"&gt;Trained to Thrill&lt;/a&gt; is an app which demo's the web working offline thanks to the magic of Service Worker.  So now I want to have a go myself.  I've a very simple little app called Proverb just displays the strange sayings of a previous colleague.  More than anything else it's a playground for me to apply when I want to do the next thing after "hello world".&lt;/p&gt; &lt;h4&gt;Template Cache&lt;/h4&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/6809794867531515399'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/6809794867531515399'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4469985195991568239</id><published>2014-12-05T06:40:00.001Z</published><updated>2021-03-13T14:08:36.393Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='cybersquatting'/><title type='text'>What's in a (Domain) Name?</title><content type='html'>&lt;p&gt;The observant amongst you may have noticed that this blog has a brand new and shiny domain name!  That's right, after happily trading under "icanmakethiswork.blogspot.com" for the longest time it's now "blog.icanmakethiswork.io". Trumpets and fanfare!&lt;/p&gt; &lt;p&gt;Why the change?  Well let's break that question down a little.  First of all, why change at all?  Secondly, why change to blog.icanmakethiswork.io?&lt;/p&gt; &lt;h4&gt;Why do things have to change at all?&lt;/h4&gt; &lt;p&gt;I mean, weren't we happy?  Wasn't it all good?  Well quite.  For the record, I have no complaints of Blogger who have hosted my blog since it began.  They've provided good tools and a good service and I'm happy with them.&lt;/p&gt; &lt;p&gt;That said, I've been toying with the idea for a while now of trying out a few other blogging solutions - possibly even hosting it myself.  Whilst my plans are far from definite at the moment I'm aware that I don't own icanmakethiswork.blogspot.com - I can't take it with me.  So if I want to make a move to change my blogging solution a first step is establishing my own domain name for my blog.  I've done that now. If and when I up sticks, people will hopefully come with me as the URL for my blog should not change.&lt;/p&gt; &lt;p&gt;Also, in the back of my mind I'm aware that Google owns Blogger.  Given their recent spate of closing services it's certainly possible that the Google reaper could one day call for Blogger.  So it makes sense to be ready to move my blog elsewhere should that day come.&lt;/p&gt; &lt;h4&gt;Why blog.icanmakethiswork.io?&lt;/h4&gt; &lt;p&gt;Why indeed?  And why the ".io" suffix?  Doesn't that just make you a desperate follower of fashion?&lt;/p&gt; &lt;p&gt;Good questions all, and "no, I hope not".  My original plans were to use the domain name "icanmakethiswork.com". icanmakethiswork was the name of the blog and it made sense to keep it in the URL.  So off I went to register the domain name when to my surprise I discovered this:&lt;/p&gt; &lt;a href="http://4.bp.blogspot.com/-g4rYVOsfHrM/VIFF1KD4gYI/AAAAAAAAAwE/Ll5-YVAfwPM/s1600/Screenshot%2B2014-12-05%2B05.39.00.png" imageanchor="1" &gt;&lt;img border="0" src="http://4.bp.blogspot.com/-g4rYVOsfHrM/VIFF1KD4gYI/AAAAAAAAAwE/Ll5-YVAfwPM/s640/Screenshot%2B2014-12-05%2B05.39.00.png" /&gt;&lt;/a&gt; &lt;p&gt;My domain is being &lt;a href="https://en.wikipedia.org/wiki/Cybersquatting"&gt;cybersquatted&lt;/a&gt;!  I mean.... What??!!!!&lt;/p&gt; &lt;p&gt;I started to wonder "is there another icanmakethiswork out there"?  Am I not the &lt;a href="http://youtu.be/z8f2mW1GFSI"&gt;one and only&lt;/a&gt;?  So I checked with DuckDuckGo ("The search engine that doesn't track you.") and look what I found:&lt;/p&gt; &lt;a href="http://4.bp.blogspot.com/-Ut96guCgZlU/VIFF_0ol1-I/AAAAAAAAAwM/LXI_I17jJgY/s1600/Screenshot%2B2014-12-05%2B05.41.59.png" imageanchor="1" &gt;&lt;img border="0" src="http://4.bp.blogspot.com/-Ut96guCgZlU/VIFF_0ol1-I/AAAAAAAAAwM/LXI_I17jJgY/s640/Screenshot%2B2014-12-05%2B05.41.59.png" /&gt;&lt;/a&gt; &lt;p&gt;A whole screen of me.  Just me.&lt;/p&gt; &lt;p&gt;As of June 3rd 2014 someone has been sitting on my blog name.  I was actually rather outraged by this.  I became even more so as I discovered that there was a mechanism (not free) by which I could try and buy it off the squatter.  I could instead be like my life idol Madonna and go to court to get it back.  But frankly in this sense I'm more like Rachel Green in Friends; not litigous.&lt;/p&gt; &lt;p&gt;So that's why I went for icanmakethiswork.io instead.  Path of least resistance and all that.  I'd still like icanmakethiswork.com to be mine but I'm not going to court and I'm not paying the squatter.  Maybe one day I'll get it.  Who knows?&lt;/p&gt; &lt;p&gt;Either way, from now on this is blog.icanmakethiswork.io - please stick around!&lt;/p&gt; &lt;h4&gt;Is anything else going to change?&lt;/h4&gt; &lt;p&gt;Not for now, no.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4469985195991568239'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4469985195991568239'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2014/12/whats-in-a-name.html' title='What&apos;s in a (Domain) Name?'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='http://4.bp.blogspot.com/-g4rYVOsfHrM/VIFF1KD4gYI/AAAAAAAAAwE/Ll5-YVAfwPM/s72-c/Screenshot%2B2014-12-05%2B05.39.00.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8479406605518565864</id><published>2014-11-26T12:39:00.001Z</published><updated>2021-03-04T16:28:13.444Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='IE 11'/><category scheme='http://www.blogger.com/atom/ns#' term='runas'/><category scheme='http://www.blogger.com/atom/ns#' term='Coded UI'/><category scheme='http://www.blogger.com/atom/ns#' term='nomerge'/><category scheme='http://www.blogger.com/atom/ns#' term='Internet Exporer'/><title type='text'>Pretending to be someone you're not and the dark pit of despair</title><content type='html'>&lt;h4&gt;&lt;sub&gt;(Coded UI, IE 11 and the "runas" problem)&lt;/sub&gt;&lt;/h4&gt; &lt;p&gt;"I'm not angry, I'm just disappointed."&lt;/p&gt; &lt;p&gt;That's kind of how I feel about Coded UI tests.  It may well be that you've never heard of them - in my experience very few people seem to be aware of them.  What are they?  Well, I've never used &lt;a href="http://www.seleniumhq.org/"&gt;Selenium&lt;/a&gt; but as best I understand Coded UI is Microsoft's own version of that.  Namely it's a way to automate testing, in my case browser-based testing.  You can write a suite of tests that will spin up your application and test it out, going from screen to screen, URL to URL and asserting all is as you would expect.&lt;/p&gt; &lt;p&gt;The project that I'm currently working on has a pretty comprehensive set of tests covering the use of the application.  Each night as the clock strikes midnight a lonely computer in the West End of London whirrs into life and runs the full suite.  It takes about 8 hours and at the end a report slips into your inbox letting you know of any failures.&lt;/p&gt; &lt;h4&gt;Sounds brilliant right?  How could someone not love this?&lt;/h4&gt; &lt;p&gt;Well a number of reasons.  First of all, &lt;em&gt;it takes 8 hours&lt;/em&gt;!!!!  That's a long time; I'd rather learn what I broke today rather than tomorrow.&lt;/p&gt; &lt;p&gt;Also, and this is probably more significant, Coded UI tests are pretty flaky. Let me qualify that.  For a test to be particularly useful it has to be quick, repeatable and reliable.  As I've said, Coded UI tests are not quick.&lt;/p&gt; &lt;p&gt;By their very nature integration tests (of which Coded UI tests are a type) can never be entirely reliably repeatable.  They test your app in it's entirety.  So, for example, if a 3rd party service goes down for 5 minutes then you will get failed tests.  You'll burn time investigating these false positives.&lt;/p&gt; &lt;p&gt;Further to that, Coded UI tests are repeatable, except when they're not.  I've seen colleagues reduced to near tears by incredible sensitivity of Coded UI tests.  Out of the box Coded UI tests appear to ship with the &lt;a href="http://blog.codinghorror.com/the-works-on-my-machine-certification-program/"&gt;"Works on my machine"&lt;/a&gt; guarantee.  It requires far more effort that you'd expect to come up with tests that can be reliably expected to pass.  They will fail for surprising reasons.  For instance, did you know that using the 2.x branch of jQuery won't work with Coded UI?  &lt;a href="https://connect.microsoft.com/VisualStudio/Feedback/Details/794841"&gt;Neither did I.&lt;/a&gt;  I've lost track of the time that has been wasted running the same test in multiple different environments trying to identify what exactly is upsetting Coded UI about the environment this time.&lt;/p&gt; &lt;p&gt;It is sad but true that with Coded UI tests you can spend an &lt;em&gt;enormous&lt;/em&gt; amount of time maintaining the test pack on a day to day basis.  As infrastructure and project dependencies are upgraded you will sadly discover Coded UI has once again gone into the foetal position and has to tempted back to normal functioning by whispering sweet nothings in it's ear. (&lt;i&gt;"It's not true that they've ended support for Windows XP" / "IE 6 will live forever"&lt;/i&gt; and so on)&lt;/p&gt; &lt;p&gt;Coded UI also appears to be badly supported by Microsoft.  Documentation is pretty sparse and, as we'll come back to in a minute, Coded UI is sometimes broken or damaged by other products shipped by Microsoft.  This makes it hard to have faith in Coded UI.  Indeed, if you're thinking of automating your QA testing my advice would be "look into Selenium".  Not because I've used it (I haven't) but those I've met who have used Selenium and Coded UI say Selenium wins hands down.&lt;/p&gt; &lt;h4&gt;And yet, and yet...&lt;/h4&gt; &lt;p&gt;All of the above said, if you have a Coded UI test suite it can still pay dividends.  Significant dividends.  As I mentioned, my current project has a significant coverage of Coded UI tests.  We've crawled over a lot of broken glass to put these together.  But now they're there it is undeniably useful.&lt;/p&gt; &lt;p&gt;Every now and then we'll do a significant refactor of part of the application.  For instance, we've entirely changed our persistence strategy in the app but been able to check the code in with a high degree of confidence gleaned from running our test suite using the refactored codebase.&lt;/p&gt; &lt;p&gt;Let me be clear: Coded UI tests can be useful.&lt;/p&gt; &lt;h4&gt;The "runas" Problem&lt;/h4&gt; &lt;p&gt;Long preamble over, this post is about how to work around the latest issue Coded UI has thrown in our direction.  I call it the "runas" problem.  Our application is a Knockout / ASP.Net MVC web app built to be used in an intranet environment.  By that I mean that identity is handled by Active Directory / &lt;a href="http://en.wikipedia.org/wiki/Integrated_Windows_Authentication"&gt;Windows Authentication&lt;/a&gt;.  When someone logs into our app we know who they are without them having to directly supply us with a username and password.  No, by logging into their computer they have announced just who they are and Internet Explorer (for it is he) will pass along the credentials. (The app can be used with pretty much any browser but we're only mandated to support IE 9+.)&lt;/p&gt; &lt;p&gt;In order that we can test the app we have a number of test accounts set up in Active Directory.  These test accounts have been assigned various roles (viewer / editor / administrator etc).  Our tests are designed to run using these accounts in order that all scenarios can be adequately tested.&lt;/p&gt; &lt;p&gt;To achieve this lofty goal the following code (or something very like it) is executed as the first step in any Coded UI test:&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;string browserLocation = "C:\\Program Files\\Internet Explorer\\iexplore.exe";&lt;br /&gt;string url = "http://localhost:12345/";&lt;br /&gt;string username = "test.editor";&lt;br /&gt;string domain = "theDomain";&lt;br /&gt;var password = new SecureString();&lt;br /&gt;foreach (char c in "test.editor.password")&lt;br /&gt;{&lt;br /&gt;    password.AppendChar(c);&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;ApplicationUnderTest.Launch(browserLocation, null, url, username, password, domain);&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;What this does is fire up Internet Explorer as the supplied user of theDomain\test.editor, and navigate to the home page.  With that as our starting place we could dependably then run a test as this test user.  This was a solution not without quirks (on occasion Coded UI tests would "stutter" - repeating each keypress 3 times with calamitous effects).  But generally, this worked.&lt;/p&gt; &lt;p&gt;Until that is either Visual Studio 2013 Update 3 or Internet Explorer 11 was installed.  One of these (and it appears to be hotly contested) broke the ability to run the above code successfully.  After these were installed running the above code resulted in the following error message:&lt;/p&gt; &lt;blockquote&gt;&lt;p&gt;"The application cannot be started. This could be due to one of the following reasons:&lt;/p&gt;&lt;ol&gt;&lt;li&gt; Another instance of the application is already running and only one instance can be running at a time.&lt;/li&gt;&lt;li&gt; The application started another process and has now stopped. You may need to launch the process directly.&lt;/li&gt;&lt;li&gt; You do not have sufficient privileges for this application." File: C:\Program Files\Internet Explorer\iexplore.exe."&lt;/li&gt;&lt;/ol&gt;&lt;/blockquote&gt; &lt;p&gt;Lamentably, this was pretty much unresolvable and &lt;a href="https://connect.microsoft.com/VisualStudio/feedbackdetail/view/949049/coded-ui-cannot-run-as-a-different-user-with-visual-studio-2013-update-3"&gt;logging it with Microsoft yielded nothing helpful&lt;/a&gt;.  This is what I mean about Coded UI being badly supported by Microsoft.  Despite my best efforts to report this issue both to Connect and &lt;a href="http://social.msdn.microsoft.com/Forums/vstudio/en-US/f48665e4-569a-4b67-9bdb-5522b2adffb2/cannot-run-coded-ui-tests-as-different-user-on-windows-81?forum=vsmantest#28c9decb-b579-4848-a7a9-f41c57584d59"&gt;elsewhere&lt;/a&gt; and in the end nothing useful happened.&lt;/p&gt; &lt;p&gt;So what to do? I still have Coded UI tests, I still need to be able to run them. And crucially I need to be able to run them impersonating a different user.  What to do indeed....&lt;/p&gt; &lt;h4&gt;The &lt;strike&gt;hack&lt;/strike&gt; workaround&lt;/h4&gt; &lt;p&gt;After IE 11 / Visual Studio Update 3 / whatev's was installed I was left with a setup that allowed me to run Coded UI  tests, &lt;u&gt;but only&lt;/u&gt; as the current user.  On that basis I started looking into a little MVC jiggery pokery.  All my controllers inherit from a single base controller.  Inside there I placed the following extra override:&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;public abstract class BaseController : System.Web.Mvc.Controller&lt;br /&gt;{&lt;br /&gt;  //...&lt;br /&gt;&lt;br /&gt;  protected override void OnAuthorization(AuthorizationContext filterContext)&lt;br /&gt;  {&lt;br /&gt;#if DEBUG&lt;br /&gt;    if (filterContext.HttpContext.IsDebuggingEnabled)// Is compilation debug="true" set in the web.config?&lt;br /&gt;    {&lt;br /&gt;      var userToImpersonate = Session["UserToImpersonate"] as string;&lt;br /&gt;      if (!string.IsNullOrEmpty(userToImpersonate))&lt;br /&gt;      {&lt;br /&gt;        // userToImpersonate example: "test.editor@theDomain.com"&lt;br /&gt;        filterContext.HttpContext.User = new RolePrincipal(new WindowsIdentity(userToImpersonate));&lt;br /&gt;      }&lt;br /&gt;    }&lt;br /&gt;#endif&lt;br /&gt;      base.OnAuthorization(filterContext);&lt;br /&gt;  }&lt;br /&gt;&lt;br /&gt;  //...&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Each request will trigger this method as one of the first steps in the MVC pipeline.  What it does is checks the &lt;code&gt;Session&lt;/code&gt; for a user to impersonate.  (Yes I'm as wary of Session as the next chap - but in this case it's the right tool for the job.) If a user has been specified then it replaces the current user with the &lt;code&gt;Session&lt;/code&gt; user.  From this point forwards the app is effectively running as that user.  That's great!&lt;/p&gt; &lt;p&gt;In order that Coded UI can make use of this mechanism we need to introduce a "hook".  This is going to look a bit hacky - bear with me. Inside &lt;code&gt;Global.asax.cs&lt;/code&gt; we're going to add a &lt;code&gt;Session_Start&lt;/code&gt; method:&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;protected void Session_Start(object sender, EventArgs eventArgs)&lt;br /&gt;{&lt;br /&gt;#if DEBUG&lt;br /&gt;    // If a user to impersonate has been supplied then add this user to the session&lt;br /&gt;    // Impersonation will happen in the OnAuthorization method of our base MVC controller&lt;br /&gt;    // Note, this is only allowed in debug mode - not in release mode&lt;br /&gt;    // This exists purely to support coded ui tests&lt;br /&gt;    if (Context.IsDebuggingEnabled)  // Is compilation debug="true" set in the web.config?&lt;br /&gt;    {&lt;br /&gt;        var userToImpersonate = Request.QueryString["UserToImpersonate"] as string;&lt;br /&gt;        if (!string.IsNullOrEmpty(userToImpersonate))&lt;br /&gt;        {&lt;br /&gt;            Session.Add("UserToImpersonate", userToImpersonate);&lt;br /&gt;        }&lt;br /&gt;    }&lt;br /&gt;#endif&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;For the first Request in a Session this checks the &lt;code&gt;QueryString&lt;/code&gt; for a parameter called &lt;code&gt;UserToImpersonate&lt;/code&gt;.  If it's found then it's placed into &lt;code&gt;Session&lt;/code&gt;. With this hook exposed we can now amend the first step that all our Coded UI tests follow:&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;// Various lines commented out as doesn't work with IE 11 - left as an example of how it could be done in the past&lt;br /&gt;//string browserLocation = "C:\\Program Files\\Internet Explorer\\iexplore.exe";&lt;br /&gt;string url = "http://localhost:12345/";&lt;br /&gt;string username = "test.editor";&lt;br /&gt;string domain = "theDomain.com";&lt;br /&gt;//var password = new SecureString();&lt;br /&gt;//foreach (char c in "test.editor.password")&lt;br /&gt;//{&lt;br /&gt;//    password.AppendChar(c);&lt;br /&gt;//}&lt;br /&gt;&lt;br /&gt;//ApplicationUnderTest.Launch(browserLocation, null, url, username, password, domain);&lt;br /&gt;&lt;br /&gt;// Suffixing url with UrlToImpersonate which will be picked up in Session_Start and used to impersonate&lt;br /&gt;// in OnAuthorization in BaseController.  Also no longer using ApplicationUnderTest.Launch; switched to &lt;br /&gt;// BrowserWindow.Launch&lt;br /&gt;// No longer used parameters: browserLocation, password&lt;br /&gt;var userToImpersonate = username + "@" + domain; // eg "test.editor@theDomain.com"&lt;br /&gt;var urlWithUser = url + "?UserToImpersonate=" + HttpUtility.UrlEncode(userToImpersonate);&lt;br /&gt;var browser = BrowserWindow.Launch(urlWithUser, "-nomerge"); // "-nomerge" flag forces a new session&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;As you can see we actually need less when we're using this approach.  We no longer need to directly specify the password or the browser location.  And the user to impersonate is now passed in as the part of the initial URL used to launch the test.&lt;/p&gt; &lt;p&gt;Pay careful attention to the "-nomerge" flag that is passed in.  This ensures that when another browser instance is opened a new session will be started.  This is essential for "multi-user" tests that run tests for &lt;em&gt;different&lt;/em&gt; users as part of the same test.  It ensures that "test.editor" and "test.different.editor" can co-exist happily.&lt;/p&gt; &lt;h4&gt;What do I think of the workaround?&lt;/h4&gt; &lt;p&gt;This approach works reliably and dependably.  More so than the original approach which on occasion wouldn't work or would "stutter" keypresses.  That's the good news.&lt;/p&gt; &lt;p&gt;The not so good news is that this approach is, in my view, a bit of hack.  I want you to know that this isn't my ideal.&lt;/p&gt; &lt;p&gt;I &lt;em&gt;really&lt;/em&gt; don't like having to change the actual system code to facilitate the impersonation requirement.  Naturally we only ship the release and not the debug builds to Production so the "back door" that this approach provides will not exist in our Production builds.  It will only be accessible in our development environments and on our Coded UI test server. But it feels oh so wrong that there is an effective potential back door in the system now.  Well, only if the stars were to align in a really terrible (and admittedly rather unlikely) way. But still, you take my point.  Caveat emptor and all that.  This is something of a cutdown example to illustrate the point.  If anyone else intends to use this then I'd suggest doing more to safeguard your approach.  Implementing impersonation whitelists so "any" user cannot be impersonated would be a sensible precaution to start with.&lt;/p&gt; &lt;p&gt;Perhaps this is just one more reason that I'm not that enamoured of Coded UI.  Once again it is useful but I've had to compromise more than I'd like to keep it's use. If anyone out there has a better solution I would &lt;em&gt;love&lt;/em&gt; to hear from you.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8479406605518565864'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8479406605518565864'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2014/11/Coded-UI-IE-11-and-the-runas-problem.html' title='Pretending to be someone you&apos;re not and the dark pit of despair'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5490199177230111925</id><published>2014-11-04T13:48:00.003Z</published><updated>2021-03-13T14:38:58.629Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Task Runner Explorer'/><category scheme='http://www.blogger.com/atom/ns#' term='Visual Studio'/><category scheme='http://www.blogger.com/atom/ns#' term='TypeScript'/><category scheme='http://www.blogger.com/atom/ns#' term='javascript'/><category scheme='http://www.blogger.com/atom/ns#' term='Gulp'/><title type='text'>Using Gulp in Visual Studio instead of Web Optimization</title><content type='html'>&lt;h5&gt;Update 17/02/2015: I've taken the approach discussed in this post a little further - you can see &lt;a href="https://blog.johnnyreilly.com/2015/02/using-gulp-in-asp-net-instead-of-web-optimization.html"&gt;here&lt;/a&gt;&lt;/h5&gt; &lt;p&gt;I've used a number of tools to package up JavaScript and CSS in my web apps.  &lt;a href="http://getcassette.net/"&gt;Andrew Davey's tremendous Cassette&lt;/a&gt; has been really useful.  Also good (although less powerful/magical) has been Microsoft's very own &lt;a href="https://www.nuget.org/packages/Microsoft.AspNet.Web.Optimization/"&gt;Microsoft.AspNet.Web.Optimization&lt;/a&gt; that ships with MVC.&lt;/p&gt; &lt;p&gt;I was watching the &lt;a href="http://youtu.be/NgbA2BxNweE?list=PL0M0zPgJ3HSftTAAHttA3JQU4vOjXFquF"&gt;ASP.NET Community Standup from October 7th, 2014&lt;/a&gt; and learned that the ASP.Net team is not planning to migrate &lt;a href="https://www.nuget.org/packages/Microsoft.AspNet.Web.Optimization/"&gt;Microsoft.AspNet.Web.Optimization&lt;/a&gt; to the next version of ASP.Net.  Instead they're looking to make use of JavaScript task runners like &lt;a href="http://gruntjs.com/"&gt;Grunt&lt;/a&gt; and maybe &lt;a href="http://gulpjs.com/"&gt;Gulp&lt;/a&gt;. Perhaps you're even dimly aware that they've been taking steps to make these runners more of a first class citizen in Visual Studio, hence the recent release of the new and groovy &lt;a href="http://visualstudiogallery.msdn.microsoft.com/8e1b4368-4afb-467a-bc13-9650572db708"&gt;Task Runner Explorer&lt;/a&gt;.&lt;/p&gt; &lt;p&gt;Gulp has been on my radar for a while now as has Grunt.  By "on my radar" what I really mean is "Hmmmm, I really need to learn this..... perhaps I could wait until the &lt;a href="http://en.wikipedia.org/wiki/Videotape_format_war"&gt;Betamax vs VHS battles&lt;/a&gt; are done? Oh never mind, here we go...".&lt;/p&gt; &lt;p&gt;My understanding is that Grunt and Gulp essentially do the same thing (run tasks in JavaScript) but have different approaches.  Grunt is more about configuration, Gulp is more about code.  At present Gulp also has a performance advantage as it does less IO than Grunt - though I understand that's due to change in the future.  But generally my preference is code over configuration. On that basis I decided that I was going to give Gulp first crack.&lt;/p&gt; &lt;h4&gt;Bub bye Web Optimization&lt;/h4&gt; &lt;p&gt;I already had a project that used &lt;a href="https://github.com/johnnyreilly/Proverb"&gt;Web Optimization&lt;/a&gt; to bundle JavaScript and CSS files.  When debugging on my own machine Web Optimization served up the full JavaScript and CSS files.  Thanks to the magic of source maps I was able to debug the TypeScript that created the JavaScript files too.  Which was nice.  When I deployed to production, Web Optimization minified and concatenated the JavaScript and CSS files.  This meant I had a single HTTP request for JavaScript and a single HTTP request for CSS. This was also... nooice!&lt;/p&gt; &lt;p&gt;I took a copy of my existing project and created a &lt;a href="https://github.com/johnnyreilly/Proverb-gulp"&gt;new repo for it on GitHub&lt;/a&gt;.  It was very simple in terms of bundling.  It had a &lt;code&gt;BundleConfig&lt;/code&gt; that created 2 bundles; 1 for JavaScript and 1 for CSS:&lt;/p&gt;    &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;using System.Web;&lt;br /&gt;using System.Web.Optimization;&lt;br /&gt;&lt;br /&gt;namespace Proverb.Web&lt;br /&gt;{&lt;br /&gt;    public class BundleConfig&lt;br /&gt;    {&lt;br /&gt;        // For more information on bundling, visit http://go.microsoft.com/fwlink/?LinkId=301862&lt;br /&gt;        public static void RegisterBundles(BundleCollection bundles)&lt;br /&gt;        {&lt;br /&gt;            var angularApp = new ScriptBundle("~/angularApp").Include(&lt;br /&gt;&lt;br /&gt;                // Vendor Scripts &lt;br /&gt;                "~/scripts/jquery-{version}.js",&lt;br /&gt;                "~/scripts/angular.js",&lt;br /&gt;                "~/scripts/angular-animate.js",&lt;br /&gt;                "~/scripts/angular-route.js",&lt;br /&gt;                "~/scripts/angular-sanitize.js",&lt;br /&gt;                "~/scripts/angular-ui/ui-bootstrap-tpls.js",&lt;br /&gt;&lt;br /&gt;                "~/scripts/toastr.js",&lt;br /&gt;                "~/scripts/moment.js",&lt;br /&gt;                "~/scripts/spin.js",&lt;br /&gt;                "~/scripts/underscore.js",&lt;br /&gt;&lt;br /&gt;                // Bootstrapping&lt;br /&gt;                "~/app/app.js",&lt;br /&gt;                "~/app/config.route.js",&lt;br /&gt;&lt;br /&gt;                // common Modules&lt;br /&gt;                "~/app/common/common.js",&lt;br /&gt;                "~/app/common/logger.js",&lt;br /&gt;                "~/app/common/spinner.js",&lt;br /&gt;&lt;br /&gt;                // common.bootstrap Modules&lt;br /&gt;                "~/app/common/bootstrap/bootstrap.dialog.js"&lt;br /&gt;                );&lt;br /&gt;&lt;br /&gt;            // directives&lt;br /&gt;            angularApp.IncludeDirectory("~/app/directives", "*.js", true);&lt;br /&gt;&lt;br /&gt;            // services&lt;br /&gt;            angularApp.IncludeDirectory("~/app/services", "*.js", true);&lt;br /&gt;&lt;br /&gt;            // controllers&lt;br /&gt;            angularApp.IncludeDirectory("~/app/admin", "*.js", true);&lt;br /&gt;            angularApp.IncludeDirectory("~/app/about", "*.js", true);&lt;br /&gt;            angularApp.IncludeDirectory("~/app/dashboard", "*.js", true);&lt;br /&gt;            angularApp.IncludeDirectory("~/app/layout", "*.js", true);&lt;br /&gt;            angularApp.IncludeDirectory("~/app/sayings", "*.js", true);&lt;br /&gt;            angularApp.IncludeDirectory("~/app/sages", "*.js", true);&lt;br /&gt;&lt;br /&gt;            bundles.Add(angularApp);&lt;br /&gt;&lt;br /&gt;            bundles.Add(new StyleBundle("~/Content/css").Include(&lt;br /&gt;                "~/content/ie10mobile.css",&lt;br /&gt;                "~/content/bootstrap.css",&lt;br /&gt;                "~/content/font-awesome.css",&lt;br /&gt;                "~/content/toastr.css",&lt;br /&gt;                "~/content/styles.css"&lt;br /&gt;            ));&lt;br /&gt;        }&lt;br /&gt;    }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;I set myself a task.  I wanted to be able to work in *&lt;strong&gt;exactly&lt;/strong&gt;* the way I was working now.  But using Gulp instead of Web Optimization.  I wanted to lose the BundleConfig above and remove Web Optimization from my application, secure in the knowledge that I had lost nothing.  Could it be done?  Read on!&lt;/p&gt; &lt;h4&gt;Installing Gulp (and Associates)&lt;/h4&gt; &lt;p&gt;I fired up Visual Studio and looked for an excuse to use the Task Runner Explorer.  The first thing I needed was Gulp. My machine already had Node and NPM installed so I went to the command line to install Gulp globally:&lt;/p&gt; &lt;pre class="prettyprint ps"&gt;&lt;br /&gt;&lt;code class="language-ps"&gt;&lt;br /&gt;npm install gulp -g&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Now to start to plug Gulp into my web project.  It was time to make the introductions: Visual Studio meet NPM. At the root of the web project I created a &lt;code&gt;package.json&lt;/code&gt; file by executing the following command and accepting all the defaults:&lt;/p&gt; &lt;pre class="prettyprint ps"&gt;&lt;br /&gt;&lt;code class="language-ps"&gt;&lt;br /&gt;npm init&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt; &lt;p&gt;I wanted to add Gulp as a development dependency of my project:  ("Development" because I only need to run tasks at development time.  My app has no dependency on Gulp at runtime - at that point it's just about serving up static files.)&lt;/p&gt; &lt;pre class="prettyprint ps"&gt;&lt;br /&gt;&lt;code class="language-ps"&gt;&lt;br /&gt;npm install gulp --save-dev&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;This installs gulp local to the project as a development dependency.  As a result we now have a "node_modules" folder sat in our root which contains our node packages.  Currently, as our &lt;code&gt;package.json&lt;/code&gt; reveals, this is only gulp:&lt;/p&gt; &lt;pre class="prettyprint json"&gt;&lt;br /&gt;&lt;code class="language-json"&gt;&lt;br /&gt;  "devDependencies": {&lt;br /&gt;    "gulp": "^3.8.8"&lt;br /&gt;  }&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;It's time to go to town.  Let's install all the packages we're going to need to bundle and minify JavaScript and CSS:&lt;/p&gt; &lt;pre class="prettyprint ps"&gt;&lt;br /&gt;&lt;code class="language-sh"&gt;&lt;br /&gt;npm install gulp-concat gulp-uglify gulp-rev del path gulp-ignore gulp-asset-manifest gulp-minify-css --save-dev&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;This installs the packages as dev dependencies (as you've probably guessed) and leaves us with a list of dev dependencies like this:&lt;/p&gt; &lt;pre class="prettyprint json"&gt;&lt;br /&gt;&lt;code class="language-json"&gt;&lt;br /&gt;  "devDependencies": {&lt;br /&gt;    "del": "^0.1.3",&lt;br /&gt;    "gulp": "^3.8.8",&lt;br /&gt;    "gulp-asset-manifest": "0.0.5",&lt;br /&gt;    "gulp-concat": "^2.4.1",&lt;br /&gt;    "gulp-ignore": "^1.2.1",&lt;br /&gt;    "gulp-minify-css": "^0.3.10",&lt;br /&gt;    "gulp-rev": "^1.1.0",&lt;br /&gt;    "gulp-uglify": "^1.0.1",&lt;br /&gt;    "path": "^0.4.9"&lt;br /&gt;  }&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;h4&gt;Making &lt;code&gt;gulpfile.js&lt;/code&gt;&lt;/h4&gt; &lt;p&gt;So now I was ready. I had everything I needed to replace my &lt;code&gt;BundleConfig.cs&lt;/code&gt;.  I created a new file called &lt;code&gt;gulpfile.js&lt;/code&gt; in the root of my web project that looked like this:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;/// &amp;lt;vs AfterBuild='default' /&amp;gt;&lt;br /&gt;var gulp = require("gulp");&lt;br /&gt;&lt;br /&gt;// Include Our Plugins&lt;br /&gt;var concat = require("gulp-concat");&lt;br /&gt;var ignore = require("gulp-ignore");&lt;br /&gt;var manifest = require("gulp-asset-manifest");&lt;br /&gt;var minifyCss = require("gulp-minify-css");&lt;br /&gt;var uglify = require("gulp-uglify");&lt;br /&gt;var rev = require("gulp-rev");&lt;br /&gt;var del = require("del");&lt;br /&gt;var path = require("path");&lt;br /&gt;&lt;br /&gt;var tsjsmapjsSuffix = ".{ts,js.map,js}";&lt;br /&gt;var excludetsjsmap = "**/*.{ts,js.map}";&lt;br /&gt;&lt;br /&gt;var bundleNames = { scripts: "scripts", styles: "styles" };&lt;br /&gt;&lt;br /&gt;var filesAndFolders = {&lt;br /&gt;&lt;br /&gt;    base: ".",&lt;br /&gt;    buildBaseFolder: "./build/",&lt;br /&gt;    debug: "debug",&lt;br /&gt;    release: "release",&lt;br /&gt;    css: "css",&lt;br /&gt;&lt;br /&gt;    // The fonts we want Gulp to process&lt;br /&gt;    fonts: ["./fonts/*.*"],&lt;br /&gt;&lt;br /&gt;    // The scripts we want Gulp to process - adapted from BundleConfig&lt;br /&gt;    scripts: [&lt;br /&gt;        // Vendor Scripts &lt;br /&gt;        "./scripts/angular.js",&lt;br /&gt;        "./scripts/angular-animate.js",&lt;br /&gt;        "./scripts/angular-route.js",&lt;br /&gt;        "./scripts/angular-sanitize.js",&lt;br /&gt;        "./scripts/angular-ui/ui-bootstrap-tpls.js",&lt;br /&gt;&lt;br /&gt;        "./scripts/toastr.js",&lt;br /&gt;        "./scripts/moment.js",&lt;br /&gt;        "./scripts/spin.js",&lt;br /&gt;        "./scripts/underscore.js",&lt;br /&gt;&lt;br /&gt;        // Bootstrapping&lt;br /&gt;        "./app/app" + tsjsmapjsSuffix,&lt;br /&gt;        "./app/config.route" + tsjsmapjsSuffix,&lt;br /&gt;&lt;br /&gt;        // common Modules&lt;br /&gt;        "./app/common/common" + tsjsmapjsSuffix,&lt;br /&gt;        "./app/common/logger" + tsjsmapjsSuffix,&lt;br /&gt;        "./app/common/spinner" + tsjsmapjsSuffix,&lt;br /&gt;&lt;br /&gt;        // common.bootstrap Modules&lt;br /&gt;        "./app/common/bootstrap/bootstrap.dialog" + tsjsmapjsSuffix,&lt;br /&gt;&lt;br /&gt;        // directives&lt;br /&gt;        "./app/directives/**/*" + tsjsmapjsSuffix,&lt;br /&gt;&lt;br /&gt;        // services&lt;br /&gt;        "./app/services/**/*" + tsjsmapjsSuffix,&lt;br /&gt;&lt;br /&gt;        // controllers&lt;br /&gt;        "./app/about/**/*" + tsjsmapjsSuffix,&lt;br /&gt;        "./app/admin/**/*" + tsjsmapjsSuffix,&lt;br /&gt;        "./app/dashboard/**/*" + tsjsmapjsSuffix,&lt;br /&gt;        "./app/layout/**/*" + tsjsmapjsSuffix,&lt;br /&gt;        "./app/sages/**/*" + tsjsmapjsSuffix,&lt;br /&gt;        "./app/sayings/**/*" + tsjsmapjsSuffix&lt;br /&gt;    ],&lt;br /&gt;&lt;br /&gt;    // The styles we want Gulp to process - adapted from BundleConfig&lt;br /&gt;    styles: [&lt;br /&gt;        "./content/ie10mobile.css",&lt;br /&gt;        "./content/bootstrap.css",&lt;br /&gt;        "./content/font-awesome.css",&lt;br /&gt;        "./content/toastr.css",&lt;br /&gt;        "./content/styles.css"&lt;br /&gt;    ]&lt;br /&gt;};&lt;br /&gt;&lt;br /&gt;filesAndFolders.debugFolder = filesAndFolders.buildBaseFolder + "/" + filesAndFolders.debug + "/";&lt;br /&gt;filesAndFolders.releaseFolder = filesAndFolders.buildBaseFolder + "/" + filesAndFolders.release + "/";&lt;br /&gt;&lt;br /&gt;/**&lt;br /&gt; * Create a manifest depending upon the supplied arguments&lt;br /&gt; * &lt;br /&gt; * @param {string} manifestName&lt;br /&gt; * @param {string} bundleName&lt;br /&gt; * @param {boolean} includeRelativePath&lt;br /&gt; * @param {string} pathPrepend&lt;br /&gt; */&lt;br /&gt;function getManifest(manifestName, bundleName, includeRelativePath, pathPrepend) {&lt;br /&gt;&lt;br /&gt;    // Determine filename ("./build/manifest-debug.json" or "./build/manifest-release.json"&lt;br /&gt;    var manifestFile = filesAndFolders.buildBaseFolder + "manifest-" + manifestName + ".json";&lt;br /&gt;&lt;br /&gt;    return manifest({&lt;br /&gt;        bundleName: bundleName,&lt;br /&gt;        includeRelativePath: includeRelativePath,&lt;br /&gt;        manifestFile: manifestFile,&lt;br /&gt;        log: true,&lt;br /&gt;        pathPrepend: pathPrepend,&lt;br /&gt;        pathSeparator: "/"&lt;br /&gt;    });&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;// Delete the build folder&lt;br /&gt;gulp.task("clean", function (cb) {&lt;br /&gt;    del([filesAndFolders.buildBaseFolder], cb);&lt;br /&gt;});&lt;br /&gt;&lt;br /&gt;// Copy across all files in filesAndFolders.scripts to build/debug&lt;br /&gt;gulp.task("scripts-debug", ["clean"], function () {&lt;br /&gt;&lt;br /&gt;    return gulp&lt;br /&gt;        .src(filesAndFolders.scripts, { base: filesAndFolders.base })&lt;br /&gt;        .pipe(gulp.dest(filesAndFolders.debugFolder));&lt;br /&gt;});&lt;br /&gt;&lt;br /&gt;// Create a manifest.json for the debug build - this should have lots of script files in&lt;br /&gt;gulp.task("manifest-scripts-debug", ["scripts-debug"], function () {&lt;br /&gt;&lt;br /&gt;    return gulp&lt;br /&gt;        .src(filesAndFolders.scripts, { base: filesAndFolders.base })&lt;br /&gt;        .pipe(ignore.exclude("**/*.{ts,js.map}")) // Exclude ts and js.map files from the manifest (as they won't become script tags)&lt;br /&gt;        .pipe(getManifest(filesAndFolders.debug, bundleNames.scripts, true));&lt;br /&gt;});&lt;br /&gt;&lt;br /&gt;// Copy across all files in filesAndFolders.styles to build/debug&lt;br /&gt;gulp.task("styles-debug", ["clean"], function () {&lt;br /&gt;&lt;br /&gt;    return gulp&lt;br /&gt;        .src(filesAndFolders.styles, { base: filesAndFolders.base })&lt;br /&gt;        .pipe(gulp.dest(filesAndFolders.debugFolder));&lt;br /&gt;});&lt;br /&gt;&lt;br /&gt;// Create a manifest.json for the debug build - this should have lots of style files in&lt;br /&gt;gulp.task("manifest-styles-debug", ["styles-debug", "manifest-scripts-debug"], function () {&lt;br /&gt;&lt;br /&gt;    return gulp&lt;br /&gt;        .src(filesAndFolders.styles, { base: filesAndFolders.base })&lt;br /&gt;        //.pipe(ignore.exclude("**/*.{ts,js.map}")) // Exclude ts and js.map files from the manifest (as they won't become script tags)&lt;br /&gt;        .pipe(getManifest(filesAndFolders.debug, bundleNames.styles, true));&lt;br /&gt;});&lt;br /&gt;&lt;br /&gt;// Concatenate &amp; Minify JS for release into a single file&lt;br /&gt;gulp.task("scripts-release", ["clean"], function () {&lt;br /&gt;&lt;br /&gt;    return gulp&lt;br /&gt;        .src(filesAndFolders.scripts)&lt;br /&gt;        .pipe(ignore.exclude("**/*.{ts,js.map}"))        // Exclude ts and js.map files - not needed in release mode&lt;br /&gt;                                                         &lt;br /&gt;        .pipe(concat("app.js"))                          // Make a single file - if you want to see the contents then include the line below                                          &lt;br /&gt;        //.pipe(gulp.dest(releaseFolder))                &lt;br /&gt;                                                         &lt;br /&gt;        .pipe(uglify())                                  // Make the file titchy tiny small&lt;br /&gt;        .pipe(rev())                                     // Suffix a version number to it&lt;br /&gt;        .pipe(gulp.dest(filesAndFolders.releaseFolder)); // Write single versioned file to build/release folder&lt;br /&gt;});&lt;br /&gt;&lt;br /&gt;// Create a manifest.json for the release build - this should just have a single file for scripts&lt;br /&gt;gulp.task("manifest-scripts-release", ["scripts-release"], function () {&lt;br /&gt;&lt;br /&gt;    return gulp&lt;br /&gt;        .src(filesAndFolders.buildBaseFolder + filesAndFolders.release + "/*.js")&lt;br /&gt;        .pipe(getManifest(filesAndFolders.release, bundleNames.scripts, false));&lt;br /&gt;});&lt;br /&gt;&lt;br /&gt;// Copy across all files in filesAndFolders.styles to build/debug&lt;br /&gt;gulp.task("styles-release", ["clean"], function () {&lt;br /&gt;&lt;br /&gt;    return gulp&lt;br /&gt;        .src(filesAndFolders.styles)&lt;br /&gt;        .pipe(concat("app.css"))          // Make a single file - if you want to see the contents then include the line below&lt;br /&gt;        //.pipe(gulp.dest(releaseFolder))&lt;br /&gt;&lt;br /&gt;        .pipe(minifyCss())                // Make the file titchy tiny small&lt;br /&gt;        .pipe(rev())                      // Suffix a version number to it&lt;br /&gt;        .pipe(gulp.dest(filesAndFolders.releaseFolder + "/" + filesAndFolders.css)); // Write single versioned file to build/release folder&lt;br /&gt;});&lt;br /&gt;&lt;br /&gt;// Create a manifest.json for the debug build - this should have a single style files in&lt;br /&gt;gulp.task("manifest-styles-release", ["styles-release", "manifest-scripts-release"], function () {&lt;br /&gt;&lt;br /&gt;    return gulp&lt;br /&gt;        .src(filesAndFolders.releaseFolder + "**/*.css")&lt;br /&gt;        .pipe(getManifest(filesAndFolders.release, bundleNames.styles, false, filesAndFolders.css + "/"));&lt;br /&gt;});&lt;br /&gt;&lt;br /&gt;// Copy across all fonts in filesAndFolders.fonts to both release and debug locations&lt;br /&gt;gulp.task("fonts", ["clean"], function () {&lt;br /&gt;&lt;br /&gt;    return gulp&lt;br /&gt;        .src(filesAndFolders.fonts, { base: filesAndFolders.base })&lt;br /&gt;        .pipe(gulp.dest(filesAndFolders.debugFolder))&lt;br /&gt;        .pipe(gulp.dest(filesAndFolders.releaseFolder));&lt;br /&gt;});&lt;br /&gt;&lt;br /&gt;// Default Task&lt;br /&gt;gulp.task("default", [&lt;br /&gt;    "scripts-debug", "manifest-scripts-debug", "styles-debug", "manifest-styles-debug",&lt;br /&gt;    "scripts-release", "manifest-scripts-release", "styles-release", "manifest-styles-release",&lt;br /&gt;    "fonts"&lt;br /&gt;]);&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;h4&gt;What &lt;code&gt;gulpfile.js&lt;/code&gt; does&lt;/h4&gt; &lt;p&gt;This file does a number of things each time it is run.  First of all it deletes any &lt;code&gt;build&lt;/code&gt; folder in the root of the web project so we're ready to build anew.  Then it packages up files both for debug and for release mode. For debug it does the following:&lt;/p&gt; &lt;ol&gt;&lt;li&gt;It copies the &lt;code&gt;ts&lt;/code&gt;, &lt;code&gt;js.map&lt;/code&gt; and &lt;code&gt;js&lt;/code&gt; files declared in &lt;code&gt;filesAndFolders.scripts&lt;/code&gt; to the &lt;code&gt;build/debug&lt;/code&gt; folder preserving their original folder structure.  (So, for example, &lt;code&gt;app/app.ts&lt;/code&gt;, &lt;code&gt;app/app.js.map&lt;/code&gt; and &lt;code&gt;app/app.js&lt;/code&gt; will all end up at &lt;code&gt;build/debug/app/app.ts&lt;/code&gt;, &lt;code&gt;build/debug/app/app.js.map&lt;/code&gt; and &lt;code&gt;build/debug/app/app.js&lt;/code&gt; respectively.)  This is done to allow the continued debugging of the original TypeScript files when running in debug mode.&lt;/li&gt;&lt;li&gt;It copies the &lt;code&gt;css&lt;/code&gt; files declared in &lt;code&gt;filesAndFolders.styles&lt;/code&gt; to the &lt;code&gt;build/debug&lt;/code&gt; folder preserving their original folder structure.  (So &lt;code&gt;content/bootstrap.css&lt;/code&gt; will end up at &lt;code&gt;build/debug/content/bootstrap.css&lt;/code&gt;.) &lt;/li&gt;&lt;li&gt;It creates a &lt;code&gt;build/manifest-debug.json&lt;/code&gt; file which contains details of all the script and style files that have been packaged up:  &lt;pre class="prettyprint json"&gt;&lt;br /&gt;&lt;code class="language-json"&gt;&lt;br /&gt;{&lt;br /&gt;  "scripts":[&lt;br /&gt;    "scripts/angular.js",&lt;br /&gt;    "scripts/angular-animate.js",&lt;br /&gt;    "scripts/angular-route.js",&lt;br /&gt;    "scripts/angular-sanitize.js",&lt;br /&gt;    "scripts/angular-ui/ui-bootstrap-tpls.js",&lt;br /&gt;    "scripts/toastr.js",&lt;br /&gt;    "scripts/moment.js",&lt;br /&gt;    "scripts/spin.js",&lt;br /&gt;    "scripts/underscore.js",&lt;br /&gt;    "app/app.js",&lt;br /&gt;    "app/config.route.js",&lt;br /&gt;    "app/common/common.js",&lt;br /&gt;    "app/common/logger.js",&lt;br /&gt;    "app/common/spinner.js",&lt;br /&gt;    "app/common/bootstrap/bootstrap.dialog.js",&lt;br /&gt;    "app/directives/imgPerson.js",&lt;br /&gt;    "app/directives/serverError.js",&lt;br /&gt;    "app/directives/sidebar.js",&lt;br /&gt;    "app/directives/spinner.js",&lt;br /&gt;    "app/directives/waiter.js",&lt;br /&gt;    "app/directives/widgetClose.js",&lt;br /&gt;    "app/directives/widgetHeader.js",&lt;br /&gt;    "app/directives/widgetMinimize.js",&lt;br /&gt;    "app/services/datacontext.js",&lt;br /&gt;    "app/services/repositories.js",&lt;br /&gt;    "app/services/repository.sage.js",&lt;br /&gt;    "app/services/repository.saying.js",&lt;br /&gt;    "app/about/about.js",&lt;br /&gt;    "app/admin/admin.js",&lt;br /&gt;    "app/dashboard/dashboard.js",&lt;br /&gt;    "app/layout/shell.js",&lt;br /&gt;    "app/layout/sidebar.js",&lt;br /&gt;    "app/layout/topnav.js",&lt;br /&gt;    "app/sages/sageDetail.js",&lt;br /&gt;    "app/sages/sageEdit.js",&lt;br /&gt;    "app/sages/sages.js",&lt;br /&gt;    "app/sayings/sayingEdit.js",&lt;br /&gt;    "app/sayings/sayings.js"&lt;br /&gt;  ],&lt;br /&gt;  "styles":[&lt;br /&gt;    "content/ie10mobile.css",&lt;br /&gt;    "content/bootstrap.css",&lt;br /&gt;    "content/font-awesome.css",&lt;br /&gt;    "content/toastr.css",&lt;br /&gt;    "content/styles.css"&lt;br /&gt;  ]&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt;&lt;/li&gt;&lt;/ol&gt; &lt;p&gt;For release our gulpfile works with the same resources but has a different aim.  Namely to minimise the the number of HTTP requests, obfuscate the code and version the files produced to prevent caching issues.  To achieve those lofty aims it does the following:&lt;/p&gt; &lt;ol&gt;&lt;li&gt;It concatenates together all the &lt;code&gt;js&lt;/code&gt; files declared in &lt;code&gt;filesAndFolders.scripts&lt;/code&gt;, minifies them and writes them  to a single &lt;code&gt;build/release/app-{xxxxx}.js&lt;/code&gt; file (where &lt;code&gt;-{xxxxx}&lt;/code&gt; represents a version created by gulp-rev).&lt;/li&gt;&lt;li&gt;It concatenates together all the &lt;code&gt;css&lt;/code&gt; files declared in &lt;code&gt;filesAndFolders.styles&lt;/code&gt;, minifies them and writes them  to a single &lt;code&gt;build/release/css/app-{xxxxx}.css&lt;/code&gt; file. The file is placed in a css subfolder because of relative paths specified in the CSS file.&lt;/li&gt;&lt;li&gt;It creates a &lt;code&gt;build/manifest-release.json&lt;/code&gt; file which contains details of all the script and style files that have been packaged up:  &lt;pre class="prettyprint json"&gt;&lt;br /&gt;&lt;code class="language-json"&gt;&lt;br /&gt;{&lt;br /&gt;  "scripts":["app-95d1e06d.js"],&lt;br /&gt;  "styles":["css/app-1a6256ea.css"]&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; As you can see, the number of files included are reduced down to 2; 1 for JavaScript and 1 for CSS. &lt;/li&gt;&lt;/ol&gt; &lt;p&gt;Finally, for both the debug and release packages the contents of the &lt;code&gt;fonts&lt;/code&gt; folder is copied across wholesale, preserving the original folder structure.  This is because the CSS files contain relative references that point to the font files.  If I had image files which were referenced by my CSS I'd similarly need to include these in the build process.&lt;/p&gt; &lt;h4&gt;Task Runner Explorer gets in on the action&lt;/h4&gt; &lt;p&gt;The eagle eyed amongst you will also have noticed a peculiar first line to our &lt;code&gt;gulpfile.js&lt;/code&gt;:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;/// &amp;lt;vs AfterBuild='default' /&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;This mysterious comment is actually how the Task Runner Explorer hooks our &lt;code&gt;gulpfile.js&lt;/code&gt; into the Visual Studio build process.  Our "magic comment" ensures that on the &lt;code&gt;AfterBuild&lt;/code&gt; event, Task Runner Explorer runs the &lt;code&gt;default&lt;/code&gt; task in our &lt;code&gt;gulpfile.js&lt;/code&gt;.  The reason we're using the &lt;code&gt;AfterBuild&lt;/code&gt; event rather than the &lt;code&gt;BeforeBuild&lt;/code&gt; event is because our project contains TypeScript and we need the transpiled JavaScript to be created before we can usefully run our package tasks.  If we were using JavaScript alone then that wouldn't be an issue and either build event would do.&lt;/p&gt; &lt;a href="http://3.bp.blogspot.com/-prRrVlSsyXw/VEaD97QeIRI/AAAAAAAAAt0/WT1AElVQw4E/s1600/Screenshot%2B2014-10-21%2B17.02.11.png" imageanchor="1" &gt;&lt;img border="0" src="http://3.bp.blogspot.com/-prRrVlSsyXw/VEaD97QeIRI/AAAAAAAAAt0/WT1AElVQw4E/s640/Screenshot%2B2014-10-21%2B17.02.11.png" /&gt;&lt;/a&gt; &lt;h4&gt;How do I use this in my HTML?&lt;/h4&gt; &lt;p&gt;Well this is magnificent - we have a gulpfile that builds our debug and release packages. The question now is, how do we use it?&lt;/p&gt; &lt;p&gt;Web Optimization made our lives really easy.  Up in my head I had a &lt;code&gt;@Styles.Render("~/Content/css")&lt;/code&gt; which pushed out my CSS and down at the foot of the body tag I had a &lt;code&gt;@Scripts.Render("~/angularApp")&lt;/code&gt; which pushed out my script tags.  &lt;code&gt;Styles&lt;/code&gt; and &lt;code&gt;Scripts&lt;/code&gt; are server-side utilities.  It would be very easy to write equivalent utility classes that, depending on whether we were in debug or not, read the appropriate &lt;code&gt;build/manifest-xxxxxx.json&lt;/code&gt; file and served up either debug or release &lt;code&gt;style&lt;/code&gt; / &lt;code&gt;script&lt;/code&gt; tags.&lt;/p&gt; &lt;p&gt;That would be pretty simple - and for what it's worth &lt;strong&gt;simple is &lt;u&gt;good&lt;/u&gt;&lt;/strong&gt;.  But today I felt like a challenge.  What say server side rendering had been outlawed?  A draconian ruling had been passed and all you had to play with was HTML / JavaScript and a server API that served up JSON?  What would you do then?  (All fantasy I know... But go with me on this - it's a journey.)  Or more sensibly, what if you just want to remove some of the work your app is doing server-side to bundle and minify.  Just serve up static assets instead. Spend less money in Azure why not?&lt;/p&gt; &lt;p&gt;Before I make all the changes let's review where we were.  I had a single MVC view which, in terms of bundles, CSS and JavaScript pretty much looked like this:&lt;/p&gt; &lt;pre class="prettyprint html"&gt;&lt;br /&gt;&lt;code class="language-html"&gt;&lt;br /&gt;&amp;lt;!DOCTYPE html&amp;gt;&lt;br /&gt;&amp;lt;html&amp;gt;&lt;br /&gt;&amp;lt;head&amp;gt;&lt;br /&gt;    &amp;lt;!-- ... --&amp;gt;&lt;br /&gt;    @Styles.Render("~/Content/css")&lt;br /&gt;&amp;lt;/head&amp;gt;&lt;br /&gt;&amp;lt;body&amp;gt;&lt;br /&gt;    &amp;lt;!-- ... --&amp;gt;&lt;br /&gt;&lt;br /&gt;    @Scripts.Render("~/angularApp")&lt;br /&gt;    &amp;lt;script&amp;gt;&lt;br /&gt;    (function () {&lt;br /&gt;        $.getJSON('@Url.Content("~/Home/StartApp")')&lt;br /&gt;            .done(function (startUpData) {&lt;br /&gt;&lt;br /&gt;                var appConfig = $.extend({}, startUpData, {&lt;br /&gt;                    appRoot: '@Url.Content("~/")',&lt;br /&gt;                    remoteServiceRoot: '@Url.Content("~/api/")'&lt;br /&gt;                });&lt;br /&gt;&lt;br /&gt;                angularApp.start({&lt;br /&gt;                    thirdPartyLibs: {&lt;br /&gt;                        moment: window.moment,&lt;br /&gt;                        toastr: window.toastr,&lt;br /&gt;                        underscore: window._&lt;br /&gt;                    },&lt;br /&gt;                    appConfig: appConfig&lt;br /&gt;                });&lt;br /&gt;            });&lt;br /&gt;    })();&lt;br /&gt;    &amp;lt;/script&amp;gt;&lt;br /&gt;&amp;lt;/body&amp;gt;&lt;br /&gt;&amp;lt;/html&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;This is already more a complicated example than most peoples use cases. Essentially what's happening here is both bundles are written out as part of the HTML and then, once the scripts have loaded the Angular app is bootstrapped with some configuration loaded from the server by a good old jQuery AJAX call.&lt;/p&gt; &lt;p&gt;After reading &lt;a href="http://www.html5rocks.com/en/tutorials/speed/script-loading/"&gt;an article about script loading by the magnificently funny Jake Archibald&lt;/a&gt; I felt ready.  I cast my MVC view to the four winds and created myself a straight HTML file:&lt;/p&gt; &lt;pre class="prettyprint html"&gt;&lt;br /&gt;&lt;code class="language-html"&gt;&lt;br /&gt;&amp;lt;!DOCTYPE html&amp;gt;&lt;br /&gt;&amp;lt;html&amp;gt;&lt;br /&gt;&amp;lt;head&amp;gt;&lt;br /&gt;    &amp;lt;!-- ... --&amp;gt;&lt;br /&gt;&amp;lt;/head&amp;gt;&lt;br /&gt;&amp;lt;body&amp;gt;&lt;br /&gt;    &amp;lt;!-- ... --&amp;gt;&lt;br /&gt;&lt;br /&gt;    &amp;lt;script src="Scripts/jquery-2.1.1.min.js"&amp;gt;&amp;lt;/script&amp;gt;&lt;br /&gt;    &amp;lt;script&amp;gt;&lt;br /&gt;        (function () {&lt;br /&gt;&lt;br /&gt;            var appConfig = {};&lt;br /&gt;            var scriptsToLoad;&lt;br /&gt;&lt;br /&gt;            /**&lt;br /&gt;             * Handler which fires as each script loads&lt;br /&gt;             */&lt;br /&gt;            function onScriptLoad(event) {&lt;br /&gt;&lt;br /&gt;                scriptsToLoad -= 1;&lt;br /&gt;&lt;br /&gt;                // Now all the scripts are present start the app&lt;br /&gt;                if (scriptsToLoad === 0) {&lt;br /&gt;                    angularApp.start({&lt;br /&gt;                        thirdPartyLibs: {&lt;br /&gt;                            moment: window.moment,&lt;br /&gt;                            toastr: window.toastr,&lt;br /&gt;                            underscore: window._&lt;br /&gt;                        },&lt;br /&gt;                        appConfig: appConfig&lt;br /&gt;                    });&lt;br /&gt;                }&lt;br /&gt;            }&lt;br /&gt;&lt;br /&gt;            // Load startup data from the server&lt;br /&gt;            $.getJSON("api/Startup")&lt;br /&gt;                .done(function (startUpData) {&lt;br /&gt;&lt;br /&gt;                    appConfig = startUpData;&lt;br /&gt;&lt;br /&gt;                    // Determine the assets folder depending upon whether in debug mode or not&lt;br /&gt;                    var buildFolder = appConfig.appRoot + "build/";&lt;br /&gt;                    var debugOrRelease = (appConfig.inDebug ? "debug" : "release");&lt;br /&gt;                    var manifestFile = buildFolder + "manifest-" + debugOrRelease + ".json";&lt;br /&gt;                    var outputFolder = buildFolder + debugOrRelease + "/";&lt;br /&gt;&lt;br /&gt;                    // Load JavaScript and CSS listed in manifest file&lt;br /&gt;                    $.getJSON(manifestFile)&lt;br /&gt;                        .done(function (manifest){&lt;br /&gt;&lt;br /&gt;                            manifest.styles.forEach(function (href) {&lt;br /&gt;                                var link = document.createElement("link");&lt;br /&gt;&lt;br /&gt;                                link.rel = "stylesheet";&lt;br /&gt;                                link.media = "all";&lt;br /&gt;                                link.href = outputFolder + href;&lt;br /&gt;&lt;br /&gt;                                document.head.appendChild(link);&lt;br /&gt;                            });&lt;br /&gt;&lt;br /&gt;                            scriptsToLoad = manifest.scripts.length;&lt;br /&gt;                            manifest.scripts.forEach(function (src) {&lt;br /&gt;                                var script = document.createElement("script");&lt;br /&gt;&lt;br /&gt;                                script.onload = onScriptLoad;&lt;br /&gt;                                script.src = outputFolder + src;&lt;br /&gt;                                script.async = false;&lt;br /&gt;&lt;br /&gt;                                document.head.appendChild(script);&lt;br /&gt;                            });&lt;br /&gt;                        })&lt;br /&gt;                });&lt;br /&gt;        })();&lt;br /&gt;    &amp;lt;/script&amp;gt;&lt;br /&gt;&amp;lt;/body&amp;gt;&lt;br /&gt;&amp;lt;/html&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;If you very carefully compare the HTML above the MVC view that it replaces you can see the commonalities.  They are doing pretty much the same thing - the only real difference is the bootstrapping API.  Previously it was an MVC endpoint at &lt;code&gt;/Home/StartApp&lt;/code&gt;.  Now it's a Web API endpoint at &lt;code&gt;api/Startup&lt;/code&gt;.  Here's how it works:&lt;/p&gt; &lt;ol&gt;&lt;li&gt;A jQuery AJAX call kicks off a call to load the bootstrapping / app config data.  Importantly this data includes whether the app is running in debug or not.&lt;/li&gt;&lt;li&gt;Depending on the &lt;code&gt;isDebug&lt;/code&gt; flag the app either loads the &lt;code&gt;build/manifest-debug.json&lt;/code&gt; or &lt;code&gt;build/manifest-release.json&lt;/code&gt; manifest.&lt;/li&gt;&lt;li&gt;For each CSS file in the styles bundle a &lt;code&gt;link&lt;/code&gt; element is created and added to the page.&lt;/li&gt;&lt;li&gt;For each JavaScript file in the scripts bundle a &lt;code&gt;script&lt;/code&gt; element is created and added to the page.&lt;/li&gt;&lt;/ol&gt; &lt;p&gt;It's worth pointing out that this also has a performance edge over Web Optimization as the assets are loaded asynchronously! (Yes I know it says &lt;code&gt;script.async = false&lt;/code&gt; but that's not what you think it is... Go read Jake's article!)&lt;/p&gt; &lt;p&gt;To finish off I had to make a few tweaks to my &lt;code&gt;web.config&lt;/code&gt;:&lt;/p&gt; &lt;pre class="prettyprint xml"&gt;&lt;br /&gt;&lt;code class="language-xml"&gt;&lt;br /&gt;    &amp;lt;!-- Allow ASP.Net to serve up JSON files --&amp;gt;&lt;br /&gt;    &amp;lt;system.webServer&amp;gt;&lt;br /&gt;        &amp;lt;staticContent&amp;gt;&lt;br /&gt;            &amp;lt;mimeMap fileExtension=".json" mimeType="application/json"/&amp;gt;&lt;br /&gt;        &amp;lt;/staticContent&amp;gt;&lt;br /&gt;    &amp;lt;/system.webServer&amp;gt;&lt;br /&gt;    &lt;br /&gt;    &amp;lt;!-- The build folder (and it's child folder "debug") will not be cached.&lt;br /&gt;         When people are debugging they don't want to cache --&amp;gt;&lt;br /&gt;    &amp;lt;location path="build"&amp;gt;&lt;br /&gt;        &amp;lt;system.webServer&amp;gt;&lt;br /&gt;            &amp;lt;staticContent&amp;gt;&lt;br /&gt;                &amp;lt;clientCache cacheControlMode="DisableCache"/&amp;gt;&lt;br /&gt;            &amp;lt;/staticContent&amp;gt;&lt;br /&gt;        &amp;lt;/system.webServer&amp;gt;&lt;br /&gt;    &amp;lt;/location&amp;gt;&lt;br /&gt;    &lt;br /&gt;    &amp;lt;!-- The release folder will be cached for a loooooong time&lt;br /&gt;         When you're in Production caching is your friend --&amp;gt;&lt;br /&gt;    &amp;lt;location path="build/release"&amp;gt;&lt;br /&gt;        &amp;lt;system.webServer&amp;gt;&lt;br /&gt;            &amp;lt;staticContent&amp;gt;&lt;br /&gt;                &amp;lt;clientCache cacheControlMode="UseMaxAge"/&amp;gt;&lt;br /&gt;            &amp;lt;/staticContent&amp;gt;&lt;br /&gt;        &amp;lt;/system.webServer&amp;gt;&lt;br /&gt;    &amp;lt;/location&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;h4&gt;I want to publish, how do I include my assets?&lt;/h4&gt; &lt;p&gt;It's time for some &lt;code&gt;csproj&lt;/code&gt; trickery.  I must say I think I'll be glad to see the back of project files when ASP.Net vNext ships.  This is what you need:&lt;/p&gt; &lt;pre class="prettyprint xml"&gt;&lt;br /&gt;&lt;code class="language-xml"&gt;&lt;br /&gt;  &amp;lt;Target Name="AfterBuild"&amp;gt;&lt;br /&gt;    &amp;lt;ItemGroup&amp;gt;&lt;br /&gt;      &amp;lt;!-- what ever is in the build folder should be included in the project --&amp;gt;&lt;br /&gt;      &amp;lt;Content Include="build\**\*.*" /&amp;gt;&lt;br /&gt;    &amp;lt;/ItemGroup&amp;gt;&lt;br /&gt;  &amp;lt;/Target&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;What's happening here is that *&lt;em&gt;after&lt;/em&gt;* a build Visual Studio considers the complete contents of the build folder to part of the project.  It's after the build because the folder will be deleted and reconstructed as part of the build.&lt;/p&gt; </content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5490199177230111925'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5490199177230111925'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2014/11/using-gulp-in-visual-studio-instead-of-web-optimization.html' title='Using Gulp in Visual Studio instead of Web Optimization'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='http://3.bp.blogspot.com/-prRrVlSsyXw/VEaD97QeIRI/AAAAAAAAAt0/WT1AElVQw4E/s72-c/Screenshot%2B2014-10-21%2B17.02.11.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4270237243489670385</id><published>2014-10-10T13:57:00.000+01:00</published><updated>2014-10-10T13:57:04.386+01:00</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Open Source.... Be kind and play nice</title><content type='html'></content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4270237243489670385'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4270237243489670385'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-998556362280039546</id><published>2014-10-06T17:08:00.001+01:00</published><updated>2021-03-03T14:10:41.002Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='TypeScript'/><category scheme='http://www.blogger.com/atom/ns#' term='$http'/><category scheme='http://www.blogger.com/atom/ns#' term='AngularJS'/><category scheme='http://www.blogger.com/atom/ns#' term='interceptors'/><category scheme='http://www.blogger.com/atom/ns#' term='caching'/><title type='text'>Caching and Cache-Busting in AngularJS with HTTP interceptors</title><content type='html'>&lt;h4&gt;Loading On-Demand and Caching&lt;/h4&gt; &lt;p&gt;&lt;a href="http://icanmakethiswork.blogspot.com/2014/03/caching-and-cache-busting-with-requirejs.html"&gt;I've written before about my own needs for caching and cache-busting when using RequireJS.&lt;/a&gt;  Long story short, when I'm loading &lt;em&gt;static&lt;/em&gt; resources (scripts / views etc) on demand from the server I want to do a little URL fiddling along the way.  I want to do that to cater for these 2 scenarios:&lt;/p&gt; &lt;ol&gt;&lt;li&gt;&lt;em&gt;In Development&lt;/em&gt; - I want my URLs for static resources to have a unique querystring with each request to ensure that resources are loaded afresh each time. (eg so a GET request URL might look like this: "/app/layout/sidebar.html?v=IAmRandomYesRandomRandomIsWhatIAm58965782")&lt;/li&gt;&lt;li&gt;&lt;em&gt;In Production&lt;/em&gt; - I want my URLs for static resources to have a querystring with that is driven by the application version number.  This means that static resources can potentially be cached with a given querystring - subsequent requests should result in a 304 status code (indicating Not Modified) and local cache should be used.  But when a new version of the app is rolled out and the app version is incremented then the querystring will change and resources will be loaded anew. (eg a GET request URL might look like this: "/app/layout/sidebar.html?v=1.0.5389.16180")&lt;/li&gt;&lt;/ol&gt; &lt;h4&gt;Loading Views in AngularJS Using this Approach&lt;/h4&gt; &lt;p&gt;I have exactly the same use cases when I'm using AngularJS for views.  Out of the box with AngularJS 1.x views are loaded lazily (unlike controllers, services etc).  For that reason I want to use the same approach I've outlined above to load my views.  Also, I want to prepend my URLs with the root of my application - this allows me to cater for my app being deployed in a virtual folder.&lt;/p&gt; &lt;p&gt;It turns out that's pretty easy thanks to &lt;a href="https://docs.angularjs.org/api/ng/service/$http#interceptors"&gt;HTTP interceptors&lt;/a&gt;.  They allow you to step into the pipeline and access and modify requests and responses made by your application.  When AngularJS loads a view it's the HTTP service doing the heavy lifting.  So to deal with my own use case, I just need to add in an HTTP interceptor that amends the get request. This is handled in the example that follows in the &lt;code&gt;configureHttpProvider&lt;/code&gt; function: (The example that follows is TypeScript - though if you just chopped out the interface and the type declarations you'd find this is pretty much idiomatic JavaScript)&lt;/p&gt; &lt;pre class="prettyprint ts"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;interface config {&lt;br /&gt;    appRoot: string;              // eg "/"&lt;br /&gt;    inDebug: boolean;             // eg true or false&lt;br /&gt;    urlCacheBusterSuffix: string; // if in debug this might look like this: "v=1412608547047", &lt;br /&gt;                                  // if not in debug this might look like this: "v=1.0.5389.16180"&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;function configureHttpProvider() {&lt;br /&gt;&lt;br /&gt;    // This is the name of our HTTP interceptor &lt;br /&gt;    var serviceId = "urlInterceptor"; &lt;br /&gt;&lt;br /&gt;    // We're going to create a service factory which will be our HTTP interceptor&lt;br /&gt;    // It will be injected with a config object which is represented by the config interface above&lt;br /&gt;    app.factory(serviceId, ["$templateCache", "config", &lt;br /&gt;        function ($templateCache: ng.ITemplateCacheService, config: config) {&lt;br /&gt;&lt;br /&gt;        // We're returning an object literal with a single function; the "request" function&lt;br /&gt;        var service = {&lt;br /&gt;            request: request&lt;br /&gt;        };&lt;br /&gt;&lt;br /&gt;        return service;&lt;br /&gt;&lt;br /&gt;        // Request will be called with a request config object which includes the URL which we will amend&lt;br /&gt;        function request(requestConfig: ng.IRequestConfig) {&lt;br /&gt;&lt;br /&gt;            // For the loading of HTML templates we want the appRoot to be prefixed to the path&lt;br /&gt;            // and we want a suffix to either allow caching or prevent caching &lt;br /&gt;            // (depending on whether in debug mode or not)&lt;br /&gt;            if (requestConfig.method === "GET" &amp;&amp; endsWith(requestConfig.url, ".html")) {&lt;br /&gt;&lt;br /&gt;                // If this has already been placed into a primed template cache then we should leave the URL as is&lt;br /&gt;                // so that the version in templateCache is served.  If we tweak the URL then it will not be found&lt;br /&gt;                var cachedAlready = $templateCache.get(requestConfig.url);&lt;br /&gt;                if (!cachedAlready) {&lt;br /&gt;                    // THIS IS THE MAGIC!!!!!!!!!!!!!!!&lt;br /&gt;&lt;br /&gt;                    requestConfig.url = config.appRoot + requestConfig.url + config.urlCacheBusterSuffix;&lt;br /&gt;                &lt;br /&gt;                    // WE NOW HAVE A URL WHICH IS CACHE-FRIENDLY FOR OUR PURPOSES - REJOICE!!!!!!!!!!!&lt;br /&gt;                }&lt;br /&gt;            }&lt;br /&gt;&lt;br /&gt;            return requestConfig;&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        // &lt;a href="http://stackoverflow.com/a/2548133/761388"&gt;a simple JavaScript string "endswith" implementation&lt;/a&gt;&lt;br /&gt;        function endsWith(str: string, suffix: string) {&lt;br /&gt;            return str.indexOf(suffix, str.length - suffix.length) !== -1;&lt;br /&gt;        }&lt;br /&gt;    }]);&lt;br /&gt;&lt;br /&gt;    // This adds our service factory interceptor into the pipeline&lt;br /&gt;    app.config(["$httpProvider", function ($httpProvider: ng.IHttpProvider) {&lt;br /&gt;        $httpProvider.interceptors.push(serviceId);&lt;br /&gt;    }]);&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;This interceptor steps in and amends each ajax request when all the following conditions hold true:&lt;/p&gt; &lt;ol&gt;&lt;li&gt;It's a GET request.&lt;/li&gt;&lt;li&gt;It's requesting a file that ends ".html" - a template basically.&lt;/li&gt;&lt;li&gt;The template cache does not already contain the template.  I left this out at first and got bitten when I found that the contents of the template cache were being ignored for pre-primed templates.  Ugly.&lt;/li&gt;&lt;/ol&gt; &lt;h4&gt;Interesting technique.... How do I apply it?&lt;/h4&gt; &lt;p&gt;Isn't it always much more helpful when you can see an example of code in the context of which it is actually used?  Course it is!  If you want that then take a look at &lt;a href="https://github.com/johnnyreilly/Proverb/blob/master/Proverb.Web/app/app.ts"&gt;&lt;code&gt;app.ts&lt;/code&gt;&lt;/a&gt; on GitHub.  And if you'd like the naked JavaScript well &lt;a href="https://github.com/johnnyreilly/Proverb/blob/master/Proverb.Web/app/app.js"&gt;that's there too&lt;/a&gt;.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/998556362280039546'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/998556362280039546'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2014/10/caching-and-cache-busting-in-angularjs-with-http-interceptors.html' title='Caching and Cache-Busting in AngularJS with HTTP interceptors'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5169879498442222420</id><published>2014-10-03T11:58:00.001+01:00</published><updated>2021-03-04T16:32:16.952Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='unit testing'/><category scheme='http://www.blogger.com/atom/ns#' term='async'/><category scheme='http://www.blogger.com/atom/ns#' term='MOQ'/><category scheme='http://www.blogger.com/atom/ns#' term='metaphysics'/><title type='text'>He tasks me; he heaps me.... I will wreak that MOQ upon him.</title><content type='html'>&lt;p&gt;Enough with the horrific misquotes - this is about Moq and async (that's my slight justification for robbing Herman Melville).&lt;/p&gt; &lt;p&gt;It's pretty straightforward to use Moq to do async testing thanks to it's marvellous &lt;code&gt;ReturnsAsync&lt;/code&gt; method. That means it's really easy to test a class that consumes an async API.  Below is an example of a class that does just that: (it so happens that this class is a Web API controller but that's pretty irrelevant to be honest)&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;namespace Proverb.Web.Controllers&lt;br /&gt;{&lt;br /&gt;    // ISageService included inline for ease of explanation&lt;br /&gt;    public interface ISageService&lt;br /&gt;    {&lt;br /&gt;        Task&amp;lt;int&amp;gt; DeleteAsync(int id);&lt;br /&gt;    }&lt;br /&gt;&lt;br /&gt;    public class SageController : ApiController&lt;br /&gt;    {&lt;br /&gt;        ISageService _sageService;&lt;br /&gt;&lt;br /&gt;        public SageController(ISageService userService) &lt;br /&gt;        {&lt;br /&gt;            _sageService = userService;&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        public async Task&amp;lt;IHttpActionResult&amp;gt; Delete(int id)&lt;br /&gt;        {&lt;br /&gt;            int deleteCount = await _sageService.DeleteAsync(id);&lt;br /&gt;&lt;br /&gt;            if (deleteCount == 0)&lt;br /&gt;                return NotFound();&lt;br /&gt;            else&lt;br /&gt;                return Ok();&lt;br /&gt;        }&lt;br /&gt;   }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;To mock the &lt;code&gt;_sageService.DeleteAsync&lt;/code&gt; method it's as easy as this:&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;namespace Proverb.Web.Tests.ASPNet.Controllers&lt;br /&gt;{&lt;br /&gt;    [TestClass]&lt;br /&gt;    public class SageControllerTests&lt;br /&gt;    {&lt;br /&gt;        private Mock&amp;lt;ISageService&amp;gt; _sageServiceMock;&lt;br /&gt;        private SageController _controller;&lt;br /&gt;&lt;br /&gt;        [TestInitialize]&lt;br /&gt;        public void Initialise()&lt;br /&gt;        {&lt;br /&gt;            _sageServiceMock = new Mock&amp;lt;ISageService&amp;gt;();&lt;br /&gt;&lt;br /&gt;            _controller = new SageController(_sageServiceMock.Object);&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        [TestMethod]&lt;br /&gt;        public async Task Delete_returns_a_NotFound()&lt;br /&gt;        {&lt;br /&gt;            _sageServiceMock&lt;br /&gt;                .Setup(x =&amp;gt; x.DeleteAsync(_sage.Id))&lt;br /&gt;                .ReturnsAsync(0); // This makes me *so* happy...&lt;br /&gt;&lt;br /&gt;            IHttpActionResult result = await _controller.Delete(_sage.Id);&lt;br /&gt;&lt;br /&gt;            var notFound = result as NotFoundResult;&lt;br /&gt;            Assert.IsNotNull(notFound);&lt;br /&gt;            _sageServiceMock.Verify(x =&amp;gt; x.DeleteAsync(_sage.Id));&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        [TestMethod]&lt;br /&gt;        public async Task Delete_returns_an_Ok()&lt;br /&gt;        {&lt;br /&gt;            _sageServiceMock&lt;br /&gt;                .Setup(x =&amp;gt; x.DeleteAsync(_sage.Id))&lt;br /&gt;                .ReturnsAsync(1); // I'm still excited now!&lt;br /&gt;&lt;br /&gt;            IHttpActionResult result = await _controller.Delete(_sage.Id);&lt;br /&gt;&lt;br /&gt;            var ok = result as OkResult;&lt;br /&gt;            Assert.IsNotNull(ok);&lt;br /&gt;            _sageServiceMock.Verify(x =&amp;gt; x.DeleteAsync(_sage.Id));&lt;br /&gt;        }&lt;br /&gt;    }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;h4&gt;But wait.... What if there's like... Nothing?&lt;/h4&gt; &lt;p&gt;Nope, I'm not getting into metaphysics.  Something more simple.  What if the &lt;code&gt;async&lt;/code&gt; API you're consuming returns just a &lt;code&gt;Task&lt;/code&gt;?  Not a &lt;code&gt;Task&lt;/code&gt; of &lt;code&gt;int&lt;/code&gt; but a simple old humble &lt;code&gt;Task&lt;/code&gt;. &lt;/p&gt; &lt;p&gt;So to take our example we're going from this:&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;    public interface ISageService&lt;br /&gt;    {&lt;br /&gt;        Task&amp;lt;int&amp;gt; DeleteAsync(int id);&lt;br /&gt;    }&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;To this:&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;    public interface ISageService&lt;br /&gt;    {&lt;br /&gt;        Task DeleteAsync(int id);&lt;br /&gt;    }&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Your initial thought might be "well that's okay, I'll just lop off the &lt;code&gt;ReturnsAsync&lt;/code&gt; statements and I'm home free".  That's what I thought anyway.... And I was *&lt;strong&gt;WRONG&lt;/strong&gt;*!  A moments thought and you realise that there's still a return type - it's just &lt;code&gt;Task&lt;/code&gt; now.  What you want to do is something like this:&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;            _sageServiceMock&lt;br /&gt;                .Setup(x =&amp;gt; x.DeleteAsync(_sage.Id))&lt;br /&gt;                .ReturnsAsync(void); // This'll definitely work... Probably&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;No it won't - &lt;code&gt;void&lt;/code&gt; is not a real type and much as you might like it to, this is not going to work.&lt;/p&gt; &lt;p&gt;So right now you're thinking, well Moq probably has my back - it'll have something like &lt;code&gt;ReturnsTask&lt;/code&gt;, right?  Wrong! It's intentional it turns out - there's a discussion on &lt;a href="https://github.com/Moq/moq4/issues/117"&gt;GitHub about the issue&lt;/a&gt;.  And in that discussion there's just what we need.  We can use &lt;code&gt;Task.Delay&lt;/code&gt; or &lt;code&gt;Task.FromResult&lt;/code&gt; alongside Moq's good old &lt;code&gt;Returns&lt;/code&gt; method and we're home free!&lt;/p&gt; &lt;h4&gt;Here's one I made earlier...&lt;/h4&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;namespace Proverb.Web.Controllers&lt;br /&gt;{&lt;br /&gt;    // ISageService again included inline for ease of explanation&lt;br /&gt;    public interface ISageService&lt;br /&gt;    {&lt;br /&gt;        Task DeleteAsync(int id);&lt;br /&gt;    }&lt;br /&gt;&lt;br /&gt;    public class SageController : ApiController&lt;br /&gt;    {&lt;br /&gt;        ISageService _sageService;&lt;br /&gt;&lt;br /&gt;        public SageController(ISageService userService) &lt;br /&gt;        {&lt;br /&gt;            _sageService = userService;&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        public async Task&amp;lt;IHttpActionResult&amp;gt; Delete(int id)&lt;br /&gt;        {&lt;br /&gt;            await _sageService.DeleteAsync(id);&lt;br /&gt;&lt;br /&gt;            return Ok();&lt;br /&gt;        }&lt;br /&gt;   }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;namespace Proverb.Web.Tests.ASPNet.Controllers&lt;br /&gt;{&lt;br /&gt;    [TestClass]&lt;br /&gt;    public class SageControllerTests&lt;br /&gt;    {&lt;br /&gt;        private Mock&amp;lt;ISageService&amp;gt; _sageServiceMock;&lt;br /&gt;        private SageController _controller;&lt;br /&gt;&lt;br /&gt;        readonly Task TaskOfNowt = Task.Delay(0);&lt;br /&gt;        // Or you could use this equally valid but slightly more verbose approach:&lt;br /&gt;        //readonly Task TaskOfNowt = Task.FromResult&amp;ltobject&amp;gt;(null);&lt;br /&gt;&lt;br /&gt;        [TestInitialize]&lt;br /&gt;        public void Initialise()&lt;br /&gt;        {&lt;br /&gt;            _sageServiceMock = new Mock&amp;lt;ISageService&amp;gt;();&lt;br /&gt;&lt;br /&gt;            _controller = new SageController(_sageServiceMock.Object);&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        [TestMethod]&lt;br /&gt;        public async Task Delete_returns_an_Ok()&lt;br /&gt;        {&lt;br /&gt;            _sageServiceMock&lt;br /&gt;                .Setup(x =&gt; x.DeleteAsync(_sage.Id))&lt;br /&gt;                .Returns(TaskOfNowt); // Feels good doesn't it?&lt;br /&gt;&lt;br /&gt;            IHttpActionResult result = await _controller.Delete(_sage.Id);&lt;br /&gt;&lt;br /&gt;            var ok = result as OkResult;&lt;br /&gt;            Assert.IsNotNull(ok);&lt;br /&gt;            _sageServiceMock.Verify(x =&gt; x.DeleteAsync(_sage.Id));&lt;br /&gt;        }&lt;br /&gt;    }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5169879498442222420'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5169879498442222420'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2014/10/he-tasks-me-he-heaps-me-i-will-wreak.html' title='He tasks me; he heaps me.... I will wreak that MOQ upon him.'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-237470948844766557</id><published>2014-09-13T11:13:00.003+01:00</published><updated>2021-03-04T19:11:40.414Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='Jasmine'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='TypeScript Language Service'/><category scheme='http://www.blogger.com/atom/ns#' term='TypeScript'/><category scheme='http://www.blogger.com/atom/ns#' term='javascript'/><category scheme='http://www.blogger.com/atom/ns#' term='implicit references'/><title type='text'>Journalling the Migration of Jasmine Tests to TypeScript</title><content type='html'>&lt;p&gt;I previously attempted to migrate my Jasmine tests from JavaScript to TypeScript.  The last time I tried it didn't go so well and I bailed.  Thank the Lord for source control.  But feeling I shouldn't be deterred I decided to have another crack at it.&lt;/p&gt; &lt;p&gt;I did manage it this time... Sort of. Unfortunately there was a problem which I discovered right at the end.  An issue with the TypeScript / Visual Studio tooling.  So, just to be clear, this is not a blog post of "do this and it will work perfectly".  On this occasion there will be some rough edges.  This post exists, as much as anything else, as a record of the problems I experienced - I hope it will prove useful.  Here we go:&lt;/p&gt; &lt;h4&gt;What to Migrate?&lt;/h4&gt; &lt;p&gt;I'm going to use one of the test files in my my side project &lt;a href="https://github.com/johnnyreilly/Proverb"&gt;Proverb&lt;/a&gt;.  It's the tests for an AngularJS controller called &lt;code&gt;sageDetail&lt;/code&gt; - I've written about it &lt;a href="http://icanmakethiswork.blogspot.co.uk/2014/09/unit-testing-angular-controller-with.html"&gt;before&lt;/a&gt;.  Here it is in all it's JavaScript-y glory:&lt;/p&gt; &lt;pre class="prettyprint js" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;describe("Proverb.Web -&amp;gt; app-&amp;gt; controllers -&amp;gt;", function () {&lt;br /&gt;&lt;br /&gt;    beforeEach(function () {&lt;br /&gt;&lt;br /&gt;        module("app");&lt;br /&gt;    });&lt;br /&gt;&lt;br /&gt;    describe("sageDetail -&amp;gt;", function () {&lt;br /&gt;&lt;br /&gt;        var $rootScope,&lt;br /&gt;            getById_deferred, // deferred used for promises&lt;br /&gt;            $location, $routeParams_stub, common, datacontext, // controller dependencies&lt;br /&gt;            sageDetailController; // the controller&lt;br /&gt;&lt;br /&gt;        beforeEach(inject(function (_$controller_, _$rootScope_, _$q_, _$location_, _common_, _datacontext_) {&lt;br /&gt;&lt;br /&gt;            $rootScope = _$rootScope_;&lt;br /&gt;            $q = _$q_;&lt;br /&gt;&lt;br /&gt;            $location = _$location_;&lt;br /&gt;            common = _common_;&lt;br /&gt;            datacontext = _datacontext_;&lt;br /&gt;&lt;br /&gt;            $routeParams_stub = { id: "10" };&lt;br /&gt;            getById_deferred = $q.defer();&lt;br /&gt;&lt;br /&gt;            spyOn(datacontext.sage, "getById").and.returnValue(getById_deferred.promise);&lt;br /&gt;            spyOn(common, "activateController").and.callThrough();&lt;br /&gt;            spyOn(common.logger, "getLogFn").and.returnValue(jasmine.createSpy("log"));&lt;br /&gt;            spyOn($location, "path").and.returnValue(jasmine.createSpy("path"));&lt;br /&gt;&lt;br /&gt;            sageDetailController = _$controller_("sageDetail", {&lt;br /&gt;                $location: $location,&lt;br /&gt;                $routeParams: $routeParams_stub,&lt;br /&gt;                common: common,&lt;br /&gt;                datacontext: datacontext&lt;br /&gt;            });&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;        }));&lt;br /&gt;&lt;br /&gt;        describe("on creation -&amp;gt;", function () {&lt;br /&gt;&lt;br /&gt;            it("controller should have a title of 'Sage Details'", function () {&lt;br /&gt;&lt;br /&gt;                expect(sageDetailController.title).toBe("Sage Details");&lt;br /&gt;            });&lt;br /&gt;&lt;br /&gt;            it("controller should have no sage", function () {&lt;br /&gt;&lt;br /&gt;                expect(sageDetailController.sage).toBeUndefined();&lt;br /&gt;            });&lt;br /&gt;&lt;br /&gt;            it("datacontext.sage.getById should be called", function () {&lt;br /&gt;&lt;br /&gt;                expect(datacontext.sage.getById).toHaveBeenCalledWith(10, true);&lt;br /&gt;            });&lt;br /&gt;        });&lt;br /&gt;&lt;br /&gt;        describe("activateController -&amp;gt;", function () {&lt;br /&gt;&lt;br /&gt;            var sage_stub;&lt;br /&gt;            beforeEach(function () {&lt;br /&gt;                sage_stub = { name: "John" };&lt;br /&gt;            });&lt;br /&gt;&lt;br /&gt;            it("should set sages to be the resolved promise values", function () {&lt;br /&gt;&lt;br /&gt;                getById_deferred.resolve(sage_stub);&lt;br /&gt;                $rootScope.$digest(); // So Angular processes the resolved promise&lt;br /&gt;&lt;br /&gt;                expect(sageDetailController.sage).toBe(sage_stub);&lt;br /&gt;            });&lt;br /&gt;&lt;br /&gt;            it("should log 'Activated Sage Details View' and set title with name", function () {&lt;br /&gt;&lt;br /&gt;                getById_deferred.resolve(sage_stub);&lt;br /&gt;                $rootScope.$digest(); // So Angular processes the resolved promise&lt;br /&gt;&lt;br /&gt;                expect(sageDetailController.log).toHaveBeenCalledWith("Activated Sage Details View");&lt;br /&gt;                expect(sageDetailController.title).toBe("Sage Details: " + sage_stub.name);&lt;br /&gt;            });&lt;br /&gt;        });&lt;br /&gt;&lt;br /&gt;        describe("gotoEdit -&amp;gt;", function () {&lt;br /&gt;&lt;br /&gt;            var sage_stub;&lt;br /&gt;            beforeEach(function () {&lt;br /&gt;                sage_stub = { id: 20 };&lt;br /&gt;            });&lt;br /&gt;&lt;br /&gt;            it("should set $location.path to edit URL", function () {&lt;br /&gt;&lt;br /&gt;                getById_deferred.resolve(sage_stub);&lt;br /&gt;                $rootScope.$digest(); // So Angular processes the resolved promise&lt;br /&gt;&lt;br /&gt;                sageDetailController.gotoEdit();&lt;br /&gt;&lt;br /&gt;                expect($location.path).toHaveBeenCalledWith("/sages/edit/" + sage_stub.id);&lt;br /&gt;            });&lt;br /&gt;        });&lt;br /&gt;    });&lt;br /&gt;});&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;h4&gt;Off we go&lt;/h4&gt; &lt;p&gt;Righteo.  Let's flip the switch.  &lt;code&gt;sageDetail.js&lt;/code&gt;  you shall go to the ball!  One wave of my magic wand and &lt;code&gt;sageDetail.js&lt;/code&gt; becomes &lt;code&gt;sageDetail.ts&lt;/code&gt;... Alakazam!!  Of course we've got to do the fiddling with the &lt;code&gt;csproj&lt;/code&gt; file to include the dependent JavaScript files.  (I'll be very pleased when ASP.Net vNext ships and I don't have to do this anymore....)  So find this:&lt;/p&gt; &lt;pre class="prettyprint xml" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-xml"&gt;&lt;br /&gt;&amp;lt;TypeScriptCompile Include="app\sages\sageDetail.ts" /&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;And add this:&lt;/p&gt; &lt;pre class="prettyprint xml" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-xml"&gt;&lt;br /&gt;&amp;lt;Content Include="app\sages\sageDetail.js"&amp;gt;&lt;br /&gt;  &amp;lt;DependentUpon&amp;gt;sageDetail.ts&amp;lt;/DependentUpon&amp;gt;&lt;br /&gt;&amp;lt;/Content&amp;gt;&lt;br /&gt;&amp;lt;Content Include="app\sages\sageDetail.js.map"&amp;gt;&lt;br /&gt;  &amp;lt;DependentUpon&amp;gt;sageDetail.ts&amp;lt;/DependentUpon&amp;gt;&lt;br /&gt;&amp;lt;/Content&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;What next?  I've a million red squigglies in my code.  It's "could not find symbol" city.  Why?  Typings!  We need typings!  So let's begin - I'm needing the Jasmine typings for starters. So let's hit NuGet and it looks like we need &lt;a href="http://www.nuget.org/packages/jasmine.TypeScript.DefinitelyTyped/"&gt;this&lt;/a&gt;:&lt;/p&gt; &lt;code&gt;Install-Package jasmine.TypeScript.DefinitelyTyped&lt;/code&gt; &lt;p&gt;That did no good at all.  Still red squigglies.  I'm going to hazard a guess that this is something to do with the fact my JavaScript Unit Test project doesn't contain the various TypeScript artefacts that Visual Studio kindly puts into the web csproj for you.  This is because I'm keeping my JavaScript tests in a separate project from the code being tested.  Also, the Visual Studio TypeScript tooling seems to work on the assumption that TypeScript will only be used within a web project; not a test project.  Well I won't let that hold me back... Time to port the TypeScript artefacts in the web csproj over by hand.  I'll take this:&lt;/p&gt; &lt;pre class="prettyprint xml" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-xml"&gt;&lt;br /&gt;&amp;lt;Import Project="$(MSBuildExtensionsPath32)\Microsoft\VisualStudio\v$(VisualStudioVersion)\TypeScript\Microsoft.TypeScript.Default.props" Condition="Exists('$(MSBuildExtensionsPath32)\Microsoft\VisualStudio\v$(VisualStudioVersion)\TypeScript\Microsoft.TypeScript.Default.props')" /&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;And I'll also take this&lt;/p&gt; &lt;pre class="prettyprint xml" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-xml"&gt;&lt;br /&gt;&amp;lt;PropertyGroup Condition="'$(Configuration)' == 'Debug'"&amp;gt;&lt;br /&gt;  &amp;lt;TypeScriptNoImplicitAny&amp;gt;True&amp;lt;/TypeScriptNoImplicitAny&amp;gt;&lt;br /&gt;&amp;lt;/PropertyGroup&amp;gt;&lt;br /&gt;&amp;lt;Import Project="$(MSBuildExtensionsPath32)\Microsoft\VisualStudio\v$(VisualStudioVersion)\TypeScript\Microsoft.TypeScript.targets" Condition="Exists('$(MSBuildExtensionsPath32)\Microsoft\VisualStudio\v$(VisualStudioVersion)\TypeScript\Microsoft.TypeScript.targets')" /&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Bingo bango - a difference.  I no longer have red squigglies under the Jasmine statements (&lt;code&gt;describe&lt;/code&gt;, &lt;code&gt;it&lt;/code&gt; etc).  But alas, I do everywhere else.  One in particular draws my eye...&lt;/p&gt; &lt;h4&gt;Could not find symbol '$q'&lt;/h4&gt; &lt;p&gt;Once again TypeScript picks up the hidden bugs in my JavaScript:&lt;/p&gt; &lt;pre class="prettyprint ts" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;    $q = _$q_;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;That's right it's an implicit global.  Quickly fixed:&lt;/p&gt; &lt;pre class="prettyprint ts" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;    var $q = _$q_;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;h4&gt;Typings? Where we're going, we need typings...&lt;/h4&gt; &lt;p&gt;We need more types.  We're going to need the types created by our application; our controllers / services / directives etc. As well that we need the types used in the creation of the app.  So the Angular typings etc.  Since we're going to need to use &lt;code&gt;reference&lt;/code&gt; statements to pull in the types created by our application I might as well use them to pull in the required definition files as well (eg &lt;code&gt;angular.d.ts&lt;/code&gt;):&lt;/p&gt; &lt;pre class="prettyprint xml" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-xml"&gt;&lt;br /&gt;/// &amp;lt;reference path="../../../proverb.web/scripts/typings/angularjs/angular.d.ts" /&amp;gt;&lt;br /&gt;/// &amp;lt;reference path="../../../proverb.web/scripts/typings/angularjs/angular-mocks.d.ts" /&amp;gt;&lt;br /&gt;/// &amp;lt;reference path="../../../proverb.web/app/sages/sagedetail.ts" /&amp;gt;&lt;br /&gt;/// &amp;lt;reference path="../../../proverb.web/app/common/common.ts" /&amp;gt;&lt;br /&gt;/// &amp;lt;reference path="../../../proverb.web/app/services/datacontext.ts" /&amp;gt;&lt;br /&gt;/// &amp;lt;reference path="../../../proverb.web/app/services/repository.sage.ts" /&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Now we need to work our way through the "variable 'x' implicitly has an 'any' type" messages. One thing we need to do is to amend our original sageDetails.ts file so that the &lt;code&gt;sageDetailRouteParams&lt;/code&gt; interface and &lt;code&gt;SageDetail&lt;/code&gt; class are exported from the controllers module.  We can't use the types otherwise. Now we can add typings to our file - once finished it looks like this:&lt;/p&gt; &lt;pre class="prettyprint ts" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;/// &amp;lt;reference path="../../../proverb.web/scripts/typings/angularjs/angular.d.ts" /&amp;gt;&lt;br /&gt;/// &amp;lt;reference path="../../../proverb.web/scripts/typings/angularjs/angular-mocks.d.ts" /&amp;gt;&lt;br /&gt;/// &amp;lt;reference path="../../../proverb.web/app/sages/sagedetail.ts" /&amp;gt;&lt;br /&gt;/// &amp;lt;reference path="../../../proverb.web/app/common/common.ts" /&amp;gt;&lt;br /&gt;/// &amp;lt;reference path="../../../proverb.web/app/services/datacontext.ts" /&amp;gt;&lt;br /&gt;/// &amp;lt;reference path="../../../proverb.web/app/services/repository.sage.ts" /&amp;gt;&lt;br /&gt;describe("Proverb.Web -&amp;gt; app-&amp;gt; controllers -&amp;gt;", function () {&lt;br /&gt;&lt;br /&gt;    beforeEach(function () {&lt;br /&gt;&lt;br /&gt;        module("app");&lt;br /&gt;    });&lt;br /&gt;&lt;br /&gt;    describe("sageDetail -&amp;gt;", function () {&lt;br /&gt;&lt;br /&gt;        var $rootScope: ng.IRootScopeService,&lt;br /&gt;            // deferred used for promises &lt;br /&gt;            getById_deferred: ng.IDeferred&amp;lt;sage&amp;gt;, &lt;br /&gt;            // controller dependencies&lt;br /&gt;            $location: ng.ILocationService,&lt;br /&gt;            $routeParams_stub: controllers.sageDetailRouteParams,&lt;br /&gt;            common: common,&lt;br /&gt;            datacontext: datacontext,&lt;br /&gt;            sageDetailController: controllers.SageDetail; // the controller&lt;br /&gt;&lt;br /&gt;        beforeEach(inject(function (&lt;br /&gt;            _$controller_: any,&lt;br /&gt;            _$rootScope_: ng.IRootScopeService,&lt;br /&gt;            _$q_: ng.IQService,&lt;br /&gt;            _$location_: ng.ILocationService,&lt;br /&gt;            _common_: common,&lt;br /&gt;            _datacontext_: datacontext) {&lt;br /&gt;&lt;br /&gt;            $rootScope = _$rootScope_;&lt;br /&gt;            var $q = _$q_;&lt;br /&gt;&lt;br /&gt;            $location = _$location_;&lt;br /&gt;            common = _common_;&lt;br /&gt;            datacontext = _datacontext_;&lt;br /&gt;&lt;br /&gt;            $routeParams_stub = { id: "10" };&lt;br /&gt;            getById_deferred = $q.defer();&lt;br /&gt;&lt;br /&gt;            spyOn(datacontext.sage, "getById").and.returnValue(getById_deferred.promise);&lt;br /&gt;            spyOn(common, "activateController").and.callThrough();&lt;br /&gt;            spyOn(common.logger, "getLogFn").and.returnValue(jasmine.createSpy("log"));&lt;br /&gt;            spyOn($location, "path").and.returnValue(jasmine.createSpy("path"));&lt;br /&gt;&lt;br /&gt;            sageDetailController = _$controller_("sageDetail", {&lt;br /&gt;                $location: $location,&lt;br /&gt;                $routeParams: $routeParams_stub,&lt;br /&gt;                common: common,&lt;br /&gt;                datacontext: datacontext&lt;br /&gt;            });&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;        }));&lt;br /&gt;&lt;br /&gt;        describe("on creation -&amp;gt;", function () {&lt;br /&gt;&lt;br /&gt;            it("controller should have a title of 'Sage Details'", function () {&lt;br /&gt;&lt;br /&gt;                expect(sageDetailController.title).toBe("Sage Details");&lt;br /&gt;            });&lt;br /&gt;&lt;br /&gt;            it("controller should have no sage", function () {&lt;br /&gt;&lt;br /&gt;                expect(sageDetailController.sage).toBeUndefined();&lt;br /&gt;            });&lt;br /&gt;&lt;br /&gt;            it("datacontext.sage.getById should be called", function () {&lt;br /&gt;&lt;br /&gt;                expect(datacontext.sage.getById).toHaveBeenCalledWith(10, true);&lt;br /&gt;            });&lt;br /&gt;        });&lt;br /&gt;&lt;br /&gt;        describe("activateController -&amp;gt;", function () {&lt;br /&gt;&lt;br /&gt;            var sage_stub: sage;&lt;br /&gt;            beforeEach(function () {&lt;br /&gt;                sage_stub = { name: "John", id: 10, username: "John", email: "john@", dateOfBirth: new Date() };&lt;br /&gt;            });&lt;br /&gt;&lt;br /&gt;            it("should set sages to be the resolved promise values", function () {&lt;br /&gt;&lt;br /&gt;                getById_deferred.resolve(sage_stub);&lt;br /&gt;                $rootScope.$digest(); // So Angular processes the resolved promise&lt;br /&gt;&lt;br /&gt;                expect(sageDetailController.sage).toBe(sage_stub);&lt;br /&gt;            });&lt;br /&gt;&lt;br /&gt;            it("should log 'Activated Sage Details View' and set title with name", function () {&lt;br /&gt;&lt;br /&gt;                getById_deferred.resolve(sage_stub);&lt;br /&gt;                $rootScope.$digest(); // So Angular processes the resolved promise&lt;br /&gt;&lt;br /&gt;                expect(sageDetailController.log).toHaveBeenCalledWith("Activated Sage Details View");&lt;br /&gt;                expect(sageDetailController.title).toBe("Sage Details: " + sage_stub.name);&lt;br /&gt;            });&lt;br /&gt;        });&lt;br /&gt;&lt;br /&gt;        describe("gotoEdit -&amp;gt;", function () {&lt;br /&gt;&lt;br /&gt;            var sage_stub: sage;&lt;br /&gt;            beforeEach(function () {&lt;br /&gt;                sage_stub = { name: "John", id: 20, username: "John", email: "john@", dateOfBirth: new Date() };&lt;br /&gt;            });&lt;br /&gt;&lt;br /&gt;            it("should set $location.path to edit URL", function () {&lt;br /&gt;&lt;br /&gt;                getById_deferred.resolve(sage_stub);&lt;br /&gt;                $rootScope.$digest(); // So Angular processes the resolved promise&lt;br /&gt;&lt;br /&gt;                sageDetailController.gotoEdit();&lt;br /&gt;&lt;br /&gt;                expect($location.path).toHaveBeenCalledWith("/sages/edit/" + sage_stub.id);&lt;br /&gt;            });&lt;br /&gt;        });&lt;br /&gt;    });&lt;br /&gt;});&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;h4&gt;So That's All Good...&lt;/h4&gt; &lt;p&gt;Except it's not.  When I run the tests using Chutzpah my &lt;code&gt;sageDetail&lt;/code&gt; controller tests aren't found.  My spider sense is tingling.  This is something to do with the &lt;code&gt;reference&lt;/code&gt; statements.  They're throwing Chutzpah off. No bother, I can fix that with a quick tweak of the project file:&lt;/p&gt; &lt;pre class="prettyprint xml" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-xml"&gt;&lt;br /&gt;  &amp;lt;PropertyGroup Condition="'$(Configuration)' == 'Debug'"&amp;gt;&lt;br /&gt;    &amp;lt;TypeScriptNoImplicitAny&amp;gt;True&amp;lt;/TypeScriptNoImplicitAny&amp;gt;&lt;br /&gt;    &amp;lt;TypeScriptRemoveComments&amp;gt;True&amp;lt;/TypeScriptRemoveComments&amp;gt;&lt;br /&gt;  &amp;lt;/PropertyGroup&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;The TypeScript compiler will now strip comments; which includes the &lt;code&gt;reference&lt;/code&gt; statements.  Now my tests are detected *&lt;strong&gt;and&lt;/strong&gt;* they run.  Yay!&lt;/p&gt; &lt;h4&gt;Who Killed the TypeScript Language Service?&lt;/h4&gt; &lt;p&gt;Yup it's dead.  Whilst the compilation itself has no issues, take a look at the errors being presented for just one of the files back in the original web project:&lt;/p&gt; &lt;a href="http://4.bp.blogspot.com/-SYbV5TwnO3Y/VBNwa2TwQPI/AAAAAAAAAtY/oU8dI5Tv-iY/s1600/Screenshot%2B2014-09-12%2B23.15.22.png" imageanchor="1" &gt;&lt;img border="0" src="http://4.bp.blogspot.com/-SYbV5TwnO3Y/VBNwa2TwQPI/AAAAAAAAAtY/oU8dI5Tv-iY/s640/Screenshot%2B2014-09-12%2B23.15.22.png" /&gt;&lt;/a&gt; &lt;p&gt;It looks like having one TypeScript project in a solution which uses &lt;code&gt;reference&lt;/code&gt; comments somehow breaks the implicit referencing behaviour built into Visual Studio for other TypeScript projects in the solution.  I can say this with some confidence as if I pull out the &lt;code&gt;reference&lt;/code&gt; comments from the top of the test file that we've converted then it's business as usual - the TypeScript Language Service lives once more.  I'm sure you can see the problem here though: the TypeScript test file doesn't compile.  All rather unsatisfactory.&lt;/p&gt; &lt;p&gt;I suspect that if I added &lt;code&gt;reference&lt;/code&gt; comments throughout the web project the TypeScript Language Service would be just fine. But I rather like the implicit referencing functionality so I'm not inclined to do that. After reaching something of a brick wall and thinking I had encountered a bug in the TypeScript Language service I &lt;a href="https://github.com/Microsoft/TypeScript/issues/673"&gt;raised an issue on GitHub&lt;/a&gt;.&lt;/p&gt; &lt;h4 id="solutions"&gt;Solutions....&lt;/h4&gt; &lt;p&gt;Thanks to the help of &lt;a href="https://github.com/mhegazy"&gt;Mohamed Hegazy&lt;/a&gt; it emerged that the problem was down to missing &lt;code&gt;reference&lt;/code&gt; comments in my &lt;code&gt;sageDetail&lt;/code&gt; controller tests.  One thing I had not considered was the 2 different ways each of my TypeScript projects were working:&lt;/p&gt; &lt;ul&gt;&lt;li&gt;Proverb.Web uses the Visual Studio implicit referencing functionality.  This means that I do not need to use &lt;code&gt;reference&lt;/code&gt; comments in the TypeScript files in Proverb.Web.&lt;/li&gt;&lt;li&gt;Proverb.Web.JavaScript does *&lt;strong&gt;not&lt;/strong&gt;* uses the implicit referencing functionality.  It needs &lt;code&gt;reference&lt;/code&gt; comments to resolve references.&lt;/li&gt;&lt;/ul&gt; &lt;p&gt;The important thing to take away from this (and the thing I had overlooked) was that Proverb.Web.JavaScript uses &lt;code&gt;reference&lt;/code&gt; comments to pull in Proverb.Web TypeScript files.  Those files have dependencies which are *&lt;strong&gt;not&lt;/strong&gt;* stated using &lt;code&gt;reference&lt;/code&gt; comments.  So the compiler trips up when it tries to walk the dependency tree - there are no &lt;code&gt;reference&lt;/code&gt; comments to be followed!  So for example, &lt;code&gt;common.ts&lt;/code&gt; has a dependency upon &lt;code&gt;logger.ts&lt;/code&gt;. Fixing the TypeScript Language Service involves ensuring that the full dependency list is included in the &lt;code&gt;sageDetail&lt;/code&gt; controller tests file, like so:&lt;/p&gt; &lt;pre class="prettyprint ts"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;/// &amp;lt;reference path="../../../proverb.web/scripts/typings/angularjs/angular.d.ts" /&amp;gt;&lt;br /&gt;/// &amp;lt;reference path="../../../proverb.web/scripts/typings/angularjs/angular-mocks.d.ts" /&amp;gt;&lt;br /&gt;/// &amp;lt;reference path="../../../proverb.web/scripts/typings/angularjs/angular-route.d.ts" /&amp;gt;&lt;br /&gt;/// &amp;lt;reference path="../../../proverb.web/scripts/typings/toastr/toastr.d.ts" /&amp;gt;&lt;br /&gt;/// &amp;lt;reference path="../../../proverb.web/scripts/typings/underscore/underscore.d.ts" /&amp;gt;&lt;br /&gt;/// &amp;lt;reference path="../../../proverb.web/app/sages/sagedetail.ts" /&amp;gt;&lt;br /&gt;/// &amp;lt;reference path="../../../proverb.web/app/common/logger.ts" /&amp;gt;&lt;br /&gt;/// &amp;lt;reference path="../../../proverb.web/app/common/common.ts" /&amp;gt;&lt;br /&gt;/// &amp;lt;reference path="../../../proverb.web/app/services/datacontext.ts" /&amp;gt;&lt;br /&gt;/// &amp;lt;reference path="../../../proverb.web/app/services/repositories.ts" /&amp;gt;&lt;br /&gt;/// &amp;lt;reference path="../../../proverb.web/app/services/repository.sage.ts" /&amp;gt;&lt;br /&gt;/// &amp;lt;reference path="../../../proverb.web/app/services/repository.saying.ts" /&amp;gt;&lt;br /&gt;/// &amp;lt;reference path="../../../proverb.web/app/app.ts" /&amp;gt;&lt;br /&gt;/// &amp;lt;reference path="../../../proverb.web/app/config.route.ts" /&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;With this in place you have a working solution, albeit one that is a little flaky.  &lt;a href="https://github.com/Microsoft/TypeScript/issues/673#issuecomment-56024348"&gt;An alternative solution was suggested by Noel Abrahams&lt;/a&gt; which I quote here:&lt;/p&gt;    &lt;blockquote cite="https://github.com/Microsoft/TypeScript/issues/673#issuecomment-56024348"&gt; &lt;p&gt;Why not do the following?&lt;/p&gt; &lt;ul&gt;&lt;li&gt;Compile Proverb.Web with --declarations and the option for combining output into a single file. This should create a Proverb.Web.d.ts in your output directory.&lt;/li&gt;&lt;li&gt;In Proverb.Web.Tests.JavaScript add a reference to this file.&lt;/li&gt;&lt;li&gt;Right-click Proverb.Web.Tests.JavaScript select "Build Dependencies" &gt; "Project Dependencies" and add a reference to Proverb.Web.&lt;/li&gt;&lt;/ul&gt; &lt;p&gt;I don't think directly referencing TypeScript source files is a good idea, because it causes the file to be rebuilt every time the dependant project is compiled.&lt;/p&gt;&lt;/blockquote&gt; &lt;p&gt;Mohamed rather liked this solution.  It looks like some more work is due to be done on the TypeScript tooling to make this less headache-y in future.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/237470948844766557'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/237470948844766557'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2014/09/migrating-jasmine-tests-to-typescript.html' title='Journalling the Migration of Jasmine Tests to TypeScript'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='http://4.bp.blogspot.com/-SYbV5TwnO3Y/VBNwa2TwQPI/AAAAAAAAAtY/oU8dI5Tv-iY/s72-c/Screenshot%2B2014-09-12%2B23.15.22.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2064870951929258096</id><published>2014-09-10T14:44:00.001+01:00</published><updated>2021-03-04T17:19:59.070Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='Jasmine'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Controllers'/><category scheme='http://www.blogger.com/atom/ns#' term='promises'/><category scheme='http://www.blogger.com/atom/ns#' term='Unit tests'/><category scheme='http://www.blogger.com/atom/ns#' term='AngularJS'/><title type='text'>Unit Testing an Angular Controller with Jasmine</title><content type='html'>&lt;p&gt;Anyone who reads my blog will know that I have been long in the habit of writing unit tests for my C# code.  I'm cool like that.  However, it took me a while to get up and running writing unit tests for my JavaScript code.  I finally &lt;a href="http://icanmakethiswork.blogspot.com/2014/03/the-surprisingly-happy-tale-of-visual.html"&gt;got there&lt;/a&gt; using a combination of Jasmine 2.0 and Chutzpah. (Jasmine being my test framework and Chutzpah being my test runner.)&lt;/p&gt; &lt;p&gt;I'm getting properly into the habit of testing my JavaScript.  I won't pretend it's been particularly fun but I firmly believe it will end up being useful... That's what I tell myself during the long dark tea-times of the soul anyway.&lt;/p&gt; &lt;p&gt;I have a side project called &lt;a href="https://github.com/johnnyreilly/Proverb"&gt;Proverb&lt;/a&gt;.  It doesn't do anything in particular - for the most part it's a simple application that displays the collected wise sayings of a team that I used to be part of.  There's not much to it - a bit of CRUD, a dashboard.  Not much more. Because of the project's simplicity it's ideal to use Proverb's underlying idea when trying out new technologies / frameworks.  &lt;a href="http://en.wikipedia.org/wiki/Paul_Halmos"&gt;The best way to learn is to do&lt;/a&gt;.  So if I want to learn "X", then building Proverb using "X" is a good way to go.&lt;/p&gt; &lt;p&gt;I digress already.  I had a version of Proverb built using a combination of &lt;a href="https://github.com/johnnyreilly/Proverb/tree/master/AngularTypeScript"&gt;AngularJS and TypeScript&lt;/a&gt;.  I had written the Angular side of Proverb without any tests.  Now I was able to write JavaScript tests for my Angular code that's just what I set out to do.  It should prove something of a of &lt;a href="http://en.wikipedia.org/wiki/Kata_(programming)"&gt;Code Kata&lt;/a&gt; too.&lt;/p&gt; &lt;p&gt;Whilst I'm at it I thought it might prove helpful if I wrote up how I approached writing unit tests for a single Angular controller. So here goes.&lt;/p&gt; &lt;h4&gt;What I'm Testing&lt;/h4&gt; &lt;p&gt;I have an Angular controller called &lt;code&gt;sagesDetail&lt;/code&gt;. It powers this screen:&lt;/p&gt; &lt;a href="http://1.bp.blogspot.com/--OBcJ0FLlmI/VBA_R_UpnXI/AAAAAAAAAtE/Zi4K4dR6PU8/s1600/sageDetailScreen.png" imageanchor="1" &gt;&lt;img border="0" src="http://1.bp.blogspot.com/--OBcJ0FLlmI/VBA_R_UpnXI/AAAAAAAAAtE/Zi4K4dR6PU8/s640/sageDetailScreen.png" /&gt;&lt;/a&gt; &lt;p&gt;&lt;code&gt;sagesDetail&lt;/code&gt; is a very simple controller.  It does these things:&lt;/p&gt; &lt;ol&gt;&lt;li&gt;Load the "sage" (think of it as just a "user") and make it available on the controller so it can be bound to the view.&lt;/li&gt;&lt;li&gt;Set the view title.&lt;/li&gt;&lt;li&gt;Log view activation.&lt;/li&gt;&lt;li&gt;Expose a &lt;code&gt;gotoEdit&lt;/code&gt; method which, when called, redirects the user to the edit screen.&lt;/li&gt;&lt;/ol&gt; &lt;p&gt;The controller is written in TypeScript and looks like this:&lt;/p&gt; &lt;h5&gt;sagesDetail.ts&lt;/h5&gt; &lt;pre class="prettyprint ts" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;module controllers {&lt;br /&gt;&lt;br /&gt;    "use strict";&lt;br /&gt;&lt;br /&gt;    var controllerId = "sageDetail";&lt;br /&gt;&lt;br /&gt;    interface sageDetailRouteParams extends ng.route.IRouteParamsService {&lt;br /&gt;        id: string;&lt;br /&gt;    }&lt;br /&gt;&lt;br /&gt;    class SageDetail {&lt;br /&gt;&lt;br /&gt;        log: loggerFunction;&lt;br /&gt;        sage: sage;&lt;br /&gt;        title: string;&lt;br /&gt;&lt;br /&gt;        static $inject = ["$location", "$routeParams", "common", "datacontext"];&lt;br /&gt;        constructor(&lt;br /&gt;            private $location: ng.ILocationService,&lt;br /&gt;            private $routeParams: sageDetailRouteParams,&lt;br /&gt;            private common: common,&lt;br /&gt;            private datacontext: datacontext&lt;br /&gt;            ) {&lt;br /&gt;&lt;br /&gt;            this.sage = undefined;&lt;br /&gt;            this.title = "Sage Details";&lt;br /&gt;&lt;br /&gt;            this.log = common.logger.getLogFn(controllerId);&lt;br /&gt;&lt;br /&gt;            this.activate();&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        // Prototype methods&lt;br /&gt;&lt;br /&gt;        activate() {&lt;br /&gt;            var id = parseInt(this.$routeParams.id, 10);&lt;br /&gt;            var dataPromises: ng.IPromise&amp;lt;any&amp;gt;[] = [this.datacontext.sage.getById(id, true).then(data =&gt; this.sage = data)];&lt;br /&gt;&lt;br /&gt;            this.common.activateController(dataPromises, controllerId, this.title)&lt;br /&gt;                .then(() =&gt; {&lt;br /&gt;                    this.log("Activated Sage Details View");&lt;br /&gt;                    this.title = "Sage Details: " + this.sage.name;&lt;br /&gt;                });&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        gotoEdit() {&lt;br /&gt;            this.$location.path("/sages/edit/" + this.sage.id);&lt;br /&gt;        }&lt;br /&gt;    }&lt;br /&gt;&lt;br /&gt;    angular.module("app").controller(controllerId, SageDetail);&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;When compiled to JavaScript it looks like this:&lt;/p&gt; &lt;h5&gt;sageDetail.js&lt;/h5&gt; &lt;pre class="prettyprint js" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;var controllers;&lt;br /&gt;(function (controllers) {&lt;br /&gt;    "use strict";&lt;br /&gt;&lt;br /&gt;    var controllerId = "sageDetail";&lt;br /&gt;&lt;br /&gt;    var SageDetail = (function () {&lt;br /&gt;        function SageDetail($location, $routeParams, common, datacontext) {&lt;br /&gt;            this.$location = $location;&lt;br /&gt;            this.$routeParams = $routeParams;&lt;br /&gt;            this.common = common;&lt;br /&gt;            this.datacontext = datacontext;&lt;br /&gt;            this.sage = undefined;&lt;br /&gt;            this.title = "Sage Details";&lt;br /&gt;&lt;br /&gt;            this.log = common.logger.getLogFn(controllerId);&lt;br /&gt;&lt;br /&gt;            this.activate();&lt;br /&gt;        }&lt;br /&gt;        // Prototype methods&lt;br /&gt;        SageDetail.prototype.activate = function () {&lt;br /&gt;            var _this = this;&lt;br /&gt;            var id = parseInt(this.$routeParams.id, 10);&lt;br /&gt;            var dataPromises = [this.datacontext.sage.getById(id, true).then(function (data) {&lt;br /&gt;                    return _this.sage = data;&lt;br /&gt;                })];&lt;br /&gt;&lt;br /&gt;            this.common.activateController(dataPromises, controllerId, this.title).then(function () {&lt;br /&gt;                _this.log("Activated Sage Details View");&lt;br /&gt;                _this.title = "Sage Details: " + _this.sage.name;&lt;br /&gt;            });&lt;br /&gt;        };&lt;br /&gt;&lt;br /&gt;        SageDetail.prototype.gotoEdit = function () {&lt;br /&gt;            this.$location.path("/sages/edit/" + this.sage.id);&lt;br /&gt;        };&lt;br /&gt;        SageDetail.$inject = ["$location", "$routeParams", "common", "datacontext"];&lt;br /&gt;        return SageDetail;&lt;br /&gt;    })();&lt;br /&gt;&lt;br /&gt;    angular.module("app").controller(controllerId, SageDetail);&lt;br /&gt;})(controllers || (controllers = {}));&lt;br /&gt;//# sourceMappingURL=sageDetail.js.map&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;h4&gt;Now for the Tests&lt;/h4&gt; &lt;p&gt;I haven't yet made the move of switching over my Jasmine tests from JavaScript to TypeScript. (It's on my list but there's only so many things you can do at once...)  For that reason the tests you'll see here are straight JavaScript. Below you will see the tests for the &lt;code&gt;sageDetail&lt;/code&gt; controller.&lt;/p&gt; &lt;p&gt;I have put very comments in the test code to make clear the intent to you, dear reader.  Annotated the life out of them. Naturally I wouldn't expect a test to be so heavily annotated in a typical test suite - and you can be sure mine normally aren't!&lt;/p&gt; &lt;h5&gt;Jasmine tests for sageDetail.js&lt;/h5&gt; &lt;pre class="prettyprint js" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;describe("Proverb.Web -&gt; app-&gt; controllers -&gt;", function () {&lt;br /&gt;&lt;br /&gt;    // Before each test runs we're going to need ourselves an Angular App to test - go fetch!&lt;br /&gt;    beforeEach(function () {&lt;br /&gt;&lt;br /&gt;        module("app");  // module is an alias for &lt;a href="https://docs.angularjs.org/api/ngMock/function/angular.mock.module"&gt;angular.mock.module&lt;/a&gt;&lt;br /&gt;    });&lt;br /&gt;&lt;br /&gt;    // Tests for the sageDetail controller&lt;br /&gt;    describe("sageDetail -&gt;", function () {&lt;br /&gt;&lt;br /&gt;        // Declare describe-scoped variables &lt;br /&gt;        var $rootScope, &lt;br /&gt;            getById_deferred, // deferred used for promises&lt;br /&gt;            $location, $routeParams_stub, common, datacontext, // controller dependencies&lt;br /&gt;            sageDetailController; // the controller&lt;br /&gt;&lt;br /&gt;        // Before each test runs set up the controller using inject - an alias for &lt;a href="https://docs.angularjs.org/api/ngMock/function/angular.mock.inject"&gt;angular.mock.inject&lt;/a&gt;&lt;br /&gt;        beforeEach(inject(function (_$controller_, _$rootScope_, _$q_, _$location_, _common_, _datacontext_) {&lt;br /&gt;&lt;br /&gt;            // Note how each parameter is prefixed and suffixed with "_" - this an Angular nicety&lt;br /&gt;            // which allows you to have variables in your tests with the original reference name.&lt;br /&gt;            // So here we assign the injected parameters to the describe-scoped variables:&lt;br /&gt;            $rootScope = _$rootScope_;&lt;br /&gt;            $q = _$q_;&lt;br /&gt;            $location = _$location_;&lt;br /&gt;            common = _common_;&lt;br /&gt;            datacontext = _datacontext_;&lt;br /&gt;&lt;br /&gt;            // Our controller has a dependency on an "id" property passed on the $routeParams&lt;br /&gt;            // We're going to stub this out with a JavaScript object literal&lt;br /&gt;            $routeParams_stub = { id: "10" };&lt;br /&gt;&lt;br /&gt;            // Our controller depends on a promise returned from this function: datacontext.sage.getById&lt;br /&gt;            // Well strictly speaking it also uses a promise for activateController but since the activateController&lt;br /&gt;            // promise just wraps the getById promise it will be resolved when the getById promise is.&lt;br /&gt;            // Here we create a deferred representing the getById promise which we can resolve as we need to &lt;br /&gt;            getById_deferred = $q.defer();&lt;br /&gt;&lt;br /&gt;            // set up a spy on datacontext.sage.getById and set it to return the promise of getById_deferred&lt;br /&gt;            // this allows us to #1 detect that getById has been called &lt;br /&gt;            // and #2 resolve / reject our promise as our test requires using getById_deferred&lt;br /&gt;            spyOn(datacontext.sage, "getById").and.returnValue(getById_deferred.promise);&lt;br /&gt;&lt;br /&gt;            // set up a spy on common.activateController and set it to call through&lt;br /&gt;            // this allows us to detect that activateController has been called whilst &lt;br /&gt;            // maintaining existing controller functionality&lt;br /&gt;            spyOn(common, "activateController").and.callThrough();&lt;br /&gt;&lt;br /&gt;            // set up spys on common.logger.getLogFn and $location.path so we can detect they have been called&lt;br /&gt;            spyOn(common.logger, "getLogFn").and.returnValue(jasmine.createSpy("log"));&lt;br /&gt;            spyOn($location, "path").and.returnValue(jasmine.createSpy("path"));&lt;br /&gt;&lt;br /&gt;            // create a sageDetail controller and inject the dependencies we have set up&lt;br /&gt;            sageDetailController = _$controller_("sageDetail", {&lt;br /&gt;                $location: $location,&lt;br /&gt;                $routeParams: $routeParams_stub,&lt;br /&gt;                common: common,&lt;br /&gt;                datacontext: datacontext&lt;br /&gt;            });&lt;br /&gt;        }));&lt;br /&gt;&lt;br /&gt;        // Tests for the controller state at the point of the sageDetail controller's creation&lt;br /&gt;        // ie before the getById / activateController promises have been resolved &lt;br /&gt;        // So this tests the constructor (function) and the activate function up to the point&lt;br /&gt;        // of the promise calls&lt;br /&gt;        describe("on creation -&gt;", function () {&lt;br /&gt;&lt;br /&gt;            it("controller should have a title of 'Sage Details'", function () {&lt;br /&gt;&lt;br /&gt;                // tests this code has executed:&lt;br /&gt;                // this.title = "Sage Details";&lt;br /&gt;                expect(sageDetailController.title).toBe("Sage Details");&lt;br /&gt;            });&lt;br /&gt;&lt;br /&gt;            it("controller should have no sage", function () {&lt;br /&gt;&lt;br /&gt;                // tests this code has executed:&lt;br /&gt;                // this.sage = undefined;&lt;br /&gt;                expect(sageDetailController.sage).toBeUndefined();&lt;br /&gt;            });&lt;br /&gt;&lt;br /&gt;            it("datacontext.sage.getById should be called", function () {&lt;br /&gt;&lt;br /&gt;                // tests this code has executed:&lt;br /&gt;                // this.datacontext.sage.getById(id, true)&lt;br /&gt;                expect(datacontext.sage.getById).toHaveBeenCalledWith(10, true);&lt;br /&gt;            });&lt;br /&gt;        });&lt;br /&gt;&lt;br /&gt;        // Tests for the controller state at the point of the resolution of the getById promise&lt;br /&gt;        // ie after the getById / activateController promises have been resolved &lt;br /&gt;        // So this tests the constructor (function) and the activate function after the point&lt;br /&gt;        // of the promise calls&lt;br /&gt;        describe("activateController -&gt;", function () {&lt;br /&gt;&lt;br /&gt;            var sage_stub;&lt;br /&gt;            beforeEach(function () {&lt;br /&gt;                // Create a sage stub which will be used when resolving the getById promise&lt;br /&gt;                sage_stub = { name: "John" };&lt;br /&gt;            });&lt;br /&gt;&lt;br /&gt;            it("should set sages to be the resolved promise values", function () {&lt;br /&gt;&lt;br /&gt;                // Resolve the getById promise with the sage stub&lt;br /&gt;                getById_deferred.resolve(sage_stub);&lt;br /&gt;                $rootScope.$digest(); // So Angular processes the resolved promise&lt;br /&gt;&lt;br /&gt;                // tests this code has executed:&lt;br /&gt;                // this.sage = data&lt;br /&gt;                expect(sageDetailController.sage).toBe(sage_stub);&lt;br /&gt;            });&lt;br /&gt;&lt;br /&gt;            it("should log 'Activated Sage Details View' and set title with name", function () {&lt;br /&gt;&lt;br /&gt;                // Resolve the getById promise with the sage stub&lt;br /&gt;                getById_deferred.resolve(sage_stub);&lt;br /&gt;                $rootScope.$digest(); // So Angular processes the resolved promise&lt;br /&gt;&lt;br /&gt;                // tests this code has executed:&lt;br /&gt;                // this.log("Activated Sage Details View");&lt;br /&gt;                // this.title = "Sage Details: " + this.sage.name;&lt;br /&gt;                expect(sageDetailController.log).toHaveBeenCalledWith("Activated Sage Details View");&lt;br /&gt;                expect(sageDetailController.title).toBe("Sage Details: " + sage_stub.name);&lt;br /&gt;            });&lt;br /&gt;        });&lt;br /&gt;&lt;br /&gt;        // Tests for the gotoEdit function on the controller&lt;br /&gt;        // Note that this will only be called *after* a controller has been created&lt;br /&gt;        // and it depends upon a sage having first been loaded&lt;br /&gt;        describe("gotoEdit -&gt;", function () {&lt;br /&gt;&lt;br /&gt;            var sage_stub;&lt;br /&gt;            beforeEach(function () {&lt;br /&gt;                // Create a sage stub which will be used when resolving the getById promise&lt;br /&gt;                sage_stub = { id: 20 };&lt;br /&gt;            });&lt;br /&gt;&lt;br /&gt;            it("should set $location.path to edit URL", function () {&lt;br /&gt;&lt;br /&gt;                // Resolve the getById promise with the sage stub&lt;br /&gt;                getById_deferred.resolve(sage_stub);&lt;br /&gt;                $rootScope.$digest(); // So Angular processes the resolved promise&lt;br /&gt;&lt;br /&gt;                sageDetailController.gotoEdit();&lt;br /&gt;&lt;br /&gt;                // tests this code has executed:&lt;br /&gt;                // this.$location.path("/sages/edit/" + this.sage.id);&lt;br /&gt;                expect($location.path).toHaveBeenCalledWith("/sages/edit/" + sage_stub.id);&lt;br /&gt;            });&lt;br /&gt;        });&lt;br /&gt;    });&lt;br /&gt;});&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2064870951929258096'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2064870951929258096'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2014/09/unit-testing-angular-controller-with.html' title='Unit Testing an Angular Controller with Jasmine'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='http://1.bp.blogspot.com/--OBcJ0FLlmI/VBA_R_UpnXI/AAAAAAAAAtE/Zi4K4dR6PU8/s72-c/sageDetailScreen.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1119249749116092462</id><published>2014-09-06T22:21:00.003+01:00</published><updated>2021-03-04T17:23:08.346Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='Jasmine'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='javascript'/><category scheme='http://www.blogger.com/atom/ns#' term='Unit tests'/><category scheme='http://www.blogger.com/atom/ns#' term='Continuous Integration'/><category scheme='http://www.blogger.com/atom/ns#' term='AppVeyor'/><category scheme='http://www.blogger.com/atom/ns#' term='Chutzpah'/><title type='text'>Running JavaScript Unit Tests in AppVeyor</title><content type='html'>&lt;h4&gt;With a little help from Chutzpah...&lt;/h4&gt; &lt;p&gt;&lt;a href="http://www.appveyor.com"&gt;AppVeyor&lt;/a&gt; (if you're not aware of it) is a Continuous Integration provider.  If you like, it's plug-and-play CI for .NET developers.  It's lovely.  And what's more it's &lt;a href="http://www.appveyor.com/pricing"&gt;"free for open-source projects with public repositories hosted on GitHub and BitBucket"&lt;/a&gt;.  Boom!  I recently hooked up 2 of my GitHub projects with AppVeyor.  It took me all of... 10 minutes.  If that?  It really is *&lt;strong&gt;that&lt;/strong&gt;* good.&lt;/p&gt; &lt;p&gt;But.... There had to be a "but" otherwise I wouldn't have been writing the post you're reading.  For a little side project of mine called &lt;a href="https://github.com/johnnyreilly/Proverb"&gt;Proverb&lt;/a&gt; there were C# unit tests and there were JavaScript unit tests.  And the JavaScript unit tests weren't being run... No fair!!!&lt;/p&gt; &lt;p&gt;&lt;a href="https://chutzpah.codeplex.com/"&gt;Chutzpah&lt;/a&gt; is a JavaScript test runner which at this point runs QUnit, Jasmine and Mocha JavaScript tests.  I use the &lt;a href="http://visualstudiogallery.msdn.microsoft.com/f8741f04-bae4-4900-81c7-7c9bfb9ed1fe"&gt;Visual Studio extension&lt;/a&gt; to run Jasmine  tests on my machine during development. I've also been able to use &lt;a href="http://icanmakethiswork.blogspot.com/2014/03/the-surprisingly-happy-tale-of-visual.html"&gt;Chutzpah for CI purposes with Visual Studio Online / Team Foundation Server&lt;/a&gt;.  So what say we try and do the triple and make it work with AppVeyor too?&lt;/p&gt; &lt;h4&gt;NuGet me?&lt;/h4&gt; &lt;p&gt;In order that I could run Chutzpah I needed Chutzpah to be installed on the build machine.  So I had 2 choices:&lt;/p&gt; &lt;ol&gt;&lt;li&gt;Add Chutzpah direct to the repo&lt;/li&gt;&lt;li&gt;Add the &lt;a href="http://www.nuget.org/packages/chutzpah"&gt;Chutzpah Nuget package&lt;/a&gt; to the solution&lt;/li&gt;&lt;/ol&gt; &lt;p&gt;Unsurprisingly I chose #2 - much cleaner.&lt;/p&gt; &lt;h4&gt;Now to use Chutzpah&lt;/h4&gt; &lt;p&gt;Time to dust down the PowerShell.  I created myself a "before tests script" and added it to my build.  It looked a little something like this:&lt;/p&gt; &lt;pre class="prettyprint ps"&gt;&lt;br /&gt;&lt;code class="language-ps"&gt;&lt;br /&gt;# Locate Chutzpah&lt;br /&gt;&lt;br /&gt;$ChutzpahDir = get-childitem chutzpah.console.exe -recurse | select-object -first 1 | select -expand Directory&lt;br /&gt;&lt;br /&gt;# Run tests using Chutzpah and export results as JUnit format to chutzpah-results.xml&lt;br /&gt;&lt;br /&gt;$ChutzpahCmd = "$($ChutzpahDir)\chutzpah.console.exe $($env:APPVEYOR_BUILD_FOLDER)\AngularTypeScript\Proverb.Web.Tests.JavaScript /junit .\chutzpah-results.xml"&lt;br /&gt;Write-Host $ChutzpahCmd&lt;br /&gt;Invoke-Expression $ChutzpahCmd&lt;br /&gt;&lt;br /&gt;# Upload results to AppVeyor one by one&lt;br /&gt;&lt;br /&gt;$testsuites = [xml](get-content .\chutzpah-results.xml)&lt;br /&gt;&lt;br /&gt;$anyFailures = $FALSE&lt;br /&gt;foreach ($testsuite in $testsuites.testsuites.testsuite) {&lt;br /&gt;    write-host " $($testsuite.name)"&lt;br /&gt;    foreach ($testcase in $testsuite.testcase){&lt;br /&gt;        $failed = $testcase.failure&lt;br /&gt;        $time = $testsuite.time&lt;br /&gt;        if ($testcase.time) { $time = $testcase.time }&lt;br /&gt;        if ($failed) {&lt;br /&gt;            write-host "Failed   $($testcase.name) $($testcase.failure.message)"&lt;br /&gt;            Add-AppveyorTest $testcase.name -Outcome Failed -FileName $testsuite.name -ErrorMessage $testcase.failure.message -Duration $time&lt;br /&gt;            $anyFailures = $TRUE&lt;br /&gt;        }&lt;br /&gt;        else {&lt;br /&gt;            write-host "Passed   $($testcase.name)"&lt;br /&gt;            Add-AppveyorTest $testcase.name -Outcome Passed -FileName $testsuite.name -Duration $time&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;    }&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;if ($anyFailures -eq $TRUE){&lt;br /&gt;    write-host "Failing build as there are broken tests"&lt;br /&gt;    $host.SetShouldExit(1)&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;What this does is:&lt;/p&gt; &lt;ol&gt;&lt;li&gt;Run Chutzpah from the installed NuGet package location, passing in the location of my Jasmine unit tests. In the case of my project there is a &lt;code&gt;chutzpah.json&lt;/code&gt; file in the project which dictates how Chutzpah should run the tests.  Also, &lt;a href="https://chutzpah.codeplex.com/wikipage?title=Command%20Line%20Options&amp;referringTitle=Documentation"&gt;the JUnit flag is also passed&lt;/a&gt; in order that Chutzpah creates a &lt;code&gt;chutzpah-results.xml&lt;/code&gt; file of test results in the JUnit format.&lt;/li&gt;&lt;li&gt;We iterate through test results and tell AppVeyor about the the test passes and failures using the &lt;a href="http://www.appveyor.com/docs/build-worker-api"&gt;Build Worker API&lt;/a&gt;.&lt;/li&gt;&lt;li&gt;If there have been any failed tests then we fail the build. If you look &lt;a href="https://ci.appveyor.com/project/JohnReilly/proverb/build/1.0.17"&gt;here&lt;/a&gt; you can see a deliberately failed build which demo's  that this works as it should.&lt;/li&gt;&lt;/ol&gt; &lt;p&gt;That's a wrap - We now have CI which includes our JavaScript tests! That's right we get to see beautiful screens like these:&lt;/p&gt; &lt;a href="http://4.bp.blogspot.com/--GGN2YPhzkk/VAtx-JUkwAI/AAAAAAAAAsg/XPIJ7PICFsA/s1600/Screenshot%2B2014-09-06%2B21.43.15.png" imageanchor="1" &gt;&lt;img border="0" src="http://4.bp.blogspot.com/--GGN2YPhzkk/VAtx-JUkwAI/AAAAAAAAAsg/XPIJ7PICFsA/s640/Screenshot%2B2014-09-06%2B21.43.15.png" /&gt;&lt;/a&gt; &lt;a href="http://3.bp.blogspot.com/-NNrq3w-EbCg/VAtzVPUOsqI/AAAAAAAAAsw/akwN8-J9K1k/s1600/Screenshot%2B2014-09-06%2B21.49.38.png" imageanchor="1" &gt;&lt;img border="0" src="http://3.bp.blogspot.com/-NNrq3w-EbCg/VAtzVPUOsqI/AAAAAAAAAsw/akwN8-J9K1k/s640/Screenshot%2B2014-09-06%2B21.49.38.png" /&gt;&lt;/a&gt; &lt;h4&gt;Thanks to...&lt;/h4&gt; &lt;p&gt;Thanks to Dan Jones, whose comments on &lt;a href="http://help.appveyor.com/discussions/questions/390-running-jasmine-on-appveyor#comment_34433599"&gt;this discussion&lt;/a&gt; provided a number of useful pointers which moved me in the right direction. And thanks to Feador Fitzner who has generously &lt;a href="http://help.appveyor.com/discussions/questions/495-integrating-chutzpah-into-appveyor#comment_34447202"&gt;said AppVeyor will support JUnit in the future&lt;/a&gt; which may simplify use of Chutzpah with AppVeyor even further.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1119249749116092462'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1119249749116092462'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2014/09/running-javascript-unit-tests-in-appveyor.html' title='Running JavaScript Unit Tests in AppVeyor'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='http://4.bp.blogspot.com/--GGN2YPhzkk/VAtx-JUkwAI/AAAAAAAAAsg/XPIJ7PICFsA/s72-c/Screenshot%2B2014-09-06%2B21.43.15.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5322815276435320237</id><published>2014-08-12T12:11:00.001+01:00</published><updated>2021-03-04T17:24:12.368Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Directives'/><category scheme='http://www.blogger.com/atom/ns#' term='TypeScript'/><category scheme='http://www.blogger.com/atom/ns#' term='javascript'/><category scheme='http://www.blogger.com/atom/ns#' term='UI Bootstrap'/><category scheme='http://www.blogger.com/atom/ns#' term='Isolated Scope'/><category scheme='http://www.blogger.com/atom/ns#' term='AngularJS'/><title type='text'>My Unrequited Love for Isolate Scope</title><content type='html'>&lt;p&gt;&lt;a href="http://icanmakethiswork.blogspot.com/2014/08/angularjs-meet-aspnet-server-validation.html"&gt;I wrote a little while ago about creating a directive to present server errors on the screen in an Angular application&lt;/a&gt;.  In my own (not so humble opinion), it was really quite nice.  I was particularly proud of my usage of isolate scope.  However, pride comes before a fall.&lt;/p&gt; &lt;p&gt;It turns out that using isolate scope in a directive is not always wise.  Or rather  not always possible.  And this is why:&lt;/p&gt; &lt;code&gt;Error: [$compile:multidir] Multiple directives [datepickerPopup, serverError] asking for new/isolated scope on: &amp;lt;input name="sage.dateOfBirth" class="col-xs-12 col-sm-9" type="text" value="" ng-click="vm.dateOfBirthDatePickerOpen()" server-error="vm.errors" ng-model="vm.sage.dateOfBirth" is-open="vm.dateOfBirthDatePickerIsOpen" datepicker-popup="dd MMM yyyy"&amp;gt; &lt;/code&gt; &lt;p&gt;Ug.  What happened here?  Well, I had a date field that I was using my serverError directive on.  Nothing too controversial there.  The problem came when I tried to plug in &lt;a href="http://angular-ui.github.io/bootstrap/"&gt;UI Bootstraps datepicker&lt;/a&gt; as well.  Thats right the directives are fighting. Sad face.&lt;/p&gt; &lt;p&gt;To be more precise, it turns out that only one directive on an element is allowed to create an isolated scope.  So if I want to use UI Bootstraps datepicker (and I do)  well my serverError directive is toast.&lt;/p&gt; &lt;h4&gt;A New Hope&lt;/h4&gt; &lt;p&gt;So ladies and gentlemen, let me present serverError 2.0  this time without isolated scope:&lt;/p&gt; &lt;h5&gt;serverError.ts&lt;/h5&gt; &lt;pre class="prettyprint ts" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;(function () {&lt;br /&gt;  "use strict";&lt;br /&gt;&lt;br /&gt;  var app = angular.module("app");&lt;br /&gt;&lt;br /&gt;  // Plant a validation message to the right of the element when it is declared invalid by the server&lt;br /&gt;  app.directive("serverError", [function () {&lt;br /&gt;&lt;br /&gt;    // Usage:&lt;br /&gt;    // &amp;lt;input class="col-xs-12 col-sm-9" &lt;br /&gt;    //        name="sage.name" ng-model="vm.sage.name" server-error="vm.errors" /&amp;gt;&lt;br /&gt;&lt;br /&gt;    var directive = {&lt;br /&gt;      link: link,&lt;br /&gt;      restrict: "A",&lt;br /&gt;      require: "ngModel" // supply the ngModel controller as the 4th parameter in the link function&lt;br /&gt;    };&lt;br /&gt;    return directive;&lt;br /&gt;&lt;br /&gt;    function link(scope: ng.IScope, element: ng.IAugmentedJQuery, attrs: ng.IAttributes, ngModelController: ng.INgModelController) {&lt;br /&gt;      // Extract values from attributes (deliberately not using isolated scope)&lt;br /&gt;      var errorKey: string = attrs["name"]; // eg "sage.name"&lt;br /&gt;      var errorDictionaryExpression: string = attrs["serverError"]; // eg "vm.errors"&lt;br /&gt;&lt;br /&gt;      // Bootstrap alert template for error&lt;br /&gt;      var template = '&amp;lt;div class="alert alert-danger col-xs-9 col-xs-offset-2" role="alert"&amp;gt;&amp;lt;i class="glyphicon glyphicon-warning-sign larger"&amp;gt;&amp;lt;/i&amp;gt; %error%&amp;lt;/div&amp;gt;';&lt;br /&gt;&lt;br /&gt;      // Create an element to hold the validation message&lt;br /&gt;      var decorator = angular.element('&amp;lt;div&amp;gt;&amp;lt;/div&amp;gt;');&lt;br /&gt;      element.after(decorator);&lt;br /&gt;&lt;br /&gt;      // Watch ngModelController.$error.server &amp; show/hide validation accordingly&lt;br /&gt;      scope.$watch(safeWatch(() =&amp;gt; ngModelController.$error.server), showHideValidation);&lt;br /&gt;&lt;br /&gt;      function showHideValidation(serverError: boolean) {&lt;br /&gt;&lt;br /&gt;        // Display an error if serverError is true otherwise clear the element&lt;br /&gt;        var errorHtml = "";&lt;br /&gt;        if (serverError) {&lt;br /&gt;          var errorDictionary: { [field: string]: string } = scope.$eval(errorDictionaryExpression);&lt;br /&gt;          errorHtml = template.replace(/%error%/, errorDictionary[errorKey] || "Unknown error occurred...");&lt;br /&gt;        }&lt;br /&gt;        decorator.html(errorHtml);&lt;br /&gt;      }&lt;br /&gt;&lt;br /&gt;      // wipe the server error message upon keyup or change events so can revalidate with server &lt;br /&gt;      element.on("keyup change", (event) =&amp;gt; {&lt;br /&gt;        scope.$apply(() =&amp;gt; { ngModelController.$setValidity("server", true); });&lt;br /&gt;      });&lt;br /&gt;    }&lt;br /&gt;  }]);&lt;br /&gt;&lt;br /&gt;  // Thanks @Basarat! http://stackoverflow.com/a/24863256/761388&lt;br /&gt;  function safeWatch&amp;lt;T extends Function&amp;gt;(expression: T) {&lt;br /&gt;    return () =&amp;gt; {&lt;br /&gt;      try {&lt;br /&gt;        return expression();&lt;br /&gt;      }&lt;br /&gt;      catch (e) {&lt;br /&gt;        return null;&lt;br /&gt;      }&lt;br /&gt;    };&lt;br /&gt;  }&lt;br /&gt;})();&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;h5&gt;serverError.js&lt;/h5&gt; &lt;pre class="prettyprint js" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;(function () {&lt;br /&gt;  "use strict";&lt;br /&gt;&lt;br /&gt;  var app = angular.module("app");&lt;br /&gt;&lt;br /&gt;  // Plant a validation message to the right of the element when it is declared invalid by the server&lt;br /&gt;  app.directive("serverError", [function () {&lt;br /&gt;    // Usage:&lt;br /&gt;    // &amp;lt;input class="col-xs-12 col-sm-9" &lt;br /&gt;    //        name="sage.name" ng-model="vm.sage.name" server-error="vm.errors" /&amp;gt;&lt;br /&gt;    var directive = {&lt;br /&gt;      link: link,&lt;br /&gt;      restrict: "A",&lt;br /&gt;      require: "ngModel"&lt;br /&gt;    };&lt;br /&gt;    return directive;&lt;br /&gt;&lt;br /&gt;    function link(scope, element, attrs, ngModelController) {&lt;br /&gt;      // Extract values from attributes (deliberately not using isolated scope)&lt;br /&gt;      var errorKey = attrs["name"];&lt;br /&gt;      var errorDictionaryExpression = attrs["serverError"];&lt;br /&gt;&lt;br /&gt;      // Bootstrap alert template for error&lt;br /&gt;      var template = '&amp;lt;div class="alert alert-danger col-xs-9 col-xs-offset-2" role="alert"&amp;gt;&amp;lt;i class="glyphicon glyphicon-warning-sign larger"&amp;gt;&amp;lt;/i&amp;gt; %error%&amp;lt;/div&amp;gt;';&lt;br /&gt;&lt;br /&gt;      // Create an element to hold the validation message&lt;br /&gt;      var decorator = angular.element('&amp;lt;div&amp;gt;&amp;lt;/div&amp;gt;');&lt;br /&gt;      element.after(decorator);&lt;br /&gt;&lt;br /&gt;      // Watch ngModelController.$error.server &amp; show/hide validation accordingly&lt;br /&gt;      scope.$watch(safeWatch(function () {&lt;br /&gt;        return ngModelController.$error.server;&lt;br /&gt;      }), showHideValidation);&lt;br /&gt;&lt;br /&gt;      function showHideValidation(serverError) {&lt;br /&gt;        // Display an error if serverError is true otherwise clear the element&lt;br /&gt;        var errorHtml = "";&lt;br /&gt;        if (serverError) {&lt;br /&gt;        var errorDictionary = scope.$eval(errorDictionaryExpression);&lt;br /&gt;        errorHtml = template.replace(/%error%/, errorDictionary[errorKey] || "Unknown error occurred...");&lt;br /&gt;        }&lt;br /&gt;        decorator.html(errorHtml);&lt;br /&gt;      }&lt;br /&gt;&lt;br /&gt;      // wipe the server error message upon keyup or change events so can revalidate with server&lt;br /&gt;      element.on("keyup change", function (event) {&lt;br /&gt;        scope.$apply(function () {&lt;br /&gt;        ngModelController.$setValidity("server", true);&lt;br /&gt;        });&lt;br /&gt;      });&lt;br /&gt;    }&lt;br /&gt;  }]);&lt;br /&gt;&lt;br /&gt;  // Thanks @Basarat! http://stackoverflow.com/a/24863256/761388&lt;br /&gt;  function safeWatch(expression) {&lt;br /&gt;    return function () {&lt;br /&gt;    try  {&lt;br /&gt;      return expression();&lt;br /&gt;    } catch (e) {&lt;br /&gt;      return null;&lt;br /&gt;    }&lt;br /&gt;    };&lt;br /&gt;  }&lt;br /&gt;})();&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;This version of the serverError directive is from a users perspective identical to the previous version.  But it doesnt use isolated scope  this means it can be used in concert with other directives which do.&lt;/p&gt; &lt;p&gt;It works by pulling the &lt;code&gt;name&lt;/code&gt; and &lt;code&gt;serverError&lt;/code&gt; values off the attrs parameter.  &lt;code&gt;name&lt;/code&gt; is just a string - the value of which never changes so it can be used as is.  &lt;code&gt;serverError&lt;/code&gt; is an expression that represents the error dictionary that is used to store the server error messages.  This is accessed through use of &lt;code&gt;scope.$eval&lt;/code&gt; as an when it needs to.&lt;/p&gt; &lt;h4&gt;My Plea&lt;/h4&gt; &lt;p&gt;What Ive outlined here works.  Ill admit that usage of &lt;code&gt;$eval&lt;/code&gt; makes me feel a little bit dirty (Ive got &lt;a href="http://www.jslint.com/lint.html#evil"&gt;eval is evil&lt;/a&gt; running through my head). Whilst it works, Im not sure what Ive done is necessarily best practice.  After all &lt;a href="https://docs.angularjs.org/guide/directive"&gt;the Angular docs themselves say&lt;/a&gt;:&lt;/p&gt; &lt;blockquote cite="https://docs.angularjs.org/guide/directive"&gt;&lt;em&gt;&lt;strong&gt;Best Practice:&lt;/strong&gt; Use the scope option to create isolate scopes when making components that you want to reuse throughout your app. &lt;/em&gt;&lt;/blockquote&gt; &lt;p&gt;But as weve seen this isnt always an option.  Ive written this post to document my own particular struggle and ask the question is there a better way?  If you know then please tell me!&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5322815276435320237'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5322815276435320237'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2014/08/my-unrequited-love-for-isolate-scope.html' title='My Unrequited Love for Isolate Scope'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2818250275425830020</id><published>2014-08-08T10:27:00.002+01:00</published><updated>2021-03-04T17:25:27.383Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Web API 2'/><category scheme='http://www.blogger.com/atom/ns#' term='IHttpActionResult'/><title type='text'>Getting more RESTful with Web API and IHttpActionResult</title><content type='html'>&lt;p&gt;Up until, well yesterday really, I tended to have my Web API action methods all returning &lt;a href="http://en.wikipedia.org/wiki/HTTP_200#2xx_Success"&gt;200&lt;/a&gt;'s no matter what.  Successful request? 200 for you sir!  Some validation error in the model?  200 for you too ma'am - but I'll wrap up the validation errors and send them back too.  Database error?  200 and and an error message.&lt;/p&gt; &lt;p&gt;It kind of looked like this (this example taken from a &lt;a href="http://icanmakethiswork.blogspot.co.uk/2014/08/angularjs-meet-aspnet-server-validation.html"&gt;previous post&lt;/a&gt;):&lt;/p&gt;   &lt;pre class="prettyprint cs" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;public class SageController : ApiController&lt;br /&gt;{&lt;br /&gt;  // ...&lt;br /&gt;&lt;br /&gt;  public IHttpActionResult Post(User sage)&lt;br /&gt;  {&lt;br /&gt;    if (!ModelState.IsValid) {&lt;br /&gt;&lt;br /&gt;      return Ok(new {&lt;br /&gt;        Success = false,&lt;br /&gt;        Errors = ModelState.ToErrorDictionary()&lt;br /&gt;      });&lt;br /&gt;    }&lt;br /&gt;&lt;br /&gt;    sage = _userService.Save(sage);&lt;br /&gt;&lt;br /&gt;    return Ok(new {&lt;br /&gt;      Success = true,&lt;br /&gt;      Entity = sage&lt;br /&gt;    });&lt;br /&gt;  }&lt;br /&gt;&lt;br /&gt;  // ...&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Well I'm no RESTafarian but this felt a little... wrong.  Like I wasn't fully embracing the web.  I didn't want to have to include my own &lt;code&gt;Success&lt;/code&gt; flag to indicate whether the request was good or not.  I decided that I'd rather have it at least a little more webby.  To that end, I decided I'd like to have 2xx success status codes for genuine success only and 4xx client error status codes for failures.&lt;/p&gt; &lt;p&gt;Lose the wrapper - embrace the web.  This post is about doing just that.&lt;/p&gt; &lt;h4&gt;Web API 2 - Bad Job on on the BadRequest Helper&lt;/h4&gt; &lt;p&gt;Web API 2 ships with a whole host of API helper methods.  Things like &lt;code&gt;Ok&lt;/code&gt; (which you can see me using above) and &lt;code&gt;BadRequest&lt;/code&gt;.  &lt;code&gt;BadRequest&lt;/code&gt; was what I had in mind to use in place of &lt;code&gt;Ok&lt;/code&gt; where I had some kind of error I wanted to report to the client like so:&lt;/p&gt; &lt;pre class="prettyprint cs" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;public class SageController : ApiController&lt;br /&gt;{&lt;br /&gt;  // ...&lt;br /&gt;&lt;br /&gt;  public IHttpActionResult Post(User sage)&lt;br /&gt;  {&lt;br /&gt;    if (!ModelState.IsValid) {&lt;br /&gt;&lt;br /&gt;      return BadRequest(new  { &lt;br /&gt;        Errors = ModelState.ToErrorDictionary()&lt;br /&gt;      });&lt;br /&gt;    }&lt;br /&gt;&lt;br /&gt;    sage = _userService.Save(sage);&lt;br /&gt;&lt;br /&gt;    return Ok(new {&lt;br /&gt;      Entity = sage&lt;br /&gt;    });&lt;br /&gt;  }&lt;br /&gt;&lt;br /&gt;  // ...&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Looks good right?  No more need for my &lt;code&gt;Success&lt;/code&gt; flag.  Terser.  Less code is better code.  Unfortunately the built in &lt;code&gt;BadRequest&lt;/code&gt; helper method doesn't have the flexibility of the &lt;code&gt;Ok&lt;/code&gt; helper method - it doesn't allow you to send anything back you want.  Fortunately this is easily remedied with a short extension method for &lt;code&gt;ApiController&lt;/code&gt;:&lt;/p&gt; &lt;pre class="prettyprint cs" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;using System.Net;&lt;br /&gt;using System.Web.Http;&lt;br /&gt;using System.Web.Http.Results;&lt;br /&gt;&lt;br /&gt;namespace System.Web.Http&lt;br /&gt;{&lt;br /&gt;    public static class ControllerExtensions&lt;br /&gt;    {&lt;br /&gt;        public static IHttpActionResult BadRequest&amp;lt;T&amp;gt;(this ApiController controller, T obj)&lt;br /&gt;        {&lt;br /&gt;            return new NegotiatedContentResult&amp;lt;T&amp;gt;(HttpStatusCode.BadRequest, obj, controller);&lt;br /&gt;        }&lt;br /&gt;    }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;With this in place I can then tweak my implementation to hook into the extension method:&lt;/p&gt; &lt;pre class="prettyprint cs" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;public class SageController : ApiController&lt;br /&gt;{&lt;br /&gt;  // ...&lt;br /&gt;&lt;br /&gt;  public IHttpActionResult Post(User sage)&lt;br /&gt;  {&lt;br /&gt;    if (!ModelState.IsValid) {&lt;br /&gt;      // See how we have "this." before BadRequest so the Extension method is invoked&lt;br /&gt;      return this.BadRequest(new  { &lt;br /&gt;        Errors = ModelState.ToErrorDictionary()&lt;br /&gt;      });&lt;br /&gt;    }&lt;br /&gt;&lt;br /&gt;    sage = _userService.Save(sage);&lt;br /&gt;&lt;br /&gt;    return Ok(new {&lt;br /&gt;      Entity = sage&lt;br /&gt;    });&lt;br /&gt;  }&lt;br /&gt;&lt;br /&gt;  // ...&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;And now we have have an endpoint that serves up 2xx status codes or 4xx status codes just as I'd hoped.  Obviously this change in the way my action methods are returning will have implications for the consuming client (in my case an app built using AngularJS and $q).  Essentially I can now use my &lt;code&gt;then&lt;/code&gt; to handle the successes and my &lt;code&gt;catch&lt;/code&gt; to handle the errors.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2818250275425830020'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2818250275425830020'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2014/08/getting-more-RESTful-with-Web-API.html' title='Getting more RESTful with Web API and IHttpActionResult'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4107411949171295182</id><published>2014-08-01T12:15:00.001+01:00</published><updated>2021-03-03T14:15:03.377Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='asp.net'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='directive'/><category scheme='http://www.blogger.com/atom/ns#' term='TypeScript'/><category scheme='http://www.blogger.com/atom/ns#' term='server validation'/><category scheme='http://www.blogger.com/atom/ns#' term='AngularJS'/><title type='text'>AngularJS meet ASP.Net Server Validation</title><content type='html'>&lt;p&gt;So.  You're using AngularJS to build your front end with ASP.Net running on the server side.  You're a trustworthy dev - you know that validation on the client will only get you so far.  You need to validate on the server.&lt;/p&gt; &lt;p&gt;My particular scenario is where you have a form which you are saving.  Angular serves you well when it comes to hooking in your own client side validation.  But it doesn't really ship with anything that supports &lt;strong&gt;nicely&lt;/strong&gt; presenting server side validation on the client.  Invariably when you look around you find people duplicating their server side validation on the client and presenting all their server side validation in a &lt;code&gt;&amp;lt;div&amp;gt;&lt;/code&gt; at the top of the screen.&lt;/p&gt; &lt;p&gt;This works but it's not as helpful to the user as it might be.  It groups together all the validation from the server into one place.  What I want is field level validation from the server that's presented on a field level basis on the screen.  Like this:&lt;/p&gt; &lt;a href="http://2.bp.blogspot.com/-vxr6_ajRNj8/U9tQjs3SS3I/AAAAAAAAAr8/1HoOUJdPO0w/s1600/server-error.png" imageanchor="1" &gt;&lt;img border="0" src="http://2.bp.blogspot.com/-vxr6_ajRNj8/U9tQjs3SS3I/AAAAAAAAAr8/1HoOUJdPO0w/s320/server-error.png" /&gt;&lt;/a&gt; &lt;p&gt;I know.  &lt;a href="http://en.wikipedia.org/wiki/Endymion_(poem)"&gt;A thing of beauty is a joy forever.&lt;/a&gt;  Let us travel together to this promised land...&lt;/p&gt; &lt;h4&gt;What do we need client side?&lt;/h4&gt; &lt;p&gt;Well, let's start with a directive which I'll call &lt;code&gt;serverError&lt;/code&gt;.  This plants a validation message just &lt;em&gt;after&lt;/em&gt; the element being validated which is displayed when that element is declared invalid by the server.  (That is to say when the &lt;code&gt;ngModel&lt;/code&gt; has a &lt;code&gt;$error.server&lt;/code&gt; set.)  When the element is changed then the &lt;code&gt;$error.server&lt;/code&gt; is unset in order that validation can be hidden and the form can be revalidated against the server.&lt;/p&gt; &lt;p&gt;I'm using TypeScript with Angular so for my JavaScript examples I'll give you both the TypeScript which I originally wrote and the generated JavaScript as well.&lt;/p&gt; &lt;h5&gt;TypeScript&lt;/h5&gt; &lt;pre class="prettyprint ts" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;interface serverErrorScope extends ng.IScope {&lt;br /&gt;    name: string;&lt;br /&gt;    serverError: { [field: string]: string };&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;app.directive("serverError", [function () {&lt;br /&gt;&lt;br /&gt;  // Usage:&lt;br /&gt;  // &amp;lt;input class="col-xs-12 col-sm-9" &lt;br /&gt;  //        name="sage.name" ng-model="vm.sage.name" server-error="vm.errors" /&amp;gt;&lt;br /&gt;  var directive = {&lt;br /&gt;    link: link,&lt;br /&gt;    restrict: "A",&lt;br /&gt;    require: "ngModel", // supply the ngModel controller as the 4th parameter in the link function&lt;br /&gt;    scope: { // Pass in name and serverError to the scope&lt;br /&gt;      name: "@",&lt;br /&gt;      serverError: "="&lt;br /&gt;    }&lt;br /&gt;  };&lt;br /&gt;  return directive;&lt;br /&gt;&lt;br /&gt;  function link(scope: serverErrorScope, element: ng.IAugmentedJQuery, attrs: ng.IAttributes, ngModelController: ng.INgModelController) {&lt;br /&gt;&lt;br /&gt;    // Bootstrap alert template for error&lt;br /&gt;    var template = '&amp;lt;div class="alert alert-danger" role="alert"&amp;gt;' +&lt;br /&gt;                               '&amp;lt;i class="glyphicon glyphicon-warning-sign"&amp;gt;&amp;lt;/i&amp;gt; ' +&lt;br /&gt;                               '%error%&amp;lt;/div&amp;gt;';&lt;br /&gt;&lt;br /&gt;    // Create an element to hold the validation message&lt;br /&gt;    var decorator = angular.element('&amp;lt;div&amp;gt;&amp;lt;/div&amp;gt;');&lt;br /&gt;    element.after(decorator);&lt;br /&gt;&lt;br /&gt;    // Watch ngModelController.$error.server &amp; show/hide validation accordingly&lt;br /&gt;    scope.$watch(safeWatch(() =&amp;gt; ngModelController.$error.server), showHideValidation);&lt;br /&gt;&lt;br /&gt;    function showHideValidation(serverError: boolean) {&lt;br /&gt;&lt;br /&gt;      // Display an error if serverError is true otherwise clear the element&lt;br /&gt;      var errorHtml = "";&lt;br /&gt;      if (serverError) {&lt;br /&gt;        // Aliasing serverError and name to make it more obvious what their purpose is&lt;br /&gt;        var errorDictionary = scope.serverError;&lt;br /&gt;        var errorKey = scope.name;&lt;br /&gt;        errorHtml = template.replace(/%error%/, errorDictionary[errorKey] || "Unknown error occurred...");&lt;br /&gt;      }&lt;br /&gt;      decorator.html(errorHtml);&lt;br /&gt;    }&lt;br /&gt;&lt;br /&gt;    // wipe the server error message upon keyup or change events so can revalidate with server &lt;br /&gt;    element.on("keyup change", (event) =&amp;gt; {&lt;br /&gt;      scope.$apply(() =&amp;gt; { ngModelController.$setValidity("server", true); });&lt;br /&gt;    });&lt;br /&gt;  }&lt;br /&gt;}]);&lt;br /&gt;&lt;br /&gt;// Thanks @Basarat! http://stackoverflow.com/a/24863256/761388&lt;br /&gt;function safeWatch&lt;T extends Function&gt;(expression: T) {&lt;br /&gt;  return () =&gt; {&lt;br /&gt;    try {&lt;br /&gt;      return expression();&lt;br /&gt;    }&lt;br /&gt;    catch (e) {&lt;br /&gt;      return null;&lt;br /&gt;    }&lt;br /&gt;  };&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;h5&gt;JavaScript&lt;/h5&gt; &lt;pre class="prettyprint js" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;app.directive("serverError", [function () {&lt;br /&gt;  // Usage:&lt;br /&gt;  // &amp;lt;input class="col-xs-12 col-sm-9" &lt;br /&gt;  //        name="sage.name" ng-model="vm.sage.name" server-error="vm.errors" /&amp;gt;&lt;br /&gt;  var directive = {&lt;br /&gt;    link: link,&lt;br /&gt;    restrict: "A",&lt;br /&gt;    require: "ngModel",&lt;br /&gt;    scope: {&lt;br /&gt;      name: "@",&lt;br /&gt;      serverError: "="&lt;br /&gt;    }&lt;br /&gt;  };&lt;br /&gt;  return directive;&lt;br /&gt;&lt;br /&gt;  function link(scope, element, attrs, ngModelController) {&lt;br /&gt;    // Bootstrap alert template for error&lt;br /&gt;    var template = '&amp;lt;div class="alert alert-danger" role="alert"&amp;gt;' +&lt;br /&gt;                               '&amp;lt;i class="glyphicon glyphicon-warning-sign"&amp;gt;&amp;lt;/i&amp;gt; ' +&lt;br /&gt;                               '%error%&amp;lt;/div&amp;gt;';&lt;br /&gt;&lt;br /&gt;    // Create an element to hold the validation message&lt;br /&gt;    var decorator = angular.element('&amp;lt;div&amp;gt;&amp;lt;/div&amp;gt;');&lt;br /&gt;    element.after(decorator);&lt;br /&gt;&lt;br /&gt;    // Watch ngModelController.$error.server &amp; show/hide validation accordingly&lt;br /&gt;    scope.$watch(safeWatch(function () {&lt;br /&gt;      return ngModelController.$error.server;&lt;br /&gt;    }), showHideValidation);&lt;br /&gt;&lt;br /&gt;    function showHideValidation(serverError) {&lt;br /&gt;      // Display an error if serverError is true otherwise clear the element&lt;br /&gt;      var errorHtml = "";&lt;br /&gt;      if (serverError) {&lt;br /&gt;        // Aliasing serverError and name to make it more obvious what their purpose is&lt;br /&gt;        var errorDictionary = scope.serverError;&lt;br /&gt;        var errorKey = scope.name;&lt;br /&gt;        errorHtml = template.replace(/%error%/, errorDictionary[errorKey] || "Unknown error occurred...");&lt;br /&gt;      }&lt;br /&gt;      decorator.html(errorHtml);&lt;br /&gt;    }&lt;br /&gt;&lt;br /&gt;    // wipe the server error message upon keyup or change events so can revalidate with server&lt;br /&gt;    element.on("keyup change", function (event) {&lt;br /&gt;      scope.$apply(function () {&lt;br /&gt;        ngModelController.$setValidity("server", true);&lt;br /&gt;      });&lt;br /&gt;    });&lt;br /&gt;  }&lt;br /&gt;}]);&lt;br /&gt;&lt;br /&gt;// Thanks @Basarat! http://stackoverflow.com/a/24863256/761388&lt;br /&gt;function safeWatch(expression) {&lt;br /&gt;  return function () {&lt;br /&gt;    try  {&lt;br /&gt;      return expression();&lt;br /&gt;    } catch (e) {&lt;br /&gt;      return null;&lt;br /&gt;    }&lt;br /&gt;  };&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;If you look closely at this directive you'll see it is restricted to be used as an attribute and it depends on 2 things:&lt;/p&gt; &lt;ol&gt;&lt;li&gt;The value that the &lt;code&gt;server-error&lt;/code&gt; attribute is set to should be an object which will contain key / values where the keys represent fields that are being validated.&lt;/li&gt;&lt;li&gt;The element being validated must have a name property (which will be used to look up the validation message in the &lt;code&gt;server-error&lt;/code&gt; error "dictionary".&lt;/li&gt;&lt;/ol&gt; &lt;p&gt;Totally not clear, right?  Let's have an example. Here is my "sageEdit" screen which you saw the screenshot of earlier:&lt;/p&gt; &lt;pre class="prettyprint html" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-html"&gt;&lt;br /&gt;&amp;lt;section class="mainbar" ng-controller="sageEdit as vm"&amp;gt;&lt;br /&gt;    &amp;lt;section class="matter"&amp;gt;&lt;br /&gt;        &amp;lt;div class="container-fluid"&amp;gt;&lt;br /&gt;            &amp;lt;form name="form" novalidate role="form"&amp;gt;&lt;br /&gt;                &amp;lt;div&amp;gt;&lt;br /&gt;                    &amp;lt;button class="btn btn-info"&lt;br /&gt;                            ng-click="vm.save()"&lt;br /&gt;                            ng-disabled="!vm.canSave"&amp;gt;&lt;br /&gt;                        &amp;lt;i class="glyphicon glyphicon-save"&amp;gt;&amp;lt;/i&amp;gt;Save&lt;br /&gt;                    &amp;lt;/button&amp;gt;&lt;br /&gt;                    &amp;lt;span ng-show="vm.hasChanges"&lt;br /&gt;                          class="dissolve-animation ng-hide"&amp;gt;&lt;br /&gt;                        &amp;lt;i class="glyphicon glyphicon-asterisk orange"&amp;gt;&amp;lt;/i&amp;gt;&lt;br /&gt;                    &amp;lt;/span&amp;gt;&lt;br /&gt;                &amp;lt;/div&amp;gt;&lt;br /&gt;                &amp;lt;div class="widget wblue"&amp;gt;&lt;br /&gt;                    &amp;lt;div data-cc-widget-header title="{{vm.title}}"&amp;gt;&amp;lt;/div&amp;gt;&lt;br /&gt;                    &amp;lt;div class="widget-content form-horizontal"&amp;gt;&lt;br /&gt;                        &amp;lt;div class="form-group"&amp;gt;&lt;br /&gt;                            &amp;lt;label class="col-xs-12 col-sm-2"&amp;gt;Name&amp;lt;/label&amp;gt;&lt;br /&gt;                            &amp;lt;input class="col-xs-12 col-sm-9" &lt;br /&gt;                                   name="sage.name" ng-model="vm.sage.name" &lt;br /&gt;                                   server-error="vm.errors" /&amp;gt;&lt;br /&gt;                        &amp;lt;/div&amp;gt;&lt;br /&gt;                        &amp;lt;div class="form-group"&amp;gt;&lt;br /&gt;                            &amp;lt;label class="col-xs-12 col-sm-2"&amp;gt;Username&amp;lt;/label&amp;gt;&lt;br /&gt;                            &amp;lt;input class="col-xs-12 col-sm-9" &lt;br /&gt;                                   name="sage.userName" ng-model="vm.sage.userName" &lt;br /&gt;                                   server-error="vm.errors" /&amp;gt;&lt;br /&gt;                        &amp;lt;/div&amp;gt;&lt;br /&gt;                        &amp;lt;div class="form-group"&amp;gt;&lt;br /&gt;                            &amp;lt;label class="col-xs-12 col-sm-2"&amp;gt;Email&amp;lt;/label&amp;gt;&lt;br /&gt;                            &amp;lt;input class="col-xs-12 col-sm-9"&lt;br /&gt;                                   type="email"&lt;br /&gt;                                   name="sage.email" ng-model="vm.sage.email" &lt;br /&gt;                                   server-error="vm.errors" /&amp;gt;&lt;br /&gt;                        &amp;lt;/div&amp;gt;&lt;br /&gt;                    &amp;lt;/div&amp;gt;&lt;br /&gt;                &amp;lt;/div&amp;gt;&lt;br /&gt;            &amp;lt;/form&amp;gt;&lt;br /&gt;        &amp;lt;/div&amp;gt;&lt;br /&gt;    &amp;lt;/section&amp;gt;&lt;br /&gt;&amp;lt;/section&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;If you look closely at where &lt;code&gt;server-error&lt;/code&gt; is used we have a name attribute set (eg "sage.email") and we're passing in something called &lt;code&gt;&lt;em&gt;vm.&lt;/em&gt;errors&lt;/code&gt; as the &lt;code&gt;server-error&lt;/code&gt; attribute value.  That's because we're using the "controller as" syntax and our controller is called &lt;code&gt;vm&lt;/code&gt;.&lt;/p&gt; &lt;p&gt;On that controller we're going to have a dictionary style object called &lt;code&gt;errors&lt;/code&gt;.  If you wanted to you could put that object on the scope instead and omit the "vm." prefix.  You could call it &lt;code&gt;wrongThingsWhatISpottedWithYourModel&lt;/code&gt; or &lt;code&gt;barry&lt;/code&gt; - whatever floats your boat really.  You get my point; it's flexible.&lt;/p&gt; &lt;p&gt;Let's take a look at our sageEdit Angular controller:&lt;/p&gt; &lt;h5&gt;TypeScript&lt;/h5&gt; &lt;pre class="prettyprint ts" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;module controllers {&lt;br /&gt;&lt;br /&gt;  "use strict";&lt;br /&gt;&lt;br /&gt;  interface sageEditRouteParams extends ng.route.IRouteParamsService {&lt;br /&gt;    id: number;&lt;br /&gt;  }&lt;br /&gt;&lt;br /&gt;  interface sageEditScope extends ng.IScope {&lt;br /&gt;    form: ng.IFormController;&lt;br /&gt;  }&lt;br /&gt;&lt;br /&gt;  class SageEdit {&lt;br /&gt;&lt;br /&gt;    errors: { [field: string]: string };&lt;br /&gt;    log: loggerFunction;&lt;br /&gt;    logError: loggerFunction;&lt;br /&gt;    logSuccess: loggerFunction;&lt;br /&gt;    sage: sage;&lt;br /&gt;    title: string;&lt;br /&gt;&lt;br /&gt;    private _isSaving: boolean;&lt;br /&gt;&lt;br /&gt;    static $inject = ["$location", "$routeParams", "$scope", "common", "datacontext"];&lt;br /&gt;    constructor(&lt;br /&gt;      private $location: ng.ILocationService,&lt;br /&gt;      private $routeParams: sageEditRouteParams,&lt;br /&gt;      private $scope: sageEditScope,&lt;br /&gt;      private common: common,&lt;br /&gt;      private datacontext: datacontext&lt;br /&gt;      ) {&lt;br /&gt;&lt;br /&gt;      this.errors = {};&lt;br /&gt;      this.log = common.logger.getLogFn(controllerId);&lt;br /&gt;      this.logError = common.logger.getLogFn(controllerId, "error");&lt;br /&gt;      this.logSuccess = common.logger.getLogFn(controllerId, "success");&lt;br /&gt;      this.sage = undefined;&lt;br /&gt;      this.title = "Sage Edit";&lt;br /&gt;&lt;br /&gt;      this._isSaving = false;&lt;br /&gt;&lt;br /&gt;      this.activate();&lt;br /&gt;    }&lt;br /&gt;&lt;br /&gt;    // Prototype methods&lt;br /&gt;&lt;br /&gt;    activate() {&lt;br /&gt;      var id = this.$routeParams.id;&lt;br /&gt;      var dataPromises: ng.IPromise&amp;lt;any&amp;gt;[] = [this.getSage(id)];&lt;br /&gt;&lt;br /&gt;      this.common.activateController(dataPromises, controllerId, this.title)&lt;br /&gt;        .then(() =&amp;gt; {&lt;br /&gt;          this.log("Activated Sage Edit View");&lt;br /&gt;          this.title = "Sage Edit: " + this.sage.name;&lt;br /&gt;        });&lt;br /&gt;    }&lt;br /&gt;&lt;br /&gt;    getSage(id: number) {&lt;br /&gt;      return this.datacontext.sage.getById(id).then(sage =&amp;gt; {&lt;br /&gt;        this.sage = sage;&lt;br /&gt;      });&lt;br /&gt;    }&lt;br /&gt;&lt;br /&gt;    save() {&lt;br /&gt;&lt;br /&gt;      this.errors = {}; //Wipe server errors&lt;br /&gt;      this._isSaving = true;&lt;br /&gt;      this.datacontext.sage.save(this.sage).then(response =&amp;gt; {&lt;br /&gt;&lt;br /&gt;        if (response.success) {&lt;br /&gt;          this.sage = response.entity;&lt;br /&gt;          this.logSuccess("Saved " + this.sage.name + " [" + this.sage.id + "]");&lt;br /&gt;          this.$location.path("/sages/detail/" + this.sage.id);&lt;br /&gt;        }&lt;br /&gt;        else {&lt;br /&gt;          this.logError("Failed to save", response.errors);&lt;br /&gt;&lt;br /&gt;          angular.forEach(response.errors, (errors, field) =&amp;gt; {&lt;br /&gt;            (&amp;lt;ng.INgModelController&amp;gt;this.$scope.form[field]).$setValidity("server", false);&lt;br /&gt;            this.errors[field] = errors.join(",");&lt;br /&gt;          });&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        this._isSaving = false;&lt;br /&gt;      });&lt;br /&gt;    }&lt;br /&gt;&lt;br /&gt;    // Properties&lt;br /&gt;&lt;br /&gt;    get hasChanges(): boolean {&lt;br /&gt;      return this.$scope.form.$dirty;&lt;br /&gt;    }&lt;br /&gt;&lt;br /&gt;    get canSave(): boolean {&lt;br /&gt;      return this.hasChanges &amp;&amp; !this._isSaving &amp;&amp; this.$scope.form.$valid;&lt;br /&gt;    }&lt;br /&gt;  }&lt;br /&gt;&lt;br /&gt;  var controllerId = "sageEdit";&lt;br /&gt;  angular.module("app").controller(controllerId, SageEdit);&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;h5&gt;JavaScript&lt;/h5&gt; &lt;pre class="prettyprint js" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;var controllers;&lt;br /&gt;(function (controllers) {&lt;br /&gt;  "use strict";&lt;br /&gt;&lt;br /&gt;  var SageEdit = (function () {&lt;br /&gt;    function SageEdit($location, $routeParams, $scope, common, datacontext) {&lt;br /&gt;      this.$location = $location;&lt;br /&gt;      this.$routeParams = $routeParams;&lt;br /&gt;      this.$scope = $scope;&lt;br /&gt;      this.common = common;&lt;br /&gt;      this.datacontext = datacontext;&lt;br /&gt;      this.errors = {};&lt;br /&gt;      this.log = common.logger.getLogFn(controllerId);&lt;br /&gt;      this.logError = common.logger.getLogFn(controllerId, "error");&lt;br /&gt;      this.logSuccess = common.logger.getLogFn(controllerId, "success");&lt;br /&gt;      this.sage = undefined;&lt;br /&gt;      this.title = "Sage Edit";&lt;br /&gt;&lt;br /&gt;      this._isSaving = false;&lt;br /&gt;&lt;br /&gt;      this.activate();&lt;br /&gt;    }&lt;br /&gt;    // Prototype methods&lt;br /&gt;    SageEdit.prototype.activate = function () {&lt;br /&gt;      var _this = this;&lt;br /&gt;      var id = this.$routeParams.id;&lt;br /&gt;      var dataPromises = [this.getSage(id)];&lt;br /&gt;&lt;br /&gt;      this.common.activateController(dataPromises, controllerId, this.title).then(function () {&lt;br /&gt;        _this.log("Activated Sage Edit View");&lt;br /&gt;        _this.title = "Sage Edit: " + _this.sage.name;&lt;br /&gt;      });&lt;br /&gt;    };&lt;br /&gt;&lt;br /&gt;    SageEdit.prototype.getSage = function (id) {&lt;br /&gt;      var _this = this;&lt;br /&gt;      return this.datacontext.sage.getById(id).then(function (sage) {&lt;br /&gt;        _this.sage = sage;&lt;br /&gt;      });&lt;br /&gt;    };&lt;br /&gt;&lt;br /&gt;    SageEdit.prototype.save = function () {&lt;br /&gt;      var _this = this;&lt;br /&gt;      this.errors = {}; //Wipe server errors&lt;br /&gt;      this._isSaving = true;&lt;br /&gt;      this.datacontext.sage.save(this.sage).then(function (response) {&lt;br /&gt;        if (response.success) {&lt;br /&gt;          _this.sage = response.entity;&lt;br /&gt;          _this.logSuccess("Saved " + _this.sage.name + " [" + _this.sage.id + "]");&lt;br /&gt;&lt;br /&gt;          _this.$location.path("/sages/detail/" + _this.sage.id);&lt;br /&gt;        } else {&lt;br /&gt;          _this.logError("Failed to save", response.errors);&lt;br /&gt;&lt;br /&gt;          angular.forEach(response.errors, function (errors, field) {&lt;br /&gt;            _this.$scope.form[field].$setValidity("server", false);&lt;br /&gt;            _this.errors[field] = errors.join(",");&lt;br /&gt;          });&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        _this._isSaving = false;&lt;br /&gt;      });&lt;br /&gt;    };&lt;br /&gt;&lt;br /&gt;    Object.defineProperty(SageEdit.prototype, "hasChanges", {&lt;br /&gt;      // Properties&lt;br /&gt;      get: function () {&lt;br /&gt;        return this.$scope.form.$dirty;&lt;br /&gt;      },&lt;br /&gt;      enumerable: true,&lt;br /&gt;      configurable: true&lt;br /&gt;    });&lt;br /&gt;&lt;br /&gt;    Object.defineProperty(SageEdit.prototype, "canSave", {&lt;br /&gt;      get: function () {&lt;br /&gt;        return this.hasChanges &amp;&amp; !this._isSaving &amp;&amp; this.$scope.form.$valid;&lt;br /&gt;      },&lt;br /&gt;      enumerable: true,&lt;br /&gt;      configurable: true&lt;br /&gt;    });&lt;br /&gt;    SageEdit.$inject = ["$location", "$routeParams", "$scope", "common", "datacontext"];&lt;br /&gt;    return SageEdit;&lt;br /&gt;  })();&lt;br /&gt;&lt;br /&gt;  var controllerId = "sageEdit";&lt;br /&gt;  angular.module("app").controller(controllerId, SageEdit);&lt;br /&gt;})(controllers || (controllers = {}));&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Okay - this is a shedload of code and most of it isn't relevant to you.  I share it as I like to see things in context.  Let's focus in on the important bits that you should take away.  Firstly, our controller has a property called &lt;code&gt;errors&lt;/code&gt;.&lt;/p&gt; &lt;p&gt;Secondly, when we attempt to save our server sends back a JSON payload which, given a validation failure, looks something like this:&lt;/p&gt; &lt;pre class="prettyprint json" style="font-size:0.85em"&gt;&lt;br /&gt;&lt;code class="language-json"&gt;&lt;br /&gt;{&lt;br /&gt;  "success":false,&lt;br /&gt;  "errors":{&lt;br /&gt;    "sage.name":["The Name field is required."],&lt;br /&gt;    "sage.userName":[&lt;br /&gt;      "The UserName field is required.",&lt;br /&gt;      "The field UserName must be a string with a minimum length of 3 and a maximum length of 30."&lt;br /&gt;    ],&lt;br /&gt;    "sage.email":["The Email field is not a valid e-mail address."]&lt;br /&gt;  }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;So let's pare back our &lt;code&gt;save&lt;/code&gt; function to the bare necessities (those simple bare necessities, forget about your worries and your strife...):&lt;/p&gt; &lt;h5&gt;TypeScript&lt;/h5&gt; &lt;pre class="prettyprint ts" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;    save() {&lt;br /&gt;&lt;br /&gt;      this.errors = {}; //Wipe server errors&lt;br /&gt;&lt;br /&gt;      this.datacontext.sage.save(this.sage).then(response =&amp;gt; {&lt;br /&gt;&lt;br /&gt;        if (response.success) {&lt;br /&gt;          this.sage = response.entity;&lt;br /&gt;        }&lt;br /&gt;        else {&lt;br /&gt;          angular.forEach(response.errors, (errors, field) =&amp;gt; {&lt;br /&gt;            (&amp;lt;ng.INgModelController&amp;gt;this.$scope.form[field]).$setValidity("server", false);&lt;br /&gt;            this.errors[field] = errors.join(",");&lt;br /&gt;          });&lt;br /&gt;        }&lt;br /&gt;      });&lt;br /&gt;    }&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;h5&gt;JavaScript&lt;/h5&gt; &lt;pre class="prettyprint js" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;    SageEdit.prototype.save = function () {&lt;br /&gt;      var _this = this;&lt;br /&gt;      this.errors = {}; //Wipe server errors&lt;br /&gt;      this.datacontext.sage.save(this.sage).then(function (response) {&lt;br /&gt;        if (response.success) {&lt;br /&gt;          _this.sage = response.entity;&lt;br /&gt;        } else {&lt;br /&gt;          angular.forEach(response.errors, function (errors, field) {&lt;br /&gt;            _this.$scope.form[field].$setValidity("server", false);&lt;br /&gt;            _this.errors[field] = errors.join(",");&lt;br /&gt;          });&lt;br /&gt;        }&lt;br /&gt;      });&lt;br /&gt;    };&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;At the point of save we wipe any server error messages that might be stored on the client.  Then, if we receive back a payload with errors we store those errors and set the validity of the relevant form element to false.  This will trigger the display of the message by our directive.&lt;/p&gt; &lt;p&gt;That's us done for the client side.  You're no doubt now asking yourself this question:&lt;/p&gt; &lt;h4&gt;How can I get ASP.Net to send me this information?&lt;/h4&gt; &lt;p&gt;So glad you asked.  We've a simple model that looks like this which has a number of data annotations:&lt;/p&gt; &lt;pre class="prettyprint cs" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;public class Sage&lt;br /&gt;{&lt;br /&gt;  public int Id { get; set; }&lt;br /&gt;&lt;br /&gt;  [Required]&lt;br /&gt;  public string Name { get; set; }&lt;br /&gt;&lt;br /&gt;  [Required]&lt;br /&gt;  [StringLength(30, MinimumLength = 3)]&lt;br /&gt;  public string UserName { get; set; }&lt;br /&gt;&lt;br /&gt;  [EmailAddress]&lt;br /&gt;  public string Email { get; set; }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;When we save we post back to a Web API controller that looks like this:&lt;/p&gt; &lt;pre class="prettyprint cs" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;public class SageController : ApiController&lt;br /&gt;{&lt;br /&gt;  // ...&lt;br /&gt;&lt;br /&gt;  public IHttpActionResult Post(User sage)&lt;br /&gt;  {&lt;br /&gt;    if (!ModelState.IsValid) {&lt;br /&gt;&lt;br /&gt;      return Ok(new&lt;br /&gt;      {&lt;br /&gt;        Success = false,&lt;br /&gt;        Errors = ModelState.ToErrorDictionary()&lt;br /&gt;      });&lt;br /&gt;    }&lt;br /&gt;&lt;br /&gt;    sage = _userService.Save(sage);&lt;br /&gt;&lt;br /&gt;    return Ok(new&lt;br /&gt;    {&lt;br /&gt;      Success = true,&lt;br /&gt;      Entity = sage&lt;br /&gt;    });&lt;br /&gt;  }&lt;br /&gt;&lt;br /&gt;  // ...&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;As you can see, when &lt;code&gt;ModelState&lt;/code&gt; is not valid we send back a dictionary of the &lt;code&gt;ModelState&lt;/code&gt; error messages keyed by property name. We generate this with an extension method I wrote called &lt;code&gt;ToErrorDictionary&lt;/code&gt;:&lt;/p&gt; &lt;pre class="prettyprint cs" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;public static class ModelStateExtensions&lt;br /&gt;{&lt;br /&gt;  public static Dictionary&amp;lt;string, IEnumerable&amp;lt;string&amp;gt;&amp;gt; ToErrorDictionary(&lt;br /&gt;    this System.Web.Http.ModelBinding.ModelStateDictionary modelState, bool camelCaseKeyName = true) &lt;br /&gt;  {&lt;br /&gt;    var errors = modelState&lt;br /&gt;      .Where(x =&amp;gt; x.Value.Errors.Any())&lt;br /&gt;      .ToDictionary(&lt;br /&gt;        kvp =&amp;gt; CamelCasePropNames(kvp.Key),&lt;br /&gt;        kvp =&amp;gt; kvp.Value.Errors.Select(e =&amp;gt; e.ErrorMessage)&lt;br /&gt;      );&lt;br /&gt;&lt;br /&gt;    return errors;&lt;br /&gt;  }&lt;br /&gt;&lt;br /&gt;  private static string CamelCasePropNames(string propName)&lt;br /&gt;  {&lt;br /&gt;    var array = propName.Split('.');&lt;br /&gt;    var camelCaseList = new string[array.Length];&lt;br /&gt;    for (var i = 0; i &amp;lt; array.Length; i++)&lt;br /&gt;    {&lt;br /&gt;      var prop = array[i];&lt;br /&gt;      camelCaseList[i] = prop.Substring(0, 1).ToLower() + prop.Substring(1, prop.Length - 1);&lt;br /&gt;    }&lt;br /&gt;    return string.Join(".", camelCaseList);&lt;br /&gt;  }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;That's it - your solution front to back.  It would be quite easy to hook other types of validation in server-side (database level checks etc).  I hope you find this useful.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4107411949171295182'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4107411949171295182'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2014/08/angularjs-meet-aspnet-server-validation.html' title='AngularJS meet ASP.Net Server Validation'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='http://2.bp.blogspot.com/-vxr6_ajRNj8/U9tQjs3SS3I/AAAAAAAAAr8/1HoOUJdPO0w/s72-c/server-error.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1259367046965334522</id><published>2014-07-03T13:45:00.001+01:00</published><updated>2021-03-04T17:26:58.656Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='HotTowel'/><category scheme='http://www.blogger.com/atom/ns#' term='TypeScript'/><category scheme='http://www.blogger.com/atom/ns#' term='AngularJS'/><category scheme='http://www.blogger.com/atom/ns#' term='JohnPapa'/><title type='text'>HotTowel-Angular meet TypeScript</title><content type='html'>&lt;p&gt;I've recently ported John Papa's popular &lt;a href="https://github.com/johnpapa/HotTowel-Angular"&gt;Hot Towel Angular SPA Template&lt;/a&gt; to TypeScript.  Why?  &lt;a href="http://en.wikipedia.org/wiki/George_Mallory"&gt;Because it was there.&lt;/a&gt; &lt;/p&gt; &lt;p&gt;If you'd like to read more about HotTowel-Angular then have a read of &lt;a href="http://www.johnpapa.net/hot-towel-angular/"&gt;John Papa's post&lt;/a&gt;.  You can find my port on GitHub &lt;a href="https://github.com/johnnyreilly/HotTowel-Angular-TypeScript"&gt;here&lt;/a&gt;.&lt;/p&gt; &lt;h4&gt;What is this port you speak of?&lt;/h4&gt; &lt;p&gt;It is &lt;strong&gt;intentionally&lt;/strong&gt; a "bare bones" port of the HotTowel-Angular JavaScript code across to TypeScript.  It's essentially the same code as John's - just with added type annotations (and yes it is &lt;code&gt;noImplicitAny&lt;/code&gt; compliant).&lt;/p&gt; &lt;p&gt;You could, if you wanted to, go much further.  You could start using a whole host of TypeScripts functionality: modules / classes / arrow functions... the whole shebang.  But my port is deliberately not that; I didn't want to scare your horses... I wanted you to see how easy it is to move from JS to TS.  And I'm standing on the shoulders of that great giant &lt;a href="https://twitter.com/john_papa"&gt;John Papa&lt;/a&gt; for that purpose.&lt;/p&gt; &lt;p&gt;If you wanted an example of how you might go further in an Angular port to TypeScript then you could take a look at my &lt;a href="http://icanmakethiswork.blogspot.co.uk/2014/06/migrating-from-angularjs-to-angularts.html"&gt;previous post&lt;/a&gt; on the topic.&lt;/p&gt; &lt;h4&gt;What's in the repo?&lt;/h4&gt; &lt;p&gt;The repo contains the contents of HotTowel-Angular's app folder, with each JavaScript file converted over to TypeScript.  The compiled JavaScript files are also included so that you can compare just how similar the compiled JavaScript is to John's original code.&lt;/p&gt; &lt;p&gt;In fact there are only 2 differences in the end:&lt;/p&gt; &lt;h5&gt;1. sidebar.js's &lt;code&gt;getNavRoutes&lt;/code&gt;&lt;/h5&gt; &lt;p&gt;...had the filtering changed from this:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;    return r.config.settings &amp;&amp; r.config.settings.nav;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; to this:  &lt;pre class="prettyprint ts"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;    return (r.config.settings &amp;&amp; r.config.settings.nav) ? true : false;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;This was necessary as TypeScript insists that the array &lt;code&gt;filter&lt;/code&gt; predicate returns a &lt;code&gt;boolean&lt;/code&gt;.  John's original method returns a number (&lt;code&gt;nav&lt;/code&gt;'s value to be clear) which actually seems to work fine. My assumption is that JavaScript's filter method is happy with a truth-y / false-y test which John's implementation would satisfy.&lt;/p&gt; &lt;h5&gt;2. common.js's &lt;code&gt;$broadcast&lt;/code&gt;&lt;/h5&gt; &lt;p&gt;...had to be given a rest parameter to satisfy the TS compiler.  John's original method exposed no parameters as it just forwards on whatever arguments are passed to it.  This means that &lt;code&gt;$broadcast&lt;/code&gt; has a bit of unused code in the head of the generated method:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;    var args = [];&lt;br /&gt;    for (var _i = 0; _i &lt; (arguments.length - 0); _i++) {&lt;br /&gt;        args[_i] = arguments[_i + 0];&lt;br /&gt;    }&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;h4&gt;If you want to use this&lt;/h4&gt; &lt;p&gt;Then simply follow the instructions for installing &lt;a href="https://github.com/johnpapa/HotTowel-Angular"&gt;HotTowel-Angular&lt;/a&gt; and then drop this repo's app folder over the one just created when HotTowel-Angular was installed.  If you're using Visual Studio then make sure that you include the new TS files into your project and give them the &lt;code&gt;BuildAction&lt;/code&gt; of &lt;code&gt;TypeScriptCompile&lt;/code&gt;.&lt;/p&gt;   &lt;p&gt;You'll need the following NuGet packages for the relevant DefinitelyTyped Typings:&lt;/p&gt; &lt;pre class="prettyprint"&gt;&lt;br /&gt;&lt;code class="language-ps"&gt;&lt;br /&gt;    Install-Package angularjs.TypeScript.DefinitelyTyped&lt;br /&gt;    Install-Package angular-ui-bootstrap.TypeScript.DefinitelyTyped&lt;br /&gt;    Install-Package jquery.TypeScript.DefinitelyTyped&lt;br /&gt;    Install-Package spin.TypeScript.DefinitelyTyped&lt;br /&gt;    Install-Package toastr.TypeScript.DefinitelyTyped&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;And you're good to go.  If you're not using Visual Studio then you may need to add in some &lt;code&gt;&amp;lt;reference path="angular.d.ts" /&amp;gt;&lt;/code&gt; etc. statements to the TypeScript files as well.&lt;/p&gt; &lt;p&gt;If you're interested in the specific versions of the typings that I used then you can find them in the &lt;code&gt;packages.config&lt;/code&gt; of the repo.&lt;/p&gt; &lt;h4&gt;Thanks&lt;/h4&gt; &lt;p&gt;To John Papa for creating HotTowel-Angular.  Much love.&lt;/p&gt; &lt;p&gt;And my mum too... Just because.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1259367046965334522'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1259367046965334522'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2014/07/hottowel-angular-meet-typescript.html' title='HotTowel-Angular meet TypeScript'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6618057453290818119</id><published>2014-06-20T06:48:00.001+01:00</published><updated>2021-03-04T17:27:57.772Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='Date'/><category scheme='http://www.blogger.com/atom/ns#' term='DateTime'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Moment.JS'/><category scheme='http://www.blogger.com/atom/ns#' term='DataAnnotations'/><category scheme='http://www.blogger.com/atom/ns#' term='ValidationAttribute'/><title type='text'>A folk story wherein we shall find dates, DataAnnotations &amp; data impedance mismatch</title><content type='html'>&lt;p&gt;If you ever take a step back from what you're doing it can sometimes seem pretty abstract.  Here's an example. I was looking at an issue in an app that I was supporting.  The problem concerned a field which was to store a date value.  Let's call it, for the sake of argument, &lt;code&gt;valuation_date&lt;/code&gt;. (Clearly in reality the field name was entirely different...  Probably.) This field was supposed to represent a specific date, like June 15th 2012 or 19th August 2014. To be clear, a date and *&lt;strong&gt;not&lt;/strong&gt;* in any way, a time.&lt;/p&gt; &lt;p&gt;&lt;code&gt;valuation_date&lt;/code&gt; was stored in a SQL database as a &lt;code&gt;&lt;a href="http://msdn.microsoft.com/en-gb/library/ms187819.aspx"&gt;datetime&lt;/a&gt;&lt;/code&gt;.  That's right a date with a time portion.  I've encountered this sort of scenario many times on systems I've inherited. Although there is a &lt;code&gt;&lt;a href="http://msdn.microsoft.com/en-gb/library/bb630352.aspx"&gt;date&lt;/a&gt;&lt;/code&gt; type in SQL it's pretty rarely used.  I think it only shipped in SQL Server with 2008 which may go some way to explaining this.  Anyway, I digress...&lt;/p&gt; &lt;p&gt;&lt;code&gt;valuation_date&lt;/code&gt; was read into a field in a C# application called &lt;code&gt;ValuationDate&lt;/code&gt; which was of type &lt;code&gt;&lt;a href="http://msdn.microsoft.com/en-us/library/system.datetime.aspx"&gt;DateTime&lt;/a&gt;&lt;/code&gt;. As the name suggests this is also a date with a time portion.  After a travelling through various layers of application this ended up being serialized as JSON and sent across the wire where it became a JavaScript variable by the name of &lt;code&gt;valuationDate&lt;/code&gt; which had the type &lt;code&gt;&lt;a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date"&gt;Date&lt;/a&gt;&lt;/code&gt;.  Despite the deceptive name this is also, you guessed it, a date with a time portion. (Fine naming work there JavaScript!)&lt;/p&gt; &lt;p&gt;You can probably guess where I'm going with this... Despite our (cough) rock solid naming convention, the situation had arisen where actual datetimes had snuck in.  That's right, in the wilds of production, records with &lt;code&gt;valuation_date&lt;/code&gt;s with time components had been spotted.  My mission was to hunt them, kill them and stop them reproducing...&lt;/p&gt; &lt;h4&gt;A Primitive Problem&lt;/h4&gt; &lt;p&gt;Dates is a sticky topic in many languages.  As I mentioned, SQL Server has a &lt;code&gt;&lt;a href="http://msdn.microsoft.com/en-gb/library/bb630352.aspx"&gt;date&lt;/a&gt;&lt;/code&gt; data type. C# has &lt;code&gt;&lt;a href="http://msdn.microsoft.com/en-gb/library/system.datetime.aspx"&gt;DateTime&lt;/a&gt;&lt;/code&gt;.  If you want to operate on Dates alone then you're best off talking looking at Jon Skeet's &lt;a href="http://nodatime.org/"&gt;NodaTime&lt;/a&gt; - though most people start with &lt;code&gt;DateTime&lt;/code&gt; and stick with it. (After all, it's native.)  As to JavaScript, well primitive-wise there's no alternative to &lt;code&gt;Date&lt;/code&gt; - but &lt;code&gt;&lt;a href="http://momentjs.com/"&gt;Moment.js&lt;/a&gt;&lt;/code&gt; may help.&lt;/p&gt; &lt;p&gt;My point is that it is a long standing issue in the development world.  We represent data in types that aren't entirely meant for the purpose that they are used.  It's not just restricted to dates, numbers have a comparable story around the issue of &lt;a href="http://csharpindepth.com/Articles/General/Decimal.aspx"&gt;decimals and doubles&lt;/a&gt;. As a result of data type issues, developers experience problems. Like the one I was facing.&lt;/p&gt; &lt;h4&gt;An Attribute Solution&lt;/h4&gt; &lt;p&gt;The source of the problem turned out to be the string JavaScript &lt;code&gt;&lt;a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date"&gt;Date constructor&lt;/a&gt;&lt;/code&gt; in an earlier version of Internet Explorer. The fix was switching away from using the JavaScript Date constructor in favour of using Moment.js's more dependable ability to parse strings into dates.  Happy days we're working once more!  Some quick work to put together a SQL script to fix up the data and we have ourselves our patch!&lt;/p&gt; &lt;p&gt;But we didn't want to get bitten again. We wanted ourselves a little &lt;a href="http://dictionary.cambridge.org/dictionary/british/belt-and-braces"&gt;belts and braces&lt;/a&gt;.  What do do?  Hang on a minute, lads  I've got a great idea... It's &lt;code&gt;&lt;a href="http://msdn.microsoft.com/en-us/library/system.componentmodel.dataannotations.validationattribute(v=vs.110).aspx"&gt;ValidationAttribute&lt;/a&gt;&lt;/code&gt; time!&lt;/p&gt; &lt;p&gt;We whipped ourselves up an attribute that looked like this:&lt;/p&gt; &lt;pre class="prettyprint csharp" style="font-size:0.85em"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;using System;&lt;br /&gt;using System.ComponentModel.DataAnnotations;&lt;br /&gt;using System.Globalization;&lt;br /&gt;&lt;br /&gt;namespace My.Attributes&lt;br /&gt;{&lt;br /&gt;    [AttributeUsage(AttributeTargets.Property | AttributeTargets.Field, Inherited = false, AllowMultiple = false)]&lt;br /&gt;    public class DateOnlyAttribute: ValidationAttribute&lt;br /&gt;    {&lt;br /&gt;        protected override ValidationResult IsValid(object value, ValidationContext validationContext)&lt;br /&gt;        {&lt;br /&gt;            if (value != null)&lt;br /&gt;            {&lt;br /&gt;                if (value is DateTime)&lt;br /&gt;                {&lt;br /&gt;                    // Date but not Time check&lt;br /&gt;                    var date = (DateTime) value;&lt;br /&gt;                    if (date.TimeOfDay != TimeSpan.Zero)&lt;br /&gt;                    {&lt;br /&gt;                        return new ValidationResult(date.ToString("O", CultureInfo.InvariantCulture) + " is not a date - it is a date with a time", new[] { validationContext.MemberName });&lt;br /&gt;                    }&lt;br /&gt;                }&lt;br /&gt;                else&lt;br /&gt;                {&lt;br /&gt;                    return new ValidationResult("DateOnlyAttribute can only be used on DateTime? and DateTime", new[] { validationContext.MemberName });&lt;br /&gt;                }&lt;br /&gt;            }&lt;br /&gt;&lt;br /&gt;            return ValidationResult.Success;&lt;br /&gt;        }&lt;br /&gt;    }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;This attribute does 2 things:&lt;/p&gt; &lt;ol&gt;&lt;li&gt;Most importantly it fails validation for any &lt;code&gt;DateTime&lt;/code&gt; or &lt;code&gt;DateTime?&lt;/code&gt; that includes a time portion.  It only allows through DateTimes where the clock strikes midnight.  It's optimised for Cinderella.&lt;/li&gt;&lt;li&gt;It fails validation if the attribute is applied to any property which is not a &lt;code&gt;DateTime&lt;/code&gt; or &lt;code&gt;DateTime?&lt;/code&gt;.&lt;/li&gt;&lt;/ol&gt; &lt;p&gt;You can decorate &lt;code&gt;DateTime&lt;/code&gt; or &lt;code&gt;DateTime?&lt;/code&gt; properties on your model with this attribute like so:&lt;/p&gt; &lt;pre class="prettyprint csharp" style="font-size:0.85em"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;namespace My.Models&lt;br /&gt;{&lt;br /&gt;    public class ImAModelYouKnowWhatIMean&lt;br /&gt;    {&lt;br /&gt;        public int Id { get; set; }&lt;br /&gt;&lt;br /&gt;        [DateOnlyAttribute]&lt;br /&gt;        public DateTime ValuationDate { get; set; }&lt;br /&gt;&lt;br /&gt;        // Other properties...&lt;br /&gt;    }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;And if you're using MVC (or anything that makes use of the validation data annotations) then you'll now find that you are nicely protected from DateTimes masquerading as dates.  Should they show up you'll find that &lt;code&gt;ModelState.IsValid&lt;/code&gt; is false and you can kick them to the curb with alacrity!&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/6618057453290818119'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/6618057453290818119'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2014/06/dates-DataAnnotations-and-data-impedance-mismatch.html' title='A folk story wherein we shall find dates, DataAnnotations &amp; data impedance mismatch'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1635211266608740454</id><published>2014-06-01T10:10:00.002+01:00</published><updated>2021-03-14T05:25:43.998Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='Jasmine'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='TypeScript'/><category scheme='http://www.blogger.com/atom/ns#' term='Unit tests'/><category scheme='http://www.blogger.com/atom/ns#' term='AngularJS'/><title type='text'>Migrating from AngularJS to AngularTS - a walkthrough</title><content type='html'>&lt;p&gt;It started with nuns.  Don't all good stories start that way?  One of my (many) aunts is a Poor Clare nun.  At some point in the distant past I was cajoled into putting together a simple website for her convent. This post is a walkthrough of how to migrate from AngularJS using JavaScript to AngularJS using TypeScript.  It just so happens that the AngularJS app in question is the one that belongs to my mother's sister's convent.&lt;/p&gt; &lt;h4&gt;TL;DR - grab what you need&lt;/h4&gt; &lt;p&gt;For reference the complete "before" and "after" projects can be found on GitHub &lt;a href="https://github.com/johnnyreilly/AngularJS2AngularTS"&gt;here&lt;/a&gt;.  This is available so people can see clearly what changes have been made in the migration.&lt;/p&gt; &lt;p&gt;The content of the site is available for &lt;u&gt;reference only&lt;/u&gt;.  (Not that I can really imagine people creating their own "Poor Clares" site and hawking it to convents around the globe but I thought I'd make the point.)  It looks like this:&lt;/p&gt; &lt;a href="http://2.bp.blogspot.com/-jUf3uryRdKk/U4w3VVMX04I/AAAAAAAAAnQ/6Pu84tk92S0/s1600/SisterGabriel.png" imageanchor="1" &gt;&lt;img border="0" src="http://2.bp.blogspot.com/-jUf3uryRdKk/U4w3VVMX04I/AAAAAAAAAnQ/6Pu84tk92S0/s1600/SisterGabriel.png" /&gt;&lt;/a&gt; &lt;h4&gt;Background&lt;/h4&gt; &lt;p&gt;I've been quietly maintaining this website / app for quite a while now.  It's a very simple site; 95% of it is static content about the convent.  The one piece of actual functionality is a page which allows the user of the website to send a prayer request to the nuns at the convent:&lt;/p&gt; &lt;a href="http://2.bp.blogspot.com/-DChKaPJu4eE/U4w4DPbwxCI/AAAAAAAAAnY/PPtSe_HzPCU/s1600/OurPrayer.png" imageanchor="1" &gt;&lt;img border="0" src="http://2.bp.blogspot.com/-DChKaPJu4eE/U4w4DPbwxCI/AAAAAAAAAnY/PPtSe_HzPCU/s1600/OurPrayer.png" /&gt;&lt;/a&gt; &lt;p&gt;Behind the scenes this sends 2 emails:&lt;/p&gt; &lt;ul&gt;&lt;li&gt;The first back to the person who submitted the prayer request assuring them that they will be prayed for.&lt;/li&gt;&lt;li&gt;The second to the convent telling them the details of what the person would like prayer for.&lt;/li&gt;&lt;/ul&gt; &lt;aside&gt;&lt;em&gt;It's not accidental that I am not sharing the location of my aunt's website in this post. Given the inherent mischievousness of most developers (I should know, I am one) I harbour a fear that readers of this post might go away and submit many an insincere prayer request (or worse) to the convent.  If that's you I don't intend to help you.  You're clever, you'll find the site if you are so minded.  But please know that the nuns who read any of your prayer requests are wonderful people (nuns get a bad rep) and that they love you.  They *&lt;strong&gt;will&lt;/strong&gt;* pray for you.  They're good like that.  I appeal to your better nature on this.&lt;/em&gt;&lt;/aside&gt; &lt;p&gt;Right now you are probably thinking this is an unusual post.  Perhaps it is, but bear with me.&lt;/p&gt; &lt;p&gt;Over time the website has had many incarnations.  It's been table-based layout, it's used Kendo UI, it's used Bootstrap.  It's been static HTML, it's been ASP.Net WebForms, it's been ASP.Net MVC and it's currently built using &lt;strong&gt;AngularJS&lt;/strong&gt; with &lt;strong&gt;MVC&lt;/strong&gt; on the back-end to handle bundling / minification and dispatching of emails.&lt;/p&gt; &lt;p&gt;I decided to migrate this AngularJS app to use TypeScript.  As I did that I thought I'd document the process for anyone else who might be considering doing something similar.  As it happens this is a particularly good candidate for migration as there's a full unit test suite for the app (written with Jasmine).  Once I've finished the migration these unit tests should pass, just as they do currently.&lt;/p&gt; &lt;p&gt;You are probably thinking to yourself "but TypeScript is just about adding compile-time annotations right? How could the unit tests not pass after migration?"  Fair point, well made.  Well that is generally true but I have something slightly different planned when we get to the controllers - you'll see what I mean...&lt;/p&gt; &lt;p&gt;It's also a good candidate for documenting a walkthrough as it's a particularly small and simple Angular app.  It consists of just &lt;strong&gt;3 controllers&lt;/strong&gt;, &lt;strong&gt;2 services&lt;/strong&gt; and &lt;strong&gt;1 app&lt;/strong&gt;.&lt;/p&gt; &lt;p&gt;Before I kick off I thought I'd list a couple of guidelines / caveats on this post:&lt;/p&gt; &lt;ul&gt;&lt;li&gt;I don't intend to say much about the architecture of this application - I want to focus on the migration from JavaScript to TypeScript.&lt;/li&gt;&lt;li&gt;The choices that I make for the migration path do not necessarily reflect the "one true way".  Rather, they are pragmatic choices that I am making - there may be alternatives approaches here and there that could be used instead.&lt;/li&gt;&lt;li&gt;I love Visual Studio - it's my IDE of choice and the one I am using as I perform the migration.  Some of the points that I will make are Visual Studio specific - I will try and highlight that when appropriate.&lt;/li&gt;&lt;/ul&gt; &lt;h4&gt;Typings&lt;/h4&gt; &lt;p&gt;The first thing we're going to need to get going are the Angular typing files which can be found on Definitely Typed &lt;a href="https://github.com/borisyankov/DefinitelyTyped/tree/master/angularjs"&gt;here&lt;/a&gt;.  Since these typings are made available over &lt;a href="https://www.nuget.org/packages/angularjs.TypeScript.DefinitelyTyped/"&gt;NuGet&lt;/a&gt; I'm going to pull them in with a wave of my magic &lt;code&gt;Install-Package angularjs.TypeScript.DefinitelyTyped&lt;/code&gt;.&lt;/p&gt; &lt;p&gt;As well as pulling in the typing files Visual Studio 2013 has also made some tweaks to my &lt;code&gt;PoorClaresAngular.csproj&lt;/code&gt; file which it tells me about:&lt;/p&gt; &lt;a href="http://4.bp.blogspot.com/-DZcJ-YANHAE/U4b6Yd4Zr7I/AAAAAAAAAlM/SYpK8RFSVgg/s1600/TypeScriptDialog.png" imageanchor="1" &gt;&lt;img border="0" src="http://4.bp.blogspot.com/-DZcJ-YANHAE/U4b6Yd4Zr7I/AAAAAAAAAlM/SYpK8RFSVgg/s1600/TypeScriptDialog.png" /&gt;&lt;/a&gt; &lt;p&gt;And these are the TypeScript specific additions that Visual Studio has made to  &lt;code&gt;PoorClaresAngular.csproj&lt;/code&gt;:&lt;/p&gt; &lt;pre class="prettyprint xml" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-xml"&gt;&lt;br /&gt;  &amp;lt;Import &lt;br /&gt;   Project="$(MSBuildExtensionsPath32)\Microsoft\VisualStudio\v$(VisualStudioVersion)\TypeScript\Microsoft.TypeScript.Default.props" &lt;br /&gt;   Condition="Exists('$(MSBuildExtensionsPath32)\Microsoft\VisualStudio\v$(VisualStudioVersion)\TypeScript\Microsoft.TypeScript.Default.props')" /&amp;gt;&lt;br /&gt;&lt;br /&gt;  &amp;lt;TypeScriptToolsVersion&amp;gt;1.0&amp;lt;/TypeScriptToolsVersion&amp;gt;&lt;br /&gt;&lt;br /&gt;  &amp;lt;Import &lt;br /&gt;   Project="$(MSBuildExtensionsPath32)\Microsoft\VisualStudio\v$(VisualStudioVersion)\TypeScript\Microsoft.TypeScript.targets" &lt;br /&gt;   Condition="Exists('$(MSBuildExtensionsPath32)\Microsoft\VisualStudio\v$(VisualStudioVersion)\TypeScript\Microsoft.TypeScript.targets')" /&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt; &lt;p&gt;I'm going to add one extra of my own:&lt;/p&gt; &lt;pre class="prettyprint xml" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-xml"&gt;&lt;br /&gt;  &amp;lt;TypeScriptNoImplicitAny&amp;gt;True&amp;lt;/TypeScriptNoImplicitAny&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;This prevents you having variables of type &lt;code&gt;any&lt;/code&gt; in your TypeScript codebase without you implicitly specifying the type.  You can live without this but I've found it's useful to catch where you're missing out on the benefit of static typing. Further to that, this option can be particularly useful when performing a migration.  It will become obvious why this is the case as we go on.&lt;/p&gt; &lt;p&gt;I decline the kind opportunity to further search NuGet as I'm already on my way typing-wise.  So let's review what has happened.  Below you can see the typing files that have been pulled in and that the project and packages files were amended:&lt;/p&gt; &lt;a href="http://1.bp.blogspot.com/-mgEjfAnPp5I/U4b7wqDLkdI/AAAAAAAAAlY/MlfZA5c7TIs/s1600/AddedTypings.png" imageanchor="1" &gt;&lt;img border="0" src="http://1.bp.blogspot.com/-mgEjfAnPp5I/U4b7wqDLkdI/AAAAAAAAAlY/MlfZA5c7TIs/s1600/AddedTypings.png" /&gt;&lt;/a&gt; &lt;h4&gt;Changing JS files to TS files&lt;/h4&gt; &lt;p&gt;This really should be as simple as changing all the JavaScript files underneath the &lt;code&gt;js&lt;/code&gt; directory to have the suffix &lt;code&gt;ts&lt;/code&gt;.  So going from this:&lt;/p&gt; &lt;a href="http://1.bp.blogspot.com/-El_425y9130/U4clVSYUO4I/AAAAAAAAAlo/Z-NmvPlOjiA/s1600/js.png" imageanchor="1" &gt;&lt;img border="0" src="http://1.bp.blogspot.com/-El_425y9130/U4clVSYUO4I/AAAAAAAAAlo/Z-NmvPlOjiA/s1600/js.png" /&gt;&lt;/a&gt; &lt;p&gt;To this:&lt;/p&gt; &lt;a href="http://2.bp.blogspot.com/-QMLxo7CnDV0/U4clbseUBsI/AAAAAAAAAlw/oRCZf5YqZUQ/s1600/ts.png" imageanchor="1" &gt;&lt;img border="0" src="http://2.bp.blogspot.com/-QMLxo7CnDV0/U4clbseUBsI/AAAAAAAAAlw/oRCZf5YqZUQ/s1600/ts.png" /&gt;&lt;/a&gt; &lt;p&gt;And if you're not using Visual Studio it is.  But if you are using Visual Studio there's a certain amount of fiddling required to include the generated &lt;code&gt;.js&lt;/code&gt; and &lt;code&gt;.js.map&lt;/code&gt; files associated with each &lt;code&gt;.ts&lt;/code&gt; file.  The easiest (hah!) thing to do is to crack open the project and wherever you find a &lt;code&gt;&amp;lt;TypeScriptCompile Include="js\somePath.ts" /&amp;gt;&lt;/code&gt; to add in 2 &lt;code&gt;Content&lt;/code&gt; statements, one for each generated file which states the dependency on the TypeScript file.  For example:&lt;/p&gt; &lt;pre class="prettyprint xml" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-xml"&gt;&lt;br /&gt;    &amp;lt;TypeScriptCompile Include="js\services\siteSectionService.ts" /&amp;gt;&lt;br /&gt;    &amp;lt;Content Include="js\services\siteSectionService.js"&amp;gt;&lt;br /&gt;      &amp;lt;DependentUpon&amp;gt;siteSectionService.ts&amp;lt;/DependentUpon&amp;gt;&lt;br /&gt;    &amp;lt;/Content&amp;gt;&lt;br /&gt;    &amp;lt;Content Include="js\services\siteSectionService.js.map"&amp;gt;&lt;br /&gt;      &amp;lt;DependentUpon&amp;gt;siteSectionService.ts&amp;lt;/DependentUpon&amp;gt;&lt;br /&gt;    &amp;lt;/Content&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;It's a bit of a pain to have to do this at the moment.  Hopefully the Visual Studio tooling will catch up so this sort of tweaking becomes unnecessary.&lt;/p&gt; &lt;h4&gt;Recap&lt;/h4&gt; &lt;p&gt;So, where are we?  Well, we've got our project ready for TypeScript, we've pulled in the Angular typings from Definitely Typed and we've turned all our JavaScript files in the &lt;code&gt;js&lt;/code&gt; directory into TypeScript files.&lt;/p&gt; &lt;p&gt;Now we can actually start working through our TypeScript files and ensuring we're all typed correctly.  Please note that because I'm working in Visual Studio I get the benefit of implicit referencing; I don't have to explicitly state the typing files each TypeScript file relies on at the head of the file (eg &lt;code&gt;/// &amp;lt;reference path="angularjs/angular.d.ts" /&amp;gt;&lt;/code&gt;).  If you aren't working in Visual Studio then you'd need to add these yourself.&lt;/p&gt; &lt;h4&gt;TypeScriptify &lt;code&gt;app.ts&lt;/code&gt;&lt;/h4&gt; &lt;p&gt;Opening up &lt;code&gt;app.ts&lt;/code&gt; we're presented with a few red squigglies:&lt;/p&gt; &lt;a href="http://4.bp.blogspot.com/-91g1TEbkZd4/U4ctcYQqogI/AAAAAAAAAmI/qQzfzNAaPhA/s1600/app.ts.png" imageanchor="1" &gt;&lt;img border="0" src="http://4.bp.blogspot.com/-91g1TEbkZd4/U4ctcYQqogI/AAAAAAAAAmI/qQzfzNAaPhA/s1600/app.ts.png" /&gt;&lt;/a&gt; &lt;p&gt;These red squigglies are the direct result of my earlier opting in to &lt;code&gt;NoImplicitAny&lt;/code&gt;.  So in my view it's already paid for itself as it's telling me where I could start using typings.  So to get things working nicely I'll give &lt;code&gt;$routeProvider&lt;/code&gt; the type of &lt;code&gt;ng.route.IRouteProvider&lt;/code&gt; and I'll explicitly specify the type of &lt;code&gt;any&lt;/code&gt; for the 2 &lt;code&gt;params&lt;/code&gt; parameters:&lt;/p&gt; &lt;pre class="prettyprint ts" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;    // ...&lt;br /&gt;    function ($routeProvider: ng.route.IRouteProvider) {&lt;br /&gt;&lt;br /&gt;        function getTheConventTemplateUrl(params: any) {&lt;br /&gt;            var view = params.view || "home";&lt;br /&gt;            return "partials/theConvent/" + view + ".html";&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        function getMainTemplateUrl(params: any) {&lt;br /&gt;            var view = params.view || "home";&lt;br /&gt;            return "partials/main/" + view + ".html";&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        // ...&lt;br /&gt;    }&lt;br /&gt;    // ...&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;h4&gt;TypeScriptify &lt;code&gt;siteSectionService.ts&lt;/code&gt;&lt;/h4&gt; &lt;p&gt;Opening up &lt;code&gt;siteSectionService.ts&lt;/code&gt; we're only presented with a single squiggly, and for the same reason as last time:&lt;/p&gt; &lt;a href="http://4.bp.blogspot.com/-aFd1JgtcLIU/U4cwBbs8N7I/AAAAAAAAAmU/x9GME8J5CMc/s1600/siteSectionService.ts.png" imageanchor="1" &gt;&lt;img border="0" src="http://4.bp.blogspot.com/-aFd1JgtcLIU/U4cwBbs8N7I/AAAAAAAAAmU/x9GME8J5CMc/s1600/siteSectionService.ts.png" /&gt;&lt;/a&gt; &lt;p&gt;This error is easily remedied by giving &lt;code&gt;path&lt;/code&gt; the type of &lt;code&gt;string&lt;/code&gt;.&lt;/p&gt; &lt;p&gt;What's more interesting / challenging is thinking about how we want to enforce the definition of &lt;code&gt;siteSectionService&lt;/code&gt;.  Remember, this is a service and as such it will be re-used elsewhere in the application (in both &lt;code&gt;navController&lt;/code&gt; and &lt;code&gt;mainController&lt;/code&gt;).  What we need is an interface that describes what our (revealing module pattern) service exposes:&lt;/p&gt; &lt;pre class="prettyprint ts" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;"use strict";&lt;br /&gt;&lt;br /&gt;interface ISiteSectionService {&lt;br /&gt;    getSiteSection: () =&gt; string;&lt;br /&gt;    determineSiteSection: (path: string) =&gt; void;&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;angular.module("poorClaresApp.services").factory(&lt;br /&gt;&lt;br /&gt;    "siteSectionService",&lt;br /&gt;&lt;br /&gt;    [ // No dependencies at present&lt;br /&gt;    function (): ISiteSectionService {&lt;br /&gt;&lt;br /&gt;        var siteSection = "home";&lt;br /&gt;&lt;br /&gt;        function getSiteSection() {&lt;br /&gt;            return siteSection;&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        function determineSiteSection(path: string) {&lt;br /&gt;            var newSiteSection = "home";&lt;br /&gt;&lt;br /&gt;            if (path.indexOf("/theConvent/") !== -1) {&lt;br /&gt;                newSiteSection = "theConvent";&lt;br /&gt;            }&lt;br /&gt;            else if (path !== "/") {&lt;br /&gt;                newSiteSection = "main";&lt;br /&gt;            }&lt;br /&gt;&lt;br /&gt;            siteSection = newSiteSection;&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        return {&lt;br /&gt;            getSiteSection: getSiteSection,&lt;br /&gt;            determineSiteSection: determineSiteSection&lt;br /&gt;        };&lt;br /&gt;    }]);&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;As you can see the &lt;code&gt;ISiteSectionService &lt;/code&gt; interface is marked as the return type of the function. This ensures that what we return from the function satisfies that definition.  Also, it allows us to re-use that interface elsewhere (as we will do later).&lt;/p&gt; &lt;h4&gt;TypeScriptify &lt;code&gt;prayerRequestService.ts&lt;/code&gt;&lt;/h4&gt; &lt;p&gt;Opening up &lt;code&gt;prayerRequestService.ts&lt;/code&gt; we're again in &lt;code&gt;NoImplicitAny&lt;/code&gt; country:&lt;/p&gt; &lt;a href="http://4.bp.blogspot.com/-QfZUdnxu5oA/U4c0iI-JF3I/AAAAAAAAAmg/pbwlmGGbBjo/s1600/prayerRequestService.ts.png" imageanchor="1" &gt;&lt;img border="0" src="http://4.bp.blogspot.com/-QfZUdnxu5oA/U4c0iI-JF3I/AAAAAAAAAmg/pbwlmGGbBjo/s1600/prayerRequestService.ts.png" /&gt;&lt;/a&gt; &lt;p&gt;This is fixed up by defining &lt;code&gt;$http&lt;/code&gt; as &lt;code&gt;ng.IHttpService&lt;/code&gt; and &lt;code&gt;email&lt;/code&gt; and &lt;code&gt;prayFor&lt;/code&gt; as &lt;code&gt;string&lt;/code&gt;.&lt;/p&gt; &lt;p&gt;As with &lt;code&gt;siteSectionService&lt;/code&gt; we need to create an interface to define what &lt;code&gt;prayerRequestService&lt;/code&gt; exposes.  This leaves us with this:&lt;/p&gt; &lt;pre class="prettyprint ts" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;"use strict";&lt;br /&gt;&lt;br /&gt;interface IPrayerRequestService {&lt;br /&gt;    sendPrayerRequest: (email: string, prayFor: string) =&gt; ng.IPromise&lt;{&lt;br /&gt;        success: boolean;&lt;br /&gt;        text: string;&lt;br /&gt;    }&gt;;&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;angular.module("poorClaresApp.services").factory(&lt;br /&gt;&lt;br /&gt;    "prayerRequestService",&lt;br /&gt;&lt;br /&gt;    ["$http",&lt;br /&gt;    function ($http: ng.IHttpService): IPrayerRequestService {&lt;br /&gt;&lt;br /&gt;        var url = "/PrayerRequest";&lt;br /&gt;&lt;br /&gt;        function sendPrayerRequest(email: string, prayFor: string) {&lt;br /&gt;&lt;br /&gt;            var params = { email: email, prayFor: prayFor };&lt;br /&gt;&lt;br /&gt;            return $http.post(url, params)&lt;br /&gt;                .then(function (response) {&lt;br /&gt;                    return {&lt;br /&gt;                        success: response.data.success,&lt;br /&gt;                        text: response.data.text&lt;br /&gt;                    };&lt;br /&gt;                });&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        return {&lt;br /&gt;            sendPrayerRequest: sendPrayerRequest&lt;br /&gt;        };&lt;br /&gt;    }]);&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;h4&gt;TypeScriptify &lt;code&gt;prayerRequestController.ts&lt;/code&gt;&lt;/h4&gt; &lt;p&gt;Opening up &lt;code&gt;prayerRequestController.ts&lt;/code&gt; leads me to the conclusion that I have &lt;strong&gt;no interesting way left&lt;/strong&gt; of telling you that we once more need to supply types for our parameters.  Let's take it as read that the same will happen on all remaining files as well eh?  Hopefully by now it's fairly clear that this option is useful, even if only for a migration.  I say this because using it forces you to think about what typings should be applied to your code:&lt;/p&gt; &lt;a href="http://3.bp.blogspot.com/-5-joMHeUrNE/U4c5tcYeoLI/AAAAAAAAAmw/qwl0Bjz21zA/s1600/prayerRequestController.png" imageanchor="1" &gt;&lt;img border="0" src="http://3.bp.blogspot.com/-5-joMHeUrNE/U4c5tcYeoLI/AAAAAAAAAmw/qwl0Bjz21zA/s1600/prayerRequestController.png" /&gt;&lt;/a&gt; &lt;p&gt;We'll define &lt;code&gt;$scope&lt;/code&gt; as &lt;code&gt;ng.IScope&lt;/code&gt;, &lt;code&gt;prayerRequestService&lt;/code&gt; as &lt;code&gt;IPrayerRequestService&lt;/code&gt; (which we created just now) and &lt;code&gt;prayerRequest&lt;/code&gt; as &lt;code&gt;{ email: string; prayFor: string }&lt;/code&gt;. Which leaves me with this:&lt;/p&gt; &lt;pre class="prettyprint ts" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;"use strict";&lt;br /&gt;&lt;br /&gt;angular.module("poorClaresApp.controllers").controller(&lt;br /&gt;&lt;br /&gt;    "PrayerRequestController",&lt;br /&gt;&lt;br /&gt;    ["$scope", "prayerRequestService",&lt;br /&gt;    function ($scope: ng.IScope, prayerRequestService: IPrayerRequestService) {&lt;br /&gt;        &lt;br /&gt;        var vm = this;&lt;br /&gt;&lt;br /&gt;        vm.send = function (prayerRequest: { email: string; prayFor: string }) {&lt;br /&gt;&lt;br /&gt;            vm.message = {&lt;br /&gt;                success: true,&lt;br /&gt;                text: "Sending..."&lt;br /&gt;            };&lt;br /&gt;&lt;br /&gt;            prayerRequestService.sendPrayerRequest(prayerRequest.email, prayerRequest.prayFor)&lt;br /&gt;                .then(function (response) {&lt;br /&gt;                    vm.message = {&lt;br /&gt;                        success: response.success,&lt;br /&gt;                        text: response.text&lt;br /&gt;                    };&lt;br /&gt;                })&lt;br /&gt;                .then(null, function (error) { // IE 8 friendly alias for catch&lt;br /&gt;                    vm.message = {&lt;br /&gt;                        success: false,&lt;br /&gt;                        text: "Sorry your email was not sent"&lt;br /&gt;                    };&lt;br /&gt;                });&lt;br /&gt;        }&lt;br /&gt;    }]);&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;I could move on but let's go for bonus points (and now you'll see why the unit test suite is so handy). To quote the Angular documentation:&lt;/p&gt; &lt;blockquote cite="https://docs.angularjs.org/guide/controller"&gt;In Angular, a Controller is a JavaScript constructor function that is used to augment the Angular Scope. &lt;/blockquote&gt; &lt;p&gt;So let's see if we can swap over our vanilla contructor function for a TypeScript class.  This will (in my view) better express the intention of the code. To do this I am essentially following the example laid down by my Definitely Typed colleague &lt;a href="https://twitter.com/basarat"&gt;Basarat&lt;/a&gt;.  I highly recommend his &lt;a href="https://www.youtube.com/watch?v=WdtVn_8K17E"&gt;screencast on the topic&lt;/a&gt;. Also kudos to &lt;a href="https://twitter.com/andrewdavey"&gt;Andrew Davey&lt;/a&gt; whose &lt;a href="http://aboutcode.net/2013/10/20/typescript-angularjs-controller-classes.html"&gt;post on the topic&lt;/a&gt; also fed into this.&lt;/p&gt; &lt;pre class="prettyprint ts" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;"use strict";&lt;br /&gt;&lt;br /&gt;module poorClaresApp.controllers {&lt;br /&gt;    class PrayerRequestController {&lt;br /&gt;&lt;br /&gt;        static $inject = ["$scope", "prayerRequestService"];&lt;br /&gt;        constructor(&lt;br /&gt;            private $scope: ng.IScope,&lt;br /&gt;            private prayerRequestService: IPrayerRequestService) {&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        message: { success: boolean; text: string };&lt;br /&gt;&lt;br /&gt;        send(prayerRequest: { email: string; prayFor: string }) {&lt;br /&gt;&lt;br /&gt;            this.message = {&lt;br /&gt;                success: true,&lt;br /&gt;                text: "Sending..."&lt;br /&gt;            };&lt;br /&gt;&lt;br /&gt;            this.prayerRequestService.sendPrayerRequest(prayerRequest.email, prayerRequest.prayFor)&lt;br /&gt;                .then((response) =&gt; {&lt;br /&gt;                    this.message = {&lt;br /&gt;                        success: response.success,&lt;br /&gt;                        text: response.text&lt;br /&gt;                    };&lt;br /&gt;                })&lt;br /&gt;                .then(null, (error) =&gt; { // IE 8 friendly alias for catch&lt;br /&gt;                    this.message = {&lt;br /&gt;                        success: false,&lt;br /&gt;                        text: "Sorry your email was not sent"&lt;br /&gt;                    };&lt;br /&gt;                });&lt;br /&gt;        }&lt;br /&gt;    }&lt;br /&gt;&lt;br /&gt;    angular.module("poorClaresApp.controllers")&lt;br /&gt;           .controller("PrayerRequestController", PrayerRequestController);&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;My only reservation with this approach is that we have to declare the TypeScript class outside the &lt;code&gt;angular.module...&lt;/code&gt; statement.  To avoid cluttering up global scope I've placed our class in a module called &lt;code&gt;poorClaresApp.controllers&lt;/code&gt; which maps nicely to our Angular module name. It would be nice if I could place the class definition in an &lt;a href="http://en.wikipedia.org/wiki/Immediately-invoked_function_expression"&gt;IIFE&lt;/a&gt; to completely keep this completely isolated but TypeScript doesn't allow for that syntax (for reasons I'm unclear about - the output would be legal JavaScript).&lt;/p&gt; &lt;p&gt;For a small class this seems to add a little noise but as classes grow in complexity I think this approach will quickly start to pay dividends. There are a few things worth noting about the above approach:&lt;/p&gt; &lt;ul&gt;&lt;li&gt;The required injectable parameters have moved into the class definition in the form of the &lt;code&gt;static $inject&lt;/code&gt; statement.  I personally like that this no longer sits outside the code it relates to.&lt;/li&gt;&lt;li&gt;Because we're using TypeScript arrow functions (which preserve the outer "this" context) we are now free to dispose of the &lt;code&gt;var vm = this;&lt;/code&gt; mechanism we're were previously using for the same purpose. Much more intuitive code to my mind.&lt;/li&gt;&lt;li&gt;We are not actually using &lt;code&gt;$scope&lt;/code&gt; at all in this controller - maybe it should be removed entirely in the long run.&lt;/li&gt;&lt;/ul&gt; &lt;h4&gt;TypeScriptify &lt;code&gt;navController.ts&lt;/code&gt;&lt;/h4&gt; &lt;p&gt;&lt;code&gt;navController&lt;/code&gt; can be simply converted like so:&lt;/p&gt; &lt;pre class="prettyprint ts" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;"use strict";&lt;br /&gt;&lt;br /&gt;interface INavControllerScope extends ng.IScope {&lt;br /&gt;    isCollapsed: boolean;&lt;br /&gt;    siteSection: string;&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;angular.module("poorClaresApp.controllers").controller(&lt;br /&gt;&lt;br /&gt;    "NavController",&lt;br /&gt;&lt;br /&gt;    ["$scope", "siteSectionService",&lt;br /&gt;    function ($scope: INavControllerScope, siteSectionService: ISiteSectionService) {&lt;br /&gt;&lt;br /&gt;        $scope.isCollapsed = true;&lt;br /&gt;        $scope.siteSection = siteSectionService.getSiteSection();&lt;br /&gt;&lt;br /&gt;        $scope.$watch(siteSectionService.getSiteSection, function (newValue, oldValue) {&lt;br /&gt;            $scope.siteSection = newValue;&lt;br /&gt;        });&lt;br /&gt;    }]);&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;I'd draw your attention to the creation of a the &lt;code&gt;INavControllerScope&lt;/code&gt; interface that extends the default Angular $scope of &lt;code&gt;ng.IScope&lt;/code&gt; with 2 extra properties.&lt;/p&gt; &lt;p&gt;Let's also switch this over to the class based approach (there is less of a reason to on this occasion just looking at the size of the codebase but I'm all about consistency of approach):&lt;/p&gt; &lt;pre class="prettyprint ts" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;"use strict";&lt;br /&gt;&lt;br /&gt;module poorClaresApp.controllers {&lt;br /&gt;    interface INavControllerScope extends ng.IScope {&lt;br /&gt;        isCollapsed: boolean;&lt;br /&gt;        siteSection: string;&lt;br /&gt;    }&lt;br /&gt;&lt;br /&gt;    class NavController {&lt;br /&gt;&lt;br /&gt;        static $inject = ["$scope", "siteSectionService"];&lt;br /&gt;        constructor(&lt;br /&gt;            private $scope: INavControllerScope,&lt;br /&gt;            private siteSectionService: ISiteSectionService) {&lt;br /&gt;&lt;br /&gt;            $scope.isCollapsed = true;&lt;br /&gt;            $scope.siteSection = siteSectionService.getSiteSection();&lt;br /&gt;&lt;br /&gt;            $scope.$watch(siteSectionService.getSiteSection, function (newValue, oldValue) {&lt;br /&gt;                $scope.siteSection = newValue;&lt;br /&gt;            });&lt;br /&gt;        }&lt;br /&gt;    }&lt;br /&gt;&lt;br /&gt;    angular.module("poorClaresApp.controllers").controller("NavController", NavController);&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;h4&gt;TypeScriptify &lt;code&gt;mainController.ts&lt;/code&gt;&lt;/h4&gt; &lt;p&gt;Finally, &lt;code&gt;mainController&lt;/code&gt; can be converted as follows:&lt;/p&gt; &lt;pre class="prettyprint ts" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;"use strict";&lt;br /&gt;&lt;br /&gt;angular.module("poorClaresApp.controllers").controller(&lt;br /&gt;&lt;br /&gt;    "MainController",&lt;br /&gt;&lt;br /&gt;    ["$location", "siteSectionService",&lt;br /&gt;    function ($location: ng.ILocationService, siteSectionService: ISiteSectionService) {&lt;br /&gt;&lt;br /&gt;        siteSectionService.determineSiteSection($location.path());&lt;br /&gt;    }]);&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Again it's just a case of assigning the undeclared types.  For completeness lets also switch this over to the class based approach:&lt;/p&gt; &lt;pre class="prettyprint ts" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;"use strict";&lt;br /&gt;&lt;br /&gt;module poorClaresApp.controllers {&lt;br /&gt;    class MainController {&lt;br /&gt;&lt;br /&gt;        static $inject = ["$location", "siteSectionService"];&lt;br /&gt;        constructor(&lt;br /&gt;            private $location: ng.ILocationService,&lt;br /&gt;            private siteSectionService: ISiteSectionService) {&lt;br /&gt;&lt;br /&gt;            siteSectionService.determineSiteSection($location.path());&lt;br /&gt;        }&lt;br /&gt;    }&lt;br /&gt;&lt;br /&gt;    angular.module("poorClaresApp.controllers").controller("MainController", MainController);&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;h4&gt;Did it work?  Drum roll...&lt;/h4&gt; &lt;p&gt;In unit tests we trust.  Let's run them...&lt;/p&gt; &lt;a href="http://2.bp.blogspot.com/-re8aAJVtSDk/U4hYNPqKk9I/AAAAAAAAAnA/1Vu7ooQk1jw/s1600/UnitTestsPass.png" imageanchor="1" &gt;&lt;img border="0" src="http://2.bp.blogspot.com/-re8aAJVtSDk/U4hYNPqKk9I/AAAAAAAAAnA/1Vu7ooQk1jw/s1600/UnitTestsPass.png" /&gt;&lt;/a&gt; &lt;p&gt;Success! I hope you found this useful.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1635211266608740454'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1635211266608740454'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2014/06/migrating-from-angularjs-to-angularts.html' title='Migrating from AngularJS to AngularTS - a walkthrough'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='http://2.bp.blogspot.com/-jUf3uryRdKk/U4w3VVMX04I/AAAAAAAAAnQ/6Pu84tk92S0/s72-c/SisterGabriel.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5780477507346583183</id><published>2014-05-15T12:26:00.001+01:00</published><updated>2021-03-14T05:24:29.138Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='Jasmine'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Visual Studio'/><category scheme='http://www.blogger.com/atom/ns#' term='Continuous Integration'/><category scheme='http://www.blogger.com/atom/ns#' term='Team Foundation Server'/><category scheme='http://www.blogger.com/atom/ns#' term='Chutzpah'/><title type='text'>Team Foundation Server, Continuous Integration and separate projects for JavaScript unit tests</title><content type='html'>&lt;p&gt;Do you like to separate out your unit tests from the project you are testing?  I imagine so.  My own practice when creating a new project in Visual Studio is to create a separate unit test project alongside whose responsibility is to house unit tests for that new project.&lt;/p&gt; &lt;p&gt;When I check in code for that project I expect the continuous integration build to kick off and, as part of that, the unit tests to be run.  When it comes to running .NET tests then Team Foundation Server (and it's cloud counterpart Visual Studio Online) has your back.  When it comes to running JavaScript tests then... not so much.&lt;/p&gt; &lt;p&gt;This post will set out:&lt;/p&gt; &lt;ol&gt;&lt;li&gt;How to get JavaScript tests to run on TFS / VSO in a continuous integration scenario.&lt;/li&gt;&lt;li&gt;How to achieve this *&lt;strong&gt;without&lt;/strong&gt;* having to include your tests as part of web project.&lt;/li&gt;&lt;/ol&gt; &lt;p&gt;To do this I will lean heavily (that's fancy language for "rip off entirely") on an &lt;a href="http://blogs.msdn.com/b/visualstudioalm/archive/2012/07/09/javascript-unit-tests-on-team-foundation-service-with-chutzpah.aspx"&gt;excellent blog post by Mathew Aniyan&lt;/a&gt; which covers point #1.  My contribution is point #2.&lt;/p&gt; &lt;h4&gt;Points #1 and #2 in short order&lt;/h4&gt; &lt;p&gt;First of all, install Chutzpah on TFS / VSO.  You can do this by following &lt;a href="http://blogs.msdn.com/b/visualstudioalm/archive/2012/07/09/javascript-unit-tests-on-team-foundation-service-with-chutzpah.aspx"&gt;Steps 1 - 6 from Mathew Aniyan's post&lt;/a&gt;.  Instead of following steps 7 and 8 create a new unit test project in your solution.&lt;/p&gt; &lt;aside&gt;This unit test project will effectively be a C# project that hosts no real C# code at all. Instead we're going to use it to house JavaScript tests.  If there is another way to have a separate project which TFS / VSO can pick up on and run tests in then please let me know.  As far as I'm aware though, this is the only game in town.&lt;/aside&gt; &lt;p&gt;&lt;strong&gt;Edit 29/05/2014:&lt;/strong&gt; Matthew Manela (creator of Chutzpah) has confirmed that this is the correct approach - thanks chap!&lt;/p&gt; &lt;blockquote class="twitter-tweet" lang="en"&gt;&lt;p&gt;&lt;a href="https://twitter.com/johnny_reilly"&gt;@johnny_reilly&lt;/a&gt; Nope that is pretty much what you need to do.&lt;/p&gt;&amp;mdash; Matthew Manela (@mmanela) &lt;a href="https://twitter.com/mmanela/statuses/466962743400996864"&gt;May 15, 2014&lt;/a&gt;&lt;/blockquote&gt;&lt;script async src="//platform.twitter.com/widgets.js" charset="utf-8"&gt;&lt;/script&gt; &lt;p&gt;To our unit test project add your JavaScript unit tests.  These should be marked in Visual Studio with a Build Action of "Content" and a Copy to Output Directory of "Do not copy".  You should be able to run these tests locally using the Visual Studio Chutzpah extension - or indeed in some other JavaScript test runner.  Then, and this is the important part, edit the csproj file of your unit test project and add this &lt;code&gt;Import Project&lt;/code&gt; statement:&lt;/p&gt; &lt;pre class="prettyprint xml" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-xml"&gt;&lt;br /&gt;  &amp;lt;Import Project="$(VSToolsPath)\WebApplications\Microsoft.WebApplication.targets" Condition="'$(VSToolsPath)' != ''" /&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt; &lt;p&gt;Ordering is important in this case.  It matters that this new statement sits after the other &lt;code&gt;Import Project&lt;/code&gt; statements.  So you should end up with a csproj file that looks in part like this: (comments added by me for clarity)&lt;/p&gt; &lt;pre class="prettyprint xml" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-xml"&gt;&lt;br /&gt;  &amp;lt;!-- Pre-existing Import Project statements start --&gt;&lt;br /&gt;  &amp;lt;Import Project="$(VSToolsPath)\TeamTest\Microsoft.TestTools.targets" Condition="Exists('$(VSToolsPath)\TeamTest\Microsoft.TestTools.targets')" /&amp;gt;&lt;br /&gt;  &amp;lt;Import Project="$(MSBuildToolsPath)\Microsoft.CSharp.targets" /&amp;gt;&lt;br /&gt;  &amp;lt;!-- Pre-existing Import Project statements end --&gt;&lt;br /&gt;&lt;br /&gt;  &amp;lt;!-- New addition start --&gt;&lt;br /&gt;  &amp;lt;Import Project="$(VSToolsPath)\WebApplications\Microsoft.WebApplication.targets" Condition="'$(VSToolsPath)' != ''" /&amp;gt;&lt;br /&gt;  &amp;lt;!-- New addition end --&gt;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt; &lt;p&gt;Check in your amended csproj and the unit tests to TFS / VSO.  You should see the JavaScript unit tests being run as part of the build.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5780477507346583183'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5780477507346583183'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2014/05/team-foundation-server-continuous-integration-and-javascript-unit-tests-in-unit-test-project.html' title='Team Foundation Server, Continuous Integration and separate projects for JavaScript unit tests'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5294321863550376612</id><published>2014-05-05T15:37:00.003+01:00</published><updated>2021-03-14T05:22:55.680Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='jquery'/><category scheme='http://www.blogger.com/atom/ns#' term='JSDoc'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='TypeScript'/><category scheme='http://www.blogger.com/atom/ns#' term='Intellisense'/><category scheme='http://www.blogger.com/atom/ns#' term='jQuery.d.ts'/><title type='text'>TypeScript, JSDoc and Intellisense</title><content type='html'>&lt;h4&gt;Days of Yore&lt;/h4&gt; &lt;p&gt;It was my first job. The web was alive and well at this point but still very much in it's infancy.  Newspapers had only recently moved on from calling it "the information superhighway".  No-one was doing &lt;em&gt;real&lt;/em&gt; programming for the web - the desktop was where it was at.&lt;/p&gt; &lt;p&gt;As for me, I was writing call centre software.  It was all very exciting.  Here was the idea:  the phone on your desk would start ringing and through the magic of &lt;a href="http://en.wikipedia.org/wiki/Telephony_Application_Programming_Interface"&gt;TAPI&lt;/a&gt; our app would be presented with the telephone number of the dialer.  It would then look up that telephone number in the appropriate CRM application and pop the callers details on the screen.  You'd pick up the phone and bellow "why hello Mr Jones!" and either impress the caller with your incredible fore-knowledge of who had rung you or perhaps terrify them with our &lt;a href="http://en.wikipedia.org/wiki/Nineteen_Eighty-Four"&gt;Brave New Orwellian World&lt;/a&gt;.&lt;/p&gt; &lt;p&gt;My job was to work out how to call into the APIs of the various CRM applications / databases being used and extract the relevant information.  So it goes without saying that I have spent a lot of time with badly documented APIs.  Or in fact &lt;em&gt;undocumented&lt;/em&gt; APIs.  I know pain my friend...&lt;/p&gt; &lt;p&gt;Hours and days were spent debugging and walking APIs just to find out what they could do and what information they exposed.  This, I need hardly say, was dull and tedious work.  Having spent longer than I care to remember with no more information on an API than method names has left its mark on me.  I am consequently keener than your average dev on documentation and intellisense.  When you've stared at the coalface of the &lt;a href="http://en.wikipedia.org/wiki/IBM_Notes"&gt;Lotus Notes&lt;/a&gt; API for 2 weeks with only Dephi 3 as your constant companion you'd feel the same way too.  (This was &lt;a href="http://en.wikipedia.org/wiki/AltaVista"&gt;before the days of Google&lt;/a&gt; and actually being able to find stuff on the internet.)&lt;/p&gt; &lt;p&gt;If you can convey information about the API that you're building then I'd say you're duty-bound to do so.  Or at least that it's good manners.&lt;/p&gt; &lt;h4&gt;Definitely Intellisensed&lt;/h4&gt; &lt;p&gt;When I started getting involved with the &lt;a href="https://github.com/DefinitelyTyped"&gt;Definitely Typed project&lt;/a&gt; my focus was on giving good Intellisense.  Where there was documentation for an API I wanted to get that popping in front of users when they hit the "." key:&lt;/p&gt; &lt;a href="http://blogs.msdn.com/cfs-filesystemfile.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-56-67/1200.JSDoc_5F00_in_5F00_VS.png" imageanchor="1" &gt;&lt;img border="0" src="http://blogs.msdn.com/cfs-filesystemfile.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-56-67/1200.JSDoc_5F00_in_5F00_VS.png" /&gt;&lt;/a&gt; &lt;p&gt;As the above screenshot demonstrates &lt;a href="http://blogs.msdn.com/b/typescript/archive/2013/01/21/announcing-typescript-0-8-2.aspx"&gt;TypeScript supports Intellisense&lt;/a&gt; through a slightly tweaked implementation of &lt;a href="http://en.wikipedia.org/wiki/JSDoc"&gt;JSDoc&lt;/a&gt;:&lt;/p&gt; &lt;blockquote cite="http://blogs.msdn.com/b/typescript/archive/2013/01/21/announcing-typescript-0-8-2.aspx" style="font-style:italic;"&gt; &lt;p&gt;With 0.8.2, the TypeScript compiler and tools now support JSDoc comments.&lt;/p&gt; &lt;p&gt;In the TypeScript implementation, because types are already part of the system, we allow the JSDoc type annotation to be elided, as in the example above.&lt;/p&gt; &lt;p&gt;You can now document a variety of language constructs (including classes, modules, interfaces, and functions) with comments that become part of the information displayed to the user.  Weve also started extending lib.d.ts, the default JS and DOM API library, with JSDoc comments.&lt;/p&gt; &lt;/blockquote&gt; &lt;p&gt;Partly as an exercise in getting better acquainted with TypeScript and partly responding to my instinctive need to have nicely documented APIs I decided to start adding JSDoc comments to the world's most popular typings file &lt;code&gt;&lt;a href="https://github.com/borisyankov/DefinitelyTyped/blob/master/jquery/jquery.d.ts"&gt;jquery.d.ts&lt;/a&gt;&lt;/code&gt;.&lt;/p&gt; &lt;div class="digression getOutOfMySight"&gt; &lt;h4&gt;Why &lt;code&gt;jquery.d.ts&lt;/code&gt;?&lt;/h4&gt; &lt;p&gt;Well a number of reasons:&lt;/p&gt; &lt;ol&gt;&lt;li&gt;I used &lt;code&gt;jquery.d.ts&lt;/code&gt; already myself and I'm a firm believer in &lt;a href="http://en.wikipedia.org/wiki/Eating_your_own_dog_food"&gt;eating your own dogfood&lt;/a&gt;&lt;/li&gt;&lt;li&gt;jQuery is well documented.  I needed a source of information to power my JSDoc and &lt;a href="//api.jquery.com"&gt;api.jquery.com&lt;/a&gt; had my back.&lt;/li&gt;&lt;li&gt;&lt;code&gt;jquery.d.ts&lt;/code&gt; was widely used. Given how ubiquitous jQuery has become this typing file was unsurprisingly the most popular in the world.  That was key for me as I wanted feedback - if I was making a mess of the typings I wanted someone to pitch in and tell me.&lt;/li&gt;&lt;/ol&gt; &lt;p&gt;Just to digress once more, points #2 and #3 turned out to be of particular note.&lt;/p&gt; &lt;p&gt;Concerning point #2, I did find the occasional &lt;a href="https://github.com/borisyankov/DefinitelyTyped/pull/1471#issuecomment-31204115"&gt;error&lt;/a&gt; or &lt;a href="https://github.com/borisyankov/DefinitelyTyped/pull/1835#issuecomment-37533088"&gt;inconsistency&lt;/a&gt; in the jQuery API documentation.  These were definitely the exception rather than the rule though.  And thanks to the very helpful &lt;a href="https://github.com/dmethvin"&gt;Dave Methvin&lt;/a&gt; these actually lead to &lt;a href="https://github.com/jquery/api.jquery.com/pull/460"&gt;minor improvements to the jQuery API documentation&lt;/a&gt;.&lt;/p&gt; &lt;blockquote class="twitter-tweet" lang="en"&gt;&lt;p&gt;&lt;a href="https://twitter.com/search?q=%23TypeScript&amp;amp;src=hash"&gt;#TypeScript&lt;/a&gt; definitions pointing out errors in JavaScript docs of a project &lt;a href="https://twitter.com/search?q=%23Jquery&amp;amp;src=hash"&gt;#Jquery&lt;/a&gt; : &lt;a href="https://t.co/v6rzCdBwmi"&gt;https://t.co/v6rzCdBwmi&lt;/a&gt; caught by &lt;a href="https://twitter.com/johnny_reilly"&gt;@johnny_reilly&lt;/a&gt;&lt;/p&gt;&amp;mdash; basarat (@basarat) &lt;a href="https://twitter.com/basarat/statuses/416309213430689792"&gt;December 26, 2013&lt;/a&gt;&lt;/blockquote&gt;&lt;script async src="//platform.twitter.com/widgets.js" charset="utf-8"&gt;&lt;/script&gt; &lt;p&gt;Concerning point #3 I did indeed get feedback.  As well as enriching &lt;code&gt;jquery.d.ts&lt;/code&gt; with JSDoc goodness I also found myself fixing slight errors in the typings.  Here and there I would find examples where &lt;code&gt;jquery.d.ts&lt;/code&gt; was out of line the with API documentation.  Where this was the case I would amend the typings to bring them into line - trying to make &lt;code&gt;jquery.d.ts&lt;/code&gt; entirely API-compliant. This was &lt;a href="https://github.com/borisyankov/DefinitelyTyped/issues/1499"&gt;not always popular&lt;/a&gt;. But despite the heat it generated I think it ended up leading to a better typing file. I'm again grateful for Dave Methvin's thoughtful contributions.&lt;/p&gt; &lt;/div&gt; &lt;h4&gt;Turning API documentation into JSDoc&lt;/h4&gt; &lt;p&gt;I wanted to take an example of API documentation and demonstrate how that can be applied to a typing file with particular focus on how JSDoc comments can be created to drive Intellisense.  So let's take everyone's favourite jQuery method: &lt;code title="everybody loves her!"&gt;val&lt;/code&gt;.  The documentation of &lt;code&gt;val&lt;/code&gt; can be found here: &lt;a href="http://api.jquery.com/val"&gt;api.jquery.com/val&lt;/a&gt;&lt;/p&gt; &lt;p&gt;By the way, check out the *&lt;em&gt;entirely&lt;/em&gt;* intuitive URL.  Now you've clocked just how straightforward that is you've probably a fair idea how you could find pretty much any jQuery documentation you might need without recourse to Google.  Brilliant!&lt;/p&gt; &lt;p&gt;Let's take a look at what &lt;code&gt;val&lt;/code&gt; looked like &lt;a href="https://github.com/borisyankov/DefinitelyTyped/blob/c98eebb13724b5156f12318b68fc2d875ca6e4a3/jquery/jquery.d.ts#L364-L368"&gt;before JSDoc&lt;/a&gt; in the first version of the typing available on GitHub. (By the way, remember the original &lt;code&gt;jquery.d.ts&lt;/code&gt; &lt;a href="https://typescript.codeplex.com/sourcecontrol/latest#samples/jquery/jquery.d.ts"&gt; came out of the TypeScript team&lt;/a&gt;):&lt;/p&gt; &lt;pre class="prettyprint ts" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;    val(): any;&lt;br /&gt;    val(value: string[]): JQuery;&lt;br /&gt;    val(value: string): JQuery;&lt;br /&gt;    val(value: number): JQuery;&lt;br /&gt;    val(func: (index: any, value: any) =&gt; any): JQuery;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;And now let's look at &lt;code&gt;jquery.d.ts&lt;/code&gt; &lt;a href="https://github.com/borisyankov/DefinitelyTyped/blob/c259dba094121a389b41c573d5000dda7bdf2092/jquery/jquery.d.ts#L1494-L1545"&gt;after JSDoc&lt;/a&gt;:&lt;/p&gt; &lt;pre class="prettyprint ts" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;    /**&lt;br /&gt;     * Get the current value of the first element in the set of matched elements.&lt;br /&gt;     */&lt;br /&gt;    val(): any;&lt;br /&gt;    /**&lt;br /&gt;     * Set the value of each element in the set of matched elements.&lt;br /&gt;     *&lt;br /&gt;     * @param value A string of text or an array of strings corresponding to the value of each matched element to set as selected/checked.&lt;br /&gt;     */&lt;br /&gt;    val(value: string): JQuery;&lt;br /&gt;    /**&lt;br /&gt;     * Set the value of each element in the set of matched elements.&lt;br /&gt;     *&lt;br /&gt;     * @param value A string of text or an array of strings corresponding to the value of each matched element to set as selected/checked.&lt;br /&gt;     */&lt;br /&gt;    val(value: string[]): JQuery;&lt;br /&gt;    /**&lt;br /&gt;     * Set the value of each element in the set of matched elements.&lt;br /&gt;     *&lt;br /&gt;     * @param func A function returning the value to set. this is the current element. Receives the index position of the element in the set and the old value as arguments.&lt;br /&gt;     */&lt;br /&gt;    val(func: (index: number, value: string) =&gt; string): JQuery;&lt;br /&gt;    /**&lt;br /&gt;     * Set the value of each element in the set of matched elements.&lt;br /&gt;     *&lt;br /&gt;     * @param func A function returning the value to set. this is the current element. Receives the index position of the element in the set and the old value as arguments.&lt;br /&gt;     */&lt;br /&gt;    val(func: (index: number, value: string[]) =&gt; string): JQuery;&lt;br /&gt;    /**&lt;br /&gt;     * Set the value of each element in the set of matched elements.&lt;br /&gt;     *&lt;br /&gt;     * @param func A function returning the value to set. this is the current element. Receives the index position of the element in the set and the old value as arguments.&lt;br /&gt;     */&lt;br /&gt;    val(func: (index: number, value: number) =&gt; string): JQuery;&lt;br /&gt;    /**&lt;br /&gt;     * Set the value of each element in the set of matched elements.&lt;br /&gt;     *&lt;br /&gt;     * @param func A function returning the value to set. this is the current element. Receives the index position of the element in the set and the old value as arguments.&lt;br /&gt;     */&lt;br /&gt;    val(func: (index: number, value: string) =&gt; string[]): JQuery;&lt;br /&gt;    /**&lt;br /&gt;     * Set the value of each element in the set of matched elements.&lt;br /&gt;     *&lt;br /&gt;     * @param func A function returning the value to set. this is the current element. Receives the index position of the element in the set and the old value as arguments.&lt;br /&gt;     */&lt;br /&gt;    val(func: (index: number, value: string[]) =&gt; string[]): JQuery;&lt;br /&gt;    /**&lt;br /&gt;     * Set the value of each element in the set of matched elements.&lt;br /&gt;     *&lt;br /&gt;     * @param func A function returning the value to set. this is the current element. Receives the index position of the element in the set and the old value as arguments.&lt;br /&gt;     */&lt;br /&gt;    val(func: (index: number, value: number) =&gt; string[]): JQuery;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Many changes yes? Let's break it down a little.&lt;/p&gt; &lt;h4&gt;1. You have 20 seconds to comply (with the API)&lt;/h4&gt; &lt;p&gt;The first thing to note is the &lt;code&gt;number&lt;/code&gt; setter method:&lt;/p&gt; &lt;pre class="prettyprint ts" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;    val(value: number): JQuery;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Let's have a look at the jQuery documentation for the simple setter:&lt;/p&gt; &lt;blockquote cite="http://api.jquery.com/val/#val-value" class="method"&gt;&lt;h4 class="name"&gt;&lt;a href="http://api.jquery.com/val/#val-value"&gt;.val( value )&lt;/a&gt;&lt;/h4&gt;&lt;div&gt;&lt;strong&gt;value&lt;/strong&gt;&lt;/div&gt;&lt;div&gt;Type: &lt;a href="http://api.jquery.com/Types/#String"&gt;String&lt;/a&gt; or &lt;a href="http://api.jquery.com/Types/#Array"&gt;Array&lt;/a&gt;&lt;/div&gt;&lt;div&gt;A string of text or an array of strings corresponding to the value of each matched element to set as selected/checked.&lt;/div&gt;&lt;/blockquote&gt; &lt;p&gt;See the problem?  There is *&lt;em&gt;no&lt;/em&gt;* &lt;code&gt;number&lt;/code&gt; setter. The typings are wrong. So let's remedy this:&lt;/p&gt; &lt;pre class="prettyprint ts" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;    &lt;strike&gt;val(value: number): JQuery;&lt;/strike&gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;h4&gt;2. &lt;code&gt;String&lt;/code&gt; and &lt;code&gt;Array of String&lt;/code&gt; setters&lt;/h4&gt; &lt;p&gt;The documentation states that we have setters which accept &lt;code&gt;String&lt;/code&gt; and &lt;code&gt;Array of String&lt;/code&gt;.  These are already modeled in the existing typings by the &lt;code&gt;string&lt;/code&gt; and &lt;code&gt;string[]&lt;/code&gt; overloads:&lt;/p&gt; &lt;pre class="prettyprint ts" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;    val(value: string[]): JQuery;&lt;br /&gt;    val(value: string): JQuery;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;So let's enrich these typings with some JSDoc:&lt;/p&gt; &lt;pre class="prettyprint ts" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;    /**&lt;br /&gt;     * Set the value of each element in the set of matched elements.&lt;br /&gt;     *&lt;br /&gt;     * @param value A string of text or an array of strings corresponding to the value of each matched element to set as selected/checked.&lt;br /&gt;     */&lt;br /&gt;    val(value: string): JQuery;&lt;br /&gt;    /**&lt;br /&gt;     * Set the value of each element in the set of matched elements.&lt;br /&gt;     *&lt;br /&gt;     * @param value A string of text or an array of strings corresponding to the value of each matched element to set as selected/checked.&lt;br /&gt;     */&lt;br /&gt;    val(value: string[]): JQuery;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;If you look you can see we've added a related JSDoc style comment block prior to each overload.  The first part of the comment (&lt;em&gt;"Set the value of..."&lt;/em&gt;) is the overarching Intellisense that is displayed. Each of the &lt;code&gt;@param&lt;/code&gt; statements represents each of the parameters and it's associated comment.  By comparing the &lt;a href="http://api.jquery.com/val/#val-value"&gt;API documentation&lt;/a&gt; to the JSDoc it's pretty clear how the API has been transformed into useful JSDoc.&lt;/p&gt; &lt;a href="http://2.bp.blogspot.com/-ljw2HiAp0qE/U2D915IIcaI/AAAAAAAAAkk/DVPv-TolEJw/s1600/Intellisense-Setter-String.png" imageanchor="1" &gt;&lt;img border="0" src="http://2.bp.blogspot.com/-ljw2HiAp0qE/U2D915IIcaI/AAAAAAAAAkk/DVPv-TolEJw/s640/Intellisense-Setter-String.png" /&gt;&lt;/a&gt; &lt;p&gt;It's worth noting that I could have taken the choice to customise the &lt;code&gt;@param value&lt;/code&gt; comments based on the overload I was JSDoc-ing. Arguably it would have been more useful to have something like this instead:&lt;/p&gt; &lt;pre class="prettyprint ts" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;    /**&lt;br /&gt;     * Set the value of each element in the set of matched elements.&lt;br /&gt;     *&lt;br /&gt;     * @param value A string of text &lt;strike&gt;or an array of strings&lt;/strike&gt; corresponding to the value of each matched element to set as selected/checked.&lt;br /&gt;     */&lt;br /&gt;    val(value: string): JQuery;&lt;br /&gt;    /**&lt;br /&gt;     * Set the value of each element in the set of matched elements.&lt;br /&gt;     *&lt;br /&gt;     * @param value &lt;strike&gt;A string of text or&lt;/strike&gt; an array of strings corresponding to the value of each matched element to set as selected/checked.&lt;br /&gt;     */&lt;br /&gt;    val(value: string[]): JQuery;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;After some pondering I decided not to take this approach, just to maintain that close relationship between &lt;code&gt;jquery.d.ts&lt;/code&gt; and &lt;a href="http://api.jquery.com/"&gt;api.jquery.com&lt;/a&gt;. It's open to debate how useful that relationship actually is so I thought I'd just highlight this as a choice I made.&lt;/p&gt; &lt;h4&gt;3. Getter&lt;/h4&gt; &lt;p&gt;The jQuery documentation for the getter looks like this:&lt;/p&gt; &lt;blockquote cite="http://api.jquery.com/val/#val" class="method"&gt;&lt;h4 class="name"&gt;&lt;a href="http://api.jquery.com/val/#val"&gt;&lt;span class="icon-link"&gt;&lt;/span&gt;&lt;span class="name"&gt;.val()&lt;/span&gt;&lt;/a&gt;&lt;span class="returns"&gt;Returns: &lt;a href="http://api.jquery.com/Types/#String"&gt;String&lt;/a&gt; or &lt;a href="http://api.jquery.com/Types/#Number"&gt;Number&lt;/a&gt; or &lt;a href="http://api.jquery.com/Types/#Array"&gt;Array&lt;/a&gt;&lt;/span&gt;&lt;/h4&gt;&lt;p class="desc"&gt;&lt;strong&gt;Description: &lt;/strong&gt;Get the current value of the first element in the set of matched elements.&lt;/p&gt;&lt;/blockquote&gt; &lt;p&gt;So the &lt;code&gt;val()&lt;/code&gt; overload can return a &lt;code&gt;string&lt;/code&gt;, a &lt;code&gt;number&lt;/code&gt; or a &lt;code&gt;string[]&lt;/code&gt;.  Unfortunately there is no real way to model that in TypeScript at present due to the absence of &lt;a href="https://typescript.codeplex.com/workitem/1364"&gt;"union types"&lt;/a&gt;.  Union types are being &lt;a href="https://typescript.codeplex.com/discussions/543598#PostDetailsCell_1239340"&gt;discussed at present&lt;/a&gt; but in TypeScript v1.0 world the only viable approach is returning the &lt;code&gt;any&lt;/code&gt; type. This implies &lt;code&gt;val()&lt;/code&gt; returns any possible JavaScript value from &lt;code&gt;boolean&lt;/code&gt; to &lt;code&gt;Function&lt;/code&gt; and straight on 'til morning.  So clearly this isn't accurate but importantly it also allows for the possibility of &lt;code&gt;val()&lt;/code&gt; returning &lt;code&gt;string&lt;/code&gt;, &lt;code&gt;number&lt;/code&gt; or &lt;code&gt;string[]&lt;/code&gt;.&lt;/p&gt; &lt;p&gt;The final getter typing with JSDoc applied ends up looking like this:&lt;/p&gt; &lt;pre class="prettyprint ts" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;    /**&lt;br /&gt;     * Get the current value of the first element in the set of matched elements.&lt;br /&gt;     */&lt;br /&gt;    val(): any;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;As you can see the &lt;em&gt;"Get the current value..."&lt;/em&gt; from the API docs has been used as the overarching Intellisense that is displayed for the getter.&lt;/p&gt; &lt;a href="http://4.bp.blogspot.com/-7PG3jVXPWdM/U2D-BvxwYYI/AAAAAAAAAks/_ZTRQWBt7L8/s1600/Intellisense-Getter.png" imageanchor="1" &gt;&lt;img border="0" src="http://4.bp.blogspot.com/-7PG3jVXPWdM/U2D-BvxwYYI/AAAAAAAAAks/_ZTRQWBt7L8/s640/Intellisense-Getter.png" /&gt;&lt;/a&gt; &lt;h4&gt;4. The &lt;code&gt;Function&lt;/code&gt; setter&lt;/h4&gt; &lt;p&gt;Finally we're going to take a look at the &lt;code&gt;Function&lt;/code&gt; setter which is documented as follows:&lt;/p&gt; &lt;blockquote cite="http://api.jquery.com/val/#val-functionindex--value" class="method"&gt;&lt;h4 class="name"&gt;&lt;a href="http://api.jquery.com/val/#val-functionindex--value"&gt;&lt;span class="icon-link"&gt;&lt;/span&gt;.val( function(index, value) )&lt;/a&gt;&lt;/h4&gt;&lt;div&gt;&lt;strong&gt;function(index, value)&lt;/strong&gt;&lt;/div&gt;&lt;div&gt;Type: &lt;a href="http://api.jquery.com/Types/#Function"&gt;Function&lt;/a&gt;()&lt;/div&gt;&lt;div&gt;A function returning the value to set. &lt;code&gt;this&lt;/code&gt; is the current element. Receives the index position of the element in the set and the old value as arguments.&lt;/div&gt;&lt;/blockquote&gt; &lt;p&gt;If you cast your eyes back to the original typings for the &lt;code&gt;Function&lt;/code&gt; setter you'll see they look like this:&lt;/p&gt; &lt;pre class="prettyprint ts" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;    val(func: (index: any, value: any) =&gt; any): JQuery;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;This is a good start but it's less accurate than it could be in a number of ways:&lt;/p&gt; &lt;ol&gt;&lt;li&gt;&lt;code&gt;index&lt;/code&gt; is a &lt;code&gt;number&lt;/code&gt; - we needn't keep it as an &lt;code&gt;any&lt;/code&gt;&lt;/li&gt;&lt;li&gt;&lt;code&gt;value&lt;/code&gt; is the old value - we know from our getter that this can be a &lt;code&gt;string&lt;/code&gt;, &lt;code&gt;number&lt;/code&gt; or &lt;code&gt;string[]&lt;/code&gt;.  So we can lose the &lt;code&gt;any&lt;/code&gt; in favour of overloads which specify different types for &lt;code&gt;value&lt;/code&gt; in each.&lt;/li&gt;&lt;li&gt;The return value of the function is the value that should be set.  We know from our other setters that the possible types allowed here are &lt;code&gt;string&lt;/code&gt; and &lt;code&gt;string[]&lt;/code&gt;.  (And yes I'm as puzzled as you are that the getter can return a &lt;code&gt;number&lt;/code&gt; but the setter can't set one.)  That being the case it makes sense for us to have overloads with functions that return both &lt;code&gt;string&lt;/code&gt; and &lt;code&gt;string[]&lt;/code&gt;&lt;/li&gt;&lt;/ol&gt; &lt;p&gt;So, we've got a little tidy up to do for #1 and extra overloads to add for #2 and #3.  We're going to replace the single &lt;code&gt;Function&lt;/code&gt; setter with 3 overloads to cater for #2.  Then for #3 we're going to take each of the 3 overloads we've just created and make 2 overloads place of each to handle the different return types.  This will lead us with the grand total of 6 overloads to model our &lt;code&gt;Function&lt;/code&gt; setter!&lt;/p&gt;   &lt;pre class="prettyprint ts" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;    /**&lt;br /&gt;     * Set the value of each element in the set of matched elements.&lt;br /&gt;     *&lt;br /&gt;     * @param func A function returning the value to set. this is the current element. Receives the index position of the element in the set and the old value as arguments.&lt;br /&gt;     */&lt;br /&gt;    val(func: (index: number, value: string) =&gt; string): JQuery;&lt;br /&gt;    /**&lt;br /&gt;     * Set the value of each element in the set of matched elements.&lt;br /&gt;     *&lt;br /&gt;     * @param func A function returning the value to set. this is the current element. Receives the index position of the element in the set and the old value as arguments.&lt;br /&gt;     */&lt;br /&gt;    val(func: (index: number, value: string[]) =&gt; string): JQuery;&lt;br /&gt;    /**&lt;br /&gt;     * Set the value of each element in the set of matched elements.&lt;br /&gt;     *&lt;br /&gt;     * @param func A function returning the value to set. this is the current element. Receives the index position of the element in the set and the old value as arguments.&lt;br /&gt;     */&lt;br /&gt;    val(func: (index: number, value: number) =&gt; string): JQuery;&lt;br /&gt;    /**&lt;br /&gt;     * Set the value of each element in the set of matched elements.&lt;br /&gt;     *&lt;br /&gt;     * @param func A function returning the value to set. this is the current element. Receives the index position of the element in the set and the old value as arguments.&lt;br /&gt;     */&lt;br /&gt;    val(func: (index: number, value: string) =&gt; string[]): JQuery;&lt;br /&gt;    /**&lt;br /&gt;     * Set the value of each element in the set of matched elements.&lt;br /&gt;     *&lt;br /&gt;     * @param func A function returning the value to set. this is the current element. Receives the index position of the element in the set and the old value as arguments.&lt;br /&gt;     */&lt;br /&gt;    val(func: (index: number, value: string[]) =&gt; string[]): JQuery;&lt;br /&gt;    /**&lt;br /&gt;     * Set the value of each element in the set of matched elements.&lt;br /&gt;     *&lt;br /&gt;     * @param func A function returning the value to set. this is the current element. Receives the index position of the element in the set and the old value as arguments.&lt;br /&gt;     */&lt;br /&gt;    val(func: (index: number, value: number) =&gt; string[]): JQuery;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;A cursory glance shows that each of the overloads above shares the same JSDoc.  Each has the &lt;em&gt;"Set the value..."&lt;/em&gt; from the API docs as the overarching Intellisense that is displayed for the &lt;code&gt;Function&lt;/code&gt; setter. And each has the same &lt;code&gt;@param func&lt;/code&gt; comment as well.&lt;/p&gt; &lt;a href="http://1.bp.blogspot.com/-9wwPOZIiwcs/U2D-Ngw9CrI/AAAAAAAAAk0/V32FCsotPTQ/s1600/Intellisense-Setter-Function.png" imageanchor="1" &gt;&lt;img border="0" src="http://1.bp.blogspot.com/-9wwPOZIiwcs/U2D-Ngw9CrI/AAAAAAAAAk0/V32FCsotPTQ/s640/Intellisense-Setter-Function.png" /&gt;&lt;/a&gt; &lt;h4&gt;It could be you...&lt;/h4&gt; &lt;p&gt;This post is much longer than I ever intended it to be.  But I wanted to show how easy it is to create typings with JSDoc to drive Intellisense.  For no obvious reason people generally don't make a great deal of use of JSDoc when creating typings.  Perhaps the creators have no good source of documentation (a common problem).   Or perhaps people are not even aware it's a possibility - they don't know about the TypeScript support of JSDoc.  In case it's the latter I think this post was worth writing.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5294321863550376612'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5294321863550376612'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2014/05/typescript-jsdoc-and-intellisense.html' title='TypeScript, JSDoc and Intellisense'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='http://2.bp.blogspot.com/-ljw2HiAp0qE/U2D915IIcaI/AAAAAAAAAkk/DVPv-TolEJw/s72-c/Intellisense-Setter-String.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3425307992830985552</id><published>2014-04-21T10:31:00.000+01:00</published><updated>2014-04-21T10:31:36.525+01:00</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>How I got started in Open Source</title><content type='html'>api documentation delphi lotus notes   can i do it  </content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3425307992830985552'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3425307992830985552'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-7720980564026370784</id><published>2014-04-01T14:53:00.003+01:00</published><updated>2021-03-04T17:36:26.744Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='callback functions'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='TypeScript'/><category scheme='http://www.blogger.com/atom/ns#' term='Lexical scoping'/><category scheme='http://www.blogger.com/atom/ns#' term='closure'/><category scheme='http://www.blogger.com/atom/ns#' term='Instance methods'/><title type='text'>TypeScript this is what I want! (the unfortunate neglect of Instance Methods / callback functions)</title><content type='html'>&lt;p&gt;I was recently reading &lt;a href="http://www.walkercoderanger.com/blog/2014/02/typescript-isnt-the-answer/"&gt;Jeff Walker's blog post "Why TypeScript Isn't the Answer"&lt;/a&gt;.  This is part of series in which Jeff goes through various compile-to-JavaScript technologies including TypeScript, CoffeeScript and Dart and explains his view of why he feels they don't quite hit the mark.&lt;/p&gt; &lt;p&gt;As a user (and big fan) of TypeScript I read the post with interest and picked up on one particular issue that Jeff mentions:&lt;/p&gt; &lt;blockquote cite="http://www.walkercoderanger.com/blog/2014/02/typescript-isnt-the-answer/"&gt; &lt;p&gt;Classes make the unchanged behaviour of the &lt;code&gt;this&lt;/code&gt; keyword more confusing. For example, in a class like &lt;code&gt;Greeter&lt;/code&gt; from the &lt;a href="http://www.typescriptlang.org/Playground"&gt;TypeScript playground&lt;/a&gt;, the use of &lt;code&gt;this&lt;/code&gt; is confusing:&lt;/p&gt; &lt;pre class="prettyprint ts"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;class Greeter {&lt;br /&gt; greeting: string;&lt;br /&gt; constructor(message: string) {&lt;br /&gt;  this.greeting = message;&lt;br /&gt; }&lt;br /&gt; greet() {&lt;br /&gt;  return "Hello, " + this.greeting;&lt;br /&gt; }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;One cant help but feel the &lt;code&gt;this&lt;/code&gt; keyword in the methods of &lt;code&gt;Greeter&lt;/code&gt; should always reference a &lt;code&gt;Greeter&lt;/code&gt; instance. However, the semantics of this are unchanged from JavaScript:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;var greeter = new Greeter("world");&lt;br /&gt;var unbound = greeter.greet;&lt;br /&gt;alert(unbound());&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;The above code displays Hello, undefined instead of the naively expected Hello, world.&lt;/p&gt; &lt;/blockquote&gt; &lt;p&gt;Now Jeff is quite correct in everything he says above.  However, he's also missing a trick. Or rather, he's missing out on a very useful feature of TypeScript.&lt;/p&gt; &lt;h4&gt;Instance Methods to the Rescue!&lt;/h4&gt; &lt;p&gt;Still in the early days of TypeScript, the issue Jeff raises had already been identified.  (And for what it's worth, this issue wasn't there by mistake - remember TypeScript is quite deliberately a "superset of JavaScript".)  Happily with the &lt;a href="http://blogs.msdn.com/b/typescript/archive/2013/08/06/announcing-0-9-1.aspx"&gt;release of TypeScript 0.9.1&lt;/a&gt; a nice remedy was included in the language in the form of "Instance Methods".&lt;/p&gt; &lt;p&gt;Instance Methods are lexically scoped; bound to a specific instance of a JavaScript object. i.e. These methods are *&lt;strong&gt;not&lt;/strong&gt;* vulnerable to the Hello, undefined issue Jeff raises.  To quote the blog post:&lt;/p&gt; &lt;blockquote cite="http://blogs.msdn.com/b/typescript/archive/2013/08/06/announcing-0-9-1.aspx"&gt; &lt;p&gt;We've relaxed the restrictions on field initializers to now allow &lt;code&gt;'this'&lt;/code&gt;.  This means that classes can now contain both methods on the prototype, and &lt;strong&gt;callback functions on the instance&lt;/strong&gt;.  The latter are particularly useful when you want to use a member on the class as a callback function, as in the code above. This lets you mix-n-match between closure style and prototype style class member patterns easily.&lt;/p&gt; &lt;/blockquote&gt; &lt;h4&gt;&lt;code&gt;Greeter&lt;/code&gt; with Instance Methods&lt;/h4&gt; &lt;p&gt;So, if we take the &lt;code&gt;Greeter&lt;/code&gt; example, how do we apply Instance Methods to it?  Well, like this:&lt;/p&gt; &lt;pre class="prettyprint ts"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;class Greeter {&lt;br /&gt; greeting: string;&lt;br /&gt; constructor(message: string) {&lt;br /&gt;  this.greeting = message;&lt;br /&gt; }&lt;br /&gt; greet = () =&gt; {&lt;br /&gt;  return "Hello, " + this.greeting;&lt;br /&gt; }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Can you tell the difference? It's subtle.  That's right; the mere swapping out of &lt;code&gt;()&lt;/code&gt; with &lt;code&gt;= () =&gt;&lt;/code&gt; on the &lt;code&gt;greet&lt;/code&gt; method takes us from a &lt;code&gt;prototype&lt;/code&gt; method to an Instance Method.&lt;/p&gt; &lt;p&gt;Observant readers will have noticed that we are using TypeScript / &lt;a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/arrow_functions"&gt;ES6's Arrow Function syntax&lt;/a&gt;. In fact with that in mind I could actually have gone super-terse if I was so inclined:&lt;/p&gt; &lt;pre class="prettyprint ts"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;class Greeter {&lt;br /&gt; greeting: string;&lt;br /&gt; constructor(message: string) {&lt;br /&gt;  this.greeting = message;&lt;br /&gt; }&lt;br /&gt; greet = () =&gt; "Hello, " + this.greeting&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;But either way, both of the above class declarations compile down to the following JavaScript:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;var Greeter = (function () {&lt;br /&gt;    function Greeter(message) {&lt;br /&gt;        var _this = this;&lt;br /&gt;        this.greet = function () {&lt;br /&gt;            return "Hello, " + _this.greeting;&lt;br /&gt;        };&lt;br /&gt;        this.greeting = message;&lt;br /&gt;    }&lt;br /&gt;    return Greeter;&lt;br /&gt;})();&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Which differs from the pre-Instance Methods generated JavaScript:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;var Greeter = (function () {&lt;br /&gt;    function Greeter(message) {&lt;br /&gt;        this.greeting = message;&lt;br /&gt;    }&lt;br /&gt;    Greeter.prototype.greet = function () {&lt;br /&gt;        return "Hello, " + this.greeting;&lt;br /&gt;    };&lt;br /&gt;    return Greeter;&lt;br /&gt;})();&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;As you can see the Instance Methods approach does *&lt;strong&gt;not&lt;/strong&gt;* make use of the &lt;code&gt;prototype&lt;/code&gt; on &lt;code&gt;Greeter&lt;/code&gt; to add the method.  (As the pre-Instance Methods &lt;code&gt;greet()&lt;/code&gt; declaration did.)  Instead it creates a function directly on the created object  and internally uses the &lt;code&gt;_this&lt;/code&gt; variable inside the Instance Methods.  (&lt;code&gt;_this&lt;/code&gt; being a previously captured instance of &lt;code&gt;this&lt;/code&gt;.)&lt;/p&gt; &lt;p&gt;So with Instance Methods we can repeat Jeff's experiment from earlier:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;var greeter = new Greeter("world");&lt;br /&gt;var bound = greeter.greet;&lt;br /&gt;alert(bound());&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;But this time round the code displays Hello, world and no longer Hello, undefined.&lt;/p&gt; &lt;h4&gt;Update 02/04/2014 - mixing and matching &lt;code&gt;prototype&lt;/code&gt; and Instance Methods&lt;/h4&gt; &lt;p&gt;&lt;a href="https://twitter.com/bgever"&gt;Bart Verkoeijen&lt;/a&gt; made an excellent comment concerning the extra memory that Instance Methods require as opposed to &lt;code&gt;prototype&lt;/code&gt; methods.  Not everyone reads the comments and so I thought I'd add a little suffix to my post.&lt;/p&gt; &lt;p&gt;What Ive come to realise is that it comes down to problem that youre trying to solve.  Instance methods are bulletproof in terms of relying on a specific instance of &lt;code&gt;this&lt;/code&gt; regardless of how a method is invoked.  But for many of my use cases thats overkill.  Lets take the original (&lt;code&gt;prototype&lt;/code&gt; methods) &lt;code&gt;Greeter&lt;/code&gt; example:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;var Greeter = (function () {&lt;br /&gt;    function Greeter(message) {&lt;br /&gt;        this.greeting = message;&lt;br /&gt;    }&lt;br /&gt;    Greeter.prototype.greet = function () {&lt;br /&gt;        return "Hello, " + this.greeting;&lt;br /&gt;    };&lt;br /&gt;    return Greeter;&lt;br /&gt;})();&lt;br /&gt;&lt;br /&gt;var greeter = new Greeter("world");&lt;br /&gt;var greeter2 = new Greeter("universe");&lt;br /&gt;&lt;br /&gt;console.log(greeter.greet()); // Logs "Hello, world"&lt;br /&gt;console.log(greeter2.greet()); // Logs "Hello, universe"&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;As you can see above, provided I invoke my &lt;code&gt;greet&lt;/code&gt; method in the context of my created object then I can rely on &lt;code&gt;this&lt;/code&gt; being what I would hope.&lt;/p&gt; &lt;p&gt;That being the case my general practice has not been to use exclusively Instance methods *&lt;strong&gt;or&lt;/strong&gt;* &lt;code&gt;prototype&lt;/code&gt; methods.  What I tend to do is start out only with &lt;code&gt;prototype&lt;/code&gt; methods on my classes and switch them over to be an Instance method if there is an actual need to ensure context.  So my TypeScript classes tend to be a combination of &lt;code&gt;prototype&lt;/code&gt; methods and Instance methods.&lt;/p&gt; &lt;p&gt;More often than not the &lt;code&gt;prototype&lt;/code&gt; methods are just fine.  It tends to be where an object is interacting with some kind of presentation framework (Knockout / Angular etc) or being invoked as part of a callback (eg AJAX scenarios) where I need Instance methods.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7720980564026370784'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7720980564026370784'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2014/04/typescript-instance-methods.html' title='TypeScript this is what I want! (the unfortunate neglect of Instance Methods / callback functions)'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6792405361155477769</id><published>2014-03-17T16:41:00.001Z</published><updated>2021-03-14T05:20:49.583Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='Jasmine'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='TFS'/><category scheme='http://www.blogger.com/atom/ns#' term='unit testing'/><category scheme='http://www.blogger.com/atom/ns#' term='javascript'/><category scheme='http://www.blogger.com/atom/ns#' term='Continuous Integration'/><title type='text'>The Surprisingly Happy Tale of Visual Studio Online, Continous Integration and Chutzpah</title><content type='html'>&lt;h4&gt;Going off piste&lt;/h4&gt; &lt;p&gt;The post that follows is a slightly rambly affair which is pretty much my journal of the first steps of getting up and running with JavaScript unit testing.  I will not claim that much of this blog is down to me.  In fact in large part is me working my way through &lt;a href="http://blogs.msdn.com/b/visualstudioalm/archive/2012/07/09/javascript-unit-tests-on-team-foundation-service-with-chutzpah.aspx"&gt;Mathew Aniyan's excellent blog post on integrating Chutzpah with TFS&lt;/a&gt;.  But a few deviations from this post have made me think it worth keeping hold of this record for my benefit (if no-one else's).&lt;/p&gt; &lt;p&gt;That's the disclaimers out of the way now...&lt;/p&gt; &lt;h4&gt;...Try, try, try again...&lt;/h4&gt; &lt;p&gt;Getting started with JavaScript unit testing has not been the breeze Id expected.  Frankly Ive found the docs out there not particularly helpful.  But if at first you don't succeed then try, try, try again.&lt;/p&gt; &lt;p&gt;So after a number of failed attempts Im going to give it another go.  &lt;a href="http://www.hanselminutes.com/412/getting-started-with-javascript-unit-testing-with-jasmine-and-rushaine-mcbean"&gt;Rushaine McBean&lt;/a&gt; says Jasmine is easiest so I'm going to follow her lead and give it a go.&lt;/p&gt; &lt;p&gt;Lets new up a new (empty) ASP.NET project.  Yes, I know ASP.NET has nothing to do with JavaScript unit testing but my end goal is to be able to run JS unit tests in Visual Studio and as part of Continuous Integration.  Further to that, I'm anticipating a future where I have a solution that contains JavaScript unit tests and C# unit tests as well.  It is indeed a bold and visionary Brave New World.  We'll see how far we get.&lt;/p&gt; &lt;p&gt;First up, download Jasmine from &lt;a href="http://jasmine.github.io/"&gt;GitHub&lt;/a&gt; - I'll use &lt;a href="https://github.com/pivotal/jasmine/blob/master/dist/jasmine-standalone-2.0.0.zip"&gt;v2.0&lt;/a&gt;.  Unzip it and fire up SpecRunner.html and whaddya know... It works!&lt;/p&gt; &lt;a href="http://4.bp.blogspot.com/-M-Qct1e8Ofo/UxiT5wHICLI/AAAAAAAAAiY/tHUQemETCGI/s1600/LookItWorksRightOutTheBox.png" imageanchor="1" &gt;&lt;img border="0" src="http://4.bp.blogspot.com/-M-Qct1e8Ofo/UxiT5wHICLI/AAAAAAAAAiY/tHUQemETCGI/s320/LookItWorksRightOutTheBox.png" /&gt;&lt;/a&gt; &lt;p&gt;As well it might.  Id be worried if it didnt.  So Ill move the contents of the release package into my empty project.  Now lets see if we can get those tests running inside Visual Studio.  Id heard of &lt;a href="https://chutzpah.codeplex.com/"&gt;Chutzpah&lt;/a&gt; which describes itself thusly:&lt;/p&gt; &lt;blockquote cite="https://chutzpah.codeplex.com/"&gt;&lt;em&gt;Chutzpah is an open source JavaScript test runner which enables you to run unit tests using QUnit, Jasmine, Mocha, CoffeeScript and TypeScript. &lt;/em&gt;&lt;/blockquote&gt; &lt;p&gt;What Im after is the Chutzpah test adapter for Visual Studio 2012/2013 which can be found &lt;a href="http://visualstudiogallery.msdn.microsoft.com/f8741f04-bae4-4900-81c7-7c9bfb9ed1fe"&gt;here&lt;/a&gt;.  I download the VSIX and install.  Pretty painless.  Once I restart Visual Studio I can see my unit tests in the test explorer.  Nice!  Run them and...&lt;/p&gt; &lt;a href="http://2.bp.blogspot.com/-Ns9-ZoCzyxU/UxiVe83GQAI/AAAAAAAAAik/9rJiv7c3gOA/s1600/EverythingFails.png" imageanchor="1" &gt;&lt;img border="0" src="http://2.bp.blogspot.com/-Ns9-ZoCzyxU/UxiVe83GQAI/AAAAAAAAAik/9rJiv7c3gOA/s320/EverythingFails.png" /&gt;&lt;/a&gt; &lt;p&gt;All fail.  This makes me sad.  All the errors say Cant find variable: Player in file.  Hmmm.  Why?  Dammit Im actually going to have to read the &lt;a href="https://chutzpah.codeplex.com/wikipage?title=Chutzpah%20File%20References&amp;referringTitle=Documentation"&gt;documentation&lt;/a&gt;...  It turns out the issue can be happily resolved by adding these 3 references to the top of PlayerSpec.js:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;/// &amp;lt;reference path="../src/Player.js" /&amp;gt;&lt;br /&gt;/// &amp;lt;reference path="../src/Song.js" /&amp;gt;&lt;br /&gt;/// &amp;lt;reference path="SpecHelper.js" /&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt; &lt;p&gt;Now the tests pass:&lt;/p&gt; &lt;a href="http://1.bp.blogspot.com/-n020yJN-tpA/UxiWLRegm5I/AAAAAAAAAis/TJHqYn08MZ4/s1600/EverythingPasses.png" imageanchor="1" &gt;&lt;img border="0" src="http://1.bp.blogspot.com/-n020yJN-tpA/UxiWLRegm5I/AAAAAAAAAis/TJHqYn08MZ4/s320/EverythingPasses.png" /&gt;&lt;/a&gt; &lt;p&gt;The question is: can we get this working with Visual Studio Online?&lt;/p&gt; &lt;p&gt;Fortunately another has gone before me.  Mathew Aniyan has written a &lt;a href="http://blogs.msdn.com/b/visualstudioalm/archive/2012/07/09/javascript-unit-tests-on-team-foundation-service-with-chutzpah.aspx"&gt;superb blog post called "Javascript Unit Tests on Team Foundation Service with Chutzpah"&lt;/a&gt;.  Using this post as a guide (it was written 18 months ago which is frankly aeons in the world of the web) I'm hoping that I'll be able to, without too many tweaks, get Javascript unit tests running on Team Foundation Service / Visual Studio Online ( / insert this weeks rebranding here).&lt;/p&gt; &lt;p&gt;First of all in Visual Studio Online Ill create a new project called "GettingStartedWithJavaScriptUnitTesting" (using all the default options).  Apparently &lt;em&gt;Your project is created and your team is going to absolutely love this.&lt;/em&gt;  Hmmmm... I think Ill be judge of that.  &lt;/p&gt; &lt;p&gt;Let's navigate to the project.  I'll fire up Visual Studio by clicking on the Open in Visual Studio link.  Once fired up and all the workspace mapping is sorted Ill move my project into the GettingStartedWithJavaScriptUnitTesting folder that now exists on my machine and add this to source control.&lt;/p&gt; &lt;p&gt;Back to Mathew's  blog.  It suggests renaming Chutzpah.VS2012.vsix to Chutzpah.VS2012.zip and checking certain files into TFS.  I think Chutzpah has changed a certain amount since this was written.  To be on the safe side Ill create a new folder in the root of my project called Chutzpah.VS2012 and put the contents of Chutzpah.VS2012.zip in there and add it to TFS (being careful to ensure that no dlls are excluded).&lt;/p&gt; &lt;p&gt;Then I'll follow steps 3 and 4 from the blog post:&lt;/p&gt; &lt;blockquote cite="http://blogs.msdn.com/b/visualstudioalm/archive/2012/07/09/javascript-unit-tests-on-team-foundation-service-with-chutzpah.aspx"&gt;&lt;em&gt;&lt;p&gt;3. In Visual Studio, Open Team Explorer &amp; connect to Team Foundation Service.&lt;br /&gt;    Bring up the Manage Build Controllers dialog. [Build &gt; Manage Build Controllers]&lt;br /&gt;    Select Hosted Build Controller&lt;br /&gt;    Click on Properties button to bring up the Build Controller Properties dialog.&lt;/p&gt;&lt;p&gt;4. Change Version Control Path to custom Assemblies to refer to the folder where you checked in the binaries in step 2.&lt;/p&gt;&lt;/em&gt;&lt;/blockquote&gt; &lt;p&gt;In step 5 the blog tells me to edit my build definition.  Well I dont have one in this new project so lets click on New Build Definition, create one and then follow step 5:&lt;/p&gt; &lt;blockquote cite="http://blogs.msdn.com/b/visualstudioalm/archive/2012/07/09/javascript-unit-tests-on-team-foundation-service-with-chutzpah.aspx"&gt;&lt;em&gt;&lt;p&gt;5. In Team Explorer, go to the Builds section and Edit your Build Definition which will run the javascript tests.&lt;br /&gt;       Click on the Process tab&lt;br /&gt;       Select the row named Automated Tests.&lt;br /&gt;        Click on  button next to the value.&lt;/p&gt;&lt;/em&gt;&lt;/blockquote&gt; &lt;p&gt;Rather than following step 6 (which essentially nukes the running of any .NET tests you might have) I chose to add another row by clicking "Add".  In the dialog presented I changed the Test assembly specification to **\*.js and checked the "Fail build on test failure" checkbox.&lt;/p&gt; &lt;a href="http://3.bp.blogspot.com/-4lbMIsT9jFQ/Ux3ATwBrPgI/AAAAAAAAAjY/4XSY0u0RpOE/s1600/AutomatedTests.png" imageanchor="1" &gt;&lt;img border="0" src="http://3.bp.blogspot.com/-4lbMIsT9jFQ/Ux3ATwBrPgI/AAAAAAAAAjY/4XSY0u0RpOE/s320/AutomatedTests.png" /&gt;&lt;/a&gt; &lt;p&gt;Step 7 says:&lt;/p&gt; &lt;blockquote cite="http://blogs.msdn.com/b/visualstudioalm/archive/2012/07/09/javascript-unit-tests-on-team-foundation-service-with-chutzpah.aspx"&gt;&lt;em&gt;&lt;p&gt;7. Create your Web application in Visual Studio and add your Qunit or Jasmine unit tests to them. &lt;u&gt;Make sure that the js files (that contain the tests) are getting copied to the build output directory.&lt;/u&gt;&lt;/p&gt;&lt;/em&gt;&lt;/blockquote&gt; &lt;p&gt;The picture below step 7 suggests that you should be setting your test / spec files to have a &lt;code&gt;Copy to Output Directory&lt;/code&gt; setting of &lt;code&gt;Copy always&lt;/code&gt;.  &lt;strong&gt;This did not work for me!!!&lt;/strong&gt;  Instead, setting a &lt;code&gt;Build Action&lt;/code&gt; of &lt;code&gt;Content&lt;/code&gt; and a &lt;code&gt;Copy to Output Directory&lt;/code&gt; setting of &lt;code&gt;Do not copy&lt;/code&gt; did work.&lt;/p&gt; &lt;p&gt;Finally I checked everything into source control and queued a build.  I honestly did not expect this to work.  It couldnt be this easy could it? And...&lt;/p&gt; &lt;a href="http://2.bp.blogspot.com/-gEDIyMV7M_g/Uxibt99tuwI/AAAAAAAAAi8/G4I6XQp0aN0/s1600/ItOnlyBlimminWellWorked.png" imageanchor="1" &gt;&lt;img border="0" src="http://2.bp.blogspot.com/-gEDIyMV7M_g/Uxibt99tuwI/AAAAAAAAAi8/G4I6XQp0aN0/s320/ItOnlyBlimminWellWorked.png" /&gt;&lt;/a&gt; &lt;p&gt;Wow!  It did!  Heres me cynically expecting some kind of permission denied error and it actually works!  Brilliant!  Look up in the cloud it says the same thing!&lt;/p&gt; &lt;a href="http://2.bp.blogspot.com/-A67cTSkzIDg/Uxib6wVnaWI/AAAAAAAAAjE/ZwbUdBJmi0w/s1600/InTheCloudToo.png" imageanchor="1" &gt;&lt;img border="0" src="http://2.bp.blogspot.com/-A67cTSkzIDg/Uxib6wVnaWI/AAAAAAAAAjE/ZwbUdBJmi0w/s320/InTheCloudToo.png" /&gt;&lt;/a&gt; &lt;p&gt;Fantastic!&lt;/p&gt; &lt;p&gt;I realise that I havent yet written a single JavaScript unit test of my own and so Ive still a way to go.  What I have done is quietened those voices in my head that said theres not too much point having a unit test suite that isnt plugged into continuous integration.  Although it's not documented here I'm happy to be able to report that I have been able to follow the self-same instructions for Team Foundation Service / Visual Studio Online and get CI working with TFS 2012 on our build server as well.&lt;/p&gt; &lt;p&gt;Having got up and running off the back of other peoples hard work I best try and write some of my own tests now....&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/6792405361155477769'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/6792405361155477769'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2014/03/the-surprisingly-happy-tale-of-visual.html' title='The Surprisingly Happy Tale of Visual Studio Online, Continous Integration and Chutzpah'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='http://4.bp.blogspot.com/-M-Qct1e8Ofo/UxiT5wHICLI/AAAAAAAAAiY/tHUQemETCGI/s72-c/LookItWorksRightOutTheBox.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-7905789326516632294</id><published>2014-03-11T15:47:00.001Z</published><updated>2021-03-04T18:34:09.265Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Globalize'/><category scheme='http://www.blogger.com/atom/ns#' term='Knockout'/><category scheme='http://www.blogger.com/atom/ns#' term='bindingHandler'/><title type='text'>Knockout + Globalize = valueNumber Binding Handler</title><content type='html'>&lt;p&gt;Ive long used &lt;a href="https://github.com/jquery/globalize/"&gt;Globalize&lt;/a&gt; for my JavaScript number formatting / parsing needs.  In a current project Im using Knockout for the UI.  When it came to data-binding numeric values none of the default binding handlers seemed appropriate.  What I wanted was a binding handler that:&lt;/p&gt; &lt;ol&gt;&lt;li&gt;Was specifically purposed for dealing with numeric values&lt;/li&gt;&lt;li&gt;Handled the parsing / formatting for the current locale (and I naturally intended to use Globalize for this purpose)&lt;/li&gt;&lt;/ol&gt; &lt;p&gt;Like so much development we start by standing on the shoulders of giants.  In this case its the fantastic &lt;a href="https://twitter.com/RPNiemeyer"&gt;Ryan Niemeyer&lt;/a&gt; who put up a &lt;a href="http://stackoverflow.com/a/12647270/761388"&gt;post on StackOverflow&lt;/a&gt; that got me on the right track.&lt;/p&gt; &lt;p&gt;Essentially his approach provides an interceptor mechanism that allows you to validate numeric data entry on input and format numeric data going out as well.  Very nice.  Into this I plugged Globalize to handle the parsing and formatting.  I ended up with the valueNumber binding handler:&lt;/p&gt; &lt;pre class="prettyprint js" style="font-size: 0.9em"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;ko.bindingHandlers.valueNumber = {&lt;br /&gt;    init: function (element, valueAccessor, allBindingsAccessor, viewModel, bindingContext) {&lt;br /&gt; &lt;br /&gt;        /**&lt;br /&gt;         * Adapted from the KO hasfocus handleElementFocusChange function&lt;br /&gt;         */ &lt;br /&gt;        function elementIsFocused() {&lt;br /&gt;            var isFocused = false,&lt;br /&gt;                ownerDoc = element.ownerDocument;&lt;br /&gt;            if ("activeElement" in ownerDoc) {&lt;br /&gt;                var active;&lt;br /&gt;                try {&lt;br /&gt;                    active = ownerDoc.activeElement;&lt;br /&gt;                } catch(e) {&lt;br /&gt;                    // IE9 throws if you access activeElement during page load&lt;br /&gt;                    active = ownerDoc.body;&lt;br /&gt;                }&lt;br /&gt;                isFocused = (active === element);&lt;br /&gt;            }&lt;br /&gt; &lt;br /&gt;            return isFocused;&lt;br /&gt;        }&lt;br /&gt; &lt;br /&gt;        /**&lt;br /&gt;         * Adapted from the KO hasfocus handleElementFocusChange function&lt;br /&gt;         *&lt;br /&gt;         * @param {boolean} isFocused whether the current element has focus&lt;br /&gt;         */&lt;br /&gt;        function handleElementFocusChange(isFocused) {&lt;br /&gt;            elementHasFocus(isFocused);&lt;br /&gt;        }&lt;br /&gt; &lt;br /&gt;        var observable = valueAccessor(),&lt;br /&gt;            properties = allBindingsAccessor(),&lt;br /&gt;            elementHasFocus = ko.observable(elementIsFocused()),&lt;br /&gt;            handleElementFocusIn = handleElementFocusChange.bind(null, true),&lt;br /&gt;            handleElementFocusOut = handleElementFocusChange.bind(null, false);&lt;br /&gt; &lt;br /&gt;        var interceptor = ko.computed({&lt;br /&gt;            read: function () {&lt;br /&gt;                var currentValue = ko.utils.unwrapObservable(observable);&lt;br /&gt;                if (elementHasFocus()) {&lt;br /&gt;                    return (!isNaN(currentValue) &amp;&amp; (currentValue !== null) &amp;&amp; (currentValue !== undefined))&lt;br /&gt;                        ? currentValue.toString().replace(".", Globalize.findClosestCulture().numberFormat["."]) // Displays correct decimal separator for the current culture (so de-DE would format 1.234 as "1,234")&lt;br /&gt;                        : null;&lt;br /&gt;                } else {&lt;br /&gt;                    var format = properties.numberFormat || "n2",&lt;br /&gt;                        formattedNumber = Globalize.format(currentValue, format);&lt;br /&gt; &lt;br /&gt;                    return formattedNumber;&lt;br /&gt;                }&lt;br /&gt;            },&lt;br /&gt;            write: function (newValue) {&lt;br /&gt;                var currentValue = ko.utils.unwrapObservable(observable),&lt;br /&gt;                    numberValue = Globalize.parseFloat(newValue);&lt;br /&gt;                &lt;br /&gt;                if (!isNaN(numberValue)) {&lt;br /&gt;                    &lt;br /&gt;                    if (numberValue !== currentValue) {&lt;br /&gt;                        // The value has changed so update the observable&lt;br /&gt;                        observable(numberValue);&lt;br /&gt;                    }&lt;br /&gt;                } else if (newValue.length === 0) {&lt;br /&gt;                    if (properties.isNullable) {&lt;br /&gt;                        // If newValue is a blank string and the isNullable property has been set then nullify the observable&lt;br /&gt;                        observable(null);&lt;br /&gt;                    } else {&lt;br /&gt;                        // If newValue is a blank string and the isNullable property has not been set then set the observable to 0&lt;br /&gt;                        observable(0);&lt;br /&gt;                    }&lt;br /&gt;                }&lt;br /&gt;            }&lt;br /&gt;        });&lt;br /&gt;        &lt;br /&gt;        ko.utils.registerEventHandler(element, "focus", handleElementFocusIn);&lt;br /&gt;        ko.utils.registerEventHandler(element, "focusin", handleElementFocusIn); // For IE&lt;br /&gt;        ko.utils.registerEventHandler(element, "blur", handleElementFocusOut);&lt;br /&gt;        ko.utils.registerEventHandler(element, "focusout", handleElementFocusOut); // For IE&lt;br /&gt; &lt;br /&gt;        if (element.tagName.toLowerCase() === 'input') {&lt;br /&gt;            ko.applyBindingsToNode(element, { value: interceptor });&lt;br /&gt;        } else {&lt;br /&gt;            ko.applyBindingsToNode(element, { text: interceptor });&lt;br /&gt;        }&lt;br /&gt;    }&lt;br /&gt;};&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt;  &lt;p&gt;Using this binding handler you just need to drop in a &lt;code&gt;valueNumber&lt;/code&gt; into your &lt;code&gt;data-bind&lt;/code&gt; statement where you might previously have used a &lt;code&gt;value&lt;/code&gt; binding. The binding also has a couple of nice hooks in place which you might find useful:&lt;/p&gt; &lt;dl&gt;  &lt;dt&gt;numberFormat (defaults to "n2")&lt;/dt&gt;  &lt;dd&gt;allows you to specify a format to display your number with.  Eg, "c2" would display your number as a currency to 2 decimal places, "p1" would display your number as a percentage to 1 decimal place etc&lt;/dd&gt;  &lt;dt&gt;isNullable (defaults to false)&lt;/dt&gt;  &lt;dd&gt;specifies whether your number should be treated as nullable.  If it's not then clearing the elements value will set the underlying observable to 0.&lt;/dd&gt;&lt;/dl&gt; &lt;p&gt;Finally when the element gains focus / becomes active the full underlying value is displayed.  (Kind of like Excel - like many an app, the one I'm working on started life as Excel and the users want to keep some of the nice aspects of Excel's UI.) To take a scenario, let's imagine we have an input element which is applying the "n1" format.  The underlying value backing this is 1.234.  The valueNumber binding displays this as "1.2" when the input does not have focus and when the element gains focus the full "1.234" is displayed.  Credit where its due, this is thanks to &lt;a href="http://stackoverflow.com/users/1105996/robert-westerlund"&gt;Robert Westerlund&lt;/a&gt; who was kind enough to respond to a &lt;a href="http://stackoverflow.com/a/22313546/761388"&gt;question of mine on StackOverflow&lt;/a&gt;.&lt;/p&gt; &lt;p&gt;Finally, heres a demo using the "de-DE" locale:&lt;/p&gt; &lt;iframe width="100%" height="400" src="http://jsfiddle.net/johnny_reilly/jRt3k/embedded/result,js,html" allowfullscreen="allowfullscreen" frameborder="0"&gt;&lt;/iframe&gt; &lt;h4&gt;PS Globalize is a-changing&lt;/h4&gt; &lt;p&gt;The version of Globalize used in the binding handler is Globalize v0.1.1.  This has been available in various forms for quite some time but as I write this the Globalize plugin is in the process of being ported to the &lt;a href="http://cldr.unicode.org/"&gt;CLDR&lt;/a&gt;. As part of that work it looks like the Globalize API will change.  When that gets finalized Ill try and come back and update this.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7905789326516632294'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7905789326516632294'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2014/03/knockout-globalize-valuenumber-binding.html' title='Knockout + Globalize = valueNumber Binding Handler'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4241616656191588777</id><published>2014-03-05T13:28:00.002Z</published><updated>2021-03-04T18:33:14.360Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='asp.net'/><category scheme='http://www.blogger.com/atom/ns#' term='RequireJS'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='cache'/><category scheme='http://www.blogger.com/atom/ns#' term='caching'/><title type='text'>Caching and cache-busting with RequireJS</title><content type='html'>&lt;p&gt;Having put together a demo of using TypeScript with RequireJS my attention turned quickly to caching. Or rather, IE forced me to think about caching.&lt;/p&gt; &lt;p&gt;Everyone has their own workflow, their own tools.  The things they like to use as they put things together.  And for me Im a Visual Studio man  its not everyones bag but I really like it.  I find the JavaScript tooling is now really solid combined with IE and it (generally) makes me more productive.  I want to use it.  But, as you know, nothing is perfect...&lt;/p&gt; &lt;p&gt;So there I was, delighted with the TypeScript / RequireJS demo.  It was working just lovely.  I started investigating the debugging story.   What would happen if I change a script file on the fly?  When I refresh IE does it pick up the tweaks?&lt;/p&gt; &lt;p&gt;Lets find out.  I'll open up alerter.ts and change this:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;var name = "John";&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;to this:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;var name = "Bobby";&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;And *&lt;strong&gt;boom&lt;/strong&gt;*!  Nothing.  Ive refreshed IE and Im expecting to see Welcome to Code Camp, Bobby.  But Im still reading Welcome to Code Camp, John...  I bet Chrome wouldnt do this to me... And Im right!  It doesnt.  I dont want to get too much  into the details of this but it looks like it comes down to Chrome sending an "If-Modified-Since" request header where IE does not.  Im pretty sure that IE could be configured to behave likewise but Id rather not have to remember that.  (And furthermore I dont want to have to remind every person that works on the app to do that as well.)&lt;/p&gt; &lt;p&gt;This raises a number of issues but essentially it gets me to think about the sort of caching I want.  Like most of you I have 2 significant use cases:&lt;/p&gt; &lt;ol&gt;&lt;li&gt;Development&lt;/li&gt;&lt;li&gt;Production&lt;/li&gt;&lt;/ol&gt; &lt;p&gt;For Development I want any changes to JavaScript files to be picked up  I do *&lt;strong&gt;not&lt;/strong&gt;* want caching.  For Production I want caching in order that users have better performance / faster loading.  If I ship a new version of the app to Production I also want users to pick up the new versions of a file and cache those.&lt;/p&gt; &lt;h4&gt;Research&lt;/h4&gt; &lt;p&gt;I did a little digging.  The most useful information I found was &lt;a href="http://stackoverflow.com/q/8315088/761388"&gt;a StackOverflow post on RequireJS and caching&lt;/a&gt;.  Actually Id recommend anyone reading this to head over and read that from top to bottom. Read the question and all of the answers as well  pretty much everything will add to your understanding of RequireJS.&lt;/p&gt; &lt;p&gt;As with any set of answers there are different and conflicting views.  &lt;a href="http://stackoverflow.com/a/8479953/761388"&gt;Phil McCulls (accepted) answer&lt;/a&gt; was for my money the most useful. It pointed &lt;a href="http://requirejs.org/docs/api.html#config-urlArgs"&gt;back to the RequireJS documentation&lt;/a&gt;.&lt;/p&gt; &lt;blockquote cite="http://requirejs.org/docs/api.html#config-urlArgs"&gt;&lt;em&gt;&lt;p&gt;"urlArgs: Extra query string arguments appended to URLs that RequireJS uses to fetch resources. Most useful to cache bust when the browser or server is not configured correctly. Example cache bust setting for urlArgs:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;urlArgs: "bust=" +  (new Date()).getTime()&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;During development it can be useful to use this, however be sure to remove it before deploying your code."&lt;/p&gt;&lt;/em&gt;&lt;/blockquote&gt; &lt;p&gt;Phils answer suggests using urlArgs *&lt;strong&gt;both&lt;/strong&gt;* for Production and for Development in 2 different ways.  Using what amounts to a random number in the Development environment (as in the official docs) for cache-busting.  For the Production environment he suggests using a specific version number which allows for client-side caching between different build versions.&lt;/p&gt; &lt;p&gt;Full disclosure, this is not the approach favoured by James Burke (author of RequireJS).  He doesnt go into why in the RequireJS docs but has &lt;a href="https://groups.google.com/forum/#!msg/requirejs/3E9dP_BSQoY/36ut2Gtko7cJ"&gt;elsewhere expounded on this&lt;/a&gt;:&lt;/p&gt; &lt;blockquote cite="https://groups.google.com/forum/#!msg/requirejs/3E9dP_BSQoY/36ut2Gtko7cJ"&gt;&lt;em&gt;For deployed assets, I prefer to put the version or hash for the whole  build as a build directory, then just modify the baseUrl config used  for the project to use that versioned directory as the baseUrl. Then  no other files change, and it helps avoid some proxy issues where they  may not cache an URL with a query string on it. &lt;/em&gt;&lt;/blockquote&gt; &lt;p&gt;Im not so worried about the proxy caching issue.   My users tend to be people who use the application repeatedly and so the caching I most care about is their local machine caching.  From what I understand urlArgs will work fine in this scenario.  Yes the downside of this approach is that some proxy servers may not cache these assets.  Thats a shame but its not a dealbreaker for me.  As I said, I still have client side caching.&lt;/p&gt; &lt;p&gt;If you want to go a little deeper I recommend reading &lt;a href="http://www.stevesouders.com/blog/2008/08/23/revving-filenames-dont-use-querystring/"&gt;Steve Souders post&lt;/a&gt; on the topic (in case youre not aware  Steve is Googles Mr Performance).  Interestingly, looking at the comments on the post it sounds like the lack of support for proxy caching with querystrings may that may be starting to change.&lt;/p&gt; &lt;p&gt;But either way, Im happy with this approach.  As I always say, if its good enough for Stack Overflow then its good enough for me:&lt;/p&gt; &lt;a href="http://4.bp.blogspot.com/-pG0ahnzaPJM/UxcP7f6ENII/AAAAAAAAAhY/VVahRmEe5_0/s1600/IfItsGoodEnoughForStackOverflow.png" imageanchor="1" &gt;&lt;img border="0" src="http://4.bp.blogspot.com/-pG0ahnzaPJM/UxcP7f6ENII/AAAAAAAAAhY/VVahRmEe5_0/s320/IfItsGoodEnoughForStackOverflow.png" /&gt;&lt;/a&gt; &lt;h4&gt;Implementation&lt;/h4&gt; &lt;p&gt;Im going to start off using the demo from &lt;a href="http://icanmakethiswork.blogspot.com/2014/02/typescript-and-requirejs-keep-it-simple.html"&gt;my last blog post&lt;/a&gt; as a basis.  Lets take that and evolve it.  As a result my solution is going to work with TypeScript and RequireJS (since the previous demo was about that) but the implementation Im going to come up with would work as well with vanilla JS as it would with TypeScript compiled JS.&lt;/p&gt; &lt;p&gt;Lets take a look at our index.html.  First well drop our usage of &lt;code&gt;main.ts&lt;/code&gt; / &lt;code&gt;main.js&lt;/code&gt; (our bootstrapper file that defines config and kicks off the "app").  Well pull out the use of &lt;code&gt;data-main&lt;/code&gt; and instead, just after the reference to require well add the contents of &lt;code&gt;main.js&lt;/code&gt; much in &lt;a href="http://requirejs.org/docs/api.html#config"&gt;the style of the RequireJS docs&lt;/a&gt;.  Well also include a urlArgs that as a cache-buster that uses the approach outlined &lt;a href="http://requirejs.org/docs/api.html#config-urlArgs"&gt;in the RequireJS docs&lt;/a&gt;:&lt;/p&gt; &lt;pre class="prettyprint html"&gt;&lt;br /&gt;&lt;code class="language-html"&gt;&lt;br /&gt;&amp;lt;script src="/scripts/require.js"&amp;gt;&amp;lt;/script&amp;gt;&lt;br /&gt;&amp;lt;script&amp;gt;&lt;br /&gt;    require.config({&lt;br /&gt;        baseUrl: "/scripts",&lt;br /&gt;        paths: {&lt;br /&gt;            "jquery": "jquery-2.1.0"&lt;br /&gt;        },&lt;br /&gt;        urlArgs: "v=" +  (new Date()).getTime()&lt;br /&gt;    });&lt;br /&gt; &lt;br /&gt;    require(["alerter"], function (alerter) {&lt;br /&gt;        alerter.showMessage();&lt;br /&gt;    });&lt;br /&gt;&amp;lt;/script&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Spinning up the site all runs as you would expect.  The question is: does this work as a cache-buster?  Lets tweak &lt;code&gt;alerter.ts&lt;/code&gt; / &lt;code&gt;alerter.js&lt;/code&gt;.  And:&lt;/p&gt; &lt;a href="http://1.bp.blogspot.com/-WTNrPPyeMTY/UxcRTQpqM3I/AAAAAAAAAhk/ICvFXxji3FY/s1600/newDateSolution.png" imageanchor="1" &gt;&lt;img border="0" src="http://1.bp.blogspot.com/-WTNrPPyeMTY/UxcRTQpqM3I/AAAAAAAAAhk/ICvFXxji3FY/s320/newDateSolution.png" /&gt;&lt;/a&gt; &lt;p&gt;Oh yeah! Were cache-busting like gangbusters!&lt;/p&gt; &lt;p&gt;So now lets comment out our existing urlArgs (which represents the Development solution from Phils answer) and replace it with a fixed value like this:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;        //urlArgs: "v=" +  (new Date()).getTime()&lt;br /&gt;        urlArgs: "v=1"&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;This represents the Production solution from Phils answer.  Now lets run, refresh a couple of times and ensure that our fixed querystring value results in a 304 status code (indicating Not Modified and cached item used):&lt;/p&gt; &lt;a href="http://4.bp.blogspot.com/-Yy138lKDkuE/UxcRr7EpiXI/AAAAAAAAAhs/QVPcUF-rdgw/s1600/FixedQuerystring304.png" imageanchor="1" &gt;&lt;img border="0" src="http://4.bp.blogspot.com/-Yy138lKDkuE/UxcRr7EpiXI/AAAAAAAAAhs/QVPcUF-rdgw/s320/FixedQuerystring304.png" /&gt;&lt;/a&gt; &lt;p&gt;It does!  Now lets increment the value:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;        urlArgs: "v=2"&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;When we refresh the browser this should result in 200 status codes (indicating the cached version has not been used and the client has picked up a new version from the server).&lt;/p&gt; &lt;a href="http://2.bp.blogspot.com/-qx7Ya1MZNC8/UxcSBwKjM_I/AAAAAAAAAh0/aywHMXHUrwI/s1600/NewFixedQuerystring200.png" imageanchor="1" &gt;&lt;img border="0" src="http://2.bp.blogspot.com/-qx7Ya1MZNC8/UxcSBwKjM_I/AAAAAAAAAh0/aywHMXHUrwI/s320/NewFixedQuerystring200.png" /&gt;&lt;/a&gt; &lt;p&gt;Success!  Thats our premise tested  both Development and Production scenarios.  Now we want to turn this into a slightly more sophisticated reusable solution like this:&lt;/p&gt; &lt;pre class="prettyprint html"&gt;&lt;br /&gt;&lt;code class="language-html"&gt;&lt;br /&gt;&amp;lt;script src="/scripts/require.js"&amp;gt;&amp;lt;/script&amp;gt;&lt;br /&gt;&amp;lt;script&amp;gt;&lt;br /&gt;    var inDevelopment = true,&lt;br /&gt;        version = "1";&lt;br /&gt; &lt;br /&gt;    require.config({&lt;br /&gt;        baseUrl: "/scripts",&lt;br /&gt;        paths: {&lt;br /&gt;            "jquery": "jquery-2.1.0"&lt;br /&gt;        },&lt;br /&gt;        urlArgs: "v=" + ((inDevelopment)&lt;br /&gt;            ? (new Date()).getTime()&lt;br /&gt;            : version)&lt;br /&gt;    });&lt;br /&gt; &lt;br /&gt;    require(["alerter"], function (alerter) {&lt;br /&gt;        alerter.showMessage();&lt;br /&gt;    });&lt;br /&gt;&amp;lt;/script&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;In the tweaked script above 2 variables are defined.  The first is &lt;code&gt;inDevelopment&lt;/code&gt; which models whether you are in the Development scenario (true) or the Production scenario (false).  The second is &lt;code&gt;version&lt;/code&gt; which represents the application version number.  With this in place I can simply flip between the Development and Production scenario by changing the value of &lt;code&gt;inDevelopment&lt;/code&gt;.  And when a new version ships I can change the version number to force a cache refresh on the users.&lt;/p&gt; &lt;p&gt;What drives the values of &lt;code&gt;inDevelopment&lt;/code&gt; / &lt;code&gt;version&lt;/code&gt; is down to you.  You could load the &lt;code&gt;inDevelopment&lt;/code&gt; / &lt;code&gt;version&lt;/code&gt; values from some application endpoint.  You could hardcode them in your screen.  The choices are yours.  Im going to finish off with a simple approach that I've found useful.&lt;/p&gt; &lt;h4&gt;Lets get the server involved!&lt;/h4&gt; &lt;p&gt;I want the server to drive my urlArgs value.  Why?  Well this project happens to be an ASP.NET project which handily has the concept of Development / Production scenarios nicely modelled by the &lt;a href="http://msdn.microsoft.com/en-us/library/s10awwz0(v=vs.85).aspx"&gt;web.configs compilation debug flag&lt;/a&gt;.&lt;/p&gt; &lt;pre class="prettyprint xml"&gt;&lt;br /&gt;&lt;code class="language-xml"&gt;&lt;br /&gt;&amp;lt;configuration&amp;gt;&lt;br /&gt;  &amp;lt;system.web&amp;gt;&lt;br /&gt;    &amp;lt;compilation debug="true" targetFramework="4.5" /&amp;gt;&lt;br /&gt;    &amp;lt;httpRuntime targetFramework="4.5" /&amp;gt;&lt;br /&gt;  &amp;lt;/system.web&amp;gt;&lt;br /&gt;&amp;lt;/configuration&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;If debug is &lt;code&gt;true&lt;/code&gt; then that reflects the Development scenario.  If debug is &lt;code&gt;false&lt;/code&gt; then that reflects the Production scenario.&lt;/p&gt; &lt;p&gt;So bearing that in mind I want to use the value of debug to drive my &lt;code&gt;urlArgs&lt;/code&gt;.  If I have my debug flag set to &lt;code&gt;true&lt;/code&gt; I want to cache-bust all the way.  Likewise, if debug is set to &lt;code&gt;false&lt;/code&gt; then I want to serve up the version number so that caching is used until the version number changes.  Time to break out the C#:&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;namespace RequireJSandCaching&lt;br /&gt;{&lt;br /&gt;    public static class RequireJSHelpers&lt;br /&gt;    {&lt;br /&gt;        private static readonly bool _inDebug;&lt;br /&gt;        private static readonly string _version;&lt;br /&gt; &lt;br /&gt;        static RequireJSHelpers()&lt;br /&gt;        {&lt;br /&gt;            _inDebug = System.Web.HttpContext.Current.IsDebuggingEnabled;&lt;br /&gt;            _version = (_inDebug)&lt;br /&gt;                ? "InDebug"&lt;br /&gt;                : System.Reflection.Assembly.GetExecutingAssembly().GetName().Version.ToString();&lt;br /&gt;        }&lt;br /&gt; &lt;br /&gt;        public static string Version&lt;br /&gt;        {&lt;br /&gt;            get&lt;br /&gt;            {&lt;br /&gt;                return (_inDebug)&lt;br /&gt;                    ? System.DateTime.Now.Ticks.ToString()&lt;br /&gt;                    : _version;&lt;br /&gt;            }&lt;br /&gt;        }&lt;br /&gt;    }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;This is a static helper class called &lt;code&gt;RequireJSHelpers&lt;/code&gt;.  It has a static constructor which initialises 2 fields.  &lt;code&gt;_inDebug&lt;/code&gt; is taken from &lt;code&gt;System.Web.HttpContext.Current.IsDebuggingEnabled&lt;/code&gt; which exposes the compilation debug value.  &lt;code&gt;_version&lt;/code&gt; is initialised, when debug is &lt;code&gt;false&lt;/code&gt;, to the version number of the dll (driven by this &lt;code&gt;AssemblyInfo.cs [assembly: AssemblyVersion("1.0.*")]&lt;/code&gt; attribute)&lt;/p&gt; &lt;p&gt;Theres 1 property on this helper class called version.  Depending on whether the app is in debug mode or not this attribute either exposes the application version or effectively the C# equivalent to JavaScripts &lt;code&gt;(new Date()).getTime()&lt;/code&gt;.  (Well strictly speaking they have a different starting point in history but thats by-the-by...  Both are of equal value as cache-busters.)&lt;/p&gt; &lt;p&gt;You probably see where this is all going.&lt;/p&gt; &lt;p&gt;Lets clone our &lt;code&gt;index.html&lt;/code&gt; page and call it &lt;code&gt;serverUrlArgs.cshtml&lt;/code&gt; (note the suffix).  Lets replace the script section with this:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-html"&gt;&lt;br /&gt;&amp;lt;script&amp;gt;&lt;br /&gt;    require.config({&lt;br /&gt;        baseUrl: "/scripts",&lt;br /&gt;        paths: {&lt;br /&gt;            "jquery": "jquery-2.1.0"&lt;br /&gt;        },&lt;br /&gt;        urlArgs: "v=@RequireJSandCaching.RequireJSHelpers.Version"&lt;br /&gt;    });&lt;br /&gt; &lt;br /&gt;    require(["alerter"], function (alerter) {&lt;br /&gt;        alerter.showMessage();&lt;br /&gt;    });&lt;br /&gt;&amp;lt;/script&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Which drives &lt;code&gt;urlArgs&lt;/code&gt; from the &lt;code&gt;RequireJSHelpers.Version&lt;/code&gt; property.  If we fire it up now (with debug set to true in our web.config) then we see requests like this:&lt;/p&gt; &lt;a href="http://1.bp.blogspot.com/-N9TIJO1jzU4/UxcUW8z2uaI/AAAAAAAAAiA/-vo6wVx2NoI/s1600/DebugEqualsTrue.png" imageanchor="1" &gt;&lt;img border="0" src="http://1.bp.blogspot.com/-N9TIJO1jzU4/UxcUW8z2uaI/AAAAAAAAAiA/-vo6wVx2NoI/s320/DebugEqualsTrue.png" /&gt;&lt;/a&gt; &lt;p&gt;And if we set debug to false in our web.config then (after the initial requests have been cached) we see requests like this:&lt;/p&gt; &lt;a href="http://4.bp.blogspot.com/-xv40UDHgJfk/UxcUe4SZrUI/AAAAAAAAAiI/euLoArWTPLw/s1600/DebugEqualsFalse.png" imageanchor="1" &gt;&lt;img border="0" src="http://4.bp.blogspot.com/-xv40UDHgJfk/UxcUe4SZrUI/AAAAAAAAAiI/euLoArWTPLw/s320/DebugEqualsFalse.png" /&gt;&lt;/a&gt; &lt;p&gt;This leaves us with a simple mechanism to drive our RequireJS caching.  If debug is set to &lt;code&gt;true&lt;/code&gt; in our &lt;code&gt;web.config&lt;/code&gt; then Require will perform cache-busting.  If debug is set to &lt;code&gt;false&lt;/code&gt; then RequireJS will perform only version-changing cache-busting and will, whilst the version remains constant, support client-side caching.&lt;/p&gt; &lt;p&gt;Finished.  In case it helps Ive put the code for this &lt;a href="https://github.com/johnnyreilly/RequireJSandCaching"&gt;up on GitHub&lt;/a&gt;.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4241616656191588777'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4241616656191588777'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2014/03/caching-and-cache-busting-with-requirejs.html' title='Caching and cache-busting with RequireJS'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='http://4.bp.blogspot.com/-pG0ahnzaPJM/UxcP7f6ENII/AAAAAAAAAhY/VVahRmEe5_0/s72-c/IfItsGoodEnoughForStackOverflow.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8274393510280416338</id><published>2014-02-27T17:30:00.004Z</published><updated>2021-03-04T18:29:41.664Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='RequireJS'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='AMD'/><category scheme='http://www.blogger.com/atom/ns#' term='TypeScript'/><title type='text'>TypeScript and RequireJS (Keep It Simple)</title><content type='html'>&lt;p&gt;I'm not the first to take a look at mixing TypeScript and RequireJS but I wanted to get it clear in my head.  Also, I've always felt the best way to learn is to do.  So here we go.  I'm going to create a TypeScript and RequireJS demo based on &lt;a href="https://github.com/johnpapa/kis-requirejs-demo/"&gt;John Papa's "Keep It Simple RequireJS Demo"&lt;/a&gt;.&lt;/p&gt; &lt;p&gt;So let's fire up Visual Studio 2013 and create a new ASP.NET Web Application called RequireJSandTypeScript (the empty project template is fine).&lt;/p&gt; &lt;p&gt;Add a new HTML file to the root called index.html and base it on index3.html from &lt;a href="https://github.com/johnpapa/kis-requirejs-demo/blob/master/ModularDemo/index3.html"&gt;John Papas demo&lt;/a&gt;:&lt;/p&gt; &lt;pre class="prettyprint html"&gt;&lt;br /&gt;&lt;code class="language-html"&gt;&lt;br /&gt;&amp;lt;!DOCTYPE html&amp;gt;&lt;br /&gt;&amp;lt;html&amp;gt;&lt;br /&gt;&amp;lt;head&amp;gt;&lt;br /&gt;    &amp;lt;title&amp;gt;TypeScript with RequireJS&amp;lt;/title&amp;gt;&lt;br /&gt;&amp;lt;/head&amp;gt;&lt;br /&gt;&amp;lt;body&amp;gt;&lt;br /&gt;    &amp;lt;div&amp;gt;&lt;br /&gt;        &amp;lt;h1&amp;gt;TypeScript with RequireJS loading jQuery in Visual Studio land&amp;lt;/h1&amp;gt;&lt;br /&gt;    &amp;lt;/div&amp;gt;&lt;br /&gt;&lt;br /&gt;    &amp;lt;!-- use jquery to load this message--&amp;gt;&lt;br /&gt;    &amp;lt;p id="message"&amp;gt;&amp;lt;/p&amp;gt;&lt;br /&gt;&lt;br /&gt;    &amp;lt;!-- Shortcut to load require and then load main--&amp;gt;&lt;br /&gt;    &amp;lt;script src="/scripts/require.js"&lt;br /&gt;            data-main="/scripts/main"&lt;br /&gt;            type="text/javascript"&amp;gt;&amp;lt;/script&amp;gt;&lt;br /&gt;&amp;lt;/body&amp;gt;&lt;br /&gt;&amp;lt;/html&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Johns demo depends on jQuery and RequireJS (not too surprisingly) so lets fire up Nuget and get them:&lt;/p&gt; &lt;pre class="prettyprint"&gt;&lt;br /&gt;&lt;code class="language-ps"&gt;&lt;br /&gt;Install-Package RequireJS&lt;br /&gt;Install-Package jQuery&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Whilst were at it, lets get the Definitely Typed typings as well:&lt;/p&gt; &lt;pre class="prettyprint"&gt;&lt;br /&gt;&lt;code class="language-ps"&gt;&lt;br /&gt;Install-Package jQuery.TypeScript.DefinitelyTyped&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;To my surprise this popped up the following dialog:&lt;/p&gt; &lt;a href="http://2.bp.blogspot.com/-rzhPvMSWRZ4/Uw9uJaGRz2I/AAAAAAAAAhI/sa6ZS1-fuPs/s1600/TypeScriptConfigured.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"&gt;&lt;img border="0" src="http://2.bp.blogspot.com/-rzhPvMSWRZ4/Uw9uJaGRz2I/AAAAAAAAAhI/sa6ZS1-fuPs/s320/TypeScriptConfigured.png" /&gt;&lt;/a&gt; &lt;p&gt;By "Your project has been configured to support TypeScript." it means that the csproj file has had the following entries added:&lt;/p&gt; &lt;pre class="prettyprint xml"&gt;&lt;br /&gt;&lt;code class="language-xml"&gt;&lt;br /&gt;&amp;lt;Project ToolsVersion="12.0" DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003"&amp;gt;&lt;br /&gt;  &amp;lt;Import Project="$(MSBuildExtensionsPath32)\Microsoft\VisualStudio\v$(VisualStudioVersion)\TypeScript\Microsoft.TypeScript.Default.props" Condition="Exists('$(MSBuildExtensionsPath32)\Microsoft\VisualStudio\v$(VisualStudioVersion)\TypeScript\Microsoft.TypeScript.Default.props')" /&amp;gt;&lt;br /&gt;  ...&lt;br /&gt;  &amp;lt;PropertyGroup&amp;gt;&lt;br /&gt;    ...&lt;br /&gt;    &amp;lt;TypeScriptToolsVersion&amp;gt;0.9&amp;lt;/TypeScriptToolsVersion&amp;gt;&lt;br /&gt;  &amp;lt;/PropertyGroup&amp;gt;&lt;br /&gt;  ...&lt;br /&gt;  &amp;lt;Import Project="$(MSBuildExtensionsPath32)\Microsoft\VisualStudio\v$(VisualStudioVersion)\TypeScript\Microsoft.TypeScript.targets" Condition="Exists('$(MSBuildExtensionsPath32)\Microsoft\VisualStudio\v$(VisualStudioVersion)\TypeScript\Microsoft.TypeScript.targets')" /&amp;gt;&lt;br /&gt;  ...&lt;br /&gt;&amp;lt;/Project&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Im not sure when this tweak to the Visual Studio tooling was added was added.  Perhaps it's part of the &lt;a href="http://blogs.msdn.com/b/typescript/archive/2014/02/25/announcing-typescript-1-0rc.aspx"&gt;TypeScript 1.0 RC  release&lt;/a&gt;; either way its pretty nice.  Let's press on.&lt;/p&gt; &lt;p&gt;Whilst were at it lets make sure that were compiling to AMD (to be RequireJS friendly) by adding in the following csproj tweaks just before the Microsoft.TypeScript.targets Project import statement:&lt;/p&gt; &lt;pre class="prettyprint xml"&gt;&lt;br /&gt;&lt;code class="language-xml"&gt;&lt;br /&gt;  &amp;lt;PropertyGroup Condition="'$(Configuration)' == 'Debug'"&amp;gt;&lt;br /&gt;    &amp;lt;TypeScriptModuleKind&amp;gt;amd&amp;lt;/TypeScriptModuleKind&amp;gt;&lt;br /&gt;  &amp;lt;/PropertyGroup&amp;gt;&lt;br /&gt;  &amp;lt;PropertyGroup Condition="'$(Configuration)' == 'Release'"&amp;gt;&lt;br /&gt;    &amp;lt;TypeScriptModuleKind&amp;gt;amd&amp;lt;/TypeScriptModuleKind&amp;gt;&lt;br /&gt;  &amp;lt;/PropertyGroup&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt;  &lt;p&gt;Where was I?  Oh yes, typings. So lets get the RequireJS typings too:&lt;/p&gt; &lt;pre class="prettyprint"&gt;&lt;br /&gt;&lt;code class="language-ps"&gt;&lt;br /&gt;Install-Package requirejs.TypeScript.DefinitelyTyped&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Right  looking at index.html we can see from the data-main tag that the first file loaded by RequireJS, our bootstrapper if you will, is main.js.  So lets add ourselves a main.ts based on &lt;a href="https://github.com/johnpapa/kis-requirejs-demo/blob/master/ModularDemo/Scripts3/main.js"&gt;John's example&lt;/a&gt; (which will in turn generate a main.js):&lt;/p&gt; &lt;pre class="prettyprint ts"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;(function () {&lt;br /&gt;&lt;br /&gt;    requirejs.config(&lt;br /&gt;        {&lt;br /&gt;            baseUrl: "scripts",&lt;br /&gt;            paths: {&lt;br /&gt;                "jquery": "jquery-2.1.0"&lt;br /&gt;            }&lt;br /&gt;        }&lt;br /&gt;        );&lt;br /&gt;&lt;br /&gt;    require(["alerter"],&lt;br /&gt;        (alerter) =&gt; {&lt;br /&gt;            alerter.showMessage();&lt;br /&gt;        });&lt;br /&gt;})();&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;main.ts depends upon &lt;a href="https://github.com/johnpapa/kis-requirejs-demo/blob/master/ModularDemo/Scripts3/alerter.js"&gt;alerter&lt;/a&gt; so lets add ourselves an alerter.ts as well:&lt;/p&gt; &lt;pre class="prettyprint ts"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;define('alerter',&lt;br /&gt;    ['jquery', 'dataservice'],&lt;br /&gt;    function ($, dataservice) {&lt;br /&gt;&lt;br /&gt;        var&lt;br /&gt;            name = 'John',&lt;br /&gt;            showMessage = function () {&lt;br /&gt;                var msg = dataservice.getMessage();&lt;br /&gt;&lt;br /&gt;                $('#message').text(msg + ', ' + name);&lt;br /&gt;            };&lt;br /&gt;&lt;br /&gt;        return {&lt;br /&gt;            showMessage: showMessage&lt;br /&gt;        };&lt;br /&gt;    });&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;And a &lt;a href="https://github.com/johnpapa/kis-requirejs-demo/blob/master/ModularDemo/Scripts3/dataservice.js"&gt;dataservice.ts&lt;/a&gt;:&lt;/p&gt; &lt;pre class="prettyprint ts"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;define('dataservice', [],&lt;br /&gt;    function () {&lt;br /&gt;        var&lt;br /&gt;            msg = 'Welcome to Code Camp',&lt;br /&gt;            getMessage = function () {&lt;br /&gt;                return msg;&lt;br /&gt;            };&lt;br /&gt;&lt;br /&gt;        return {&lt;br /&gt;            getMessage: getMessage&lt;br /&gt;        };&lt;br /&gt;    });&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;That all compiles fine.  But were missing a trick.  Were supposed to be using TypeScripts AMD support so lets change the code to do just that.  First dataservice.ts:&lt;/p&gt; &lt;pre class="prettyprint ts"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;var msg = "Welcome to Code Camp";&lt;br /&gt;&lt;br /&gt;export function getMessage() {&lt;br /&gt;&lt;br /&gt;    return msg;&lt;br /&gt;};&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Then alerter.ts:&lt;/p&gt; &lt;pre class="prettyprint ts"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;import $ = require("jquery");&lt;br /&gt;import dataservice = require("dataservice");&lt;br /&gt;&lt;br /&gt;var name = "John";&lt;br /&gt;&lt;br /&gt;export function showMessage() {&lt;br /&gt;&lt;br /&gt;    var msg = dataservice.getMessage();&lt;br /&gt;&lt;br /&gt;    $("#message").text(msg + ", " + name);&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;I know both of the above look slightly different but if you look close you'll see it's really only boilerplate changes.  The actual application code is unaffected.  Finally, main.ts remains as it is and that's us done; we have ourselves a working demo... Yay!&lt;/p&gt; &lt;p&gt;Thanks to John Papa for creating such a simple demo I could use as the basis for my own demo.&lt;/p&gt; &lt;h4&gt;Closing Thoughts&lt;/h4&gt; &lt;p&gt;Unfortunately there is no typing on the alerter reference within main.ts.  To my knowledge there is no way to implicitly import the typings here  the only thing you can do is specify them manually.  (By the way, if I'm wrong about this then please do set me straight!) That said, this is not so bad really since this main.ts file is essentially just a bootstrapper that kicks things off.  All the other files contain the real application code and they have have typings a-go-go. So we're happy.&lt;/p&gt; &lt;h4&gt;Finally for bonus points....&lt;/h4&gt; &lt;p&gt;Ive included the js and js.map files in the project file as they don't seem to be added into the project by Visual Studio when the TS file is created or when it is compiled for the first time.  I've also ensured that these files are dependent upon the typescript files they were generated from.&lt;/p&gt; &lt;pre class="prettyprint xml"&gt;&lt;br /&gt;&lt;code class="language-xml"&gt;&lt;br /&gt;    &amp;lt;TypeScriptCompile Include="Scripts\alerter.ts" /&amp;gt;&lt;br /&gt;    &amp;lt;Content Include="Scripts\alerter.js"&amp;gt;&lt;br /&gt;        &amp;lt;DependentUpon&amp;gt;alerter.ts&amp;lt;/DependentUpon&amp;gt;&lt;br /&gt;    &amp;lt;/Content&amp;gt;&lt;br /&gt;    &amp;lt;Content Include="Scripts\alerter.js.map"&amp;gt;&lt;br /&gt;        &amp;lt;DependentUpon&amp;gt;alerter.ts&amp;lt;/DependentUpon&amp;gt;&lt;br /&gt;    &amp;lt;/Content&amp;gt;&lt;br /&gt;    &amp;lt;TypeScriptCompile Include="Scripts\dataservice.ts" /&amp;gt;&lt;br /&gt;    &amp;lt;Content Include="Scripts\dataservice.js"&amp;gt;&lt;br /&gt;        &amp;lt;DependentUpon&amp;gt;dataservice.ts&amp;lt;/DependentUpon&amp;gt;&lt;br /&gt;    &amp;lt;/Content&amp;gt;&lt;br /&gt;    &amp;lt;Content Include="Scripts\dataservice.js.map"&amp;gt;&lt;br /&gt;        &amp;lt;DependentUpon&amp;gt;dataservice.ts&amp;lt;/DependentUpon&amp;gt;&lt;br /&gt;    &amp;lt;/Content&amp;gt;&lt;br /&gt;    &amp;lt;TypeScriptCompile Include="Scripts\main.ts" /&amp;gt;&lt;br /&gt;    &amp;lt;Content Include="Scripts\main.js"&amp;gt;&lt;br /&gt;        &amp;lt;DependentUpon&amp;gt;main.ts&amp;lt;/DependentUpon&amp;gt;&lt;br /&gt;    &amp;lt;/Content&amp;gt;&lt;br /&gt;    &amp;lt;Content Include="Scripts\main.js.map"&amp;gt;&lt;br /&gt;        &amp;lt;DependentUpon&amp;gt;main.ts&amp;lt;/DependentUpon&amp;gt;&lt;br /&gt;    &amp;lt;/Content&amp;gt; &lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;h4&gt;Want the code for your very own?&lt;/h4&gt; &lt;p&gt;Well you can grab it from &lt;a href="https://github.com/johnnyreilly/RequireJSandTypeScript"&gt;GitHub&lt;/a&gt;.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8274393510280416338'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8274393510280416338'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2014/02/typescript-and-requirejs-keep-it-simple.html' title='TypeScript and RequireJS (Keep It Simple)'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='http://2.bp.blogspot.com/-rzhPvMSWRZ4/Uw9uJaGRz2I/AAAAAAAAAhI/sa6ZS1-fuPs/s72-c/TypeScriptConfigured.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8425334825255073023</id><published>2014-02-12T13:28:00.001Z</published><updated>2021-03-03T21:35:22.617Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='SPA'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='WPF'/><title type='text'>WPF and Mystic Meg or Playing Futurologist</title><content type='html'>&lt;p&gt;Time for an unusual post.  Most of what gets put down here is technical "how-to's".  It's usually prompted by something I've been working on and serves, as much as anything else, as an aide-memoire.  Not this time.&lt;/p&gt; &lt;p&gt;Ive been watching the changes in the world of development of the last couple of years and Ive come to a controversial conclusion... So I wanted to write about it.  Hopefully I'll be able to return to this in 5 years and say "wow - I'm so insightful - almost visionary really".  Or not.  Either way, let's put it out there - it's sink or swim time.  Ready for it?  Heres my bet: WPF will die.&lt;/p&gt; &lt;p&gt;Sounds dramatic right?  OK - I've overstated my case just to get you to read on (I should work for the tabloids).  Let me flesh this out a little.  First of all, I think WPF is a fine technology - great apps are built with it.  My personal favourite being the fantastic &lt;a href="https://github.com/blog/1151-designing-github-for-windows"&gt;GitHub for Windows&lt;/a&gt;.  And actually I don't think WPF will die at all.  What I think will happen is that it will become a more niche way to build applications.&lt;/p&gt; &lt;p&gt;More broadly, I think that native client apps (be they Windows, Mac, iOS, Android etc) will eventually come to be replaced by &lt;a href="http://en.wikipedia.org/wiki/Single-page_application"&gt;rich web apps / SPAs&lt;/a&gt; of the Angular / Ember / Durandal ilk.  I realise that at the moment that seems like a ludicrous statement  native apps are heavily used throughout enterprises worldwide and certainly will continue to be used and actively developed for at least the next 5 years.&lt;/p&gt; &lt;p&gt;But as the web comes to &lt;a href="http://arstechnica.com/information-technology/2013/05/native-level-performance-on-the-web-a-brief-examination-of-asm-js/"&gt;perform like native&lt;/a&gt;, as &lt;a href="https://github.com/jashkenas/coffee-script/wiki/List-of-languages-that-compile-to-JS"&gt;JavaScript become a compile target&lt;/a&gt;, as &lt;a href="http://davidwalsh.name/canvas-demos"&gt;HTML 5 provides rich UI&lt;/a&gt; and as &lt;a href="https://developer.mozilla.org/en/docs/WebSockets"&gt;interactive communication becomes possible&lt;/a&gt; I reckon this is a fairly probable scenario.  Particularly when you consider the &lt;a href="https://developer.mozilla.org/en-US/Apps/Reference"&gt;API work Firefox is doing around Firefox OS&lt;/a&gt;.  I could be wrong, but my expectation is that the day will come when people will have apps that they can access from anywhere, on any platform and those apps can be deployed without infrastructure having to push out new versions to each client machine.&lt;/p&gt; &lt;p&gt;The web undeniably has issues but I think it will likely win out.  And the cost case for a single client app is pretty compelling to anyone funding a system.&lt;/p&gt; &lt;p&gt;As a dev Im always working with an ever-evolving grab bag of technology whether it be front end, middle tier, database or services.  In fact that will likely always be the case (change being the only constant in the world of software).  But on the basis of my expectations Im planning to always keep at least a toe in the world of web apps as a form of career future-proofing.&lt;/p&gt; &lt;p&gt;Going less broad again when I look at the Microsoft stack, I think XAML will live on for some time.  Obviously Silverlight is no longer being actively developed but MS are using it in Windows 8 (Phone and WinJS) as well as WPF.  But I do kind of wonder if it will become like a bit like VB.Net, still around, still in use, but slowly dropping off in terms of popularity. Particularly as you can write WinJS apps in HTML / CSS / JavaScript.&lt;/p&gt; &lt;p&gt;As I say, I could very much be wrong about all of this.  I dont know what your view of the future of the development landscape is?  You may have a different insight?  Id be intrigued to know!&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8425334825255073023'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8425334825255073023'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2014/02/wpf-and-mystic-meg-or-playing.html' title='WPF and Mystic Meg or Playing Futurologist'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3111642035150099553</id><published>2014-01-24T06:30:00.001Z</published><updated>2021-03-04T18:25:42.218Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Database Snapshot Backups'/><category scheme='http://www.blogger.com/atom/ns#' term='Integration Testing'/><category scheme='http://www.blogger.com/atom/ns#' term='SQL Server'/><title type='text'>Integration Testing with Entity Framework and Snapshot Backups</title><content type='html'>&lt;p&gt;I've written before about how unit testing &lt;a href="http://icanmakethiswork.blogspot.co.uk/2012/10/unit-testing-and-entity-framework-filth.html"&gt;Entity Framework is a contentious and sometimes pointless activity&lt;/a&gt;. The TL;DR is that LINQ-to-Objects != Linq-to-Entities and so if you want some useful tests around your data tier then integration tests that actually hit a database are what you want.&lt;/p&gt; &lt;p&gt;However hitting an actual database is has serious implications.  For a start you need a database server and you need a database.  But the real issue lies around cleanup.  When you write a test that amends data in the database you need the test to clean up after itself.  If it doesn't then the next test that runs may trip over the amended data and that's your test pack instantly useless.&lt;/p&gt; &lt;p&gt;What you want is a way to wipe the slate clean - to return the database back to the state that it was in before your test ran.  Kind of like a database restore - except that would be slow.  And this is where &lt;a href="http://technet.microsoft.com/en-us/library/ms189548(v=sql.105).aspx" target="_blank"&gt;SQL Server's snapshot backups&lt;/a&gt; have got your back. To quote MSDN:&lt;/p&gt; &lt;blockquote cite="http://technet.microsoft.com/en-us/library/ms189548(v=sql.105).aspx"&gt;&lt;em&gt;&lt;p&gt;Snapshot backups have the following primary benefits:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;A backup can be created quickly, typically measured in seconds, with little or no effect on the server.&lt;/li&gt;&lt;li&gt;A restore operation can be accomplished from a disk backup just as quickly.&lt;/li&gt;&lt;li&gt;Backup to tape can be accomplished by another host without an effect on the production system.&lt;/li&gt;&lt;li&gt;&lt;strong&gt;A copy of a production database can be created instantly for reporting or testing.&lt;/strong&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/em&gt;&lt;/blockquote&gt; &lt;p&gt;Just the ticket.&lt;/p&gt; &lt;h4&gt;Our Mission&lt;/h4&gt; &lt;p&gt;In this post I want to go through the process of taking an existing database, pointing Entity Framework at it, setting up some repositories and then creating an integration test pack that uses snapshot backups to cleanup after each test runs. The code detailed in this post is available in this &lt;a href="https://github.com/johnnyreilly/SnapshotBackupsIntegrationTesting" target="_blank"&gt;GitHub repo&lt;/a&gt; if you want to have a go yourself.&lt;p&gt; &lt;h4&gt;We need a database&lt;/h4&gt; &lt;p&gt;You can find a whole assortment of databases &lt;a href="https://msftdbprodsamples.codeplex.com/releases" target="_blank"&gt;here&lt;/a&gt;. I'm going to use &lt;a href="https://msftdbprodsamples.codeplex.com/wikipage?title=AWLTDocs" target="_blank"&gt;AdventureWorksLT&lt;/a&gt; as it's small and simple. So I'll download &lt;a href="https://msftdbprodsamples.codeplex.com/downloads/get/478217"&gt;this&lt;/a&gt; and unzip it.  I'll drop &lt;code style="font-size: 0.85em"&gt;AdventureWorksLT2008R2_Data.mdf&lt;/code&gt; and &lt;code style="font-size: 0.85em"&gt;AdventureWorksLT2008R2_log.LDF&lt;/code&gt; in my data folder and attach AdventureWorksLT2008R2 to my database server.  And now I have a database:&lt;/p&gt; &lt;a href="http://1.bp.blogspot.com/-Nke8F6wYI4A/UuEeJ6C0XqI/AAAAAAAAAgg/tbuhu2TuOpg/s1600/Database2.png" imageanchor="1" &gt;&lt;img border="0" src="http://1.bp.blogspot.com/-Nke8F6wYI4A/UuEeJ6C0XqI/AAAAAAAAAgg/tbuhu2TuOpg/s320/Database2.png" /&gt;&lt;/a&gt; &lt;h4&gt;Assemble me your finest DbContext&lt;/h4&gt; &lt;p&gt;Or in English: we want to point Entity Framework at our new shiny database.  So let's fire up Visual Studio (I'm using 2013) and create a new solution called "AdventureWorks".&lt;/p&gt; &lt;p&gt;To our solution let's add a new class library project called "AdventureWorks.EntityFramework".  And to that we'll add an ADO.NET Entity Data Model which we'll call "AdventureWorks.edmx".  When the wizard fires up we'll use the "Generate from database" option, click Next and select "New Connection".  In the dialog we'll select our newly attached AdventureWorksLT2008R2 database.  We'll leave the "save entity connection settings in App.Config" option selected and click Next.  I'm going to use Entity Framework 6.0 - though I think that any version would do. I'm going to pull in all tables / store procs and views.  And now Entity Framework is pointing at my database:&lt;/p&gt; &lt;a href="http://3.bp.blogspot.com/-Sv_GPsqilao/UuElIcLCYaI/AAAAAAAAAgw/7ui-xpml8dk/s1600/EDMX.png" imageanchor="1" &gt;&lt;img border="0" src="http://3.bp.blogspot.com/-Sv_GPsqilao/UuElIcLCYaI/AAAAAAAAAgw/7ui-xpml8dk/s400/EDMX.png" /&gt;&lt;/a&gt; &lt;h4&gt;Let There be Repositories!&lt;/h4&gt; &lt;p&gt;In the name of testability let's create a new project to house repositories called "AdventureWorks.Repositories". I'm going to use &lt;a href="http://odetocode.com/about/scott-allen" target="_blank"&gt;K. Scott Allen&lt;/a&gt;'s fine &lt;a href="http://msdn.microsoft.com/en-us/library/ff714955.aspx" target="_blank"&gt;article on MSDN&lt;/a&gt; to create a very basic set of repositories wrapped in a unit of work.&lt;/p&gt; &lt;p&gt;In my new project I'll add a reference to the &lt;code&gt;AdventureWorks.EntityFramework&lt;/code&gt; project and create a new &lt;code&gt;IRepository&lt;/code&gt; interface that looks like this:&lt;/p&gt; &lt;pre style="font-size:0.85em" class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;using System;&lt;br /&gt;using System.Linq;&lt;br /&gt;using System.Linq.Expressions;&lt;br /&gt;&lt;br /&gt;namespace AdventureWorks.Repositories&lt;br /&gt;{&lt;br /&gt;    public interface IRepository&amp;lt;T&amp;gt; where T : class&lt;br /&gt;    {&lt;br /&gt;        IQueryable&amp;lt;T&amp;gt; FindAll();&lt;br /&gt;        IQueryable&amp;lt;T&amp;gt; FindWhere(Expression&amp;lt;Func&amp;lt;T, bool&amp;gt;&amp;gt; predicate);&lt;br /&gt;        T Add(T newEntity);&lt;br /&gt;        T Remove(T entity);&lt;br /&gt;    }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;And a new &lt;code&gt;IUnitOfWork&lt;/code&gt; interface that looks like this:&lt;/p&gt; &lt;pre style="font-size:0.85em" class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;using AdventureWorks.EntityFramework;&lt;br /&gt;&lt;br /&gt;namespace AdventureWorks.Repositories&lt;br /&gt;{&lt;br /&gt;    public interface IUnitOfWork&lt;br /&gt;    {&lt;br /&gt;        public IRepository&amp;lt;ErrorLog&amp;gt; ErrorLogs { get; }&lt;br /&gt;        public IRepository&amp;lt;Address&amp;gt; Addresses { get; }&lt;br /&gt;        public IRepository&amp;lt;Customer&amp;gt; Customers { get; }&lt;br /&gt;        public IRepository&amp;lt;CustomerAddress&amp;gt; CustomerAddresses { get; }&lt;br /&gt;        public IRepository&amp;lt;Product&amp;gt; Products { get; }&lt;br /&gt;        public IRepository&amp;lt;ProductCategory&amp;gt; ProductCategories { get; }&lt;br /&gt;        public IRepository&amp;lt;ProductDescription&amp;gt; ProductDescriptions { get; }&lt;br /&gt;        public IRepository&amp;lt;ProductModel&amp;gt; ProductModels { get; }&lt;br /&gt;        public IRepository&amp;lt;ProductModelProductDescription&amp;gt; ProductModelProductDescriptions { get; }&lt;br /&gt;        public IRepository&amp;lt;SalesOrderDetail&amp;gt; SalesOrderDetails { get; }&lt;br /&gt;        public IRepository&amp;lt;SalesOrderHeader&amp;gt; SalesOrderHeaders { get; }&lt;br /&gt;        public IRepository&amp;lt;BuildVersion&amp;gt; BuildVersions { get; }&lt;br /&gt;&lt;br /&gt;        void Commit();&lt;br /&gt;    }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Now for the implementation of &lt;code&gt;IRepository&lt;/code&gt;.  For this we'll need a reference to Entity Framework in our project. Then we'll create a class called &lt;code&gt;SqlRepository&lt;/code&gt;:&lt;/p&gt; &lt;pre style="font-size:0.85em" class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;using System;&lt;br /&gt;using System.Data.Entity;&lt;br /&gt;using System.Linq;&lt;br /&gt;using System.Linq.Expressions;&lt;br /&gt;&lt;br /&gt;namespace AdventureWorks.Repositories&lt;br /&gt;{&lt;br /&gt;    public class SqlRepository&amp;lt;T&amp;gt; : IRepository&amp;lt;T&amp;gt; where T : class&lt;br /&gt;    {&lt;br /&gt;        public SqlRepository(DbContext context)&lt;br /&gt;        {&lt;br /&gt;            _dbSet = context.Set&amp;lt;T&amp;gt;();&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        public IQueryable&amp;lt;T&amp;gt; FindAll()&lt;br /&gt;        {&lt;br /&gt;            return _dbSet;&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        public IQueryable&amp;lt;T&amp;gt; FindWhere(Expression&amp;lt;Func&amp;lt;T, bool&amp;gt;&amp;gt; predicate)&lt;br /&gt;        {&lt;br /&gt;            return _dbSet.Where(predicate);&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        public T Add(T newEntity)&lt;br /&gt;        {&lt;br /&gt;            return _dbSet.Add(newEntity);&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        public T Remove(T entity)&lt;br /&gt;        {&lt;br /&gt;            return _dbSet.Remove(entity);&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        protected DbSet&amp;lt;T&amp;gt; _dbSet;&lt;br /&gt;    }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;And we also need the implementation of &lt;code&gt;IUnitOfWork&lt;/code&gt;.  So we'll create a class called &lt;code&gt;SqlUnitOfWork&lt;/code&gt;:&lt;/p&gt; &lt;pre style="font-size:0.85em" class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;using System;&lt;br /&gt;using System.Linq;&lt;br /&gt;using System.Data.Entity;&lt;br /&gt;using AdventureWorks.EntityFramework;&lt;br /&gt;&lt;br /&gt;namespace AdventureWorks.Repositories&lt;br /&gt;{&lt;br /&gt;    public class SqlUnitOfWork : IUnitOfWork&lt;br /&gt;    {&lt;br /&gt;        public SqlUnitOfWork()&lt;br /&gt;        {&lt;br /&gt;            _context = new AdventureWorksLT2008R2Entities();&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        public IRepository&amp;lt;ErrorLog&amp;gt; ErrorLogs&lt;br /&gt;        {&lt;br /&gt;            get&lt;br /&gt;            {&lt;br /&gt;                if (_errorLogs == null) _errorLogs = new SqlRepository&amp;lt;ErrorLog&amp;gt;(_context);&lt;br /&gt;                return _errorLogs;&lt;br /&gt;            }&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        public IRepository&amp;lt;Address&amp;gt; Addresses&lt;br /&gt;        {&lt;br /&gt;            get&lt;br /&gt;            {&lt;br /&gt;                if (_addresses == null) _addresses = new SqlRepository&amp;lt;Address&amp;gt;(_context);&lt;br /&gt;                return _addresses;&lt;br /&gt;            }&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        public IRepository&amp;lt;Customer&amp;gt; Customers&lt;br /&gt;        {&lt;br /&gt;            get&lt;br /&gt;            {&lt;br /&gt;                if (_customers == null) _customers = new SqlRepository&amp;lt;Customer&amp;gt;(_context);&lt;br /&gt;                return _customers;&lt;br /&gt;            }&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        public IRepository&amp;lt;CustomerAddress&amp;gt; CustomerAddresses&lt;br /&gt;        {&lt;br /&gt;            get&lt;br /&gt;            {&lt;br /&gt;                if (_customerAddresses == null) _customerAddresses = new SqlRepository&amp;lt;CustomerAddress&amp;gt;(_context);&lt;br /&gt;                return _customerAddresses;&lt;br /&gt;            }&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        public IRepository&amp;lt;Product&amp;gt; Products&lt;br /&gt;        {&lt;br /&gt;            get&lt;br /&gt;            {&lt;br /&gt;                if (_products == null) _products = new SqlRepository&amp;lt;Product&amp;gt;(_context);&lt;br /&gt;                return _products;&lt;br /&gt;            }&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        public IRepository&amp;lt;ProductCategory&amp;gt; ProductCategories&lt;br /&gt;        {&lt;br /&gt;            get&lt;br /&gt;            {&lt;br /&gt;                if (_productCategories == null) _productCategories = new SqlRepository&amp;lt;ProductCategory&amp;gt;(_context);&lt;br /&gt;                return _productCategories;&lt;br /&gt;            }&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        public IRepository&amp;lt;ProductDescription&amp;gt; ProductDescriptions&lt;br /&gt;        {&lt;br /&gt;            get&lt;br /&gt;            {&lt;br /&gt;                if (_productDescriptions == null) _productDescriptions = new SqlRepository&amp;lt;ProductDescription&amp;gt;(_context);&lt;br /&gt;                return _productDescriptions;&lt;br /&gt;            }&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        public IRepository&amp;lt;ProductModel&amp;gt; ProductModels&lt;br /&gt;        {&lt;br /&gt;            get&lt;br /&gt;            {&lt;br /&gt;                if (_productModels == null) _productModels = new SqlRepository&amp;lt;ProductModel&amp;gt;(_context);&lt;br /&gt;                return _productModels;&lt;br /&gt;            }&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        public IRepository&amp;lt;ProductModelProductDescription&amp;gt; ProductModelProductDescriptions&lt;br /&gt;        {&lt;br /&gt;            get&lt;br /&gt;            {&lt;br /&gt;                if (_productModelProductDescriptions == null) _productModelProductDescriptions = new SqlRepository&amp;lt;ProductModelProductDescription&amp;gt;(_context);&lt;br /&gt;                return _productModelProductDescriptions;&lt;br /&gt;            }&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        public IRepository&amp;lt;SalesOrderDetail&amp;gt; SalesOrderDetails&lt;br /&gt;        {&lt;br /&gt;            get&lt;br /&gt;            {&lt;br /&gt;                if (_salesOrderDetails == null) _salesOrderDetails = new SqlRepository&amp;lt;SalesOrderDetail&amp;gt;(_context);&lt;br /&gt;                return _salesOrderDetails;&lt;br /&gt;            }&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        public IRepository&amp;lt;SalesOrderHeader&amp;gt; SalesOrderHeaders&lt;br /&gt;        {&lt;br /&gt;            get&lt;br /&gt;            {&lt;br /&gt;                if (_salesOrderHeaders == null) _salesOrderHeaders = new SqlRepository&amp;lt;SalesOrderHeader&amp;gt;(_context);&lt;br /&gt;                return _salesOrderHeaders;&lt;br /&gt;            }&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        public IRepository&amp;lt;BuildVersion&amp;gt; BuildVersions&lt;br /&gt;        {&lt;br /&gt;            get&lt;br /&gt;            {&lt;br /&gt;                if (_buildVersions == null) _buildVersions = new SqlRepository&amp;lt;BuildVersion&amp;gt;(_context);&lt;br /&gt;                return _buildVersions;&lt;br /&gt;            }&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        public void Commit()&lt;br /&gt;        {&lt;br /&gt;            _context.SaveChanges();&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        SqlRepository&amp;lt;ErrorLog&amp;gt; _errorLogs = null;&lt;br /&gt;        SqlRepository&amp;lt;Address&amp;gt; _addresses = null;&lt;br /&gt;        SqlRepository&amp;lt;Customer&amp;gt; _customers = null;&lt;br /&gt;        SqlRepository&amp;lt;CustomerAddress&amp;gt; _customerAddresses = null;&lt;br /&gt;        SqlRepository&amp;lt;Product&amp;gt; _products = null;&lt;br /&gt;        SqlRepository&amp;lt;ProductCategory&amp;gt; _productCategories = null;&lt;br /&gt;        SqlRepository&amp;lt;ProductDescription&amp;gt; _productDescriptions = null;&lt;br /&gt;        SqlRepository&amp;lt;ProductModel&amp;gt; _productModels = null;&lt;br /&gt;        SqlRepository&amp;lt;ProductModelProductDescription&amp;gt; _productModelProductDescriptions = null;&lt;br /&gt;        SqlRepository&amp;lt;SalesOrderDetail&amp;gt; _salesOrderDetails = null;&lt;br /&gt;        SqlRepository&amp;lt;SalesOrderHeader&amp;gt; _salesOrderHeaders = null;&lt;br /&gt;        SqlRepository&amp;lt;BuildVersion&amp;gt; _buildVersions = null;&lt;br /&gt;&lt;br /&gt;        readonly DbContext _context;&lt;br /&gt;    }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;h4&gt;And Now Let's Start Integration Testing!&lt;/h4&gt; &lt;p&gt;Let's create a new Unit Test project called "AdventureWorks.Repositories.IntegrationTests". (And just to be clear: this is *not* a unit test project - it is an &lt;em&gt;&lt;strong&gt;integration&lt;/strong&gt;&lt;/em&gt; test project.)  We'll add a reference back to our &lt;code&gt;AdventureWorks.Repositories&lt;/code&gt; project for the repositories and one back to &lt;code&gt;AdventureWorks.EntityFramework&lt;/code&gt; for our domain models.  And finally you'll need a reference to Entity Framework in your IntegrationTest project as well as well.&lt;/p&gt; &lt;p&gt;We'll copy across the &lt;code&gt;app.config&lt;/code&gt; from &lt;code&gt;AdventureWorks.EntityFramework&lt;/code&gt; to &lt;code&gt;AdventureWorks.Repositories.IntegrationTests&lt;/code&gt; as it contains the database connection details. It'll look something like this:&lt;/p&gt; &lt;pre style="font-size:0.85em" class="prettyprint xml"&gt;&lt;br /&gt;&lt;code class="language-xml"&gt;&lt;br /&gt;&amp;lt;?xml version="1.0" encoding="utf-8"?&amp;gt;&lt;br /&gt;&amp;lt;configuration&amp;gt;&lt;br /&gt;    &amp;lt;configSections&amp;gt;&lt;br /&gt;        &amp;lt;section name="entityFramework" type="System.Data.Entity.Internal.ConfigFile.EntityFrameworkSection, EntityFramework, Version=6.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" requirePermission="false" /&amp;gt;&lt;br /&gt;        &amp;lt;!-- For more information on Entity Framework configuration, visit http://go.microsoft.com/fwlink/?LinkID=237468 --&amp;gt;&lt;br /&gt;    &amp;lt;/configSections&amp;gt;&lt;br /&gt;    &amp;lt;connectionStrings&amp;gt;&lt;br /&gt;        &amp;lt;add name="AdventureWorksLT2008R2Entities" &lt;br /&gt;             connectionString="metadata=res://*/AdventureWorks.csdl|res://*/AdventureWorks.ssdl|res://*/AdventureWorks.msl;provider=System.Data.SqlClient;provider connection string=&amp;amp;quot;data source=.;initial catalog=AdventureWorksLT2008R2;integrated security=True;MultipleActiveResultSets=True;App=EntityFramework&amp;amp;quot;" &lt;br /&gt;             providerName="System.Data.EntityClient" /&amp;gt;&lt;br /&gt;    &amp;lt;/connectionStrings&amp;gt;&lt;br /&gt;    &amp;lt;entityFramework&amp;gt;&lt;br /&gt;        &amp;lt;defaultConnectionFactory type="System.Data.Entity.Infrastructure.SqlConnectionFactory, EntityFramework" /&amp;gt;&lt;br /&gt;        &amp;lt;providers&amp;gt;&lt;br /&gt;            &amp;lt;provider invariantName="System.Data.SqlClient" type="System.Data.Entity.SqlServer.SqlProviderServices, EntityFramework.SqlServer" /&amp;gt;&lt;br /&gt;        &amp;lt;/providers&amp;gt;&lt;br /&gt;    &amp;lt;/entityFramework&amp;gt;&lt;br /&gt;&amp;lt;/configuration&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Now we're ready for a test.  We'll add ourselves a class called &lt;code&gt;BuildVersionTests&lt;/code&gt;:&lt;/p&gt; &lt;pre style="font-size:0.85em" class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;using System;&lt;br /&gt;using System.Linq;&lt;br /&gt;using System.Linq.Expressions;&lt;br /&gt;using Microsoft.VisualStudio.TestTools.UnitTesting;&lt;br /&gt;&lt;br /&gt;namespace AdventureWorks.Repositories.IntegrationTests&lt;br /&gt;{&lt;br /&gt;    [TestClass]&lt;br /&gt;    public class BuildVersionTests&lt;br /&gt;    {&lt;br /&gt;        [TestMethod]&lt;br /&gt;        public void BuildVersions_should_return_the_correct_version_information()&lt;br /&gt;        {&lt;br /&gt;            // Arrange&lt;br /&gt;            var uow = new SqlUnitOfWork();&lt;br /&gt;&lt;br /&gt;            // Act&lt;br /&gt;            var buildVersions = uow.BuildVersions.FindAll().ToList();&lt;br /&gt;&lt;br /&gt;            // Assert&lt;br /&gt;            Assert.AreEqual(1, buildVersions.Count);&lt;br /&gt;            Assert.AreEqual("10.00.80404.00", buildVersions[0].Database_Version);&lt;br /&gt;            Assert.AreEqual(new DateTime(2008, 4, 4), buildVersions[0].ModifiedDate);&lt;br /&gt;            Assert.AreEqual(1, buildVersions[0].SystemInformationID);&lt;br /&gt;            Assert.AreEqual(new DateTime(2008, 4, 4), buildVersions[0].VersionDate);&lt;br /&gt;        }&lt;br /&gt;    }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;This is as simple as it gets - our test creates a new unit of work and queries the &lt;code&gt;BuildVersions&lt;/code&gt; table to see what we can see.  All it's really doing is demonstrating that we can now hit our database through our repositories.  As a side note, we could have the exact same test operating directly on the &lt;code&gt;DbContext&lt;/code&gt; like this:&lt;/p&gt; &lt;pre style="font-size:0.85em" class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;        [TestMethod]&lt;br /&gt;        public void DbContext_BuildVersions_should_return_the_correct_version_information()&lt;br /&gt;        {&lt;br /&gt;            // Arrange&lt;br /&gt;            var dbContext = new AdventureWorks.EntityFramework.AdventureWorksLT2008R2Entities();&lt;br /&gt;&lt;br /&gt;            // Act&lt;br /&gt;            var buildVersions = dbContext.BuildVersions.ToList();&lt;br /&gt;&lt;br /&gt;            // Assert&lt;br /&gt;            Assert.AreEqual(1, buildVersions.Count);&lt;br /&gt;            Assert.AreEqual("10.00.80404.00", buildVersions[0].Database_Version);&lt;br /&gt;            Assert.AreEqual(new DateTime(2008, 4, 4), buildVersions[0].ModifiedDate);&lt;br /&gt;            Assert.AreEqual(1, buildVersions[0].SystemInformationID);&lt;br /&gt;            Assert.AreEqual(new DateTime(2008, 4, 4), buildVersions[0].VersionDate);&lt;br /&gt;        }&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;For the most part we won't be doing this but I wanted to be clear that full power of Entity Framework is available to you as you're putting together your integration tests.&lt;/p&gt; &lt;h4&gt;Database Snapshotting Time&lt;/h4&gt; &lt;p&gt;Up until this point we've essentially been laying our infrastructure and doing our plumbing.  We now have a database, domain models and data access courtesy of Entity Framework, a testable repository layer and finally an integration test pack.  What we want now is to get our database snapshot / backup and restore mechanism set up and integrated into the test pack.&lt;/p&gt; &lt;p&gt;Let's add references to the &lt;code&gt;System.Data&lt;/code&gt; and &lt;code&gt;System.Configuration&lt;/code&gt; assemblies to our integration testing project and then add a new class called &lt;code&gt;DatabaseSnapshot&lt;/code&gt;:&lt;/p&gt; &lt;pre style="font-size:0.85em" class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;using System.Configuration;&lt;br /&gt;using System.Data;&lt;br /&gt;using System.Data.SqlClient;&lt;br /&gt;&lt;br /&gt;namespace AdventureWorks.Repositories.IntegrationTests&lt;br /&gt;{&lt;br /&gt;    public static class DatabaseSnapshot&lt;br /&gt;    {&lt;br /&gt;        private const string SpCreateSnapShotName = "SnapshotBackup_Create";&lt;br /&gt;        private const string SpCreateSnapShot =&lt;br /&gt;@"CREATE PROCEDURE [dbo].[" + SpCreateSnapShotName + @"]&lt;br /&gt;    @databaseName        varchar(512),&lt;br /&gt;    @databaseLogicalName varchar(512),&lt;br /&gt;    @snapshotBackupPath  varchar(512),&lt;br /&gt;    @snapshotBackupName  varchar(512)&lt;br /&gt;AS&lt;br /&gt;BEGIN&lt;br /&gt;    SET NOCOUNT ON;&lt;br /&gt;&lt;br /&gt;    DECLARE @sql varchar(500)&lt;br /&gt;    SELECT @sql = 'CREATE DATABASE ' + @snapshotBackupName +&lt;br /&gt;                  ' ON (NAME=[' + @databaseLogicalName +&lt;br /&gt;                  '], FILENAME=''' + @snapshotBackupPath + @snapshotBackupName + &lt;br /&gt;                  ''') AS SNAPSHOT OF [' + @databaseName + ']'&lt;br /&gt;    EXEC(@sql)&lt;br /&gt;END";&lt;br /&gt;&lt;br /&gt;        private const string SpRestoreSnapShotName = "SnapshotBackup_Restore";&lt;br /&gt;        private const string SpRestoreSnapShot =&lt;br /&gt;@"CREATE PROCEDURE [dbo].[" + SpRestoreSnapShotName + @"]    &lt;br /&gt;    @databaseName varchar(512),    &lt;br /&gt;    @snapshotBackupName varchar(512)    &lt;br /&gt;AS    &lt;br /&gt;BEGIN    &lt;br /&gt;    SET NOCOUNT ON;&lt;br /&gt;&lt;br /&gt;    DECLARE @sql varchar(500)&lt;br /&gt;    SET @sql  = 'ALTER DATABASE [' + @databaseName + '] SET SINGLE_USER WITH ROLLBACK IMMEDIATE'&lt;br /&gt;    EXEC (@sql)&lt;br /&gt;&lt;br /&gt;    RESTORE DATABASE @databaseName&lt;br /&gt;    FROM DATABASE_SNAPSHOT = @snapshotBackupName&lt;br /&gt;&lt;br /&gt;    SET @sql = 'ALTER DATABASE [' + @databaseName + '] SET MULTI_USER'&lt;br /&gt;    EXEC (@sql)&lt;br /&gt;END";&lt;br /&gt;&lt;br /&gt;        private const string SpDeleteSnapShotName = "SnapshotBackup_Delete";&lt;br /&gt;        private const string SpDeleteSnapShot =&lt;br /&gt;@"CREATE PROCEDURE [dbo].[" + SpDeleteSnapShotName + @"]&lt;br /&gt;    @snapshotBackupName varchar(512)&lt;br /&gt;AS&lt;br /&gt;BEGIN&lt;br /&gt;    SET NOCOUNT ON;&lt;br /&gt;&lt;br /&gt;    DECLARE @sql varchar(500)&lt;br /&gt;&lt;br /&gt;    SELECT @sql = 'DROP DATABASE ' + @snapshotBackupName &lt;br /&gt;    EXEC(@sql) &lt;br /&gt;END";&lt;br /&gt;&lt;br /&gt;        private static string _masterDbConnectionString;&lt;br /&gt;        private static string _dbName;&lt;br /&gt;        private static ConnectionStringSettings _dbConnectionStringSettings;&lt;br /&gt;&lt;br /&gt;        private static ConnectionStringSettings DbConnectionStringSettings&lt;br /&gt;        {&lt;br /&gt;            get&lt;br /&gt;            {&lt;br /&gt;                if (_dbConnectionStringSettings == null)&lt;br /&gt;                    _dbConnectionStringSettings = ConfigurationManager.ConnectionStrings["SnapshotBackup"];&lt;br /&gt;&lt;br /&gt;                return _dbConnectionStringSettings;&lt;br /&gt;            }&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        /// &amp;lt;summary&amp;gt;&lt;br /&gt;        /// Stored procedures should be executed against master database&lt;br /&gt;        /// &amp;lt;/summary&amp;gt;&lt;br /&gt;        private static string MasterDbConnectionString&lt;br /&gt;        {&lt;br /&gt;            get&lt;br /&gt;            {&lt;br /&gt;                if (string.IsNullOrEmpty(_masterDbConnectionString))&lt;br /&gt;                {&lt;br /&gt;                    var sqlConnection = new SqlConnection(DbConnectionStringSettings.ConnectionString);&lt;br /&gt;                    _masterDbConnectionString = DbConnectionStringSettings.ConnectionString.Replace(sqlConnection.Database, "master");&lt;br /&gt;                }&lt;br /&gt;                return _masterDbConnectionString;&lt;br /&gt;            }&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        private static string DbName&lt;br /&gt;        {&lt;br /&gt;            get&lt;br /&gt;            {&lt;br /&gt;                if (string.IsNullOrEmpty(_dbName))&lt;br /&gt;                    _dbName = new SqlConnection(DbConnectionStringSettings.ConnectionString).Database.TrimStart('[').TrimEnd(']');&lt;br /&gt;&lt;br /&gt;                return _dbName;&lt;br /&gt;            }&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        public static void SetupStoredProcedures()&lt;br /&gt;        {&lt;br /&gt;            using (var conn = new SqlConnection(MasterDbConnectionString))&lt;br /&gt;            {&lt;br /&gt;                conn.Open();&lt;br /&gt;&lt;br /&gt;                // Drop the existing stored procedures&lt;br /&gt;                SqlCommand cmd;&lt;br /&gt;                const string dropProcSql = "IF EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[{0}]') AND type in (N'P', N'PC')) DROP PROCEDURE [dbo].[{0}]";&lt;br /&gt;                foreach (var spName in new[] { SpCreateSnapShotName, SpDeleteSnapShotName, SpRestoreSnapShotName })&lt;br /&gt;                {&lt;br /&gt;                    cmd = new SqlCommand(string.Format(dropProcSql, spName), conn);&lt;br /&gt;                    cmd.ExecuteNonQuery();&lt;br /&gt;                }&lt;br /&gt;&lt;br /&gt;                // Create the stored procedures anew&lt;br /&gt;                foreach (var createProcSql in new[] { SpCreateSnapShot, SpDeleteSnapShot, SpRestoreSnapShot })&lt;br /&gt;                {&lt;br /&gt;                    cmd = new SqlCommand(createProcSql, conn);&lt;br /&gt;                    cmd.ExecuteNonQuery();&lt;br /&gt;                }&lt;br /&gt;&lt;br /&gt;                conn.Close();&lt;br /&gt;            }&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        public static void CreateSnapShot()&lt;br /&gt;        {&lt;br /&gt;            var databaseName = new SqlParameter { ParameterName = "@databaseName", SqlValue = SqlDbType.VarChar, Value = DbName };&lt;br /&gt;            var databaseLogicalName = new SqlParameter { ParameterName = "@databaseLogicalName", SqlValue = SqlDbType.VarChar, Value = ConfigurationManager.AppSettings["DatabaseLogicalName"] };&lt;br /&gt;            var snapshotBackupPath = new SqlParameter { ParameterName = "@snapshotBackupPath", SqlValue = SqlDbType.VarChar, Value = ConfigurationManager.AppSettings["SnapshotBackupPath"] };&lt;br /&gt;            var snapshotBackupName = new SqlParameter { ParameterName = "@snapshotBackupName", SqlValue = SqlDbType.VarChar, Value = ConfigurationManager.AppSettings["SnapshotBackupName"] };&lt;br /&gt;&lt;br /&gt;            ExecuteStoredProcAgainstMaster(SpCreateSnapShotName, new[] { databaseName, databaseLogicalName, snapshotBackupPath, snapshotBackupName });&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        public static void DeleteSnapShot()&lt;br /&gt;        {&lt;br /&gt;            var snapshotBackupName = new SqlParameter { ParameterName = "@snapshotBackupName", SqlValue = SqlDbType.VarChar, Value = ConfigurationManager.AppSettings["SnapshotBackupName"] };&lt;br /&gt;&lt;br /&gt;            ExecuteStoredProcAgainstMaster(SpDeleteSnapShotName, new[] { snapshotBackupName });&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        public static void RestoreSnapShot()&lt;br /&gt;        {&lt;br /&gt;            var databaseName = new SqlParameter { ParameterName = "@databaseName", SqlValue = SqlDbType.VarChar, Value = DbName };&lt;br /&gt;            var snapshotBackupName = new SqlParameter { ParameterName = "@snapshotBackupName", SqlValue = SqlDbType.VarChar, Value = ConfigurationManager.AppSettings["SnapshotBackupName"] };&lt;br /&gt;&lt;br /&gt;            ExecuteStoredProcAgainstMaster(SpRestoreSnapShotName, new[] { databaseName, snapshotBackupName });&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        private static void ExecuteStoredProcAgainstMaster(string storedProc, SqlParameter[] parameters)&lt;br /&gt;        {&lt;br /&gt;            using (var conn = new SqlConnection(MasterDbConnectionString))&lt;br /&gt;            {&lt;br /&gt;                conn.Open();&lt;br /&gt;                var cmd = new SqlCommand(storedProc, conn) { CommandType = CommandType.StoredProcedure };&lt;br /&gt;                cmd.Parameters.AddRange(parameters);&lt;br /&gt;                cmd.ExecuteNonQuery();&lt;br /&gt;                conn.Close();&lt;br /&gt;            }&lt;br /&gt;        }&lt;br /&gt;    }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;The &lt;code&gt;DatabaseSnapshot&lt;/code&gt; class exposes 4 methods:&lt;/p&gt; &lt;dl&gt;  &lt;dt&gt;SetupStoredProcedures&lt;/dt&gt;  &lt;dd&gt;This method creates 3 stored procedures on the master database: &lt;code&gt;SnapshotBackup_Create&lt;/code&gt;, &lt;code&gt;SnapshotBackup_Restore&lt;/code&gt; and &lt;code&gt;SnapshotBackup_Delete&lt;/code&gt;.  These procs do pretty much what their names suggest and the other 3 methods call these stored procedures when creating, restoring and deleting snapshot backups respectively.  You can see the (fairly minimal) SQL for these stored procs at the top of the&lt;code&gt;DatabaseSnapshot&lt;/code&gt; class.&lt;/dd&gt;     &lt;dt&gt;CreateSnapShot&lt;/dt&gt;  &lt;dd&gt;This method creates a snapshot backup of the database at this point in time.&lt;/dd&gt;        &lt;dt&gt;RestoreSnapShot&lt;/dt&gt;  &lt;dd&gt;This method restores the database back to state it was in when the snapshot backup was created.&lt;/dd&gt;        &lt;dt&gt;DeleteSnapShot&lt;/dt&gt;  &lt;dd&gt;This method attempts to delete the existing snapshot backup.&lt;/dd&gt;   &lt;/dl&gt; &lt;p&gt;In order that we can use the &lt;code&gt;DatabaseSnapshot&lt;/code&gt; class we need to add the following entries to our &lt;code&gt;app.config&lt;/code&gt;:  &lt;pre style="font-size:0.85em" class="prettyprint xml"&gt;&lt;br /&gt;&lt;code class="language-xml"&gt;&lt;br /&gt;&amp;lt;configuration&amp;gt;&lt;br /&gt;&lt;br /&gt;    &amp;lt;connectionStrings&amp;gt;&lt;br /&gt;&lt;br /&gt;        &amp;lt;add name="SnapshotBackup"&lt;br /&gt;             connectionString="data source=.;initial catalog=AdventureWorksLT2008R2;Trusted_Connection=true;Connection Timeout=200" /&amp;gt;&lt;br /&gt;&lt;br /&gt;    &amp;lt;/connectionStrings&amp;gt;&lt;br /&gt;&lt;br /&gt;    &amp;lt;appSettings&amp;gt;&lt;br /&gt;        &amp;lt;add key="DatabaseLogicalName" value="AdventureWorksLT2008_Data" /&amp;gt;&lt;br /&gt;        &amp;lt;add key="SnapshotBackupPath" value="C:\DbSnapshots\" /&amp;gt;&lt;br /&gt;        &amp;lt;add key="SnapshotBackupName" value="AdventureWorksLT2008R2_Snapshot" /&amp;gt;&lt;br /&gt;    &amp;lt;/appSettings&amp;gt;&lt;br /&gt;&amp;lt;/configuration&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;These settings allow have the following purposes:&lt;/p&gt; &lt;dl&gt;  &lt;dt&gt;SnapshotBackup&lt;/dt&gt;  &lt;dd&gt;A connection string that allows &lt;code&gt;DatabaseSnapshot&lt;/code&gt; to connect to the database.&lt;/dd&gt;     &lt;dt&gt;DatabaseLogicalName&lt;/dt&gt;  &lt;dd&gt;The logical name of the database you want to backup. (This can be found on the Files tab of the Database Properties in SSMS)&lt;/dd&gt;        &lt;dt&gt;SnapshotBackupPath&lt;/dt&gt;  &lt;dd&gt;The location where the snapshot backup is to be stored. You need to make sure that this exists on your machine.&lt;/dd&gt;        &lt;dt&gt;SnapshotBackupName&lt;/dt&gt;  &lt;dd&gt;The name of the snapshot backup that will be created.&lt;/dd&gt;   &lt;/dl&gt; &lt;p&gt;Now to make use of &lt;code&gt;DatabaseSnapshot&lt;/code&gt;. Let's add a new class called &lt;code&gt;SetUpTearDown&lt;/code&gt;:&lt;/p&gt; &lt;pre style="font-size:0.85em" class="prettyprint xml"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;using Microsoft.VisualStudio.TestTools.UnitTesting;&lt;br /&gt;&lt;br /&gt;namespace AdventureWorks.Repositories.IntegrationTests&lt;br /&gt;{&lt;br /&gt;    [TestClass]&lt;br /&gt;    public static class SetUpTearDown&lt;br /&gt;    {&lt;br /&gt;        [AssemblyInitialize]&lt;br /&gt;        public static void TestRunInitialize(TestContext context)&lt;br /&gt;        {&lt;br /&gt;            try&lt;br /&gt;            {&lt;br /&gt;                // Try to delete the snapshot in case it was left over from aborted test runs&lt;br /&gt;                DatabaseSnapshot.DeleteSnapShot();&lt;br /&gt;            }&lt;br /&gt;            catch { /* this should fail with snapshot does not exist */ }&lt;br /&gt;&lt;br /&gt;            DatabaseSnapshot.SetupStoredProcedures();&lt;br /&gt;            DatabaseSnapshot.CreateSnapShot();&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;        [AssemblyCleanup]&lt;br /&gt;        public static void TestRunCleanup()&lt;br /&gt;        {&lt;br /&gt;            DatabaseSnapshot.DeleteSnapShot();&lt;br /&gt;        }&lt;br /&gt;    }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;At the start of the test run this will create a snapshot in case one doesn't exist already.  And at the end of the test run it will be a good citizen and delete the snapshot.  We'll also add an extra method to our &lt;code&gt;BuildVersionTests&lt;/code&gt; class:&lt;/p&gt; &lt;pre style="font-size:0.85em" class="prettyprint xml"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;namespace AdventureWorks.Repositories.IntegrationTests&lt;br /&gt;{&lt;br /&gt;    [TestClass]&lt;br /&gt;    public class BuildVersionTests&lt;br /&gt;    {&lt;br /&gt;        // ... &lt;br /&gt;&lt;br /&gt;        [TestCleanup]&lt;br /&gt;        public void TestCleanup()&lt;br /&gt;        {&lt;br /&gt;            DatabaseSnapshot.RestoreSnapShot();&lt;br /&gt;        }&lt;br /&gt;    }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;This will ensure that after each test runs the database will be restored back to the snapshot created in &lt;code&gt;SetUpTearDown&lt;/code&gt;.  Now if you re-run your tests, in between each test the restore back to the snapshot is taking place.&lt;/p&gt; &lt;h4&gt;Prove it!&lt;/h4&gt; &lt;p&gt;Of course the tests we have in place at present don't actually change the data at all.  So I could be lying.  I'm not.  Let's prove it by adding one more class called &lt;code&gt;CustomerTests&lt;/code&gt;:&lt;/p&gt; &lt;pre style="font-size:0.85em" class="prettyprint xml"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;using System;&lt;br /&gt;using System.Linq;&lt;br /&gt;using System.Linq.Expressions;&lt;br /&gt;using Microsoft.VisualStudio.TestTools.UnitTesting;&lt;br /&gt;using AdventureWorks.EntityFramework;&lt;br /&gt;&lt;br /&gt;namespace AdventureWorks.Repositories.IntegrationTests&lt;br /&gt;{&lt;br /&gt;    [TestClass]&lt;br /&gt;    public class CustomerTests&lt;br /&gt;    {&lt;br /&gt;        [TestMethod]&lt;br /&gt;        public void Should_change_a_customers_first_and_last_name()&lt;br /&gt;        {&lt;br /&gt;            // Arrange&lt;br /&gt;            var uow = new SqlUnitOfWork();&lt;br /&gt;&lt;br /&gt;            // Act&lt;br /&gt;            var customer = uow.Customers.FindWhere(x =&gt; x.FirstName == "Jay" &amp;&amp; x.LastName == "Adams").First();&lt;br /&gt;            var customerId = customer.CustomerID;&lt;br /&gt;            customer.FirstName = "John";&lt;br /&gt;            customer.LastName = "Reilly";&lt;br /&gt;            uow.Commit();&lt;br /&gt;&lt;br /&gt;            // Assert&lt;br /&gt;            Assert.IsNotNull(uow.Customers.FindWhere(x =&gt; x.FirstName == "John" &amp;&amp; x.LastName == "Reilly" &amp;&amp; x.CustomerID == customerId).SingleOrDefault());&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        [TestCleanup]&lt;br /&gt;        public void TestCleanup()&lt;br /&gt;        {&lt;br /&gt;            DatabaseSnapshot.RestoreSnapShot();&lt;br /&gt;        }&lt;br /&gt;    }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;The above test checks that you can look up an existing customer, Mr Jay Adams, and change his name to my name - to John Reilly.  If I execute the test above and there was no restore in place then subsequently when I came to exercise this test it should start to fail as it no longer has a Mr Jay Adams to lookup.  But with this restore mechanism in place I can execute this test repeatedly without worrying.&lt;/p&gt; &lt;h4&gt;Rounding off&lt;/h4&gt; &lt;p&gt;And that's us finished - we now have a database snapshot restore mechanism in place.  With this we can develop integration tests that thoroughly change the data in our database secure in the knowledge that once the test is complete our database will be restored back to it's initial state.&lt;/p&gt; &lt;p&gt;Obviously there are other alternative approaches for integration testing available to that which I've laid out in this post.  But I can imagine that this approach is very useful for applying to legacy applications that you might inherit and need to continue supporting.  Also, this approach should fit in well with a continuous integration setup.  It would be pretty straightforward to have database that existed purely for testing purposes against which all the integration tests could be set to run at the point of each check in.&lt;/p&gt; &lt;p&gt;Thanks to Marc Talary, Sandeep Deo and Tishul Vadher who all contributed to &lt;code&gt;DatabaseSnapshot&lt;/code&gt;. Credit is also due to Google due to the hundreds of articles the team ended up reading on snapshot backups.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3111642035150099553'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3111642035150099553'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2014/01/integration-testing-with-entity.html' title='Integration Testing with Entity Framework and Snapshot Backups'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='http://1.bp.blogspot.com/-Nke8F6wYI4A/UuEeJ6C0XqI/AAAAAAAAAgg/tbuhu2TuOpg/s72-c/Database2.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4793096145440484195</id><published>2014-01-09T06:30:00.002Z</published><updated>2021-03-03T21:28:25.053Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='Q'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='TypeScript'/><category scheme='http://www.blogger.com/atom/ns#' term='0.9.1.1'/><category scheme='http://www.blogger.com/atom/ns#' term='0.9.5'/><category scheme='http://www.blogger.com/atom/ns#' term='upgrading'/><title type='text'>Upgrading to TypeScript 0.9.5 - A Personal Memoir</title><content type='html'>&lt;p&gt;I recently made the step to upgrade from TypeScript 0.9.1.1 to 0.9.5.  To my surprise this process was rather painful and certainly not an unalloyed pleasure.  Since I'm now on the other side, so to speak, I thought I'd share my experience and cast back a rope bridge to those about to journey over the abyss.&lt;/p&gt; &lt;h4&gt;TL;DR&lt;/h4&gt; &lt;p&gt;TypeScript 0.9.5 is worth making the jump to.  However, if you are using Visual Studio (as I would guess many are) then you should be aware of a number of problems with the TypeScript Visual Studio tooling for TS 0.9.5.  These problems can be worked around if you follow the instructions in this post.&lt;/p&gt; &lt;h4&gt;Upgrading the Plugin&lt;/h4&gt; &lt;p&gt;At home I upgraded the moment TS 0.9.5 was released.  This allowed me to help with migrating the &lt;a target="_blank" href="https://github.com/borisyankov/DefinitelyTyped"&gt;Definitely Typed typings&lt;/a&gt; over from 0.9.1.1.  And allowed me to give TS 0.9.5 a little test drive. However, I deliberately held off performing the upgrade at work until I knew that all the Definitely Typed typings had been upgraded.  This was completed &lt;a href="https://github.com/borisyankov/DefinitelyTyped/pull/1385" target="_blank"&gt;by the end of 2013&lt;/a&gt;.  So in the new year it seemed a good time to make the move.&lt;/p&gt; &lt;p&gt;If, like me, you are using TypeScript inside Visual Studio then you'd imagine it's as simple as closing down VS, uninstalling TypeScript 0.9.1.1 from Programs and Features and then installing the &lt;a href="http://www.typescriptlang.org/#Download" target="_blank"&gt;new plugin&lt;/a&gt;. And it is if you are running IE 10 or IE 11 on your Windows machine.  If you are running a lower IE version then there is a problem.&lt;/p&gt; &lt;p&gt;Regrettably, the TypeScript 0.9.5 plugin installer has a dependency on IE 10.  Fortunately TypeScript itself has no dependency on IE 10 at all (and why would it?). This dependency appears to have been a mistake. I &lt;a href="https://typescript.codeplex.com/workitem/1975" target="_blank"&gt;raised it as an issue&lt;/a&gt; and the TS team have said that this will be resolved in the next major release.&lt;/p&gt; &lt;p&gt;Happily there is a workaround if you're running IE 9 or lower which has been noted in the  &lt;a href="http://blogs.msdn.com/b/typescript/archive/2013/12/05/announcing-typescript-0-9-5.aspx" target="_blank"&gt;comments underneath the TS 0.9.5 release blog post&lt;/a&gt;.  All you do is set the &lt;code&gt;HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Microsoft\Internet Explorer\svcVersion&lt;/code&gt; registry key value to &lt;code&gt;10.0.9200.16384&lt;/code&gt; for the duration of the install.&lt;/p&gt; &lt;p&gt;First hurdle jumped, the upgrade continues simple enough.  Then the fun starts...&lt;/p&gt; &lt;h4&gt;Declaration Merging is dead... Sort of&lt;/h4&gt; &lt;p&gt;Having upgraded my plugin I opened up the project I'm working on in Visual Studio.  I used NuGet to upgrade all the Definitely Typed packages to the latest (TS 0.9.5) versions.  Then I tried, and failed, to compile.  It was the the most obscure error I've seen in a while:&lt;/p&gt; &lt;pre class="prettyprint ts" style="font-size: 0.85em;"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;VSTSC : tsc.js(37574, 25) Microsoft JScript runtime error : Unable to get value of the property 'wrapsSomeTypeParameter': object is null or undefined&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;As you can see there was no indication where in my code the problem was being caused.  Fortunately someone had already suffered this particular problem and logged an issue &lt;a href="https://typescript.codeplex.com/workitem/1995" target="_blank"&gt;here&lt;/a&gt;.  Digging through the comments I found a common theme; everyone experiencing the problem was using the &lt;a href="https://github.com/borisyankov/DefinitelyTyped/blob/master/q/Q.d.ts" target="_blank"&gt;Q typings&lt;/a&gt;. So what's up with that?&lt;/p&gt;   &lt;p&gt;Strangely, if you directly referenced the Q typings everything was okay - which is how the Definitely Typed tests came to pass in the first place. But if you wanted to make use of these typings with implicit referencing (in Visual Studio since TS 0.9.1, all TypeScript files in a project are considered to be referencing each other) - well it doesn't work.&lt;/p&gt; &lt;p&gt;I decided to take a look at the Q typings at this point to see what was so upsetting about them.  The one thing that was obvious was that these typings make use of &lt;a href="http://blogs.msdn.com/b/typescript/archive/2013/06/18/announcing-typescript-0-9.aspx" target="_blank"&gt;Declaration Merging&lt;/a&gt;. And this made them slightly different to most of the other typing libraries that I was using.  So I decided to refactor the Q typings to use the more interface driven approach the other typing libraries used in the hope that might resolve the issue.&lt;/p&gt; &lt;p&gt;Roughly speaking I went from:&lt;/p&gt; &lt;pre class="prettyprint ts" style="font-size: 0.85em;"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;declare function Q&amp;lt;T&amp;gt;(promise: Q.IPromise&amp;lt;T&amp;gt;): Q.Promise&amp;lt;T&amp;gt;;&lt;br /&gt;declare function Q&amp;lt;T&amp;gt;(promise: JQueryPromise&amp;lt;T&amp;gt;): Q.Promise&amp;lt;T&amp;gt;;&lt;br /&gt;declare function Q&amp;lt;T&amp;gt;(value: T): Q.Promise&amp;lt;T&amp;gt;;&lt;br /&gt;&lt;br /&gt;declare module Q {&lt;br /&gt;    // functions etc in here&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;declare module "q" {&lt;br /&gt;    export = Q;&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;To:&lt;/p&gt; &lt;pre class="prettyprint ts" style="font-size: 0.85em;"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;interface QIPromise&amp;lt;T&amp;gt; {&lt;br /&gt;    // functions etc in here&lt;br /&gt;}&lt;br /&gt; &lt;br /&gt;interface QDeferred&amp;lt;T&amp;gt; {&lt;br /&gt;    // functions etc in here&lt;br /&gt;}&lt;br /&gt; &lt;br /&gt;interface QPromise&amp;lt;T&amp;gt; {&lt;br /&gt;    // functions etc in here&lt;br /&gt;}&lt;br /&gt; &lt;br /&gt;interface QPromiseState&amp;lt;T&amp;gt; {&lt;br /&gt;    // functions etc in here&lt;br /&gt;}&lt;br /&gt; &lt;br /&gt;interface QStatic {&lt;br /&gt; &lt;br /&gt;    &lt;T&gt;(promise: QIPromise&amp;lt;T&amp;gt;): QPromise&amp;lt;T&amp;gt;;&lt;br /&gt;    &lt;T&gt;(promise: JQueryPromise&amp;lt;T&amp;gt;): QPromise&amp;lt;T&amp;gt;;&lt;br /&gt;    &lt;T&gt;(value: T): QPromise&amp;lt;T&amp;gt;;&lt;br /&gt; &lt;br /&gt;    // other functions etc continue here&lt;br /&gt;}&lt;br /&gt; &lt;br /&gt;declare module "q" {&lt;br /&gt;    export = Q;&lt;br /&gt;}&lt;br /&gt;declare var Q: QStatic;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;And that fixed the obscure 'wrapsSomeTypeParameter' error.  The full source code of these amended typings can be found as a GitHub Repo &lt;a href="https://github.com/johnnyreilly/Q-TS-0.9.5-WorkAround" target="_blank"&gt;here&lt;/a&gt; in case you want to use it yourself. (I did originally consider adding this to Definitely Typed but opted not to in the end - &lt;a href="https://github.com/borisyankov/DefinitelyTyped/pull/1497" target="_blank"&gt;see discussion on GitHub&lt;/a&gt;.)&lt;/p&gt; &lt;!-- &lt;h4&gt;TypeScript Language Service&lt;/h4&gt; &lt;p&gt;At this point I could compile - which was fantastic.  However, the strangest thing: all the typings from other files were undetected.  Despite having the jQuery, Q, Knockout etc typings within my project the TypeScript Language Service was not detecting them.  The TypeScript Language Service (if you're not aware of it) is the supplier of Intellisense and all that good stuff which Visual Studio uses to give you a rich IDE.  This lead to the odd experience of being able to compile my TypeScript successfully (the compiler could detect my typings) but having a code editor that was a sea of red squiggly lines.&lt;/p&gt; &lt;p&gt;There's a happy ending here - for although TypeScript 0.9.5 had delivered the problem it had also delivered a solution.  &lt;a href="http://blogs.msdn.com/b/typescript/archive/2013/12/05/announcing-typescript-0-9-5.aspx" target="_blank"&gt;With TypeScript 0.9.5 you can now make use of a &lt;code&gt;_references.ts&lt;/code&gt; file&lt;/a&gt;:&lt;/p&gt; &lt;blockquote cite="http://blogs.msdn.com/b/typescript/archive/2013/12/05/announcing-typescript-0-9-5.aspx"&gt;&lt;em&gt;&lt;p&gt;"With the previous improvements to the Visual Studio experience, we've moved to projects implicitly referencing the .ts files contained in the project.  This cut down on having to explicitly reference your files in the project, bringing the experience much closer to C#.  Unfortunately, it also did not work well when using the option to concatenate your output .js file.&lt;/p&gt; &lt;p&gt;We're continuing to improve this experience.  Starting with 0.9.5, you can now add an &lt;code&gt;_references.ts&lt;/code&gt; file to your project.  This file will be the first passed to the compiler, allowing you more control over the order the generated .js file when used in combination with the Combine JavaScript output into file option (the equivalent of using the --out commandline option)."&lt;/p&gt;&lt;/em&gt;&lt;/blockquote&gt; &lt;p&gt;By adding an &lt;code&gt;_references.ts&lt;/code&gt; file to our project we able to get the TypeScript Language Service functioning once more.  There were a couple of "gotchas" that you should be aware of:&lt;/p&gt; &lt;ul&gt;&lt;li&gt;You may already have a &lt;code&gt;_references.&lt;strong&gt;js&lt;/strong&gt;&lt;/code&gt; file in your project.  It drives the JavaScript Intellisense Visual Studio provides.  So if you have parts of your application that are just straight JavaScript (we do) and you still want your Intellisense to persist then be certain to place your &lt;code&gt;_references.ts&lt;/code&gt; file where it doesn't compile and delete your a &lt;code&gt;_references.&lt;strong&gt;js&lt;/strong&gt;&lt;/code&gt; file.&lt;/li&gt;&lt;li&gt;Make sure your &lt;code&gt;_references.ts&lt;/code&gt; contains &lt;em&gt;all&lt;/em&gt; TypeScript files in your project.  Without this you don't have a functioning TypeScript Language Service.&lt;/li&gt;&lt;li&gt;Occasionally the problem will re-occur; the TypeScript Language Service will stop working again.  This can generally be righted by opening your &lt;code&gt;_references.ts&lt;/code&gt; inside Visual Studio.  A little flaky I know.&lt;/li&gt;&lt;/ul&gt; &lt;p&gt;In the end &lt;a href="https://typescript.codeplex.com/workitem/2071" target="_blank"&gt;I logged the issue on CodePlex&lt;/a&gt; and I'm hopeful it will be resolved in subsequent versions of TypeScript.&lt;/p&gt;--&gt; &lt;h4&gt;The Promised Land&lt;/h4&gt; &lt;p&gt;You're there.  You've upgraded to the new plugin and the new typings.  All is compiling as it should and the language service is working as well.  Was it worth it? I think yes, for the following reasons:&lt;/p&gt; &lt;ol&gt;&lt;li&gt;TS 0.9.5 compiles faster, and hogs less memory.&lt;br /&gt;&lt;br /&gt;&lt;/li&gt;&lt;li&gt;When we compiled with TS 0.9.5 we found there were a couple of bugs in our codebase which the tightened up compiler was now detecting. Essentially where we'd assumed types were flowing through to functions there were a couple of occasions with TS 0.9.1.1 where they weren't.  Where we'd assumed we had a type of &lt;code&gt;T&lt;/code&gt; available in a function whereas it was actually a type of &lt;code&gt;any&lt;/code&gt;.  I was really surprised that this was the case since we were already making use of &lt;code&gt;noImplicitAny&lt;/code&gt; compiler flag in our project. So where a type had changed and a retired property was being referenced TS 0.9.5 picked up an error that TS 0.9.1.1 had not. Good catch!&lt;br /&gt;&lt;br /&gt;&lt;/li&gt;&lt;li&gt;And finally (and I know these are really minor), the compiled JS is a little different now.  Firstly, the compiled JS features all of TypeScript comments in the positions that you might hope for.  Previously it seemed that about 75% came along for the ride and ended up in some strange locations sometimes.  Secondly, enums are treated differently during compilation now - where it makes sense the actual backing value of an enum is used rather than going through the JavaScript construct.  So it's a bit like a &lt;code&gt;const&lt;/code&gt; I guess - presumably this allows JavaScript engines to optimise a little more.&lt;/li&gt;&lt;/ol&gt; &lt;p&gt;I hope I haven't put you off with this post.  I think TypeScript 0.9.5 is well worth making the leap for - and hopefully by reading this you'll have saved yourself from a few of the rough edges.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4793096145440484195'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4793096145440484195'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2014/01/upgrading-to-typescript-095-personal.html' title='Upgrading to TypeScript 0.9.5 - A Personal Memoir'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1141989858214800562</id><published>2013-12-19T14:43:00.001Z</published><updated>2013-12-19T14:43:12.546Z</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Bootstrap Recaptcha</title><content type='html'>&lt;style type="text/css"&gt;    .recaptchatable * {         line-height: normal;     } &lt;/style&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1141989858214800562'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1141989858214800562'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4443258777666628393</id><published>2013-12-13T17:43:00.000Z</published><updated>2013-12-13T17:44:44.287Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='jquery'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='package'/><category scheme='http://www.blogger.com/atom/ns#' term='WebMatrix'/><category scheme='http://www.blogger.com/atom/ns#' term='NuGet'/><title type='text'>NuGet and WebMatrix: How to install a specific version of a package</title><content type='html'>&lt;p&gt;I've recently been experimenting with WebMatrix.  If you haven't heard of it, WebMatrix is Microsoft's &lt;em&gt;&lt;a href="http://www.microsoft.com/web/webmatrix/" target="_blank"&gt;"free, lightweight, cloud-connected web development tool"&lt;/a&gt;&lt;/em&gt;. All marketing aside, it's pretty cool.  You can whip up a site in next to no time, it has source control, publishing abilities, intellisense.  Much good stuff.  And one thing it has, that I genuinely hadn't expected is &lt;a href="https://www.nuget.org/" target="_blank"&gt;NuGet&lt;/a&gt;.  Brilliant!&lt;/p&gt; &lt;p&gt;But like any free product there are disadvantages.  As a long time Visual Studio user I've become very used to the power of the NuGet command line. I've been spoiled.  You don't have this in WebMatrix.  You have a nice UI that looks like this:&lt;/p&gt; &lt;div class="separator"&gt;&lt;a href="http://2.bp.blogspot.com/-MLAAVw9-O_A/UqstzAa1-8I/AAAAAAAAAfU/gtg8kPjsP7M/s1600/NuGetWebMatrix.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"&gt;&lt;img border="0" src="http://2.bp.blogspot.com/-MLAAVw9-O_A/UqstzAa1-8I/AAAAAAAAAfU/gtg8kPjsP7M/s400/NuGetWebMatrix.png" /&gt;&lt;/a&gt;&lt;/div&gt; &lt;p&gt;Looks great right?  However, if you want to install a specific version of a NuGet package... well let's see what happens...&lt;/p&gt; &lt;p&gt;As you're probably aware jQuery currently exists in 2 branches; the 1.10.x branch which supports IE 6-8 and the 2.0.x branch which doesn't. However there is only 1 jQuery inside NuGet. Let's click on install and see if we can select a specific version:&lt;/p&gt; &lt;div class="separator"&gt;&lt;a href="http://4.bp.blogspot.com/-Phqw0WYN0BM/UqswJPr7X1I/AAAAAAAAAfg/4lpkwUG5p5w/s1600/NuGetWebMatrixjQuery.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"&gt;&lt;img border="0" src="http://4.bp.blogspot.com/-Phqw0WYN0BM/UqswJPr7X1I/AAAAAAAAAfg/4lpkwUG5p5w/s400/NuGetWebMatrixjQuery.png" /&gt;&lt;/a&gt;&lt;/div&gt; &lt;p&gt;Hmmm....  As you can see it's 2.0.3 or bust.  We can't select a specific version; we're forced to go with the latest and greatest which is a problem if you need to support IE 6-8.  So the obvious strategy if you're in this particular camp is to forego NuGet entirely.  Go old school.  And we could.  But let's say we want to keep using NuGet, mindful that a little while down the road we'll be ready to do that upgrade.  Can it be done? Let's find out.&lt;/p&gt; &lt;h4&gt;NuGet, by hook or by crook&lt;/h4&gt; &lt;p&gt;I've created a new site in WebMatrix using the Empty Site template. Looks like this:&lt;/p&gt; &lt;div class="separator"&gt;&lt;a href="http://4.bp.blogspot.com/-yDf_KCHWImA/Uqs8Csn8UWI/AAAAAAAAAfs/cmnj5ddqDCk/s1600/EmptySite.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"&gt;&lt;img border="0" src="http://4.bp.blogspot.com/-yDf_KCHWImA/Uqs8Csn8UWI/AAAAAAAAAfs/cmnj5ddqDCk/s400/EmptySite.png" /&gt;&lt;/a&gt;&lt;/div&gt; &lt;p&gt;Lovely.&lt;/p&gt; &lt;p&gt;Now to get me some jQuery 1.10.2 goodness.  To the console Batman!  We've already got the NuGet command line installed (if you haven't you could get it from &lt;a href="http://nuget.org/nuget.exe"&gt;here&lt;/a&gt;) and so we follow these steps:&lt;/p&gt; &lt;ul&gt;&lt;li&gt;At the &lt;code&gt;C:\&lt;/code&gt; prompt we enter &lt;code&gt;nuget install jQuery -Version 1.10.2&lt;/code&gt; and down comes jQuery 1.10.2.&lt;/li&gt;&lt;li&gt;We move &lt;code&gt;C:\jQuery.1.10.2&lt;/code&gt; to &lt;code&gt;C:\Users\me\Documents\My Web Sites\Empty Site\App_Data\packages\jQuery.1.10.2&lt;/code&gt;.&lt;/li&gt;&lt;li&gt;Then we delete the &lt;code&gt;C:\Users\me\Documents\My Web Sites\Empty Site\App_Data\packages\jQuery.1.10.2\Tools&lt;/code&gt; subfolder.&lt;/li&gt;&lt;li&gt;We move &lt;code&gt;C:\Users\me\Documents\My Web Sites\Empty Site\App_Data\packages\jQuery.1.10.2\Content\Scripts&lt;/code&gt; to &lt;code&gt;C:\Users\me\Documents\My Web Sites\Empty Site\Scripts&lt;/code&gt;.&lt;/li&gt;&lt;li&gt;And finally we delete the &lt;code&gt;C:\Users\me\Documents\My Web Sites\Empty Site\App_Data\packages\jQuery.1.10.2\Content&lt;/code&gt; folder.&lt;/li&gt;&lt;/ul&gt; &lt;p&gt;We hit refresh back in WebMatrix and now we get this:&lt;/p&gt; &lt;div class="separator"&gt;&lt;a href="http://4.bp.blogspot.com/-EAfCq2zjNl4/UqtAvAW35PI/AAAAAAAAAf4/u97kbdXWO84/s1600/EmptySiteWithjQuery.png" imageanchor="1" &gt;&lt;img border="0" src="http://4.bp.blogspot.com/-EAfCq2zjNl4/UqtAvAW35PI/AAAAAAAAAf4/u97kbdXWO84/s400/EmptySiteWithjQuery.png" /&gt;&lt;/a&gt;&lt;/div&gt; &lt;p&gt;If we go to NuGet and select updates you'll see that jQuery is now considered "installed" and an update is available.  So, in short, our plan worked - yay!&lt;/p&gt; &lt;div class="separator"&gt;&lt;a href="http://3.bp.blogspot.com/-3-pJuMZVJPo/UqtBiuBNdyI/AAAAAAAAAgE/GA_4difKXdQ/s1600/NuGetWebMatrixjQueryUpgrade.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"&gt;&lt;img border="0" src="http://3.bp.blogspot.com/-3-pJuMZVJPo/UqtBiuBNdyI/AAAAAAAAAgE/GA_4difKXdQ/s320/NuGetWebMatrixjQueryUpgrade.png" /&gt;&lt;/a&gt;&lt;/div&gt; &lt;h4&gt;Now for bonus points&lt;/h4&gt; &lt;p&gt;Just to prove that you can upgrade using the WebMatrix tooling following our manual install let's do it.  Click "Update", then "Yes" and finally "I Accept" to the EULA. You'll now see we're now on jQuery 2.0.3:&lt;/p&gt; &lt;div class="separator"&gt;&lt;a href="http://4.bp.blogspot.com/-6tLukWlzBfg/UqtE_Ni4FaI/AAAAAAAAAgM/AUxszwXhlGo/s1600/NuGetWebMatrixjQueryUpgraded.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"&gt;&lt;img border="0" src="http://4.bp.blogspot.com/-6tLukWlzBfg/UqtE_Ni4FaI/AAAAAAAAAgM/AUxszwXhlGo/s400/NuGetWebMatrixjQueryUpgraded.png" /&gt;&lt;/a&gt;&lt;/div&gt; &lt;h4&gt;Rounding off&lt;/h4&gt; &lt;p&gt;In my example I'm only looking at a simple JavaScript library.  But the same principal should be able to be applied to any NuGet package as far as I'm aware.  Hope that helps!&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4443258777666628393'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4443258777666628393'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2013/12/nuget-and-webmatrix-how-to-install.html' title='NuGet and WebMatrix: How to install a specific version of a package'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='http://2.bp.blogspot.com/-MLAAVw9-O_A/UqstzAa1-8I/AAAAAAAAAfU/gtg8kPjsP7M/s72-c/NuGetWebMatrix.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1383251514627333099</id><published>2013-12-04T17:35:00.001Z</published><updated>2021-03-04T18:21:24.833Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='CSS 3'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='transitionend'/><category scheme='http://www.blogger.com/atom/ns#' term='fadeIn'/><category scheme='http://www.blogger.com/atom/ns#' term='fadeOut'/><category scheme='http://www.blogger.com/atom/ns#' term='transitions'/><title type='text'>Simple fading in and out using CSS transitions and classes</title><content type='html'>&lt;p&gt;Caveat emptor folks... Let me start off by putting my hands up and saying I am no expert on CSS.  And furthermore let me say that this blog post is essentially the distillation of a heady session of googling on the topic of CSS transitions.  The credit for the technique detailed here belongs to many others, I'm just documenting it for my own benefit (and for anyone who stumbles upon this).&lt;/p&gt; &lt;h4&gt;What do we want to do?&lt;/h4&gt; &lt;p&gt;Most web developers have likely reached at some point for jQuery's &lt;a href="http://api.jquery.com/fadeIn/" target="_blank"&gt;&lt;code&gt;fadeIn&lt;/code&gt;&lt;/a&gt; and &lt;a href="http://api.jquery.com/fadeOut/" target="_blank"&gt;&lt;code&gt;fadeOut&lt;/code&gt;&lt;/a&gt; awesomeness.  What could be cooler than fading in or out your UI, right?&lt;/p&gt; &lt;p&gt;Behind the scenes of &lt;code&gt;fadeIn&lt;/code&gt; and &lt;code&gt;fadeOut&lt;/code&gt; JavaScript is doing an awful lot of work to create that animation.  And in our modern world we simply don't need to do that work anymore; it's gone native and is covered by &lt;a href="https://developer.mozilla.org/en-US/docs/Web/Guide/CSS/Using_CSS_transitions" target="_blank"&gt;CSS transitions&lt;/a&gt;.&lt;/p&gt; &lt;p&gt;Added to the "&lt;a href="http://en.wikipedia.org/wiki/George_Mallory" target="_blank"&gt;because it's there&lt;/a&gt;" reason for using CSS transitions to do fading there is a more important reason; let me quote &lt;a href="http://www.html5rocks.com/en/tutorials/speed/html5/#toc-css3-transitions" target="_blank"&gt;HTML5 rocks&lt;/a&gt;:&lt;/p&gt; &lt;blockquote cite="http://www.html5rocks.com/en/tutorials/speed/html5/#toc-css3-transitions"&gt;"&lt;em&gt;CSS Transitions make style animation trivial for everyone, but they also are a smart performance feature. Because a CSS transition is managed by the browser, the fidelity of its animation can be greatly improved, and in many cases hardware accelerated. Currently WebKit (Chrome, Safari, iOS) have hardware accelerated CSS transforms, but it's coming quickly to other browsers and platforms.&lt;/em&gt;"&lt;/blockquote&gt; &lt;p&gt;Added to this, if you have mobile users then the usage of native functionality (as opposed to doing it manually in JavaScript) actually saves battery life.&lt;/p&gt; &lt;h4&gt;I'm sold - let's do it!&lt;/h4&gt; &lt;p&gt;This is the CSS we'll need:&lt;/p&gt; &lt;pre class="prettyprint css"&gt;&lt;br /&gt;&lt;code class="language-css"&gt;&lt;br /&gt;.fader {&lt;br /&gt;    -moz-transition: opacity 0.7s linear;&lt;br /&gt;    -o-transition: opacity 0.7s linear;&lt;br /&gt;    -webkit-transition: opacity 0.7s linear;&lt;br /&gt;    transition: opacity 0.7s linear;&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;.fader.fadedOut {&lt;br /&gt;    opacity: 0;&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Note we have 2 CSS classes:&lt;/p&gt; &lt;ul&gt;&lt;li&gt;&lt;code&gt;fader&lt;/code&gt; - if this class is applied to an element then when the opacity of that element is changed it will be an animated change.  The duration of the transition and the timing function used are customisable - in this case it takes 0.7 seconds and is linear.&lt;/li&gt;&lt;li&gt;&lt;code&gt;fadedOut&lt;/code&gt; - when used in conjunction with &lt;code&gt;fader&lt;/code&gt; this class creates a fading in or fading out effect as it is removed or applied respectively.  (This relies upon the default value of opacity being 1.)&lt;/li&gt;&lt;/ul&gt; &lt;p&gt;Let's see it in action:&lt;/p&gt; &lt;iframe width="100%" height="200" src="http://jsfiddle.net/johnny_reilly/86amq/embedded/result,js,html,css" allowfullscreen="allowfullscreen" frameborder="0"&gt;&lt;/iframe&gt; &lt;p&gt;It goes without saying that one day in the not too distant future (I hope) we'll be able to leave behind the horrible world of vendor prefixes.  Then we'll be down to just the single &lt;code&gt;transition&lt;/code&gt; statement. One day...&lt;/p&gt; &lt;h4&gt;Now, a warning...&lt;/h4&gt; &lt;p&gt;Unfortunately the technique detailed above differs from &lt;a href="http://api.jquery.com/fadeIn/" target="_blank"&gt;&lt;code&gt;fadeIn&lt;/code&gt;&lt;/a&gt; and &lt;a href="http://api.jquery.com/fadeOut/" target="_blank"&gt;&lt;code&gt;fadeOut&lt;/code&gt;&lt;/a&gt; in one important way.  When the &lt;code&gt;fadeOut&lt;/code&gt; animation completes it sets removes the element from the flow of the DOM using &lt;code&gt;display: none&lt;/code&gt;.  However, display is not a property that can be animated and so you can't include this in your CSS transition.  If removing the element from the flow of the DOM is something you need then you'll need to bear this in mind.  If anyone has any suggestions for an nice way to approach this I'd love to hear from you.&lt;/p&gt; &lt;h4&gt;A halfway there solution to the &lt;code&gt;display: none&lt;/code&gt;&lt;/h4&gt; &lt;p&gt;Andrew Davey tweeted me the suggestion below:&lt;/p&gt; &lt;blockquote class="twitter-tweet" lang="en"&gt;&lt;p&gt;&lt;a href="https://twitter.com/johnny_reilly"&gt;@johnny_reilly&lt;/a&gt; Yep, transitions are sweet. You could use the transitionend event to remove the element from the DOM &lt;a href="http://t.co/Q1oWy3g8Lp"&gt;http://t.co/Q1oWy3g8Lp&lt;/a&gt;&lt;/p&gt;&amp;mdash; Andrew Davey (@andrewdavey) &lt;a href="https://twitter.com/andrewdavey/statuses/408545283606212608"&gt;December 5, 2013&lt;/a&gt;&lt;/blockquote&gt;&lt;script async src="//platform.twitter.com/widgets.js" charset="utf-8"&gt;&lt;/script&gt; &lt;p&gt;So I thought I'd give it a go.  However, whilst we've a &lt;code&gt;transitionend&lt;/code&gt; event to play with we don't have a corresponding &lt;code&gt;transitionstart&lt;/code&gt; or &lt;code&gt;transitionbegin&lt;/code&gt;.  So I tried this:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;$("#showHideButton").click(function(){&lt;br /&gt;    var $alertDiv = $("#alertDiv");&lt;br /&gt;    if ($alertDiv.hasClass("fadedOut")) {&lt;br /&gt;        $alertDiv.removeClass("fadedOut").css("display", "");&lt;br /&gt;    }&lt;br /&gt;    else {&lt;br /&gt;        $("#alertDiv").addClass("fadedOut");&lt;br /&gt;    }&lt;br /&gt;})&lt;br /&gt;&lt;br /&gt;$(document).on('webkitTransitionEnd transitionend oTransitionEnd', ".fader", &lt;br /&gt;    function (evnt) {&lt;br /&gt;        var $faded = $(evnt.target);&lt;br /&gt;        if ($faded.hasClass("fadedOut")) {&lt;br /&gt;            $faded.css("display", "none");&lt;br /&gt;        }&lt;br /&gt;});&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Essentially, on the &lt;code&gt;transitionend&lt;/code&gt; event &lt;code&gt;display: none&lt;/code&gt; is applied to the element in question. Groovy. In the absence of a &lt;code&gt;transitionstart&lt;/code&gt; or &lt;code&gt;transitionbegin&lt;/code&gt;, when removing the &lt;code&gt;fadeOut&lt;/code&gt; class I'm first manually clearing out the &lt;code&gt;display: none&lt;/code&gt;.  Whilst this works in terms of adding it back into the flow of the DOM it takes away all the &lt;code&gt;fadeIn&lt;/code&gt; gorgeousness.  So it's not quite the fully featured solution you might hope for. But it's a start.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1383251514627333099'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1383251514627333099'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2013/12/simple-fading-in-and-out-using-css-transitions.html' title='Simple fading in and out using CSS transitions and classes'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6102727490268694692</id><published>2013-11-26T07:30:00.001Z</published><updated>2021-03-04T18:20:25.420Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='Q'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='jQuery UI'/><category scheme='http://www.blogger.com/atom/ns#' term='promises'/><category scheme='http://www.blogger.com/atom/ns#' term='confirm'/><title type='text'>Rolling your own confirm mechanism using Promises and jQuery UI</title><content type='html'>&lt;p&gt;It is said that a picture speaks a thousand words.  So here's two:&lt;/p&gt; &lt;div class="separator"&gt;&lt;a href="http://4.bp.blogspot.com/-zZvqgKiP9CI/UpN7YtkFbnI/AAAAAAAAAe4/OUpA5uVpCl4/s1600/Ugly.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"&gt;&lt;img border="0" src="http://4.bp.blogspot.com/-zZvqgKiP9CI/UpN7YtkFbnI/AAAAAAAAAe4/OUpA5uVpCl4/s400/Ugly.png" /&gt;&lt;/a&gt;&lt;/div&gt; &lt;div class="separator"&gt;&lt;a href="http://4.bp.blogspot.com/-VVzJ7B0Uhys/UpN7vnX7diI/AAAAAAAAAe8/i3hlMT1ECB8/s1600/Pretty.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"&gt;&lt;img border="0" src="http://4.bp.blogspot.com/-VVzJ7B0Uhys/UpN7vnX7diI/AAAAAAAAAe8/i3hlMT1ECB8/s400/Pretty.png" /&gt;&lt;/a&gt;&lt;/div&gt; &lt;p&gt;That's right, we're here to talk about the &lt;a href="https://developer.mozilla.org/en-US/docs/Web/API/Window.confirm" target="_blank"&gt;confirm&lt;/a&gt; dialog. Or, more specifically, how we can make our own confirm dialog.&lt;/p&gt; &lt;p&gt;JavaScript in the browser has had the &lt;code&gt;window.confirm&lt;/code&gt; method for the longest time.  This method takes a string as an argument and displays it in the form of a dialog, giving the user the option to click on either an "OK" or a "Cancel" button.  If the user clicks "OK" the method returns &lt;code&gt;true&lt;/code&gt;, if the user clicks "Cancel" the method returns &lt;code&gt;false&lt;/code&gt;.&lt;/p&gt; &lt;p&gt;&lt;code&gt;window.confirm&lt;/code&gt; is wonderful in one way - it has a simple API which is easy to grok.  But regardless of the browser, &lt;code&gt;window.confirm&lt;/code&gt; is always as ugly as sin.  Look at the first picture in this blog post; hideous. Or, put more dispassionately, it's not terribly configurable; want to change the button text?  You can't.  Want to change the styling of the dialog?  You can't.  You get the picture.&lt;/p&gt; &lt;h4&gt;Making confirm 2.0&lt;/h4&gt; &lt;p&gt;&lt;a href="http://jqueryui.com/dialog/#modal-confirmation" target="_blank"&gt;jQuery UI's dialog&lt;/a&gt; has been around for a long time.  I've been using it for a long time.  But, if you look at the API, you'll see it works in a very different way to &lt;code&gt;window.confirm&lt;/code&gt; - basically it's all about the callbacks.  My intention was to create a mechanism which allowed me to prompt the user with jQuery UI's tried and tested dialog, but to expose it in a way that embraced the simplicity of the &lt;code&gt;window.confirm&lt;/code&gt; API.&lt;/p&gt; &lt;p&gt;How to do this?  Promises! To quote &lt;a href="http://martinfowler.com/bliki/JavascriptPromise.html" target="_blank"&gt;Martin Fowler&lt;/a&gt; (makes you look smart when you do that):&lt;/p&gt; &lt;blockquote&gt;&lt;em&gt;"In Javascript, promises are objects which represent the pending result of an asynchronous operation. You can use these to schedule further activity after the asynchronous operation has completed by supplying a callback."&lt;/em&gt;&lt;/blockquote&gt; &lt;p&gt;When we show our dialog we are in asynchronous land; waiting for the user to click "OK" or "Cancel".  When they do, we need to act on their response.  So if our custom confirm dialog returns a promise of a boolean (&lt;code&gt;true&lt;/code&gt; when the users click "OK", &lt;code&gt;false&lt;/code&gt; otherwise) then that should be exactly what we need.  I'm going to use &lt;a href="https://github.com/kriskowal/q" target="_blank"&gt;Q&lt;/a&gt; for promises. (Nothing particularly special about Q - it's one of many &lt;a href="https://github.com/promises-aplus/promises-spec/blob/master/implementations.md" target="_blank"&gt;Promises / A+&lt;/a&gt; compliant implementations available.)&lt;/p&gt; &lt;p&gt;Here's my custom confirm dialog:&lt;/p&gt; &lt;pre class="prettyprint js" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;/**&lt;br /&gt;  * Show a "confirm" dialog to the user (using jQuery UI's dialog)&lt;br /&gt;  *&lt;br /&gt;  * @param {string} message The message to display to the user&lt;br /&gt;  * @param {string} okButtonText OPTIONAL - The OK button text, defaults to "Yes"&lt;br /&gt;  * @param {string} cancelButtonText OPTIONAL - The Cancel button text, defaults to "No"&lt;br /&gt;  * @param {string} title OPTIONAL - The title of the dialog box, defaults to "Confirm..."&lt;br /&gt;  * @returns {Q.Promise&amp;lt;boolean&amp;gt;} A promise of a boolean value&lt;br /&gt;  */&lt;br /&gt;function confirmDialog(message, okButtonText, cancelButtonText, title) {&lt;br /&gt;    okButtonText = okButtonText || "Yes";&lt;br /&gt;    cancelButtonText = cancelButtonText || "No";&lt;br /&gt;    title = title || "Confirm...";&lt;br /&gt;&lt;br /&gt;    var deferred = Q.defer();&lt;br /&gt;    $('&amp;lt;div title="' + title + '"&amp;gt' + message + '&amp;lt;/div&amp;gt;').dialog({&lt;br /&gt;        modal: true,&lt;br /&gt;        buttons: [{&lt;br /&gt;            // The OK button&lt;br /&gt;            text: okButtonText,&lt;br /&gt;            click: function () {&lt;br /&gt;                // Resolve the promise as true indicating the user clicked "OK"&lt;br /&gt;                deferred.resolve(true);&lt;br /&gt;                $(this).dialog("close");&lt;br /&gt;            }&lt;br /&gt;        }, {&lt;br /&gt;            // The Cancel button&lt;br /&gt;            text: cancelButtonText,&lt;br /&gt;            click: function () {&lt;br /&gt;                $(this).dialog("close");&lt;br /&gt;            }&lt;br /&gt;        }],&lt;br /&gt;        close: function (event, ui) {&lt;br /&gt;            // Destroy the jQuery UI dialog and remove it from the DOM&lt;br /&gt;            $(this).dialog("destroy").remove();&lt;br /&gt;            &lt;br /&gt;            // If the promise has not yet been resolved (eg the user clicked the close icon) &lt;br /&gt;            // then resolve the promise as false indicating the user did *not* click "OK"&lt;br /&gt;            if (deferred.promise.isPending()) {&lt;br /&gt;                deferred.resolve(false);&lt;br /&gt;            }&lt;br /&gt;        }&lt;br /&gt;    });&lt;br /&gt;&lt;br /&gt;    return deferred.promise;&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;What's happening here?  Well first of all, if &lt;code&gt;okButtonText&lt;/code&gt;, &lt;code&gt;cancelButtonText&lt;/code&gt; or &lt;code&gt;title&lt;/code&gt; have false-y values then they are initialised to defaults.  Next, we create a deferred object with Q.  Then we create our modal dialog using jQuery UI.  There's a few things worth noting about this:&lt;/p&gt; &lt;ul&gt;&lt;li&gt;We're not dependent on the dialog markup being in our HTML from the off.  We create a brand new element which gets added to the DOM when the dialog is created.  (I draw attention to this as the jQuery UI dialog documentation doesn't mention that you can use this approach - and frankly I prefer it.)&lt;/li&gt;&lt;li&gt;The "OK" and "Cancel" buttons are initialised with the string values stored in &lt;code&gt;okButtonText&lt;/code&gt; and &lt;code&gt;cancelButtonText&lt;/code&gt;.  So by default, "Yes" and "No".&lt;/li&gt;&lt;li&gt;If the user clicks the "OK" button then the promise is resolved with a value of &lt;code&gt;true&lt;/code&gt;.&lt;/li&gt;&lt;li&gt;If the dialog closes and the promise has not been resolved then the promise is resolved with a value of &lt;code&gt;false&lt;/code&gt;.  This covers people clicking on the "Cancel" button as well as closing the dialog through other means.&lt;/li&gt;&lt;/ul&gt; &lt;p&gt;Finally we return the promise from our deferred object.&lt;/p&gt; &lt;h4&gt;Going from &lt;code&gt;window.confirm&lt;/code&gt; to &lt;code&gt;confirmDialog&lt;/code&gt;&lt;/h4&gt; &lt;p&gt;It's very simple to move from using &lt;code&gt;window.confirm&lt;/code&gt; to &lt;code&gt;confirmDialog&lt;/code&gt;.  Take this example:&lt;/p&gt; &lt;pre class="prettyprint js" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;if (window.confirm("Are you sure?")) {&lt;br /&gt;    // Do something&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Becomes:&lt;/p&gt; &lt;pre class="prettyprint js" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;confirmDialog("Are you sure?").then(function(confirmed) {&lt;br /&gt;    if (confirmed) {&lt;br /&gt;        // Do something&lt;br /&gt;    }&lt;br /&gt;});&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;There's no more to it than that.&lt;/p&gt; &lt;h4&gt;And finally a demo...&lt;/h4&gt; &lt;p&gt;With the JSFiddle below you can create your own custom dialogs and see the result of clicking on either the "OK" or "Cancel" buttons.&lt;/p&gt; &lt;iframe width="100%" height="500"  src="http://jsfiddle.net/johnny_reilly/ARWL5/embedded/result,js,html,css" allowfullscreen="allowfullscreen" frameborder="0"&gt;&lt;/iframe&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/6102727490268694692'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/6102727490268694692'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2013/11/rolling-your-own-confirm-mechanism.html' title='Rolling your own confirm mechanism using Promises and jQuery UI'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='http://4.bp.blogspot.com/-zZvqgKiP9CI/UpN7YtkFbnI/AAAAAAAAAe4/OUpA5uVpCl4/s72-c/Ugly.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1648902290227585883</id><published>2013-11-04T14:07:00.001Z</published><updated>2013-11-04T14:16:09.559Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='TypeScriptCompile'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='BuildAction'/><category scheme='http://www.blogger.com/atom/ns#' term='DefinitelyTyped'/><category scheme='http://www.blogger.com/atom/ns#' term='TypeScript'/><category scheme='http://www.blogger.com/atom/ns#' term='NuGet'/><title type='text'>TypeScript: Don't forget Build Action for Implicit Referencing...</title><content type='html'>&lt;p&gt;As part of the &lt;a href="https://typescript.codeplex.com/wikipage?title=Known%20breaking%20changes%20between%200.8%20and%200.9&amp;referringTitle=Documentation" target="_blank"&gt;known breaking changes between 0.9 and 0.9.1&lt;/a&gt; there was this subtle but significant switch:&lt;/p&gt; &lt;blockquote cite="https://typescript.codeplex.com/wikipage?title=Known%20breaking%20changes%20between%200.8%20and%200.9&amp;referringTitle=Documentation"&gt; &lt;p&gt;In Visual Studio, all TypeScript files in a project are considered to be referencing each other&lt;/p&gt; &lt;p&gt;&lt;em&gt;Description:&lt;/em&gt; Previously, all TypeScript files in a project had to reference each other explicitly. With 0.9.1, they now implicitly reference all other TypeScript files in the project. For existing projects that fit multiple projects into a single projects, these will now have to be separate projects.&lt;/p&gt; &lt;p&gt;&lt;em&gt;Reason:&lt;/em&gt; This greatly simplifies using TypeScript in the project context.&lt;/p&gt; &lt;/blockquote&gt; &lt;p&gt;Having been &lt;a href="https://typescript.codeplex.com/workitem/1471" target="_blank"&gt;initially resistant&lt;/a&gt; to this change I recently decided to give it a try.  That is to say I started pulling out the &lt;code&gt;/// &amp;lt;reference&lt;/code&gt;'s from my TypeScript files. However, to my surprise, pulling out these references stopped my TypeScript from compiling and killed my Intellisense. After wrestling with this for a couple of hours I finally &lt;a href="https://typescript.codeplex.com/workitem/1855" target="_blank"&gt;filed an issue on the TypeScript CodePlex site&lt;/a&gt;. (Because clearly the problem was with TypeScript and not how I was using it, right?)&lt;/p&gt; &lt;h4&gt;Wrong!&lt;/h4&gt; &lt;p&gt;When I looked through my typing files (*.d.ts) I found that, pretty much without exception, all had a Build Action of "Content" and not "TypeScriptCompile". I went through the project and switched the files over to being "TypeScriptCompile". This resolved the issue and I was then able to pull out the remaining &lt;code&gt;/// &amp;lt;reference&lt;/code&gt; comments from the codebase (though I did have to restart Visual Studio to get the Intellisense working).&lt;/p&gt; &lt;p&gt;Most, if not all, of the typing files had been pulled in from NuGet and are part of the &lt;a href="https://github.com/borisyankov/DefinitelyTyped" target="_blank"&gt;DefinitelyTyped&lt;/a&gt; project on GitHub. Unfortunately, at present, when TypeScript NuGet packages are added they are added without the "TypeScriptCompile" Build Action.  I was going to post an issue there and ask if it's possible for NuGet packages to pull in typings files as "TypeScriptCompile" from the off - fortunately a chap called Natan Vivo &lt;a href="https://github.com/borisyankov/DefinitelyTyped/issues/1138" target="_blank"&gt;already has&lt;/a&gt;.&lt;/p&gt; &lt;p&gt;So until this issue is resolved it's probably a good idea to check that your TypeScript files are set to the correct Build Action in your project.  And every time you upgrade your TypeScript NuGet packages double check that you still have the correct Build Action afterwards (and to get Intellisense working in VS 2012 at least you'll need to close and re-open the solution as well).&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1648902290227585883'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1648902290227585883'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2013/11/typescript-dont-forget-build-action-for-implicit-referencing.html' title='TypeScript: Don&apos;t forget Build Action for Implicit Referencing...'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5167275536572869716</id><published>2013-10-30T17:24:00.001Z</published><updated>2021-03-14T05:19:34.363Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='TFS'/><category scheme='http://www.blogger.com/atom/ns#' term='TypeScript'/><category scheme='http://www.blogger.com/atom/ns#' term='Build Server'/><category scheme='http://www.blogger.com/atom/ns#' term='Continuous Integration'/><title type='text'>Getting TypeScript Compile-on-Save and Continuous Integration to play nice</title><content type='html'>&lt;p&gt;Well sort of...  Perhaps this post should more accurately called "How to get CI to ignore your TypeScript whilst Visual Studio still compiles it..."&lt;/p&gt; &lt;h4&gt;Once there was Web Essentials&lt;/h4&gt; &lt;p&gt;When I first started using TypeScript, I was using it in combination with Web Essentials.  Those were happy days. I saved my TS file and Web Essentials would kick off TypeScript compilation. Ah bliss.  But the good times couldn't last forever and sure enough when version 3.0 of Web Essentials shipped it &lt;a href="http://madskristensen.net/post/Web-Essentials-2013-Where-is-the-TypeScript-support" target="_blank"&gt;pulled support for TypeScript&lt;/a&gt;.&lt;/p&gt; &lt;p&gt;This made me, &lt;a href="https://typescript.codeplex.com/workitem/1616" target="_blank"&gt;and others&lt;/a&gt;, very sad.  Essentially we were given the choice between sticking with an old version of Web Essentials (2.9 - the last release before 3.0) and keeping our Compile-on-Save *&lt;strong&gt;or&lt;/strong&gt;* keeping with the latest version of Web Essentials and losing it.  And since I understood that newer versions of TypeScript had differences in the compiler flags which slightly broke compatibility with WE 2.9 the latter choice seemed the most sensible...&lt;/p&gt; &lt;h4&gt;But there is still Compile on Save hope!&lt;/h4&gt; &lt;p&gt;The information was that we need not lose our Compile on Save.  We just need to follow the instructions &lt;a href="https://typescript.codeplex.com/wikipage?title=Compile-on-Save" target="_blank"&gt;here&lt;/a&gt;.  Or to quote them:  &lt;blockquote&gt;&lt;p&gt;Then additionally add (or replace if you had an older PreBuild action for TypeScript) the following at the end of your project file to include TypeScript compilation in your project.&lt;/p&gt; &lt;p&gt;...&lt;/p&gt; &lt;p&gt;For C#-style projects (.csproj):&lt;/p&gt; &lt;pre class="prettyprint xml" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-xml"&gt;&lt;br /&gt;  &amp;lt;PropertyGroup Condition="'$(Configuration)' == 'Debug'"&amp;gt;&lt;br /&gt;    &amp;lt;TypeScriptTarget&amp;gt;ES5&amp;lt;/TypeScriptTarget&amp;gt;&lt;br /&gt;    &amp;lt;TypeScriptIncludeComments&amp;gt;true&amp;lt;/TypeScriptIncludeComments&amp;gt;&lt;br /&gt;    &amp;lt;TypeScriptSourceMap&amp;gt;true&amp;lt;/TypeScriptSourceMap&amp;gt;&lt;br /&gt;  &amp;lt;/PropertyGroup&amp;gt;&lt;br /&gt;  &amp;lt;PropertyGroup Condition="'$(Configuration)' == 'Release'"&amp;gt;&lt;br /&gt;    &amp;lt;TypeScriptTarget&amp;gt;ES5&amp;lt;/TypeScriptTarget&amp;gt;&lt;br /&gt;    &amp;lt;TypeScriptIncludeComments&amp;gt;false&amp;lt;/TypeScriptIncludeComments&amp;gt;&lt;br /&gt;    &amp;lt;TypeScriptSourceMap&amp;gt;false&amp;lt;/TypeScriptSourceMap&amp;gt;&lt;br /&gt;  &amp;lt;/PropertyGroup&amp;gt;&lt;br /&gt;  &amp;lt;Import Project="$(MSBuildExtensionsPath32)\Microsoft\VisualStudio\v$(VisualStudioVersion)\TypeScript\Microsoft.TypeScript.targets" /&amp;gt;&lt;/code&gt;&lt;/pre&gt; &lt;/blockquote&gt; &lt;p&gt;I followed these instructions (well I had to tweak the &lt;code&gt;Import Project&lt;/code&gt; location) and I was in business again.  But I when I came to check my code into TFS I came unstuck.  The automated build kicked off and then, in short order, kicked me:&lt;/p&gt; &lt;blockquote&gt; &lt;pre&gt;&lt;br /&gt;&lt;code style="font-size: 0.85em"&gt;&lt;br /&gt;C:\Builds\1\MyApp\MyApp Continuous Integration\src\MyApp\MyApp.csproj (1520): The imported project "C:\Program Files (x86)\MSBuild\Microsoft\VisualStudio\v11.0\TypeScript\Microsoft.TypeScript.targets" was not found. Confirm that the path in the &lt;Import&gt; declaration is correct, and that the file exists on disk.&lt;br /&gt;C:\Builds\1\MyApp\MyApp Continuous Integration\src\MyApp\MyApp.csproj (1520): The imported project "C:\Program Files (x86)\MSBuild\Microsoft\VisualStudio\v11.0\TypeScript\Microsoft.TypeScript.targets" was not found. Confirm that the path in the &lt;Import&gt; declaration is correct, and that the file exists on disk.&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt;&lt;/blockquote&gt; &lt;p&gt;That's right, TypeScript wasn't installed on the build server. And since TypeScript was now part of the build process my builds were now failing. Ouch.&lt;/p&gt; &lt;h4&gt;So what now?&lt;/h4&gt; &lt;p&gt;I did a little digging and found &lt;a href="https://typescript.codeplex.com/workitem/1518" target="_blank"&gt;this issue report on the TypeScript CodePlex site&lt;/a&gt;. To quote the issue, it seemed there were 2 possible solutions to get continuous integration and typescript playing nice:&lt;/p&gt; &lt;ol&gt;&lt;li&gt;Install TypeScript on the build server&lt;/li&gt;&lt;li&gt;Copy the required files for Microsoft.TypeScript.targets to a different source-controlled folder and change the path references in the csproj file to this folder.&lt;/li&gt;&lt;/ol&gt; &lt;p&gt;#1 wasn't an option for us - we couldn't install on the build server.  And covering both #1 and #2, I wasn't particularly inclined to kick off builds on the build server since I was wary of &lt;a href="https://typescript.codeplex.com/workitem/1432" target="_blank"&gt;reported problems with memory leaks&lt;/a&gt; etc with the TS compiler.  I may feel differently later when TS is no longer in Alpha and has stabilised but it didn't seem like the right time.&lt;/p&gt; &lt;h4&gt;A solution&lt;/h4&gt; &lt;p&gt;So, to sum up, what I wanted was to be able to compile TypeScript in Visual Studio on my machine, and indeed in VS on the machine of anyone else working on the project.  But I *&lt;strong&gt;didn't&lt;/strong&gt;* want TypeScript compilation to be part of the build process on the server.&lt;/p&gt; &lt;p&gt;The solution in the end was pretty simple - I replaced the &lt;code&gt;.csproj&lt;/code&gt; changes with the code below:&lt;/p&gt; &lt;pre class="prettyprint xml" style="font-size: 0.85em"&gt;&lt;br /&gt;&lt;code class="language-xml"&gt;&lt;br /&gt;  &amp;lt;PropertyGroup Condition="'$(Configuration)' == 'Debug'"&amp;gt;&lt;br /&gt;    &amp;lt;TypeScriptTarget&amp;gt;ES5&amp;lt;/TypeScriptTarget&amp;gt;&lt;br /&gt;    &amp;lt;TypeScriptRemoveComments&amp;gt;false&amp;lt;/TypeScriptRemoveComments&amp;gt;&lt;br /&gt;    &amp;lt;TypeScriptSourceMap&amp;gt;false&amp;lt;/TypeScriptSourceMap&amp;gt;&lt;br /&gt;    &amp;lt;TypeScriptModuleKind&amp;gt;AMD&amp;lt;/TypeScriptModuleKind&amp;gt;&lt;br /&gt;    &amp;lt;TypeScriptNoImplicitAny&amp;gt;true&amp;lt;/TypeScriptNoImplicitAny&amp;gt;&lt;br /&gt;  &amp;lt;/PropertyGroup&amp;gt;&lt;br /&gt;  &amp;lt;PropertyGroup Condition="'$(Configuration)' == 'Release'"&amp;gt;&lt;br /&gt;    &amp;lt;TypeScriptTarget&amp;gt;ES5&amp;lt;/TypeScriptTarget&amp;gt;&lt;br /&gt;    &amp;lt;TypeScriptRemoveComments&amp;gt;false&amp;lt;/TypeScriptRemoveComments&amp;gt;&lt;br /&gt;    &amp;lt;TypeScriptSourceMap&amp;gt;false&amp;lt;/TypeScriptSourceMap&amp;gt;&lt;br /&gt;    &amp;lt;TypeScriptModuleKind&amp;gt;AMD&amp;lt;/TypeScriptModuleKind&amp;gt;&lt;br /&gt;    &amp;lt;TypeScriptNoImplicitAny&amp;gt;true&amp;lt;/TypeScriptNoImplicitAny&amp;gt;&lt;br /&gt;  &amp;lt;/PropertyGroup&amp;gt;&lt;br /&gt;  &amp;lt;Import Project="$(VSToolsPath)\TypeScript\Microsoft.TypeScript.targets" Condition="Exists('$(VSToolsPath)\TypeScript\Microsoft.TypeScript.targets')" /&amp;gt;&lt;/code&gt;&lt;/pre&gt; &lt;p&gt;What this does is enable TypeScript compilation *&lt;strong&gt;only&lt;/strong&gt;* if TypeScript is installed.  So when I'm busy developing with Visual Studio on my machine with the plugin installed I can compile TypeScript.  But when I check in the TypeScript compilation is *&lt;strong&gt;not&lt;/strong&gt;* performed on the build server. This is because TypeScript is not installed on the build server and we are only compiling if it is installed. (Just to completely labour the point.)&lt;/p&gt; &lt;h4&gt;Final thoughts&lt;/h4&gt; &lt;p&gt;I do consider this an interim solution.  As I mentioned earlier, when TypeScript has stabilised I think I'd like TS compilation to be part of the build process.  Like with any other code I think compiling on check-in to catch bugs early is an excellent idea.  But I think I'll wait until there's some clearer guidance on the topic from the TypeScript team before I take this step.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5167275536572869716'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5167275536572869716'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2013/10/getting-typescript-compile-on-save-and-continous-integration-to-play-nice.html' title='Getting TypeScript Compile-on-Save and Continuous Integration to play nice'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8214356388987585501</id><published>2013-10-04T06:00:00.001+01:00</published><updated>2021-03-04T18:18:40.916Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='migrating'/><category scheme='http://www.blogger.com/atom/ns#' term='jquery.validate.unobtrusive.js'/><category scheme='http://www.blogger.com/atom/ns#' term='getting started'/><category scheme='http://www.blogger.com/atom/ns#' term='jQuery.Validation.Unobtrusive.Native'/><category scheme='http://www.blogger.com/atom/ns#' term='jQuery Validation'/><title type='text'>Migrating from jquery.validate.unobtrusive.js to jQuery.Validation.Unobtrusive.Native</title><content type='html'>&lt;p&gt;So, you're looking at &lt;a href="https://github.com/johnnyreilly/jQuery.Validation.Unobtrusive.Native" target="_blank"&gt;jQuery.Validation.Unobtrusive.Native&lt;/a&gt;.  You're thinking to yourself "Yeah, I'd really like to use the native unobtrusive support in jQuery Validation.  But I've already got this app which is using &lt;a href="https://www.nuget.org/packages/jQuery.Validation.Unobtrusive/" target="_blank"&gt;jquery.validate.unobtrusive.js&lt;/a&gt; - actually how easy is switching over?"  Well I'm here to tell you that it's pretty straightforward - here's a walkthrough of how it might be done.&lt;/p&gt; &lt;h4&gt;I need something to migrate&lt;/h4&gt; &lt;p&gt;So let's File &gt; New Project ourselves a new MVC 4 application using the Internet Application template.  I've picked this template as I know it ships with account registration / login screens in place which make use of jquery.validate.unobtrusive.js.  To demo this just run the project, click the "Log in" link and then click the "Log in" button - you should see something like this:&lt;/p&gt; &lt;div class="separator" style="clear: both; text-align: center;"&gt;&lt;a href="http://1.bp.blogspot.com/-7JxyO2uaVow/Uk5373yDbaI/AAAAAAAAAdk/gD8h47ObQcg/s1600/BeforeLoginScreen.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"&gt;&lt;img border="0" src="http://1.bp.blogspot.com/-7JxyO2uaVow/Uk5373yDbaI/AAAAAAAAAdk/gD8h47ObQcg/s400/BeforeLoginScreen.png" /&gt;&lt;/a&gt;&lt;/div&gt; &lt;p&gt;What you've just witnessed is jquery.validate.unobtrusive.js doing its thing.  Both the &lt;code&gt;UserName&lt;/code&gt; and &lt;code&gt;Password&lt;/code&gt; properties on the &lt;code&gt;LoginModel&lt;/code&gt; are decorated with the &lt;code&gt;Required&lt;/code&gt; data annotation which, in the above scenario, causes the validation to be triggered on the client thanks to MVC rendering  data attributes in the HTML which jquery.validate.unobtrusive.js picks up on. The question is, how can we take the log in screen above and migrate it across to to using jQuery.Validation.Unobtrusive.Native?&lt;/p&gt; &lt;h4&gt;Hit me up NuGet!&lt;/h4&gt; &lt;p&gt;Time to dive into NuGet and install jQuery.Validation.Unobtrusive.Native.  We'll install the MVC 4 version using this command:&lt;/p&gt; &lt;div class="nuget-badge"&gt;    &lt;p&gt;&lt;code&gt;PM&amp;gt; Install-Package jQuery.Validation.Unobtrusive.Native.MVC4&lt;/code&gt;&lt;/p&gt;&lt;/div&gt; &lt;p&gt;What has this done to my project?  Well 2 things&lt;/p&gt; &lt;ol&gt;&lt;li&gt;It's upgraded jQuery Validation (&lt;a href="http://jqueryvalidation.org/" target="_blank"&gt;jquery.validate.js&lt;/a&gt;) from v1.10.0 (the version that is currently part of the MVC 4 template) to v1.11.1 (the latest and greatest jQuery Validation as of the time of writing)&lt;/li&gt;&lt;li&gt;It's added a reference to the jQuery.Validation.Unobtrusive.Native.MVC4 assembly, like so:&lt;/li&gt;&lt;/ol&gt; &lt;div class="separator" style="clear: both; text-align: center;"&gt;&lt;a href="http://3.bp.blogspot.com/-V-21V1Ypo3E/Uk583DTbegI/AAAAAAAAAd0/O0nv7w6kmew/s1600/NewReference.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"&gt;&lt;img border="0" src="http://3.bp.blogspot.com/-V-21V1Ypo3E/Uk583DTbegI/AAAAAAAAAd0/O0nv7w6kmew/s400/NewReference.png" /&gt;&lt;/a&gt;&lt;/div&gt; &lt;p&gt;In case you were wondering, doing this hasn't broken the existing jquery.validate.unobtrusive.js - if you head back to the Log in screen you'll still see the same behaviour as before.&lt;/p&gt; &lt;h4&gt;Migrating...&lt;/h4&gt; &lt;p&gt;We need to switch our TextBox and Password helpers over to using jQuery.Validation.Unobtrusive.Native, which we achieve by simply passing a second argument of &lt;code&gt;true&lt;/code&gt; to &lt;code&gt;useNativeUnobtrusiveAttributes&lt;/code&gt;.  So we go from this:&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;// ...&lt;br /&gt;@Html.TextBoxFor(m =&amp;gt; m.UserName)&lt;br /&gt;// ...&lt;br /&gt;@Html.PasswordFor(m =&amp;gt; m.Password)&lt;br /&gt;// ...&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;To this:&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;// ...&lt;br /&gt;@Html.TextBoxFor(m =&gt; m.UserName, true)&lt;br /&gt;// ...&lt;br /&gt;@Html.PasswordFor(m =&gt; m.Password, true)&lt;br /&gt;// ...&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;With these minor tweaks in place the natively supported jQuery Validation data attributes will be rendered into the textbox / password elements instead of the jquery.validate.unobtrusive.js ones.&lt;/p&gt; &lt;p&gt;Next lets do the JavaScript. If you take a look at the bottom of the &lt;code&gt;Login.cshtml&lt;/code&gt; view you'll see this:&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;@section Scripts {&lt;br /&gt;    @Scripts.Render("~/bundles/jqueryval")&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Which renders the following scripts:&lt;/p&gt; &lt;pre class="prettyprint html"&gt;&lt;br /&gt;&lt;code class="language-html"&gt;&lt;br /&gt;&amp;lt;script src="/Scripts/jquery.unobtrusive-ajax.js"&gt;&amp;lt;/script&amp;gt;&lt;br /&gt;&amp;lt;script src="/Scripts/jquery.validate.js"&gt;&amp;lt;/script&amp;gt;&lt;br /&gt;&amp;lt;script src="/Scripts/jquery.validate.unobtrusive.js"&gt;&amp;lt;/script&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;In our brave new world we're only going to need jquery.validate.js - so let's create ourselves a new bundle in &lt;code&gt;BundleConfig.cs&lt;/code&gt; which only contains that single file:&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;bundles.Add(new ScriptBundle("~/bundles/jqueryvalnative")&lt;br /&gt;    .Include("~/Scripts/jquery.validate.js"));&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt;  &lt;p&gt;To finish off our migrated screen we need to do 2 things.  First we need to switch over the &lt;code&gt;Login.cshtml&lt;/code&gt; view to only render the jquery.validate.js script (in the form of our new bundle).  Secondly, the other thing that jquery.validate.unobtrusive.js did was to trigger validation for the current form.  So we need to do that ourselves now.  So our finished Scripts section looks like this:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-html"&gt;&lt;br /&gt;@section Scripts {&lt;br /&gt;    @Scripts.Render("~/bundles/jqueryvalnative")&lt;br /&gt;    &amp;lt;script&amp;gt;&lt;br /&gt;        $("form").validate();&lt;br /&gt;    &amp;lt;/script&amp;gt;&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Which renders the following script:&lt;/p&gt; &lt;pre class="prettyprint html"&gt;&lt;br /&gt;&lt;code class="language-html"&gt;&lt;br /&gt;&amp;lt;script src="/Scripts/jquery.validate.js"&amp;gt;&amp;lt;/script&amp;gt;&lt;br /&gt;&amp;lt;script&amp;gt;&lt;br /&gt;    $("form").validate();&lt;br /&gt;&amp;lt;/script&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;And, pretty much, that's it.  If you run the app now and go to the Log in screen and try to log in without credentials you'll get this:&lt;/p&gt; &lt;div class="separator" style="clear: both; text-align: center;"&gt;&lt;a href="http://2.bp.blogspot.com/-nD3-3jW1_Yo/Uk7G5sTpsGI/AAAAAAAAAeE/NDNf4jqhJSk/s1600/AfterLoginScreen.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"&gt;&lt;img border="0" src="http://2.bp.blogspot.com/-nD3-3jW1_Yo/Uk7G5sTpsGI/AAAAAAAAAeE/NDNf4jqhJSk/s400/AfterLoginScreen.png" /&gt;&lt;/a&gt;&lt;/div&gt; &lt;p&gt;Which is functionally exactly the same as previously.  The eagle eyed will notice some styling differences but that's all it comes down to really; style.  And if you were so inclined you could easily style this up as you liked using CSS and the options you can pass to jQuery Validation (in fact a quick rummage through jquery.validate.unobtrusive.js should give you everything you need). &lt;/p&gt; &lt;h4&gt;Rounding off&lt;/h4&gt; &lt;p&gt;Before I sign off I'd like to illustrate how little we've had to change the code to start using jQuery.Validation.Unobtrusive.Native.  Just take a look at this code comparison:&lt;/p&gt; &lt;div class="separator" style="clear: both; text-align: center;"&gt;&lt;a href="http://2.bp.blogspot.com/-vnA84f1JXHw/Uk7HoDPGqMI/AAAAAAAAAeM/qZVlRak92_o/s1600/WhatsTheDifference.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"&gt;&lt;img border="0" src="http://2.bp.blogspot.com/-vnA84f1JXHw/Uk7HoDPGqMI/AAAAAAAAAeM/qZVlRak92_o/s400/WhatsTheDifference.png" /&gt;&lt;/a&gt;&lt;/div&gt; &lt;p&gt;As you see, it takes very little effort to migrate from one approach to the other.  And it's *&lt;strong&gt;your&lt;/strong&gt;* choice.  If you want to have one screen that uses jQuery.Validation.Unobtrusive.Native and one screen that uses jquery.validation.unobtrusive.js then you can!  Including jQuery.Validation.Unobtrusive.Native in your project gives you the &lt;strong&gt;option&lt;/strong&gt; to use it. It doesn't force you to, you can do so as you need to and when you want to.  It's down to you.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8214356388987585501'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8214356388987585501'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2013/10/migrating-from-jquery.validate.unobtrusive.js-to-jQuery.Validation.Unobtrusive.Native.html' title='Migrating from jquery.validate.unobtrusive.js to jQuery.Validation.Unobtrusive.Native'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='http://1.bp.blogspot.com/-7JxyO2uaVow/Uk5373yDbaI/AAAAAAAAAdk/gD8h47ObQcg/s72-c/BeforeLoginScreen.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3058899862945341056</id><published>2013-09-13T06:27:00.000+01:00</published><updated>2013-09-13T06:27:44.654+01:00</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Unobtrusive'/><category scheme='http://www.blogger.com/atom/ns#' term='Remote'/><category scheme='http://www.blogger.com/atom/ns#' term='jQuery Validation'/><title type='text'>jQuery Remote Validation - Can I pass additional parameters unobtrusively?</title><content type='html'>&lt;p&gt;Well, no.  Or at least that's a limitation of the library at present.  You can set up remote validation to be driven unobtrusively but if you want more data sent over the wire than the value of the element being validated then you're out of luck.  I was a little stuck with this recently and came up with a way to do this which required only But with a little tweaking &lt;/p&gt;         &lt;pre class="prettyprint html" style="font-size: 0.8em"&gt;&lt;br /&gt;&amp;lt;form action="/Demo/Remote" method="post"&amp;gt;&lt;br /&gt;    &amp;lt;div class="row"&amp;gt;&lt;br /&gt;        &amp;lt;input data-msg-remote="&amp;#39;SimpleErrorMessage&amp;#39; is invalid." &lt;br /&gt;        data-rule-remote='{"url":"/Demo/RemoteSimple"}' &lt;br /&gt;        id="SimpleErrorMessage" name="SimpleErrorMessage" &lt;br /&gt;        type="text" value="" /&amp;gt;&lt;br /&gt;    &amp;lt;/div&amp;gt;&lt;br /&gt;    &amp;lt;div class="row"&amp;gt;&lt;br /&gt;        &amp;lt;button type="submit" class="btn btn-default"&amp;gt;Submit&amp;lt;/button&amp;gt;&lt;br /&gt;        &amp;lt;button type="reset" class="btn btn-info"&amp;gt;Reset&amp;lt;/button&amp;gt;&lt;br /&gt;    &amp;lt;/div&amp;gt;&lt;br /&gt;&amp;lt;/form&amp;gt;&lt;br /&gt;        &lt;/pre&gt;          &lt;pre class="prettyprint html" style="font-size: 0.8em"&gt;&lt;br /&gt;&amp;lt;form action="/Demo/Remote" method="post"&amp;gt;&lt;br /&gt;    &amp;lt;div class="row"&amp;gt;&lt;br /&gt;        &amp;lt;input data-msg-remote="&amp;#39;SimpleErrorMessage&amp;#39; is invalid." &lt;br /&gt;        data-rule-remote='{"url":"/Demo/RemoteSimple","dataSelector":"form"}' &lt;br /&gt;        id="SimpleErrorMessage" name="SimpleErrorMessage" &lt;br /&gt;        type="text" value="" /&amp;gt;&lt;br /&gt;    &amp;lt;/div&amp;gt;&lt;br /&gt;    &amp;lt;div class="row"&amp;gt;&lt;br /&gt;        &amp;lt;button type="submit" class="btn btn-default"&amp;gt;Submit&amp;lt;/button&amp;gt;&lt;br /&gt;        &amp;lt;button type="reset" class="btn btn-info"&amp;gt;Reset&amp;lt;/button&amp;gt;&lt;br /&gt;    &amp;lt;/div&amp;gt;&lt;br /&gt;&amp;lt;/form&amp;gt;&lt;br /&gt;        &lt;/pre&gt; &lt;script src="https://gist.github.com/johnnyreilly/6546888.js?file=jquery.validate.unobtrusive-remote.js"&gt;&lt;/script&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3058899862945341056'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3058899862945341056'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5753576792954274953</id><published>2013-08-17T15:31:00.001+01:00</published><updated>2013-08-17T15:47:34.275+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Tooltip'/><category scheme='http://www.blogger.com/atom/ns#' term='Bootstrap'/><category scheme='http://www.blogger.com/atom/ns#' term='jQuery Validation'/><title type='text'>Using Bootstrap Tooltips to display jQuery Validation error messages</title><content type='html'>&lt;p&gt;I love jQuery Validation.  I was recently putting together a screen which had a lot of different bits of validation going on.  And the default jQuery Validation approach of displaying the validation messages next to the element being validated wasn't working for me.  That is to say, because of the amount of elements on the form, the appearance of validation messages was really making a mess of the presentation. So what to do?&lt;/p&gt; &lt;h4&gt;Tooltips to the rescue!&lt;/h4&gt; &lt;p&gt;I was chatting to &lt;a href="https://plus.google.com/u/0/116859810359377785616/posts" target="_blank"&gt;Marc Talary&lt;/a&gt; about this and he had the bright idea of using tooltips to display the error messages.  Tooltips would allow the existing presentation of the form to remain as is whilst still displaying the messages to the users.  Brilliant idea!&lt;/p&gt; &lt;p&gt;After a certain amount of fiddling I came up with a fairly solid mechanism for getting jQuery Validation to display error messages as tooltips which I'll share here.  It's worth saying that for the application that Marc and I were working on we already had &lt;a href="http://jqueryui.com/" target="_blank"&gt;jQuery UI&lt;/a&gt; in place and so we decided to use the &lt;a href="http://jqueryui.com/tooltip/" target="_blank"&gt;jQuery UI tooltip&lt;/a&gt;.  This example will use the &lt;a href="http://getbootstrap.com/javascript/#tooltips" target="_blank"&gt;Bootstrap tooltip&lt;/a&gt; instead.  As much as anything else this demonstrates that you could swap out the tooltip mechanism here with any of your choosing.&lt;/p&gt; &lt;iframe src="http://htmlpreview.github.io/?https://gist.github.com/johnnyreilly/5867188/raw/2543a12fbd5c0aaad1da6793b7a7437492be3baf/DemoTooltip.html" width="100%" height="350" style="border: solid grey 1px;"&gt;&lt;/iframe&gt; &lt;p&gt;Beautiful isn't it?  Now look at the source:&lt;/p&gt; &lt;script src="https://gist.github.com/johnnyreilly/5867188.js?file=DemoTooltip.html"&gt;&lt;/script&gt; &lt;p&gt;All the magic is in the JavaScript, specifically the &lt;code&gt;showErrors&lt;/code&gt; function that's passed as an option to jQuery Validation.  Enjoy!&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5753576792954274953'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5753576792954274953'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html' title='Using Bootstrap Tooltips to display jQuery Validation error messages'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1218207324190451073</id><published>2013-08-08T09:19:00.001+01:00</published><updated>2015-02-07T16:34:19.182Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Announcing jQuery Validation Unobtrusive Native...</title><content type='html'>&lt;p&gt;I've been busy working on an open source project called &lt;strong&gt;&lt;a href="http://github.com/johnnyreilly/jQuery.Validation.Unobtrusive.Native" target="_blank"&gt;jQuery Validation Unobtrusive Native&lt;/a&gt;&lt;/strong&gt;. &lt;a href="http://johnnyreilly.github.io/jQuery.Validation.Unobtrusive.Native/" target="_blank"&gt;To see it in action take a look here&lt;/a&gt;.&lt;/p&gt; &lt;h4&gt;A Little Background&lt;/h4&gt; &lt;p&gt;I noticed a little while ago that jQuery Validation was now providing native support for validation driven by HTML 5 data attributes.  As you may be aware, Microsoft shipped &lt;a href="http://bradwilson.typepad.com/blog/2010/10/mvc3-unobtrusive-validation.html" target="_blank"&gt;jquery.validate.unobtrusive.js&lt;/a&gt; back with MVC 3.  (&lt;a href="http://icanmakethiswork.blogspot.com/2012/08/jquery-unobtrusive-validation.html" target="_blank"&gt;I have written about it before.&lt;/a&gt;) It provided a way to apply data model validations to the client side using a combination of jQuery Validation and HTML 5 data attributes.&lt;/p&gt; &lt;p&gt;The principal of this was and is fantastic.  But since that time the jQuery Validation project has implemented its own support for driving validation unobtrusively (shipping with &lt;a href="http://jquery.bassistance.de/validate/changelog.txt" target="_blank"&gt;jQuery Validation 1.11.0&lt;/a&gt;).  I've been looking at a way to directly use the native support instead of jquery.validate.unobtrusive.js.&lt;/p&gt;   &lt;h4&gt;So... What is jQuery Validation Unobtrusive Native?&lt;/h4&gt; &lt;p&gt;jQuery Validation Unobtrusive Native is a collection of ASP.Net MVC HTML helper extensions. These make use of jQuery Validation's native support for validation driven by HTML 5 data attributes. The advantages of the native support over jquery.validate.unobtrusive.js are:&lt;/p&gt; &lt;ul&gt;    &lt;li&gt;Dynamically created form elements are parsed automatically.  jquery.validate.unobtrusive.js does not support this whilst jQuery Validation does. &lt;a href="http://johnnyreilly.github.io/jQuery.Validation.Unobtrusive.Native/AdvancedDemo/Knockout.html" target="_blank"&gt;Take a look at a demo using Knockout.&lt;/a&gt;&lt;/li&gt;    &lt;li&gt;jquery.validate.unobtrusive.js restricts how you use jQuery Validation.  If you want to use showErrors or something similar then you may find that you need to go native (or at least you may find that significantly easier than working with the jquery.validate.unobtrusive.js defaults)... &lt;/li&gt;    &lt;li&gt;Send less code to your browser, make your browser to do less work and even get a (marginal) performance benefit .&lt;/li&gt;&lt;/ul&gt; &lt;p&gt;This project intends to be a bridge between MVC's inbuilt support for driving validation from data attributes and jQuery Validation's native support for the same.  This is achieved by hooking into the MVC data attribute creation mechanism and using it to generate the data attributes natively supported by jQuery Validation.&lt;/p&gt; &lt;h4&gt;Future Plans&lt;/h4&gt; &lt;p&gt;So far the basic set of the HtmlHelpers and their associated unobtrusive mappings have been implemented.  If any have been missed then let me know.  As time goes by I intend to:&lt;/p&gt; &lt;ul&gt;    &lt;li&gt;fill in any missing gaps there may be&lt;/li&gt;    &lt;li&gt;maintain MVC 3, 4 (and when the time comes 5+) versions of this on Nuget&lt;/li&gt;    &lt;li&gt;not all data annotations generate client data attributes - if it makes sense I may look to implement some of these where it seems sensible. (eg the &lt;a href="http://msdn.microsoft.com/en-us/library/system.componentmodel.dataannotations.minlengthattribute.aspx" target="_blank"&gt;MinLengthAttribute&lt;/a&gt; annotation could be mapped to &lt;a href="http://jqueryvalidation.org/minlength-method/" target="_blank"&gt;minlength&lt;/a&gt; validation...)&lt;/li&gt;    &lt;li&gt;get the unit test coverage to a good level&lt;br /&gt;&lt;br /&gt;and finally (and perhaps most importantly)&lt;/li&gt;    &lt;li&gt;create some really useful &lt;a href="http://johnnyreilly.github.io/jQuery.Validation.Unobtrusive.Native/Demo.html" target="_blank"&gt;demos and documentation&lt;/a&gt;.&lt;/li&gt;&lt;/ul&gt; &lt;p&gt;Help is appreciated so feel free to pitch in!  You can find the project on GitHub &lt;a href="http://github.com/johnnyreilly/jQuery.Validation.Unobtrusive.Native" target="_blank"&gt;here&lt;/a&gt;...&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1218207324190451073'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1218207324190451073'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2013/08/announcing-jquery-validation.html' title='Announcing jQuery Validation Unobtrusive Native...'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2248662373356163262</id><published>2013-07-17T20:37:00.000+01:00</published><updated>2013-07-17T20:37:11.622+01:00</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>LI update</title><content type='html'>Providing application solutions for Pantheon. Primarily involved in the development of a semi-greenfield application to replace legacy systems. This application is intended to provide improved data quality, make data entry a faster and less arduous process and enable a better company-wide reporting platform.   Tasks / roles:  - The ongoing development of an ASP.NET MVC 4 line of business application using Knockout and TypeScript.  - Maintaining and evolving an existing SQL Server 2008 R2 database.  Communicating changes in a timely fashion to relevant stakeholders.  Using Entity Framework 5 for data access.  - Development and maintenance of unit tests.  Using Team Foundation Server to store user stories / backlog items and source code; ensuring that these are related for trackability. Using TFS for Continuous Integration purposes.  - Working using the Scrum / Agile framework.  Participating in the Scrum ceremonies (stand-ups / reviews / retrospectives etc).  Demoing the product to the business.  Working as part of the Scrum team with the Product Owner and Scrum Master to deliver value to the business.  - Performing code reviews to ensure knowledge is shared throughout the team and encourage consistent use of patterns and practices.  - Co-operating and collaborating with other teams in order that we can collectively deliver software in a coordinated fashion.  </content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2248662373356163262'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2248662373356163262'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3528895325491418415</id><published>2013-07-06T20:19:00.000+01:00</published><updated>2013-07-06T20:19:18.009+01:00</updated><category scheme='http://www.blogger.com/atom/ns#' term='Andrew Davey'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='TypeScript'/><category scheme='http://www.blogger.com/atom/ns#' term='javascript'/><category scheme='http://www.blogger.com/atom/ns#' term='cassette'/><category scheme='http://www.blogger.com/atom/ns#' term='Web Essentials'/><title type='text'>How I'm Using Cassette part 3:Cassette and TypeScript Integration</title><content type='html'>&lt;p&gt;The modern web is JavaScript.  There's no two ways about it.  HTML 5 has new CSS, new HTML but the most important aspect of it from an application development point of view is JavaScript.  It's the engine. Without it HTML 5 wouldn't be the exciting application platform that it is.  Half the posts on &lt;a href="https://news.ycombinator.com/" target="_blank"&gt;Hacker News&lt;/a&gt; would vanish.&lt;/p&gt; &lt;p&gt;It's easy to break a JavaScript application.  One false keypress and you can mysteriously turn a fully functioning app into toast.  And not know why. There's tools you can use to help yourself - &lt;a href="http://icanmakethiswork.blogspot.co.uk/2012/04/jshint-customising-your-hurt-feelings.html" target="_blank"&gt;JSHint / JSLint&lt;/a&gt; but whilst these make error detection a little easier it remains very easy to shoot yourself in the foot with JavaScript. Because of this I've come to really rather love &lt;a href="http://www.typescriptlang.org/" target="_blank"&gt;TypeScript&lt;/a&gt;.  If you didn't already know, TypeScript can be summed up as JavaScript with optional static typing.  It's a &lt;strong&gt;&lt;em&gt;superset&lt;/em&gt;&lt;/strong&gt; of JavaScript - JavaScript with go-faster stripes.  When run through the compiler TypeScript is &lt;a href="https://en.wikipedia.org/wiki/Source-to-source_compiler" target="_blank"&gt;transpiled&lt;/a&gt; into JavaScript.  And importantly, if you have bugs in your code, the compiler should catch them at this point and let you know.&lt;/p&gt; &lt;p&gt;Now very few of us are working on greenfield applications.  Most of us have existing applications to maintain and support.  Happily, TypeScript fits very well with this purely because TypeScript is a superset of JavaScript.  That is to say: all JavaScript is valid TypeScript in the same way that all CSS is valid &lt;a href="http://lesscss.org/" target="_blank"&gt;LESS&lt;/a&gt;. This means that you can take an existing &lt;code&gt;.js&lt;/code&gt; file, rename it to have a &lt;code&gt;.ts&lt;/code&gt; suffix, run the TypeScript compiler over it and out will pop your JavaScript file just as it was before.  You're then free to enrich your TypeScript file with the relevant type annotations at your own pace. Increasing the robustness of your codebase is a choice left to you.&lt;/p&gt; &lt;p&gt;The project I am working on has recently started to incorporate TypeScript.  It's an ASP.Net MVC 4 application which makes use of &lt;a href="http://knockoutjs.com/" target="_blank"&gt;Knockout&lt;/a&gt;. The reason we started to incorporate TypeScript is because certain parts of the app, particularly the Knockout parts, were becoming more complex.  This complexity wasn't really an issue when we were writing the relevant JavaScript.  However, when it came to refactoring and handing files from one team member to another we realised it was very easy to introduce bugs into the codebase, particularly around the JavaScript.  Hence TypeScript.&lt;/p&gt; &lt;h4&gt;Cassette and TypeScript&lt;/h4&gt; &lt;p&gt;Enough of the pre-amble.  The project was making use of Cassette for serving up its CSS and JavaScript.  Because Cassette rocks.  One of the reasons we use it is that we're making extensive use of &lt;a href="http://icanmakethiswork.blogspot.co.uk/2013/06/how-im-using-cassette-part-2.html" target="_blank"&gt;Cassette's ability to serve scripts in dependency order&lt;/a&gt;.  So if we were to move to using TypeScript it was important that TypeScript and Cassette would play well together.&lt;/p&gt; &lt;p&gt;I'm happy to report that Cassettes and TypeScript do work well together, but there are a few things that you need to get up and running.  Or, to be a little clearer, if you want to make use of Cassette's in-file Asset Referencing then you'll need to follow these steps.  If you don't need Asset Referencing then you'll be fine using Cassette with TypeScript generated JavaScript as is *&lt;strong&gt;provided&lt;/strong&gt;* you ensure the TypeScript compiler is not preserving comments in the generated JavaScript.&lt;/p&gt; &lt;h4&gt;The Fly in the Ointment: Asset References&lt;/h4&gt; &lt;p&gt;TypeScript is designed to allow you to break up your application into modules.  However, the referencing mechanism which allows you to reference one TypeScript file / module from another is exactly the same as the existing Visual Studio XML reference comments mechanism that was originally introduced to drive JavaScript Intellisense in Visual Studio.  To quote the &lt;a href="http://www.typescriptlang.org/Content/TypeScript%20Language%20Specification.pdf" target="_blank"&gt;TypeScript spec&lt;/a&gt;:&lt;/p&gt;   &lt;p&gt;&lt;em&gt;&lt;ul&gt;&lt;li&gt;A comment of the form /// &amp;lt;reference path=""/&amp;gt; adds a dependency on the source file  specified in the path argument. The path is resolved relative to the directory of the containing  source file.&lt;/li&gt;&lt;li&gt;An external import declaration that specifies a relative external module name (section 11.2.1)  resolves the name relative to the directory of the containing source file. If a source file with the  resulting path and file extension .ts exists, that file is added as a dependency. Otherwise, if a  source file with the resulting path and file extension .d.ts exists, that file is added as a  dependency.&lt;/li&gt;&lt;/ul&gt;&lt;/em&gt;&lt;/p&gt; &lt;p&gt;The problem is that &lt;a href="http://getcassette.net/documentation/v1/AssetReferences" target="_blank"&gt;Cassette *&lt;strong&gt;also&lt;/strong&gt;* supports Visual Studio XML reference comments to drive Asset References&lt;/a&gt;.  The upshot of this is, that Cassette will parse the &lt;code&gt;/// &amp;lt;reference path="*.ts"/&amp;gt;&lt;/code&gt;s and will attempt to serve up the TypeScript files in the browser... Calamity!&lt;/p&gt; &lt;h4&gt;Pulling the Fly from the Ointment&lt;/h4&gt; &lt;p&gt;Again I'm going to take the demo from last time (&lt;a href="https://github.com/johnnyreilly/CassetteDemo/tree/References" target="_blank"&gt;the References branch of my CassetteDemo project&lt;/a&gt;) and build on top of it.  First of all, we need to update the Cassette package.  This is because to get Cassette working with TypeScript you need to be running at least Cassette 2.1.  So let's let NuGet do it's thing:&lt;/p&gt; &lt;p&gt;&lt;code&gt;Update-Package Cassette.Aspnet&lt;/code&gt;&lt;/p&gt; &lt;p&gt;And whilst we're at it let's grab the jQuery TypeScript typings - we'll need them later:&lt;/p&gt; &lt;p&gt;&lt;code&gt;Install-Package jquery.TypeScript.DefinitelyTyped&lt;/code&gt;&lt;/p&gt; &lt;p&gt;Now we need to add a couple of classes to the project.  First of all this:&lt;/p&gt; &lt;script src="https://gist.github.com/johnnyreilly/5934706.js?file=ParseJavaScriptNotTypeScriptReferences.cs"&gt;&lt;/script&gt; &lt;p&gt;Which subclasses &lt;code&gt;ParseJavaScriptReferences&lt;/code&gt; and ensures TypeScript files are excluded when JavaScript references are being parsed.  And to make sure that Cassette makes use of  &lt;code&gt;ParseJavaScriptNotTypeScriptReferences&lt;/code&gt; in place of &lt;code&gt;ParseJavaScriptReferences&lt;/code&gt; we need this:&lt;/p&gt; &lt;script src="https://gist.github.com/johnnyreilly/5934706.js?file=InsertIntoPipelineParseJavaScriptNotTypeScriptReferences.cs"&gt;&lt;/script&gt; &lt;p&gt;Now we're in a position to use TypeScript with Cassette.  To demonstrate this let's take the &lt;code&gt;Index.js&lt;/code&gt; and rename it to &lt;code&gt;Index.ts&lt;/code&gt;.  And now it's TypeScript.  However before it can compile it needs to know what jQuery is - so we drag in the jQuery typings from &lt;a href="http://github.com/borisyankov/DefinitelyTyped" target="_blank"&gt;Definitely Typed&lt;/a&gt;.  And now it can compile from this:&lt;/p&gt; &lt;script src="https://gist.github.com/johnnyreilly/5934706.js?file=Index.ts"&gt;&lt;/script&gt; &lt;p&gt;To this: (Please note that I get the TypeScript compiler to preserve my comments in order that I can continue to use Cassettes Asset Referencing)&lt;/p&gt; &lt;script src="https://gist.github.com/johnnyreilly/5934706.js?file=Index.js"&gt;&lt;/script&gt; &lt;p&gt;As you can see the output JavaScript has both the TypeScript and the Cassette references in place.  However thanks to &lt;code&gt;ParseJavaScriptNotTypeScriptReferences&lt;/code&gt; those TypeScript references will be ignored by Cassette.&lt;/p&gt; &lt;p&gt;So that's it - we're home free.  Before I finish off I'd like to say thanks to Cassette's &lt;a href="http://twitter.com/andrewdavey" target="_blank"&gt;Andrew Davey&lt;/a&gt; who &lt;a href="https://groups.google.com/forum/?fromgroups=#!topic/cassette/SM3Rxh48D7Q" target="_blank"&gt;set me on the right path&lt;/a&gt; when trying to work out how to do this.  A thousand thank yous Andrew!&lt;/p&gt; &lt;p&gt;And finally, again as last time you can see what I've done in this post by just looking at the repository on &lt;a href="https://github.com/johnnyreilly/CassetteDemo/tree/TypeScript" target="_blank"&gt;GitHub&lt;/a&gt;. The changes I made are on the TypeScript branch of that particular repository.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3528895325491418415'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3528895325491418415'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2013/07/how-im-using-cassette-part-3-typescript.html' title='How I&apos;m Using Cassette part 3:&lt;br /&gt;Cassette and TypeScript Integration'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2537929858771005565</id><published>2013-06-26T18:15:00.001+01:00</published><updated>2021-03-03T21:24:21.057Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='Native'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='jQuery Validate'/><category scheme='http://www.blogger.com/atom/ns#' term='Unobtrusive'/><title type='text'>jQuery Validate - Native Unobtrusive Validation Support!</title><content type='html'>&lt;p&gt;Did you know that jQuery Validate natively supports the use of &lt;a href="http://ejohn.org/blog/html-5-data-attributes/" target="_blank"&gt;HTML 5 data attributes&lt;/a&gt; to drive validation unobtrusively?  Neither did I - I haven't seen any documentation for it.  However, I was reading the &lt;a href="https://github.com/jzaefferer/jquery-validation/blob/master/test/index.html" target="_blank"&gt;jQuery Validate test suite&lt;/a&gt; and that's what I spotted being used in some of the tests.&lt;/p&gt; &lt;p&gt;I was quite keen to give it a try as I've found the Microsoft produced &lt;a href="http://nuget.org/packages/jQuery.Validation.Unobtrusive/" target="_blank"&gt;unobtrusive extensions&lt;/a&gt; both fantastic and frustrating in nearly equal measure.  Fantastic because they work and they're &lt;a href="http://icanmakethiswork.blogspot.co.uk/2012/08/jquery-unobtrusive-validation.html" target="_blank"&gt;integrated nicely with MVC&lt;/a&gt;.  Frustrating, because they don't allow you do all the things that jQuery Validate in the raw does.&lt;/p&gt; &lt;p&gt;So when I realised that there was native alternative available I was delighted.  Enough with the fine words - what we want is a demo:&lt;/p&gt; &lt;iframe src="http://htmlpreview.github.io/?http://gist.github.com/johnnyreilly/5867188/raw/272b1b42f4773fe6df843550b3e3d457013522a8/Demo.html" width="100%" height="575" style="border: solid grey 1px;"&gt;&lt;/iframe&gt; &lt;p&gt;Not particularly exciting?  Not noticably different to any other jQuery Validate demo you've ever seen?  Fair enough.  Now look at the source:&lt;/p&gt; &lt;script src="https://gist.github.com/johnnyreilly/5867188.js?file=Demo.html"&gt;&lt;/script&gt; &lt;p&gt;Do you see what I see?  Data attributes (both &lt;code&gt;data-rule-*&lt;/code&gt; and  &lt;code&gt;data-msg-*&lt;/code&gt;s) being used to drive the validation unobtrusively!  And if you look at the JavaScript files referenced you will see *&lt;strong&gt;no sign&lt;/strong&gt;* of &lt;code&gt;jquery.validate.unobtrusive.js&lt;/code&gt; - this is all raw jQuery Validate.  Nothing else.&lt;/p&gt; &lt;h4&gt;Why is this useful?&lt;/h4&gt; &lt;p&gt;First of all, I'm of the opinion that it makes intuitive sense to have the validation information relevant to various DOM elements stored directly with those DOM elements.  There will be occasions where you may not want to use this approach but, in the main, I think it's very sensible.  It saves you bouncing back and forth between your HTML and your JavaScript and it means when you read the HTML you know there and then what validation applies to your form.&lt;/p&gt; &lt;p&gt;I think this particularly applies when it comes to adding elements to the DOM dynamically.  If I use data attributes to drive my validation and I dynamically add elements then jQuery Validate will parse the validation rules for me.  I won't have to subsequently apply validation to those new elements once they've been added to the DOM.  1 step instead of 2.  It makes for simpler code and that's always a win.&lt;/p&gt; &lt;h4&gt;Wrapping up&lt;/h4&gt; &lt;p&gt;For myself I'm in the early stages of experimenting with this but I thought it might be good to get something out there to show how this works.  If anyone knows of any official documentation for this please do let me know - I'd love to have a read of it.  Maybe it's been out there all along and it's just my Googling powers are inadequate.&lt;/p&gt; &lt;h4&gt;Update 09/08/2012&lt;/h4&gt; &lt;p&gt;If you're using ASP.Net MVC 3+ and this post has been of interest to you then you might want to take a look at &lt;a href="http://icanmakethiswork.blogspot.co.uk/2013/08/announcing-jquery-validation.html" target="_blank"&gt;this&lt;/a&gt;.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2537929858771005565'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2537929858771005565'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2013/06/jquery-validate-native-unobtrusive-validation.html' title='jQuery Validate - Native Unobtrusive Validation Support!'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3969527661757943742</id><published>2013-06-06T09:47:00.001+01:00</published><updated>2013-06-08T17:45:53.779+01:00</updated><category scheme='http://www.blogger.com/atom/ns#' term='script references'/><category scheme='http://www.blogger.com/atom/ns#' term='RequireJS'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='cassette'/><title type='text'>How I'm Using Cassette part 2:Get Cassette to Serve Scripts in Dependency Order</title><content type='html'>&lt;p&gt;&lt;a href="http://icanmakethiswork.blogspot.co.uk/2013/05/how-im-using-cassette.html" target="_blank"&gt;Last time&lt;/a&gt; I wrote about Cassette I was talking about how to generally get up and running.  How to use Cassette within an ASP.Net MVC project.  What I want to write about now is (in my eyes) the most useful feature of Cassette by a country mile.  This is Cassettes ability to ensure scripts are served in dependency order.&lt;/p&gt; &lt;h4&gt;Why does this matter?&lt;/h4&gt; &lt;p&gt;You might well ask.  If we go back 10 years or so then really this wasn't a problem.  No-one was doing a great deal with JavaScript.  And if they did anything it tended to be code snippets in amongst the HTML; nothing adventurous.  But unless you've had your head in the sand for the last 3 years then you will have clearly noticed that JavaScript is in rude health and being used for all kinds of things you'd never have imagined.  In fact some would have it that it's the &lt;a href="http://www.hanselman.com/blog/JavaScriptisAssemblyLanguagefortheWebPart2MadnessorjustInsanity.aspx" target="_blank"&gt;assembly language of the web&lt;/a&gt;.&lt;/p&gt; &lt;p&gt;For my part, I've been doing more and more with JavaScript.  And as I do more and more with it I seek to modularise my code; (&lt;a href="http://en.wikipedia.org/wiki/Separation_of_concerns" target="_blank"&gt;like any good developer would&lt;/a&gt;)  breaking it up into discrete areas of functionality.  I aim to only serve up the JavaScript that I need on a given page.  And that would be all well and good but for one of the languages shortcomings.  Modules.  JavaScript doesn't yet have a good module loading story to tell. (Apparently one's coming in &lt;a href="http://wiki.ecmascript.org/doku.php?id=harmony:modules" target="_blank"&gt;EcmaScript 6&lt;/a&gt;).  (I don't want to get diverted into this topic as it's a big area.  But if you're interested then you can read up a little on different approaches being used &lt;a href="http://requirejs.org/docs/whyamd.html#today" target="_black"&gt;here&lt;/a&gt;. The ongoing contest between RequireJS and CommonJS frankly makes me want to keep my distance for now.)&lt;/p&gt; &lt;h4&gt;It Depends&lt;/h4&gt; &lt;p&gt;Back to my point, JavaScripts native handling of script dependencies is non-existent.  It's real "here be dragons" territory.  If you serve up, for example, Slave.js that depends on things set up in Master.js before you've actually served up Master.js, well it's not a delightful debugging experience.  The errors tend be obscure and it's not always obvious what the correct ordering should be.&lt;/p&gt; &lt;p&gt;Naturally this creates something of a headache around my own JavaScript modules.  A certain amount of jiggery-pokery is required to ensure that scripts are served in the correct order so that they run as expected.  And as your application becomes more complicated / modular, the number of problems around this area increase exponentially.  It's &lt;strong&gt;really&lt;/strong&gt; tedious.  I don't want to be thinking about managing that as I'm developing - I want to be focused on solving the problem at hand.&lt;/p&gt; &lt;p&gt;In short, what I want to do is reference a script file somewhere in my server-side pipeline.  I could be in a view, a layout, a controller, a partial view, a HTML helper... - I just want to know that that script is going to turn up at the client in the right place in the HTML so it works.  Always.  And I don't want to have to think about it any further than that.&lt;/p&gt; &lt;h4&gt;Enter Cassette, riding a white horse&lt;/h4&gt; &lt;p&gt;And this is where Cassette takes the pain away.  To quote the documentation:&lt;/p&gt;    &lt;blockquote&gt;"&lt;em&gt;Some assets must be included in a page before others. For example, your code may use jQuery, so the jQuery script must be included first.  Cassette will sort all assets based on references they declare.&lt;/em&gt;"&lt;/blockquote&gt; &lt;p&gt;Just the ticket!&lt;/p&gt; &lt;h4&gt;Declaring References Server-Side&lt;/h4&gt; &lt;p&gt;What does this look like in reality?  Let's build on what I did last time to demonstrate how I make use of Asset References to ensure my scripts turn up in the order I require.&lt;/p&gt; &lt;p&gt;In my &lt;code&gt;_Layout.cshtml&lt;/code&gt; file I'm going to remove the following reference from the head of the file:&lt;/p&gt; &lt;p&gt;&lt;code&gt;Bundles.Reference("~/bundles/core");&lt;/code&gt;&lt;/p&gt; &lt;p&gt;I'm pulling this out of my layout page because it's presence means that &lt;strong&gt;every&lt;/strong&gt; page MVC serves up is also serving up jQuery and jQuery UI (which is what &lt;code&gt;~/bundles/core&lt;/code&gt; is). If a page doesn't actually make use of jQuery and / or jQuery UI then there's no point in doing this.&lt;/p&gt; &lt;p&gt;"&lt;em&gt;But wait!&lt;/em&gt;", I hear you cry, "&lt;em&gt;Haven't you just caused a bug with your reckless action?  I distinctly recall that the &lt;code&gt;Login.cshtml&lt;/code&gt; page has the following code in place:&lt;/em&gt;"&lt;/p&gt; &lt;p&gt;&lt;code&gt;Bundles.Reference("~/bundles/validate");&lt;/code&gt;&lt;/p&gt; &lt;p&gt;"&lt;em&gt;And now with your foolhardy, nay, reckless attitude to the &lt;code&gt;~/bundles/core&lt;/code&gt; bundle you've broken your Login screen.  How can jQuery Validation be expected to work if there's no jQuery there to extend?&lt;/em&gt;"&lt;/p&gt; &lt;p&gt;Well, I understand your concerns but really you needn't worry - Cassette's got my back.  Look closely at the code below:&lt;/p&gt; &lt;script src="https://gist.github.com/johnnyreilly/5693071.js?file=ReferencesValidateDependesOnCoreCassetteConfiguration.cs"&gt;&lt;/script&gt; &lt;p&gt;See it?  The &lt;code&gt;~/bundles/validate&lt;/code&gt; bundle declares a reference to the &lt;code&gt;~/bundles/core&lt;/code&gt; bundle.  The upshot of this is, that if you tell Cassette to reference &lt;code&gt;~/bundles/validate&lt;/code&gt; it will ensure that before it renders that bundle it first renders any bundles that bundle depends on (in this case the &lt;code&gt;~/bundles/core&lt;/code&gt; bundle).&lt;/p&gt; &lt;p&gt;This is a very simple demonstration of the feature but I can't underplay just how useful I find this.&lt;/p&gt; &lt;h4&gt;Declaring References in your JavaScript itself&lt;/h4&gt; &lt;p&gt;And the good news doesn't stop there.  Let's say you &lt;strong&gt;don't&lt;/strong&gt; want to maintain your references in a separate file.  You'd rather declare references inside your JavaScript files themselves.  Well - you can.  Cassette caters for this through the usage of &lt;a href="http://getcassette.net/documentation/v1/AssetReferences" target="_blank"&gt;Asset References&lt;/a&gt;.&lt;/p&gt; &lt;p&gt;Let's demo this.  First of all add the following file at this location in the project: &lt;code&gt;~/Scripts/Views/Home/Index.js&lt;/code&gt;&lt;/p&gt; &lt;script src="https://gist.github.com/johnnyreilly/5693071.js?file=Index.js"&gt;&lt;/script&gt; &lt;p&gt;The eagle-eyed amongst you will have noticed&lt;/p&gt; &lt;ol&gt;&lt;li&gt;I'm mirroring the MVC folder structure inside the Scripts directory.  (There's nothing special about that by the way - it's just a file structure I've come to find useful.  It's very easy to find the script associated with a View if the scripts share the same organisational approach as the Views.).&lt;/li&gt;&lt;li&gt;The purpose of the script is very simple, it fades out the main body of the screen, re-writes the HTML in that tag and then fades back in.  It's purpose is just to do something that is obvious to the user - so they can see the evidence of JavaScript executing.&lt;/li&gt;&lt;li&gt;Lastly and most importantly, do you notice that &lt;code&gt;// @reference ~/bundles/core&lt;/code&gt; is the first line of the file?  This is our script reference.  It's this that Cassette will be reading to pick up references.&lt;/li&gt;&lt;/ol&gt; &lt;p&gt;To make sure Cassette is picking up our brand new file let's take a look at &lt;code&gt;CassetteConfiguration.cs&lt;/code&gt; and uncomment the line of code below:&lt;/p&gt; &lt;p&gt;&lt;code&gt;bundles.AddPerIndividualFile&lt;ScriptBundle&gt;("~/Scripts/Views");&lt;/code&gt;&lt;/p&gt; &lt;p&gt;With this in place Cassette will render out a bundle for each script in the Views subdirectory.  Let's see if it works.  Add the following reference to our new JavaScript file in &lt;code&gt;~/Views/Home/Index.cshtml&lt;/code&gt;:&lt;/p&gt; &lt;p&gt;&lt;code&gt;Bundles.Reference("~/Scripts/Views/Home/Index.js");&lt;/code&gt;&lt;/p&gt; &lt;p&gt;If you browse to the home page of the application this is what you should now see:&lt;/p&gt; &lt;a href="http://2.bp.blogspot.com/-tGZTEhhkGz8/Ua7xlgl3n5I/AAAAAAAAAcs/miNZsysrJeY/s1600/Index.js.png" imageanchor="1" &gt;&lt;img border="0" src="http://2.bp.blogspot.com/-tGZTEhhkGz8/Ua7xlgl3n5I/AAAAAAAAAcs/miNZsysrJeY/s320/Index.js.png" /&gt;&lt;/a&gt; &lt;p&gt;What this means is, &lt;code&gt;Index.js&lt;/code&gt; was served up by Cassette.  And more importantly before &lt;code&gt;Index.js&lt;/code&gt; was served the referenced &lt;code&gt;~/bundles/core&lt;/code&gt; was served too. &lt;/p&gt; &lt;h4&gt;Avoiding the Gotcha&lt;/h4&gt; &lt;p&gt;There is a gotcha which I've discovered whilst using Cassette's Asset References.  Strictly speaking it's a Visual Studio gotcha rather than a Cassette gotcha.  It concerns Cassette's support for Visual Studio XML style reference comments.  In the example above I could have written this:&lt;/p&gt; &lt;p&gt;&lt;code&gt;/// &amp;lt;reference path="~/bundles/core" /&amp;gt;&lt;/code&gt;&lt;/p&gt; &lt;p&gt;Instead of this:&lt;/p&gt; &lt;p&gt;&lt;code&gt;// @reference ~/bundles/core&lt;/code&gt;&lt;/p&gt; &lt;p&gt;It would fulfil exactly the same purpose and would work identically.  But there's a problem.  Using Visual Studio XML style reference comments to refer to Cassette bundles appears to trash the Visual Studios JavaScript Intellisense.  You'll lose the Intellisense that's driven by &lt;code&gt;~/Scripts/_references.js&lt;/code&gt; in VS 2012.  So if you value your Intellisense (and I do) my advice is to stick to using the standard Cassette references style instead.&lt;/p&gt; &lt;h4&gt;Go Forth and Reference&lt;/h4&gt; &lt;p&gt;There is also support in Cassette for CSS referencing (as well as other types of referencing relating to LESS and even CoffeeScript).  I haven't made use of CSS referencing myself as, in stark contrast to my JS, my CSS is generally one bundle of styles which I'm happy to be rendered on each page. But it's nice to know the option is there if I wanted it.&lt;/p&gt; &lt;p&gt;Finally, as last time you can see what I've done in this post by just looking at the repository on &lt;a href="https://github.com/johnnyreilly/CassetteDemo/tree/References" target="_blank"&gt;GitHub&lt;/a&gt;.  The changes I made are on the References branch of that particular repository.&lt;/p&gt; &lt;!-- I don't want to serve up a monster JavaScript payload with each screen refresh.  Quite besides anything else, if I did that each screen refresh would be slower as more JavaScript was served up and parsed - the UX would suffer.  I don't want that.  I want *&lt;strong&gt;performance&lt;/strong&gt;*! --&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3969527661757943742'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3969527661757943742'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2013/06/how-im-using-cassette-part-2.html' title='How I&apos;m Using Cassette part 2:&lt;br /&gt;Get Cassette to Serve Scripts in Dependency Order'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='http://2.bp.blogspot.com/-tGZTEhhkGz8/Ua7xlgl3n5I/AAAAAAAAAcs/miNZsysrJeY/s72-c/Index.js.png' height='72' width='72'/><georss:featurename>Santa Ponsa, Balearic Islands, Spain</georss:featurename><georss:point>39.5048 2.469349999999963</georss:point><georss:box>39.455795 2.388668999999963 39.553805000000004 2.5500309999999633</georss:box></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2156290614716447411</id><published>2013-05-31T09:56:00.000+01:00</published><updated>2013-05-31T09:56:00.949+01:00</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>isDirty.  It's Dirty Sometimes</title><content type='html'>I found this really useful for change tracking.  The one difference I made in the way I used this was when dealing with nested structures.  (In my case a view model containing an observable array, each item of which contained 5 models on each of which I was performing change tracking.)  For reasons I never fully came to understand to my satisfaction, using the approach outlined above left me with an isDirty property on my objects when I used ko.toJS after unwrapping my nested structures.  To get round this, rather than using a computed property I created my dirty flag as private to the model like this:          var dirtyFlag = new ko.DirtyFlag(self);  And used a standard function like this for its access:          self.isDirty = function () {             return dirtyFlag().isDirty();         };  Which meant isDirty did not appear.  Very frustrating so I thought Id share my findings.   http://jsfiddle.net/johnny_reilly/FQgLp/  </content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2156290614716447411'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2156290614716447411'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1901265555237124340</id><published>2013-05-04T00:03:00.001+01:00</published><updated>2021-03-05T17:50:00.351Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='asp.net mvc'/><category scheme='http://www.blogger.com/atom/ns#' term='Andrew Davey'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='cassette'/><title type='text'>How I'm Using Cassette part 1:Getting Up and Running</title><content type='html'>&lt;h4&gt;Backing into the light&lt;/h4&gt; &lt;p&gt;For a while now, I've been seeking a bulletproof way to handle the following scenarios... all at the same time in the context of an ASP.Net MVC application:&lt;/p&gt; &lt;ol&gt;&lt;li&gt;How to serve full-fat JavaScript in debug mode and minified in release mode&lt;/li&gt;&lt;li&gt;When debugging, ensure that the full-fat JS being served is definitely the latest version; and *&lt;strong&gt;not&lt;/strong&gt;* from the cache. (The time I've wasted due to &lt;a href="http://en.wikipedia.org/wiki/List_of_HTTP_status_codes#304" target="_blank"&gt;304's&lt;/a&gt;...)&lt;/li&gt;&lt;li&gt;How to add Javascript assets that need to be served up from any point in an ASP.Net MVC application (including views, layouts, partial views... even controllers if so desired) whilst preventing duplicate scripts from being served.&lt;/li&gt;&lt;li&gt;How to ensure that Javascript files are served up last to any web page to ensure a speedy feel to users (don't want JS blocking rendering).&lt;/li&gt;&lt;li&gt;And last but certainly not least the need to load Javascript files in dependency order. If &lt;code&gt;myView.js&lt;/code&gt; depends on jQuery then clearly &lt;code&gt;jQuery-latest.js&lt;/code&gt; needs to be served before &lt;code&gt;myView.js&lt;/code&gt;.&lt;/li&gt;&lt;/ol&gt; &lt;p&gt;Now the best, most comprehensive and solid looking solution to this problem has for some time seemed to me to be &lt;a href="http://aboutcode.net/" target="_blank"&gt;Andrew Davey's&lt;/a&gt; &lt;a href="http://getcassette.net/" target="_blank"&gt;Cassette&lt;/a&gt;. This addresses all my issues in one way or another, as well as bringing in a raft of other features (support for Coffeescript etc). &lt;/p&gt; &lt;p&gt;However, up until now I've slightly shied away from using Cassette as I was under the impression it had a large number of dependencies.  That doesn't appear to be the case at all.  I also had some vague notion that I could quite simply build my own solution to these problems making use of Microsoft's &lt;a href="http://nuget.org/packages/Microsoft.AspNet.Web.Optimization/1.0.0" target="_blank"&gt;Web Optimization&lt;/a&gt; which nicely handles my #1 problem above.  However, looking again at the documentation Cassette was promising to handle scenarios #1 - #5 without breaking sweat.  How could I ignore that?   I figured I should do the sensible thing and take another look at it.  And, lo and behold, when I started evaluating it again it seemed to be just what I needed.&lt;/p&gt; &lt;p&gt;With the minumum of fuss I was able to get an ASP.Net MVC 4 solution up and running, integrated with Cassette, which dealt with all my scenarios very nicely indeed.  I thought it might be good to write this up over a short series of posts and share what my finished code looks like. If you follow the steps I go through below it'll get you started using Cassette.  Or you could skip to the end of this post and look at the repo on GitHub. Here we go...&lt;/p&gt; &lt;h4&gt;Adding Cassette to a raw MVC 4 project&lt;/h4&gt; &lt;p&gt;Fire up Visual Studio and create a new MVC 4 project (I used the internet template to have some content in place).&lt;/p&gt; &lt;p&gt;Go to the Package Manager Console and key in "&lt;code&gt;Install-Package Cassette.Aspnet&lt;/code&gt;".  Cassette will install itself.&lt;/p&gt; &lt;p&gt;Now you've got Cassette in place you may as well pull out usage of Web Optimization as you're not going to need it any more.Be ruthless, delete App_Start/BundleConfig.cs and delete the line of code that references it in Global.asax.cs.  If you take the time to run the app now you'll see you've miraculously lost your CSS and your JavaScript.  The code referencing it is still in place but there's nothing for it to serve up.  Don't worry about that - we're going to come back and Cassette-ify things later on...&lt;/p&gt; &lt;p&gt;You'll also notice you now have a CassetteConfiguration.cs file in your project. Open it.  Replace the contents with this (I've just commented out the default code and implemented my own CSS and Script bundles based on what is available in the default template of an MVC 4 app):&lt;/p&gt; &lt;script src="https://gist.github.com/johnnyreilly/5393608.js?file=CassetteConfiguration.cs"&gt;&lt;/script&gt; &lt;p&gt;In the script above I've created 4 bundles, 1 stylesheet bundle and 3 JavaScript bundles - each of these is roughly equivalent to Web Optimization bundles that are part of the MVC 4 template:&lt;/p&gt; &lt;dl&gt;&lt;dt&gt;~/bundles/css&lt;/dt&gt;&lt;dd&gt;Our site CSS - this includes both our own CSS and the jQuery UI CSS as well.  This is the rough equivalent of the Web Optimization bundles &lt;em&gt;~/Content/css&lt;/em&gt; and &lt;em&gt;~/Content/themes/base/css&lt;/em&gt; brought together.&lt;/dd&gt;&lt;dt&gt;~/bundles/head&lt;/dt&gt;&lt;dd&gt;What scripts we want served in the head tag - Modernizr basically.  Do note the setting of the &lt;em&gt;PageLocation&lt;/em&gt; property - the purpose of this will become apparent later.  This is the direct equivalent of the Web Optimization bundle: &lt;em&gt;~/bundles/modernizr&lt;/em&gt;.&lt;/dd&gt;&lt;dt&gt;~/bundles/core&lt;/dt&gt;&lt;dd&gt;The scripts we want served on every page.  For this example project I've picked jQuery and jQuery UI.  This is the rough equivalent of the Web Optimization bundles &lt;em&gt;~/bundles/jquery&lt;/em&gt; and &lt;em&gt;~/bundles/jqueryui&lt;/em&gt; brought together.&lt;/dd&gt;&lt;dt&gt;~/bundles/validate&lt;/dt&gt;&lt;dd&gt;The validation scripts (that are dependent on the core scripts). This is the rough equivalent of the Web Optimization bundle: &lt;em&gt;~/bundles/jqueryval&lt;/em&gt;.&lt;/dd&gt;&lt;/dl&gt; &lt;p&gt;At this point we've set up Cassette in our project - although we're not making use of it yet.  If you want to double check that everything is working properly then you can fire up your project and browse to "Cassette.axd" in the root.  You should see something a bit like this:&lt;/p&gt; &lt;a href="http://1.bp.blogspot.com/-xM9iU6HjB7o/UWzjAN5EieI/AAAAAAAAAaA/EAXTTnD6vdY/s1600/CassetteScripts.png" imageanchor="1" &gt;&lt;img border="0" src="http://1.bp.blogspot.com/-xM9iU6HjB7o/UWzjAN5EieI/AAAAAAAAAaA/EAXTTnD6vdY/s320/CassetteScripts.png" /&gt;&lt;/a&gt; &lt;h4&gt;How Web Optimization and Cassette Differ&lt;/h4&gt; &lt;p&gt;If you're more familiar with the workings of Web Optimization than Cassette then it's probably worth taking a moment to appreciate an important distinction between the slightly different ways each works.&lt;/p&gt; &lt;p&gt;&lt;strong&gt;Web Optimization&lt;/strong&gt;&lt;/p&gt;&lt;ol&gt;  &lt;li&gt;Create bundles as desired.&lt;/li&gt;  &lt;li&gt;Serve up bundles and / or straight JavaScript files as you like within your MVC views / partial views / layouts. &lt;/li&gt;&lt;/ol&gt; &lt;p&gt;&lt;strong&gt;Cassette&lt;/strong&gt;&lt;/p&gt;&lt;ol&gt;  &lt;li&gt;Create bundles for *&lt;strong&gt;all&lt;/strong&gt;* JavaScript files you wish to serve up.  You may wish to create some bundles which consist of a number of a number of JavaScript files pushed together.  But for each individual file you wish to serve you also need to create an individual bundle. (Failure to do so may mean you fall prey to the "&lt;em&gt;Cannot find an asset bundle containing the path "~/Scripts/somePath.js".&lt;/em&gt;")&lt;/li&gt;  &lt;li&gt;Reference bundles and / or individual JavaScript files in their individual bundles as you like within your MVC views / partial views / layouts / controllers / HTML helpers... the list goes on!&lt;/li&gt;  &lt;li&gt;Render the referenced scripts to the page (typically just before the closing &lt;code&gt;body&lt;/code&gt; tag)&lt;/li&gt;&lt;/ol&gt; &lt;h4&gt;Making use of our Bundles&lt;/h4&gt; &lt;p&gt;Now we've created our bundles let's get the project serving up CSS and JavaScript using Cassette.  First the layout file.  Take the &lt;code&gt;_Layout.cshtml&lt;/code&gt; file from this:&lt;/p&gt; &lt;script src="https://gist.github.com/johnnyreilly/5393608.js?file=_LayoutBefore.cshtml"&gt;&lt;/script&gt; &lt;p&gt;To this:&lt;/p&gt; &lt;script src="https://gist.github.com/johnnyreilly/5393608.js?file=_LayoutAfter.cshtml"&gt;&lt;/script&gt; &lt;p&gt;And now let's take one of the views, &lt;code&gt;Login.cshtml&lt;/code&gt; and take it from this:&lt;/p&gt; &lt;script src="https://gist.github.com/johnnyreilly/5393608.js?file=LoginBefore.cshtml"&gt;&lt;/script&gt; &lt;p&gt;To this:&lt;/p&gt; &lt;script src="https://gist.github.com/johnnyreilly/5393608.js?file=LoginAfter.cshtml"&gt;&lt;/script&gt; &lt;p&gt;So now you should be up and running with Cassette.  If you want the code behind this then take I've put it on GitHub &lt;a href="https://github.com/johnnyreilly/CassetteDemo" target="_blank"&gt;here&lt;/a&gt;.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1901265555237124340'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1901265555237124340'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2013/05/how-im-using-cassette.html' title='How I&apos;m Using Cassette part 1:&lt;br /&gt;Getting Up and Running'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='http://1.bp.blogspot.com/-xM9iU6HjB7o/UWzjAN5EieI/AAAAAAAAAaA/EAXTTnD6vdY/s72-c/CassetteScripts.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2640325066855523743</id><published>2013-04-26T20:45:00.002+01:00</published><updated>2021-03-04T18:15:56.737Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='navigation animation'/><category scheme='http://www.blogger.com/atom/ns#' term='css load'/><category scheme='http://www.blogger.com/atom/ns#' term='UX'/><category scheme='http://www.blogger.com/atom/ns#' term='CSS animation'/><category scheme='http://www.blogger.com/atom/ns#' term='Modernizr'/><title type='text'>A navigation animation (for your users delectation)</title><content type='html'>&lt;h4&gt;The Vexation&lt;/h4&gt; &lt;p&gt;The current application I'm working on lives within an &lt;code&gt;iframe&lt;/code&gt;.  A side effect of that is that my users no longer get the visual feedback that they're used to as they navigate around the site. By "visual feedback" what I mean are the little visual tics that are displayed in the browser when you're in the process of navigating from one screen to the next.  Basically, these:&lt;/p&gt; &lt;div style="margin: 0 auto; width: 320px"&gt;&lt;a href="http://1.bp.blogspot.com/-x_8VXvW0w1M/UXpam8TtPQI/AAAAAAAAAbI/uVFFkL8uBAc/s1600/TheSpinCycleOfProgress.png" imageanchor="1" &gt;&lt;img border="0" src="http://1.bp.blogspot.com/-x_8VXvW0w1M/UXpam8TtPQI/AAAAAAAAAbI/uVFFkL8uBAc/s320/TheSpinCycleOfProgress.png" /&gt;&lt;br /&gt;The "spin cycle of progress" spinning at the top,&lt;br /&gt;the location the user is navigating too at the bottom...&lt;/a&gt;&lt;/div&gt; &lt;p&gt;When an application is nested in an &lt;code&gt;iframe&lt;/code&gt; it seems that these visual tics aren't propogated up to the top frame of the browser as the user navigates around.  Clicking on links results in a short lag whilst nothing appears to be happening and then, BANG!, a new page is rendered.  This is not a great user experience. There's nothing to indicate that the link has been clicked on and the browser is doing something. Well, not in Internet Explorer at least - Chrome (my browser of choice) appears to do just that.  But that's really by the by, the people using my app will be using the corporate browser, IE; so I need to think about them.&lt;/p&gt; &lt;p&gt;Now I'm fully aware that this is more in the region of nice-to-have rather than absolute necessity.  That said, my experience is that when users think an application isn't responding fast enough their action point is usually "click it again, and maybe once more for luck".  To prevent this from happening, I wanted to give the users back some kind of steer when they were in the process of navigation, &lt;code&gt;iframe&lt;/code&gt; or no &lt;code&gt;iframe&lt;/code&gt;.&lt;/p&gt; &lt;h4&gt;The Agreeable Resolution&lt;/h4&gt; &lt;p&gt;To that end, I've come up with something that I feel does the job, and does it well.  I've taken a CSS animation courtesy of the good folk at &lt;a href="http://cssload.net/" target="_blank"&gt;CSS Load&lt;/a&gt; and embedded it in the layout of my application.  This animation is hidden from view until the user navigates to another page.  At that point, the CSS animation appears in the header of the screen and remains in place until the new screen is rendered.  This is what it looks like:&lt;/p&gt; &lt;div style="margin: 0 auto; width: 320px"&gt;&lt;a href="http://2.bp.blogspot.com/-RaGwl1llrDM/UX4pEiUfGWI/AAAAAAAAAbo/jSZC0skiLfQ/s1600/NavigationAnimationAtWork.png" imageanchor="1" &gt;&lt;img border="0" src="http://2.bp.blogspot.com/-RaGwl1llrDM/UX4pEiUfGWI/AAAAAAAAAbo/jSZC0skiLfQ/s320/NavigationAnimationAtWork.png" /&gt;&lt;/a&gt;&lt;/div&gt; &lt;!-- &lt;p&gt;And because they haven't yet invented the animated screenshot here's what the CSS animation looks like in full flight:&lt;/p&gt; &lt;style&gt;#navigationAnimation {   margin: 7px;   clear: both; }   #circleG {   width: 46.666666666666664px;   height: 20px; }   .circleG {   background-color: #ffffff;   float: left;   height: 10px;   margin-left: 5px;   width: 10px;   -moz-border-radius: 7px;   -webkit-border-radius: 7px;   border-radius: 7px;   -moz-animation-name: bounce_circleG;   -moz-animation-duration: 0.6000000000000001s;   -moz-animation-iteration-count: infinite;   -moz-animation-direction: linear;   -webkit-animation-name: bounce_circleG;   -webkit-animation-duration: 0.6000000000000001s;   -webkit-animation-iteration-count: infinite;   -webkit-animation-direction: linear;   -ms-animation-name: bounce_circleG;   -ms-animation-duration: 0.6000000000000001s;   -ms-animation-iteration-count: infinite;   -ms-animation-direction: linear;   animation-name: bounce_circleG;   animation-duration: 0.6000000000000001s;   animation-iteration-count: infinite;   animation-direction: linear; }   #circleG_1 {   -moz-animation-delay: 0.12000000000000002s;   -webkit-animation-delay: 0.12000000000000002s;   -ms-animation-delay: 0.12000000000000002s;   animation-delay: 0.12000000000000002s; }   #circleG_2 {   -moz-animation-delay: 0.28s;   -webkit-animation-delay: 0.28s;   -ms-animation-delay: 0.28s;   animation-delay: 0.28s; }   #circleG_3 {   -moz-animation-delay: 0.36s;   -webkit-animation-delay: 0.36s;   -ms-animation-delay: 0.36s;   animation-delay: 0.36s; }   @-moz-keyframes bounce_circleG {   50% {     background-color: #000000;   } }   @-webkit-keyframes bounce_circleG {   50% {     background-color: #000000;   } }   @-ms-keyframes bounce_circleG {   50% {     background-color: #000000;   } }   @keyframes bounce_circleG {   50% {     background-color: #000000;   } }   &lt;/style&gt; &lt;div id="navigationAnimation"&gt;    &lt;div id="circleG"&gt;        &lt;div id="circleG_1" class="circleG"&gt;&lt;/div&gt;        &lt;div id="circleG_2" class="circleG"&gt;&lt;/div&gt;        &lt;div id="circleG_3" class="circleG"&gt;&lt;/div&gt;    &lt;/div&gt;&lt;/div&gt; &lt;p&gt;Beautiful don't you think?&lt;/p&gt;--&gt; &lt;h4&gt;How's that work then guv?&lt;/h4&gt; &lt;p&gt;You're no doubt dazzled by the glory of it all.  How was it accomplished?  Well, it was actually a great deal easier than you might think.  First of all we have the html:&lt;/p&gt; &lt;script src="https://gist.github.com/johnnyreilly/5466370.js?file=navigationAnimation.html"&gt;&lt;/script&gt; &lt;p&gt;Apart from the outer &lt;code&gt;div&lt;/code&gt; tag (#navigationAnimation) all of this is the HTML taken from &lt;a href="http://cssload.net/" target="_blank"&gt;CSS Load&lt;/a&gt;.  If you wanted to use a different navigation animation you could easily replace the inner HTML with something else instead.  Next up is the CSS, again courtesy of CSS Load (and it's this that turns this simple HTML into sumptuous animated goodness):&lt;/p&gt; &lt;script src="https://gist.github.com/johnnyreilly/5466370.js?file=navigationAnimation.css"&gt;&lt;/script&gt; &lt;p&gt;And finally we have the JavaScript which is responsible for showing animation when the user starts navigating:&lt;/p&gt; &lt;script src="https://gist.github.com/johnnyreilly/5466370.js?file=navigationAnimation.js"&gt;&lt;/script&gt; &lt;p&gt;It's helped along with a little jQuery here but this could easily be accomplished with vanilla JS if you fancied.  The approach works by hooking into the &lt;a href="https://developer.mozilla.org/en-US/docs/DOM/Mozilla_event_reference/beforeunload" target="_blank"&gt;beforeunload&lt;/a&gt; event that fires when "&lt;em&gt;the window, the document and its resources are about to be unloaded&lt;/em&gt;".  There's a little bit more to the functionality in the JavaScript abover which I go into in the PPS below.  Essentially that covers backwards compatibility with earlier versions of IE.&lt;/p&gt; &lt;p&gt;I've coded this up in a manner that lends itself to re-use.  I can imagine that you might also want to make use of the navigation animation if, for example, you had an expensive AJAX operation on a page and you didn't want the users to despair.  So the navigation animation could become a kind of a generic "I am doing something" animation instead - I leave it to your disgression.&lt;/p&gt; &lt;h4&gt;Oh, and a final PS&lt;/h4&gt; &lt;p&gt;I had initially planned to use an old school animated GIF instead of a CSS animation.  The thing that stopped me taking this course of action is that, to quote an &lt;a href="http://stackoverflow.com/a/780617/761388" target="_blank"&gt;answer on Stack Overflow&lt;/a&gt; "&lt;em&gt;IE assumes that the clicking of a link heralds a new navigation where the current page contents will be replaced. As part of the process for perparing for that it halts the code that animates the GIFs.&lt;/em&gt;".  So I needed animation that stayed animated.  And lo, there were CSS animations...&lt;/p&gt; &lt;h4&gt;Better make that a PPS - catering for IE 9 and earlier&lt;/h4&gt; &lt;p&gt;I spoke a touch too soon when I expounded on how CSS animations were going to get me out of a hole.  Unfortunately, and to my lasting regret, they aren't supported in IE 9.  And yes, at least for now that is what the users have.  To get round this I've delved a little bit further and discovered a frankly hacky way to make animated gifs stay animated after beforeunload has fired.  It works by rendering an animated gif to the screen when beforeunload is fired.  Why this works I couldn't say - but if you're interested to research more then take a look at &lt;a href="http://stackoverflow.com/a/1904931/761388" target="_blank"&gt;this answer on Stack Overflow&lt;/a&gt;.  In my case I've found an animated gif on &lt;a href="http://www.ajaxload.info/" target="_blank"&gt;AjaxLoad&lt;/a&gt; which looks pretty similar to the CSS animation:&lt;/p&gt; &lt;img border="0" src="http://4.bp.blogspot.com/-_9OgkLfflAg/UYEXn7dgByI/AAAAAAAAAb8/3Q33pAs6WeM/s320/navigationAnimation.gif" /&gt; &lt;p&gt;This is now saved away as &lt;code&gt;navigationAnimation.gif&lt;/code&gt; in the application.  The JavaScript uses Modernizr to detect if CSS animations are in play.  If they're not then the animated gif is rendered to the screen in place of the CSS animation HTML.  Ugly, but it seems to work well; I think this will work on IE 6 - 9.  The CSS animations will work on IE 10+.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2640325066855523743'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2640325066855523743'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2013/04/a-navigation-animation-for-your-users.html' title='A navigation animation (for your users delectation)'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='http://1.bp.blogspot.com/-x_8VXvW0w1M/UXpam8TtPQI/AAAAAAAAAbI/uVFFkL8uBAc/s72-c/TheSpinCycleOfProgress.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1971248112474064072</id><published>2013-04-19T15:56:00.000+01:00</published><updated>2013-04-19T15:56:10.773+01:00</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>log4net</title><content type='html'>Example Web.Config  &lt;?xml version="1.0"?&gt;&lt;!--   For more information on how to configure your ASP.NET application, please visit   http://go.microsoft.com/fwlink/?LinkId=152368   --&gt;&lt;configuration&gt;     &lt;configSections&gt;    &lt;section name="log4net" type="log4net.Config.Log4NetConfigurationSectionHandler, log4net"/&gt;  &lt;/configSections&gt;     &lt;log4net&gt;     &lt;appender name="RollingFileAppender" type="log4net.Appender.RollingFileAppender"&gt;      &lt;file type="log4net.Util.PatternString" value="..\\Logs\\Exception\\Exception.log" /&gt;      &lt;appendToFile value="true" /&gt;      &lt;rollingStyle value="Composite" /&gt;      &lt;datePattern value="_yyyy-MM-dd&amp;quot;.log&amp;quot;" /&gt;      &lt;maxSizeRollBackups value="10" /&gt;      &lt;maximumFileSize value="1MB" /&gt;      &lt;layout type="log4net.Layout.PatternLayout"&gt;        &lt;conversionPattern value="[%d{yyyy-MM-dd HH:mm:ss}] [%level] - %message%newline" /&gt;      &lt;/layout&gt;      &lt;threshold value="DEBUG"/&gt;      &lt;filter type="log4net.Filter.LevelRangeFilter"&gt;        &lt;levelMin value="DEBUG" /&gt;        &lt;levelMax value="ERROR" /&gt;      &lt;/filter&gt;    &lt;/appender&gt;     &lt;appender name="EventLogAppender" type="log4net.Appender.EventLogAppender" &gt;      &lt;applicationName value="Exception" /&gt;      &lt;layout type="log4net.Layout.PatternLayout"&gt;        &lt;conversionPattern value="[%date{yyyy-MM-dd HH:mm:ss}] [%level] - %message%newline" /&gt;      &lt;/layout&gt;      &lt;threshold value="WARN"/&gt;      &lt;filter type="log4net.Filter.LevelRangeFilter"&gt;        &lt;levelMin value="WARN" /&gt;        &lt;levelMax value="ERROR" /&gt;      &lt;/filter&gt;    &lt;/appender&gt;     &lt;root&gt;      &lt;level value="DEBUG" /&gt;      &lt;appender-ref ref="RollingFileAppender" /&gt;      &lt;appender-ref ref="EventLogAppender" /&gt;    &lt;/root&gt;  &lt;/log4net&gt;    &lt;/configuration&gt;          /// &lt;summary&gt;        /// Author      : John Reilly         /// Description : Get a log4net instance         /// &lt;/summary&gt;        /// &lt;returns&gt;&lt;/returns&gt;        public static ILog GetLogger()         {             //If _logger hasn't yet been initialised then create it             if (_logger == null)             {                 //Configure log4net if not already configured                 var configuredAlready = true;                 var logRepository = log4net.LogManager.GetRepository();                 if (!logRepository.Configured)                 {                     configuredAlready = false;                     log4net.Config.XmlConfigurator.Configure();                 }                  //Come up with a name for our logger eg "IRIS v1.0.4639.26853"                 var folderNames = AppDomain.CurrentDomain.SetupInformation.ApplicationBase.Split('\\');                 var loggerNamePrefix = (folderNames.Length &gt; 2)                     ? folderNames[folderNames.Length - 2]                     : AppDomain.CurrentDomain.SetupInformation.ApplicationBase; //If this lives is stored in the root of a drive (unlikely) then use the path for a name                 var loggerName = string.Format("{0} v{1}",                      loggerNamePrefix, //The path of the application executing                     System.Reflection.Assembly.GetExecutingAssembly().GetName().Version); //The version number for the version of Common.DLL that is being executed at present (all logged applications make use of Common.DLL)                  //Get our logger                 _logger = log4net.LogManager.GetLogger(loggerName);                 _logger.Info(string.Format("Logger {0} with this name: {1}", configuredAlready ? "retrieved" : "configured and retrieved", loggerName));             }              //Return instance             return _logger;         }  private readonly ILog _logger = CommonOperations.GetLogger();              Global.asax.cs   using System; using System.Collections.Generic; using System.Linq; using System.Web; using System.Web.Mvc; using System.Web.Routing; using System.Threading; using System.Globalization; using System.Configuration; using LNRCorporate.CommonWeb.Helpers; using LNRCorporate.CommonWeb.Session; using LNRCorporate.CommonWeb.Filters; using LNRCorporate.CommonWeb.ModelBinders; using HatfieldPhilips.IRIS.Models; using HatfieldPhilips.IRIS.Helpers; using HatfieldPhilips.IRIS.DomainClasses;  namespace HatfieldPhilips.IRIS {     // Note: For instructions on enabling IIS6 or IIS7 classic mode,      // visit http://go.microsoft.com/?LinkId=9394801      public class MvcApplication : System.Web.HttpApplication     {         public static void RegisterGlobalFilters(GlobalFilterCollection filters)         {             filters.Add(new log4netExceptionFilter()); //must be the first line             filters.Add(new HandleErrorAttribute());             filters.Add(new ViewBagCommonDataAttribute());         }          public static void RegisterRoutes(RouteCollection routes)         {             //A route that ends ".js" or ".css" should be ignored as they will be either view specific JS or CSS files             routes.IgnoreRoute("{resource}.axd/{*pathInfo}");             routes.IgnoreRoute("{file}.js");             routes.IgnoreRoute("{file}.css");              //Default Route             routes.MapRoute(                 "Default",                                                                // Route name                 "{controller}/{action}/{id}",                                             // URL with parameters                 new { controller = "Home", action = "Menu", id = UrlParameter.Optional }, // Parameter defaults                 new { action = "^((?!ShowError).)*" }             );              //Error route             routes.MapRoute("Error", "Home/{action}/{logException}/{errorMessage}",                 new { controller = "Home", errorMessage = UrlParameter.Optional }                 );                      }          protected void Application_Start()         {             DataAnnotationsModelValidatorProvider.AddImplicitRequiredAttributeForValueTypes = false;              AreaRegistration.RegisterAllAreas();             RegisterGlobalFilters(GlobalFilters.Filters);             RegisterRoutes(RouteTable.Routes);              //Configure log4net             log4net.Config.XmlConfigurator.Configure();             var log = GetLogger();             log.Info("Application starting....");         }          protected void Application_End()         {             var log = GetLogger();             log.Info("Application stopping....");         }          /// &lt;summary&gt;        /// Author      : John Reilly         /// Description : Using log4net to log and diagnose errors being thrown by the application         /// &lt;/summary&gt;        /// &lt;param name="sender"&gt;&lt;/param&gt;        /// &lt;param name="e"&gt;&lt;/param&gt;        protected void Application_Error(object sender, EventArgs e)          {             var log = GetLogger();             log.Error(Server.GetLastError());         }          protected void Session_Start()         {             var log = GetLogger();             log.Info(string.Format("Session starting for {0} ({1})", HttpContext.Current.User.Identity.Name, Session.SessionID));              SessionHandler.AddUserSession(Session.SessionID);         }          protected void Session_End()         {             var log = GetLogger();             log.Info(string.Format("Session stopping ({0})", Session.SessionID));              SessionHandler.RemoveUserSession(Session.SessionID);         }          #region Private          private static log4net.ILog GetLogger()         {             return log4net.LogManager.GetLogger(string.Format("{0} {1}", System.Reflection.Assembly.GetExecutingAssembly().GetName().Name, System.Reflection.Assembly.GetExecutingAssembly().GetName().Version.ToString()));         }          #endregion     } }  log4netExceptionFilter.cs:  using System; using System.Web; using System.Web.Mvc; using LNRCorporate.Common.Helpers;  namespace LNRCorporate.CommonWeb.Filters {     /// &lt;summary&gt;    /// Author       : John Reilly     /// Description  : ActionFilter which populates the ViewBag with common data (data used on all / most screens)     /// &lt;/summary&gt;    public class log4netExceptionFilter : IExceptionFilter     {         private readonly log4net.ILog _log = log4net.LogManager.GetLogger(string.Format("{0} {1}", System.Reflection.Assembly.GetExecutingAssembly().GetName().Name, System.Reflection.Assembly.GetExecutingAssembly().GetName().Version.ToString()));          public void OnException(ExceptionContext context)         {             _log.Error(context.Exception.GetExceptionDetails());         }     } }  HomeController.cs: (example of how used in controllers)  using System; using System.Collections.Generic; using System.Linq; using System.Web; using System.Web.Mvc; using LNRCorporate.CommonWeb.Controllers;  namespace HatfieldPhilips.IRIS.Controllers {     /// &lt;summary&gt;    /// Author      : John Reilly     /// Description : This is the front page of the application     /// &lt;/summary&gt;    public class HomeController : BaseController     {         #region Members / Constructors          private readonly log4net.ILog _log;          /// &lt;summary&gt;        /// Author      : John Reilly         /// Description : This default constructor news up the dependancies and passes them into our other Dependancy Injection         ///               constructor.  Unit tests will *never* call the default constructor - only the DI constructor         /// &lt;/summary&gt;        public HomeController()             : this(log4net.LogManager.GetLogger(string.Format("{0} {1}", System.Reflection.Assembly.GetExecutingAssembly().GetName().Name, System.Reflection.Assembly.GetExecutingAssembly().GetName().Version.ToString())))         {         }          /// &lt;summary&gt;        /// Author      : John Reilly         /// Description : Dependancy Injection constructor - this wires up dependancies whether they be real (when running)         ///               or fake / mock (when testing)         /// &lt;/summary&gt;        public HomeController(log4net.ILog log)             : base()         {             _log = log;         }          #endregion           [HttpGet]         public ViewResult Menu()         {             ViewBag.Title = "IRIS";                          return View();         }     } }  How to wire up in unit tests:   using System; using System.Text; using System.Collections.Generic; using System.Linq; using System.Web.Mvc; using Moq; using Microsoft.VisualStudio.TestTools.UnitTesting; using HatfieldPhilips.IRIS.DomainClasses; using HatfieldPhilips.IRIS.Models; using HatfieldPhilips.IRIS.Controllers; using HatfieldPhilips.IRIS.Helpers; using HatfieldPhilips.IRIS.Models.Domain; using HatfieldPhilips.IRIS.ViewModels; using IRISUnitTest.Helpers; using LNRCorporate.Common.Controllers;  namespace IRISUnitTest {     [TestClass]     public class ClientListCashManagmentUC_04d     {         private CashManagerController _controller;         private Mock&lt;IIRISUnitOfWork&gt; _unitOfWork;         private Mock&lt;DateHelper&gt; _dateHelper;         private Mock&lt;ConsolidatorHelper&gt; _consolidatorHelper;         private Mock&lt;ExcelHelper&gt; _excelHelper;         private Mock&lt;log4net.ILog&gt; _log;          [TestInitialize]         public void Init()         {             _unitOfWork = new Mock&lt;IIRISUnitOfWork&gt;();            //We are mocking the interface             _dateHelper = new Mock&lt;DateHelper&gt;();                 //We are mocking the object - possible because methods on it are virtual             _consolidatorHelper = new Mock&lt;ConsolidatorHelper&gt;(); //We are mocking the object - possible because methods on it are virtual             _excelHelper = new Mock&lt;ExcelHelper&gt;(); //We are mocking the object - possible because methods on it are virtual             _log = new Mock&lt;log4net.ILog&gt;();              _controller = new CashManagerController(_unitOfWork.Object, _consolidatorHelper.Object, _excelHelper.Object, _log.Object);             _controller.SetFakeControllerContext();         }          [TestMethod]         public void ClientListView_ShouldRenderDefaultView()         {             // ARRANGE             //_unitOfWork.GetClientResultsForPeriod method will always return an IQueryable&lt;ClientResult&gt;            //behind which are 2 rows of data             _unitOfWork.Setup(c =&gt; c.cashmanager_controls.GetClientResults())                        .Returns(new List&lt;ClientResult&gt;() {                             new ClientResult()                            {                                ClientControlId = 0,                                CashManagerControlId = 0,                                CashManagerReportStatusCode = "cash_mgr_rpt_approved",                                CashManagerReportStatus = "Cash Manager Approved",                                LenderId = 6,                                WaterfallsCount = 3,                                WaterfallsFinalisedCount = 0,                                WaterfallsUnfinalised = (new List&lt;string&gt; { "112001-S", "112001-S", "112001-S" }).AsQueryable()                            },                            new ClientResult()                            {                                ClientControlId = 0,                                CashManagerControlId = 0,                                CashManagerReportStatusCode = "cash_mgr_rpt_approved",                                CashManagerReportStatus = "Cash Manager Approved",                                LenderId = 5,                                WaterfallsCount = 0,                                WaterfallsFinalisedCount = 0,                                WaterfallsUnfinalised = (new List&lt;string&gt;()).AsQueryable()                            }                        }.AsQueryable());                          //_consolidatorHelper.GetLoanResults method will always return an IEnumerable&lt;ConsolidatorLoan&gt;            //behind which are 2 rows of data             _consolidatorHelper.Setup(c =&gt; c.GetLoanResults())                                .Returns(new List&lt;ConsolidatorLoan&gt; {                                    new ConsolidatorLoan()                                    {                                        Analyst = "Courtney Small",                                        AssetManager = "Courtney Small",                                        BNote = "Yes",                                        BorrowerName = "Ixistence SL",                                        ClientName = "EPIC - Royal Bank Of Scotland",                                        ClientShortName = "EPIC-RBS",                                        CurrentLoanBalance = 23721239.18,                                        DealManager = "Courtney Small",                                        DefaultStatus = "Performing",                                        ExistsInCRM = true,                                        Group = "LNR London BSA",                                        LenderId = 4,                                        LoanName = "CASPAR",                                        LoanNumber = "112001-S",                                        LoanServicingAnalyst = "Courtney Small",                                        OwnerTeamGroup = "London BSA Developers",                                        ReportingAnalyst = "Courtney Small",                                        ReportingLoanName = "EPIC (CASPAR) PLC",                                        ServicingType = "Primary",                                        Source = "Compass",                                        SourceId = 2,                                        TeamLeader = "Justin Buchner"                                    },                                    new ConsolidatorLoan()                                    {                                        Analyst = "Courtney Small",                                        AssetManager = "Courtney Small",                                        BNote = "No",                                        BorrowerName = "Ixistence SL",                                        ClientName = "IXIS Corporate &amp; Investment Bank",                                        ClientShortName = "IXIS",                                        CurrentLoanBalance = 53721239.18,                                        DealManager = "Courtney Small",                                        DefaultStatus = "Performing",                                        ExistsInCRM = true,                                        Group = "LNR London BSA",                                        LenderId = 6,                                        LoanName = "CHIANTI",                                        LoanNumber = "140002-S",                                        LoanServicingAnalyst = "Courtney Small",                                        OwnerTeamGroup = "London BSA Developers",                                        ReportingAnalyst = "Courtney Small",                                        ReportingLoanName = "CHIANTI",                                        ServicingType = "Sub",                                        Source = "Compass",                                        SourceId = 2,                                        TeamLeader = "Justin Buchner"                                    }                                }.AsEnumerable());              //_dateHelper.GetDateTimeFromYearAndQuarter method will always return 1st July 2012 when called             _dateHelper.Setup(d =&gt; d.GetDateTimeFromYearAndQuarter(It.IsAny&lt;int&gt;(), It.IsAny&lt;int&gt;()))                        .Returns(new DateTime(year: 2012, month: 7, day: 1));               // ACT             var result = _controller.ListClient();              // ASSERT             Assert.IsInstanceOfType(result, typeof(ViewResult), "It's not a ViewResult");             Assert.AreEqual("IRIS Loans List - Cash Management Client View", (string)_controller.ViewBag.Title, "ViewBag.Title invalid");             Assert.IsInstanceOfType(result.Model, typeof(ClientList[]), "The model is not an array of ClientListViewModels");             Assert.AreEqual(2, ((ClientList[])result.Model).Length, "Invalid number of items in our ClientList array");              //Test the first item in our array             var item = ((ClientList[])result.Model)[0];             Assert.AreEqual("tri_state_completed", item.CashManagerReportStatusCode);             Assert.AreEqual("Cash Manager Approved", item.CashManagerReportStatus);             Assert.AreEqual("EPIC - Royal Bank Of Scotland", item.ClientName);             Assert.AreEqual("Courtney Small", item.DealManager);             Assert.AreEqual(6, item.ClientControlId);             Assert.AreEqual("0 out of 3", item.WaterfallStatus);             Assert.AreEqual(3, item.WaterfallsUnfinalisedLoanNumbersAndNames.Length);             Assert.AreEqual("112001-S CASPAR", item.WaterfallsUnfinalisedLoanNumbersAndNames[0]);             Assert.AreEqual("112001-S CASPAR", item.WaterfallsUnfinalisedLoanNumbersAndNames[1]);             Assert.AreEqual("112001-S CASPAR", item.WaterfallsUnfinalisedLoanNumbersAndNames[2]);              //Test the second item in our array             item = ((ClientList[])result.Model)[1];             Assert.AreEqual("tri_state_completed", item.CashManagerReportStatusCode);             Assert.AreEqual("Cash Manager Approved", item.CashManagerReportStatus);             Assert.AreEqual("IXIS Corporate &amp; Investment Bank", item.ClientName);             Assert.AreEqual("Courtney Small", item.DealManager);             Assert.AreEqual(5, item.ClientControlId);             Assert.AreEqual("0 out of 0", item.WaterfallStatus);             Assert.AreEqual(0, item.WaterfallsUnfinalisedLoanNumbersAndNames.Length);         }     } }</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1971248112474064072'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1971248112474064072'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4158515250667393929</id><published>2013-04-17T14:11:00.002+01:00</published><updated>2013-04-17T14:11:22.319+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Visual Studio 2012'/><category scheme='http://www.blogger.com/atom/ns#' term='JavaScript debugging'/><category scheme='http://www.blogger.com/atom/ns#' term='IE 10'/><title type='text'>IE 10 Install Torches JavaScript Debugging in Visual Studio 2012 Through Auto Update (Probably)</title><content type='html'>&lt;p&gt;OK the title of this post is a little verbose.  I've just wasted a morning of my life trying to discover what happened to my ability to debug JavaScript in Visual Studio 2012. If you don't want to experience the same pain then read on...&lt;/p&gt; &lt;h4&gt;The Symptoms&lt;/h4&gt; &lt;ol&gt;&lt;li&gt;I'm not hitting my JavaScript breakpoints when I hit F5 in Visual Studio.&lt;/li&gt;&lt;li&gt;&lt;a href="http://msdn.microsoft.com/en-us/library/bb385621.aspx" target="_blank"&gt;Script Documents&lt;/a&gt; is missing from the Solution Explorer when I'm debugging in Visual Studio.&lt;/li&gt;&lt;/ol&gt; &lt;h4&gt;The Cure&lt;/h4&gt; &lt;p&gt;In the end, after a great deal of frustration, I happened upon &lt;a href="http://stackoverflow.com/a/15908391/761388" target="_blank"&gt;this answer&lt;/a&gt; on Stack Overflow.  It set me in the right direction.&lt;/p&gt; &lt;p&gt;In my "Browse With..." drop down in Visual Studio I was *&lt;strong&gt;not&lt;/strong&gt;* seeing this:&lt;/p&gt; &lt;a href="http://3.bp.blogspot.com/-iRgBxdxUrkU/UW6csypEd3I/AAAAAAAAAaY/rNK6N79GT6k/s1600/BrowseWith.png" imageanchor="1" &gt;&lt;img border="0" src="http://3.bp.blogspot.com/-iRgBxdxUrkU/UW6csypEd3I/AAAAAAAAAaY/rNK6N79GT6k/s320/BrowseWith.png" /&gt;&lt;/a&gt; &lt;p&gt;I was seeing exactly the same as this list but with &lt;strong&gt;TWO&lt;/strong&gt; instances of Internet Explorer in the list instead of one.  Odd, I know.&lt;/p&gt; &lt;p&gt;I fixed this up by selecting Google Chrome as my target instead of IE, running it and then setting it back to IE.  And interestingly, when I went to set it back to IE there was only one instance of Internet Explorer in the list again.&lt;/p&gt; &lt;h4&gt;The Probable Cause&lt;/h4&gt; &lt;p&gt;My machine was auto updated from IE 9 to IE 10 just the other day.  I *&lt;strong&gt;think&lt;/strong&gt;* my JavaScript debugging issue appeared at the same time.  This would explain to me why I had two instances of "Internet Explorer" in my list.  Not certain but I'd say the evidence is fairly compelling.&lt;/p&gt; &lt;p&gt;Painful Microsoft.  Painful&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4158515250667393929'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4158515250667393929'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2013/04/ie-10-install-torches-javascript.html' title='IE 10 Install Torches JavaScript Debugging in Visual Studio 2012 Through Auto Update (Probably)'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='http://3.bp.blogspot.com/-iRgBxdxUrkU/UW6csypEd3I/AAAAAAAAAaY/rNK6N79GT6k/s72-c/BrowseWith.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1965872403036778857</id><published>2013-04-09T14:03:00.001+01:00</published><updated>2021-03-03T21:39:32.593Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='autocomplete'/><category scheme='http://www.blogger.com/atom/ns#' term='jQuery UI'/><category scheme='http://www.blogger.com/atom/ns#' term='clear field button'/><category scheme='http://www.blogger.com/atom/ns#' term='IE 10'/><title type='text'>Making IE 10's clear field (X) button and jQuery UI autocomplete play nice</title><content type='html'>&lt;p&gt;This morning when I logged on I was surprised to discover IE 10 had been installed onto my machine.  I hadn't taken any action to trigger this myself and so Im assuming that this was part of the general Windows Update mechanism.  I know &lt;a href="http://technet.microsoft.com/en-us/ie/jj898508.aspx" target="_blank"&gt;Microsoft had planned to push IE 10 out through this mechanism&lt;/a&gt;.&lt;/p&gt; &lt;p&gt;I was a little surprised that my work desktop had been upgraded without any notice.  And I was initially rather concerned given that most of my users have IE 9 and now I didn't have a test harness on my development machine any more. (I've generally found that having the majority users browser on your own machine is a good idea.)  However, I wasn't too concerned as I didnt think it would makes much of a difference to my development experience.  I say that because IE10, as far as I understand, is basically IE 9 + more advanced CSS 3 and extra HTML 5 features.  The rendering of my existing content developed for the IE 9 target should look pixel for pixel identical in IE 10.  Thats the theory anyway.&lt;/p&gt; &lt;p&gt;However, I have found one exception to this rule already.  IE 10 provides clear field buttons in text boxes that look like this:&lt;/p&gt; &lt;a href="http://3.bp.blogspot.com/-HRxuGdc6PhE/UWQMq15gKHI/AAAAAAAAAZg/XmFfFZBMHYk/s1600/ClearField.png" imageanchor="1" &gt;&lt;img border="0" src="http://3.bp.blogspot.com/-HRxuGdc6PhE/UWQMq15gKHI/AAAAAAAAAZg/XmFfFZBMHYk/s320/ClearField.png" /&gt;&lt;/a&gt; &lt;p&gt;Unhappily I found these were clashing with our jQuery UI auto complete loading gif  looking like this:&lt;/p&gt; &lt;a href="http://3.bp.blogspot.com/-RPXGJkm1Lyk/UWQNCcFlmpI/AAAAAAAAAZo/pGP3IubeBiQ/s1600/ClearFieldMeetAutoComplete.png" imageanchor="1" &gt;&lt;img border="0" src="http://3.bp.blogspot.com/-RPXGJkm1Lyk/UWQNCcFlmpI/AAAAAAAAAZo/pGP3IubeBiQ/s320/ClearFieldMeetAutoComplete.png" /&gt;&lt;/a&gt; &lt;p&gt;I know; ugly isn't it? Happily I was able to resolve this with a CSS &lt;strike&gt;hack&lt;/strike&gt; fix which looks like this:&lt;/p&gt; &lt;script src="https://gist.github.com/johnnyreilly/5345373.js?file=ie10jQueryUI.css"&gt;&lt;/script&gt; &lt;p&gt;And now the jQuery UI autocomplete looks like we expect during the loading phase:&lt;/p&gt; &lt;a href="http://3.bp.blogspot.com/-mzBwe7BGwjk/UWQNdEKiucI/AAAAAAAAAZw/OmUFi6zMY7g/s1600/AutoComplete.png" imageanchor="1" &gt;&lt;img border="0" src="http://3.bp.blogspot.com/-mzBwe7BGwjk/UWQNdEKiucI/AAAAAAAAAZw/OmUFi6zMY7g/s320/AutoComplete.png" /&gt;&lt;/a&gt; &lt;p&gt;But happily when the autocomplete is not in the loading phase we still have access to the IE 10 clear field button.  This works because the CSS selector above only applies to the &lt;em&gt;ui-autocomplete-loading&lt;/em&gt; class (which is only applied to the textbox when the loading is taking place).  So we still get to use this:&lt;/p&gt; &lt;a href="http://3.bp.blogspot.com/-HRxuGdc6PhE/UWQMq15gKHI/AAAAAAAAAZg/XmFfFZBMHYk/s1600/ClearField.png" imageanchor="1" &gt;&lt;img border="0" src="http://3.bp.blogspot.com/-HRxuGdc6PhE/UWQMq15gKHI/AAAAAAAAAZg/XmFfFZBMHYk/s320/ClearField.png" /&gt;&lt;/a&gt; &lt;p&gt;Which is nice.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1965872403036778857'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1965872403036778857'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2013/04/making-ie-10s-clear-field-x-button-and.html' title='Making IE 10&apos;s clear field (X) button and jQuery UI autocomplete play nice'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='http://3.bp.blogspot.com/-HRxuGdc6PhE/UWQMq15gKHI/AAAAAAAAAZg/XmFfFZBMHYk/s72-c/ClearField.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5055874890201691490</id><published>2013-04-01T10:22:00.000+01:00</published><updated>2013-05-16T09:48:55.702+01:00</updated><category scheme='http://www.blogger.com/atom/ns#' term='css'/><category scheme='http://www.blogger.com/atom/ns#' term='intranet'/><category scheme='http://www.blogger.com/atom/ns#' term='meta'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='internet explorer'/><category scheme='http://www.blogger.com/atom/ns#' term='compatibility mode'/><category scheme='http://www.blogger.com/atom/ns#' term='header'/><title type='text'>Death to compatibility mode</title><content type='html'>&lt;p&gt;For just over 10 years my bread and butter has been the development and maintenance of line of business apps. More particularly, web apps built on the Microsoft stack of love (&lt;a href="https://channel9.msdn.com/Events/MIX/MIX11/FRM02" target="_blank"&gt;&amp;copy; Scott Hanselman&lt;/a&gt;). These sort of apps are typically accessed via the company intranet and since "bring your own device" is still a relatively new innovation these apps are invariably built for everyones favourite browser: Internet Explorer. As we all know, enterprises are generally not that speedy when it comes to upgrades.  So we're basically talking IE 9 at best, but more often than not, IE 8.&lt;/p&gt; &lt;p&gt;Now, unlike many people, I don't regard IE as a work of evil. I spent a fair number of years working for an organization which had IE 6 as the only installed browser on company desktops. (In fact, this was still the case as late as 2012!) Now, because JavaScript is so marvellously flexible I was still able to do a great deal with the help of a number of &lt;a href="http://paulirish.com/2011/the-history-of-the-html5-shiv/" target="_blank"&gt;shivs / shims&lt;/a&gt;.&lt;/p&gt; &lt;p&gt;But rendering and CSS - well that's another matter. Because here we're at the mercy of "compatibility mode".  Perhaps a quick history lesson is in order. What is this "compatibility mode" of which you speak?&lt;/p&gt; &lt;h4&gt;A Brief History&lt;/h4&gt; &lt;p&gt;Well it all started when Microsoft released IE 8.  To quote them:&lt;/p&gt; &lt;blockquote&gt;&lt;em&gt;A fundamental problem discussed during each and every Internet Explorer release is balancing new features and functionality with site compatibility for the existing Web. On the one hand, new features and functionality push the Web forward. On the other hand, the Web is a large expanse; requiring every legacy page to support the "latest and greatest" browser version immediately at product launch just isn't feasible.  Internet Explorer 8 addresses this challenge by introducing compatibility modes which gives a way to introduce new features and stricter compliance to standards while enabling it to be backward compliant.&lt;/em&gt;&lt;br /&gt;- excerpted from &lt;a href="http://blogs.msdn.com/b/askie/archive/2009/03/23/understanding-compatibility-modes-in-internet-explorer-8.aspx" target="_blank"&gt;understanding compatibility modes in Internet Explorer 8&lt;/a&gt;.&lt;/blockquote&gt; &lt;h4&gt;There's the rub&lt;/h4&gt; &lt;p&gt;Sounds fair enough?  Of course it does. Microsoft have generally bent over backwards to facilitate backwards compatibility.  Quite right too - good business sense and all that. However, one of the choices made around backwards compatibility I've come to regard as somewhat irksome.  Later down in the article you'll find this doozy: (emphasis mine) &lt;/p&gt; &lt;blockquote&gt;&lt;em&gt;"&lt;strong&gt;for Intranet pages, 7 (IE 7 Standards) rendering mode is used by default&lt;/strong&gt; and can be changed."&lt;/em&gt;&lt;/blockquote&gt; &lt;p&gt;For whatever reason, this decision was not particularly well promoted.  As a result, a fair number of devs I've encountered have little or no knowledge of compatibility mode.  Certainly it came as a surprise to me.  Here was I, developing away on my desktop.  I'd fire up the app hosted on my machine and test on my local install of IE 8.  All would look new and shiny (well  non-anchor tags would have &lt;code&gt;:hover&lt;/code&gt; support). Happy and content, I'd push to our test system and browse to it.  Wait, what's happened?  Where's the new style rendering?  What's up with my CSS?  This is a bug right?&lt;/p&gt; &lt;p&gt;Obviously I know now it's not a bug it's a "feature".  And I have learned how to get round the intranet default of compatibility mode through cunning deployment of meta tags and custom http headers.  Recently compatibility mode has come to bite me for the second time (in this case I was building for IE 9 and was left wondering where all my rounded corners had vanished to when I deployed...).&lt;/p&gt; &lt;p&gt;For my own sanity I thought it might be good to document the various ways that exist to solve this particular problem.  Just to clarify terms, "solve" in this context means "force IE to render in the most standards compliant / like other browsers fashion it can muster".  You can use compatibility mode to do more than just that and if you're interested in more about this then I recommend &lt;a href="http://stackoverflow.com/a/6771584/761388" target="_blank"&gt;this Stack Overflow answer&lt;/a&gt;.&lt;/p&gt; &lt;h4&gt;Solution 1: Custom HTTP Header through web.config&lt;/h4&gt; &lt;p&gt;If you're running IIS7 or greater then, for my money, this is the simplest and most pain free solution. All you need do is include the following snippet in your web config file:&lt;/p&gt; &lt;script src="https://gist.github.com/johnnyreilly/5283462.js?file=web.config"&gt;&lt;/script&gt; &lt;p&gt;This will make IIS serve up the above custom response HTTP header with each page.&lt;/p&gt; &lt;h4&gt;Solution 2: Custom HTTP Header the hard way&lt;/h4&gt; &lt;p&gt;Maybe you're running II6 and so you making a change to the web.config won't make a difference.  That's fine, you can still get the same behaviour by going to the HTTP headers tab in IIS (see below) and adding the &lt;code&gt;X-UA-Compatible: IE=edge&lt;/code&gt; header by hand.&lt;/p&gt; &lt;a href="http://4.bp.blogspot.com/-78CYavaCiUk/UVlGNv87U_I/AAAAAAAAAZQ/qtchMc14JsY/s1600/CustomHeadersIIS6.gif" imageanchor="1" &gt;&lt;img border="0" src="http://4.bp.blogspot.com/-78CYavaCiUk/UVlGNv87U_I/AAAAAAAAAZQ/qtchMc14JsY/s320/CustomHeadersIIS6.gif" /&gt;&lt;/a&gt; &lt;p&gt;Or, if you don't have access to IIS (don't laugh - it happens) you can fall back to doing this in code like this:&lt;/p&gt; &lt;script src="https://gist.github.com/johnnyreilly/5283462.js?file=servingUpTheHardWay.cs"&gt;&lt;/script&gt; &lt;p&gt;Obviously there's a whole raft of ways you could get this in, using &lt;code&gt;Application_BeginRequest&lt;/code&gt; in &lt;code&gt;Global.asax.cs&lt;/code&gt; would probably as good an approach as any.&lt;/p&gt; &lt;h4&gt;Solution 3: Meta Tags are go!&lt;/h4&gt; &lt;p&gt;The final approach uses meta tags.  And, in my experience it is the most quirky approach - it doesn't always seem to work.  First up, what do we do?  Well, in each page served we include the following meta tag like this:&lt;/p&gt; &lt;script src="https://gist.github.com/johnnyreilly/5283462.js?file=any.html"&gt;&lt;/script&gt; &lt;p&gt;Having crawled over the WWW equivalent of broken glass I now know why this *&lt;strong&gt;sometimes&lt;/strong&gt;* doesn't work.  (And credit where it's due the answer came from &lt;a href="http://stackoverflow.com/a/3960197/761388" target="_blank"&gt;here&lt;/a&gt;.)  It's all down to the positioning of the meta tag:&lt;/p&gt; &lt;blockquote&gt;&lt;em&gt;The X-UA-compatible header is not case sensitive; however, it must appear in the Web page's header (the HEAD section) before all other elements, except for the title element and other meta elements.&lt;/em&gt;&lt;br /&gt; - excerpted from &lt;a href="http://msdn.microsoft.com/en-gb/library/jj676915(v=vs.85).aspx" target="_blank"&gt;specifying legacy document modes&lt;/a&gt;&lt;/blockquote&gt; &lt;p&gt;That's right, get your meta tag in the wrong place and things won't work.  And you won't know why.  Lovely.  But get it right and it's all gravy.  This remains the most unsatisfactory approach in my book though.&lt;/p&gt; &lt;h4&gt;And for bonus points: &lt;code&gt;IFRAME&lt;/code&gt;s!&lt;/h4&gt; &lt;p&gt;Before I finish off I thought it worth sharing a little known feature of &lt;code&gt;IFRAME&lt;/code&gt;s.  If page is running in compatibility mode and it contains an &lt;code&gt;IFRAME&lt;/code&gt; then the page loaded in that &lt;code&gt;IFRAME&lt;/code&gt; will &lt;strong&gt;also run in compatibility mode&lt;/strong&gt;.  No ifs, no buts.&lt;/p&gt; &lt;p&gt;In the case that I encountered this behaviour, the application was being hosted in an &lt;code&gt;IFRAME&lt;/code&gt; inside Sharepoint.  Because of the way our Sharepoint was configured it ended up that the only real game in town for us was the meta tags approach - which happily worked once we'd correctly placed our meta tag.&lt;/p&gt; &lt;p&gt;Again, it's lamentable that this behaviour isn't better documented - hopefully the act of writing this here will mean that it becomes a little better known.  There's probably a good reason for this behaviour, though I'm frankly, I don't know what it is.  If anyone does, I'd be interested.&lt;/p&gt; &lt;h4&gt;That's it&lt;/h4&gt; &lt;p&gt;Armed with the above I hope you have less compatibility mode pain than I have.  The following blog entry is worth a read by the way:&lt;/p&gt; &lt;p&gt;&lt;a href="http://blogs.msdn.com/b/ie/archive/2009/02/16/just-the-facts-recap-of-compatibility-view.aspx" target="_blank"&gt;http://blogs.msdn.com/b/ie/archive/2009/02/16/just-the-facts-recap-of-compatibility-view.aspx&lt;/a&gt;&lt;/p&gt; &lt;p&gt;Finally, I have an open question about compatibility mode.  I &lt;em&gt;think&lt;/em&gt; (but I don't know) that even in compatibility mode IE runs using the same JavaScript engine.  However I suspect it has a different DOM to play with.  If anyone knows a little more about this and wants to let me know that'd be fantastic.&lt;/p&gt;  </content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5055874890201691490'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5055874890201691490'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2013/04/death-to-compatibility-mode.html' title='Death to compatibility mode'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='http://4.bp.blogspot.com/-78CYavaCiUk/UVlGNv87U_I/AAAAAAAAAZQ/qtchMc14JsY/s72-c/CustomHeadersIIS6.gif' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4430551888517363730</id><published>2013-03-11T17:06:00.001Z</published><updated>2013-03-12T08:55:23.835Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='Phil Haack'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Globalization'/><category scheme='http://www.blogger.com/atom/ns#' term='ModelBinder'/><category scheme='http://www.blogger.com/atom/ns#' term='nullable'/><category scheme='http://www.blogger.com/atom/ns#' term='decimal'/><title type='text'>DecimalModelBinder for nullable Decimals</title><content type='html'>&lt;p&gt;My memory appears to be a sieve.   Twice in the last year I've forgotten that MVCs ModelBinding doesn't handle regionalised numbers terribly well.  Each time I've thought "hmmmm.... best Google that" and lo and behold come upon this post on the issue by the fantastic Phil Haack:&lt;/p&gt; &lt;p&gt;&lt;a href="http://haacked.com/archive/2011/03/19/fixing-binding-to-decimals.aspx" target="_blank"&gt;http://haacked.com/archive/2011/03/19/fixing-binding-to-decimals.aspx &lt;/a&gt;&lt;/p&gt; &lt;p&gt;This post has got me 90% of the way there, the last 10% being me tweaking it so the model binder can handle nullable decimals as well.&lt;/p&gt; &lt;p&gt;In the expectation I that I may forget this again I thought I'd note down my tweaks now and hopefully save myself sometime when I'm next looking at this next...&lt;/p&gt; &lt;script src="https://gist.github.com/johnnyreilly/5135647.js?file=DecimalModelBinder.cs"&gt;&lt;/script&gt; &lt;h4&gt;And now a question...&lt;/h4&gt; &lt;p&gt;Why hasn't MVC got an out-of-the-box model binder that does this anyway?  In Phil Haack's original post it looks like they were considering putting this into MVC itself at some point:&lt;/p&gt; &lt;p&gt;"&lt;em&gt;... In that case, the DefaultModelBinder chokes on the value. This is unfortunate because jQuery Validate allows that value just fine. Ill talk to the rest of my team about whether we should fix this in the next version of ASP.NET MVC, but for now its good to know theres a workaround...&lt;/em&gt;"&lt;/p&gt; &lt;p&gt;If anyone knows the reason this never made it into core I'd love to know.  Maybe there's a good reason?&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4430551888517363730'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4430551888517363730'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2013/03/decimalmodelbinder-for-nullable-decimals.html' title='DecimalModelBinder for nullable Decimals'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6463585883554513120</id><published>2013-03-03T08:40:00.000Z</published><updated>2013-03-03T10:31:13.209Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='asp.net mvc'/><category scheme='http://www.blogger.com/atom/ns#' term='Marc Talary'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='DataAnnotations'/><category scheme='http://www.blogger.com/atom/ns#' term='Controller'/><category scheme='http://www.blogger.com/atom/ns#' term='ModelState'/><title type='text'>Unit testing ModelState</title><content type='html'>&lt;ul style="list-style:none"&gt;&lt;li&gt;Me: "It can't be done"&lt;/li&gt;&lt;li&gt;Him: "Yes it can"&lt;/li&gt;&lt;li&gt;Me: "No it can't"&lt;/li&gt;&lt;li&gt;Him: "Yes it can, I've just done it"&lt;/li&gt;&lt;li&gt;Me: "Ooooh!  Show me ..."&lt;/li&gt;&lt;/ul&gt; &lt;p&gt;The above conversation (or one much like it) took place between my colleague Marc Talary and myself a couple of weeks ago.  It was one of those faintly embarrassing situations where you state your case with absolute certainty only to subsequently discover that you were *&lt;strong&gt;completely&lt;/strong&gt;* wrong.  Ah arrogance, thy name is Reilly...&lt;/p&gt; &lt;p&gt;The disputed situation in this case was ModelState validation in ASP.Net MVC.  How can you unit test a models validation driven by &lt;code&gt;DataAnnotations&lt;/code&gt;?  If at all.  Well it can be done, and here's how.&lt;/p&gt; &lt;h4&gt;Simple scenario&lt;/h4&gt; &lt;p&gt;Let's start with a simple model:&lt;/p&gt; &lt;script src="https://gist.github.com/johnnyreilly/5069901.js?file=CarModel.cs"&gt;&lt;/script&gt; &lt;p&gt;And let's have a controller which makes use of that model:&lt;/p&gt; &lt;script src="https://gist.github.com/johnnyreilly/5069901.js?file=CarController.cs"&gt;&lt;/script&gt; &lt;p&gt;When I was first looking at unit testing this I was slightly baffled by the behaviour I witnessed.  I took an invalid model (where the properties set on the model were violating the model's validation &lt;code&gt;DataAnnotations&lt;/code&gt;):&lt;/p&gt; &lt;script src="https://gist.github.com/johnnyreilly/5069901.js?file=NaomiCampbell.cs"&gt;&lt;/script&gt; &lt;p&gt;I passed the invalid model to the &lt;code&gt;Edit&lt;/code&gt; controller action inside a unit test.  My expectation was that the &lt;code&gt;ModelState.IsValid&lt;/code&gt; code path would *&lt;strong&gt;not&lt;/strong&gt;* be followed as this was *&lt;strong&gt;not&lt;/strong&gt;* a valid model.  So &lt;code&gt;ModelState.IsValid&lt;/code&gt; should evaluate to &lt;code&gt;false&lt;/code&gt;, right?  Wrong!&lt;/p&gt; &lt;p&gt;Contrary to my expectation the validity of &lt;code&gt;ModelState&lt;/code&gt; is not evaluated on the fly inside the controller.  Rather it is determined during the model binding that takes place *&lt;strong&gt;before&lt;/strong&gt;* the actual controller action method is called.  And that completely explains why during my unit test with an invalid model we find we're following the &lt;code&gt;ModelState.IsValid&lt;/code&gt; code path.&lt;/p&gt;   &lt;h4&gt;Back to the dispute&lt;/h4&gt; &lt;p&gt;As this blog post started off I was slightly missing Marc's point.  I thought he was saying we should be testing the &lt;code&gt;ModelState.IsValid == false&lt;/code&gt; code path.  And given that &lt;code&gt;ModelState&lt;/code&gt; is determined before we reach the controller my view was that the only way to achieve this was through making use of &lt;code&gt;ModelState.AddModelError&lt;/code&gt; in our unit test (you can read a good explanation of that &lt;a href="http://stackoverflow.com/a/3816143/761388" target="_blank"&gt;here&lt;/a&gt;).  And indeed we were already testing for this; we were surfacing errors via a &lt;code&gt;JsonResult&lt;/code&gt; and so had a test in place to ensure that &lt;code&gt;ModelState&lt;/code&gt; errors were transformed in the manner we would expect.&lt;/p&gt; &lt;p&gt;However, Marc's point was actually that we should have unit tests that enforced our design.  That is to say, if we'd decided a certain property on a model was mandatory we should have a test that checked that this was indeed the case.  If someone came along later and removed the &lt;code&gt;Required&lt;/code&gt; data annotation then we wanted that test to fail.&lt;/p&gt; &lt;p&gt;It's worth saying, we didn't want a unit test to ensure that ASP.Net MVC worked as expected.  Rather, where we had used DataAnnotations against our models to drive validation, we wanted to ensure the validation didn't disappear further down the track.  Just to be clear: we wanted to test our code, not Microsoft's.&lt;/p&gt; &lt;h4&gt;Now I get to learn something&lt;/h4&gt; &lt;p&gt;When I grasped Marc's point I thought that the the only way to write these tests would be to make use of reflection.  And whilst we could certainly do that I wasn't entirely happy with that as a solution.  To my mind it was kind of testing "at one remove", if you see what I mean.  What I really wanted was to see that MVC was surfacing validations in the manner I might have hoped.  And you can!&lt;/p&gt; &lt;p&gt;.... Drum roll... Ladies and gents may I present Marc's &lt;code&gt;ModelStateTestController&lt;/code&gt;:&lt;/p&gt; &lt;script src="https://gist.github.com/johnnyreilly/5069901.js?file=ModelStateTestController.cs"&gt;&lt;/script&gt; &lt;p&gt;This class is, as you can see, incredibly simple.  It is a controller, it inherits from &lt;code&gt;System.Web.Mvc.Controller&lt;/code&gt; and establishes a mock context in the constructor using MOQ.  This controller exposes a single method: &lt;code&gt;TestTryValidateModel&lt;/code&gt;.  This method internally determines the controller's &lt;code&gt;ModelState&lt;/code&gt; given the supplied object by calling off to Mvc's (protected) &lt;code&gt;TryValidateModel&lt;/code&gt; method (&lt;code&gt;TryValidateModel&lt;/code&gt; evaluates &lt;code&gt;ModelState&lt;/code&gt;).&lt;/p&gt; &lt;p&gt;This simple class allows us to test the validations on a model in a simple fashion that stays close to the way our models will actually be used in the wild.  It's pragmatic and it's useful.&lt;/p&gt; &lt;h4&gt;An example&lt;/h4&gt; &lt;p&gt;Let me wrap up with an example unit test.  The test below makes use of the &lt;code&gt;ModelStateTestController&lt;/code&gt; to check the application of the DataAnnotations on our model:&lt;/p&gt; &lt;script src="https://gist.github.com/johnnyreilly/5069901.js?file=ModelStateUnitTests.cs"&gt;&lt;/script&gt; &lt;h4&gt;Wrapping up&lt;/h4&gt; &lt;p&gt;In a way I think it's a shame that &lt;code&gt;TryValidateModel&lt;/code&gt; is a protected method.  If it weren't it would be simplicity to write a unit test which tested the ModelState directly in context of the action method.  It would be possible to get round this by establishing a base controller class which all our controllers would inherit from which implemented the &lt;code&gt;TestTryValidateModel&lt;/code&gt; method from above.  On the other hand maybe it's good to have clarity of the difference between testing model validations and testing controller actions.  Something to ponder... &lt;/p&gt;  </content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/6463585883554513120'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/6463585883554513120'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2013/03/unit-testing-modelstate.html' title='Unit testing ModelState'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1867217689836748667</id><published>2013-02-18T07:33:00.000Z</published><updated>2013-02-18T09:36:55.586Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='MVC'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='unit testing'/><category scheme='http://www.blogger.com/atom/ns#' term='AreaRegistration.RegisterAllAreas()'/><category scheme='http://www.blogger.com/atom/ns#' term='MOQ'/><category scheme='http://www.blogger.com/atom/ns#' term='UrlHelper'/><title type='text'>Unit testing MVC controllers / Mocking UrlHelper</title><content type='html'>&lt;h4&gt;I have put a name to my pain... &lt;/h4&gt; &lt;p&gt;And it is unit testing ASP.Net MVC controllers.&lt;/p&gt; &lt;p&gt;Well perhaps that's unfair.  I have no problem unit testing MVC controllers.... &lt;strong&gt;until&lt;/strong&gt; it comes to making use of the "innards" of MVC.  Let me be more specific.  This week I had a controller action that I needed to test.  It looked a little like this:&lt;/p&gt; &lt;script src="https://gist.github.com/johnnyreilly/4959924.js?file=DemoController.cs"&gt;&lt;/script&gt; &lt;p&gt;Looks fine right?  It's an action that takes a simple object as an argument.  That's ok.  It returns a JsonResult.  No worries.  The JsonResult consists of an anonymous class. De nada.  The anonymous class has one property that is driven by the controllers &lt;code&gt;UrlHelper&lt;/code&gt;.  Yeah that shouldn't be an issue...  &lt;strong&gt;Hold your horses sunshine - you're going nowhere!&lt;/strong&gt;&lt;/p&gt; &lt;h4&gt;Getting disillusioned&lt;/h4&gt; &lt;p&gt;Yup, the minute you start pumping in asserts around that &lt;code&gt;UrlHelper&lt;/code&gt; driven property you're going to be mighty disappointed.  What, you didn't expect the result to be &lt;code&gt;null&lt;/code&gt;?  Damn shame.&lt;/p&gt; &lt;p&gt;Despite &lt;a href="http://msdn.microsoft.com/en-us/magazine/dd942838.aspx" target="_blank"&gt;articles&lt;/a&gt; on MSDN about how the intention is for MVC to be deliberately testable the sad fact of the matter is that there is a yawning hole around the testing support for controllers in ASP.Net MVC. Whenever you try to test something that makes use of controller "gubbins" you have &lt;strong&gt;serious&lt;/strong&gt; problems.  And unfortunately I didn't find anyone out there who could offer the whole solution.&lt;/p&gt; &lt;p&gt;After what I can best describe as a day of pain I found a way to scratch my particular itch.  I found a way to write unit tests for controllers that made use of UrlHelper.  As a bonus I managed to include the unit testing of Routes and Areas (well kind of) too.&lt;/p&gt; &lt;h4&gt;MvcMockControllers updated&lt;/h4&gt; &lt;p&gt;This solution is heavily based on the work of Scott Hanselman who &lt;a href="http://www.hanselman.com/blog/ASPNETMVCSessionAtMix08TDDAndMvcMockHelpers.aspx" target="_blank"&gt;wrote and blogged about &lt;code&gt;MvcMockHelpers&lt;/code&gt;&lt;/a&gt; back in 2008.  Essentially I've taken this and tweaked it so I could achieve my ends.  My version of &lt;code&gt;MvcMockHelpers&lt;/code&gt; looks a little like this:&lt;/p&gt; &lt;script src="https://gist.github.com/johnnyreilly/4959924.js?file=MvcMockHelpers.cs"&gt;&lt;/script&gt; &lt;h4&gt;What I want to test&lt;/h4&gt; &lt;p&gt;I want to be able to unit test the controller &lt;code&gt;Edit&lt;/code&gt; method I mentioned earlier.  This method calls the &lt;code&gt;Action&lt;/code&gt; method on the controllers &lt;code&gt;Url&lt;/code&gt; member (which is, in turn, a &lt;code&gt;UrlHelper&lt;/code&gt;) to generate a URL for passing pack to the client.  The URL generated should fit with the routing mechanism I have set up.   In this case the route we expect a URL for was mapped by the following area registration:&lt;/p&gt; &lt;script src="https://gist.github.com/johnnyreilly/4959924.js?file=DemoAreaRegistration.cs"&gt;&lt;/script&gt; &lt;h4&gt;Enough of the waffle - show me a unit test&lt;/h4&gt; &lt;p&gt;Now to the meat; here's a unit test which demonstrates how this is used:&lt;/p&gt; &lt;script src="https://gist.github.com/johnnyreilly/4959924.js?file=UnitTestingAnAreaUsingUrlHelper.cs"&gt;&lt;/script&gt; &lt;p&gt;Let's go through this unit test and breakdown what's happening:&lt;/p&gt; &lt;ol&gt;&lt;li&gt;Arrange&lt;/li&gt;&lt;ul&gt;&lt;li&gt;We instantiate an int that represents part of the route data.&lt;/li&gt;&lt;li&gt;We clear out any registered routes from the &lt;code&gt;RouteTable&lt;/code&gt; so we're starting with a clean slate.&lt;/li&gt;&lt;li&gt;We manually register our specific areas (only 1 in this example).  This is done because &lt;code&gt;AreaRegistration.RegisterAllAreas()&lt;/code&gt; simply doesn't work in the unit test environment.  There may be a better solution, one that allows for dynamic area registration but I don't know what it is.  This works.&lt;/li&gt;&lt;li&gt;We register our routes.  (By the way, isn't it frustrating that &lt;code&gt;RouteConfig.RegisterRoutes(RouteTable.Routes)&lt;/code&gt; works where &lt;code&gt;AreaRegistration.RegisterAllAreas()&lt;/code&gt; doesn't?)&lt;/li&gt;&lt;li&gt;We create a &lt;code&gt;MockHttpContext&lt;/code&gt; passing in the URL that would represent the "calling page"; that is to say the URL which would invoke the action we wish to test.&lt;/li&gt;&lt;li&gt;Using the &lt;code&gt;MockHttpContext&lt;/code&gt; and the routes we set up we determine the route data.&lt;/li&gt;&lt;li&gt;We set the controllers context to the &lt;code&gt;MockHttpContext&lt;/code&gt; and pass in the configured routes and the inferred route data.&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;Act&lt;/li&gt;&lt;ul&gt;&lt;li&gt;We call the &lt;code&gt;Edit&lt;/code&gt; method on the controller and pass in a newed-up &lt;code&gt;AnObject&lt;/code&gt; object.&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;Assert&lt;/li&gt;&lt;ul&gt;&lt;li&gt;Check that the correct area was registered.&lt;/li&gt;&lt;li&gt;Check that the output from the &lt;code&gt;Edit&lt;/code&gt; method is as you would expect.&lt;/li&gt;&lt;/ul&gt;&lt;/ol&gt; &lt;p&gt;The most interesting thing you'll note is the controller's UrlHelper is now generating a URL as we might have hoped.  The URL is generated making use of our routing, yay!  Finally we're also managing to unit test a route registered by our area.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1867217689836748667'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1867217689836748667'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2013/02/unit-testing-mvc-controllers-mocking.html' title='Unit testing MVC controllers / Mocking UrlHelper'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8902125621676794648</id><published>2013-02-14T20:59:00.000Z</published><updated>2013-02-14T20:59:35.882Z</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Shared unit test utilities</title><content type='html'>using Moq; using System; using System.Collections.Specialized; using System.Web; using System.Web.Mvc; using System.Web.Routing;  namespace Commerzbank.PCS.Test.Helpers {   public static class MvcMockHelpers   {     //[Links]     //http://www.hanselman.com/blog/ASPNETMVCSessionAtMix08TDDAndMvcMockHelpers.aspx     //http://code.google.com/p/moq/wiki/QuickStart      /// &lt;summary&gt;    /// MVC mock helpers     /// &lt;/summary&gt;    /// &lt;history&gt;    ///   &lt;change&gt;&lt;date&gt;04/10/2011&lt;/date&gt;&lt;name&gt;Anthony Hand&lt;/name&gt;&lt;description&gt;Created&lt;/description&gt;&lt;/change&gt;    /// &lt;/history&gt;    public static HttpContextBase FakeHttpContext()     {       var context = new Mock&lt;HttpContextBase&gt;();       var request = new Mock&lt;HttpRequestBase&gt;();       var response = new Mock&lt;HttpResponseBase&gt;();       var session = new Mock&lt;HttpSessionStateBase&gt;();       var server = new Mock&lt;HttpServerUtilityBase&gt;();        response.SetupProperty(res =&gt; res.StatusCode, (int)System.Net.HttpStatusCode.OK);        context.Setup(ctx =&gt; ctx.Request).Returns(request.Object);       context.Setup(ctx =&gt; ctx.Response).Returns(response.Object);       context.Setup(ctx =&gt; ctx.Session).Returns(session.Object);       context.Setup(ctx =&gt; ctx.Server).Returns(server.Object);        return context.Object;     }      public static HttpContextBase FakeHttpContext(string url)     {       HttpContextBase context = FakeHttpContext();       context.Request.SetupRequestUrl(url);       return context;     }      public static void SetFakeControllerContext(this Controller controller)     {       var httpContext = FakeHttpContext();        var context = new ControllerContext(new RequestContext(httpContext, new RouteData()), controller);        controller.Url = new UrlHelper(new RequestContext(httpContext, new RouteData()));        controller.ControllerContext = context;     }      static string GetUrlFileName(string url)     {       if (url.Contains("?"))         return url.Substring(0, url.IndexOf("?"));        return url;     }      static NameValueCollection GetQueryStringParameters(string url)     {       if (url.Contains("?"))       {         var parameters = new NameValueCollection();          string[] parts = url.Split("?".ToCharArray());         string[] keys = parts[1].Split("&amp;".ToCharArray());          foreach (string key in keys)         {           string[] part = key.Split("=".ToCharArray());           parameters.Add(part[0], part[1]);         }          return parameters;       }        return null;     }      public static void SetHttpMethodResult(this HttpRequestBase request, string httpMethod)     {       Mock.Get(request).Setup(req =&gt; req.HttpMethod).Returns(httpMethod);     }      public static void SetupRequestUrl(this HttpRequestBase request, string url)     {       if (url == null)         throw new ArgumentNullException("url");        if (!url.StartsWith("~/"))         throw new ArgumentException("Sorry, we expect a virtual url starting with \"~/\".");        var mock = Mock.Get(request);        mock.Setup(req =&gt; req.QueryString).Returns(GetQueryStringParameters(url));       mock.Setup(req =&gt; req.AppRelativeCurrentExecutionFilePath).Returns(GetUrlFileName(url));       mock.Setup(req =&gt; req.PathInfo).Returns(string.Empty);     }   } }</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8902125621676794648'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8902125621676794648'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1385261973446333869</id><published>2013-02-14T13:09:00.000Z</published><updated>2013-02-14T13:09:56.652Z</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>jQuery UI Autocomplete meet Coded UI Tests</title><content type='html'>&lt;p&gt;So, hands up who's using &lt;a href="http://msdn.microsoft.com/en-us/library/dd286726(v=vs.100).aspx" target="_blank"&gt;Microsoft's Coded UI Tests&lt;/a&gt;?  What no-one?  Is it really only me? Oh well... I jest but really it does feel like &lt;em&gt;no-one&lt;/em&gt; else is doing this.  There's so little documentation on the topic (besides Microsoft's own).  Anyway, I'm using it on my current project and I recently came upon the slightly tricky issue of writing coded ui tests that made use of &lt;a href="http://jqueryui.com/autocomplete/" target="_blank"&gt;jQuery UI's autocomplete widget&lt;/a&gt;.&lt;/p&gt; &lt;h4&gt;I've lost UL!&lt;/h4&gt; &lt;h4&gt;I've found UL! (but in a bad way)&lt;/h4&gt; &lt;h4&gt;I've found UL! (in a good way!)&lt;/h4&gt; &lt;script src="https://gist.github.com/johnnyreilly/4952633.js?file=UiTestControlExtensions.cs"&gt;&lt;/script&gt; fdsf  &lt;script src="https://gist.github.com/johnnyreilly/4952633.js?file=HowIsItUsed.cs"&gt;&lt;/script&gt;    As mentioned in the standup Ive come up with a different approach for our autocompletes and the testing surrounding them.  Up until now weve achieved this by using the appendTo approach mentioned in the jQuery UI documentation below:  http://api.jqueryui.com/autocomplete/#option-appendTo  Ive now switched us over to using the ui-front approach which is also discussed in the documentation.  Just to put it into my own words, the difference is this:    Previously we manually added a DIV element to the screen with a set id.  This id would be targeted specifically in our JavaScript which we initialised the autocomplete.  Now, when rendering an autocomplete we ensure that the element containing the INPUT[type=text] element is decorated with the css class ui-front.  With this in place we dont need to specify in our JavaScript where our UL will end up, rather it will just be appended to the element which contains the INPUT[type=text] element.  This switch should prove advantageous in a number of ways:  1. The majority of our autocompletes are (and probably will continue) to be generated using the HTML Helper extension methods in our AutocompleteExtensions class.  These autocompletes by default now render autocompletes inside a SPAN element with the css class ui-front.  Well no longer have to remember to manually render a DIV to the screen (and thats handy because the DIV was crashing our styling in some places) and using the AutocompleteExtensions we will have the ui-front issue handled for us by default. 2. If we should need to have multiple autocompletes of the same type on a screen (already a possibility to cater for Geography / Geography of Sales) wed find ourselves eating our tails a little when it came to testing.  How to distinguish between the 2 different ULs that have been appended to the DIV?  That issue has now disappeared.  Finally, to make the testers lives easier I have created a new class in the UI testing project called UITestControlExtensions. This class contains the following new extension method for UITestControl:          /// &lt;summary&gt;        /// Given a supplied input text element, obtain and return the associated Autocomplete UL         /// &lt;/summary&gt;        /// &lt;param name="input"&gt;input text element&lt;/param&gt;        /// &lt;returns&gt;ul element&lt;/returns&gt;        public static UITestControl GetAutocompleteUL(this UITestControl input)         {             //Get autocomplete UL from input             var ul = new UITestControl(input.GetParent());             ul.TechnologyName = "Web";             ul.SearchProperties.AddRange(                 new PropertyExpression(HtmlList.PropertyNames.TagName, "UL"),                 new PropertyExpression(HtmlList.PropertyNames.Class, "ui-autocomplete", PropertyExpressionOperator.Contains)                 );             ul.Find();              return ul;         }  What this does is take the autocomplete INPUT[type=text] element and find and return the associated autocomplete UL element.  Using it is as simple as this:              var GPFundNameList = inputGPFundName.GetAutocompleteUL();  Ive checked all this into TFS and modified the existing autocomplete tests so that they now use this approach.   If you do a Get Latest now you should pick this up.  Any questions then shout. </content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1385261973446333869'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1385261973446333869'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-416115017873352377</id><published>2013-02-13T13:58:00.001Z</published><updated>2013-02-14T09:42:20.869Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='Expression'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Constructors'/><category scheme='http://www.blogger.com/atom/ns#' term='Generic'/><title type='text'>Using Expressions with Constructors</title><content type='html'>&lt;p&gt;Every now and then you think "x should be easy" - and it isn't.  I had one of those situations this morning.  Something I thought would take 5 minutes had me still pondering 30 minutes later.  I finally cracked it (with the help of a colleague - thanks Marc!) and I wanted to note down what I did since I'm sure to forget this.&lt;/p&gt; &lt;h4&gt;So what's the problem?&lt;/h4&gt; &lt;p&gt;In our project we had a very simple validation class.  It looked a bit like this:&lt;/p&gt; &lt;script src="https://gist.github.com/johnnyreilly/4944545.js?file=FieldValidationBefore.cs"&gt;&lt;/script&gt; &lt;p&gt;I wanted to take this class and extend it to have a constructor which allowed me to specify a Type and subsequently an Expression of that Type that allowed me to specify a property. 10 points if you read the last sentence and understood it without reading it a second time.&lt;/p&gt; &lt;p&gt;Code is a better illustration; take a look below.  I wanted to go from #1 to #2:&lt;/p&gt; &lt;script src="https://gist.github.com/johnnyreilly/4944545.js?file=HowItIsUsed.cs"&gt;&lt;/script&gt; &lt;p&gt;"Why?" I hear you ask.  Well we had a swathe of statements in the code which test each property for a problem and would create a &lt;code&gt;FieldValidation&lt;/code&gt; with the very same property name if one was found.  There's no real problem with that but I'm a man that likes to refactor. Property names change and I didn't want to have to remember to manually go through each &lt;code&gt;FieldValidation&lt;/code&gt; keeping these in line.  If I was using the actual property name to drive the creation of my &lt;code&gt;FieldValidations&lt;/code&gt; then that problem disappears. And I like that.&lt;/p&gt; &lt;h4&gt;So what's the solution?&lt;/h4&gt; &lt;p&gt;Well it's this:&lt;/p&gt; &lt;script src="https://gist.github.com/johnnyreilly/4944545.js?file=FieldValidationAfter.cs"&gt;&lt;/script&gt; &lt;p&gt;As you can see we have taken the original FieldValidation class and added in a generic constructor which instead of taking &lt;code&gt;string fieldName&lt;/code&gt; as a first argument it takes &lt;code&gt;Expression&amp;lt;Func&amp;lt;T, object&amp;gt;&amp;gt; expression&lt;/code&gt;.  LINQ's Expression magic is used to determine the supplied property name which is smashing.  If you were wondering, the first &lt;code&gt;MemberExpression&lt;/code&gt; code is used for &lt;em&gt;reference&lt;/em&gt; types.  The &lt;code&gt;UnaryExpression&lt;/code&gt; wrapping a &lt;code&gt;MemberExpression&lt;/code&gt; code is used for &lt;em&gt;value&lt;/em&gt; types.  A good explanation of this can be found &lt;a href="http://stackoverflow.com/a/12975480/761388" target="_blank"&gt;here&lt;/a&gt;.&lt;/p&gt; &lt;p&gt;My colleague directed me to &lt;a href="http://stackoverflow.com/a/2916344" target="_blank"&gt;this crucial StackOverflow answer&lt;/a&gt; which provided some much needed direction when I was thrashing.  And that's it; we're done, home free.&lt;/p&gt;     </content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/416115017873352377'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/416115017873352377'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2013/02/using-expressions-with-constructors.html' title='Using Expressions with Constructors'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4769230227033625197</id><published>2013-02-06T11:10:00.000Z</published><updated>2013-02-06T11:10:56.065Z</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>datePickerPubSub.js - initialise with $(".datepicker").datePickerPubSub();</title><content type='html'>/// &lt;reference path="/scripts/jquery-1.7.2.js" /&gt;/// &lt;reference path="/scripts/jquery-ui-1.8.21.custom.js" /&gt;/// &lt;reference path="/scripts/amplify.js" /&gt; /* * jQuery picker plugin * * Author: John Reilly *  * Depends: * jQuery UI * Amplify * * This is a wrapper for the jQuery UI date picker that adds on pub sub functionality * * Html required is this: * &lt;input class="datepicker" data-date-for-initialisation="2012-06-15" id="aDatePicker" name="aDatePicker" data-type="MarginDate" type="text" value="" /&gt;* * * This an example which implements date range functionality * * &lt;label for="from"&gt;From &lt;/label&gt;  * &lt;input class="datepicker" data-date-for-initialisation="2012-11-10" data-is-date-range="true" data-is-from="true" data-other-date-picker="to" id="from" name="from" type="text" value="" /&gt;* &lt;label for="to"&gt;To &lt;/label&gt;  * &lt;input class="datepicker" data-date-for-initialisation="2012-11-19" data-is-date-range="true" data-is-from="false" data-other-date-picker="from" id="to" name="to" type="text" value="" /&gt;*  * initialise with $(".datepicker").datePickerPubSub(); * */ ; (function ($) {      // Picker methods     var methods = {          //===============================================================================         // Initialise a picker         //===============================================================================         init: function (options) {              return this.each(function () {                  var $currentPickerInWaiting = $(this);                  //Make sure you don't reprocess something that is already a datepicker                 if (!$currentPickerInWaiting.hasClass("hasDatepicker")) {                      //Make into a datepicker                     $currentPickerInWaiting.datepicker({                         changeMonth: true,                         changeYear: true,                         dateFormat: "dd M yy",                         disabled: $currentPickerInWaiting.data("disabled"),                          //===============================================================================                         // Date Range behaviour                         //===============================================================================                         onSelect: function (dateText, inst) {                              var $datePicker = $(this),                                 oData = $datePicker.data(),                                 instance = oData.datepicker,                                 date = $.datepicker.parseDate( //Determine date                                       instance.settings.dateFormat || $.datepicker._defaults.dateFormat,                                   dateText, instance.settings                                 );                              if (oData.isDateRange) {                                  $("#" + oData.otherDatePicker).datepicker("option",                                   oData.isFrom ? "minDate" : "maxDate",                                   date);                             }                              //If there is a data-type tag then this will be used to publish the change event; if not the id will be used                             amplify.publish(((oData.type) ? oData.type : this.id) + ".Change", $.datepicker.formatDate($.datepicker.ISO_8601, date), $datePicker);                         },                          //===============================================================================                         // Publish out cleared date if textbox cleared                         //===============================================================================                         onClose: function (dateText, inst) {                              var $datePicker = $(this),                                 oData = $datePicker.data();                             if (!dateText) {                                 amplify.publish(((oData.type) ? oData.type : "DatePicker") + ".Change", null, $datePicker);                             }                         }                     });                      //If a date for initialisation exists then use it to initialise the picker                     var dateForInitialisation = $currentPickerInWaiting.data("dateForInitialisation");                     if (dateForInitialisation) {                          $currentPickerInWaiting.datepicker("setDate", $.datepicker.parseDate($.datepicker.ISO_8601, dateForInitialisation));                     }                 }             });         }     };       //===============================================================================     // Declare picker plugin     //===============================================================================     $.fn.datePickerPubSub = function (method) {          if (methods[method]) { //Calling a method inside the plugin             return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));         }         else if (typeof method === 'object' || !method) { //Initialisation             return methods.init.apply(this, arguments);         }         else {             $.error('Method ' + method + ' does not exist on jQuery.picker');         }      };  })(jQuery);</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4769230227033625197'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4769230227033625197'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2237738981238324647</id><published>2013-01-17T13:39:00.003Z</published><updated>2013-01-17T13:39:55.790Z</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Unit of Work and Repository Patterns with DbContext</title><content type='html'>Whether an abstraction around DbContext is a good idea is another story.  IRepository.cs  using System; using System.Collections.Generic; using System.Linq; using System.Linq.Expressions;  namespace LNRCorporate.Common.Data {     /// &lt;summary&gt;    /// Author      : John Reilly     /// Description : Repository interface that declares the methods to be exposed by a repository     /// &lt;/summary&gt;    public interface IRepository&lt;T&gt;                      where T : class     {         IQueryable&lt;T&gt; FindAll();         IQueryable&lt;T&gt; FindWhere(Expression&lt;Func&lt;T, bool&gt;&gt; predicate);         T Add(T newEntity);         T Attach(T entity);         T Remove(T entity);     } }  SqlRepository.cs  using System; using System.Collections.Generic; using System.Data.Entity; using System.Linq; using System.Linq.Expressions;  namespace LNRCorporate.Common.Data {     /// &lt;summary&gt;    /// Author      : John Reilly     /// Description : Implementation of the ISqlRepository interface - this class facilitates access to Entity Framework     /// &lt;/summary&gt;    public class SqlRepository&lt;T&gt; : IRepository&lt;T&gt;                                    where T : class     {         protected readonly DbSet&lt;T&gt; _dbSet;         protected readonly DbContext _dbContext;          public SqlRepository(DbContext context)         {             _dbContext = context;             _dbSet = context.Set&lt;T&gt;();         }          public IQueryable&lt;T&gt; FindAll()         {             return _dbSet;         }          public IQueryable&lt;T&gt; FindWhere(Expression&lt;Func&lt;T, bool&gt;&gt; predicate)         {             return _dbSet.Where(predicate);         }          public T Add(T newEntity)         {             return _dbSet.Add(newEntity);         }          public T Attach(T newEntity)         {             return _dbSet.Attach(newEntity);         }          public T Remove(T entity)         {             return _dbSet.Remove(entity);         }     } }  IUnitOfWork.cs  using System;  namespace LNRCorporate.Common.Data {     /// &lt;summary&gt;    /// Author      : John Reilly     /// Description : Unit of work interface that declares the methods to be exposed by a unit of work     /// &lt;/summary&gt;    public interface IUnitOfWork : IDisposable      {         int Commit(bool suspendValidation = false);         IEnumerable&lt;string&gt; GetValidationErrors();     } }  SqlUnitOfWork.cs  using System; using System.Configuration; using System.Data.Entity; using System.Collections.Generic; using LNRCorporate.Common.Helpers;  namespace LNRCorporate.Common.Data {     /// &lt;summary&gt;    /// Author      : John Reilly     /// Description : Implementation of the IUnitOfWork interface - this class facilitates access to Entity Framework     /// &lt;/summary&gt;    public abstract class SqlUnitOfWork : IUnitOfWork     {         protected readonly DbContext _context;          public SqlUnitOfWork(DbContext context)          {             _context = context;         }          public int Commit(bool suspendValidation = false)         {             try             {                 //If suspendValidation is true then temporarily disable validation                 if (suspendValidation) _context.Configuration.ValidateOnSaveEnabled = false;                  return _context.SaveChanges();             }             finally             {                 //If suspendValidation is true then reactivate validation                 if (suspendValidation) _context.Configuration.ValidateOnSaveEnabled = true;             }         }          public IEnumerable&lt;string&gt; GetValidationErrors()         {             return _context.GetValidationErrors() //Call Entity Framework method                            .GetValidationExceptionList(); //Translate the result set into a list of strings         }          public void Dispose()         {             _context.Dispose();         }     } }  ExceptionExtensions.cs  using System; using System.Collections.Generic; using System.Linq; using System.Web; using System.IO; using System.Reflection; using System.ComponentModel; using System.Data.Entity.Validation;  namespace LNRCorporate.Common.Helpers {     /// &lt;summary&gt;    /// Helper extension methods for Exceptions     /// &lt;/summary&gt;    public static class ExceptionExtensions     {         /// &lt;summary&gt;        /// Author      : John Reilly         /// Description : A helper method that takes an exception and generates a string containing all the exception         ///               details; based on this: http://stackoverflow.com/a/8039737/761388         /// &lt;/summary&gt;        /// &lt;param name="exception"&gt;&lt;/param&gt;        /// &lt;returns&gt;&lt;/returns&gt;        public static string GetExceptionDetails(this Exception exception, bool includeCarriageReturnsAtStart = true)         {             //Build a list of exceptions             var exceptionList = new List&lt;Exception&gt;() { exception };             var currentException = exception;             while (currentException.InnerException != null)             {                 currentException = currentException.InnerException;                 exceptionList.Add(currentException);             }              var exceptionNumber = 0;             var errorDetails = new List&lt;string&gt;();             foreach (var exc in exceptionList)             {                 exceptionNumber++;                  //Title stating which exception this is                 errorDetails.Add(string.Format("{0}Exception #{1}", (exceptionNumber &gt; 1) ? Environment.NewLine : string.Empty, exceptionNumber));                  //Add exception details                 var properties = exc.GetType().GetProperties();                 errorDetails.AddRange(properties.Select(property =&gt; new                                       {                                           Name = property.Name,                                           Value = property.GetValue(exc, null)                                       })                                       .Select(x =&gt; string.Format(                                           "{0} = {1}",                                           x.Name,                                           x.Value != null ? x.Value.ToString() : string.Empty                                       ))                                      );             }              return ((includeCarriageReturnsAtStart)                  ? Environment.NewLine + Environment.NewLine                  : string.Empty) +                 string.Join(Environment.NewLine, errorDetails);         }          /// &lt;summary&gt;        /// Author      : John Reilly         /// Description : A helper method that returns an error id (intended to be used by the Exception service)         /// &lt;/summary&gt;        /// &lt;param name="exception"&gt;&lt;/param&gt;        /// &lt;returns&gt;&lt;/returns&gt;        public static int GetErrorId(this Exception exception)         {             //Default error id             var errorId = Constants.ERR_SYSTEM_EXCEPTION;              //Pick up error id stored in Data if present             if (exception.Data.Contains("errorId"))             {                 try                 {                     errorId = Convert.ToInt32(exception.Data["errorId"]); //It would have been nicer to use int.TryParse but we don't have a string to play with; only an object                 }                 catch (Exception) { }             }              return errorId;         }          /// &lt;summary&gt;        /// Author      : John Reilly         /// Description : Common method for turning a DbEntityValidationException into a string list         ///               of validation messages for the users         /// &lt;/summary&gt;        /// &lt;param name="exception"&gt;&lt;/param&gt;        /// &lt;returns&gt;&lt;/returns&gt;        public static List&lt;string&gt; GetValidationExceptionList(this DbEntityValidationException exception)         {             //Hand off to common extension method on IEnumerable&lt;DbEntityValidationResult&gt;            return exception.EntityValidationErrors.GetValidationExceptionList();         }          /// &lt;summary&gt;        /// Author      : John Reilly         /// Description : Common method for turning IEnumerable&lt;DbEntityValidationResult&gt; into a string list         ///               of validation messages for the users         /// &lt;/summary&gt;        /// &lt;param name="exception"&gt;&lt;/param&gt;        /// &lt;returns&gt;&lt;/returns&gt;        public static List&lt;string&gt; GetValidationExceptionList(this IEnumerable&lt;DbEntityValidationResult&gt; validationResults)         {             //Build a list of exceptions             var errors = validationResults.SelectMany(eve =&gt; eve.ValidationErrors)                                           .Select(ve =&gt; ve.ErrorMessage) //We could get more information out if we wanted - for now we'll settle for this                                           .ToList();              return errors;         }     } }    DataHelper.cs (facilitates Include operations)  using System; using System.Collections.Generic; using System.Linq; using System.Text; using System.Data.Entity; using System.Linq.Expressions;  namespace LNRCorporate.Common.Data {     /// &lt;summary&gt;    /// Author      : John Reilly     /// Description : Simple helper class based on this: http://stackoverflow.com/a/5376637/761388     ///      /// It would be used like this:     ///      /// var query = context.Customers     ///               .IncludeMultiple(     ///                   c =&gt; c.Address,     ///                   c =&gt; c.Orders.Select(o =&gt; o.OrderItems));     ///                        /// This query will load all customers with they addresses and orders and every order will contain its order items.     /// &lt;/summary&gt;    public static class DataHelper     {         /// &lt;summary&gt;        /// Author      : John Reilly         /// Description : Using the unit of work, lookup the supplied category and build a select list with it         /// &lt;/summary&gt;        /// &lt;param name="unitOfWork"&gt;&lt;/param&gt;        /// &lt;param name="category"&gt;a string that reprents the category eg "CurrentDefault"&lt;/param&gt;        /// &lt;returns&gt;a list of SelectListItems&lt;/returns&gt;        public static IQueryable&lt;T&gt; IncludeMultiple&lt;T&gt;(this IQueryable&lt;T&gt; query, params Expression&lt;Func&lt;T, object&gt;&gt;[] includes)             where T : class         {             if (includes != null)             {                 query = includes.Aggregate(query,                           (current, include) =&gt; current.Include(include));             }              return query;         }          /// &lt;summary&gt;        /// Author      : John Reilly         /// Description : Take an array and join it by a delimiter for passing to stored procedures         ///               Default delimiter is the ',' character         /// &lt;/summary&gt;        /// &lt;param name="array"&gt;string array&lt;/param&gt;        /// &lt;param name="delimiter"&gt;OPTIONAL - defaults to ',' character&lt;/param&gt;        /// &lt;returns&gt;&lt;/returns&gt;        public static string ToArrayString(this string[] array, string delimiter = ",")         {             return (array == null)                 ? "" //Represents an empty array                 : string.Join(delimiter, array);         }     } }   IOrangeUnitOfWork.cs  using System; using System.Collections.Generic; using System.Linq; using System.Text; using LNRCorporate.Common.Data;  namespace HatfieldPhilips.OrangeData.Domain {     public interface IOrangeUnitOfWork : IUnitOfWork     {         IRepository&lt;Data_DailyIndexRates&gt; daily_index_rates { get; }         IRepository&lt;Data_DailyExchangeRates&gt; daily_exchange_rates { get; }         IRepository&lt;currency_codes&gt; currency_codes { get; }     } }  OrangeUnitOfWork.cs  using System; using System.Collections.Generic; using System.Linq; using System.Text; using LNRCorporate.Common.Data; using HatfieldPhilips.OrangeData.Domain;  namespace HatfieldPhilips.OrangeData.Data {     public class OrangeUnitOfWork : SqlUnitOfWork, IOrangeUnitOfWork     {         #region Members          private SqlRepository&lt;Data_DailyIndexRates&gt; _daily_index_rates = null;         private SqlRepository&lt;Data_DailyExchangeRates&gt; _daily_exchange_rates = null;         private SqlRepository&lt;currency_codes&gt; _currency_codes = null;          #endregion          #region Constructor          /// &lt;summary&gt;        /// Author      : John Reilly         /// Description : Constructor news up the DbContext and passes it to the SqlUnitOfWork (base) constructor         /// &lt;/summary&gt;        public OrangeUnitOfWork()             : base(new OrangeContext())         {         }          #endregion          #region Private          #endregion          #region Public members - implementation of interface          public IRepository&lt;Data_DailyIndexRates&gt; daily_index_rates         {             get             {                 if (_daily_index_rates == null) _daily_index_rates = new SqlRepository&lt;Data_DailyIndexRates&gt;(_context);                  return _daily_index_rates;             }         }          public IRepository&lt;Data_DailyExchangeRates&gt; daily_exchange_rates         {             get             {                 if (_daily_exchange_rates == null) _daily_exchange_rates = new SqlRepository&lt;Data_DailyExchangeRates&gt;(_context);                  return _daily_exchange_rates;             }         }          public IRepository&lt;currency_codes&gt; currency_codes         {             get             {                 if (_currency_codes == null) _currency_codes = new SqlRepository&lt;currency_codes&gt;(_context);                  return _currency_codes;             }         }          #endregion     } }  IIRISClientControlRepository (not sure if this is a good idea)  using System; using System.Collections.Generic; using System.Linq; using System.Linq.Expressions; using LNRCorporate.Common.Data;  namespace HatfieldPhilips.IRIS.Models.Domain {     /// &lt;summary&gt;    /// Author      : John Reilly     /// Description : Repository interface that declares the methods to be exposed by IRISClientControlRepository - this is a custom repository because it exposes custom methods     /// &lt;/summary&gt;    public interface IIRISClientControlRepository : IRepository&lt;client_control&gt;    {         IQueryable&lt;ClientResult&gt; GetClientResultsForPeriod(DateTime dateTimeToJoinWith, int year, int quarter);         IQueryable&lt;waterfall_control&gt; GetClientWaterfallsForPeriod(int lenderID, DateTime dateTimeToJoinWith, int year, int quarter);         void LockClientWaterfallPayments(int lenderID, int[] paymentIDs, int userID);         void LockClientWaterfalls(int lenderID, int[] waterfallIDs, int userID);         void UnlockClientWaterfalls(int lenderID, int[] waterfallIDs, int userID);     }      /// &lt;summary&gt;    /// Author      : John Reilly     /// Description : Class that allows GetClientResults to be re-used     /// &lt;/summary&gt;    public class ClientResult     {         public int LenderID { get; set; }         public int LoanID { get; set; }         public string LoanNumber { get; set; }         public string CashManagerReportStatusCode { get; set; }         public string CashManagerReportStatusDescription { get; set; }         public int WaterfallsCount { get; set; }         public int WaterfallsFinalisedCount { get; set; }         public IQueryable&lt;string&gt; WaterfallsUnfinalised { get; set; }     } }  IRISClientControlRepository.cs  using System; using System.Collections.Generic; using System.Data.Entity; using System.Linq; using System.Linq.Expressions; using HatfieldPhilips.IRIS.Models.Domain; using LNRCorporate.Common.Data;  namespace HatfieldPhilips.IRIS.Models.Data {     /// &lt;summary&gt;    /// Author      : John Reilly     /// Description : Implementation of the IIRISClientControlRepository interface     /// &lt;/summary&gt;    public class IRISClientControlRepository : SqlRepository&lt;client_control&gt;, IIRISClientControlRepository     {         public IRISClientControlRepository(DbContext context) : base(context)         {         }          /// &lt;summary&gt;        /// Author      : John Reilly         /// Description : Query IRIS to client driven results query (so can be reused and have extra where clauses composed in)         /// &lt;/summary&gt;        /// &lt;returns&gt;&lt;/returns&gt;        public IQueryable&lt;ClientResult&gt; GetClientResultsForPeriod(DateTime dateTimeToJoinWith, int year, int quarter)         {             var clientResults = from c in _dbContext.Set&lt;client_control&gt;()                                 join l in _dbContext.Set&lt;loan_control&gt;() on c.loan_id equals l.loan_id                                 let waterfalls = from w in _dbContext.Set&lt;waterfall_control&gt;()                                                  where w.loan_id == c.loan_id &amp;&amp; c.year == year &amp;&amp; c.quarter == quarter &amp;&amp; (w.report_start_date &lt;= dateTimeToJoinWith &amp;&amp; w.report_end_date &gt;= dateTimeToJoinWith)                                                  select w                                 where c.year == year &amp;&amp; c.quarter == quarter                                 select new ClientResult                                 {                                     LenderID = c.lenderid,                                     LoanID = c.loan_id,                                     LoanNumber = l.loannumber,                                     CashManagerReportStatusCode = c.cm_report_status_lookup.lookup_code,                                     CashManagerReportStatusDescription = c.cm_report_status_lookup.lookup_name,                                     WaterfallsCount = waterfalls.Count(),                                     WaterfallsFinalisedCount = waterfalls.Count(w =&gt; w.finalised),                                     WaterfallsUnfinalised = waterfalls.Where(w =&gt; !w.finalised).Select(w =&gt; w.loan_control.loannumber)                                 };              return clientResults;         }          /// &lt;summary&gt;        /// Author      : John Reilly         /// Description : Query IRIS to client waterfalls for a given period         /// &lt;/summary&gt;        /// &lt;returns&gt;&lt;/returns&gt;        public IQueryable&lt;waterfall_control&gt; GetClientWaterfallsForPeriod(int lenderID, DateTime dateTimeToJoinWith, int year, int quarter)         {             return from c in _dbContext.Set&lt;client_control&gt;()                    join w in _dbContext.Set&lt;waterfall_control&gt;() on c.loan_id equals w.loan_id                    where c.lenderid == lenderID &amp;&amp; c.year == year &amp;&amp; c.quarter == quarter &amp;&amp;                          (w.report_start_date &lt;= dateTimeToJoinWith &amp;&amp; w.report_end_date &gt;= dateTimeToJoinWith)                    select w;         }          /// &lt;summary&gt;        /// Author      : John Reilly         /// Description : Lock a clients waterfall payments using the supplied waterfall payment ids         /// &lt;/summary&gt;        /// &lt;returns&gt;&lt;/returns&gt;        public void LockClientWaterfallPayments(int lenderID, int[] paymentIDs, int userID)         {             var waterfallPayments = _dbContext.Set&lt;waterfall_payments&gt;()                                               .Where(w =&gt; paymentIDs.Contains(w.waterfall_payments_id));              //Update the waterfalls             var stampedWaterfall = false;             foreach (var payment in waterfallPayments)             {                 if (!stampedWaterfall)                 {                     payment.waterfall_control.date_last_modified = DateTime.Now;                     payment.waterfall_control.user_last_modified = userID;                      stampedWaterfall = true;                 }                  payment.scheduled_amounts_locked = true;             }         }          /// &lt;summary&gt;        /// Author      : John Reilly         /// Description : Lock a clients waterfalls using the supplied waterfall ids         /// &lt;/summary&gt;        /// &lt;returns&gt;&lt;/returns&gt;        public void LockClientWaterfalls(int lenderID, int[] waterfallIDs, int userID)         {             LockUnlockClientWaterfallsAndPayments(waterfallIDs, userID, lockOrUnlock: true);         }          /// &lt;summary&gt;        /// Author      : John Reilly         /// Description : Unlock a clients waterfalls using the supplied waterfall ids         /// &lt;/summary&gt;        /// &lt;returns&gt;&lt;/returns&gt;        public void UnlockClientWaterfalls(int lenderID, int[] waterfallIDs, int userID)         {             LockUnlockClientWaterfallsAndPayments(waterfallIDs, userID, lockOrUnlock: false);         }          private void LockUnlockClientWaterfallsAndPayments(int[] waterfallIDs, int userID, bool lockOrUnlock)         {             var waterfalls = _dbContext.Set&lt;waterfall_control&gt;()                                        .Where(w =&gt; waterfallIDs.Contains(w.waterfall_id));              //Update the waterfalls             foreach (var waterfall in waterfalls)             {                 waterfall.waterfall_locked = lockOrUnlock;                 waterfall.date_last_modified = DateTime.Now;                 waterfall.user_last_modified = userID;                  //Cascade to payments                 foreach (var payment in waterfall.waterfall_payments)                 {                     payment.scheduled_amounts_locked = lockOrUnlock;                 }             }         }     } }</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2237738981238324647'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2237738981238324647'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4560332740682155168</id><published>2013-01-14T06:55:00.000Z</published><updated>2013-01-16T09:51:19.273Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='Internationalization'/><category scheme='http://www.blogger.com/atom/ns#' term='Twitter.Bootstrap.MVC4'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Globalize JS'/><category scheme='http://www.blogger.com/atom/ns#' term='Twitter Bootstrap'/><title type='text'>Twitter.Bootstrap.MVC4 meet Bootstrap Datepicker *and* get your Internationalization on...</title><content type='html'>&lt;p&gt;&lt;a href="http://icanmakethiswork.blogspot.co.uk/2013/01/twitterbootstrapmvc4-meet-bootstrap.html" target="_blank"&gt;Last time&lt;/a&gt; I wrote about marrying up Twitter.Bootstrap.MVC4 and Bootstrap Datepicker.  It came together quite nicely but when I took a more in depth look at what I'd done I discovered a problem.  The brief work on regionalisation / internationalisation / localisation / globalisation / whatever it's called this week... wasn't really working.  We had problems with the validation.&lt;/p&gt; &lt;p&gt;I also discovered that Stefan Petre's Bootstrap Datepicker appears to have been abandoned.  Andrew Rowls has taken it on and created a GitHub repository for it &lt;a href="https://github.com/eternicode/bootstrap-datepicker" target="_blank"&gt;here&lt;/a&gt;.  Besides bug fixes he's also introduced the ability for the Bootstrap Datepicker to customised for different cultures.&lt;/p&gt; &lt;p&gt;Since these 2 subjects are linked I tackled them together and thought it might be worth writing up here.  You can find the conclusion of my work in a GitHub repository  I created &lt;a href="https://github.com/johnnyreilly/BootstrapMvcSample" target="_blank"&gt;here&lt;/a&gt;.&lt;/p&gt; &lt;h4&gt;Going global down in Acapulco&lt;/h4&gt; &lt;p&gt;First step in internationalising any ASP.Net web app is adding the following to the &lt;code&gt;web.config&lt;/code&gt;:&lt;/p&gt; &lt;script src="https://gist.github.com/4528994.js?file=web.config"&gt;&lt;/script&gt; &lt;p&gt;Then I pulled &lt;a href="https://github.com/jquery/globalize" target="_blank"&gt;Globalize&lt;/a&gt; and the &lt;a href="https://github.com/eternicode/bootstrap-datepicker" target="_blank"&gt;Andrew Rowls fork of Bootstrap Datepicker&lt;/a&gt; into the project (replacing Stefan's original assets). As well as this I pulled in the &lt;code&gt;jQuery.validate.globalize.js&lt;/code&gt; extension &lt;a href="http://icanmakethiswork.blogspot.co.uk/2012/09/globalize-and-jquery-validate.html" target="_blank"&gt;I wrote about here&lt;/a&gt;.  (This replaces some of the default jQuery Validate functionality for culture-specific functionality based on Globalize.)  This extension depends on a meta tag that is generated using the following file (which also handles the serving up of the relevant JavaScript culture bundles, more of which shortly):&lt;/p&gt; &lt;script src="https://gist.github.com/4528994.js?file=GlobalizationHelpers.cs"&gt;&lt;/script&gt; &lt;h4&gt;Culture-specific script bundles&lt;/h4&gt; &lt;p&gt;With all of my dependancies in place I was now ready to press on.  Since both Globalize and the new Bootstrap Datepicker come with their own culture-specific JavaScript files it seemed a good idea to make use of ASP.Nets new bundling functionality.  This I did here:&lt;/p&gt; &lt;script src="https://gist.github.com/4528994.js?file=BootstrapBundleConfig.cs"&gt;&lt;/script&gt; &lt;p&gt;The code above creates a script bundle for each culture when the application starts up. This script bundle contains the culture-specific Globalize and Bootstrap Datepicker JavaScript files.  If further culture-specific components were added to the application it would make sense to include these here as well.&lt;/p&gt; &lt;p&gt;&lt;code&gt;_BootstrapLayout.basic.cshtml&lt;/code&gt; has been amended to make use of the new bundles and also to include a meta tag that will used to drive regionalisation:&lt;/p&gt; &lt;script src="https://gist.github.com/4528994.js?file=_BootstrapLayout.basic.cshtml"&gt;&lt;/script&gt; &lt;p&gt;To illustrate how this works, a German user running a machine with the de-DE culture would be served up the following 2 files:&lt;/p&gt; &lt;ul&gt;&lt;li&gt;&lt;code&gt;globalize.culture.de-DE.js&lt;/code&gt;&lt;/li&gt;&lt;li&gt;&lt;code&gt;bootstrap-datepicker.de.js&lt;/code&gt;&lt;/li&gt;&lt;/ul&gt; &lt;h4&gt;Where have we got to?&lt;/h4&gt; &lt;p&gt;With all this done we have now fixed the validation issues we were experiencing previously. This was done by including the Globalize library, the accept-language meta tag and the jQuery Validate Globalize extensions.&lt;/p&gt; &lt;p&gt;Besides this we've laid the groundwork for introducing internationalised datepickers by introducing Andrew Rowls fork of the Bootstrap Datepicker.  That's what we'll do next...&lt;/p&gt; &lt;h4&gt;International Bootstrap Datepicker&lt;/h4&gt; &lt;p&gt;The final steps of switching over to using a culture-specific date picker are achieved by making a change to the Scripts section in the &lt;code&gt;Create.cshtml&lt;/code&gt; file.  The existing (and very simple) section should be replaced with this:&lt;/p&gt; &lt;script src="https://gist.github.com/4528994.js?file=Create.cshtml"&gt;&lt;/script&gt; &lt;p&gt;The script above takes the region from the accept-language meta tag and attempts to look up an associated "language" for the Bootstrap Datepicker.  If it finds one it uses it, if not then the default language of "en" / English will be used.&lt;/p&gt; &lt;h4&gt;Summary&lt;/h4&gt; &lt;p&gt;In this post we:&lt;/p&gt; &lt;ol&gt;&lt;li&gt;fixed the validation issues we'd introduced by marrying up Twitter.Bootstrap.MVC4 and the Bootstrap Datepicker&lt;/li&gt;&lt;li&gt;switched over to using the Andrew Rowls fork of Bootstrap Datepicker and made use of the internationalisation functionality it exposes.&lt;/li&gt;&lt;/ol&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4560332740682155168'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4560332740682155168'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2013/01/twitterbootstrapmvc4-meet-bootstrap_14.html' title='Twitter.Bootstrap.MVC4 meet Bootstrap Datepicker *and* get your Internationalization on...'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-9066088698325396956</id><published>2013-01-09T07:30:00.000Z</published><updated>2013-01-14T12:47:04.963Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='asp.net mvc'/><category scheme='http://www.blogger.com/atom/ns#' term='Twitter.Bootstrap.MVC4'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Responsive'/><category scheme='http://www.blogger.com/atom/ns#' term='Twitter Bootstrap'/><category scheme='http://www.blogger.com/atom/ns#' term='Bootstrap Datepicker'/><title type='text'>Twitter.Bootstrap.MVC4 meet Bootstrap Datepicker</title><content type='html'>&lt;h4&gt;Update 14/01/2013&lt;/h4&gt; &lt;p&gt;Since I wrote this I've taken things on a little further - to read about that go &lt;a href="http://icanmakethiswork.blogspot.co.uk/2013/01/twitterbootstrapmvc4-meet-bootstrap_14.html" target="_blank"&gt;here&lt;/a&gt;.&lt;/p&gt; &lt;h4&gt;Getting Responsive&lt;/h4&gt; &lt;p&gt;It's the new year, it's time for new things.  Long on my list of "things to do" was getting up to speed with &lt;a href="http://en.wikipedia.org/wiki/Responsive_web_design" target="_blank"&gt;Responsive web design&lt;/a&gt;.  No doubt like everyone else I've been hearing more and more about this over the last year (by the way there was a &lt;a href="http://mashable.com/2012/12/11/responsive-web-design/" target="_blank"&gt;good article on Mashable&lt;/a&gt; about this last month).  RWD (in case you don't already know) is pretty much about having web interfaces that format their presentation based on the device they're running to provide a good user experience.  (I kind of think of it as a &lt;a href="http://en.wikipedia.org/wiki/Write_once,_run_anywhere" target="_blank"&gt;write once, run anywhere&lt;/a&gt; approach - though hopefully without the negative connotations...)&lt;/p&gt; &lt;p&gt;Rather than diving straight in myself I'd heard at a user group that it might be worth taking &lt;a href="http://twitter.github.com/bootstrap/" target="_blank"&gt;Twitter Bootstrap&lt;/a&gt; as a baseline.  I'm a &lt;strike&gt;lazy&lt;/strike&gt; busy fellow so this sounded ideal.&lt;/p&gt; &lt;h4&gt;I like ASP.Net MVC...&lt;/h4&gt; &lt;p&gt;... and this flavoured my investigations.  I quickly stumbled on an &lt;a href="http://lostechies.com/erichexter/2012/11/20/twitter-bootstrap-mvc4-the-template-nuget-package-for-asp-net-mvc4-projects/ " target="_blank"&gt;article written by Eric Hexter&lt;/a&gt;. Eric had brought together Twitter Bootstrap and ASP.Net MVC 4 in a &lt;a href="http://nuget.org/packages/twitter.bootstrap.mvc4" target="_blank"&gt;NuGet package&lt;/a&gt;.  Excellent work chap!&lt;/p&gt;  &lt;p&gt;To get up and running with Eric's work was a straightforward proposition. I...&lt;/p&gt; &lt;ol&gt;&lt;li&gt;Created new MVC 4 application in Visual Studio called BootstrapMvcSample using the Empty Project Template.&lt;/li&gt;&lt;li&gt;Executed the following commands at the NuGet Package Manager Console: &lt;ul&gt;&lt;li&gt;&lt;code&gt;Install-Package twitter.bootstrap.mvc4&lt;/code&gt;&lt;/li&gt;&lt;li&gt;&lt;code&gt;Install-Package twitter.bootstrap.mvc4.sample&lt;/code&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/ol&gt; &lt;p&gt;Check out the responsive goodness I had when I ran it:&lt;/p&gt; &lt;div class="separator" style="clear: both; text-align: center;"&gt;&lt;a href="http://4.bp.blogspot.com/-2ytMlGLGRpo/UO1mqfi7yQI/AAAAAAAAAYs/RRuVGbr8nAg/s1600/TwitterBootstrapFullSize.png" imageanchor="1" style="margin-left:1em; margin-right:1em"&gt;&lt;img border="0" height="265" width="400" src="http://4.bp.blogspot.com/-2ytMlGLGRpo/UO1mqfi7yQI/AAAAAAAAAYs/RRuVGbr8nAg/s400/TwitterBootstrapFullSize.png" /&gt;&lt;/a&gt;&lt;br /&gt;It's big, big, big....&lt;/div&gt; &lt;div class="separator" style="clear: both; text-align: center;"&gt;&lt;a href="http://3.bp.blogspot.com/-780OCEuXoLw/UO1maRJ-CZI/AAAAAAAAAYg/chBHgYMAIJk/s1600/TwitterBootstrapTitchyTiny.png" imageanchor="1" style="margin-left:1em; margin-right:1em"&gt;&lt;img border="0" height="400" width="234" src="http://3.bp.blogspot.com/-780OCEuXoLw/UO1maRJ-CZI/AAAAAAAAAYg/chBHgYMAIJk/s400/TwitterBootstrapTitchyTiny.png" /&gt;&lt;/a&gt;&lt;br /&gt;and it's titchy, tiny small!&lt;/div&gt; &lt;p&gt;This is just 1 page, with &lt;code&gt;@media&lt;/code&gt; queries doing the heavy lifting.&lt;/p&gt; &lt;h4&gt;Bootstrap Datepicker&lt;/h4&gt; &lt;p&gt;The eagle-eyed amongst you will have noticed that the edit screen above features a date field.  I've long been a fan of datepickers to allow users to enter a date in an application in an intuitive fashion. Until native browser datepickers become the norm we'll be relying on some kind of component.  Up until now my datepicker of choice has been the &lt;a href="http://jqueryui.com/datepicker/" target="_blank"&gt;jQuery UI one&lt;/a&gt;.  Based on a quick Google it seemed that jQuery UI and Twitter Bootstrap were not necessarily natural bedfellows. (Though &lt;a href="http://addyosmani.github.com/jquery-ui-bootstrap/" target="_blank"&gt;Addy Osmani's jQuery UI Bootstrap&lt;/a&gt; shows some promise...)&lt;/p&gt; &lt;p&gt;Since I feared ending up down a blind alley I found myself casting around for a Twitter Bootstrap datepicker.  I quickly happened upon &lt;a href="http://www.eyecon.ro/bootstrap-datepicker/" target="_blank"&gt;Stefan Petre's Bootstrap Datepicker&lt;/a&gt; which looked just the ticket.&lt;/p&gt; &lt;h4&gt;Shake hands and play nice...&lt;/h4&gt; &lt;p&gt;Incorporating the Bootstrap Datepicker into Twitter.Bootstrap.MVC4 was actually a pretty straightforward affair.  I added the following datepicker assets to the ASP.Net MVC project as follows:&lt;/p&gt; &lt;ul&gt;&lt;li&gt;&lt;code&gt;bootstrap-datepicker.js&lt;/code&gt; was added to &lt;code&gt;~\Scripts&lt;/code&gt;.&lt;/li&gt;&lt;li&gt;&lt;code&gt;datepicker.css&lt;/code&gt; was added to &lt;code&gt;~\Content&lt;/code&gt;.  I renamed this file to &lt;code&gt;bootstrap-datepicker.css&lt;/code&gt; to stay in line with the other css files.&lt;/li&gt;&lt;/ul&gt; &lt;p&gt;Once this was done I amended the &lt;code&gt;BootstrapBundleConfig.cs&lt;/code&gt; bundles to include these assets.  Once this was done the bundle file looked like this:&lt;/p&gt; &lt;script src="https://gist.github.com/4529746.js?file=BootstrapBundleConfig.cs"&gt;&lt;/script&gt; &lt;p&gt;I then created this folder:&lt;code&gt;~\Views\Shared\EditorTemplates&lt;/code&gt;.  To this folder I added the following &lt;code&gt;Date.cshtml&lt;/code&gt; Partial to hold the datepicker EditorTemplate:  (Having this in place meant that properties with the &lt;code&gt;[DataType(DataType.Date)]&lt;/code&gt; attribute would automatically use this EditorTemplate when rendering an editor - I understand &lt;code&gt;[UIHint]&lt;/code&gt; attributes can be used to the same end.)&lt;/p&gt; &lt;script src="https://gist.github.com/4529746.js?file=Date.cshtml"&gt;&lt;/script&gt; &lt;p&gt;And finally I amended the &lt;code&gt;Create.cshtml&lt;/code&gt; View (which perhaps more accurately might be called the Edit View?) to include a bit of JavaScript at the bottom to initialise any datepickers on the screen.&lt;/p&gt; &lt;script src="https://gist.github.com/4529746.js?file=Create.cshtml"&gt;&lt;/script&gt; &lt;p&gt;Et voil - it works!&lt;/p&gt; &lt;div class="separator" style="clear: both; text-align: center;"&gt;&lt;a href="http://4.bp.blogspot.com/-_SfaYN2dfuk/UO2JmrqO_gI/AAAAAAAAAZA/Y904hmwcqaI/s1600/TwitterBootstrapDatepicker.png" imageanchor="1" style="margin-left:1em; margin-right:1em"&gt;&lt;img border="0" height="400" width="313" src="http://4.bp.blogspot.com/-_SfaYN2dfuk/UO2JmrqO_gI/AAAAAAAAAZA/Y904hmwcqaI/s400/TwitterBootstrapDatepicker.png" /&gt;&lt;/a&gt;&lt;br /&gt;A thing of beauty is a joy forever...&lt;/div&gt; &lt;p&gt;My thanks to &lt;a target="_blank" href="https://twitter.com/ehexter"&gt;Eric Hexter&lt;/a&gt; and Stefan Petre for doing all the hard work!&lt;/p&gt; &lt;h4&gt;Still to do&lt;/h4&gt; &lt;p&gt;I haven't really tested how this all fits together (if at all) with browsers running a non-English culture.  There may still be a little tinkering require to get that working...&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/9066088698325396956'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/9066088698325396956'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2013/01/twitterbootstrapmvc4-meet-bootstrap.html' title='Twitter.Bootstrap.MVC4 meet Bootstrap Datepicker'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='http://4.bp.blogspot.com/-2ytMlGLGRpo/UO1mqfi7yQI/AAAAAAAAAYs/RRuVGbr8nAg/s72-c/TwitterBootstrapFullSize.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6628728608690018897</id><published>2013-01-03T05:30:00.000Z</published><updated>2013-01-03T12:58:49.141Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='wkhtmltopdf'/><category scheme='http://www.blogger.com/atom/ns#' term='html'/><category scheme='http://www.blogger.com/atom/ns#' term='WCF'/><category scheme='http://www.blogger.com/atom/ns#' term='pdf'/><title type='text'>HTML to PDF using a WCF Service</title><content type='html'>&lt;h4&gt;TL; DR - "Talk is cheap.  Show me the code."&lt;/h4&gt; &lt;p&gt;Some time ago I wrote a &lt;a href="http://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html" target="_blank"&gt;post which demonstrated how you could make PDFs from HTML&lt;/a&gt; using C# and &lt;a href="http://code.google.com/p/wkhtmltopdf/" target="_blank"&gt;wkhtmltopdf&lt;/a&gt;.  To my lasting surprise this has been the most popular post I've written.  I recently put together an ASP.NET WCF service which exposed this functionality which I thought might be worth sharing.  The code can be found on GitHub &lt;a href="https://github.com/johnnyreilly/PdfMakerWcfService" target="_blank"&gt;here&lt;/a&gt;.&lt;/p&gt; &lt;h4&gt;A little more detail&lt;/h4&gt; &lt;p&gt;I should say up front that I'm still a little ambivalent about how sensible an idea this is.  Behind the scenes this WCF service is remotely firing up wkhtmltopdf using &lt;code&gt;System.Diagnostics.Process&lt;/code&gt;.  I feel a little wary about recommending this as a solution for a variety of not particularly defined reasons.  However, I have to say I've found this pretty stable and reliable.  Bottom line it seems to work and work consistently.  But I though I should include a caveat emptor; there is probably a better approach than this available. Anyway...&lt;/p&gt; &lt;p&gt;There isn't actually a great deal to say about this WCF service.  It should (hopefully) just do what it says on the tin.  Putting it together didn't involve a great deal of work; essentially it takes the code from the initial blog post and just wraps it in a WCF service called &lt;code&gt;PdfMaker&lt;/code&gt;.  The service exposes 2 methods:&lt;/p&gt; &lt;ol&gt;&lt;li&gt;&lt;code&gt;GetPdf&lt;/code&gt; - given a supplied URL this method creates a PDF and then returns it as a Stream to the client&lt;/li&gt;&lt;li&gt;&lt;code&gt;GetPdfUrl&lt;/code&gt; - given a supplied URL this method creates a PDF and then returns the location of it to the client&lt;/li&gt;&lt;/ol&gt; &lt;p&gt;Both of these methods also set a Location header in the response indicating the location of the created PDF.&lt;/p&gt; &lt;h4&gt;That which binds us&lt;/h4&gt; &lt;p&gt;The service uses &lt;code&gt;webHttpBinding&lt;/code&gt;.  This is commonly employed when people want to expose a RESTful WCF service.  The reason I've used this binding is I wanted a simple "in" when calling the service.  I wanted to be able to call the service via AJAX as well as directly by browsing to the service and supplying a URL-encoded URL like this:&lt;/p&gt; &lt;code style="font-size: 7.5pt;"&gt;http://localhost:59002/PdfMaker.svc/GetPdf?url=http%3A%2F%2Fnews.ycombinator.com/&lt;/code&gt; &lt;p&gt;You may wonder why I'm using &lt;a href="http://news.ycombinator.com" target="_blank"&gt;http://news.ycombinator.com&lt;/a&gt; for the example above.  I chose this as Hacker News is a very simple site; very few resources and a small page size.  This means the service has less work to do when creating the PDF; it's a quick demo.&lt;/p&gt; &lt;p&gt;I should say that this service is arguably &lt;em&gt;*not*&lt;/em&gt; completely RESTful as each GET operation behind the scenes attempts to create a new PDF (arguably a side-effect).  These should probably be POST operations as they create a new resource each time they're hit.  However, if they were I wouldn't be able to just enter a URL into a browser for testing and that's really useful.  So tough, I shake my fist at the devotees of pure REST on this occasion. (If I should be attacked in the street shortly after this blog is posted then the police should be advised this is good line of inquiry...)&lt;/p&gt; &lt;h4&gt;Good behaviour&lt;/h4&gt; &lt;p&gt;It's worth noting that &lt;code&gt;automaticFormatSelectionEnabled&lt;/code&gt; set to true on the behaviour so that content negotiation is enabled.  Obviously for the &lt;code&gt;GetPdf&lt;/code&gt; action this is rather meaningless as it's a stream that's passed back.  However, for the &lt;code&gt;GetPdfUrl&lt;/code&gt; action the returned string can either be JSON or XML.  The Fiddler screenshots below demonstrate this in action:&lt;/p&gt; &lt;div class="separator" style="clear: both; text-align: center;"&gt;&lt;a href="http://4.bp.blogspot.com/-CX7w0jI0jTE/UOVaDP5Ae-I/AAAAAAAAAXk/H7zhyYYjPGA/s1600/GetPdfUrl%2B-%2BJSON.png" imageanchor="1" style="margin-left:1em; margin-right:1em"&gt;&lt;img border="0" height="234" width="400" src="http://4.bp.blogspot.com/-CX7w0jI0jTE/UOVaDP5Ae-I/AAAAAAAAAXk/H7zhyYYjPGA/s400/GetPdfUrl%2B-%2BJSON.png" /&gt;&lt;/a&gt;&lt;br /&gt;JSON&lt;/div&gt; &lt;div class="separator" style="clear: both; text-align: center;"&gt;&lt;a href="http://4.bp.blogspot.com/-78GBDqI596I/UOVaTchTbBI/AAAAAAAAAXw/rz2Dg4g8BRs/s1600/GetPdfUrl%2B-%2BXML.png" imageanchor="1" style="margin-left:1em; margin-right:1em"&gt;&lt;img border="0" height="234" width="400" src="http://4.bp.blogspot.com/-78GBDqI596I/UOVaTchTbBI/AAAAAAAAAXw/rz2Dg4g8BRs/s400/GetPdfUrl%2B-%2BXML.png" /&gt;&lt;/a&gt;&lt;br /&gt;XML&lt;/div&gt; &lt;h4&gt;Test Harness&lt;/h4&gt; &lt;p&gt;As a final touch I added in a test harness in the form of &lt;code&gt;Demo.aspx&lt;/code&gt;.  If you browse to it you'll see a screen a little like this:&lt;/p&gt; &lt;div class="separator" style="clear: both; text-align: center;"&gt;&lt;a href="http://2.bp.blogspot.com/-zoyt7ufl9FQ/UOVmD0VPh0I/AAAAAAAAAYE/DnmZmbx-Mxc/s1600/PdfMakerDemo.png" imageanchor="1" style="margin-left:1em; margin-right:1em"&gt;&lt;img border="0" height="238" width="400" src="http://2.bp.blogspot.com/-zoyt7ufl9FQ/UOVmD0VPh0I/AAAAAAAAAYE/DnmZmbx-Mxc/s400/PdfMakerDemo.png" /&gt;&lt;/a&gt;&lt;/div&gt; &lt;p&gt;It's fairly self-explanatory as you can see.  And here's an example of the output generated when pointing at Hacker News:&lt;/p&gt; &lt;iframe src="https://docs.google.com/file/d/0B87K8-qxOZGFMGNCUWRneUFsVFU/preview" width="500" height="500"&gt;&lt;/iframe&gt; &lt;p&gt;And that's it.  If there was a need this service could be easily extended to leverage the &lt;a href="http://madalgo.au.dk/~jakobt/wkhtmltoxdoc/wkhtmltopdf-0.9.9-doc.html" target="_blank"&gt;various options&lt;/a&gt; that wkhtmltopdf makes available. Hope people find it useful.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/6628728608690018897'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/6628728608690018897'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2013/01/html-to-pdf-using-wcf-service.html' title='HTML to PDF using a WCF Service'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='http://4.bp.blogspot.com/-CX7w0jI0jTE/UOVaDP5Ae-I/AAAAAAAAAXk/H7zhyYYjPGA/s72-c/GetPdfUrl%2B-%2BJSON.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-90505729094565047</id><published>2012-12-01T05:53:00.000Z</published><updated>2012-12-01T05:53:03.513Z</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Sending email from Windows Azure</title><content type='html'>  approaches to use to send email - stackoverflow  install sendgrid  use sendgrid  https://www.windowsazure.com/en-us/develop/net/how-to-guides/sendgrid-email-service/  </content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/90505729094565047'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/90505729094565047'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8425857934687550846</id><published>2012-11-28T10:01:00.002Z</published><updated>2012-11-28T10:01:57.098Z</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Bloomberg WCF service</title><content type='html'>BloombergShared project  IBloomberg.cs:  using System; using System.Collections.Generic; using System.Linq; using System.Text; using System.ServiceModel;  namespace My.Bloomberg {     // Define a service contract.     [ServiceContract()]     public interface IBloomberg     {         [OperationContract]         Dictionary&lt;string,             //Security             Dictionary&lt;string, object&gt; //Fields and values             &gt; GetSecuritiesFields(string[] securities, string[] fields);          [OperationContract]         Dictionary&lt;string,              //Security             Dictionary&lt;DateTime,        //DateTime of security             Dictionary&lt;string, object&gt;&gt; //Fields and values             &gt; GetSecuritiesFieldsByDate(string[] securities, string[] fields, DateTime startDate, DateTime endDate);          [OperationContract]         void ReInitialise();     } }  BloombergConsoleService project (console project - add reference to Bloomberglp.Blpapi.dll - the Bloomberg Open API and add reference to BloombergShared)  BloombergService.cs:  using System; using System.Linq; using System.Configuration; using System.ServiceModel; using System.Collections.Generic;  namespace My.Bloomberg {      // Service class which implements the service contract.     // Added code to write output to the console window     public class BloombergService : IBloomberg     {         #region WCF Service host          private static BloombergApi _bloombergApi = null;          // Host the service within this EXE console application.         public static void Main()         {             // Create a ServiceHost for the BloombergService type.             using (ServiceHost serviceHost = new ServiceHost(typeof(BloombergService)))             {                 //Initialise the bloomberg client                 Console.WriteLine("Initialising Bloomberg API...");                 _bloombergApi = new BloombergApi();                 _bloombergApi.InitialiseSessionAndService();                  // Open the ServiceHost to create listeners and start listening for messages.                 Console.WriteLine("Opening the service host...");                 serviceHost.Open();                  // The service can now be accessed.                 Console.WriteLine("The service is ready.");                  Console.WriteLine("Press &lt;ENTER&gt; to terminate service.");                 Console.ReadLine();                  Console.WriteLine("Closing...");                 _bloombergApi.DisposeSessionAndService();                 serviceHost.Close();             }         }          #endregion          #region Methods          public Dictionary&lt;string,      //Security             Dictionary&lt;string, object&gt; //Fields and values             &gt; GetSecuritiesFields(string[] securities, string[] fields)          {             return _bloombergApi.GetSecuritiesFields(securities, fields);         }          public Dictionary&lt;string,       //Security             Dictionary&lt;DateTime,        //DateTime of security             Dictionary&lt;string, object&gt;&gt; //Fields and values             &gt; GetSecuritiesFieldsByDate(string[] securities, string[] fields, DateTime startDate, DateTime endDate)         {             return _bloombergApi.GetSecuritiesFieldsByDate(securities, fields, startDate, endDate);         }          /// &lt;summary&gt;        /// Dispose and then re-initialise the Bloomberg Session / Service         /// It's uncertain that this method will be necessary but has been included just in case there is a         /// need to recycle the Bloomberg Session / Service without going to the trouble of stopping and starting          /// the service         /// &lt;/summary&gt;        public void ReInitialise()         {             Console.WriteLine("Re-initialising...");              _bloombergApi.DisposeSessionAndService();             _bloombergApi.InitialiseSessionAndService();              Console.WriteLine("Re-initialised.");         }          #endregion     } }  BloombergApi.cs:  using System; using System.Collections.Generic; using System.Linq; using System.Text;  using Bloomberglp.Blpapi;  namespace My.Bloomberg {     class BloombergApi     {         #region Members / Contructors / Destructors          private Session _session = null;         private Service _refDataService = null;          private readonly string _serverHost;         private readonly int _serverPort;          public BloombergApi(string serverHost = "localhost", int serverPort = 8194)         {             _serverHost = serverHost;             _serverPort = serverPort;         }          /// &lt;summary&gt;        /// Initialise the Session and the Service         /// &lt;/summary&gt;        internal void InitialiseSessionAndService()         {             if (_session == null)             {                 var sessionOptions = new SessionOptions                 {                     ServerHost = _serverHost,                     ServerPort = _serverPort                 };                  //Console.WriteLine("Connecting to {0}:{1}", sessionOptions.ServerHost, sessionOptions.ServerPort);                  _session = new Session(sessionOptions);                  if (!_session.Start())                     throw new Exception("Failed to connect!");                  if (!_session.OpenService("//blp/refdata"))                 {                     _session.Stop();                     _session = null;                      throw new Exception("Failed to open //blp/refdata");                 }                  _refDataService = _session.GetService("//blp/refdata");             }         }          /// &lt;summary&gt;        /// Dispose the Session and the Service         /// &lt;/summary&gt;        internal void DisposeSessionAndService()         {             _refDataService = null;              //Stop the session             if (_session != null)             {                 _session.Stop();                 _session = null;             }         }          #endregion          #region Methods          internal Dictionary&lt;string,    //Security             Dictionary&lt;string, object&gt; //Fields and values             &gt; GetSecuritiesFields(string[] securities, string[] fields)         {             try             {                 var securitiesFields = new Dictionary&lt;string, Dictionary&lt;string, object&gt;&gt;();                  //Create request                 var referenceDataRequest = _refDataService.CreateRequest("ReferenceDataRequest");                  //Securities                 var securitiesElement = referenceDataRequest.GetElement("securities");                 foreach (var security in securities.Distinct())                     securitiesElement.AppendValue(security);                  //Fields                 var fieldsElement = referenceDataRequest.GetElement("fields");                 foreach (var field in fields.Distinct())                     fieldsElement.AppendValue(field);                  //   Send off request                 _session.SendRequest(referenceDataRequest, null);                  //   Start with our flag set to False for not done                 var done = false;                  //   Continue as long as we are not done                 while (!done)                 {                     //   Retrieve next event from the server                     var eventObj = _session.NextEvent();                      //   As long as we have a partial or final response, start to process data                     if (eventObj.Type == Event.EventType.RESPONSE ||                         eventObj.Type == Event.EventType.PARTIAL_RESPONSE)                     {                         //  Loop through messages                         foreach (Message msg in eventObj)                         {                             //   Error handler in case of problem which throws meaningful exception                             if (msg.AsElement.HasElement("responseError"))                                 throw new Exception("Response error:  " + msg.GetElement("responseError").GetElement("message"));                              //   Extract the securityData top layer and the field data                             //   History comes back on a single security basis so no looping there                             var securityDataArray = msg.GetElement("securityData");                              //   Loop through each security                             for (var i = 0; i &lt; securityDataArray.NumValues; i++)                             {                                 //   First take out the security object...                                 var security = securityDataArray.GetValueAsElement(i);                                 var securityName = security.GetElementAsString("security");                                  //   ... then extract the fieldData object                                 var fieldData = security.GetElement("fieldData");                                  //If we need to add a new security to the securitiesFields dictionary then do so                                 Dictionary&lt;string, object&gt; results = null;                                 if (!securitiesFields.ContainsKey(securityName))                                     securitiesFields.Add(securityName, new Dictionary&lt;string, object&gt;());                                  //Get the fieldsByDate dictionary from the securitiesFields dictionary                                 results = securitiesFields[securityName];                                  //Extract results and store in results dictionary                                 foreach (var dataElement in fieldData.Elements)                                 {                                     var dataElementName = dataElement.Name.ToString();                                      //Not using this at present - just demonstrating that we can                                     switch (dataElement.Datatype)                                     {                                         //Special handling to co-erce bloomberg datetimes back to standard .NET datetimes                                         case Schema.Datatype.DATE:                                             results.Add(dataElementName, dataElement.GetValueAsDate().ToSystemDateTime());                                             break;                                         case Schema.Datatype.DATETIME:                                             results.Add(dataElementName, dataElement.GetValueAsDatetime().ToSystemDateTime());                                             break;                                         case Schema.Datatype.TIME:                                             results.Add(dataElementName, dataElement.GetValueAsDatetime().ToSystemDateTime());                                             break;                                          //Standard handling                                         default:                                             results.Add(dataElementName, dataElement.GetValue());                                             break;                                     }                                 }                             }                         }                          //   Once we have a response we are done                         if (eventObj.Type == Event.EventType.RESPONSE) done = true;                     }                 }                  return securitiesFields;             }             catch (Exception exc)              {                 //Throw meaningful exception                 throw new Exception(string.Format(                     "Problem encountered calling GetSecuritiesFields\r\n\r\nsecurities: {0}\r\nfields: {1}",                     (securities == null) ? "null" : string.Join(", ", securities),                     (fields == null) ? "null" : string.Join(", ", fields)                     ), exc);              }         }                  internal Dictionary&lt;string,     //Security             Dictionary&lt;DateTime,        //DateTime of security             Dictionary&lt;string, object&gt;&gt; //Fields and values             &gt; GetSecuritiesFieldsByDate(string[] securities, string[] fields, DateTime startDate, DateTime endDate)         {             try             {                 var securitiesFieldsByDate = new Dictionary&lt;string, Dictionary&lt;DateTime, Dictionary&lt;string, object&gt;&gt;&gt;();                  //Create request                 var historyDataRequest = _refDataService.CreateRequest("HistoricalDataRequest");                  //Securities                 var securitiesElement = historyDataRequest.GetElement("securities");                 foreach (var security in securities.Distinct())                     securitiesElement.AppendValue(security);                  //Fields                 var fieldsElement = historyDataRequest.GetElement("fields");                 foreach (var field in fields.Distinct())                     fieldsElement.AppendValue(field);                  //   Set the start date and end date as YYYYMMDD strings                 historyDataRequest.Set("startDate", startDate.ToString("yyyyMMdd"));                 historyDataRequest.Set("endDate", endDate.ToString("yyyyMMdd"));                  //   Send off request                 _session.SendRequest(historyDataRequest, null);                  //   Start with our flag set to False for not done                 var done = false;                  //   Continue as long as we are not done                 while (!done)                 {                     //   Retrieve next event from the server                     var eventObj = _session.NextEvent();                      //   As long as we have a partial or final response, start to process data                     if (eventObj.Type == Event.EventType.RESPONSE ||                         eventObj.Type == Event.EventType.PARTIAL_RESPONSE)                     {                         //  Loop through messages                         foreach (Message msg in eventObj)                         {                             //   Error handler in case of problem which throws meaningful exception                             if (msg.AsElement.HasElement("responseError"))                                 throw new Exception("Response error:  " + msg.GetElement("responseError").GetElement("message"));                              //   Extract the securityData top layer and the field data                             //   History comes back on a single security basis so no looping there                             var security = msg.GetElement("securityData");                             var securityName = security.GetElementAsString("security");                             var fieldData = security.GetElement("fieldData");                              //   Extract the data for each requested field                             for (var i = 0; i &lt; fieldData.NumValues; i++)                             {                                 var data = fieldData.GetValueAsElement(i);                                  //   First get the date - this is our key                                 var date = data.GetElementAsDate("date").ToSystemDateTime();                                  //If we need to add a new security to the securitiesFieldsByDate dictionary then do so                                 Dictionary&lt;DateTime, Dictionary&lt;string, object&gt;&gt; fieldsByDate = null;                                 if (!securitiesFieldsByDate.ContainsKey(securityName))                                     securitiesFieldsByDate.Add(securityName, new Dictionary&lt;DateTime, Dictionary&lt;string, object&gt;&gt;());                                  //Get the fieldsByDate dictionary from the securitiesFieldsByDate dictionary                                 fieldsByDate = securitiesFieldsByDate[securityName];                                  //Extract results and store in results dictionary                                 var results = new Dictionary&lt;string, object&gt;();                                 foreach (var dataElement in data.Elements)                                 {                                     var dataElementName = dataElement.Name.ToString();                                      //Not using this at present - just demonstrating that we can                                     switch (dataElement.Datatype)                                     {                                         //Special handling to co-erce bloomberg datetimes back to standard .NET datetimes                                         case Schema.Datatype.DATE:                                             results.Add(dataElementName, dataElement.GetValueAsDate().ToSystemDateTime());                                             break;                                         case Schema.Datatype.DATETIME:                                             results.Add(dataElementName, dataElement.GetValueAsDatetime().ToSystemDateTime());                                             break;                                         case Schema.Datatype.TIME:                                             results.Add(dataElementName, dataElement.GetValueAsDatetime().ToSystemDateTime());                                             break;                                          //Standard handling                                         default:                                             results.Add(dataElementName, dataElement.GetValue());                                             break;                                     }                                 }                                  //Save results dictionary to fieldsByDate dictionary                                 fieldsByDate.Add(date, results);                             }                         }                          //   Once we have a response we are done                         if (eventObj.Type == Event.EventType.RESPONSE) done = true;                     }                 }                  return securitiesFieldsByDate;             }             catch (Exception exc)             {                 //Throw meaningful exception                 throw new Exception(string.Format(                     "Problem encountered calling GetSecuritiesFieldsByDate\r\n\r\nsecurities: {0}\r\nfields: {1}\r\nstartDate: {2}\r\nendDate: {3}",                     (securities == null) ? "null" : string.Join(", ", securities),                     (fields == null) ? "null" : string.Join(", ", fields),                     startDate,                     endDate                     ), exc);              }         }          #endregion     } }  App.config:  &lt;?xml version="1.0"?&gt;&lt;configuration&gt;  &lt;system.serviceModel&gt;    &lt;behaviors&gt;      &lt;serviceBehaviors&gt;        &lt;behavior name=""&gt;          &lt;serviceDebug includeExceptionDetailInFaults="true" /&gt;        &lt;/behavior&gt;      &lt;/serviceBehaviors&gt;    &lt;/behaviors&gt;    &lt;services&gt;      &lt;service behaviorConfiguration="" name="My.Bloomberg.BloombergService"&gt;        &lt;endpoint address="net.tcp://localhost:8008/Bloomberg"                    binding="netTcpBinding"                    bindingConfiguration="WindowsClientOverTcp"                    name="WindowsClientOverTcp"                    contract="My.Bloomberg.IBloomberg"/&gt;      &lt;/service&gt;    &lt;/services&gt;    &lt;bindings&gt;      &lt;netTcpBinding&gt;        &lt;binding name="WindowsClientOverTcp"&gt;          &lt;security mode="None"/&gt;        &lt;/binding&gt;      &lt;/netTcpBinding&gt;    &lt;/bindings&gt;    &lt;client/&gt;  &lt;/system.serviceModel&gt;   &lt;startup&gt;    &lt;supportedRuntime version="v4.0" sku=".NETFramework,Version=v4.0"/&gt;  &lt;/startup&gt;&lt;/configuration&gt; BloombergConsoleClient project (reference to BloombergShared)  BloombergClient.cs:  using System; using System.Linq; using System.ServiceModel; using System.Collections.Generic;  namespace My.Bloomberg {     //Client implementation code.     class BloombergClient     {         static void Main()         {             // Create a client             var channelFactory = new ChannelFactory&lt;IBloomberg&gt;("NetTcpBinding_IBloomberg");             var bloombergClient = channelFactory.CreateChannel();              var endDateTime = DateTime.Today;             var startDateTime = endDateTime.AddDays(-4);              var liborEuriborSecurities = new string[] { "BP0001M Index", "BP0003M Index", "BP0006M Index", "EUR001M Index", "EUR003M Index", "EUR006M Index" };             var fxRateSecurities = new string[] { "AUDEUR CURNCY", "CADEUR CURNCY", "CHFEUR CURNCY", "CZKEUR CURNCY", "DKKEUR CURNCY", "EKKEUR CURNCY", "GBPEUR CURNCY", "HKDEUR CURNCY", "JPYEUR CURNCY", "KYDEUR CURNCY", "PLNEUR CURNCY", "SEKEUR CURNCY", "SGDEUR CURNCY", "USDEUR CURNCY" };             var insuranceSecurities = new string[] { "245891Q GR Equity", "340849Z US Equity", "1392170Z LN Equity", "1378Z NA Equity", "211730Z FP Equity", "ALV GR Equity", "2153908Z GR Equity", "HPI INS 009 Equity", "1779Z LN Equity", "HPI INS 017 Equity", "1367T US Equity", "LFV1 GR Equity", "ZURN VX Equity", "1401322Z LN Equity", "3560997Z NA Equity", "G IM Equity", "1255Z NA Equity", "1817Z LN Equity", "223378Z FP Equity", "HPI INS 032 Equity", "DRUB BB Equity", "1255239Z LN Equity", "HPI INS 011 Equity", "1276826Z LN Equity", "1433Z NA Equity", "AX7 GR Equity", "1283Z SW Equity", "HPI INS 018 Equity", "HPI INS 019 Equity", "4529Z GR Equity", "HPI INS 012 Equity", "HPI INS 004 Equity", "HPI INS 002 Equity", "HPI INS 016 Equity", "HPI INS 031 Equity", "4860Z US Equity", "2569Z GR Equity", "HPI INS 020 Equity", "HPI INS 021 Equity", "HPI INS 022 Equity", "VIV GR Equity", "EVG2 GR Equity", "HPI INS 023 Equity", "HPI INS 001 Equity", "6648Z US Equity", "FDRL US Equity", "1025Z FH Equity", "2395Z GR Equity", "HPI INS 013 Equity", "GEVE AV Equity", "3662266Z GR Equity", "HPI INS 003 Equity", "4603Z GR Equity", "1782Z GR Equity", "1265Z NA Equity", "1561Z LN Equity", "IF SS Equity", "ASIT IM Equity", "1142Z BB Equity", "HPI INS 024 Equity", "HPI INS 025 Equity", "HPI INS 005 Equity", "HPI INS 015 Equity", "8752 JP Equity", "HPI INS 026 Equity", "17038Z US Equity", "1270Z NA Equity", "NAVG Equity", "POH1V FH Equity", "HPI INS 027 Equity", "1477722Z LN Equity", "1266Z NA Equity", "RVLV GR Equity", "5474Z LN Equity", "HPI INS 028 Equity", "2147700Z Equity", "IDUN GR Equity", "3622Z Equity", "HPI INS 014 Equity", "1028Z FH Equity", "HPI INS 029 Equity", "3643143Z LN Equity", "HPI INS 007 Equity", "2420Z GR Equity", "HPI INS 030 Equity", "3035Z GR Equity", "HPI INS 008 Equity", "44896Z US Equity", "1010Q SW Equity", "HPI INS 006 Equity", "HPI INS 010 Equity" };             var bankSecurities = new string[] { "ARL GR Equity", "1597Z Equity", "3531454Z NA Equity", "1171Z GR Equity", "AALX LX Equity", "AL/ LN Equity", "BTO SM Equity", "SAN SM Equity", "15581Z Equity", "BKIR LN Equity", "HPI BANK 001 Equity", "BSCT LN Equity", "HPI BANK 002 Equity", "220035Z FP Equity", "BCBEY Equity", "HPI BANK 003 Equity", "4076401Z SW Equity", "BLGZ GR Equity", "2314Z GR Equity", "BHH GR Equity", "BGL LX Equity", "BNP FP Equity", "211382Z FP Equity", "2408Z LN Equity", "8156Z Equity", "1838Z LN Equity", "5455Z LN Equity", "CBK GR Equity", "ACA FP Equity", "211502Z FP Equity", "FF FP Equity", "CL FP Equity", "CC FP Equity", "1223Z GR Equity", "225226Z FP", "CSGN VX Equity", "DANSKE DC Equity", "DBK GR Equity", "1152Z GR Equity", "DPB GR Equity", "BIL LX Equity", "1800Z GR Equity", "EBS AV Equity", "HPI BANK 004 Equity", "2131180Z LN Equity", "1473Z GR Equity", "1193Z NA Equity", "FBAVP BB Equity", "7522804Z GR Equity", "MID LN Equity", "TUB GR Equity", "9000Z GR Equity", "4968389Z CP Equity", "HYPINT GR Equity", "1111Z NA Equity", "103452Z LX Equity", "ISP IM Equity", "197942Z GR Equity", "8147Z Equity", "HPI BANK 005 Equity", "KBC BB Equity", "2525Z GR Equity", "LBB1 GR Equity", "2482Z GR Equity", "1254Z GR Equity", "NWB LN Equity", "KN FP Equity", "HPI BANK 006 Equity", "1045Z FH Equity", "RABO NA Equity", "1171Z NA Equity", "HPI BANK 007 Equity", "2783Z LN Equity", "ANL LN Equity", "BFGW GR Equity", "EYP ET Equity", "1372058Z LN Equity", "SEBA SS Equity", "1012Z NA Equity", "GLE FP Equity", "HPI BANK 008 Equity", "1052Z GR Equity", "HPI BANK 009 Equity", "3899Z Equity", "SHBA SS Equity", "SYDB DC Equity", "1054Z NA Equity", "HPI BANK 010 Equity", "UBS SW Equity", "HVM GR Equity", "BACA AV Equity", "2448Z GR Equity", "3920Z Equity", "HPI BANK 011 Equity", "1096Z GR Equity", "WESTLB GR Equity", "3559183Z PW Equity" };              var liborEuriborFields = new string[] { "PX_LAST", "PREV_CLOSE_VALUE_REALTIME", "CHG_NET_1D", "CHG_PCT_1D", "CHG_PCT_YTD" };             var fxRateFields = new string[] { "LAST_PRICE" };             var insuranceFields = new string[] { "RTG_SP_FINANCIAL_STRENGTH", "RTG_FITCH_FINANCIAL_STRENGTH", "RTG_MDY_INSUR_FIN_STRENGTH" };             var bankFields = new string[] { "RTG_SP_LT_LC_ISSUER_CREDIT", "RTG_SP_ST_LC_ISSUER_CREDIT", "RTG_FITCH_ST_ISSUER_default", "RTG_FITCH_LT_ISSUER_default", "RTG_MDY_SHORT_TERM_DEBT", "RTG_MDY_FOREIGN_LT_BANK_DEPOSITS" };              //Libor / Euribor             WriteOutSecuritiesFields(bloombergClient.GetSecuritiesFields(liborEuriborSecurities, liborEuriborFields));             WriteOutSecuritiesFieldsByDate(bloombergClient.GetSecuritiesFieldsByDate(liborEuriborSecurities, liborEuriborFields, startDateTime, endDateTime));              //FX rates             WriteOutSecuritiesFields(bloombergClient.GetSecuritiesFields(fxRateSecurities, fxRateFields));             WriteOutSecuritiesFieldsByDate(bloombergClient.GetSecuritiesFieldsByDate(fxRateSecurities, fxRateFields, startDateTime, endDateTime));              //Insurance             WriteOutSecuritiesFields(bloombergClient.GetSecuritiesFields(insuranceSecurities, insuranceFields));              //Bank             WriteOutSecuritiesFields(bloombergClient.GetSecuritiesFields(bankSecurities, bankFields));              /*             Console.WriteLine("Re-initialising...");             client.ReInitialise();             Console.WriteLine("Re-initialised.");             */              //Closing the client gracefully closes the connection and cleans up resources             ((IClientChannel)bloombergClient).Close();             channelFactory.Close();              Console.WriteLine();             Console.WriteLine("Press &lt;ENTER&gt; to terminate client.");             Console.ReadLine();         }          /// &lt;summary&gt;        /// Write out the a set of securities fields to the console         /// &lt;/summary&gt;        /// &lt;param name="securitesAndFields"&gt;&lt;/param&gt;        private static void WriteOutSecuritiesFields(Dictionary&lt;string, Dictionary&lt;string, object&gt;&gt; securitesAndFields)         {             Console.WriteLine("** SecuritiesFields **");              foreach (var securityAndFields in securitesAndFields.OrderBy(d =&gt; d.Key))             {                 Console.WriteLine();                 Console.WriteLine("* Security: {0}", securityAndFields.Key);                 Console.WriteLine();                  foreach (var keyValue in securityAndFields.Value)                     Console.WriteLine("{0}: {1} ({2})", keyValue.Key, keyValue.Value, keyValue.Value.GetType());             }             Console.WriteLine();         }          /// &lt;summary&gt;        /// Write out the a set of securities fields by date to the console         /// &lt;/summary&gt;        /// &lt;param name="securitiesFieldsByDate"&gt;&lt;/param&gt;        private static void WriteOutSecuritiesFieldsByDate(Dictionary&lt;string, Dictionary&lt;DateTime, Dictionary&lt;string, object&gt;&gt;&gt; securitiesFieldsByDate)         {             Console.WriteLine("** SecuritiesFieldsByDate **");              //Loop by security             foreach (var security in securitiesFieldsByDate)             {                 Console.WriteLine();                 Console.WriteLine("* Security: {0}", security.Key);                 Console.WriteLine();                  //Loop by date                 foreach (var dateAndFields in security.Value.OrderBy(d =&gt; d.Key))                 {                     Console.WriteLine("* Date: {0}", dateAndFields.Key.ToString("yyyy-MM-dd"));                      //Loop by field                     foreach (var keyValue in dateAndFields.Value)                     {                         Console.WriteLine("{0}: {1} ({2})", keyValue.Key, keyValue.Value, keyValue.Value.GetType());                     }                 }             }             Console.WriteLine();         }     } }  App.config:  &lt;?xml version="1.0"?&gt;&lt;configuration&gt;  &lt;system.serviceModel&gt;    &lt;bindings&gt;      &lt;netTcpBinding&gt;        &lt;binding name="NetTcpBinding_IBloomberg"&gt;          &lt;security mode="None"/&gt;        &lt;/binding&gt;      &lt;/netTcpBinding&gt;    &lt;/bindings&gt;    &lt;client&gt;        &lt;endpoint          address="net.tcp://MyServer:8008/Bloomberg"          binding="netTcpBinding"          bindingConfiguration="NetTcpBinding_IBloomberg"          contract="My.Bloomberg.IBloomberg"          name="NetTcpBinding_IBloomberg"&gt;      &lt;/endpoint&gt;    &lt;/client&gt;  &lt;/system.serviceModel&gt;     &lt;startup&gt;    &lt;supportedRuntime version="v4.0" sku=".NETFramework,Version=v4.0"/&gt;  &lt;/startup&gt;&lt;/configuration&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8425857934687550846'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8425857934687550846'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1492382956545126674</id><published>2012-11-13T21:30:00.000Z</published><updated>2013-01-10T13:00:20.922Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='.NET'/><category scheme='http://www.blogger.com/atom/ns#' term='c#'/><category scheme='http://www.blogger.com/atom/ns#' term='Bloomberg'/><category scheme='http://www.blogger.com/atom/ns#' term='Open API'/><title type='text'>Getting up to speed with Bloomberg's Open API...</title><content type='html'>&lt;p&gt;A good portion of any devs life is usually spent playing with APIs.  If you need to integrate some other system into the system you're working on (and it's rare to come upon a situation where this doesn't happen at some point) then it's API time.&lt;/p&gt; &lt;p&gt;Some APIs are well documented and nice to use.  Some aren't.  I recently spent a goodly period of time investigating &lt;a href="http://www.openbloomberg.com/open-api/" target="_blank"&gt;Bloomberg's Open API&lt;/a&gt; and it was a slightly painful experience.  So much so that I thought it best to write up my own experiences and maybe I can save others time and a bit of pain.&lt;/p&gt; &lt;p&gt;Also, as I investigated the Bloomberg Open API I found myself coming up with my own little mini-C#-API.  (It's generally a sure sign you've found an API you don't love if you end up writing your own wrapper.)  This mini API did the heavy lifting for me and just handed back nicely structured data to deal with.  I have included this wrapper here as well.&lt;/p&gt; &lt;h4&gt;Research&lt;/h4&gt; &lt;p&gt;The initial plan was to, through code, extract Libor and Euribor rates from Bloomberg.  I had access to a Bloomberg terminal and I had access to the internet - what could stop me?  After digging around for a little while I found some useful resources that could be accessed from the Bloomberg terminal:&lt;/p&gt; &lt;ol&gt;&lt;li&gt;Typing &lt;code&gt;WAPI&amp;lt;GO&amp;gt;&lt;/code&gt; into Bloomberg lead me to the Bloomberg API documentation.&lt;/li&gt;&lt;li&gt;Typing &lt;code&gt;DOCS 2055451&amp;lt;GO&amp;gt;&lt;/code&gt; into Bloomberg (I know - it's a bit cryptic) provided me with samples of how to use the Bloomberg API in VBA&lt;/li&gt;&lt;/ol&gt; &lt;div class="separator" style="clear: both; text-align: center;"&gt;&lt;a href="http://4.bp.blogspot.com/-mZxP0-jXRIo/UKJ8y8Gs5AI/AAAAAAAAAW0/qNyIN9hGBiQ/s1600/bloombergwapidocumentation.gif" imageanchor="1" style="margin-left:1em; margin-right:1em"&gt;&lt;img border="0" height="286" width="400" src="http://4.bp.blogspot.com/-mZxP0-jXRIo/UKJ8y8Gs5AI/AAAAAAAAAW0/qNyIN9hGBiQ/s400/bloombergwapidocumentation.gif" /&gt;&lt;/a&gt;&lt;br /&gt;WAPI - pretty, no?&lt;/div&gt; &lt;p&gt;To go with this I found some useful documentation of the Bloomberg Open API &lt;a href="http://www.openbloomberg.com/files/2012/10/blpapi-developers-guide.pdf" target="_blank"&gt;here&lt;/a&gt; and I found the .NET Bloomberg Open API itself &lt;a href="http://www.openbloomberg.com/open-api/" target="_blank"&gt;here&lt;/a&gt;.&lt;/p&gt; &lt;h4&gt;Hello World?&lt;/h4&gt; &lt;p&gt;The first goal when getting up to speed with an API is getting it to do something.  Anything.  Just stick a fork into it and see if it croaks. Sticking a fork into Open API was achieved by taking the 30-odd example apps included in the Bloomberg Open API and running each in turn on the Bloomberg box until I had my "he's alive!!" moment.  (I did find it surprising that not all of the examples worked - I don't know if there's a good reason for this...)&lt;/p&gt; &lt;p&gt;However, when I tried to write my own C# console application to interrogate the Open API it wasn't as plain sailing as I'd hoped.  I'd write something that looked correct, compiled successfully and deploy it onto the Bloomberg terminal only to have it die a sad death whenever I tried to fire it off.&lt;/p&gt; &lt;p&gt;I generally find the fastest way to get up and running with an API is to debug it. To make calls to the API and then examine, field by field and method by method, what is actually there.  This wasn't really an option with my console app though.  I was using a shared Bloomberg terminal with very limited access.  No Visual Studio on the box and no remote debugging enabled.&lt;/p&gt; &lt;p&gt;It was then that I had something of a eureka moment.  I realised that the code in the VBA samples I'd downloaded from Bloomberg looked quite similar to the C# code samples that shipped with Open API. Hmmmm....  Shortly after this I found myself sat at the Bloomberg machine debugging the Bloomberg API using the VBA IDE in Excel.  (For the record, these debugging tools are aren't too bad at all - they're nowhere near as slick as their VS counterparts but they do the job.)  This was my &lt;a href="http://en.wikipedia.org/wiki/Rosetta_Stone" target="_blank"&gt;Rosetta Stone&lt;/a&gt; - I could take what I'd learned from the VBA samples and translate that into equivalent C# / .NET code (bearing in mind what I'd learned from debugging in Excel and in fact sometimes bringing along the VBA comments themselves if they provided some useful insight).&lt;/p&gt; &lt;h4&gt;He's the Bloomberg, I'm the Wrapper&lt;/h4&gt; &lt;p&gt;So I'm off and romping...  I have something that works.  Hallelujah!  Now that that hurdle had been crossed I found myself examining the actual Bloomberg API code itself.  It functioned just fine but it did a couple of things that I wasn't too keen on:&lt;/p&gt; &lt;ol&gt;&lt;li&gt;The Bloomberg API came with custom data types. I didn't want to use these unless it was absolutely necessary - I just wanted to stick to the standard .NET types.  This way if I needed to hand data onto another application I wouldn't be making each of these applications dependant on the Bloomberg Open API.&lt;/li&gt; &lt;li&gt;To get the data out of the Bloomberg API there was an awful lot of boilerplate.  Code which handled the possibilities of very large responses that might be split into several packages.  Code which walked the element tree returned from Bloomberg parsing out the data.  It wasn't a beacon of simplicity.&lt;/li&gt;&lt;/ol&gt; &lt;p&gt;I wanted an API that I could simply invoke with security codes and required fields.  And in return I wanted to be passed nicely structured data.  As I've already mentioned a desire to not introduce unnecessary dependencies I thought it might well suit to make use of nested Dictionaries.  I came up with a simple C# Console project  / application which had a reference to the Bloomberg Open API.  It contained the following class; essentially my wrapper for Open API operations: (please note this is deliberately a very "bare-bones" implementation)&lt;/p&gt; &lt;script src="https://gist.github.com/4065815.js?file=BloombergApi.cs"&gt;&lt;/script&gt; &lt;p&gt;The project also contained this class which demonstrates how I made use of my wrapper:&lt;/p&gt; &lt;script src="https://gist.github.com/4065815.js?file=NicerBloombergApiDemo.cs"&gt;&lt;/script&gt; &lt;p&gt;And here's what the output looked like:&lt;/p&gt; &lt;div class="separator" style="clear: both; text-align: center;"&gt;&lt;a href="http://1.bp.blogspot.com/-1ghUYqbl0AE/UKJ_3vsuKqI/AAAAAAAAAXI/pPKR5dup48U/s1600/Bloomberg.png" imageanchor="1" style="margin-left:1em; margin-right:1em"&gt;&lt;img border="0" height="400" width="367" src="http://1.bp.blogspot.com/-1ghUYqbl0AE/UKJ_3vsuKqI/AAAAAAAAAXI/pPKR5dup48U/s400/Bloomberg.png" /&gt;&lt;/a&gt;&lt;/div&gt; &lt;p&gt;This covered my bases.  It was simple, it was easy to consume and it didn't require any custom types.  My mini-API is only really catering for my own needs (unsurprisingly).  However, there's lots more to the Bloomberg Open API and I may end up taking this further in the future if I encounter use cases that my current API doesn't cover.&lt;/p&gt; &lt;h4&gt;Update (07/12/2012)&lt;/h4&gt; &lt;p&gt;Finally, a PS. I found in the &lt;a href="http://www.openbloomberg.com/faq/" target="_blank"&gt;Open API FAQs&lt;/a&gt; that &lt;em&gt;"Testing any of that functionality currently requires a valid Bloomberg Desktop API (DAPI), Server API (SAPI) or Managed B-Pipe subscription. Bloomberg is planning on releasing a stand-alone simulator which will not require a subscription."&lt;/em&gt;  There isn't any word yet on this stand-alone simulator.  I emailed Bloomberg at &lt;a href="mailto:open-tech@bloomberg.net"&gt;open-tech@bloomberg.net&lt;/a&gt; to ask about this.  They kindly replied that &lt;em&gt;"Unfortunately it is not yet available. We understand that this makes testing API applications somewhat impractical, so we're continuing to work on this tool."&lt;/em&gt;  Fingers crossed for something we can test soon!&lt;/p&gt; &lt;h4&gt;Note to self (because I keep forgetting)&lt;/h4&gt; &lt;p&gt;If you're looking to investigate what data is available about a security in Bloomberg it's worth typing &lt;code&gt;FLDS&amp;lt;GO&amp;gt;&lt;/code&gt; into Bloomberg.  This is the Bloomberg Fields Finder.  Likewise, if you're trying to find a security you could try typing &lt;code&gt;SECF&amp;lt;GO&amp;gt;&lt;/code&gt; into Bloomberg as this is the Security Finder.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1492382956545126674'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1492382956545126674'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html' title='Getting up to speed with Bloomberg&apos;s Open API...'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='http://4.bp.blogspot.com/-mZxP0-jXRIo/UKJ8y8Gs5AI/AAAAAAAAAW0/qNyIN9hGBiQ/s72-c/bloombergwapidocumentation.gif' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4335382022004202332</id><published>2012-11-06T07:05:00.003Z</published><updated>2012-11-06T07:05:58.209Z</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Integration tests</title><content type='html'>using System; using System.Text; using System.Collections.Generic; using System.Linq; using Microsoft.VisualStudio.TestTools.UnitTesting; using HatfieldPhilips.IRIS.Models.Data; using HatfieldPhilips.IRIS.Models.Domain; using HatfieldPhilips.IRIS.Models; using HatfieldPhilips.IRIS.DomainClasses; using LNRCorporate.Common.Data;  namespace IRIS.IntegrationTests {     [TestClass]     public class IRISUnitOfWorkTests     {         private IIRISUnitOfWork _unitOfWork;         private client_control _clientControl;         private cashmanager_control _cashManagerControl;         private loan_control _loanControl;         private waterfall_control _borrowerWaterfallControl;          [TestInitialize]         public void InitialiseAndSeedDatabaseWithTestData()         {             //This is dependant on test database             _unitOfWork = new IRISUnitOfWork();              //Seed the database with test data              //Shared values             var quarter = 1; //Arbitrary quarter             var year = 1900; //Picked the year of 1900 as unlikely to conflict with any existing data             var dateAdded = DateTime.Now;              //Create a client control to use in integration tests             _clientControl = _unitOfWork.client_controls.Add(new client_control             {                 user_added = 0,                 date_added = dateAdded,                 lender_id = 0,                 reporting_date = new DateTime(2012, 1, 1),       //Arbitrary date                 interest_payment_date = new DateTime(2012, 1, 1) //Arbitrary date             });              //Create a cash manager control to use in integration tests             var inDraft = _unitOfWork.lookups.FindByCategoryAndEnum(LookupCategory.CashManagerReportStatus, CashManagerReportStatus.in_draft);             _cashManagerControl = _unitOfWork.cashmanager_controls.Add(new cashmanager_control             {                 user_added = 0,                 date_added = dateAdded,                 quarter = quarter,                 year = year,                 client_control = _clientControl,                 cm_report_status = inDraft,                 cm_report_status_id = inDraft.id             });              //Create a loan control to use in integration tests             var gbp = _unitOfWork.lookups.FindByCategoryAndEnum(LookupCategory.Currency, Currency.GBP);             _loanControl = _unitOfWork.loan_controls.Add(new loan_control             {                 user_added = 0,                 date_added = dateAdded,                 loan_number = "000000-J",  //Not likely to conflict with any existing data                 owner_team_group = "BSA",                 owner_user_id = 0,                 currency = gbp,                 currency_id = gbp.id,                 client_control = _clientControl,                 change_timestamp = Convert.FromBase64String("1234") //Arbitrary timestamp             });              //Create a borrower waterfall control to use in integration tests             var isFinalised = false;             var borrowerNormal = _unitOfWork.lookups.FindByCategoryAndEnum(LookupCategory.WaterfallType, WaterfallType.borrower_normal);             _borrowerWaterfallControl = _unitOfWork.waterfall_controls.Add(new waterfall_control             {                 user_added = 0,                 date_added = dateAdded,                 is_finalised = isFinalised,                 name = "I AM A WATERFALL",                 loan_control = _loanControl,                 is_locked = false,                 quarter = quarter,                 year = year,                 type = borrowerNormal,                 type_id = borrowerNormal.id,                 cashmanager_control = _cashManagerControl             });              //Create all test entities in database             _unitOfWork.Commit(); }          [TestCleanup]         public void RemoveTestData()         {             //Remove all test entities from database             _unitOfWork.waterfall_controls.Remove(_borrowerWaterfallControl);             _unitOfWork.loan_controls.Remove(_loanControl);             _unitOfWork.cashmanager_controls.Remove(_cashManagerControl);             _unitOfWork.client_controls.Remove(_clientControl);             _unitOfWork.Commit();         }           [TestMethod]         public void CheckCanConnectToDatabase()         {             // ARRANGE             client_control firstClientControl = null;              // ACT             try             {                 //A simple operation to test that we have access to the database; nothing special about this                 firstClientControl = _unitOfWork.client_controls.FindAll().First();             }             catch (Exception) { }              // ASSERT             Assert.AreNotEqual(null, firstClientControl, "Cannot connect to the IRIS database.");         }          [TestMethod]         public void FinaliseBorrower_SuccessfulFinalise_ReturnsNothing()         {             // ARRANGE              // ACT             _unitOfWork.FinaliseBorrower(                 waterfallControlId: _borrowerWaterfallControl.id,                 userId: 0,                 changeTimestamp: _loanControl.change_timestamp);             _unitOfWork.Commit();              // ASSERT         }          [TestMethod]         public void FinaliseBorrower_OutOfDateTimestamp_ThrowsStoredProcedureException()         {             // ARRANGE             StoredProcedureException storedProcedureException = null;              // ACT             try             {                 _unitOfWork.FinaliseBorrower(                     waterfallControlId: _borrowerWaterfallControl.id,                     userId: 0,                     changeTimestamp: Convert.FromBase64String("1111"));                 _unitOfWork.Commit();             }             catch (StoredProcedureException exc)             {                 storedProcedureException = exc;             }              // ASSERT             Assert.AreNotEqual(null, storedProcedureException, "Exception not thrown even though timestamp was out of date.");         }      } }   app.config:  &lt;?xml version="1.0"?&gt;&lt;!--   For more information on how to configure your ASP.NET application, please visit   http://go.microsoft.com/fwlink/?LinkId=152368   --&gt;&lt;configuration&gt;     &lt;configSections&gt;    &lt;!-- For more information on Entity Framework configuration, visit http://go.microsoft.com/fwlink/?LinkID=237468 --&gt;    &lt;section name="entityFramework" type="System.Data.Entity.Internal.ConfigFile.EntityFrameworkSection, EntityFramework, Version=4.3.1.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" /&gt;    &lt;section name="log4net" type="log4net.Config.Log4NetConfigurationSectionHandler, log4net"/&gt;  &lt;/configSections&gt;     &lt;connectionStrings&gt;    &lt;!-- LOCAL --&gt;    &lt;add name="IRISEntities"           connectionString="metadata=res://*/Models.IRISContext.csdl|res://*/Models.IRISContext.ssdl|res://*/Models.IRISContext.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;data source=localhost;initial catalog=IRIS;integrated security=True;multipleactiveresultsets=True;App=EntityFramework&amp;quot;"           providerName="System.Data.EntityClient" /&gt;  &lt;/connectionStrings&gt;     &lt;appSettings&gt;    &lt;add key="webpages:Version" value="1.0.0.0" /&gt;    &lt;add key="ClientValidationEnabled" value="true" /&gt;    &lt;add key="UnobtrusiveJavaScriptEnabled" value="true" /&gt;    &lt;add key="SMTP_SERVER" value="smtp.lnrproperty.com"/&gt;    &lt;add key="ApplicationID" value="2" /&gt;    &lt;add key="IRISManagementUserGroup" value="LNR London BSA" /&gt;  &lt;/appSettings&gt;     &lt;system.web&gt;    &lt;compilation debug="true" targetFramework="4.0"&gt;      &lt;!--       If you happen to have an Entity Framework edmx file directly inside your MVC project, you might see the following        error when you eagerly build views.        Could not load type 'System.Data.Entity.Design.AspNet.EntityDesignerBuildProvider'.         This error message is easy to avoid because we do not need to process the .edmx file with a build provider in MVC.        Simply add the following configuration into the root level web.config, and all will be well.       --&gt;      &lt;buildProviders&gt;        &lt;remove extension=".edmx" /&gt;      &lt;/buildProviders&gt;      &lt;assemblies&gt;        &lt;add assembly="System.Web.Abstractions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35" /&gt;        &lt;add assembly="System.Web.Helpers, Version=1.0.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35" /&gt;        &lt;add assembly="System.Web.Routing, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35" /&gt;        &lt;add assembly="System.Web.Mvc, Version=3.0.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35" /&gt;        &lt;add assembly="System.Web.WebPages, Version=1.0.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35" /&gt;        &lt;add assembly="System.Data.Entity, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" /&gt;      &lt;/assemblies&gt;    &lt;/compilation&gt;     &lt;customErrors mode="RemoteOnly"&gt;&lt;/customErrors&gt;         &lt;!--           Control the globalisation of the application to force to a specific locale you would use something like this:          &lt;globalization culture="en-GB" uiCulture="en-GB" enableClientBasedCulture="false"&gt;&lt;/globalization&gt;     To use the locale based on the client consuming the application you would use this:      (so German users get German formatted dates / numbers and English get English formatted dates / numbers)          &lt;globalization culture="auto" uiCulture="auto" enableClientBasedCulture="true"&gt;&lt;/globalization&gt;     --&gt;    &lt;globalization culture="auto" uiCulture="auto" enableClientBasedCulture="true"&gt;&lt;/globalization&gt;         &lt;authentication mode="Windows" /&gt;    &lt;membership&gt;      &lt;providers&gt;        &lt;clear /&gt;        &lt;add name="AspNetSqlMembershipProvider" type="System.Web.Security.SqlMembershipProvider" connectionStringName="ApplicationServices" enablePasswordRetrieval="false" enablePasswordReset="true" requiresQuestionAndAnswer="false" requiresUniqueEmail="false" maxInvalidPasswordAttempts="5" minRequiredPasswordLength="6" minRequiredNonalphanumericCharacters="0" passwordAttemptWindow="10" applicationName="/" /&gt;      &lt;/providers&gt;    &lt;/membership&gt;    &lt;profile&gt;      &lt;providers&gt;        &lt;clear /&gt;        &lt;add name="AspNetSqlProfileProvider" type="System.Web.Profile.SqlProfileProvider" connectionStringName="ApplicationServices" applicationName="/" /&gt;      &lt;/providers&gt;    &lt;/profile&gt;    &lt;roleManager enabled="false"&gt;      &lt;providers&gt;        &lt;clear /&gt;        &lt;add name="AspNetSqlRoleProvider" type="System.Web.Security.SqlRoleProvider" connectionStringName="ApplicationServices" applicationName="/" /&gt;        &lt;add name="AspNetWindowsTokenRoleProvider" type="System.Web.Security.WindowsTokenRoleProvider" applicationName="/" /&gt;      &lt;/providers&gt;    &lt;/roleManager&gt;    &lt;pages&gt;      &lt;namespaces&gt;        &lt;add namespace="System.Web.Helpers" /&gt;        &lt;add namespace="System.Web.Mvc" /&gt;        &lt;add namespace="System.Web.Mvc.Ajax" /&gt;        &lt;add namespace="System.Web.Mvc.Html" /&gt;        &lt;add namespace="System.Web.Routing" /&gt;        &lt;add namespace="System.Web.WebPages" /&gt;      &lt;/namespaces&gt;    &lt;/pages&gt;  &lt;/system.web&gt;     &lt;system.webServer&gt;    &lt;validation validateIntegratedModeConfiguration="false" /&gt;    &lt;modules runAllManagedModulesForAllRequests="true" /&gt;  &lt;/system.webServer&gt;     &lt;runtime&gt;    &lt;assemblyBinding xmlns="urn:schemas-microsoft-com:asm.v1"&gt;      &lt;dependentAssembly&gt;        &lt;assemblyIdentity name="System.Web.Mvc" publicKeyToken="31bf3856ad364e35" /&gt;        &lt;bindingRedirect oldVersion="1.0.0.0-2.0.0.0" newVersion="3.0.0.0" /&gt;      &lt;/dependentAssembly&gt;    &lt;/assemblyBinding&gt;  &lt;/runtime&gt;     &lt;system.serviceModel&gt;    &lt;behaviors&gt;      &lt;serviceBehaviors&gt;        &lt;behavior name=""&gt;          &lt;serviceMetadata httpGetEnabled="true" /&gt;          &lt;serviceDebug includeExceptionDetailInFaults="false" /&gt;        &lt;/behavior&gt;      &lt;/serviceBehaviors&gt;    &lt;/behaviors&gt;    &lt;serviceHostingEnvironment multipleSiteBindingsEnabled="true" /&gt;    &lt;bindings&gt;      &lt;basicHttpBinding&gt;        &lt;binding name="BasicHttpBinding_IAuthenticationWCF" closeTimeout="00:01:00" openTimeout="00:01:00" receiveTimeout="00:10:00" sendTimeout="00:01:00" allowCookies="false" bypassProxyOnLocal="false" hostNameComparisonMode="StrongWildcard" maxBufferSize="65536" maxBufferPoolSize="524288" maxReceivedMessageSize="65536" messageEncoding="Text" textEncoding="utf-8" transferMode="Buffered" useDefaultWebProxy="true"&gt;          &lt;readerQuotas maxDepth="32" maxStringContentLength="8192" maxArrayLength="16384" maxBytesPerRead="4096" maxNameTableCharCount="16384" /&gt;          &lt;security mode="None"&gt;            &lt;transport clientCredentialType="None" proxyCredentialType="None" realm="" /&gt;            &lt;message clientCredentialType="UserName" algorithmSuite="Default" /&gt;          &lt;/security&gt;        &lt;/binding&gt;        &lt;binding name="BasicHttpBinding_IConsolidatorWCF" closeTimeout="00:01:00" openTimeout="00:01:00" receiveTimeout="00:10:00" sendTimeout="00:01:00" allowCookies="false" bypassProxyOnLocal="false" hostNameComparisonMode="StrongWildcard" maxBufferSize="65536" maxBufferPoolSize="524288" maxReceivedMessageSize="65536" messageEncoding="Text" textEncoding="utf-8" transferMode="Buffered" useDefaultWebProxy="true"&gt;          &lt;readerQuotas maxDepth="32" maxStringContentLength="81920" maxArrayLength="16384" maxBytesPerRead="4096" maxNameTableCharCount="16384" /&gt;          &lt;security mode="TransportCredentialOnly"&gt;            &lt;transport clientCredentialType="None" proxyCredentialType="None" realm="" /&gt;            &lt;message clientCredentialType="UserName" algorithmSuite="Default" /&gt;          &lt;/security&gt;        &lt;/binding&gt;        &lt;binding name="BasicHttpBinding_IAuditWCF" closeTimeout="00:01:00" openTimeout="00:01:00" receiveTimeout="00:10:00" sendTimeout="00:01:00" allowCookies="false" bypassProxyOnLocal="false" hostNameComparisonMode="StrongWildcard" maxBufferSize="65536" maxBufferPoolSize="524288" maxReceivedMessageSize="65536" messageEncoding="Text" textEncoding="utf-8" transferMode="Buffered" useDefaultWebProxy="true"&gt;          &lt;readerQuotas maxDepth="32" maxStringContentLength="8192" maxArrayLength="16384" maxBytesPerRead="4096" maxNameTableCharCount="16384" /&gt;          &lt;security mode="None"&gt;            &lt;transport clientCredentialType="None" proxyCredentialType="None" realm="" /&gt;            &lt;message clientCredentialType="UserName" algorithmSuite="Default" /&gt;          &lt;/security&gt;        &lt;/binding&gt;        &lt;binding name="BasicHttpBinding_IExceptionWCF" closeTimeout="00:01:00" openTimeout="00:01:00" receiveTimeout="00:10:00" sendTimeout="00:01:00" allowCookies="false" bypassProxyOnLocal="false" hostNameComparisonMode="StrongWildcard" maxBufferSize="65536" maxBufferPoolSize="524288" maxReceivedMessageSize="65536" messageEncoding="Text" textEncoding="utf-8" transferMode="Buffered" useDefaultWebProxy="true"&gt;          &lt;readerQuotas maxDepth="32" maxStringContentLength="8192" maxArrayLength="16384" maxBytesPerRead="4096" maxNameTableCharCount="16384" /&gt;          &lt;security mode="None"&gt;            &lt;transport clientCredentialType="None" proxyCredentialType="None" realm="" /&gt;            &lt;message clientCredentialType="UserName" algorithmSuite="Default" /&gt;          &lt;/security&gt;        &lt;/binding&gt;        &lt;binding name="BasicHttpBinding_IHolidayCalendarWCF" closeTimeout="00:01:00" openTimeout="00:01:00" receiveTimeout="00:10:00" sendTimeout="00:01:00" allowCookies="false" bypassProxyOnLocal="false" hostNameComparisonMode="StrongWildcard" maxBufferSize="65536" maxBufferPoolSize="524288" maxReceivedMessageSize="65536" messageEncoding="Text" textEncoding="utf-8" transferMode="Buffered" useDefaultWebProxy="true"&gt;          &lt;readerQuotas maxDepth="32" maxStringContentLength="8192" maxArrayLength="16384"             maxBytesPerRead="4096" maxNameTableCharCount="16384" /&gt;          &lt;security mode="None"&gt;            &lt;transport clientCredentialType="None" proxyCredentialType="None"               realm="" /&gt;            &lt;message clientCredentialType="UserName" algorithmSuite="Default" /&gt;          &lt;/security&gt;        &lt;/binding&gt;      &lt;/basicHttpBinding&gt;    &lt;/bindings&gt;         &lt;client&gt;      &lt;!-- LOCAL --&gt;      &lt;endpoint address="http://localhost:58001/AuthenticationWCF.svc"                 binding="basicHttpBinding"                 bindingConfiguration="BasicHttpBinding_IAuthenticationWCF"                 contract="AuthenticationWCF.IAuthenticationWCF"                 name="BasicHttpBinding_IAuthenticationWCF" /&gt;      &lt;endpoint address="http://localhost:58002/ExceptionWCF.svc"                 binding="basicHttpBinding"                 bindingConfiguration="BasicHttpBinding_IExceptionWCF"                 contract="ExceptionWCF.IExceptionWCF"                 name="BasicHttpBinding_IExceptionWCF" /&gt;      &lt;endpoint address="http://localhost:58003/AuditWCF.svc"                 binding="basicHttpBinding"                 bindingConfiguration="BasicHttpBinding_IAuditWCF"                 contract="AuditWCF.IAuditWCF"                 name="BasicHttpBinding_IAuditWCF" /&gt;      &lt;endpoint address="http://localhost:58004/ConsolidatorWCF.svc"                 binding="basicHttpBinding"                 bindingConfiguration="BasicHttpBinding_IConsolidatorWCF"                 contract="ConsolidatorWCF.IConsolidatorWCF"                 name="BasicHttpBinding_IConsolidatorWCF" /&gt;      &lt;endpoint address="http://localhost:58005/HolidayCalendarWCF.svc"                 binding="basicHttpBinding"                 bindingConfiguration="BasicHttpBinding_IHolidayCalendarWCF"                 contract="HolidayCalendarWCF.IHolidayCalendarWCF"                 name="BasicHttpBinding_IHolidayCalendarWCF" /&gt;              &lt;/client&gt;  &lt;/system.serviceModel&gt;     &lt;entityFramework&gt;    &lt;defaultConnectionFactory type="System.Data.Entity.Infrastructure.SqlConnectionFactory, EntityFramework"&gt;      &lt;parameters&gt;        &lt;parameter value="Data Source=(localdb)\v11.0; Integrated Security=True; MultipleActiveResultSets=True" /&gt;      &lt;/parameters&gt;    &lt;/defaultConnectionFactory&gt;  &lt;/entityFramework&gt;   &lt;log4net&gt;         &lt;appender name="RollingFileAppender" type="log4net.Appender.RollingFileAppender"&gt;      &lt;file type="log4net.Util.PatternString" value="..\\Logs\\IRIS\\IRIS.log" /&gt;      &lt;appendToFile value="true" /&gt;      &lt;rollingStyle value="Composite" /&gt;      &lt;datePattern value="_yyyy-MM-dd&amp;quot;.log&amp;quot;" /&gt;      &lt;maxSizeRollBackups value="10" /&gt;      &lt;maximumFileSize value="1MB" /&gt;      &lt;layout type="log4net.Layout.PatternLayout"&gt;        &lt;conversionPattern value="[%date{yyyy-MM-dd HH:mm:ss}] [%level] - %message%newline" /&gt;      &lt;/layout&gt;      &lt;threshold value="DEBUG"/&gt;      &lt;filter type="log4net.Filter.LevelRangeFilter"&gt;        &lt;levelMin value="DEBUG" /&gt;        &lt;levelMax value="ERROR" /&gt;      &lt;/filter&gt;    &lt;/appender&gt;         &lt;appender name="EventLogAppender" type="log4net.Appender.EventLogAppender" &gt;      &lt;applicationName value="IRIS" /&gt;      &lt;layout type="log4net.Layout.PatternLayout"&gt;        &lt;conversionPattern value="[%date{yyyy-MM-dd HH:mm:ss}] [%level] - %message%newline" /&gt;      &lt;/layout&gt;      &lt;threshold value="WARN"/&gt;      &lt;filter type="log4net.Filter.LevelRangeFilter"&gt;        &lt;levelMin value="WARN" /&gt;        &lt;levelMax value="ERROR" /&gt;      &lt;/filter&gt;    &lt;/appender&gt;         &lt;root&gt;      &lt;level value="DEBUG" /&gt;      &lt;appender-ref ref="RollingFileAppender" /&gt;      &lt;appender-ref ref="EventLogAppender" /&gt;    &lt;/root&gt;  &lt;/log4net&gt;   &lt;/configuration&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4335382022004202332'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4335382022004202332'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6352898386072176637</id><published>2012-11-06T07:03:00.001Z</published><updated>2012-11-06T07:03:50.526Z</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Unit test example code</title><content type='html'>using System; using System.Collections.Generic; using System.Linq; using System.Linq.Expressions; using System.Xml.Linq; using Microsoft.VisualStudio.TestTools.UnitTesting; using Moq; using LNRCorporate.Consolidator.Model; using LNRCorporate.Consolidator.Controller; using LNRCorporate.Common.Helpers; using LNRCorporate.Common.ServiceClients; using LNRCorporate.CommonClasses.Consolidator; using log4net;  namespace Consolidator.UnitTest {     /// &lt;summary&gt;    /// Author      : John Reilly     /// Description : This is a test class for ConsolidatorControllerTest and is intended     ///               to contain all ConsolidatorControllerTest Unit Tests     ///&lt;/summary&gt;    [TestClass]     public class ConsolidatorControllerTests     {         private ConsolidatorController _controller;         private Mock&lt;IConsolidatorUnitOfWork&gt; _unitOfWork;         private Mock&lt;IExceptionClient&gt; _exceptionClient;         private Mock&lt;IAuthenticationClient&gt; _authenticationClient;         private Mock&lt;ILog&gt; _log;          [TestInitialize]         public void Init()         {             _unitOfWork = new Mock&lt;IConsolidatorUnitOfWork&gt;();         //We are mocking the interface             _exceptionClient = new Mock&lt;IExceptionClient&gt;();           //We are mocking the interface             _authenticationClient = new Mock&lt;IAuthenticationClient&gt;(); //We are mocking the interface             _log = new Mock&lt;ILog&gt;();                                   //We are mocking the interface              _controller = new ConsolidatorController(_unitOfWork.Object, _exceptionClient.Object, _authenticationClient.Object, _log.Object);         }          [TestMethod]         public void GetData_PassInvalidXML()         {             // ARRANGE             var xml = "This is not XML";              // ACT             var response = _controller.GetData(xml);             var responseObj = XmlConverter&lt;consolidator&gt;.ToObject(response);              // ASSERT             Assert.AreEqual("There was a problem validating the consolidatorRequestXML", responseObj.errors[0]);             Assert.AreEqual("There is an error in XML document (1, 1).", responseObj.errors[1]);             Assert.AreEqual("Data at the root level is invalid. Line 1, position 1.", responseObj.errors[2]);         }          [TestMethod]         public void GetData_PassNullRequest()         {             // ARRANGE              //Pass null request             var xml = XmlConverter&lt;consolidator&gt;.ToXML(new consolidator             {                 request = null             });              // ACT             var response = _controller.GetData(xml);             var responseObj = XmlConverter&lt;consolidator&gt;.ToObject(response);              // ASSERT             Assert.AreEqual("There was a problem validating the entity set.", responseObj.errors[0]);             Assert.AreEqual("No entity set supplied", responseObj.errors[1]);         }           [TestMethod]         public void GetData_DontSupplyEntitySet()         {             // ARRANGE              //Pass null request             var xml = XmlConverter&lt;consolidator&gt;.ToXML(new consolidator             {                 request = new consolidatorRequest()             });              // ACT             var response = _controller.GetData(xml);             var responseObj = XmlConverter&lt;consolidator&gt;.ToObject(response);              // ASSERT             Assert.AreEqual("There was a problem validating the entity set.", responseObj.errors[0]);             Assert.AreEqual("No entity set supplied", responseObj.errors[1]);         }          [TestMethod]         public void GetData_RequestEntitySetThatDoesNotExist()         {             // ARRANGE              //FindWhere on entity sets will return an empty list; as though the requested entity set did not exist             _unitOfWork                 .Setup(x =&gt; x.entity_sets.FindWhere(It.IsAny&lt;Expression&lt;Func&lt;entity_set, bool&gt;&gt;&gt;()))                 .Returns(new List&lt;entity_set&gt;().AsQueryable());              //Standard request             var xml = XmlConverter&lt;consolidator&gt;.ToXML(new consolidator             {                 request = new consolidatorRequest                 {                     entitySet = "LSELoanList",                 }             });              // ACT             var response = _controller.GetData(xml);             var responseObj = XmlConverter&lt;consolidator&gt;.ToObject(response);              // ASSERT             Assert.AreEqual("There was a problem validating the entity set.", responseObj.errors[0]);             Assert.AreEqual("Unknown entity set: LSELoanList", responseObj.errors[1]);         }          [TestMethod]         public void GetData_RequestEntitySetThatIsInactive()         {             // ARRANGE              var entitySet = "LSELoanList";              //FindWhere on entity sets will return a list with a single inactive item             _unitOfWork                 .Setup(x =&gt; x.entity_sets.FindWhere(It.IsAny&lt;Expression&lt;Func&lt;entity_set, bool&gt;&gt;&gt;()))                 .Returns(new List&lt;entity_set&gt; {                      new entity_set {                         is_active = false,                         title = entitySet                     }                 }.AsQueryable());              //Standard request             var xml = XmlConverter&lt;consolidator&gt;.ToXML(new consolidator             {                 request = new consolidatorRequest                 {                     entitySet = entitySet                 }             });              // ACT             var response = _controller.GetData(xml);             var responseObj = XmlConverter&lt;consolidator&gt;.ToObject(response);              // ASSERT             Assert.AreEqual("There was a problem validating the entity set.", responseObj.errors[0]);             Assert.AreEqual("Entity set: LSELoanList is inactive", responseObj.errors[1]);         }          [TestMethod]         public void GetData_RequestEntitySetFieldsThatDontExist()         {             // ARRANGE              var entitySet = "LSELoanList";              //FindWhere on entity sets will return a list with a single inactive item             _unitOfWork                 .Setup(x =&gt; x.entity_sets.FindWhere(It.IsAny&lt;Expression&lt;Func&lt;entity_set, bool&gt;&gt;&gt;()))                 .Returns(new List&lt;entity_set&gt; {                      new entity_set {                         is_active = true,                         title = entitySet                     }                 }.AsQueryable());              //FindWhere on entity set fields will return a list with 2 items             _unitOfWork                 .Setup(x =&gt; x.entity_set_fields.FindWhere(It.IsAny&lt;Expression&lt;Func&lt;entity_set_field, bool&gt;&gt;&gt;()))                 .Returns(new List&lt;entity_set_field&gt; {                      new entity_set_field {                         field_name = "LoanNumber"                     },                     new entity_set_field {                         field_name = "LenderName"                     }                 }.AsQueryable());              //Standard request             var xml = XmlConverter&lt;consolidator&gt;.ToXML(new consolidator             {                 request = new consolidatorRequest                 {                     entitySet = entitySet,                     entitySetFields = new string[] {                          "LoanNumber",                          "LoanName",                          "LenderName"                     }                 }             });              // ACT             var response = _controller.GetData(xml);             var responseObj = XmlConverter&lt;consolidator&gt;.ToObject(response);              // ASSERT             Assert.AreEqual("There was a problem validating the entity set fields.", responseObj.errors[0]);             Assert.AreEqual("3 entity set fields were expected (LoanNumber, LoanName, LenderName), 2 were found (LoanNumber, LenderName).", responseObj.errors[1]);         }          [TestMethod]         public void GetData_InvalidUser()         {             // ARRANGE              var entitySet = "LSELoanList";              //FindWhere on entity sets will return a list with a single inactive item             _unitOfWork                 .Setup(x =&gt; x.entity_sets.FindWhere(It.IsAny&lt;Expression&lt;Func&lt;entity_set, bool&gt;&gt;&gt;()))                 .Returns(new List&lt;entity_set&gt; {                      new entity_set {                         is_active = true,                         title = entitySet                     }                 }.AsQueryable());              //FindWhere on entity set fields will return a list with 3 items             _unitOfWork                 .Setup(x =&gt; x.entity_set_fields.FindWhere(It.IsAny&lt;Expression&lt;Func&lt;entity_set_field, bool&gt;&gt;&gt;()))                 .Returns(new List&lt;entity_set_field&gt; {                      new entity_set_field {                         field_name = "LoanNumber"                     },                     new entity_set_field {                         field_name = "LoanName"                     },                     new entity_set_field {                         field_name = "LenderName"                     }                 }.AsQueryable());              //Standard request             var xml = XmlConverter&lt;consolidator&gt;.ToXML(new consolidator             {                 request = new consolidatorRequest                 {                     applicationId = 2,                     userName = "jreilly",                     entitySet = entitySet,                     entitySetFields = new string[] {                          "LoanNumber",                          "LoanName",                          "LenderName"                     }                 }             });              //Attempt to validate user will fail             _authenticationClient.Setup(x =&gt; x.ValidateUser(It.IsAny&lt;string&gt;(), It.IsAny&lt;int&gt;()))                 .Returns(new LNRCorporate.CommonClasses.Authentication.ValidateUserResult                 {                     Success = false                 });              // ACT             var response = _controller.GetData(xml);             var responseObj = XmlConverter&lt;consolidator&gt;.ToObject(response);              // ASSERT             Assert.AreEqual("Failed to validate user with applicationId: 2 and userName: jreilly", responseObj.errors[0]);         }     } } </content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/6352898386072176637'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/6352898386072176637'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-7839976006063557799</id><published>2012-11-02T20:16:00.000Z</published><updated>2012-11-06T11:54:45.358Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='Xsd.exe'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='XSD/XML Schema Generator'/><category scheme='http://www.blogger.com/atom/ns#' term='LINQ to XML'/><title type='text'>XSD/XML Schema Generator + Xsd.exe:Taking the pain out of manual XML</title><content type='html'>&lt;h4&gt;Is it 2003 again?!?&lt;/h4&gt; &lt;p&gt;I've just discovered Xsd.exe.  It's not new.  Or shiny.  And in fact it's been around since .NET 1.1.  Truth be told, I've been aware of it for years but up until now I've not had need of it.  But now now I've investigated it a bit I've found that it, combined with the XSD/XML Schema Generator can make for a nice tool to add to the utility belt.&lt;/p&gt; &lt;p&gt;Granted XML has long since stopped being sexy.  But if you need it, as I did recently, then this is for you.&lt;/p&gt; &lt;h4&gt;To the XML Batman!&lt;/h4&gt; &lt;p&gt;Now XML is nothing new to me (or I imagine anyone who's been developing within the last 10 years).  But most of the time when I use XML I'm barely aware that it's going on - by and large it's XML doing the heavy lifting underneath my web services.  But the glory of this situation is, I never have to think about it.  It just works.  All I have to deal with are nice strongly typed objects which makes writing robust code a doddle.&lt;/p&gt; &lt;p&gt;I recently came upon a situation where I was working with XML in the raw; that is to say strings.  I was going to be supplied with strings of XML which would  represent various objects.  It would be my job to take the supplied XML, extract out the data I needed and proceed accordingly.&lt;/p&gt; &lt;h4&gt;We Don't Need No Validation...&lt;/h4&gt; &lt;p&gt;I lied!&lt;/p&gt; &lt;p&gt;In order to write something reliable I needed to be able to validate that the supplied XML was as I expected. So, &lt;a href="http://en.wikipedia.org/wiki/XML_Schema_(W3C)" target="_blank"&gt;XSD&lt;/a&gt; time.  If you're familiar with XML then you're probably equally familar with XSD which, to quote Wikipedia &lt;em&gt;"can be used to express a set of rules to which an XML document must conform in order to be considered 'valid'"&lt;/em&gt;.&lt;/p&gt; &lt;p&gt;Now I've written my fair share of XSDs over the years and I've generally found it a slightly tedious exercise.  So I was delighted to discover an online tool to simplify the task.  It's called the &lt;a href="http://www.freeformatter.com/xsd-generator.html" target="_blank"&gt;XSD/XML Schema Generator&lt;/a&gt;.  What this marvellous tool does is allow you to enter an example of your XML which it then uses to reverse engineer an XSD.&lt;/p&gt; &lt;p&gt;Here's an example.  I plugged in this:&lt;/p&gt; &lt;script src="https://gist.github.com/4000326.js?file=contact.xml"&gt;&lt;/script&gt; &lt;p&gt;And pulled out this:&lt;/p&gt; &lt;script src="https://gist.github.com/4000326.js?file=contact.xsd"&gt;&lt;/script&gt; &lt;p&gt;Fantastic!  It doesn't matter if the tool gets something slightly wrong; you can tweak the generated XSD to your hearts content.  This is great because it does the hard work for you, allowing you to step back, mop your brow and then heartily approve the results.  This tool is a labour saving device.  Put simply, it's a dishwasher.&lt;/p&gt; &lt;h4&gt;Tools of the Trade&lt;/h4&gt; &lt;p&gt;How to get to the actual data?  I was initially planning to break out the &lt;a href="http://msdn.microsoft.com/en-us/library/system.xml.linq.xdocument(v=vs.100).aspx" target="_blank"&gt;&lt;code&gt;XDocument&lt;/code&gt;&lt;/a&gt;, plug in my XSD and use the &lt;code&gt;Validate&lt;/code&gt; method.  Which would do the job just dandy.&lt;/p&gt; &lt;p&gt;However I resisted.  As much as I like LINQ to XML I turned to use &lt;a href="http://msdn.microsoft.com/en-us/library/x6c1kb0s(v=vs.100).aspx" target="_blank"&gt;Xsd.exe&lt;/a&gt; instead.  As I've mentioned, this tool is as old as the hills.  But there's gold in them thar hills, listen: &lt;em&gt;"The XML Schema Definition (Xsd.exe) tool generates XML schema or common language runtime classes from XDR, XML, and XSD files, or from classes in a runtime assembly."&lt;/em&gt;&lt;/p&gt; &lt;p&gt;Excited?  Thought not.  But what this means is we can hurl our XSD at this tool and it will toss back a nicely formatted C# class for me to use.  Good stuff!  So how's it done?  Well MSDN is roughly as informative as it ever is (which is to say, not terribly) but fortunately there's not a great deal to it.  You fire up the Visual Studio Command Prompt (and I advise doing this in Administrator mode to escape permissions pain).  Then you enter a command to generate your class.  Here's an example using the Contact.xsd file we generated earlier:&lt;/p&gt; &lt;code&gt;xsd.exe "C:\\Contact.xsd" /classes /out:"C:\\" /namespace:"MyNameSpace"&lt;/code&gt; &lt;p&gt;Generation looks like this:&lt;/p&gt; &lt;div class="separator" style="clear: both; text-align: center;"&gt;&lt;a href="http://1.bp.blogspot.com/-TR-eaxshZo8/UJPclxs8JjI/AAAAAAAAAWg/TNKZuyi-8NU/s1600/XsdInAction.png" imageanchor="1" style="margin-left:1em; margin-right:1em"&gt;&lt;img border="0" height="79" width="400" src="http://1.bp.blogspot.com/-TR-eaxshZo8/UJPclxs8JjI/AAAAAAAAAWg/TNKZuyi-8NU/s400/XsdInAction.png" /&gt;&lt;/a&gt;&lt;br /&gt;Never let it be said that the command line lacks visual flair... &lt;/div&gt; &lt;p&gt;And you're left with the lovely Contact.cs class:&lt;/p&gt; &lt;script src="https://gist.github.com/4000326.js?file=Contact.cs"&gt;&lt;/script&gt; &lt;h4&gt;Justify Your Actions&lt;/h4&gt; &lt;p&gt;But why is this good stuff?  Indeed why is this more interesting than the newer, and hence obviously cooler, LINQ to XML?  Well for my money it's the following reasons that are important:&lt;/p&gt; &lt;ol&gt;&lt;li&gt;Intellisense - I have always loved this.  Call me lazy but I think intellisense frees up the mind to think about what problem you're actually trying to solve.  Xsd.exe's generated classes give me that; I don't need to hold the whole data structure in my head as I code.&lt;/li&gt;&lt;li&gt;Terse code - I'm passionate about less code.  I think that a noble aim in software development is to write as little code as possible in order to achieve your aims.  I say this as generally I have found that writing a minimal amount of code expresses the intention of the code in a far clearer fashion.  In service of that aim Xsd.exe's generated classes allow me to write less code than would be required with LINQ to XML.&lt;/li&gt;&lt;li&gt;To quote Scott Hanselman "&lt;a href="http://www.hanselman.com/blog/NuGetPackageOfTheWeek6DynamicMalleableEnjoyableExpandoObjectsWithClay.aspx" target="_blank"&gt;successful compilation is just the first unit test&lt;/a&gt;".  That it is but it's a doozy.  If I'm making changes to the code and I've been using LINQ to XML I'm not going to see the benefits of strong typing that I would with Xsd.exe's generated classes.  I like learning if I've broken the build sooner rather than later; strong typing gives me that safety net.&lt;/li&gt;&lt;/ol&gt; &lt;h4&gt;Serialization / Deserialization Helper&lt;/h4&gt; &lt;p&gt;As you read this you're no doubt thinking "but wait he's shown us how to create XSDs from XML and classes from XSDs but how do we take XML and turn it into objects?  And how do we turn those objects back into XML?"&lt;/p&gt; &lt;p&gt;See how I read your mind just there?  It's a gift.  Well, I've written a little static helper class for the very purpose:&lt;/p&gt; &lt;script src="https://gist.github.com/4000326.js?file=XmlConverter.cs"&gt;&lt;/script&gt; &lt;p&gt;And here's an example of how to use it:&lt;/p&gt; &lt;script src="https://gist.github.com/4000326.js?file=XmlConverterUsage.cs"&gt;&lt;/script&gt; &lt;p&gt;I was tempted to name my methods in tribute to Crockford's JSON (namely &lt;code&gt;ToXML&lt;/code&gt; becoming &lt;code&gt;stringify&lt;/code&gt; and &lt;code&gt;ToObject&lt;/code&gt; becoming &lt;code&gt;parse&lt;/code&gt;).  Maybe later.&lt;/p&gt; &lt;p&gt;And that's us done.  Whilst it's no doubt unfashionable I think that this is a very useful approach indeed and I commend it to the interweb!&lt;/p&gt; &lt;h4&gt;Update - using Xsd.exe to generate XSD from XML&lt;/h4&gt; &lt;p&gt;I was chatting to a friend about this blog post and he mentioned that you can actually use Xsd.exe to generate XSD files from XML as well.  He's quite right - this feature does exist.  To go back to our example from earlier we can execute the following command:&lt;/p&gt; &lt;code&gt;xsd.exe "C:\\Contact.xml" /out:"C:\\" &lt;/code&gt; &lt;p&gt;And this will generate the following file:&lt;/p&gt; &lt;script src="https://gist.github.com/4000326.js?file=Generated by XSD contact.xsd"&gt;&lt;/script&gt; &lt;p&gt;However, the XSD generated above is very much a "Microsoft XSD"; it's an XSD which features MS properties and so on.  It's fine but I think that generally I prefer my XSDs to be as vanilla as possible.  To that end I'm likely to stick to using the XSD/XML Schema Generator as it doesn't appear to be possible to get Xsd.exe to generate "vanilla XSD".&lt;/p&gt; &lt;p&gt;Thanks to Ajay for bringing it to my attention though.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7839976006063557799'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7839976006063557799'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2012/11/xsdxml-schema-generator-xsdexe-taking.html' title='XSD/XML Schema Generator + Xsd.exe:&lt;br /&gt;Taking the pain out of manual XML'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='http://1.bp.blogspot.com/-TR-eaxshZo8/UJPclxs8JjI/AAAAAAAAAWg/TNKZuyi-8NU/s72-c/XsdInAction.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2418364802412202029</id><published>2012-10-22T04:30:00.000+01:00</published><updated>2012-10-22T16:58:38.273+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='MVC 3'/><category scheme='http://www.blogger.com/atom/ns#' term='Dictionary'/><title type='text'>MVC 3 meet Dictionary</title><content type='html'>&lt;h4&gt;Documenting a JsonValueProviderFactory Gotcha&lt;/h4&gt; &lt;p&gt;About a year ago I was involved in the migration of an ASP.NET WebForms application over to MVC 3.  We'd been doing a lot of AJAX-y / Single Page Application-y things in the project and had come to the conclusion that MVC might be a slightly better fit since we intended to continue down this path.&lt;/p&gt; &lt;p&gt;During the migration we encountered a bug in MVC 3 concerning Dictionary deserialization.  This bug has subsequently tripped me up a few more times as I failed to remember the nature of the problem correctly.  So I've written the issue up here as an aide to my own lamentable memory.&lt;/p&gt; &lt;p&gt;Before I begin I should say that the problem &lt;em&gt;&lt;u&gt;has been resolved in MVC 4&lt;/u&gt;&lt;/em&gt;.  However given that I imagine many MVC 3 projects will not upgrade instantly there's probably some value in documenting the issue (and how to work around it).  By the way, you can see my initial plea for assistance in &lt;a href="http://stackoverflow.com/q/6881440/761388" target="_blank"&gt;this StackOverflow  question&lt;/a&gt;.&lt;/p&gt; &lt;h4&gt;The Problem&lt;/h4&gt; &lt;p&gt;The problem is that deserialization of Dictionary objects does not behave in the expected and desired fashion.  When you fire off a dictionary it arrives at your endpoint as the enormously unhelpful &lt;code&gt;null&lt;/code&gt;.  To see this for yourself you can try using this JavaScript:&lt;/p&gt; &lt;script src="https://gist.github.com/3931778.js?file=PostDictionaryTest.js"&gt;&lt;/script&gt; &lt;p&gt;With this C#:&lt;/p&gt; &lt;script src="https://gist.github.com/3931778.js?file=HomeController.cs"&gt;&lt;/script&gt; &lt;p&gt;You get a null &lt;code&gt;null&lt;/code&gt; dictionary.&lt;/p&gt; &lt;div class="separator" style="clear: both; text-align: center;"&gt;&lt;a href="http://3.bp.blogspot.com/-Lsz_lrqsLF8/UIVcfCzfGrI/AAAAAAAAAVM/gkq0qsVZTMw/s1600/MyDictionaryIsNull.png" imageanchor="1" style="margin-left:1em; margin-right:1em"&gt;&lt;img border="0" height="167" width="400" src="http://3.bp.blogspot.com/-Lsz_lrqsLF8/UIVcfCzfGrI/AAAAAAAAAVM/gkq0qsVZTMw/s400/MyDictionaryIsNull.png" /&gt;&lt;/a&gt;&lt;br /&gt;Alas, and indeed, alack...&lt;/div&gt; &lt;p&gt;After a long time googling around on the topic I eventually discovered, much to my surprise, that I was actually tripping over a bug in MVC 3.  It was filed by &lt;a href="http://stackoverflow.com/users/29407/darin-dimitrov" target="_blank"&gt;Darin Dimitrov&lt;/a&gt; of Stack Overflow fame and I found details about it filed as an official bug &lt;a href="http://connect.microsoft.com/VisualStudio/feedback/details/636647/make-jsonvalueproviderfactory-work-with-dictionary-types-in-asp-net-mvc" target="_blank"&gt;here&lt;/a&gt;.  To quote Darin:&lt;/p&gt; &lt;p&gt;"&lt;em&gt;The System.Web.Mvc.JsonValueProviderFactory introduced in ASP.NET MVC 3 enables action methods to send and receive JSON-formatted text and to model-bind the JSON text to parameters of action methods. Unfortunately it doesn't work with dictionaries&lt;/em&gt;"&lt;/p&gt; &lt;h4&gt;The Workaround&lt;/h4&gt; &lt;p&gt;My colleague found a workaround for the issue &lt;a href="http://stackoverflow.com/a/5397743/761388" target="_blank"&gt;here&lt;/a&gt;.  There are 2 parts to this:&lt;/p&gt; &lt;ol&gt;&lt;li&gt;Dictionaries in JavaScript are simple JavaScript Object Literals.  In order to workaround this issue it is necessary to &lt;code&gt;JSON.stringify&lt;/code&gt; our Dictionary / JOL before sending it to the endpoint.  This is done so a string can be picked up at the endpoint.&lt;/li&gt;&lt;li&gt;The signature of your action is switched over from a Dictionary reference to a string reference.  Deserialization is then manually performed back from the string to a Dictionary within the Action itself.&lt;/li&gt;&lt;/ol&gt; &lt;p&gt;I've adapted my example from earlier to demonstrate this; first the JavaScript:&lt;/p&gt; &lt;script src="https://gist.github.com/3931778.js?file=PostDictionaryTestWorkaround.js"&gt;&lt;/script&gt; &lt;p&gt;Then the C#:&lt;/p&gt; &lt;script src="https://gist.github.com/3931778.js?file=HomeControllerWorkaround.cs"&gt;&lt;/script&gt; &lt;p&gt;And now we're able to get a dictionary:&lt;/p&gt; &lt;div class="separator" style="clear: both; text-align: center;"&gt;&lt;a href="http://1.bp.blogspot.com/-7_sHRAsZjbY/UIVnwqH7tRI/AAAAAAAAAVg/jkYd3aHKPF4/s1600/MyDictionaryIsNotNull.png" imageanchor="1" style="margin-left:1em; margin-right:1em"&gt;&lt;img border="0" height="179" width="400" src="http://1.bp.blogspot.com/-7_sHRAsZjbY/UIVnwqH7tRI/AAAAAAAAAVg/jkYd3aHKPF4/s400/MyDictionaryIsNotNull.png" /&gt;&lt;/a&gt;&lt;br /&gt;That's more like it!&lt;/div&gt; &lt;h4&gt;Summary and a PS&lt;/h4&gt; &lt;p&gt;So that's it; a little unglamourous but this works.  I'm slightly surprised that that wasn't picked up before MVC 3 was released but at least it's been fixed for MVC 4.  I look forward to this blog post being irrelevant and out of date .&lt;/p&gt; &lt;p&gt;For what it's worth in my example above we're using the trusty old &lt;code&gt;System.Web.Script.Serialization.JavaScriptSerializer&lt;/code&gt; to perform deserialization.  My preference is actually to use &lt;a href="http://james.newtonking.com/projects/json-net.aspx" target="_blank"&gt;JSON.Nets&lt;/a&gt; implementation but for the sake of simplicity I went with .NETs internal one here.  To be honest, either is fine to my knowledge.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2418364802412202029'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2418364802412202029'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2012/10/mvc-3-meet-dictionary.html' title='MVC 3 meet Dictionary'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='http://3.bp.blogspot.com/-Lsz_lrqsLF8/UIVcfCzfGrI/AAAAAAAAAVM/gkq0qsVZTMw/s72-c/MyDictionaryIsNull.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-7273363052780837835</id><published>2012-10-05T05:02:00.000+01:00</published><updated>2012-10-06T10:49:12.324+01:00</updated><category scheme='http://www.blogger.com/atom/ns#' term='asp.net'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Bundling'/><category scheme='http://www.blogger.com/atom/ns#' term='MVC 3'/><category scheme='http://www.blogger.com/atom/ns#' term='Web Optimization'/><category scheme='http://www.blogger.com/atom/ns#' term='Minification'/><title type='text'>Using Web Optimization with MVC 3</title><content type='html'>&lt;p&gt;A while ago I &lt;a href="http://icanmakethiswork.blogspot.com/2012/06/how-im-structuring-my-javascript-in-web.html#WebOptimization" target="_blank"&gt;wrote&lt;/a&gt; about optimally serving up JavaScript in web applications.  I mentioned that Microsoft had come up with a NuGet package called &lt;a href="http://nuget.org/packages/Microsoft.AspNet.Web.Optimization" target="_blank"&gt;Microsoft ASP.NET Web Optimization&lt;/a&gt; which could help with that by minifying and bundling CSS and JavaScript.  At the time I was wondering if I would be able to to use this package with pre-existing MVC 3 projects (given that the package had been released together with MVC 4).  Happily it turns out you can.  But it's not quite as straightforward as I might have liked so I've documented how to get going with this here...&lt;/p&gt; &lt;h4&gt;Getting the Basics in Place&lt;/h4&gt; &lt;p&gt;To keep it simple I'm going to go through taking a "vanilla" MVC 3 app and enhancing it to work with Web Optimization.  To start, follow these basic steps:&lt;/p&gt; &lt;ol&gt;&lt;li&gt;Open Visual Studio (bet you didn't see that coming!)&lt;/li&gt;&lt;li&gt;Create a new MVC 3 application (I called mine "WebOptimizationWithMvc3" to demonstrate my imaginative flair).  It doesn't really matter which sort of MVC 3 project you create - I chose an Intranet application but really that's by the by.&lt;/li&gt;&lt;li&gt;Update pre-existing NuGet packages&lt;/li&gt;&lt;li&gt;At the NuGet console type: "&lt;code&gt;Install-Package Microsoft.AspNet.Web.Optimization&lt;/code&gt;"&lt;/li&gt;&lt;/ol&gt; &lt;p&gt;Whilst the NuGet package adds the necessary references to your MVC 3 project it doesn't add the corresponding namespaces to the web.configs.  To fix this manually add the following child XML element to the &lt;code&gt;&amp;lt;namespaces&amp;gt;&lt;/code&gt; element in your root and Views web.config files:&lt;/p&gt; &lt;p&gt;&lt;code&gt;&amp;lt;add namespace="System.Web.Optimization" /&amp;gt;&lt;/code&gt;&lt;/p&gt; &lt;p&gt;This gives you access to &lt;code&gt;Scripts&lt;/code&gt; and &lt;code&gt;Styles&lt;/code&gt; in your views without needing the fully qualified namespace.  For reasons best known to Microsoft I had to close down and restart Visual Studio before intellisense started working.  You may need to do likewise.&lt;/p&gt; &lt;p&gt;Next up we want to get some JavaScript / CSS bundles in place.  To do this, create a folder in the root of your project called "App_Start".  There's nothing magical about this to my knowledge; this is just a convention that's been adopted to store all the bits of startup in one place and avoid clutterage.  (I think this grew out of Nuget; see &lt;a href="http://blog.davidebbo.com/2011/02/appstart-folder-convention-for-nuget.html" target="_blank"&gt;David Ebbo talking about this here&lt;/a&gt;.)  Inside your new folder you should add a new class called &lt;code&gt;BundleConfig.cs&lt;/code&gt; which looks like this:&lt;/p&gt; &lt;script src="https://gist.github.com/3839486.js?file=BundleConfig.cs"&gt;&lt;/script&gt; &lt;p&gt;The above is what you get when you create a new MVC 4 project (as it includes Web Optimization out of the box).  All it does is create some JavaScript and CSS bundles relating to jQuery, jQuery UI, jQuery Validate, Modernizr and the standard site CSS.  Nothing radical here but this example should give you an idea of how bundling can be configured and used.  To make use of &lt;code&gt;BundleConfig.cs&lt;/code&gt; you should modify your &lt;code&gt;Global.asax.cs&lt;/code&gt; so it looks like this:&lt;/p&gt; &lt;script src="https://gist.github.com/3839486.js?file=Global.asax.cs"&gt;&lt;/script&gt; &lt;p&gt;Once you've done this you're ready to start using Web Optimization in your MVC 3 application.&lt;/p&gt; &lt;h4&gt;Switching over _Layout.cshtml to use Web Optimization&lt;/h4&gt; &lt;p&gt;With a "vanilla" MVC 3 app the only use of CSS and JavaScript files is found in &lt;code&gt;_Layout.cshtml&lt;/code&gt;.  To switch over to using Web Optimization you should replace the existing &lt;code&gt;_Layout.cshtml&lt;/code&gt; with this: (you'll see that the few differences that there are between the 2 are solely around the replacement of link / script tags with references to &lt;code&gt;Scripts&lt;/code&gt; and &lt;code&gt;Styles&lt;/code&gt; instead)&lt;/p&gt; &lt;script src="https://gist.github.com/3839486.js?file=_Layout.cshtml"&gt;&lt;/script&gt; &lt;p&gt;Do note that in the above &lt;code&gt;Scripts.Render&lt;/code&gt; call we're rendering out 3 bundles; jQuery, jQuery UI and jQuery Validate.  We're not using any of these in &lt;code&gt;_Layout.cshtml&lt;/code&gt; but rendering these (and their associated link tags) gives us a chance to demonstrate that everything is working as expected.&lt;/p&gt; &lt;p&gt;In your root web.config file make sure that the following tag is in place: &lt;code&gt;&amp;lt;compilation debug="&lt;b&gt;true&lt;/b&gt;" targetFramework="4.0"&amp;gt;&lt;/code&gt;.  Then run, the generated HTML should look something like this:&lt;/p&gt; &lt;script src="https://gist.github.com/3839486.js?file=debug  true"&gt;&lt;/script&gt; &lt;p&gt;This demonstrates that when the application has debug set to true you see the full scripts / links being rendered out as you would hope (to make your debugging less painful).&lt;/p&gt; &lt;p&gt;Now go back to your root &lt;code&gt;web.config&lt;/code&gt; file and chance the debug tag to false: &lt;code&gt;&amp;lt;compilation debug="&lt;b&gt;false&lt;/b&gt;" targetFramework="4.0"&amp;gt;&lt;/code&gt;.  This time when you run, the generated HTML should look something like this:&lt;/p&gt; &lt;script src="https://gist.github.com/3839486.js?file=debug  false"&gt;&lt;/script&gt; &lt;p&gt;This time you can see that in non-debug mode (ie how it would run in Production) minified bundles of scripts and css files are being served up instead of the raw files.  And that's it; done.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7273363052780837835'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7273363052780837835'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2012/10/using-web-optimization-with-mvc-3.html' title='Using Web Optimization with MVC 3'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3336760366966567957</id><published>2012-10-03T06:30:00.002+01:00</published><updated>2021-03-04T19:06:41.629Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='unit testing'/><category scheme='http://www.blogger.com/atom/ns#' term='Entity Framework'/><category scheme='http://www.blogger.com/atom/ns#' term='anti-pattern'/><category scheme='http://www.blogger.com/atom/ns#' term='MOQ'/><title type='text'>Unit Testing and Entity Framework: The Filth and the Fury</title><content type='html'>&lt;p&gt;Just recently I've noticed that there appears to be something of a controversy around Unit Testing and Entity Framework.  I first came across it as I was Googling around for useful posts on using MOQ in conjunction with EF.  I've started to notice the topic more and more and as I have mixed feelings on the subject (that is to say I don't have a settled opinion) I thought I'd write about this and see if I came to any kind of conclusion...&lt;/p&gt; &lt;h4&gt;The Setup&lt;/h4&gt; &lt;p&gt;It started as I was working on a new project.  We were using ASP.NET MVC 3 and Entity Framework with DbContext as our persistence layer.  Rather than crowbarring the tests in afterwards the intention was to write tests to support the ongoing development.  Not quite test driven development but certainly &lt;a href="http://blog.troyd.net/Test+Supported+Development+TSD+Is+NOT+Test+Driven+Development+TDD.aspx" target="_blank"&gt;test supported development&lt;/a&gt;.  (Let's not get into the internecine conflict as to whether this is black belt testable code or not - it isn't but he who pays the piper etc.)  Oh and we were planning to use MOQ as our mocking library.&lt;/p&gt; &lt;p&gt;It was the first time I'd used DbContext rather than ObjectContext and so I thought I'd do a little research on how people were using DbContext with regards to testability.  I had expected to find that there was some kind of consensus and an advised way forwards.  I didn't get that at all.  Instead I found a number of conflicting opinions.&lt;/p&gt; &lt;h4&gt;Using the Repository / Unit of Work Patterns&lt;/h4&gt; &lt;p&gt;One thread of advice that came out was that people advised using the Repository / Unit of Work patterns as wrappers when it came to making testable code.  This is kind of interesting in itself as to the best of my understanding ObjectSet / ObjectContext and DbSet / DbContext are both in themselves implementations of the Repository / Unit of Work patterns.  So the advice was to build a Repository / Unit of Work pattern to wrap an existing Repository / Unit of Work pattern.&lt;/p&gt; &lt;p&gt;Not as mad as it sounds.  The reason for the extra abstraction is that ObjectContext / DbContext in the raw are not MOQ-able.&lt;/p&gt; &lt;h4&gt;Or maybe I'm wrong, maybe you can MOQ DbContext?&lt;/h4&gt; &lt;p&gt;No you can't.  Well that's not true.  You can and it's documented &lt;a href="http://romiller.com/2012/02/14/testing-with-a-fake-dbcontext/" target="_blank"&gt;here&lt;/a&gt; but there's a "but".  You need to be using Entity Frameworks Code First approach; actually coding up your DbContext yourself.  Before I'd got on board the project had already begun and we were already some way down the road of using the Database First approach.  So this didn't seem to be a go-er really.&lt;/p&gt; &lt;p&gt;The best article I found on testability and Entity Framework was &lt;a href="http://msdn.microsoft.com/en-us/library/ff714955.aspx" target="_blank"&gt;this one&lt;/a&gt; by &lt;a href="http://odetocode.com/" target="_blank"&gt;K. Scott Allen&lt;/a&gt; which essentially detailed how you could implement the Repository / Unit of Work patterns on top of ObjectSet / ObjectContext.  In the end I adapted this to do the same thing sat on top of DbSet / DbContext instead.&lt;/p&gt; &lt;p&gt;With this in place I had me my testable code.  I was quite happy with this as it seemed quite intelligible.  My new approach looked similar to the existing DbSet  / DbContext code and so there wasn't a great deal of re-writing to do.  Sorted, right?&lt;/p&gt; &lt;h4&gt;Here come the nagging doubts...&lt;/h4&gt; &lt;p&gt;I did wonder, given that I found a number of articles about applying the  Repository / Unit of Work patterns on top of ObjectSet / ObjectContext that there didn't seem to be many examples to do the same for DbSet / DbContext.  (I did find a few examples of this but none that felt satisfactory to me for a variety of reasons.)  This puzzled me.&lt;/p&gt; &lt;p&gt;I also started to notice that a 1 man war was being waged against the approach I was using by &lt;a href="http://www.ladislavmrnka.com/about/" target="_blank"&gt;Ladislav Mrnka&lt;/a&gt;.  Here are a couple of examples of his crusade:&lt;/p&gt; &lt;ul&gt;&lt;li&gt;&lt;a href="http://stackoverflow.com/a/6904479/761388" target="_blank"&gt;An answer on StackOverflow&lt;/a&gt; (there's quite a few similar answers around on StackOverflow saying similar)&lt;/li&gt;&lt;li&gt;&lt;a href="http://romiller.com/2012/02/14/testing-with-a-fake-dbcontext/#div-comment-1620" target="_blank"&gt;A comment on Rowan Millers post about fake DbContexts&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt; &lt;p&gt;Ladislav is quite strongly of the opinion that wrapping DbSet / DbContext (and I presume ObjectSet / ObjectContext too) in a further Repository / Unit of Work is an antipattern.  To quote him: &lt;em&gt;"The reason why I dont like it is leaky abstraction in Linq-to-entities queries ... In your test you have Linq-to-Objects which is superset of Linq-to-entities and only subset of queries written in L2O is translatable to L2E"&lt;/em&gt;.  It's worth looking at &lt;a href="http://www.youtube.com/watch?v=gNeSZYke-_Q" target="_blank"&gt;Jon Skeets explanation of "leaky abstractions"&lt;/a&gt; which he did for TekPub.&lt;/p&gt; &lt;p&gt;As much as I didn't want to admit it - I have come to the conclusion Ladislav probably has a point for a number of reasons:&lt;/p&gt; &lt;h5&gt;1. Just because it compiles and passes unit tests don't imagine that means it works...&lt;/h5&gt; &lt;p&gt;Unfortunately, a LINQ query that looks right, compiles and has passing unit tests written for it doesn't necessarily work.  You can take a query that fails when executed against Entity Framework and come up with test data that will pass that unit test.  As Ladislav rightly points out: &lt;code&gt;LINQ-to-Objects != LINQ-to-Entities&lt;/code&gt;.&lt;/p&gt; &lt;p&gt;So in this case unit tests of this sort don't provide you with any security.  What you need are &lt;b&gt;&lt;u&gt;integration&lt;/u&gt;&lt;/b&gt; tests.  Tests that run against an instance of the database and demonstrate that LINQ will actually translate queries / operations into valid SQL.&lt;/p&gt; &lt;h5&gt;2. Complex queries&lt;/h5&gt; &lt;p&gt;You can write some pretty complex LINQ queries if you want.  This is made particularly easy if you're using &lt;a href="http://blogs.msdn.com/b/ericlippert/archive/2009/12/07/query-transformations-are-syntactic.aspx" target="_blank"&gt;comprehension syntax&lt;/a&gt;. Whilst these queries may be simple to write it can be uphill work to generate test data to satisfy this.  So much so that at times it can feel you've made a rod for your own back using this approach.&lt;/p&gt; &lt;h5&gt;3. Lazy Loading&lt;/h5&gt; &lt;p&gt;By default Entity Framework employs lazy loading.  This a useful approach which reduces the amount of data that is transported.  Sometimes this approach forces you to specify up front if you require a particular entity through use of &lt;code&gt;Include&lt;/code&gt; statements.  This again doesn't lend itself to testing particularly well.&lt;/p&gt; &lt;h4&gt;Where does this leave us?&lt;/h4&gt; &lt;p&gt;Having considered all of the above for a while and tried out various different approaches I think I'm coming to the conclusion that Ladislav is probably right.  Implementing the Repository / Unit of Work patterns on top of ObjectSet / ObjectContext or DbSet / DbContext doesn't seem a worthwhile effort in the end.&lt;/p&gt; &lt;p&gt;So what's a better idea?  I think that in the name of simplicity you might as well have a simple class which wraps all of your Entity Framework code.  This class could  implement an interface and hence be straightforwardly MOQ-able (or alternatively all methods could be virtual and you could forego the interface).  Along with this you should have integration tests in place which test the execution of the actual Entity Framework code against a test database.&lt;/p&gt; &lt;p&gt;Now I should say this approach is not necessarily my final opinion.  It seems sensible and practical.  I think it is likely to simplify the tests that are written around a project.  It will certainly be more reliable than just having unit tests in place.&lt;/p&gt; &lt;p&gt;In terms of the project I'm working on at the moment we're kind of doing this in a halfway house sense.  That is to say, we're still using our Repository / Unit of Work wrappers for DbSet / DbContext but where things move away from simple operations  we're adding extra methods to our Unit of Work class or Repository classes which wrap this functionality and then testing it using our integration tests.&lt;/p&gt; &lt;p&gt;I'm open to the possibility that my opinion may be modified further.  And I'd be very interested to know what other people think on the subject.&lt;/p&gt; &lt;h4&gt;Update&lt;/h4&gt;&lt;p&gt;It turns out that I'm not alone in thinking about this issue and indeed others have expressed this rather better than me - take a look at Jimmy Bogard's post for an example:   &lt;a href="http://lostechies.com/jimmybogard/2012/09/20/limiting-your-abstractions/" target="_blank"&gt;http://lostechies.com/jimmybogard/2012/09/20/limiting-your-abstractions/&lt;/a&gt;.&lt;/p&gt;  &lt;h4&gt;Update 2&lt;/h4&gt;&lt;p&gt;I've also recently watched the following Pluralsight course by Julie Lerman:   &lt;a href="http://pluralsight.com/training/Courses/TableOfContents/efarchitecture#efarchitecture-m3-archrepo" target="_blank"&gt;http://pluralsight.com/training/Courses/TableOfContents/efarchitecture#efarchitecture-m3-archrepo&lt;/a&gt;.  In this course Julie talks about different implementations of the Repository and Unit of Work patterns in conjunction with Entity Framework.  Julie is in favour of using this approach but in this module she elaborates on different "flavours" of these patterns that you might want to use for different reasons (bounded contexts / reference contexts etc).  She makes a compelling case and helpfully she is open enough to say that this a point of contention in the community.  At the end of watching this I think I felt happy that our "halfway house" approach seems to fit and seems to work.  More than anything else Julie made clear that there isn't one definitively "true" approach.  Rather many different but similar approaches for achieving the same goal.  Good stuff Julie! &lt;/p&gt;   </content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3336760366966567957'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3336760366966567957'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2012/10/unit-testing-and-entity-framework-filth.html' title='Unit Testing and Entity Framework: The Filth and the Fury'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-7388659705938394604</id><published>2012-09-25T10:26:00.001+01:00</published><updated>2012-09-25T10:26:53.690+01:00</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>web.release.config</title><content type='html'>&lt;?xml version="1.0"?&gt; &lt;!-- For more information on using web.config transformation visit http://go.microsoft.com/fwlink/?LinkId=125889 --&gt; &lt;configuration xmlns:xdt="http://schemas.microsoft.com/XML-Document-Transform"&gt;  &lt;!--     In the example below, the "SetAttributes" transform will change the value of      "connectionString" to use "ReleaseSQLServer" only when the "Match" locator      finds an atrribute "name" that has a value of "MyDB".          &lt;connectionStrings&gt;      &lt;add name="MyDB"          connectionString="Data Source=ReleaseSQLServer;Initial Catalog=MyReleaseDB;Integrated Security=True"          xdt:Transform="SetAttributes" xdt:Locator="Match(name)"/&gt;    &lt;/connectionStrings&gt;  --&gt;   &lt;connectionStrings&gt;    &lt;add name="IRISEntities"       connectionString="metadata=res://*/Models.IRISContext.csdl|res://*/Models.IRISContext.ssdl|res://*/Models.IRISContext.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;Data Source=LDCVDBSASQL02\DEV;Initial Catalog=IRIS_UAT;User ID=IRISDemoUser;Password=irisdemouser;Application Name=EntityFramework&amp;quot;"        providerName="System.Data.EntityClient"       xdt:Transform="SetAttributes" xdt:Locator="Match(name)"/&gt;  &lt;/connectionStrings&gt;   &lt;system.web&gt;    &lt;compilation xdt:Transform="RemoveAttributes(debug)" /&gt;    &lt;!--       In the example below, the "Replace" transform will replace the entire        &lt;customErrors&gt; section of your web.config file.       Note that because there is only one customErrors section under the        &lt;system.web&gt; node, there is no need to use the "xdt:Locator" attribute.              &lt;customErrors defaultRedirect="GenericError.htm"         mode="RemoteOnly" xdt:Transform="Replace"&gt;        &lt;error statusCode="500" redirect="InternalError.htm"/&gt;      &lt;/customErrors&gt;    --&gt;    &lt;customErrors mode="Off" xdt:Transform="Replace"&gt;&lt;/customErrors&gt;  &lt;/system.web&gt;   &lt;log4net&gt;    &lt;appender name="RollingFileAppender" type="log4net.Appender.RollingFileAppender"&gt;      &lt;file type="log4net.Util.PatternString"             value="..\\Logs\\IRIS\\IRIS.log"       xdt:Transform="SetAttributes" xdt:Locator="Match(type)"/&gt;    &lt;/appender&gt;  &lt;/log4net&gt; &lt;/configuration&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7388659705938394604'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7388659705938394604'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-115724943258840214</id><published>2012-09-24T19:30:00.000+01:00</published><updated>2012-09-26T09:25:48.319+01:00</updated><category scheme='http://www.blogger.com/atom/ns#' term='OData'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='WCF Data Services'/><category scheme='http://www.blogger.com/atom/ns#' term='CRM 4.0'/><category scheme='http://www.blogger.com/atom/ns#' term='LINQ'/><title type='text'>Giving OData to CRM 4.0</title><content type='html'>&lt;p&gt;Just recently I was tasked with seeing if we could provide a way to access our Dynamics CRM instance via OData.  My initial investigations made it seem like there was nothing for me to do; &lt;a href="http://msdn.microsoft.com/en-us/library/gg309461.aspx" target="_blank"&gt;CRM 2011 provides OData support out of the box&lt;/a&gt;.  Small problem.  We were running CRM 4.0.&lt;/p&gt; &lt;p&gt;It could well have ended there apart from the fact that Microsoft makes it astonishingly easy to to create your own OData service using WCF Data Services.  Because it's so straightforward I was able to get an OData solution for CRM 4.0 up and running with very little heavy lifting at all. Want to know how it's done?&lt;/p&gt; &lt;h4&gt;LINQ to CRM&lt;/h4&gt; &lt;p&gt;To start with you're going to need the &lt;a href="http://www.microsoft.com/en-us/download/details.aspx?id=38" target="_blank"&gt;CRM SDK 4.0&lt;/a&gt;.  This contains a "vanilla" LINQ to CRM client which is used in each of the example applications that can be found in &lt;code&gt;microsoft.xrm\samples&lt;/code&gt;.  We want this client (or something very like it) to use as the basis for our OData service.&lt;/p&gt; &lt;p&gt;In order to get a LINQ to CRM provider that caters for your own customised CRM instance you need to use the &lt;code&gt;crmsvcutil&lt;/code&gt; utility from the CRM SDK (found in the &lt;code&gt;microsoft.xrm\tools\&lt;/code&gt; directory).  Detailed instructions on how to use this can be found in this Word document: &lt;code&gt;microsoft.xrm\advanced_developer_extensions_-_developers_guide.docx&lt;/code&gt;.  Extra information around the topic can be found using these links:&lt;/p&gt; &lt;ul&gt;&lt;li&gt;&lt;a href="http://msdn.microsoft.com/en-us/library/ff681559" target="_blank"&gt;MSDN docs on xRM&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="http://msdn.microsoft.com/en-us/library/ff681573" target="_blank"&gt;MSDN examples of LINQ queries&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="http://www.dynamicscrmtrickbag.com/" target="_blank"&gt;CRM blog site&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="http://community.adxstudio.com/products/adxstudio-portals/developers-guide/archive/linq-to-crm-22/" target="_blank"&gt;Another site listing examples of LINQ to CRM&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt; &lt;p&gt;You should end up with custom generated data context classes which look not dissimilar to similar classes that you may already have in place for Entity Framework etc. With your &lt;code&gt;Xrm.DataContext&lt;/code&gt; in hand (a subclass of &lt;code&gt;Microsoft.Xrm.Client.Data.Services.CrmDataContext&lt;/code&gt;) you'll be ready to move forwards.&lt;/p&gt; &lt;h4&gt;Make me an OData Service&lt;/h4&gt; &lt;p&gt;As I said, Microsoft makes it fantastically easy to get an OData service up and running.  &lt;a href="http://msdn.microsoft.com/en-US/library/dd728275" target="_blank"&gt;In this example&lt;/a&gt; an entity context model is created from the Northwind database and then exposed as an OData service.  To create my CRM OData service I followed a similar process.  But rather than creating an entity context model using a database I plugged in the &lt;code&gt;Xrm.DataContext&lt;/code&gt; instance of CRM that we created a moment ago.  These are the steps I followed to make my service:&lt;/p&gt; &lt;ol&gt;&lt;li&gt;Create a new ASP.NET Web Application called "CrmOData" (in case it's relevant I was using Visual Studio 2010 to do this).&lt;/li&gt;&lt;li&gt;Remove all ASPXs / JavaScript / CSS files etc leaving you with an essentially empty project.&lt;/li&gt;&lt;li&gt;Add references to the following DLLs that come with the SDK: &lt;ul&gt;&lt;li&gt;microsoft.crm.sdk.dll&lt;/li&gt;&lt;li&gt;microsoft.crm.sdktypeproxy.dll&lt;/li&gt;&lt;li&gt;microsoft.crm.sdktypeproxy.xmlserializers.dll&lt;/li&gt;&lt;li&gt;microsoft.xrm.client.dll&lt;/li&gt;&lt;li&gt;microsoft.xrm.portal.dll&lt;/li&gt;&lt;li&gt;microsoft.xrm.portal.files.dll&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;Add the &lt;code&gt;&amp;lt;microsoft.xrm.client&amp;gt;&lt;/code&gt; config section to your web.config (not forgetting the associated Xrm connection string)&lt;/li&gt;&lt;li&gt;Add this new file below to the root of the project:&lt;/li&gt;&lt;/ol&gt; &lt;script src="https://gist.github.com/3765280.js?file=Crm.svc.cs"&gt;&lt;/script&gt; &lt;p&gt;And that's it - done.  When you run this web application you will find an OData service exposed at http://localhost:12345/Crm.svc.  You could have it even simpler if you wanted - you could pull out the logging that's in place and leave only the &lt;code&gt;InitializeService&lt;/code&gt; there.  That's all you need. (The &lt;code&gt;GetEntityById&lt;/code&gt; method is a helper method of my own for identifying the GUIDs of CRM.)&lt;/p&gt; &lt;p&gt;You may have noticed that I have made use of caching for my OData service following the steps I found &lt;a href="http://blogs.msdn.com/b/peter_qian/archive/2010/11/17/using-asp-net-output-caching-with-wcf-data-services.aspx" target="_blank"&gt;here&lt;/a&gt;.  Again you may or may not want to use this.&lt;/p&gt; &lt;h4&gt;Now, a warning...&lt;/h4&gt; &lt;p&gt;Okay - not so much a warning as a limitation. Whilst most aspects of the OData service work as you would hope there is no support for the $select operator.  I had a frustrating time trying to discover why and then came upon this explanation:&lt;/p&gt; &lt;p&gt;&lt;em&gt;"$select statements are not supported. This problem is being discussed here &lt;a href="http://social.msdn.microsoft.com/Forums/en/adodotnetdataservices/thread/366086ee-dcef-496a-ad15-f461788ae678" target="_blank"&gt;http://social.msdn.microsoft.com/Forums/en/adodotnetdataservices/thread/366086ee-dcef-496a-ad15-f461788ae678&lt;/a&gt;  and is caused by the fact that CrmDataContext implements the IExpandProvider interface which in turn causes  the DataService to lose support for $select projections"&lt;/em&gt;&lt;/p&gt; &lt;p&gt;You can also see &lt;a href="http://social.microsoft.com/Forums/en/crmdevelopment/thread/31daedb4-3d75-483a-8d7f-269af3375d74" target="_blank"&gt;here&lt;/a&gt; for the original post discussing this.&lt;/p&gt; &lt;h4&gt;Finishing off&lt;/h4&gt; &lt;p&gt;In the example I set out here I used the version of WCF Data Services that shipped with Visual Studio 2010.  WCF Data Services now ships separately from the .NET Framework and you can &lt;a href="http://nuget.org/packages?q=wcf+data+services" target="_blank"&gt;pick up the latest and greatest from Nuget&lt;/a&gt;.  I understand that  you could easily switch over to using the latest versions but since I didn't see any feature that I needed on this occasion I haven't.&lt;/p&gt; &lt;p&gt;I hope you find this useful.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/115724943258840214'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/115724943258840214'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2012/09/giving-odata-to-crm-40.html' title='Giving OData to CRM 4.0'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2414704032922872709</id><published>2012-09-06T06:00:00.002+01:00</published><updated>2021-03-14T05:17:18.710Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='asp.net mvc'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Internationalisation'/><category scheme='http://www.blogger.com/atom/ns#' term='Globalization'/><category scheme='http://www.blogger.com/atom/ns#' term='Globalize JS'/><category scheme='http://www.blogger.com/atom/ns#' term='Localisation'/><category scheme='http://www.blogger.com/atom/ns#' term='jQuery Validation'/><category scheme='http://www.blogger.com/atom/ns#' term='jQuery.validate.js'/><title type='text'>Globalize and jQuery Validation</title><content type='html'>&lt;h4&gt;Update 05/10/2015&lt;/h4&gt; &lt;p&gt;If you're after a version of this that works with Globalize 1.x then take a look &lt;a href="https://blog.johnnyreilly.com/2015/10/jquery-validation-globalize-hits-10.html"&gt;here&lt;/a&gt;.&lt;/p&gt; &lt;h4&gt;Update 27/08/2013&lt;/h4&gt; &lt;p&gt;To make it easier for people to use the approach detailed in this post I have created a repository for &lt;code class="prettyprint js"&gt;jquery.validate.globalize.js&lt;/code&gt; on GitHub &lt;a href="https://github.com/johnnyreilly/jquery-validation-globalize" target="_blank"&gt;here&lt;/a&gt;.&lt;/p&gt; &lt;p&gt;This is also available as a nuget package &lt;a href="https://www.nuget.org/packages/jQuery.Validation.Globalize/" target="_blank"&gt;here&lt;/a&gt;.&lt;/p&gt; &lt;p&gt;To see a good demo take a look &lt;a href="http://jqueryvalidationunobtrusivenative.azurewebsites.net/AdvancedDemo/Globalize" target="_blank"&gt;here&lt;/a&gt;.&lt;/p&gt; &lt;h4&gt;Background&lt;/h4&gt; &lt;p&gt;&lt;a href="http://icanmakethiswork.blogspot.co.uk/2012/05/globalizejs-number-and-date.html" target="_blank"&gt;I've written before about a great little library called Globalize&lt;/a&gt; which makes locale specific number / date formatting simple within JavaScript.  And I've just stumbled upon an &lt;a href="http://www.hanselman.com/blog/GlobalizationInternationalizationAndLocalizationInASPNETMVC3JavaScriptAndJQueryPart1.aspx" target="_blank"&gt;old post written by Scott Hanselman about the business of Globalisation / Internationalisation / Localisation within ASP.NET&lt;/a&gt;.  It's a great post and I recommend reading it (I'm using many of the approaches he discusses).&lt;/p&gt; &lt;h4&gt;jQuery Global is dead... Long live Globalize!&lt;/h4&gt; &lt;p&gt;However, there's one tweak I would make to Scotts suggestions and that's to use Globalize in place of the jQuery Global plugin.  The jQuery Global plugin has now effectively been reborn as Globalize (with no dependancy on jQuery).  As far as I can tell jQuery Global is now disappearing from the web - certainly the link in Scotts post is dead now at least.  I've &lt;del&gt;ripped off&lt;/del&gt; been inspired by the "Globalized jQuery Unobtrusive Validation" section of Scotts article and made &lt;code class="prettyprint js"&gt;jquery.validate.globalize.js&lt;/code&gt;.&lt;/p&gt; &lt;p&gt;And for what it's worth &lt;code class="prettyprint js"&gt;jquery.validate.globalize.js&lt;/code&gt; applies equally to standard jQuery Validation as well as to jQuery Unobtrusive Validation.  I say that as the above JavaScript is effectively a monkey patch to the number / date / range / min / max methods of jQuery.validate.js which forces these methods to use Globalize's parsing support instead.&lt;/p&gt; &lt;p&gt;Here's the JavaScript:&lt;/p&gt; &lt;script src="https://gist.github.com/3651751.js?file=jquery.validate.globalize.js"&gt;&lt;/script&gt; &lt;p&gt;The above script does 2 things.  Firstly it monkey patches jquery.validate.js to make use of Globalize.js number and date parsing in place of the defaults.  Secondly it initialises Globalize to relevant current culture driven by the &lt;code&gt;html lang&lt;/code&gt; property.  So if the html tag looked like this:&lt;/p&gt; &lt;pre class="prettyprint html"&gt;&lt;br /&gt;&lt;code class="language-html"&gt;&lt;br /&gt;&amp;lt;html lang="de-DE"&amp;gt;&lt;br /&gt;...&lt;br /&gt;&amp;lt;/html&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Then Globalize would be initialised with the "de-DE" culture assuming that culture was available and had been served up to the client. (By the way, the Globalize initialisation logic has only been placed in the code above to demonstrate that Globalize needs to be initialised to the culture.  It's more likely that this initialisation step would sit elsewhere in a "proper" app.)&lt;/p&gt; &lt;h4&gt;Wait, where's &lt;code&gt;html lang&lt;/code&gt; getting set?&lt;/h4&gt; &lt;p&gt;In Scott's article he created a &lt;code class="prettyprint cs"&gt;MetaAcceptLanguage&lt;/code&gt; helper to generate a META tag like this: &lt;code class="prettyprint html"&gt;&amp;lt;meta name="accept-language" content="en-GB" /&amp;gt;&lt;/code&gt; which he used to drive Globalizes specified culture.&lt;/p&gt; &lt;p&gt;Rather than generating a meta tag I've chosen to use the &lt;code&gt;lang&lt;/code&gt; attribute of the &lt;code&gt;html&lt;/code&gt; tag to specify the culture.  I've chosen to do this as it's more in line with the &lt;a href="http://www.w3.org/TR/i18n-html-tech-lang/#ri20030510.102829377" target="_blank"&gt;W3C spec&lt;/a&gt;.  But it should be noted this is just a different way of achieving exactly the same end.&lt;/p&gt; &lt;p&gt;So how's it getting set?  Well, it's no great shakes; in my &lt;code&gt;_Layout.cshtml&lt;/code&gt; file my html tag looks like this:&lt;/p&gt; &lt;pre class="prettyprint html"&gt;&lt;br /&gt;&lt;code class="language-html"&gt;&lt;br /&gt;&amp;lt;html lang="@System.Globalization.CultureInfo.CurrentUICulture.Name"&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;And in my &lt;code&gt;web.config&lt;/code&gt; I have following setting set:&lt;/p&gt; &lt;pre class="prettyprint xml"&gt;&lt;br /&gt;&lt;code class="language-xml"&gt;&lt;br /&gt;&amp;lt;configuration&amp;gt;&lt;br /&gt;  &amp;lt;system.web&amp;gt;&lt;br /&gt;    &amp;lt;globalization culture="auto" uiCulture="auto" /&amp;gt;&lt;br /&gt;    &amp;lt;!--- Other stuff.... --&amp;gt;&lt;br /&gt;  &amp;lt;/system.web&amp;gt;&lt;br /&gt;&amp;lt;/configuration&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;With both of these set this means I get &lt;code class="prettyprint html"&gt;&amp;lt;html lang="de-DE"&amp;gt;&lt;/code&gt; or &lt;code class="prettyprint html"&gt;&amp;lt;html lang="en-GB"&amp;gt;&lt;/code&gt; etc. depending on a users culture.&lt;/p&gt; &lt;h4&gt;Serving up the right Globalize culture files&lt;/h4&gt; &lt;p&gt;In order that I send the correct Globalize culture to the client I've come up with this static class which provides the user with the relevant culture URL (falling back to the en-GB culture if it can't find one based your culture):&lt;/p&gt; &lt;script src="https://gist.github.com/3651751.js?file=GlobalizeUrls.cs"&gt;&lt;/script&gt; &lt;h4&gt;Putting it all together&lt;/h4&gt; &lt;p&gt;To make use of all of this together you'll need to have the &lt;code&gt;html lang&lt;/code&gt; attribute set as described earlier and some scripts output in your layout page like this:&lt;/p&gt; &lt;pre class="prettyprint html"&gt;&lt;br /&gt;&lt;code class="language-html"&gt;&lt;br /&gt;&amp;lt;script src="@Url.Content("~/Scripts/jquery.js")" type="text/javascript"&amp;gt;&amp;lt;/script&amp;gt;&lt;br /&gt;&amp;lt;script src="@Url.Content(GlobalizeUrls.Globalize)" type="text/javascript"&gt;&amp;lt;/script&amp;gt;&lt;br /&gt;&amp;lt;script src="@Url.Content(GlobalizeUrls.GlobalizeCulture)" type="text/javascript"&amp;gt;&amp;lt;/script&amp;gt;&lt;br /&gt;&amp;lt;script src="@Url.Content("~/Scripts/jquery.validate.js")" type="text/javascript"&amp;gt;&amp;lt;/script&amp;gt;&lt;br /&gt;&amp;lt;script src="@Url.Content("~/scripts/jquery.validate.globalize.js")" type="text/javascript"&amp;gt;&amp;lt;/script&amp;gt;&lt;br /&gt;&lt;br /&gt;@* Only serve the following script if you need it: *@&lt;br /&gt;&amp;lt;script src="@Url.Content("~/scripts/jquery.validate.unobtrusive.js")" type="text/javascript"&amp;gt;&amp;lt;/script&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Which will render something like this:&lt;/p&gt; &lt;pre class="prettyprint html"&gt;&lt;br /&gt;&lt;code class="language-html"&gt;&lt;br /&gt;&amp;lt;script src="/Scripts/jquery.js" type="text/javascript"&amp;gt;&amp;lt;/script&amp;gt;&lt;br /&gt;&amp;lt;script src="/Scripts/globalize.js" type="text/javascript"&amp;gt;&amp;lt;/script&amp;gt;&lt;br /&gt;&amp;lt;script src="/scripts/globalize/globalize.culture.en-GB.js" type="text/javascript"&amp;gt;&amp;lt;/script&amp;gt;&lt;br /&gt;&amp;lt;script src="/Scripts/jquery.validate.js" type="text/javascript"&amp;gt;&amp;lt;/script&amp;gt;&lt;br /&gt;&amp;lt;script src="/Scripts/jquery.validate.globalize.js" type="text/javascript"&amp;gt;&amp;lt;/script&amp;gt;&lt;br /&gt;&amp;lt;script src="/Scripts/jquery.validate.unobtrusive.js" type="text/javascript"&amp;gt;&amp;lt;/script&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;This will load up jQuery, Globalize, your Globalize culture, jQuery Validate, jQuery Validates unobtrusive extensions (which you don't need if you're not using them) and the jQuery Validate Globalize script which will set up culture aware validation.&lt;/p&gt; &lt;p&gt;Finally and just to re-iterate, it's highly worthwhile to give &lt;a href="http://www.hanselman.com/blog/GlobalizationInternationalizationAndLocalizationInASPNETMVC3JavaScriptAndJQueryPart1.aspx" target="_blank"&gt;Scott Hanselman's original article a look&lt;/a&gt;.  Most all the ideas in here were taken wholesale from him!&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2414704032922872709'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2414704032922872709'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html' title='Globalize and jQuery Validation'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-7208334143063159682</id><published>2012-08-25T08:21:00.001+01:00</published><updated>2012-08-25T08:21:32.334+01:00</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Reasons</title><content type='html'>No real use of new technology (a bit of Entity Framework but nothing else)  Lack of faith in architect. Ignorance is fine as long as you admit it.  Whats worrying is when the person youre dealing with admits no ignorance but when you examine the work underneath you find worrying trends:  Bad practices a-go-go.  One of the most professionally worrying setups I've experienced.    Really bad attention to detail with every person I dealt with.  This meant I had to essentially check everything that came over my desk for errors as I couldn't depend on other people to reliably deliver correct conclusions.  Really frustrating as so much time would be wasted.  1. Concerns about mounting technical debt which is likely to cause long term problems.  I understand the reason (pressure from the business) but if this is not dealt with sooner rather than later then in the end you won't be able to give the business what they need.  Worse you may find that what you deliver to the business is wrong.  Models that don't work - joining from a table in one database to a table in another database on datetime and then back to a different table in the first database.  A worrying approach.  2. An implicit lack of understanding about the technologies being employed.  WCF does not require GAC usage; it achieves nothing to manually create your own XML structure which will then be wrapped in the XML exposed by WCF.  There is a danger that if the manually created XML structure is changed dependant applications would break in a Production environment because no errors would be detected at compile time and there are no tests to enforce the structure.  Also using this approach you now have to write far more code to pull out the data you need.  3. Complete lack of structure when it comes to naming conventions etc.  Makes it hard to know how to maintain or take forward an application because even though a standard has been written it is not employed with any kind of rigour.  4.  Lack of structure in code.  One project which encompasses web app / database access layer / models etc  5. Lack of database normalisation etc.  Not the end of the world but a worrying sign.  6. IE 9 does not work on XP.  7. Lack of working development enviroments.  Peoples desktops became de-facto servers because they didn't have working development environments.  8. Sat by myself.  9. Poor culture generally - with the exception of the architect theres not a desire to learn.  There's no real urge to deliver.  There's a lot of time spent deciding whose fault things are rather than giving users what they need.  10. the misapplication of patterns.  The definition of composite classes; there is no such thing  only different classes that implement the composite pattern so they can have shared usage through use of a common interface. Alternatively composite data classes are really only "classes".  "Composite" adds nothing to the definition  11. Architect didn't understand how his own application worked.  Worrying.  12. Reinventing the wheel badly.  Architect didn't like Session as implemented in ASP.NET and so invented his own which was very buggy and brought down the application about once a week.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7208334143063159682'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7208334143063159682'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-7860904222158387905</id><published>2012-08-24T19:29:00.002+01:00</published><updated>2021-03-14T05:46:18.223Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='asp.net mvc'/><category scheme='http://www.blogger.com/atom/ns#' term='encode'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='PartialView'/><category scheme='http://www.blogger.com/atom/ns#' term='razor'/><category scheme='http://www.blogger.com/atom/ns#' term='attribute'/><title type='text'>How to attribute encode a PartialView in MVC (Razor)</title><content type='html'>&lt;p&gt;This post is plagiarism.  But I'm plagiarising myself so I don't feel too bad.&lt;/p&gt; &lt;p&gt;I posted a &lt;a href="http://stackoverflow.com/q/12093005/761388" target="_blank"&gt;question&lt;/a&gt; on StackOverflow recently asking if there was a simple way to attribute encode a PartialView in Razor / ASP.NET MVC.  I ended up answering my own question and since I thought it was a useful solution it might be worth sharing.&lt;/p&gt; &lt;h4&gt;The Question&lt;/h4&gt; &lt;p&gt;In the project I was working on I was using PartialViews to store the HTML that would be rendered in a tooltip in my ASP.NET MVC application. (In case you're curious I was using the &lt;a href="http://jquerytools.org/demos/tooltip/index.html" target="_blank"&gt;jQuery Tools library for my tooltip&lt;/a&gt; effect.)&lt;/p&gt; &lt;p&gt;I had thought that Razor, clever beast that it is, would automatically attribute encode anything sat between quotes in my HTML. Unfortunately this doesn't appear to be the case. In the short term I was able to workaround this by using single quotation marks to encapsulate my PartialViews HTML. See below for an example:&lt;/p&gt; &lt;pre class="brush: xml"&gt;&lt;br /&gt;&lt;code class="language-xml"&gt;&lt;br /&gt;&amp;lt;div class="tooltip" &lt;br /&gt;     title='@Html.Partial("_MyTooltipInAPartial")'&amp;gt;&lt;br /&gt;    Some content&lt;br /&gt;&amp;lt;/div&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Now this worked just fine but I was aware that if any PartialView needed to use single quotation marks I would have a problem.  Let's say for a moment that &lt;code&gt;_MyTooltipInAPartial.cshtml&lt;/code&gt; contained this:&lt;/p&gt; &lt;pre class="brush: xml"&gt;&lt;br /&gt;&lt;code class="language-xml"&gt;&lt;br /&gt;&amp;lt;span style="color:green"&amp;gt;fjkdsjf'lksdjdlks&amp;lt;/span&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Well when I used my handy little single quote workaround, the following would result:&lt;/p&gt; &lt;pre class="brush: xml"&gt;&lt;br /&gt;&lt;code class="language-xml"&gt;&lt;br /&gt;&amp;lt;div class="tooltip"&lt;br /&gt;     title='&amp;lt;span style="color:green"&amp;gt;fjkdsjf'lksdjdlks&amp;lt;/span&amp;gt;'&amp;gt;&lt;br /&gt;    Some content&lt;br /&gt;&amp;lt;/div&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Which although it doesn't show up so well in the code sample above is definite &lt;em&gt;"does not compute, does not compute, does not compute *LOUD EXPLOSION*"&lt;/em&gt; territory.&lt;/p&gt; &lt;h4&gt;The Answer&lt;/h4&gt; &lt;p&gt;This took me back to my original intent which was to encapsulate the HTML in double quotes like this:&lt;/p&gt; &lt;pre class="brush: xml"&gt;&lt;br /&gt;&lt;code class="language-xml"&gt;&lt;br /&gt;&amp;lt;div class="tooltip" &lt;br /&gt;     title="@Html.Partial("_MyTooltipInAPartial")"&amp;gt;&lt;br /&gt;    Some content&lt;br /&gt;&amp;lt;/div&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Though with the example discussed above we clearly had a problem whether we used single or double quotes.  What to do?&lt;/p&gt; &lt;p&gt;Well the answer wasn't too complicated.  After a little pondering I ended up scratching my own itch by writing an HTML helper method called &lt;code&gt;PartialAttributeEncoded&lt;/code&gt; which made use of &lt;code&gt;HttpUtility.HtmlAttributeEncode&lt;/code&gt; to HTML attribute encode a PartialView.&lt;/p&gt; &lt;p&gt;Here's the code:&lt;/p&gt; &lt;script src="https://gist.github.com/3449462.js?file=PartialExtensions.cs"&gt;&lt;/script&gt; &lt;p&gt;Using the above helper is simplicity itself:&lt;/p&gt; &lt;pre class="brush: xml"&gt;&lt;br /&gt;&lt;code class="language-xml"&gt;&lt;br /&gt;&amp;lt;div class="tooltip" &lt;br /&gt;     title="@Html.PartialAttributeEncoded("_MyTooltipInAPartial")"&amp;gt;&lt;br /&gt;    Some content&lt;br /&gt;&amp;lt;/div&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;And, given the example I've been going through, it would provide you with this output:&lt;/p&gt; &lt;pre class="brush: xml"&gt;&lt;br /&gt;&lt;code class="language-xml"&gt;&lt;br /&gt;&amp;lt;div class="tooltip"&lt;br /&gt;     title="&amp;amp;lt;span style=&amp;amp;quot;color:green&amp;amp;quot;&amp;gt;fjkdsjf&amp;amp;#39;lksdjdlks&amp;lt;/span&amp;gt;"&amp;gt;&lt;br /&gt;    Some content&lt;br /&gt;&amp;lt;/div&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Now the HTML in the title attribute above might be an unreadable mess - but it's the unreadable mess you need.  That's what the HTML we've been discussing looks like when it's been encoded.&lt;/p&gt; &lt;h4&gt;Final thoughts&lt;/h4&gt; &lt;p&gt;I was surprised that Razor didn't handle this out of the box.  I wonder if this is something that will come along with a later version?  It's worth saying that I experienced this issue when working on an MVC 3 application.  It's possible that this issue may actually have been solved with MVC 4 already; I haven't had chance to check yet though.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7860904222158387905'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7860904222158387905'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2012/08/how-to-attribute-encode-partialview-in.html' title='How to attribute encode a PartialView in MVC (Razor)'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2460276418125907169</id><published>2012-08-21T13:40:00.001+01:00</published><updated>2012-08-21T13:40:46.674+01:00</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Useful ASP.NET MVC Boilerplate</title><content type='html'>&lt;h4&gt;Because File -&gt; New Project isn't enough...&lt;/h4&gt; &lt;p&gt;It occurred to me the other day that whenever I start a new project that there is always a certain amount of boilerplate / components that I find myself putting in place because I know that I will probably come to need them.  I thought it might be worth writing about this - as much as anything else to document some of the conclusions I seem to have unconsciously reached....&lt;/p&gt; &lt;h4&gt;_Layout.cshtml&lt;/h4&gt; &lt;p&gt;Whenever you new up an MVC project you find yourself with a &lt;code&gt;_Layout.cshtml&lt;/code&gt; file sitting in &lt;code&gt;Shared&lt;/code&gt;.  A few of the web essentials are already in place (jQuery etc).  I tend to find myself customising this - pulling out some of the entries and adding new ones.&lt;/p&gt; &lt;h4&gt;_Layout.js&lt;/h4&gt;      maybe I should make my own project template?  Ajax start  jquery jquery ui dialog json.net amplify.js  script bundler  basecontroller - yes I know it's unfashionable and I could do this using x  Globalize.js  nugets quite helpful           Layout.js:  /// &lt;reference path="/scripts/jquery-1.7.2-vsdoc.js" /&gt;/// &lt;reference path="/scripts/amplify-vsdoc.js" /&gt;/// &lt;reference path="/scripts/globalize.js" /&gt; //=============================================================================== // _Layout.js - relates to _Layout.cshtml - javascript functionality shared throughout the app //=============================================================================== $(document).ready(function () {      //===========================================================================     // Set Globalize to the current culture     //===========================================================================     var currentCulture = $("body").data("currentCulture");     if (currentCulture) {         Globalize.culture(currentCulture);     }      //===========================================================================     // Create the overlay used to display error messages     //===========================================================================     $("#errorOverlay").overlay({          top: "25%",         mask: { // some mask tweaks suitable for facebook-looking dialogs             color: "black",             loadSpeed: 200,             opacity: 0.7         },         closeOnClick: false // disable this for modal dialog-type of overlays     });      //===========================================================================     // Subscribe to "error" publications - pick out error message and display in over if published     //===========================================================================     amplify.subscribe("error", function (data) {          //Set error message         $("#errorOverlayMessage").text(data.errorMessage);          //Show overlay         $("#errorOverlay").overlay().load();     });      //===========================================================================     // Wire up all AJAX errors to publish error message     //===========================================================================     $.ajaxSetup({         error: function (jqXHR, textStatus, errorThrown) {              //Default error message             var errorMessage = "Unknown error occurred...";              //Try and parse error out of responseText             try {                 errorMessage = JSON.parse(jqXHR.responseText).ErrorMessage;             }             catch (e) { }              //Publish out error message             amplify.publish("error", { errorMessage: errorMessage });         }     }); });   Layout.cshtml:  @{     Html.AddScript(URLs.jQuery, priority: 2);     Html.AddScript(URLs.Globalize, priority: 3);     Html.AddScript(URLs.GlobalizeCulture, priority: 3);     Html.AddScript(URLs.AmplifyJS, priority: 3);     Html.AddScript(URLs.jQueryUI, priority: 3);     Html.AddScript("~/Scripts/jquery.tools.min.js", priority: 3);     Html.AddScript("~/Scripts/Views/Shared/_Layout.js", priority: 4); } &lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;    &lt;title&gt;@ViewBag.Title&lt;/title&gt;    &lt;meta http-equiv="X-UA-Compatible" content="IE=edge" /&gt;    &lt;link rel="Shortcut Icon" href="@Url.Content("~/Content/Images/ApplicationIcon.ico")"/&gt;    @Html.Link("~/Content/CSS/screen.css")     @Html.Link("~/Content/CSS/IRIS.css")     @Html.Link("~/Content/CSS/jQueryUI/jquery-ui-1.8.21.custom.css")     @RenderSection("CSSLinks", required: false) &lt;/head&gt;&lt;body data-current-culture="@ApplicationSettings.Locale"&gt;&lt;div id="headerDiv"&gt;    &lt;div id="pageHeaderBlueBackground"&gt;        &lt;div id="pageHeaderGreyBackground"&gt;         &lt;div id="pageHeaderCenter"&gt;            &lt;div class="logoDiv"&gt;            &lt;/div&gt;            @RenderSection("PageHeader", required: false)             &lt;div class="userInfoDiv"&gt;                    &lt;a id="HomeButton" href="@Url.Action("Menu", "Home")"&gt;&lt;div class="homeIcon"&gt;&lt;/div&gt;&lt;/a&gt;                    &lt;ul&gt;                        &lt;li&gt;&lt;span&gt;Logged in as:&lt;/span&gt; @ViewBag.UserFullName&lt;/li&gt;                                                &lt;li&gt;&lt;span&gt;System&lt;/span&gt; IRIS&lt;/li&gt;                                            &lt;/ul&gt;             &lt;/div&gt;           &lt;/div&gt;         &lt;/div&gt;    &lt;/div&gt;&lt;/div&gt;&lt;div id="bodyDiv"&gt;     @if (IsSectionDefined("PageInfo")) {     &lt;div id="filterDiv"&gt;        @RenderSection("PageInfo")     &lt;/div&gt;} @if (IsSectionDefined("TopBar")) {     &lt;div id="topGreyArea"&gt;        @RenderSection("TopBar")     &lt;/div&gt;}     &lt;div id="contentDiv"&gt;        @RenderBody()     &lt;/div&gt;&lt;/div&gt;@Html.Partial("_ErrorOverlay") @Html.Scripts() &lt;/body&gt;&lt;/html&gt; _ErrorOverlay.cshtml:  @*     THIS IS A GENERIC ERROR OVERLAY THAT CAN BE USED THROUGHOUT THE APP     AND USES PUB/SUB MECHANISM OF AmplifyJS to PASS ERRORS *@ &lt;div id="errorOverlay"&gt;    &lt;div&gt;        &lt;h5&gt;            Error             &lt;span id="errorOverlayClose" class="close"&gt;&lt;/span&gt;        &lt;/h5&gt;        &lt;div id="errorOverlayMain"&gt;            &lt;h2 id="errorOverlayTitle"&gt;An error has occurred:&lt;/h2&gt;             &lt;p id="errorOverlayMessage"&gt;&lt;/p&gt;             &lt;p&gt;&lt;a href="mailto:ashamsi@hatfieldphilips.com"&gt;Please contact support.&lt;/a&gt;&lt;/p&gt;             &lt;button class="close" type="button"&gt;Close&lt;/button&gt;        &lt;/div&gt;    &lt;/div&gt;&lt;/div&gt; BaseController.cs:  using System; using System.Collections.Generic; using System.Linq; using System.Net; using System.Web; using System.Web.Mvc; using System.Xml; using System.IO; using System.Xml.Linq; using LNRCorporate.CommonClasses; using LNRCorporate.Common; using LNRCorporate.Common.Controllers; using LNRCorporate.Common.Helpers; using LNRCorporate.Common.Resources; using LNRCorporate.CommonWeb.Helpers; using LNRCorporate.CommonWeb.Session;  namespace LNRCorporate.CommonWeb.Controllers {     /// &lt;summary&gt;    /// Author      : John Reilly     /// Description : A Controller base class that encapsulates common functionality      /// &lt;/summary&gt;    [OutputCache(NoStore = true, Duration = 0, VaryByParam = "*")] /* Prevents caching so stale data cannot be served */     public abstract class BaseController : Controller     {         #region Constructors          /// &lt;summary&gt;        /// Author      : John Reilly         /// Description : Constructor that initialises properties         /// &lt;/summary&gt;        public BaseController()         {             _currentUserSessionID = SessionHandler.GetSessionID();             _currentUserSession = SessionHandler.GetSession(CurrentUserSessionID);         }          #endregion          #region Members          private string _currentUserSessionID = null;         private UserSession _currentUserSession = null;          #endregion          #region Properties          /// &lt;summary&gt;        /// Author      : John Reilly         /// Description : Unified accessor for SessionID access         /// &lt;/summary&gt;        public string CurrentUserSessionID { get { return _currentUserSessionID; } }          /// &lt;summary&gt;        /// Author      : John Reilly         /// Description : Unified accessor for UserSession access         /// &lt;/summary&gt;        public UserSession CurrentUserSession { get { return _currentUserSession; } }          #endregion          #region Methods          /// &lt;summary&gt;        /// Author      : John Reilly         /// Description : After every action result executed resave the session so LastTimeAccessed is updated         ///               If it's not desired to do this when changes have not been made to the session then         ///               maybe a flag should be set against the session which indicates when changes have been         ///               made and only saves them then.         /// &lt;/summary&gt;        /// &lt;param name="filterContext"&gt;&lt;/param&gt;        protected override void OnResultExecuted(ResultExecutedContext filterContext)         {             SessionHandler.SetSession(CurrentUserSessionID, CurrentUserSession);              base.OnResultExecuted(filterContext);         }          /// &lt;summary&gt;        /// Author      : John Reilly         /// Description : Unauthorised users are redirected to the error page at this point         /// &lt;/summary&gt;        /// &lt;param name="filterContext"&gt;&lt;/param&gt;        protected override void OnAuthorization(AuthorizationContext filterContext)         {             base.OnAuthorization(filterContext);              if (!CurrentUserSession.IsUserAuthorised)             {                 //Log exception with ExceptionController (perhaps it would be a good idea if the exception could be passed as an input?)                 new ExceptionController().RaiseException(                     errorID: Constants.ERR_INVALID_USER_NAME,                     description: "The user has not been authorised.",                     applicationID: ApplicationSettings.ApplicationID,                     userID: CurrentUserSession.UserID                     );                  var exceptionForUser = new UnauthorizedAccessException("You are not authorised to access IRIS.");                 if (filterContext.RequestContext.HttpContext.Request.IsAjaxRequest())                 {                     // Return AJAX error                     filterContext.Result = new JsonResult                     {                         Data = exceptionForUser                     };                 }                 else                 {                      // Switch to an error view                     var model = new HandleErrorInfo(                         exception: exceptionForUser,                         controllerName: filterContext.RouteData.Values["controller"] as string,                         actionName: filterContext.RouteData.Values["action"] as string                         );                     filterContext.Result = new ViewResult                     {                         ViewName = "_GenericErrorPage",                         ViewData = new ViewDataDictionary&lt;HandleErrorInfo&gt;(model),                         TempData = filterContext.Controller.TempData                     };                 }                  // Configure the response object                  filterContext.HttpContext.Response.Clear();                 filterContext.HttpContext.Response.StatusCode = (int)HttpStatusCode.Unauthorized;                 filterContext.HttpContext.Response.TrySkipIisCustomErrors = true;             }         }          /// &lt;summary&gt;        /// Author      : John Reilly         /// Description : Global handler for Controller exceptions - for details on this approach see Dino Esposito's article here: http://www.devproconnections.com/article/aspnetmvc/aspnet-exception-141263         /// &lt;/summary&gt;        /// &lt;param name="filterContext"&gt;&lt;/param&gt;        protected override void OnException(ExceptionContext filterContext)         {             //don't interfere if the exception is already handled             if (filterContext.ExceptionHandled) return;              //Log exception with ExceptionController (perhaps it would be a good idea if the exception could be passed as an input?)             new ExceptionController().RaiseException(                 errorID: Constants.ERR_SYSTEM_EXCEPTION,                 description: filterContext.Exception.GetExceptionDetails(),                 applicationID: ApplicationSettings.ApplicationID,                 userID: CurrentUserSession.UserID                 );  #if DEBUG             //In debug mode return the actual exception to aid debugging             var exceptionForUser = filterContext.Exception;             var errorMessage = exceptionForUser.GetExceptionDetails(); #else             //In production mode return a generic exception to the users             var exceptionForUser = new Exception("A problem has occurred...");             var errorMessage = exceptionForUser.Message; #endif              if (filterContext.RequestContext.HttpContext.Request.IsAjaxRequest())             {                 // Return AJAX error                 filterContext.Result = new JsonResult                 {                     Data = new { ErrorMessage = errorMessage },                      JsonRequestBehavior = JsonRequestBehavior.AllowGet                 };             }             else             {                 // Switch to an error view                 var model = new HandleErrorInfo(                     exception: exceptionForUser,                     controllerName: filterContext.RouteData.Values["controller"] as string,                     actionName: filterContext.RouteData.Values["action"] as string                     );                 filterContext.Result = new ViewResult                 {                     ViewName = "_GenericErrorPage",                     ViewData = new ViewDataDictionary&lt;HandleErrorInfo&gt;(model),                     TempData = filterContext.Controller.TempData                 };             }              // Configure the response object              filterContext.ExceptionHandled = true;             filterContext.HttpContext.Response.Clear();             filterContext.HttpContext.Response.StatusCode = (int)HttpStatusCode.InternalServerError;             filterContext.HttpContext.Response.TrySkipIisCustomErrors = true;         }          /// &lt;summary&gt;        /// Author      : John Reilly         /// Description : Wrapper to extension method of RenderRazorViewToString (so we don't need to do "this.")         /// &lt;/summary&gt;        /// &lt;param name="viewName"&gt;&lt;/param&gt;        /// &lt;param name="model"&gt;&lt;/param&gt;        /// &lt;returns&gt;&lt;/returns&gt;        protected string RazorViewToString(string viewName, object model)         {             return this.RenderRazorViewToString(viewName, model);         }          #endregion     } } </content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2460276418125907169'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2460276418125907169'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-926529170509377552</id><published>2012-08-16T20:00:00.000+01:00</published><updated>2012-08-17T05:55:35.290+01:00</updated><category scheme='http://www.blogger.com/atom/ns#' term='MDeLeon'/><category scheme='http://www.blogger.com/atom/ns#' term='Open XML'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Excel'/><category scheme='http://www.blogger.com/atom/ns#' term='ClosedXML'/><title type='text'>ClosedXML - the real SDK for Excel</title><content type='html'>&lt;p&gt;Simplicity appeals to me.  It always has.  Something that is simple is straightforward to comprehend and is consequently easy to use.  It's clarity.&lt;/p&gt; &lt;h4&gt;Open XML&lt;/h4&gt; &lt;p&gt;So imagine my joy when I first encountered &lt;a href="http://msdn.microsoft.com/en-us/office/bb265236.aspx" target="_blank"&gt;Open XML&lt;/a&gt;.  In Microsofts own words:&lt;/p&gt; &lt;p style="font-style:italic"&gt;ECMA Office Open XML ("Open XML") is an international, open standard for word-processing documents, presentations, and spreadsheets that can be freely implemented by multiple applications on multiple platforms.&lt;/p&gt; &lt;p&gt;What does that actually mean?  Well, from my perspective in the work I was doing I needed to be able to programmatically interact with Excel documents from C#.  I needed to be able to create spreadsheets, to use existing template spreadsheets which I could populate dynamically in code.  I needed to do Excel.  And according to Microsoft, the Open XML SDK was how I did this.&lt;/p&gt; &lt;p&gt;What can I say about it?  Open XML works.  The API functions.  You can use this to achieve your aims; and I did (initially).  However, there's a but and it's this: it became quickly apparent just how hard Open XML makes you work to achieve relatively simple goals.  Things that ought to be, in my head, a doddle require reams and reams of obscure code.  Sadly, I feel that Open XML is probably the most frustrating API that I have yet encountered (and I've coded against the old school Lotus Notes API).&lt;/p&gt; &lt;h4&gt;Closed XML - Open XML's DbContext&lt;/h4&gt; &lt;p&gt;As I've intimated I found Open XML to be enormously frustrating.  I'd regularly find myself thinking I'd achieved my goal.  I may have written War and Peace code-wise but it compiled, it looked right - the end was in sight.  More fool me.  I'd run, sit back watch my Excel doc get created / updated / whatever.  Then I'd open it and be presented with some obscure error about a corrupt file. Not great.&lt;/p&gt; &lt;p&gt;As I was Googling around looking for answers to my problem that I discovered an open source project on CodePlex called &lt;a href="http://closedxml.codeplex.com/" target="_blank"&gt;Closed XML&lt;/a&gt;.  I wasn't alone in frustrations with Open XML - there were many of us sharing the same opinion.  And some fantastic person had stepped into the breach to save us! In ClosedXMLs own words:&lt;/p&gt; &lt;p style="font-style:italic"&gt;ClosedXML makes it easier for developers to create Excel 2007/2010 files. It provides a nice object oriented way to manipulate the files (similar to VBA) without dealing with the hassles of XML Documents. It can be used by any .NET language like C# and Visual Basic (VB).&lt;/p&gt; &lt;p&gt;Hallelujah!!!&lt;/p&gt; &lt;p&gt;The way it works (as far as I understand) is that ClosedXML sits on top of Open XML and exposes a really straightforward API for you to interact with.  I haven't looked into the guts of it but my guess is that it internally uses Open XML to achieve this (as to use ClosedXML you must reference DocumentFormat.OpenXml.dll).&lt;/p&gt; &lt;p&gt;I've found myself thinking of ClosedXML's relationship to Open XML in the same way as I think about Entity Frameworks DbContexts relationship to ObjectContext.  They do the same thing but the former in both cases offers a better API.  They makes achieving the same goals *&lt;b&gt;much&lt;/b&gt;* easier.  (Although in fairness to the EF team I should say that ObjectContext was not particularly problematic to use; just DbContext made life even easier.)&lt;/p&gt; &lt;h4&gt;Support - This is how it should be done!&lt;/h4&gt; &lt;p&gt;Shortly after I started using ClosedXML I was asked if we could use it to perform a certain task.  I tested.  We couldn't.&lt;/p&gt; &lt;p&gt;When I discovered this &lt;a href="http://closedxml.codeplex.com/workitem/8174" target="_blank"&gt;I raised a ticket&lt;/a&gt; against the project asking if the functionality was likely to be added at any point.  I honestly didn't expect to hear back any time soon and was mentally working out ways to get round the issue for now.&lt;/p&gt; &lt;p&gt;To my surprise within &lt;em style="text-decoration: underline;font-size:1.5em;font-weight:bold"&gt;5 hours&lt;/em&gt; &lt;a href="http://www.codeplex.com/site/users/view/MDeLeon" target="_blank"&gt;MDeLeon&lt;/a&gt; the developer behind ClosedXML had released a patch to the source code!  By any stretch of the imagination that is fast!  As it happened there were a few bugs that needed ironing out and over the course of the next 3 working days MDeLeon performed a number of fixes and left me quickly in the position of having a version of ClosedXML which allowed me to achieve my goal.&lt;/p&gt; &lt;p&gt;So this blog post exists in part to point anyone who is battling Open XML to ClosedXML.  It's brilliant, well documented and I'd advise anyone to use it.  You won't be disappointed.  And in part I wanted to say thanks and well done to MDeLeon who quite made my week!  Thank you!&lt;/p&gt; &lt;p&gt;&lt;a href="http://closedxml.codeplex.com/" target="_blank"&gt;http://closedxml.codeplex.com/&lt;/a&gt;&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/926529170509377552'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/926529170509377552'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2012/08/closedxml-real-sdk-for-excel.html' title='ClosedXML - the real SDK for Excel'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4743261659382665511</id><published>2012-08-09T08:58:00.000+01:00</published><updated>2012-08-09T08:58:31.092+01:00</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Using RazorViewToString to update the client</title><content type='html'>Example of updating content on the client:           /// &lt;summary&gt;        /// Author      : John Reilly         /// Description : Save away comments (used for both Borrower and Lender Waterfall Controls)         ///&lt;/summary&gt;        [HttpPost]         public JsonResult SaveComment(int waterfallControlID, string commentText)         {             //Create a new comment and attach to a existing waterfall control             var waterfallControl = _unitOfWork.waterfall_control.FindWhere(wc =&gt; wc.waterfall_id == waterfallControlID).Single();              //Add a new comment to existing waterfall control             var newComment = new waterfall_comments()             {                 waterfall_id = waterfallControlID,                 comment = commentText,                 user_added = CurrentUserSession.UserID,                 date_added = CommonOperations.GetCurrentDate()             };              waterfallControl.waterfall_comments.Add(newComment);              try             {                 _unitOfWork.Commit();             }             catch (DbEntityValidationException dbEx)             {                 //Send validation errors to the client                 return Json(new { Errors = dbEx.GetValidationExceptionList() });             }              //Update the comments on the client             var updatedContent = new Dictionary&lt;string, string&gt;            {                 {                     string.Format("#partialPanelComment{0}", waterfallControl.waterfall_id),                     RazorViewToString("_PartialPanelComment", waterfallControl.waterfall_comments)                 }             };              return Json(new { UpdatedContent = updatedContent });         }  Example of appending content on the client:          /// &lt;summary&gt;        /// Author      : John Reilly         /// Description : This saves a new waterfall to the database and refreshes the GUI         /// &lt;/summary&gt;        [HttpPost]         public JsonResult SaveGeneralDetails(int loanControlID, int waterfallType, string waterfallName)         {             //Create and add a new waterfall control             var newWaterfallControl = _unitOfWork.waterfall_control.Add(new waterfall_control()             {                 loan_id = loanControlID,                 waterfall_type = waterfallType,                 waterfall_name = waterfallName,                 finalised = false,                 report_start_date = CommonOperations.GetCurrentDate(),                 report_end_date = CommonOperations.GetCurrentDate(),                 date_added = CommonOperations.GetCurrentDate(),                 user_added = CurrentUserSession.UserID             });              //If this is a lender then add an associated lender balance              if (waterfallType == (int)WaterfallType.LenderPostDefault || waterfallType == (int)WaterfallType.LenderPreDefault)             {                 //THERE IS THE PRESENTLY THE UNRESOLVED report_start_date AND report_end_date ISSUE.                   //THIS SHOULD BE REMOVED AT SOME POINT IN THE FUTURE                  //ONCE THIS HAS BEEN RESOLVED WE CAN HAVE SOME CONFIDENCE IN THIS CODE.  UNTIL THEN THIS SHOULD                 //BE TREATED AS DEMO ONLY.                 newWaterfallControl.lender_balance = new List&lt;lender_balance&gt;{                      new lender_balance()                     {                         loan_id = newWaterfallControl.loan_id,                         date_added = newWaterfallControl.date_added,                         user_added = newWaterfallControl.user_added,                         escrowed_amounts = 0,                         expenses = 0,                         net_swap_payments = 0,                         primary_servicing_fees = 0,                         special_servicing_fees = 0,                          report_start_date = newWaterfallControl.report_start_date, //THIS SHOULD DISAPPEAR IN FUTURE                         report_end_date = newWaterfallControl.report_end_date      //THIS SHOULD DISAPPEAR IN FUTURE                     }                 };             }              //TODO: WE NEED AUDITING ADDED HERE              //Try and save - pick up any validation errors             try             {                 _unitOfWork.Commit();             }             catch (DbEntityValidationException dbEx)             {                 //Send validation errors to the client                 return Json(new { Errors = dbEx.GetValidationExceptionList() });             }              //Get waterfall controls to drive tabs             var viewModel = RetrieveGeneralDetails(loanControlID);              //Remove all waterfall controls apart from the one just added             viewModel.WaterfallControlsOther.Clear();             viewModel.WaterfallControlsOther.Add(newWaterfallControl);              //Create a dictionary that contains key value pairs where key is the css selector of a DOM element that             //should have this content appended and the value is the content.             var appendedContent = new Dictionary&lt;string, string&gt;            {                 {                     "#tabsRoot",                     RazorViewToString("_PartialPanelTabHeaders", viewModel.WaterfallControlsOther)                 },                 {                     "#waterfallDetails",                     RazorViewToString("_PartialPanelBorrowerAndLender", viewModel)                 }             };              return Json(new { AppendedContent = appendedContent });         }  BaseController.RazorViewToString method:           /// &lt;summary&gt;        /// Author      : John Reilly         /// Description : Wrapper to extension method of RenderRazorViewToString (so we don't need to do "this.")         /// &lt;/summary&gt;        /// &lt;param name="viewName"&gt;&lt;/param&gt;        /// &lt;param name="model"&gt;&lt;/param&gt;        /// &lt;returns&gt;&lt;/returns&gt;        protected string RazorViewToString(string viewName, object model)         {             return this.RenderRazorViewToString(viewName, model);         }  RenderRazorViewToString:  using System; using System.Collections.Generic; using System.Linq; using System.Web; using System.Web.Mvc; using System.IO;  namespace LNRCorporate.CommonWeb.Helpers {     /// &lt;summary&gt;    /// MVC HtmlHelper extension methods - controller extensions     /// &lt;/summary&gt;    public static class ControllerExtensions     {         /// &lt;summary&gt;        /// Author      : John Reilly         /// Description : Extension method to render a partial view to a string - taken from here: http://craftycodeblog.com/2010/05/15/asp-net-mvc-render-partial-view-to-string/         /// &lt;/summary&gt;        /// &lt;param name="controller"&gt;&lt;/param&gt;        /// &lt;param name="viewName"&gt;&lt;/param&gt;        /// &lt;param name="model"&gt;&lt;/param&gt;        /// &lt;returns&gt;&lt;/returns&gt;        public static string RenderRazorViewToString(this Controller controller, string viewName, object model)         {             if (controller == null)             {                 throw new ArgumentNullException("controller", "Extension method called on a null controller");             }              if (controller.ControllerContext == null)             {                 return string.Empty;             }              controller.ViewData.Model = model;             using (var sw = new StringWriter())             {                 var viewResult = ViewEngines.Engines.FindPartialView(controller.ControllerContext, viewName);                 var viewContext = new ViewContext(controller.ControllerContext, viewResult.View, controller.ViewData, controller.TempData, sw);                                  viewResult.View.Render(viewContext, sw);                 viewResult.ViewEngine.ReleaseView(controller.ControllerContext, viewResult.View);                  return sw.GetStringBuilder().ToString();             }         }     } }  Javascript / jQuery to process on client:              //Perform AJAX update             $.ajax($form.prop("action"), {                 type: $form.prop("method"),                 data: JSON.stringify({                     loanControlID: $form.data("loanId"),                     waterfallType: $("#general-WaterfallType option:selected").val(),                     waterfallName: $("#general-WaterfallName option:selected").text()                 }),                 contentType: "application/json",                 context: $form,                 success: wizardFunctions.SuccessfulPostback             });  where:          //===========================================================================         // Deal with what comes back from the controller for AJAX submission generically         //===========================================================================         SuccessfulPostback: function (data, textStatus, jqXHR) {              var cssSelector, $form, $errorDiv;              //If we've been passed a jQuery set then we can assume it's the form             if (this instanceof jQuery) {                 $form = this,                 $errorDiv = $form.find(".wizardErrorMessage");             }              if (data.Errors) {                  //Display errors - populate UL and display                 if ($errorDiv) {                      $errorDiv.parent().find(".navigationWizardMainLayout,.navigationWizardButtonRowContainer").hide("fast");  //Hide confirmation details                     $errorDiv.children("ul").html("&lt;li&gt;" + data.Errors.join("&lt;/li&gt;&lt;li&gt;") + "&lt;/li&gt;");                     $errorDiv.show("fast"); //Show errors                 }             }             else if (data.UpdatedContent || data.AppendedContent) {                  //Hide errors (if not already hidden)                 if ($errorDiv) {                     $errorDiv.hide();                 }                  //Refresh DOM elements as required                 if (data.UpdatedContent) {                     for (cssSelector in data.UpdatedContent) {                         if (data.UpdatedContent.hasOwnProperty(cssSelector)) {                             //Empty the existing element and then populate with new content                              $(cssSelector).empty().html(data.UpdatedContent[cssSelector]);                         }                     }                 }                  //Append DOM elements as required                 if (data.AppendedContent) {                     for (cssSelector in data.AppendedContent) {                         if (data.AppendedContent.hasOwnProperty(cssSelector)) {                             //Append new content given the provided cssSelector                             $(data.AppendedContent[cssSelector]).appendTo(cssSelector);                         }                     }                 }                  //Close overlay                 if ($form) {                     $($form.data("wizardSelector")).overlay().close();                 }             }         },</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4743261659382665511'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4743261659382665511'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5330235554109008116</id><published>2012-08-09T08:41:00.001+01:00</published><updated>2012-08-09T08:41:22.433+01:00</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>DatePickerExtensions.cs</title><content type='html'>using System; using System.Collections.Generic; using System.Linq; using System.Web; using System.Web.Mvc; using System.Web.Mvc.Html; using System.IO; using System.Linq.Expressions; using System.Web.Routing; using System.Globalization; using NamespaceWithAddScriptsIn;  namespace MyNamespace {     /// &lt;summary&gt;    /// MVC HtmlHelper extension methods - html element extensions     /// &lt;/summary&gt;    public static class DatePickerExtensions     {         #region Public          /// &lt;summary&gt;        /// Render a DatePicker         /// &lt;/summary&gt;        /// &lt;param name="helper"&gt;&lt;/param&gt;        /// &lt;param name="name"&gt;&lt;/param&gt;        /// &lt;param name="htmlAttributes"&gt;OPTIONAL&lt;/param&gt;        /// &lt;param name="dateToInitialiseWith"&gt;OPTIONAL&lt;/param&gt;        /// &lt;returns&gt;&lt;/returns&gt;        public static MvcHtmlString DatePicker(           this HtmlHelper helper,           string name,           object htmlAttributes = null,           DateTime? dateToInitialiseWith = null)         {             var attributes = HtmlHelper.AnonymousObjectToHtmlAttributes(htmlAttributes);              AddDatePickerAttributes(dateToInitialiseWith, attributes);              return helper.TextBox(name, null, attributes);         }          /// &lt;summary&gt;        /// Render a DatePicker for an element.         ///          /// DatePickerFor example:         ///          /// @Html.DatePickerFor(x =&gt; x.TradeDate, new { id = "myTradeDate" })         ///          /// DateRange example:         ///          /// @Html.DatePickerFor(x =&gt; x.FromDate, new {         ///                         id = "myFromDate",         ///                         data_is_date_range = "true",         ///                         data_is_from = "true",         ///                         data_other_date_picker = "myToDate"         ///                     })         ///          /// @Html.DatePickerFor(x =&gt; x.ToDate, new {         ///                         id = "myToDate",         ///                         data_is_date_range = "true",         ///                         data_is_from = "false",         ///                         data_other_date_picker = "myFromDate"         ///                     })         /// &lt;/summary&gt;        /// &lt;typeparam name="TModel"&gt;&lt;/typeparam&gt;        /// &lt;typeparam name="TProperty"&gt;&lt;/typeparam&gt;        /// &lt;param name="helper"&gt;&lt;/param&gt;        /// &lt;param name="expression"&gt;&lt;/param&gt;        /// &lt;param name="htmlAttributes"&gt;OPTIONAL&lt;/param&gt;        /// &lt;returns&gt;&lt;/returns&gt;        public static MvcHtmlString DatePickerFor&lt;TModel, TProperty&gt;(           this HtmlHelper&lt;TModel&gt; helper,           Expression&lt;Func&lt;TModel, TProperty&gt;&gt; expression,           object htmlAttributes = null)         {             var attributes = HtmlHelper.AnonymousObjectToHtmlAttributes(htmlAttributes);              //Get date from models property             var date = ModelMetadata.FromLambdaExpression(expression, helper.ViewData).Model as DateTime?;              AddDatePickerAttributes(date, attributes);              //Make a picker             return helper.TextBoxFor(expression, attributes);         }          /// &lt;summary&gt;        /// Render script files for datepicker         /// &lt;/summary&gt;        /// &lt;param name="helper"&gt;&lt;/param&gt;        /// &lt;returns&gt;&lt;/returns&gt;        public static MvcHtmlString AddDatePickerScripts(this HtmlHelper helper)         {             //Determine culture - GUI culture for preference, user selected culture as fallback             var currentCulture = CultureInfo.CurrentCulture;             var filePattern = "~/scripts/ui/i18n/jquery.ui.datepicker-{0}.js";             var regionalisedFileToUse = string.Format(filePattern, "en-GB"); //Default localisation to use              //Try to pick a more appropriate regionalisation             if (File.Exists(HttpContext.Current.Server.MapPath(string.Format(filePattern, currentCulture.Name)))) //First try for a jquery.ui.datepicker-en-GB.js style file                 regionalisedFileToUse = string.Format(filePattern, currentCulture.Name);             else if (File.Exists(HttpContext.Current.Server.MapPath(string.Format(filePattern, currentCulture.TwoLetterISOLanguageName)))) //That failed; now try for a jquery.ui.datepicker-de.js style file                 regionalisedFileToUse = string.Format(filePattern, currentCulture.TwoLetterISOLanguageName);              //Render scripts             helper.AddScript(URLs.jQueryUI, 3); //JQuery UI library - this is probably unnecessary as should be in page already             helper.AddScript(regionalisedFileToUse, 3); //script that is responsible for regionalising the date picker.  IMPORTANT THAT THIS IS BEFORE DatePicker.js IN ORDER THAT DATEPICKERS ARE ALL SET TO THE SAME REGIONALISATION             helper.AddScript("~/scripts/datePickerPubSub.js", 4); //script that is responsible for initialising date pickers              return MvcHtmlString.Empty;         }          #endregion          #region Private          /// &lt;summary&gt;        /// Common private method for adding shared datepicker properties         /// &lt;/summary&gt;        /// &lt;param name="dateToInitialiseWith"&gt;&lt;/param&gt;        /// &lt;param name="attributes"&gt;&lt;/param&gt;        private static void AddDatePickerAttributes(DateTime? dateToInitialiseWith, RouteValueDictionary attributes)         {             //Add datepicker class to any other classes that may already be in place             var cssClass = "datepicker";             if (attributes.ContainsKey("class")) cssClass += " " + attributes["class"];             attributes["class"] = cssClass;              //If a date has been passed then store it away in a data attribute to be used on initialisation             if (dateToInitialiseWith.HasValue) attributes["data-date-for-initialisation"] = dateToInitialiseWith.Value.ToString("yyyy-MM-dd");         }          #endregion     } }</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5330235554109008116'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5330235554109008116'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1078093664526233590</id><published>2012-08-06T20:33:00.001+01:00</published><updated>2021-03-04T18:12:13.718Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='jquery unobtrusive validation'/><title type='text'>jQuery Unobtrusive Validation (+ associated gotchas)</title><content type='html'>&lt;p&gt;I was recently working on a project which had client side validation manually set up which essentially duplicated the same logic on the server.  Like many things this had started out small and grown and grown until it became arduos and tedious to maintain.&lt;/p&gt; &lt;p&gt;Time to break out the unobtrusive jQuery validation.&lt;/p&gt; &lt;p&gt;If youre not aware of this, as part of MVC 3 Microsoft leveraged the pre-existing &lt;a href="http://bassistance.de/jquery-plugins/jquery-plugin-validation/" target="_blank"&gt;jQuery Validate library&lt;/a&gt; and introduced an unobtrusive  extension to this which allows the library to be driven by HTML 5 data attributes.  I have mentioned this lovely extension before but I haven't been using it for the last 6 months or so.  And coming back to it I realised that I had forgotten a few of the details / quirks.&lt;/p&gt; &lt;p&gt;First up, "where do these HTML 5 data attributes come from?" I hear you cry.  Why from the &lt;a href="http://msdn.microsoft.com/en-us/library/system.componentmodel.dataannotations.validationattribute.aspx" target="_blank"&gt;Validation attributes that live in System.ComponentModel.DataAnnotations&lt;/a&gt;.&lt;/p&gt; &lt;p&gt;Let me illustrate.  This decoration:&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;  [Required(),&lt;br /&gt;   Range(0.01, Double.MaxValue, ErrorMessage = "A positive value is required for Price"),&lt;br /&gt;   Display(Name = "My Price")]&lt;br /&gt;  public double Price { get; set; }&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;specifies that the Price field on the model is required, that it requires a positive numeric value and that its official name is My Price.  As a result of this decoration, when you use syntax like this in your view:&lt;/p&gt; &lt;pre class="prettyprint xml"&gt;&lt;br /&gt;&lt;code class="language-xml"&gt;&lt;br /&gt;  @Html.LabelFor(x =&amp;gt; x.Price)&lt;br /&gt;  @Html.TextBoxFor(x =&amp;gt; x.Price, new { id = "itsMyPrice", type = "number" })&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;You end up with this HTML:&lt;/p&gt; &lt;pre class="prettyprint xml"&gt;&lt;br /&gt;&lt;code class="language-xml"&gt;&lt;br /&gt;  &lt;label for="Price"&gt;My Price&lt;/label&gt;&lt;br /&gt;  &lt;input data-val="true" data-val-number="The field My Price must be a number." data-val-range="A positive value is required for My Price" data-val-range-max="1.79769313486232E+308" data-val-range-min="0.01" data-val-required="The My Price field is required." id="itsMyPrice" name="Price" type="number" value="" /&gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;As you can see MVC has done the hard work of translating these data annotations into HTML 5 data attributes so you dont have to.  With this in place you can apply your validation in 1 place (the model) and 1 place only.  This reduces the code you need to write exponentially.  It also reduces duplication and therefore reduces the likelihood of mistakes.&lt;/p&gt; &lt;p&gt;To validate a form its as simple as this:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;  $("form").validate();&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Or if you wanted to validate a single element:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;  $("form").validate().element("elementSelector")&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Or if you wanted to prevent default form submission until validation was passed:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;  $("form").submit(function (event) {&lt;br /&gt;&lt;br /&gt;    var isValid = $(this).validate().valid();&lt;br /&gt;&lt;br /&gt;    return isValid; //True will allow submission, false will not&lt;br /&gt;        &lt;br /&gt;  });&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;See what I mean?  Simple!&lt;/p&gt; &lt;p&gt;If you want to read up on this further I recommend these links:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;a href="http://bassistance.de/jquery-plugins/jquery-plugin-validation/" target="_blank"&gt;The home of jQuery Validate&lt;/a&gt; - by the way it seems to be important to work with the latest version (1.9 at time of writing).  I found some strange AJAX issues when using 1.7...&lt;/li&gt;&lt;li&gt;&lt;a href="http://bradwilson.typepad.com/blog/2010/10/mvc3-unobtrusive-validation.html" target="_blank"&gt;Brad Wilson's walkthrough of unobtrusive client validation&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="http://www.devtrends.co.uk/blog/the-complete-guide-to-validation-in-asp.net-mvc-3-part-2" target="_blank"&gt;An example of how to implement your own custom validation both server side *and* client side&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="http://xhalent.wordpress.com/2011/01/24/applying-unobtrusive-validation-to-dynamic-content/" target="_blank"&gt;How to apply unobtrusive jQuery validation to dynamic content&lt;/a&gt; - handy if you're creating HTML on the client which you want to be validated.&lt;/li&gt;&lt;li&gt;And finally, a workaround for &lt;a href="http://aspnet.codeplex.com/workitem/7629" target="_blank"&gt;a bug in MVC 3&lt;/a&gt; which means that data attributes arent emitted when using DropDownListFor for nested objects: &lt;a href="http://forums.asp.net/t/1649193.aspx/1/10" target="_blank"&gt;http://forums.asp.net/t/1649193.aspx/1/10&lt;/a&gt;.  In fact because I've only seen this on a forum I've copied and the pasted the code there to below because I feared it being lost:&lt;br /&gt;&lt;strong&gt;Update: It turns out the self-same issue exists for TextAreaFor as well.  Details of this and a workaround can be found &lt;a href="http://aspnet.codeplex.com/workitem/8576" target="_blank"&gt;here&lt;/a&gt;... &lt;/strong&gt;&lt;/li&gt;&lt;/ul&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;    /// &amp;lt;summary&amp;gt;&lt;br /&gt;    /// MVC HtmlHelper extension methods - html element extensions&lt;br /&gt;    /// These are drop down list extensions that work round a bug in MVC 3: http://aspnet.codeplex.com/workitem/7629&lt;br /&gt;    /// These workarounds were taken from here: http://forums.asp.net/t/1649193.aspx/1/10&lt;br /&gt;    /// &amp;lt;/summary&amp;gt;&lt;br /&gt;    public static class DropDownListExtensions&lt;br /&gt;    {&lt;br /&gt;        [SuppressMessage("Microsoft.Design", "CA1006:DoNotNestGenericTypesInMemberSignatures", Justification = "This is an appropriate nesting of generic types")]&lt;br /&gt;        public static MvcHtmlString SelectListFor&amp;lt;TModel, TProperty&amp;gt;(this HtmlHelper&amp;lt;TModel&amp;gt; htmlHelper, Expression&amp;lt;Func&amp;lt;TModel, TProperty&amp;gt;&amp;gt; expression, IEnumerable&amp;lt;SelectListItem&amp;gt; selectList)&lt;br /&gt;        {&lt;br /&gt;            return SelectListFor(htmlHelper, expression, selectList, null /* optionLabel */, null /* htmlAttributes */);&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;        [SuppressMessage("Microsoft.Design", "CA1006:DoNotNestGenericTypesInMemberSignatures", Justification = "This is an appropriate nesting of generic types")]&lt;br /&gt;        public static MvcHtmlString SelectListFor&amp;lt;TModel, TProperty&amp;gt;(this HtmlHelper&amp;lt;TModel&amp;gt; htmlHelper, Expression&amp;lt;Func&amp;lt;TModel, TProperty&amp;gt;&amp;gt; expression, IEnumerable&amp;lt;SelectListItem&amp;gt; selectList, object htmlAttributes)&lt;br /&gt;        {&lt;br /&gt;            return SelectListFor(htmlHelper, expression, selectList, null /* optionLabel */, new RouteValueDictionary(htmlAttributes));&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;        [SuppressMessage("Microsoft.Design", "CA1006:DoNotNestGenericTypesInMemberSignatures", Justification = "This is an appropriate nesting of generic types")]&lt;br /&gt;        public static MvcHtmlString SelectListFor&amp;lt;TModel, TProperty&amp;gt;(this HtmlHelper&amp;lt;TModel&amp;gt; htmlHelper, Expression&amp;lt;Func&amp;lt;TModel, TProperty&amp;gt;&amp;gt; expression, IEnumerable&amp;lt;SelectListItem&amp;gt; selectList, IDictionary&amp;lt;string, object&amp;gt; htmlAttributes)&lt;br /&gt;        {&lt;br /&gt;            return SelectListFor(htmlHelper, expression, selectList, null /* optionLabel */, htmlAttributes);&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;        [SuppressMessage("Microsoft.Design", "CA1006:DoNotNestGenericTypesInMemberSignatures", Justification = "This is an appropriate nesting of generic types")]&lt;br /&gt;        public static MvcHtmlString SelectListFor&amp;lt;TModel, TProperty&amp;gt;(this HtmlHelper&amp;lt;TModel&amp;gt; htmlHelper, Expression&amp;lt;Func&amp;lt;TModel, TProperty&amp;gt;&amp;gt; expression, IEnumerable&amp;lt;SelectListItem&amp;gt; selectList, string optionLabel)&lt;br /&gt;        {&lt;br /&gt;            return SelectListFor(htmlHelper, expression, selectList, optionLabel, null /* htmlAttributes */);&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;        [SuppressMessage("Microsoft.Design", "CA1006:DoNotNestGenericTypesInMemberSignatures", Justification = "This is an appropriate nesting of generic types")]&lt;br /&gt;        public static MvcHtmlString SelectListFor&amp;lt;TModel, TProperty&amp;gt;(this HtmlHelper&amp;lt;TModel&amp;gt; htmlHelper, Expression&amp;lt;Func&amp;lt;TModel, TProperty&amp;gt;&amp;gt; expression, IEnumerable&amp;lt;SelectListItem&amp;gt; selectList, string optionLabel, object htmlAttributes)&lt;br /&gt;        {&lt;br /&gt;            return SelectListFor(htmlHelper, expression, selectList, optionLabel, new RouteValueDictionary(htmlAttributes));&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;        [SuppressMessage("Microsoft.Design", "CA1011:ConsiderPassingBaseTypesAsParameters", Justification = "Users cannot use anonymous methods with the LambdaExpression type")]&lt;br /&gt;        [SuppressMessage("Microsoft.Design", "CA1006:DoNotNestGenericTypesInMemberSignatures", Justification = "This is an appropriate nesting of generic types")]&lt;br /&gt;        public static MvcHtmlString SelectListFor&amp;lt;TModel, TProperty&amp;gt;(this HtmlHelper&amp;lt;TModel&amp;gt; htmlHelper, Expression&amp;lt;Func&amp;lt;TModel, TProperty&amp;gt;&amp;gt; expression, IEnumerable&amp;lt;SelectListItem&amp;gt; selectList, string optionLabel, IDictionary&amp;lt;string, object&amp;gt; htmlAttributes)&lt;br /&gt;        {&lt;br /&gt;            if (expression == null)&lt;br /&gt;            {&lt;br /&gt;                throw new ArgumentNullException("expression");&lt;br /&gt;            }&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;            ModelMetadata metadata = ModelMetadata.FromLambdaExpression(expression, htmlHelper.ViewData);&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;            IDictionary&amp;lt;string, object&amp;gt; validationAttributes = htmlHelper&lt;br /&gt;                .GetUnobtrusiveValidationAttributes(ExpressionHelper.GetExpressionText(expression), metadata);&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;            if (htmlAttributes == null)&lt;br /&gt;                htmlAttributes = validationAttributes;&lt;br /&gt;            else&lt;br /&gt;                htmlAttributes = htmlAttributes.Concat(validationAttributes).ToDictionary(k =&amp;gt; k.Key, v =&amp;gt; v.Value);&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;            return SelectExtensions.DropDownListFor(htmlHelper, expression, selectList, optionLabel, htmlAttributes);&lt;br /&gt;        }&lt;br /&gt;    }&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1078093664526233590'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1078093664526233590'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2012/08/jquery-unobtrusive-validation.html' title='jQuery Unobtrusive Validation (+ associated gotchas)'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3030449932014000717</id><published>2012-07-31T09:44:00.000+01:00</published><updated>2012-07-31T09:44:10.444+01:00</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Decimal Model Binder</title><content type='html'>&lt;code&gt;   /// &lt;summary&gt;  /// The default Model Binder which comes with MVC3 is unable to convert an integer to a decimal - hence this:   /// ModelBinders.Binders.Add(typeof(decimal), new DecimalModelBinder());   /// ModelBinders.Binders.Add(typeof(decimal?), new DecimalModelBinder());   /// http://stackoverflow.com/a/5538444/761388   /// &lt;/summary&gt;  public class DecimalModelBinder : DefaultModelBinder   {     public override object BindModel(ControllerContext controllerContext, ModelBindingContext bindingContext)     {       var valueProviderResult = bindingContext.ValueProvider.GetValue(bindingContext.ModelName);        decimal value;       return valueProviderResult == null || !Decimal.TryParse(valueProviderResult.AttemptedValue, out value) ? base.BindModel(controllerContext, bindingContext) : value;     }   }      protected void Application_Start(Object sender, EventArgs e)     {       //......        //Register CustomModelBinders       ModelBinders.Binders.Add(typeof(decimal), new DecimalModelBinder());       ModelBinders.Binders.Add(typeof(decimal?), new DecimalModelBinder());        //......     }  &lt;/code&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3030449932014000717'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3030449932014000717'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-7781959874498295</id><published>2012-07-22T13:55:00.001+01:00</published><updated>2012-07-22T13:55:45.095+01:00</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>What makes a jQuery AJAX error an error?</title><content type='html'>&lt;p&gt;I was working on an AJAX-heavy ASP.NET MVC 3 project recently.  Whenever doing AJAX I tend to use jQuery because the feature set is so rich.  Just recently I was thinking about making my AJAX error handling a little more generic and I realised I didn't really understand what jQuery thought an AJAX error was and wasn't.&lt;/p&gt; &lt;p&gt;Confused?  Don't worry.&lt;/p&gt; mention redirect?  MVC 3   Send back JsonResult within Controller.              Response.StatusCode = (int)HttpStatusCode.BadRequest;             return Json(new { Redirect = Url.Content("~/Home/About") });    {...}     Redirect: "/Home/About"          $.ajax("/Home/GeneratePDF", {             type: "POST",             contentType: "application/json",             data: JSON.stringify({ url: $("#Url").val() }),             success: function(data, textStatus, jqXHR){                  //document.location.href = data;                 $("#Results").append('&lt;li&gt;&lt;a target="_blank" href="' + data + '"&gt;' + $("#Url").val() + '&lt;/a&gt;&lt;/li&gt;');             },             error: function (jqXHR, textStatus, errorThrown) {                  JSON.parse(jqXHR.responseText);             }         });    http://stackoverflow.com/questions/11159016/what-responses-does-jquery-ajax-consider-to-be-success?rq=1   If the response is between 199 and 300 ( &gt;= 200 and &lt; 300 ) or equal to 304 and the responseText can be successfully converted to the dataType that you provide (text by default), it is considered a successful request.  For example, if you return JSON and you get a 200 response status but it fails, it is more than likely a JSON parser problem meaning your JSON is not valid.  If you are returning HTML or XML and it fails with a 200 response status, the responsetext couldn't be converted to HTML or XML respectively (commonly happens in IE with invalid html/xml)  I have a jQuery AJAX post request that is unexpectedly triggering the error callback instead of success. One random suspicion I have is the 302 status code it is receiving, although that may be wrong.  I looked at the documentation, but I feel like one thing is a bit unclear: What is jQuery's definition of a successful request?  secret source:  &lt;pre class="brush: js"&gt;&lt;br /&gt;&lt;br /&gt;// If successful, handle type chaining&lt;br /&gt;if ( status &gt;= 200 &amp;&amp; status &lt; 300 || status === 304 ) {&lt;br /&gt;&lt;br /&gt; // Set the If-Modified-Since and/or If-None-Match header, if in ifModified mode.&lt;br /&gt; if ( s.ifModified ) {&lt;br /&gt;&lt;br /&gt;  if ( ( lastModified = jqXHR.getResponseHeader( "Last-Modified" ) ) ) {&lt;br /&gt;   jQuery.lastModified[ ifModifiedKey ] = lastModified;&lt;br /&gt;  }&lt;br /&gt;  if ( ( etag = jqXHR.getResponseHeader( "Etag" ) ) ) {&lt;br /&gt;   jQuery.etag[ ifModifiedKey ] = etag;&lt;br /&gt;  }&lt;br /&gt; }&lt;br /&gt;&lt;br /&gt; // If not modified&lt;br /&gt; if ( status === 304 ) {&lt;br /&gt;&lt;br /&gt;  statusText = "notmodified";&lt;br /&gt;  isSuccess = true;&lt;br /&gt;&lt;br /&gt; // If we have data&lt;br /&gt; } else {&lt;br /&gt;&lt;br /&gt;  try {&lt;br /&gt;   success = ajaxConvert( s, response );&lt;br /&gt;   statusText = "success";&lt;br /&gt;   isSuccess = true;&lt;br /&gt;  } catch(e) {&lt;br /&gt;   // We have a parsererror&lt;br /&gt;   statusText = "parsererror";&lt;br /&gt;   error = e;&lt;br /&gt;  }&lt;br /&gt; }&lt;br /&gt;} else {&lt;br /&gt; // We extract error from statusText&lt;br /&gt; // then normalize statusText and status for non-aborts&lt;br /&gt; error = statusText;&lt;br /&gt; if ( !statusText || status ) {&lt;br /&gt;  statusText = "error";&lt;br /&gt;  if ( status &lt; 0 ) {&lt;br /&gt;   status = 0;&lt;br /&gt;  }&lt;br /&gt; }&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;&lt;/pre&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7781959874498295'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7781959874498295'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2251471589631226508</id><published>2012-07-19T12:54:00.000+01:00</published><updated>2012-07-19T12:54:03.051+01:00</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Repository and Unit of Work pattern with DbContext</title><content type='html'>I'm aware of the needless / bleeding abstraction issue  Frankly would rather mock DbContext and have done.  See no resources to help with this so using this approach for now.  Painful day trying a zillion different approaches.  Roughly speaking:  DbContext = Unit of Work DbSet = Repository  Based heavily on the sample code that came with K. Scott Allen's tutorial  http://www.pluralsight-training.net/microsoft/courses/TableOfContents?courseName=linq-architecture&amp;highlight=scott-allen_linq-layered!scott-allen_linq-beyondqueries  IRepository.cs (domain?)  using System; using System.Collections.Generic; using System.Linq; using System.Linq.Expressions;  namespace LNRCorporate.Common.Data {     /// &lt;summary&gt;    /// Author      : John Reilly     /// Description : Repository interface that declares the methods to be exposed by a repository     /// &lt;/summary&gt;    public interface IRepository&lt;T&gt;                      where T : class     {         IQueryable&lt;T&gt; FindAll();         IQueryable&lt;T&gt; FindWhere(Expression&lt;Func&lt;T, bool&gt;&gt; predicate);         void Add(T newEntity);         void Attach(T entity);         void Remove(T entity);     } }  IUnitOfWork.cs (domain?)   using System;  namespace LNRCorporate.Common.Data {     /// &lt;summary&gt;    /// Author      : John Reilly     /// Description : Unit of work interface that declares the methods to be exposed by a unit of work     /// &lt;/summary&gt;    public interface IUnitOfWork : IDisposable      {         void Commit();     } }  SqlRepository.cs  using System; using System.Collections.Generic; using System.Data.Entity; using System.Linq; using System.Linq.Expressions;  namespace LNRCorporate.Common.Data {     /// &lt;summary&gt;    /// Author      : John Reilly     /// Description : Implementation of the ISqlRepository interface - this class facilitates access to Entity Framework     /// &lt;/summary&gt;    public class SqlRepository&lt;T&gt; : IRepository&lt;T&gt;                                    where T : class     {         protected DbSet&lt;T&gt; _dbSet;         protected DbContext _dbContext;          public SqlRepository(DbContext context)         {             _dbContext = context;             _dbSet = context.Set&lt;T&gt;();         }          public IQueryable&lt;T&gt; FindAll()         {             return _dbSet;         }          public IQueryable&lt;T&gt; FindWhere(Expression&lt;Func&lt;T, bool&gt;&gt; predicate)         {             return _dbSet.Where(predicate);         }          public void Add(T newEntity)         {             _dbSet.Add(newEntity);         }          public void Attach(T newEntity)         {             _dbSet.Attach(newEntity);         }          public void Remove(T entity)         {             _dbSet.Remove(entity);         }     } }   SqlUnitOfWork.cs  using System; using System.Configuration; using System.Data.Entity;  namespace LNRCorporate.Common.Data {     /// &lt;summary&gt;    /// Author      : John Reilly     /// Description : Implementation of the IUnitOfWork interface - this class facilitates access to Entity Framework     /// &lt;/summary&gt;    public abstract class SqlUnitOfWork : IUnitOfWork     {         protected readonly DbContext _context;          public SqlUnitOfWork(DbContext context)          {             _context = context;         }          public void Commit()         {             _context.SaveChanges();         }          public void Dispose()         {             _context.Dispose();         }     } }  IRISClientControlRepository.cs  using System; using System.Collections.Generic; using System.Data.Entity; using System.Linq; using System.Linq.Expressions; using HatfieldPhilips.IRIS.Models.Domain; using LNRCorporate.Common.Data;  namespace HatfieldPhilips.IRIS.Models.Data {     /// &lt;summary&gt;    /// Author      : John Reilly     /// Description : Implementation of the IIRISClientControlRepository interface     /// &lt;/summary&gt;    public class IRISClientControlRepository : SqlRepository&lt;client_control&gt;, IIRISClientControlRepository     {         public IRISClientControlRepository(DbContext context) : base(context)         {         }          /// &lt;summary&gt;        /// Author      : John Reilly         /// Description : Query IRIS to client driven results query (so can be reused and have extra where clauses composed in)         /// &lt;/summary&gt;        /// &lt;returns&gt;&lt;/returns&gt;        public IQueryable&lt;ClientResult&gt; GetClientResultsForPeriod(DateTime dateTimeToJoinWith, int year, int quarter)         {             var clientResults = from c in _dbContext.Set&lt;client_control&gt;()                                 join l in _dbContext.Set&lt;loan_control&gt;() on c.loan_id equals l.loan_id                                 let waterfalls = from w in _dbContext.Set&lt;waterfall_control&gt;()                                                  where w.loan_id == c.loan_id &amp;&amp; c.year == year &amp;&amp; c.quarter == quarter &amp;&amp; (w.report_start_date &lt;= dateTimeToJoinWith &amp;&amp; w.report_end_date &gt;= dateTimeToJoinWith)                                                  select w                                 where c.year == year &amp;&amp; c.quarter == quarter                                 select new ClientResult                                 {                                     LenderID = c.lenderid,                                     LoanID = c.loan_id,                                     LoanNumber = l.loannumber,                                     CashManagerReportStatusCode = c.lookup.lookup_code,                                     CashManagerReportStatusDescription = c.lookup.lookup_name,                                     WaterfallsCount = waterfalls.Count(),                                     WaterfallsFinalisedCount = waterfalls.Count(w =&gt; w.finalised),                                     WaterfallsUnfinalised = waterfalls.Where(w =&gt; !w.finalised).Select(w =&gt; w.loan_control.loannumber)                                 };              return clientResults;         }          /// &lt;summary&gt;        /// Author      : John Reilly         /// Description : Query IRIS to client waterfalls for a given period         /// &lt;/summary&gt;        /// &lt;returns&gt;&lt;/returns&gt;        public IQueryable&lt;waterfall_control&gt; GetClientWaterfallsForPeriod(int lenderID, DateTime dateTimeToJoinWith, int year, int quarter)         {             return from c in _dbContext.Set&lt;client_control&gt;()                    join w in _dbContext.Set&lt;waterfall_control&gt;() on c.loan_id equals w.loan_id                    where c.lenderid == lenderID &amp;&amp; c.year == year &amp;&amp; c.quarter == quarter &amp;&amp;                          (w.report_start_date &lt;= dateTimeToJoinWith &amp;&amp; w.report_end_date &gt;= dateTimeToJoinWith)                    select w;         }          /// &lt;summary&gt;        /// Author      : John Reilly         /// Description : Lock a clients waterfall payments using the supplied waterfall payment ids         /// &lt;/summary&gt;        /// &lt;returns&gt;&lt;/returns&gt;        public void LockClientWaterfallPayments(int lenderID, int[] paymentIDs, int userID)         {             var waterfallPayments = _dbContext.Set&lt;waterfall_payments&gt;()                                               .Where(w =&gt; paymentIDs.Contains(w.waterfall_payments_id));              //Update the waterfalls             var stampedWaterfall = false;             foreach (var payment in waterfallPayments)             {                 if (!stampedWaterfall)                 {                     payment.waterfall_control.date_last_modified = DateTime.Now;                     payment.waterfall_control.user_last_modified = userID;                      stampedWaterfall = true;                 }                  payment.scheduled_amounts_locked = true;             }         }          /// &lt;summary&gt;        /// Author      : John Reilly         /// Description : Lock a clients waterfalls using the supplied waterfall ids         /// &lt;/summary&gt;        /// &lt;returns&gt;&lt;/returns&gt;        public void LockClientWaterfalls(int lenderID, int[] waterfallIDs, int userID)         {             LockUnlockClientWaterfallsAndPayments(waterfallIDs, userID, lockOrUnlock: true);         }          /// &lt;summary&gt;        /// Author      : John Reilly         /// Description : Unlock a clients waterfalls using the supplied waterfall ids         /// &lt;/summary&gt;        /// &lt;returns&gt;&lt;/returns&gt;        public void UnlockClientWaterfalls(int lenderID, int[] waterfallIDs, int userID)         {             LockUnlockClientWaterfallsAndPayments(waterfallIDs, userID, lockOrUnlock: false);         }          private void LockUnlockClientWaterfallsAndPayments(int[] waterfallIDs, int userID, bool lockOrUnlock)         {             var waterfalls = _dbContext.Set&lt;waterfall_control&gt;()                                        .Where(w =&gt; waterfallIDs.Contains(w.waterfall_id));              //Update the waterfalls             foreach (var waterfall in waterfalls)             {                 waterfall.waterfall_locked = lockOrUnlock;                 waterfall.date_last_modified = DateTime.Now;                 waterfall.user_last_modified = userID;                  //Cascade to payments                 foreach (var payment in waterfall.waterfall_payments)                 {                     payment.scheduled_amounts_locked = lockOrUnlock;                 }             }         }     } }  IRISUnitOfWork.cs  using System; using System.Configuration; using System.Data.Entity; using HatfieldPhilips.IRIS.Models.Domain; using LNRCorporate.Common.Data;  namespace HatfieldPhilips.IRIS.Models.Data {     /// &lt;summary&gt;    /// Author      : John Reilly     /// Description : Implementation of the IIRISUnitOfWork interface     /// &lt;/summary&gt;    public class IRISUnitOfWork : SqlUnitOfWork, IIRISUnitOfWork     {         IRISClientControlRepository _clientControls = null;         SqlRepository&lt;loan_control&gt; _loanControls = null;                  public IRISUnitOfWork()             : base(new IRISEntities())         {         }          public IIRISClientControlRepository ClientControls         {             get             {                 if (_clientControls == null) _clientControls = new IRISClientControlRepository(_context);                  return _clientControls;             }         }          public IRepository&lt;loan_control&gt; LoanControls         {             get             {                 if (_loanControls == null) _loanControls = new SqlRepository&lt;loan_control&gt;(_context);                  return _loanControls;             }         }      } }  IIRISClientControlRepository.cs  using System; using System.Collections.Generic; using System.Linq; using System.Linq.Expressions; using LNRCorporate.Common.Data;  namespace HatfieldPhilips.IRIS.Models.Domain {     /// &lt;summary&gt;    /// Author      : John Reilly     /// Description : Repository interface that declares the methods to be exposed by IRISClientControlRepository - this is a custom repository because it exposes custom methods     /// &lt;/summary&gt;    public interface IIRISClientControlRepository : IRepository&lt;client_control&gt;    {         IQueryable&lt;ClientResult&gt; GetClientResultsForPeriod(DateTime dateTimeToJoinWith, int year, int quarter);         IQueryable&lt;waterfall_control&gt; GetClientWaterfallsForPeriod(int lenderID, DateTime dateTimeToJoinWith, int year, int quarter);         void LockClientWaterfallPayments(int lenderID, int[] paymentIDs, int userID);         void LockClientWaterfalls(int lenderID, int[] waterfallIDs, int userID);         void UnlockClientWaterfalls(int lenderID, int[] waterfallIDs, int userID);     }      /// &lt;summary&gt;    /// Author      : John Reilly     /// Description : Class that allows GetClientResults to be re-used     /// &lt;/summary&gt;    public class ClientResult     {         public int LenderID { get; set; }         public int LoanID { get; set; }         public string LoanNumber { get; set; }         public string CashManagerReportStatusCode { get; set; }         public string CashManagerReportStatusDescription { get; set; }         public int WaterfallsCount { get; set; }         public int WaterfallsFinalisedCount { get; set; }         public IQueryable&lt;string&gt; WaterfallsUnfinalised { get; set; }     } }  IIRISUnitOfWork.cs  using System; using System.Collections.Generic; using System.Linq; using System.Text; using LNRCorporate.Common.Data;  namespace HatfieldPhilips.IRIS.Models.Domain {     /// &lt;summary&gt;    /// Author      : John Reilly     /// Description : Unit of work interface that declares the properties to be exposed by IRISUnitOfWork - will be expanded further when IRISRepository merges in     /// &lt;/summary&gt;    public interface IIRISUnitOfWork : IUnitOfWork     {         IIRISClientControlRepository ClientControls { get; }         IRepository&lt;loan_control&gt; LoanControls { get; }     } }     Hi Guys,  As Ive been working on the Client View of the Cash Management screen I noticed that the IRIS project was missing an implementation of the unit of work and repository patterns.  We have the IRISRepository class but in truth this a repository in name only (you can find a good description of the repository pattern here -  but essentially the take home should be that a repository should  act like an in-memory domain object collection).  To that end Ive implemented the unit of work  and repository patterns within IRIS.  As a basis I used the sample materials that came with K. Scott Allens Pluralsight course below:  http://www.pluralsight-training.net/microsoft/courses/TableOfContents?courseName=linq-architecture&amp;highlight=scott-allen_linq-layered!scott-allen_linq-beyondqueries  I would heartily recommend this course to you to watch anyway (particularly the second part) as its a very clear walk through of implementing LINQ with data access.  Its brilliant.  You will now see the following extra classes in the Common project: (because there is ample possibility to share and re-use these I think)  	IRepository - Repository interface that declares the methods to be exposed by a repository 	IUnitOfWork - Unit of work interface that declares the methods to be exposed by a unit of work 	SqlRepository - Implementation of the ISqlRepository interface - this class facilitates access to Entity Framework 	SqlUnitOfWork - Implementation of the IUnitOfWork interface - this class facilitates access to Entity Framework  Within the IRIS project itself I have implemented the following classes:  	IIRISUnitOfWork - Unit of work interface that declares the properties to be exposed by IRISUnitOfWork - will be expanded further when IRISRepository merges in 	IIRISClientControlRepository - Repository interface that declares the methods to be exposed by IRISClientControlRepository - this is a custom repository because it exposes custom methods 	IRISUnitOfWork - Implementation of the IIRISUnitOfWork interface 	IRISClientControlRepository - Implementation of the IIRISClientControlRepository interface  You can see that for each implementation class above there is an interface.  This is to facilitate testing.  If you look at the ClientListController class you will see the following interface member:          private readonly IIRISUnitOfWork _unitOfWork;  When the app is running this member will be a new-ed up IRISUnitOfWork class but in a testing situation this can be a mock object that satisfied the declared interface.  I havent implemented any tests for the Client View of the Cash Management screen as yet but I intend to.  At some point we need to switch over from using the IRISRepository class to the IRISUnitOfWork class.  Since most of this class concerns the CashWaterfallController I guess well look to do this sometime soon.  It should be a pretty minor job.  Im happy to take responsibility for it as long as the relevant classes are unlocked (hint Richard! ).  Any questions then let me know.  John    used this guidance when setting up AdventureWorks  http://www.sanderstechnology.com/2011/wcf-data-services-walkthrough-part-1-setup/10573/#.UAf0ZOHY9CY  When I tried to generate the Model, I received the following error message: Unable to generate the model because of the following exception: The table AdventureWorks2008R2.Production.Document was referenced by a relationship, but was not found.  To work around it, I unselected all the tables in the Production schema, and just added the remaining tables instead.    </content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2251471589631226508'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2251471589631226508'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4228871478163377511</id><published>2012-07-19T11:32:00.000+01:00</published><updated>2012-07-19T11:32:00.320+01:00</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Dependency Injection / Unit Tests / MOQ</title><content type='html'>From: John Reilly  Sent: 19 July 2012 11:31 To: Courtney Small; Richard Ekeopara; Daniel Adusei; Saurabh Joshi Cc: Aoun Shamsi Subject: Unit tests / dependancy injection / MOQ  Hi Guys,  Ive just written a first unit test for the Client List Cash Management View that Ive been working on.  Im not sure how up on unit testing / dependency injection etc you all are but I thought it might be worth sharing my implementation in case you find it helpful.  When it comes to dependency injection (literally passing the dependencies of your class into the class) there are many alternative approaches.  Im a big believer in keeping things simple and so Ive generally tended towards constructor dependency injection.  Put simply this generally means you have 2 constructors; the default constructor and a dependency injection constructor.   The DI constructor takes the dependencies as parameters and sets them internally within the class. The default constructor (which is used when running) simply news up the dependencies and passes them on to the DI constructor.  An example is always helpful so here is the relevant portion of ClientListController.cs  dependancies and constructors:          private readonly ConsolidateController _consolidateController;         private readonly IIRISUnitOfWork _unitOfWork;         private readonly DateHelper _dateHelper;          ...          /// &lt;summary&gt;        /// Author      : John Reilly         /// Description : This default constructor news up the dependancies and passes them into our other Dependancy Injection         ///               constructor.  Unit tests will *never* call the default constructor - only the DI constructor         /// &lt;/summary&gt;        public ClientListController()             : this(new IRISUnitOfWork(), new DateHelper(), new ConsolidateController())         {         }          /// &lt;summary&gt;        /// Author      : John Reilly         /// Description : Dependancy Injection constructor - this wires up dependancies whether they be real (when running)         ///               or fake / mock (when testing)         /// &lt;/summary&gt;        public ClientListController(IIRISUnitOfWork unitOfWork, DateHelper dateHelper, ConsolidateController consolidateController)         {             _consolidateController = consolidateController;             _unitOfWork = unitOfWork;             _dateHelper = dateHelper;              ...         }  Using this approach your unit tests will always call the dependency injection constructor.  To do this they need to pass in dummy dependencies.  These will be objects that share the same methods / properties as the actual real world dependencies.  There are a million different approaches to achieving this goal.  Some simple.  Some less so.  The most straightforward approach Ive encountered is using MOQ  I believe its the most popular also (with some reason).  Anyway, lets not digress.  Moq is useful because it allows simple creation of mock dependencies using either interfaces or full on classes with virtual members / methods.  Below you can see a test that revolves around the opening screen in the Client List Cash Management View  ClientListCashManagmentUC-04d.cs  a single test:      [TestClass]     public class ClientListCashManagmentUC_04d     {         private ClientListController _controller;         private Mock&lt;IIRISUnitOfWork&gt; _unitOfWork;         private Mock&lt;DateHelper&gt; _dateHelper;         //private Mock&lt;ConsolidateController&gt; _consolidateController; - CANNOT BE MOCKED AT PRESENT AS METHODS NOT VIRTUAL AND DOES NOT IMPLEMENT ANY INTERFACES         private ConsolidateController _consolidateController;          [TestInitialize]         public void Init()         {             _unitOfWork = new Mock&lt;IIRISUnitOfWork&gt;(); //We are mocking the interface             _dateHelper = new Mock&lt;DateHelper&gt;();      //We are mocking the object - possible because methods on it are virtual             _consolidateController = new ConsolidateController(); //Because this is unmockable at present we are newing up the actual object - not intended to keep like this in the long term              /* COMMENTED OUT UNTIL WE CAN MOCK THIS             _consolidateController.Setup(x =&gt; x.GetData(1, ""))                 .Returns("");             */              _controller = new ClientListController(_unitOfWork.Object, _dateHelper.Object, _consolidateController);             _controller.SetFakeControllerContext();         }          [TestMethod]         public void ClientListView_ShouldRenderDefaultView()         {             // ARRANGE             //_dateHelper.GetDateTimeFromYearAndQuarter method will always return 1st July 2012 when called             _dateHelper.Setup(d =&gt; d.GetDateTimeFromYearAndQuarter(It.IsAny&lt;int&gt;(), It.IsAny&lt;int&gt;()))                        .Returns(new DateTime(year: 2012, month: 7, day: 1));              //_unitOfWork.GetClientResultsForPeriod method will always return an IQueryable&lt;ClientResult&gt;            //behind which are 2 rows of data             _unitOfWork.Setup(c =&gt; c.client_control.GetClientResultsForPeriod(It.IsAny&lt;DateTime&gt;(), It.IsAny&lt;int&gt;(), It.IsAny&lt;int&gt;()))                        .Returns(new List&lt;ClientResult&gt;() {                             new ClientResult()                            {                                CashManagerReportStatusCode = "cash_mgr_rpt_approved",                                CashManagerReportStatusDescription = "Cash Manager Approved",                                LenderID = 6,                                LoanID = 1,                                LoanNumber = "112001-S",                                WaterfallsCount = 3,                                WaterfallsFinalisedCount = 0,                                WaterfallsUnfinalised = (new List&lt;string&gt; { "112001-S", "112001-S", "112001-S" }).AsQueryable()                            },                            new ClientResult()                            {                                CashManagerReportStatusCode = "cash_mgr_rpt_approved",                                CashManagerReportStatusDescription = "Cash Manager Approved",                                LenderID = 5,                                LoanID = 2,                                LoanNumber = "140002-S",                                WaterfallsCount = 0,                                WaterfallsFinalisedCount = 0,                                WaterfallsUnfinalised = (new List&lt;string&gt;()).AsQueryable()                            }                        }.AsQueryable());             // ACT             var result = _controller.ClientListView((int)ScreenMode.CashManagementClientView);              // ASSERT             Assert.IsInstanceOfType(result, typeof(ViewResult), "It's not a ViewResult");             Assert.AreEqual((int)ScreenMode.CashManagementClientView, (int)_controller.ViewBag.ScreenMode, "ViewBag.ScreenMode has not been set");             Assert.IsInstanceOfType(result.Model, typeof(ClientListViewModel[]), "The model is not an array of ClientListViewModels");             Assert.AreEqual(2, ((ClientListViewModel[])result.Model).Length, "Invalid number of items in our ClientListViewModel array");              //Test the first item in our array             var item = ((ClientListViewModel[])result.Model)[0];             Assert.AreEqual("tri_state_completed", item.CashManagerReportStatusClass);             Assert.AreEqual("Cash Manager Approved", item.CashManagerReportStatusDescription);             Assert.AreEqual(null, item.CashManagerReportURL);             Assert.AreEqual("EPIC-RBS", item.ClientName);             Assert.AreEqual("Courtney Small", item.DealManager);             Assert.AreEqual(6, item.LenderID);             Assert.AreEqual("0 out of 3", item.WaterfallStatus);             Assert.AreEqual(3, item.WaterfallsUnfinalisedLoanNumbersAndNames.Length);             Assert.AreEqual("112001-S CASPAR", item.WaterfallsUnfinalisedLoanNumbersAndNames[0]);             Assert.AreEqual("112001-S CASPAR", item.WaterfallsUnfinalisedLoanNumbersAndNames[1]);             Assert.AreEqual("112001-S CASPAR", item.WaterfallsUnfinalisedLoanNumbersAndNames[2]);              //Test the second item in our array             item = ((ClientListViewModel[])result.Model)[1];             Assert.AreEqual("tri_state_completed", item.CashManagerReportStatusClass);             Assert.AreEqual("Cash Manager Approved", item.CashManagerReportStatusDescription);             Assert.AreEqual(null, item.CashManagerReportURL);             Assert.AreEqual("IXIS", item.ClientName);             Assert.AreEqual("Courtney Small", item.DealManager);             Assert.AreEqual(5, item.LenderID);             Assert.AreEqual("0 out of 0", item.WaterfallStatus);             Assert.AreEqual(0, item.WaterfallsUnfinalisedLoanNumbersAndNames.Length);         }    }  As you can see from the above [TestInitialize]Init method the dependencies are wired up using mock objects.  The _unitOfWork is based is mocked based on an interface.  The _dateHelper is based on an object.    These mock objects allow us to decide up front what we want to return from various methods / properties.  See the simple _dateHelper example below:              //_dateHelper.GetDateTimeFromYearAndQuarter method will always return 1st July 2012 when called             _dateHelper.Setup(d =&gt; d.GetDateTimeFromYearAndQuarter(It.IsAny&lt;int&gt;(), It.IsAny&lt;int&gt;()))                        .Returns(new DateTime(year: 2012, month: 7, day: 1));  This is ensuring that a DateTime with the value 1st July 2012 is always returned whenever the GetDateTimeFromYearAndQuarter method is called.  Simple!  The _unitOfWork setup is doing exactly the same thing but just returning a more detailed object.  When our tests run and these dependencies are called they will return the values that have been set up as above.  If you looked closely at the tests you can see that at present we are using the actual consolidator within our tests.  This is not good as it means we are actually hitting the consolidator each time we run our tests (and strictly speaking it means that this is *not* a unit test).  The reason for this is that the Consolidator is not mockable at the moment because it doesnt implement any interfaces and doesnt have any virtual members.  It could easily be made mockable by changing this:          public string GetData(int applicationId, string fieldsRequired)  To this:          public virtual string GetData(int applicationId, string fieldsRequired)  Or we could implement an interface; either works.  @Courtney  Are you happy for me to make this change?  We will then be able to mock the consolidator and turn our nearly unit test into an actual unit test  Hope you guys found this a useful email  feel free to ask me questions.  Im happy to help.  Cheers, John</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4228871478163377511'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4228871478163377511'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6481191744859790339</id><published>2012-07-19T09:17:00.001+01:00</published><updated>2012-07-19T09:17:26.014+01:00</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Example of implementing unit tests for a controller</title><content type='html'>using Commerzbank.PCS.Data.Access.Interfaces; using Commerzbank.PCS.Data.Models; using Commerzbank.PCS.Test.Helpers; using Commerzbank.PCS.Web.PCSZCM.Controllers; using Commerzbank.PCS.Web.PCSZCM.ViewModels.Deal; using Commerzbank.PCS.Web.PCSZCM; using Commerzbank.PCS.Web.Shared; using Microsoft.VisualStudio.TestTools.UnitTesting; using Moq; using System; using System.Collections.Generic; using System.Linq; using System.Web.Script.Serialization; using System.Web.Mvc; using System.Web.Routing;  namespace Commerzbank.PCS.PCSWeb.Test {   //[Links]   //http://www.asp.net/mvc/tutorials/iteration-5-create-unit-tests-cs   //http://www.asp.net/mvc/tutorials/creating-unit-tests-for-asp-net-mvc-applications-cs   //http://stackoverflow.com/questions/2416362/mock-static-property-with-moq   //http://www.heartysoft.com/ASPNET-MVC-Unit-Testing-JsonResult-Returning-Anonymous-Types    /// &lt;summary&gt;  /// Deal controller tests   /// &lt;/summary&gt;  [TestClass]   public class DealControllerTests   {     private const string _email = "DontSendEmail@Commerzbank.com";      private Mock&lt;SharedLibWrapper&gt; _sharedLib;     private Mock&lt;WebLoggerWrapper&gt; _webLogger;     private Mock&lt;GlobalSettingsWrapper&gt; _globalSettings;     private Mock&lt;GlobalSettingsSectionHandlerWrapper&gt; _globalSettingsSectionHandler;     private Mock&lt;DataCacheWrapper&gt; _dataCache;     private Mock&lt;PDFGenerator&gt; _pdfGenerator;      private Mock&lt;IDealDb&gt; _dealDb;     private Mock&lt;IMaskDb&gt; _maskDb;     private Mock&lt;INodeDb&gt; _nodeDb;     private Mock&lt;ICompanyDb&gt; _companyDb;     private Mock&lt;IUserDb&gt; _userDb;     private Mock&lt;ISalesTeamDb&gt; _salesTeamDb;     private Mock&lt;IProductSubTypeDb&gt; _productSubTypeDb;     private DealController _controller;      [TestInitialize]     public void TestInitialize()     {       _sharedLib = new Mock&lt;SharedLibWrapper&gt;();        _webLogger = new Mock&lt;WebLoggerWrapper&gt;();       _webLogger.Setup(x =&gt; x.MvcLogException(It.IsAny&lt;Exception&gt;(), null, null));        _globalSettings = new Mock&lt;GlobalSettingsWrapper&gt;();       _globalSettingsSectionHandler = new Mock&lt;GlobalSettingsSectionHandlerWrapper&gt;();       _dataCache = new Mock&lt;DataCacheWrapper&gt;();       _pdfGenerator = new Mock&lt;PDFGenerator&gt;();        _dealDb = new Mock&lt;IDealDb&gt;();       _maskDb = new Mock&lt;IMaskDb&gt;();       _nodeDb = new Mock&lt;INodeDb&gt;();       _companyDb = new Mock&lt;ICompanyDb&gt;();       _userDb = new Mock&lt;IUserDb&gt;();       _salesTeamDb = new Mock&lt;ISalesTeamDb&gt;();       _productSubTypeDb = new Mock&lt;IProductSubTypeDb&gt;();        _controller = new DealController(         sharedLib: _sharedLib.Object,          webLogger: _webLogger.Object,         globalSettings: _globalSettings.Object,         globalSettingsSectionHandler: _globalSettingsSectionHandler.Object,         dataCache: _dataCache.Object,         pdfGenerator: _pdfGenerator.Object,         dac: null,          dealDb: _dealDb.Object,         maskDb: _maskDb.Object,         nodeDb: _nodeDb.Object,         companyDb: _companyDb.Object,         userDb: _userDb.Object,         salesTeamDb: _salesTeamDb.Object,         productSubTypeDb: _productSubTypeDb.Object         );       _controller.SetFakeControllerContext();     }      [TestCleanup]     public void TestCleanup()     {       //Nothing to clean up at present; possibly if some actual resources were being used     }      [TestMethod]     public void Ensure_users_without_an_edit_permission_cannot_create_a_new_Deal()     {       //Arrange       _sharedLib.SetupGet(x =&gt; x.HasAnEditPermission)         .Returns(false);        //Act       var result = _controller.New(1); //Just checking outright rejection - you could pass any number to New really        //Assert       Assert.IsInstanceOfType(result, typeof(RedirectResult));       Assert.AreEqual("~/Contents/Error.aspx?sMessage=You+do+not+have+the+required+permissions+to+create+a+new+Deal.++Please+contact+PCS+Admin.", ((RedirectResult)result).Url);     }      [TestMethod]     public void Ensure_attempting_to_create_a_Deal_for_a_non_existent_ProductSubType_is_handled_correctly()     {       //Arrange       _sharedLib.SetupGet(x =&gt; x.HasAnEditPermission)         .Returns(true);       _productSubTypeDb.Setup(x =&gt; x.GetProductSubType(It.IsAny&lt;int&gt;()))         .Returns&lt;ProductSubType&gt;(null);        //Act       var result = _controller.New(-1);        //Assert       Assert.IsInstanceOfType(result, typeof(RedirectResult));       Assert.AreEqual("~/Contents/Error.aspx?sMessage=Unable+to+look+up+a+ProductSubType+with+an+id+of+-1.++Please+contact+PCS+Admin.", ((RedirectResult)result).Url);     }      [TestMethod]     public void Ensure_attempting_to_create_a_Deal_for_a_ProductSubType_with_an_unknown_mask_is_handled_correctly()     {       //Arrange       _sharedLib.SetupGet(x =&gt; x.HasAnEditPermission)         .Returns(true);       _productSubTypeDb.Setup(x =&gt; x.GetProductSubType(It.IsAny&lt;int&gt;()))         .Returns(new ProductSubType         {           Mask = "Doesn't exist",           MaskId = -1         });        //Act       var result = _controller.New(-1);        //Assert       Assert.IsInstanceOfType(result, typeof(RedirectResult));       Assert.AreEqual("~/Contents/Error.aspx?sMessage=MaskId%3a+-1+is+unknown.+Please+contact+PCS+Admin.", ((RedirectResult)result).Url);     }      [TestMethod]     public void Allow_access_new_Bond_view_as_ZCMAdmin()     {       var productSubTypeId = 203;        NewBondSetup(productSubTypeId);       ZCMAdminSetup();        //Act       var result = _controller.New(productSubTypeId);        //Assert       Assert.IsInstanceOfType(result, typeof(ViewResult));       Assert.AreEqual("DetailsBond", ((ViewResult)result).ViewName);       Assert.IsInstanceOfType(((ViewResult)result).Model, typeof(DetailsBond));        //Check that the correct enabled properties are available       var detailsBond = (DetailsBond)((ViewResult)result).Model;       Assert.AreEqual(18, detailsBond.EnabledProperties.Count);        CheckDealDetailsBaseEnabledPropertiesInNewEditCopyPartialEditModes(detailsBond);       CheckDealDetailsBondBaseEnabledPropertiesInNewEditCopyPartialEditModes(detailsBond);       CheckDealDetailsBaseEnabledPropertiesInNewEditCopyModes(detailsBond);       Assert.IsTrue(detailsBond.EnabledProperties.Contains("TradingStatus"));       Assert.IsTrue(detailsBond.EnabledProperties.Contains("DealTags"));       PerformNewDealDetailsViewModelBondAsserts(detailsBond);     }      [TestMethod]     public void Allow_access_new_Bond_view_as_ZCMSales()     {       var productSubTypeId = 203;        NewBondSetup(productSubTypeId);       ZCMSalesSetup();        //Act       var result = _controller.New(productSubTypeId);        //Assert       Assert.IsInstanceOfType(result, typeof(ViewResult));       Assert.AreEqual("DetailsBond", ((ViewResult)result).ViewName);       Assert.IsInstanceOfType(((ViewResult)result).Model, typeof(DetailsBond));        //Check that the correct enabled properties are available       var detailsBond = (DetailsBond)((ViewResult)result).Model;       Assert.AreEqual(16, detailsBond.EnabledProperties.Count);        CheckDealDetailsBaseEnabledPropertiesInNewEditCopyPartialEditModes(detailsBond);       CheckDealDetailsBondBaseEnabledPropertiesInNewEditCopyPartialEditModes(detailsBond);       CheckDealDetailsBaseEnabledPropertiesInNewEditCopyModes(detailsBond);       PerformNewDealDetailsViewModelBondAsserts(detailsBond);     }      [TestMethod]     public void Call_PrintToPDF_successfully()     {       var dealId = 21461825;       var url = "a url";        //Arrange       _sharedLib.SetupGet(x =&gt; x.FullUserName)         .Returns("ztb\\ga2rely");       _sharedLib.SetupGet(x =&gt; x.CurrentCulture)         .Returns(new System.Globalization.CultureInfo("en-GB"));       _pdfGenerator.Setup(x =&gt; x.GetHtmlToPdfUrl(It.IsAny&lt;string&gt;(), It.IsAny&lt;string&gt;(), null, false, null, null))         .Returns(url);       ZCMSalesSetup();        //Act       var result = _controller.PrintToPDF(dealId);        //Assert       Assert.IsInstanceOfType(result, typeof(RedirectResult));       Assert.AreEqual(url, ((RedirectResult)result).Url);     }      [TestMethod]     public void Call_Print_and_handle_when_deal_does_not_exist_successfully()     {       var dealId = 21461825;        //Arrange       _dealDb.Setup(x =&gt; x.GetDeal(It.IsAny&lt;int&gt;(), null, null, null, null))         .Returns&lt;Deal&gt;(null);       _maskDb.Setup(x =&gt; x.GetMaskByDeal(It.IsAny&lt;int&gt;()))         .Returns&lt;Mask&gt;(null);       ZCMSalesSetup();        //Act       var result = _controller.Print(dealId);        //Assert       Assert.IsInstanceOfType(result, typeof(RedirectResult));       Assert.AreEqual("~/Contents/Error.aspx?sMessage=The+Deal+has+been+deleted+by+another+user+and+%2f+or+it%27s+mask+does+not+exist.+Please+contact+PCS+Admin.", ((RedirectResult)result).Url);     }      [TestMethod]     public void Call_Print_and_handle_when_deals_mask_does_not_exist_successfully()     {       var dealId = 21461825;        //Arrange       _dealDb.Setup(x =&gt; x.GetDeal(It.IsAny&lt;int&gt;(), null, null, null, null))         .Returns(MakeDealDetailsBondViewModel(ScreenMode.View).ToDeal());       _maskDb.Setup(x =&gt; x.GetMaskByDeal(It.IsAny&lt;int&gt;()))         .Returns(new Mask { MaskId = 999 }); //An invalid mask       ZCMSalesSetup();        //Act       var result = _controller.Print(dealId);        //Assert       Assert.IsInstanceOfType(result, typeof(RedirectResult));       Assert.AreEqual("~/Contents/Error.aspx?sMessage=MaskId%3a+999+is+unknown.+Please+contact+PCS+Admin.", ((RedirectResult)result).Url);     }      [TestMethod]     public void Call_PrintBond_successfully()     {       var dealId = 21461825;       var mode = ScreenMode.View;       var deal = MakeDealDetailsBondViewModel(mode).ToDeal();        //Arrange       _dealDb.Setup(x =&gt; x.GetDeal(It.IsAny&lt;int&gt;(), null, null, null, null))         .Returns(deal);       _maskDb.Setup(x =&gt; x.GetMaskByDeal(It.IsAny&lt;int&gt;()))         .Returns(new Mask { MaskId = (int)MaskConst.Govie });       ZCMSalesSetup();        //Act       var result = _controller.Print(dealId);        //Assert       Assert.IsInstanceOfType(result, typeof(ViewResult));       Assert.IsInstanceOfType(((ViewResult)result).Model, typeof(DetailsBond));       Assert.AreEqual("PrintDetailsBond", ((ViewResult)result).ViewName);       PerformExistingDealDetailsViewModelBondAsserts((DetailsBond)((ViewResult)result).Model, mode);     }      [TestMethod]     public void DealDetailsBondViewModel_can_be_successfully_deserialised_from_JSON()     {       Commerzbank.PCS.Web.PCSZCM.ViewModels.Deal.DetailsBond dealDetailsBondViewModel = null;        try       {         dealDetailsBondViewModel = MakeDealDetailsBondViewModel(ScreenMode.View);       }       catch (Exception) { /* Just consume */ }        //Check deserialisation was successful       Assert.AreNotEqual(null, dealDetailsBondViewModel, "Problem deserialising JSON to Deal.DetailsBond - if the model has changed you probably want to amend the associated script file that passes this JSON also");        //Test that the deal view model looks like you would expect       PerformExistingDealDetailsViewModelBondAsserts(dealDetailsBondViewModel, ScreenMode.View);     }      [TestMethod]     public void DealDetailsBondViewModel_can_be_successfully_mapped_to_Deal()     {       Deal deal = null;       var mode = ScreenMode.New;       var dealDetailsBondViewModel = MakeDealDetailsBondViewModel(mode);        try       {         deal = dealDetailsBondViewModel.ToDeal();       }       catch (Exception) { /* Just consume */ }        //Check deserialisation was successful       Assert.AreNotEqual(null, deal, "Problem mapping Deal.DetailsBond to Deal");        //Test that the deal looks like you would expect       Assert.AreEqual(new DateTime(2013, 3, 2), deal.MaturityDate);       Assert.AreEqual(new DateTime(2006, 8, 3), deal.SettlementDate);        PerformExistingDealBondBaseAsserts(deal);       PerformExistingDealBaseAsserts(deal);     }      [TestMethod]     public void Add_DealDetailsBondViewModel_as_ZCMSales_and_return_new_DealDetailsBondViewModel_once_added_successfully()     {       ZCMSalesSetup();        Add_DealDetailsBondViewModel_and_return_new_DealDetailsBondViewModel_once_added_successfully();     }      [TestMethod]     public void Add_DealDetailsBondViewModel_as_ZCMAdmin_and_return_new_DealDetailsBondViewModel_once_added_successfully()     {       ZCMAdminSetup();        Add_DealDetailsBondViewModel_and_return_new_DealDetailsBondViewModel_once_added_successfully();     }      #region Tests of lesser importance that have not yet been written but should be when time allows      [TestMethod]     public void Ensure_that_DetermineCachedDefaults_extracts_the_correct_information()     {     }      [TestMethod]     public void Ensure_that_users_cannot_create_Deals_for_ProductSubTypes_that_do_not_exist()     {     }      #endregion      #region Private      /// &lt;summary&gt;    /// Check EnabledProperties for Deal.DetailsBase common fields that should be accessible in New/Edit/Copy/PartialEdit modes     /// &lt;/summary&gt;    /// &lt;param name="detailsBase"&gt;&lt;/param&gt;    private static void CheckDealDetailsBaseEnabledPropertiesInNewEditCopyPartialEditModes(DetailsBase detailsBase)     {       Assert.IsTrue(detailsBase.EnabledProperties.Contains("SalesList"));       Assert.IsTrue(detailsBase.EnabledProperties.Contains("Company"));       Assert.IsTrue(detailsBase.EnabledProperties.Contains("Price"));       Assert.IsTrue(detailsBase.EnabledProperties.Contains("Comments"));     }      /// &lt;summary&gt;    /// Check EnabledProperties for Deal.DetailsBondBase common fields that should be accessible in New/Edit/Copy/PartialEdit modes     /// &lt;/summary&gt;    /// &lt;param name="detailsBase"&gt;&lt;/param&gt;    private static void CheckDealDetailsBondBaseEnabledPropertiesInNewEditCopyPartialEditModes(DetailsBondBase detailsBase)     {       Assert.IsTrue(detailsBase.EnabledProperties.Contains("ProductCodeType"));       Assert.IsTrue(detailsBase.EnabledProperties.Contains("ProductRef"));       Assert.IsTrue(detailsBase.EnabledProperties.Contains("ProductName"));     }      /// &lt;summary&gt;    /// Check EnabledProperties for Deal.DetailsBondBase common fields that should be accessible in New/Edit/Copy modes; crucially not PartialEdit     /// &lt;/summary&gt;    /// &lt;param name="detailsBase"&gt;&lt;/param&gt;    private static void CheckDealDetailsBaseEnabledPropertiesInNewEditCopyModes(DetailsBase detailsBase)     {       Assert.IsTrue(detailsBase.EnabledProperties.Contains("SalesStatus"));       Assert.IsTrue(detailsBase.EnabledProperties.Contains("SalesReason"));       Assert.IsTrue(detailsBase.EnabledProperties.Contains("Side"));       Assert.IsTrue(detailsBase.EnabledProperties.Contains("TradeDate"));       Assert.IsTrue(detailsBase.EnabledProperties.Contains("ProductType"));       Assert.IsTrue(detailsBase.EnabledProperties.Contains("ProductSubType"));       Assert.IsTrue(detailsBase.EnabledProperties.Contains("Structurer"));       Assert.IsTrue(detailsBase.EnabledProperties.Contains("Trader"));       Assert.IsTrue(detailsBase.EnabledProperties.Contains("FrontOfficeBook"));     }      /// &lt;summary&gt;    /// Common method for testing the adding of Bonds - can be called with different setups to spoof different types of user     /// &lt;/summary&gt;    private void Add_DealDetailsBondViewModel_and_return_new_DealDetailsBondViewModel_once_added_successfully()     {       var mode = ScreenMode.New;        //Create a Deal.DetailsBond viewmodel which we will pass to the controller and expect to receive back from the controller       var dealDetailsBondViewModel = MakeDealDetailsBondViewModel(mode);        //Map to deal       var deal = dealDetailsBondViewModel.ToDeal();        //Arrange       _dealDb.Setup(x =&gt; x.GetDeal(It.IsAny&lt;int&gt;(), null, null, null, null))         .Returns(deal);       _dealDb.Setup(x =&gt; x.AddDeal(It.IsAny&lt;int&gt;(), It.IsAny&lt;Deal&gt;()))         .Returns(21461825);       _companyDb.Setup(x =&gt; x.GetCompany(It.IsAny&lt;int&gt;(), null, null, null, null, null))         .Returns(new Company { CompanyType = Convert.ToString(CompanyTypeConst.LegalEntity), CompanyTypeId = (int)CompanyTypeConst.LegalEntity, Name = "Dummy Company" });       _userDb.Setup(x =&gt; x.GetUser(It.IsAny&lt;int&gt;(), null, null, null))         .Returns(new User { Email = _email });       _globalSettingsSectionHandler.SetupGet(x =&gt; x.LegalEntityEmailFrom)         .Returns(_email);       _globalSettingsSectionHandler.SetupGet(x =&gt; x.LegalEntityEmailCc)         .Returns(_email);       _globalSettingsSectionHandler.SetupGet(x =&gt; x.LegalEntityEmailSubject)         .Returns("Subject");       _globalSettingsSectionHandler.SetupGet(x =&gt; x.LegalEntityEmailBody)         .Returns("Body");        //Act       var result = _controller.AddDealBond(dealDetailsBondViewModel);        //Assert       Assert.AreEqual((int)System.Net.HttpStatusCode.OK, _controller.Response.StatusCode, "Add failed in controller");       Assert.IsInstanceOfType(result.Data, typeof(DetailsBond));       PerformExistingDealDetailsViewModelBondAsserts(dealDetailsBondViewModel, mode);     }      /// &lt;summary&gt;    /// Setup for ZCM Sales     /// &lt;/summary&gt;    private void ZCMSalesSetup()     {       _sharedLib.SetupGet(x =&gt; x.RoleId)         .Returns((int)RoleConst.ZCMSales);       _sharedLib.SetupGet(x =&gt; x.UserId)         .Returns(235);       _sharedLib.SetupGet(x =&gt; x.FriendlyUserName)         .Returns("Liz Rey");       _dataCache.Setup(x =&gt; x.GetPermissions(It.IsAny&lt;int&gt;()))         .Returns(new Dictionary&lt;string, Permission&gt; //Permissions aren't actually created at present because not necessary         {           { "PCS/DealListCompleted", new Permission() },           { "PCS/Deal", new Permission() },           { "PCS/MISReportList", new Permission() },           { "PCS/AdhocSalesTeamReport", new Permission() },           { "PCS/Upload", new Permission() }         });     }      /// &lt;summary&gt;    /// Setup for ZCM Admin     /// &lt;/summary&gt;    private void ZCMAdminSetup()     {       _sharedLib.SetupGet(x =&gt; x.RoleId)         .Returns((int)RoleConst.ZCMAdmin);       _sharedLib.SetupGet(x =&gt; x.UserId)         .Returns(2330);       _sharedLib.SetupGet(x =&gt; x.FriendlyUserName)         .Returns("Georg Faerber");       _dataCache.Setup(x =&gt; x.GetPermissions(It.IsAny&lt;int&gt;()))         .Returns(new Dictionary&lt;string, Permission&gt; //Permissions aren't actually created at present because not necessary         {           { "PCS/Deal/TradingStatus", new Permission() },           { "PCS/DealListCompleted", new Permission() },           { "PCS/DealListSignOff ", new Permission() },           { "PCS/Deal", new Permission() },           { "PCS/MISReportList", new Permission() },           { "PCS/AdhocSalesTeamReport", new Permission() },           { "PCS/Upload", new Permission() },           { "PCS/DealCount", new Permission() },           { "PCS/Budget", new Permission() },         });     }      /// &lt;summary&gt;    /// Common new Bond setup     /// &lt;/summary&gt;    /// &lt;param name="productSubTypeId"&gt;&lt;/param&gt;    private void NewBondSetup(int productSubTypeId)     {       //Arrange       _globalSettingsSectionHandler.SetupGet(x =&gt; x.DealDefaultSide)         .Returns(SideConst.SellReceive);       _sharedLib.SetupGet(x =&gt; x.HasAnEditPermission)         .Returns(true);       _sharedLib.Setup(x =&gt; x.GetResourceString("CAPTION_NEW"))         .Returns("New");       _productSubTypeDb.Setup(x =&gt; x.GetProductSubType(It.IsAny&lt;int&gt;()))         .Returns(new ProductSubType         {           ProductSubTypeId = productSubTypeId,           Name = "Swap Euro Eurib 0-4",           ProductTypeId = 101,           ProductType = "Swaps",           MaskId = (int)MaskConst.Govie         });     }      /// &lt;summary&gt;    /// Make a Deal.DetailsBond     /// &lt;/summary&gt;    /// &lt;param name="detailsBond"&gt;&lt;/param&gt;    /// &lt;param name="isUpdate"&gt;&lt;/param&gt;    /// &lt;returns&gt;&lt;/returns&gt;    private static Commerzbank.PCS.Web.PCSZCM.ViewModels.Deal.DetailsBond MakeDealDetailsBondViewModel(ScreenMode mode)     {       var dealDictionary = MakeDealDetailsBondDictionary(mode);        //Construct JSON from dictionary       var json = ConstructJSONFromDealDictionary(dealDictionary);        var detailsBond = new JavaScriptSerializer()         .Deserialize&lt;Commerzbank.PCS.Web.PCSZCM.ViewModels.Deal.DetailsBond&gt;(json);        return detailsBond;     }      /// &lt;summary&gt;    /// Make a dictionary that represents a Deal.DetailsBond     /// &lt;/summary&gt;    /// &lt;returns&gt;&lt;/returns&gt;    private static Dictionary&lt;string, string&gt; MakeDealDetailsBondDictionary(ScreenMode mode)     {       var dealDictionary = MakeDealDetailsBaseDictionary(MaskConst.Govie, mode);        //Enrich dictionary with properties common to bond based deals       AddDealDetailsBondBaseViewModelPropertiesToDictionary(dealDictionary);        //Enrich dictionary with properties specific to bonds       dealDictionary.Add("MaturityDate", "\"2013-03-02\"");       dealDictionary.Add("SettlementDate", "\"2006-08-03\"");        return dealDictionary;     }      /// &lt;summary&gt;    /// Use a string, string dictionary for building up something that will be converted to JSON     /// - (this should make finicky errors related to ":" and "," placement less likely and will allow us to re-use common bits of JSON between tests for the different types of Deal)     /// &lt;/summary&gt;    /// &lt;param name="dealMask"&gt;&lt;/param&gt;    /// &lt;returns&gt;&lt;/returns&gt;    private static Dictionary&lt;string, string&gt; MakeDealDetailsBaseDictionary(MaskConst dealMask, ScreenMode mode)     {       //At the moment normalised properties (ie properties from other tables eg DealStatus, SalesStatus, ProductType etc) are being populated.         //They don't need to be and may end up coming out to simplify the code       var dealDictionary = new Dictionary&lt;string, string&gt;        {           { "Mode", Convert.ToString((int)mode) },           { "MaskId", Convert.ToString((int)dealMask) },           { "DealId", "21461825" },           { "SalesList", //A JSON representation of a SalesList with a single entry             "[{"+             "\"Priority\":1," +              "\"SalesId\":202," +              "\"SalesFirstName\":\"Juergen\"," +              "\"SalesLastName\":\"Meighoerner\"," +              "\"SalesTeamId\":801," +              "\"SalesTeamName\":\"_CM FICS R&amp;C Rates FFT\"," +              "\"Percentage\":100" +              "}]" },           { "TraderList", //A JSON representation of a TraderList with a single entry             "[{"+             "\"Priority\":1," +              "\"TraderId\":736," +              "\"TraderFirstName\":\"Mike\"," +              "\"TraderLastName\":\"Dobson\"," +              "\"FrontOfficeBookId\":3052," +              "\"FrontOfficeBook\":\"MMSWEURSH\"" +              "}]" },           { "TagList", //A JSON representation of a TagList with a single entry             "[{"+             "\"DealTagTypeId\":9," +              "\"DealTagType\":\"BrokerId\"," +              "\"DealTagValue\":\"BOWMANP\"," +              "\"DealTagFormatId\":2" +              "}]" },           { "SourceSystemRefList", //A JSON representation of a SourceSystemRefList with a single entry             "[{"+             "\"Priority\":1," +              "\"DealTypeId\":\"" + Convert.ToString((int)DealTypeConst.Standalone) + "\"," +              "\"SourceSystemId\":" + Convert.ToString((int)SourceSystemConst.Summit) + "," +              "\"SourceSystem\":\"" + EnumHelper.GetDescription(SourceSystemConst.Summit) + "\"," +              "\"SourceSystemRef\":\"1049217UK\"," +              "\"SubRef\":\"2010-02-09_EUR_MEIGHOE_MMSWEURSH\"" +              "}]" },           { "ParentDealId", "null" },           { "DealTypeId", Convert.ToString((int)DealTypeConst.Standalone) },           { "DealStatusId", Convert.ToString((int)DealStatusConst.Active) },           { "DealStatus", "\"" + EnumHelper.GetDescription(DealStatusConst.Active) + "\"" },           { "SalesStatusId", Convert.ToString((int)SalesStatusConst.Confirmed) },           { "SalesStatus", "\"" + EnumHelper.GetDescription(SalesStatusConst.Confirmed) + "\"" },           { "SalesReasonId", Convert.ToString((int)SalesReasonConst.Unknown) },           { "SalesReason", "\"" + EnumHelper.GetDescription(SalesReasonConst.Unknown) + "\"" },           { "CompanyId", "3738686" },           { "Company", "\"1868611907\"" },           { "TradeDate", "\"2010-02-09\"" },           { "ProductTypeId", "101" },           { "ProductType", "\"Swaps\"" },           { "ProductSubTypeId", "203" },           { "ProductSubType", "\"Swap Euro Eurib 0-4\"" },           { "TradingStatusId", Convert.ToString((int)TradingStatusConst.SignedOff) },           { "TradingStatus", "\"" + EnumHelper.GetDescription(TradingStatusConst.SignedOff) + "\"" },           { "StructurerId", Convert.ToString((int)UserConst.UnknownStructurer) },           { "Structurer", "\"" + EnumHelper.GetDescription(UserConst.UnknownStructurer) + "\"" },           { "PrevDealId", "null" },           { "SideId", Convert.ToString((int)SideConst.SellReceive) },           { "Side", "\"" + EnumHelper.GetDescription(SideConst.SellReceive) + "\"" },           { "Price", "0.0355" },           { "MarketSpotRate", "0.0355" },           { "SwapPoints", "0" },           { "ExchangeRate", "1" },           { "PCCcyId", Convert.ToString((int)CurrencyConst.EUR) },           { "PCCcy", "\"" + EnumHelper.GetDescription(CurrencyConst.EUR) + "\"" },           { "IsPCCalculated", "true" },           { "SpreadAsDecimal", "null" },           { "DecimalShiftFactor", "null" },           { "SIBPS", "0" },           { "SIBPSEntered", "false" },           { "SICcy", "0" },           { "SIEur", "0" },           { "TMRBPS", "0" },           { "TMRBPSEntered", "false" },           { "TMRCcy", "0" },           { "TMREur", "0" },           { "SuppressTMR", "false" },           { "TMBPS", "0.07896814951302975" },           { "TMBPSEntered", "false" },           { "TMCcy", "3000" },           { "TMEur", "3000" },           { "NTMBPS", "0" },           { "NTMBPSEntered", "false" },           { "NTMCcy", "0" },           { "NTMEur", "0" },           { "AtRiskBPS", "0" },           { "AtRiskBPSEntered", "false" },           { "AtRiskCcy", "0" },           { "AtRiskEur", "0" },           { "TotalPCBPS", "0.07896814951302975" },           { "TotalPCCcy", "3000" },           { "TotalPCEur", "3000" },           { "Comments", "\"SourceSystemRef:1049217UK,Portfolio:\r\n" +             "Asset/Leg 1... PorS: S / CCY: EUR / Notional: 379900000.0 / Index: EURIB3M / Freq: Q / Basis: A360 / Spread: 0.0 / FixFloat: FLO / Rate: 0.0\r\n" +             "Asset/Leg 2... PorS: P / CCY: EUR / Notional: 379900000.0 / Index: FIXED / Freq: Q / Basis: A360 / Spread: 0.0 / FixFloat: FIX / Rate: 0.0355\r\n\"" },           { "BookOpenPrice", "0" },           { "TradingPrice", "0" },           { "UnderlyingTypeId", Convert.ToString((int)UnderlyingTypeConst.NotApplicable) },           { "UnderlyingType", "\"" + EnumHelper.GetDescription(UnderlyingTypeConst.NotApplicable) + "\"" },           { "Underlying", "\"\"" },           { "IsETicket", "false" },           { "IsComplete", "true" },           { "IsReportable", "true" },           { "Version", "2" },           { "LastUpdated", "\"2010-12-01T17:26:26\"" },           { "LastUpdatedUserId", "202" },           { "LastUpdatedUser", "\"Meighoerner, Juergen\"" },           { "Created", "\"2010-02-09T13:10:46\"" },           { "CreatedUserId", "202" },           { "CreatedUser", "\"Meighoerner, Juergen\"" },         };        return dealDictionary;     }      /// &lt;summary&gt;    /// Perform the asserts common to all types of Deal.DetailsBase inheriting classes for an existing Deal     /// &lt;/summary&gt;    /// &lt;param name="detailsBase"&gt;&lt;/param&gt;    /// &lt;param name="dealMask"&gt;&lt;/param&gt;    /// &lt;param name="mode"&gt;&lt;/param&gt;    private static void PerformExistingDealDetailsBaseViewModelAsserts(Commerzbank.PCS.Web.PCSZCM.ViewModels.Deal.DetailsBase detailsBase, MaskConst dealMask, ScreenMode mode)     {       Assert.AreEqual(mode, detailsBase.Mode);       Assert.AreEqual(dealMask, detailsBase.Mask);       Assert.AreEqual(21461825, detailsBase.DealId);       Assert.AreEqual(null, detailsBase.ParentDealId);       Assert.AreEqual((int)DealTypeConst.Standalone, detailsBase.DealTypeId);       Assert.AreEqual((int)DealStatusConst.Active, detailsBase.DealStatusId);       Assert.AreEqual(EnumHelper.GetDescription(DealStatusConst.Active), detailsBase.DealStatus);       Assert.AreEqual((int)SalesStatusConst.Confirmed, detailsBase.SalesStatusId);       Assert.AreEqual(EnumHelper.GetDescription(SalesStatusConst.Confirmed), detailsBase.SalesStatus);       Assert.AreEqual((int)TradingStatusConst.SignedOff, detailsBase.TradingStatusId);       Assert.AreEqual(EnumHelper.GetDescription(TradingStatusConst.SignedOff), detailsBase.TradingStatus);       Assert.AreEqual((int)UserConst.UnknownStructurer, detailsBase.StructurerId);       Assert.AreEqual(EnumHelper.GetDescription(UserConst.UnknownStructurer), detailsBase.Structurer);       Assert.AreEqual((int)SalesReasonConst.Unknown, detailsBase.SalesReasonId);       Assert.AreEqual(EnumHelper.GetDescription(SalesReasonConst.Unknown), detailsBase.SalesReason);       Assert.AreEqual((int)SideConst.SellReceive, detailsBase.SideId);       Assert.AreEqual(EnumHelper.GetDescription(SideConst.SellReceive), detailsBase.Side);       Assert.AreEqual((int)UnderlyingTypeConst.NotApplicable, detailsBase.UnderlyingTypeId);       Assert.AreEqual(EnumHelper.GetDescription(UnderlyingTypeConst.NotApplicable), detailsBase.UnderlyingType);       Assert.AreEqual(3738686, detailsBase.CompanyId);       Assert.AreEqual("1868611907", detailsBase.Company);       Assert.AreEqual("2010-02-09", detailsBase.TradeDate);       Assert.AreEqual(101, detailsBase.ProductTypeId);       Assert.AreEqual("Swaps", detailsBase.ProductType);       Assert.AreEqual(203, detailsBase.ProductSubTypeId);       Assert.AreEqual("Swap Euro Eurib 0-4", detailsBase.ProductSubType);       Assert.AreEqual(null, detailsBase.PrevDealId);       Assert.AreEqual(0.0355M, detailsBase.Price);       Assert.AreEqual(0.0355M, detailsBase.MarketSpotRate);       Assert.AreEqual(0M, detailsBase.SwapPoints);       Assert.AreEqual((int)CurrencyConst.EUR, detailsBase.PCCcyId);       Assert.AreEqual(EnumHelper.GetDescription(CurrencyConst.EUR), detailsBase.PCCcy);       Assert.AreEqual(true, detailsBase.IsPCCalculated);       Assert.AreEqual(null, detailsBase.SpreadAsDecimal);       Assert.AreEqual(null, detailsBase.DecimalShiftFactor);       Assert.AreEqual(0M, detailsBase.SIBPS);       Assert.AreEqual(false, detailsBase.SIBPSEntered);       Assert.AreEqual(0M, detailsBase.SICcy);       Assert.AreEqual(0M, detailsBase.SIEur);       Assert.AreEqual(0M, detailsBase.TMRBPS);       Assert.AreEqual(false, detailsBase.TMRBPSEntered);       Assert.AreEqual(0M, detailsBase.TMRCcy);       Assert.AreEqual(0M, detailsBase.TMREur);       Assert.AreEqual(false, detailsBase.SuppressTMR);       Assert.AreEqual(0.07896814951302975M, detailsBase.TMBPS);       Assert.AreEqual(false, detailsBase.TMBPSEntered);       Assert.AreEqual(3000M, detailsBase.TMCcy);       Assert.AreEqual(3000M, detailsBase.TMEur);       Assert.AreEqual(0M, detailsBase.NTMBPS);       Assert.AreEqual(false, detailsBase.NTMBPSEntered);       Assert.AreEqual(0M, detailsBase.NTMCcy);       Assert.AreEqual(0M, detailsBase.NTMEur);       Assert.AreEqual(0M, detailsBase.AtRiskBPS);       Assert.AreEqual(false, detailsBase.AtRiskBPSEntered);       Assert.AreEqual(0M, detailsBase.AtRiskCcy);       Assert.AreEqual(0M, detailsBase.AtRiskEur);       Assert.AreEqual(0.07896814951302975M, detailsBase.TotalPCBPS);       Assert.AreEqual(3000M, detailsBase.TotalPCCcy);       Assert.AreEqual(3000M, detailsBase.TotalPCEur);       Assert.AreEqual("SourceSystemRef:1049217UK,Portfolio:\r\n" +             "Asset/Leg 1... PorS: S / CCY: EUR / Notional: 379900000.0 / Index: EURIB3M / Freq: Q / Basis: A360 / Spread: 0.0 / FixFloat: FLO / Rate: 0.0\r\n" +             "Asset/Leg 2... PorS: P / CCY: EUR / Notional: 379900000.0 / Index: FIXED / Freq: Q / Basis: A360 / Spread: 0.0 / FixFloat: FIX / Rate: 0.0355\r\n", detailsBase.Comments);       Assert.AreEqual(0M, detailsBase.BookOpenPrice);       Assert.AreEqual(0M, detailsBase.TradingPrice);       Assert.AreEqual(string.Empty, detailsBase.Underlying);       Assert.AreEqual(false, detailsBase.IsETicket);       Assert.AreEqual(true, detailsBase.IsComplete);       Assert.AreEqual(true, detailsBase.IsReportable);       Assert.AreEqual(2, detailsBase.Version);       Assert.AreEqual("2010-12-01T17:26:26", detailsBase.LastUpdated);       Assert.AreEqual(202, detailsBase.LastUpdatedUserId);       Assert.AreEqual("Meighoerner, Juergen", detailsBase.LastUpdatedUser);       Assert.AreEqual("2010-02-09T13:10:46", detailsBase.Created);       Assert.AreEqual(202, detailsBase.CreatedUserId);       Assert.AreEqual("Meighoerner, Juergen", detailsBase.CreatedUser);        var salesComparisonList = new List&lt;DetailsBase.DealSales&gt; {          new DetailsBase.DealSales {            Priority = 1,            SalesId = 202,            SalesFirstName = "Juergen",            SalesLastName = "Meighoerner",           SalesTeamId = 801,           SalesTeamName = "_CM FICS R&amp;C Rates FFT",           Percentage = 100         }       };       Assert.IsTrue(salesComparisonList.SequenceEqual(detailsBase.SalesList, new DetailsBase.DealSalesComparer()), "SalesLists differ");        var traderComparisonList = new List&lt;DetailsBase.DealTrader&gt; {          new DetailsBase.DealTrader {            Priority = 1,            TraderId = 736,            TraderFirstName = "Mike",            TraderLastName = "Dobson",           FrontOfficeBookId = 3052,           FrontOfficeBook = "MMSWEURSH"         }       };       Assert.IsTrue(traderComparisonList.SequenceEqual(detailsBase.TraderList, new DetailsBase.DealTraderComparer()), "TraderLists differ");        var dealTagComparisonList = new List&lt;DetailsBase.DealTag&gt; {          new DetailsBase.DealTag {            DealTagTypeId = (int)DealTagTypeConst.BrokerId,            DealTagType = Convert.ToString(DealTagTypeConst.BrokerId),            DealTagValue = "BOWMANP",           DealTagFormatId = (int)DealTagFormatConst.String          }       };       Assert.IsTrue(dealTagComparisonList.SequenceEqual(detailsBase.TagList, new DetailsBase.DealTagComparer()), "TagLists differ");        var dealSourceSystemRefComparisonList = new List&lt;DetailsBase.DealSourceSystemRef&gt; {          new DetailsBase.DealSourceSystemRef {            Priority = 1,            DealTypeId = (int)DealTypeConst.Standalone,           SourceSystemId = (int)SourceSystemConst.Summit,           SourceSystem = Convert.ToString(SourceSystemConst.Summit),            SourceSystemRef = "1049217UK",           SubRef = "2010-02-09_EUR_MEIGHOE_MMSWEURSH"         }       };       Assert.IsTrue(dealSourceSystemRefComparisonList.SequenceEqual(detailsBase.SourceSystemRefList, new DetailsBase.DealSourceSystemRefComparer()), "SourceSystemRefLists differ");     }      private static void AddDealDetailsBondBaseViewModelPropertiesToDictionary(Dictionary&lt;string, string&gt; dealDictionary)     {       dealDictionary.Add("ProductCodeTypeId", Convert.ToString((int)ProductCodeTypeConst.SUMMIT));       dealDictionary.Add("ProductCodeType", "\"" + Convert.ToString(ProductCodeTypeConst.SUMMIT) + "\"");       dealDictionary.Add("ProductRef", "\"1049217UK\"");       dealDictionary.Add("ProductName", "\"SWAP\"");       dealDictionary.Add("CcyId", Convert.ToString((int)CurrencyConst.EUR));       dealDictionary.Add("Ccy", "\"" + Convert.ToString(CurrencyConst.EUR) + "\"");       dealDictionary.Add("NominalCcy", "379900000");       dealDictionary.Add("NominalEur", "379900000");     }      /// &lt;summary&gt;    /// Perform the asserts common to all types of Deal.DetailsBondBase inheriting classes for an existing Deal     /// &lt;/summary&gt;    /// &lt;param name="detailsBondBase"&gt;&lt;/param&gt;    private static void PerformExistingDealDetailsBondBaseViewModelAsserts(Commerzbank.PCS.Web.PCSZCM.ViewModels.Deal.DetailsBondBase detailsBondBase)     {       Assert.AreEqual((int)ProductCodeTypeConst.SUMMIT, detailsBondBase.ProductCodeTypeId);       Assert.AreEqual(EnumHelper.GetDescription(ProductCodeTypeConst.SUMMIT), detailsBondBase.ProductCodeType);       Assert.AreEqual("1049217UK", detailsBondBase.ProductRef);       Assert.AreEqual("SWAP", detailsBondBase.ProductName);       Assert.AreEqual((int)CurrencyConst.EUR, detailsBondBase.CcyId);       Assert.AreEqual(EnumHelper.GetDescription(CurrencyConst.EUR), detailsBondBase.Ccy);       Assert.AreEqual(379900000M, detailsBondBase.NominalCcy);       Assert.AreEqual(379900000M, detailsBondBase.NominalEur);     }      /// &lt;summary&gt;    /// Perform the asserts common to all types of Deals for an existing Deal     /// &lt;/summary&gt;    /// &lt;param name="deal"&gt;&lt;/param&gt;    private static void PerformExistingDealBaseAsserts(Deal deal)     {       var dealId = 21461825;       var tradeDate = new DateTime(2010, 2, 9);        Assert.AreEqual(dealId, deal.DealId);       Assert.AreEqual(null, deal.ParentDealId);       Assert.AreEqual((int)DealTypeConst.Standalone, deal.DealTypeId);       Assert.AreEqual((int)DealStatusConst.Active, deal.DealStatusId);       Assert.AreEqual(EnumHelper.GetDescription(DealStatusConst.Active), deal.DealStatus);       Assert.AreEqual((int)SalesStatusConst.Confirmed, deal.SalesStatusId);       Assert.AreEqual(EnumHelper.GetDescription(SalesStatusConst.Confirmed), deal.SalesStatus);       Assert.AreEqual((int)TradingStatusConst.SignedOff, deal.TradingStatusId);       Assert.AreEqual(EnumHelper.GetDescription(TradingStatusConst.SignedOff), deal.TradingStatus);       Assert.AreEqual((int)UserConst.UnknownStructurer, deal.StructurerId);       Assert.AreEqual(EnumHelper.GetDescription(UserConst.UnknownStructurer), deal.Structurer);       Assert.AreEqual((int)SalesReasonConst.Unknown, deal.SalesReasonId);       Assert.AreEqual(EnumHelper.GetDescription(SalesReasonConst.Unknown), deal.SalesReason);       Assert.AreEqual((int)SideConst.SellReceive, deal.SideId);       Assert.AreEqual(EnumHelper.GetDescription(SideConst.SellReceive), deal.Side);       Assert.AreEqual((int)UnderlyingTypeConst.NotApplicable, deal.UnderlyingTypeId);       Assert.AreEqual(EnumHelper.GetDescription(UnderlyingTypeConst.NotApplicable), deal.UnderlyingType);       Assert.AreEqual(3738686, deal.CompanyId);       Assert.AreEqual("1868611907", deal.Company);       Assert.AreEqual(tradeDate, deal.TradeDate);       Assert.AreEqual(101, deal.ProductTypeId);       Assert.AreEqual("Swaps", deal.ProductType);       Assert.AreEqual(203, deal.ProductSubTypeId);       Assert.AreEqual("Swap Euro Eurib 0-4", deal.ProductSubType);       Assert.AreEqual(null, deal.PrevDealId);       Assert.AreEqual(0.0355M, deal.Price);       Assert.AreEqual(0.0355M, deal.MarketSpotRate);       Assert.AreEqual(0M, deal.SwapPoints);       Assert.AreEqual((int)CurrencyConst.EUR, deal.PCCcyId);       Assert.AreEqual(EnumHelper.GetDescription(CurrencyConst.EUR), deal.PCCcy);       Assert.AreEqual(true, deal.IsPCCalculated);       Assert.AreEqual(null, deal.SpreadAsDecimal);       Assert.AreEqual(null, deal.DecimalShiftFactor);       Assert.AreEqual(0M, deal.SIBPS);       Assert.AreEqual(false, deal.SIBPSEntered);       Assert.AreEqual(0M, deal.SICcy);       Assert.AreEqual(0M, deal.SIEur);       Assert.AreEqual(0M, deal.TMRBPS);       Assert.AreEqual(false, deal.TMRBPSEntered);       Assert.AreEqual(0M, deal.TMRCcy);       Assert.AreEqual(0M, deal.TMREur);       Assert.AreEqual(false, deal.SuppressTMR);       Assert.AreEqual(0.07896814951302975M, deal.TMBPS);       Assert.AreEqual(false, deal.TMBPSEntered);       Assert.AreEqual(3000M, deal.TMCcy);       Assert.AreEqual(3000M, deal.TMEur);       Assert.AreEqual(0M, deal.NTMBPS);       Assert.AreEqual(false, deal.NTMBPSEntered);       Assert.AreEqual(0M, deal.NTMCcy);       Assert.AreEqual(0M, deal.NTMEur);       Assert.AreEqual(0M, deal.AtRiskBPS);       Assert.AreEqual(false, deal.AtRiskBPSEntered);       Assert.AreEqual(0M, deal.AtRiskCcy);       Assert.AreEqual(0M, deal.AtRiskEur);       Assert.AreEqual(0.07896814951302975M, deal.TotalPCBPS);       Assert.AreEqual(3000M, deal.TotalPCCcy);       Assert.AreEqual(3000M, deal.TotalPCEur);       Assert.AreEqual("SourceSystemRef:1049217UK,Portfolio:\r\n" +             "Asset/Leg 1... PorS: S / CCY: EUR / Notional: 379900000.0 / Index: EURIB3M / Freq: Q / Basis: A360 / Spread: 0.0 / FixFloat: FLO / Rate: 0.0\r\n" +             "Asset/Leg 2... PorS: P / CCY: EUR / Notional: 379900000.0 / Index: FIXED / Freq: Q / Basis: A360 / Spread: 0.0 / FixFloat: FIX / Rate: 0.0355\r\n", deal.Comments);       Assert.AreEqual(0M, deal.BookOpenPrice);       Assert.AreEqual(0M, deal.TradingPrice);       Assert.AreEqual(string.Empty, deal.Underlying);       Assert.AreEqual(false, deal.IsETicket);       Assert.AreEqual(true, deal.IsComplete);       Assert.AreEqual(true, deal.IsReportable);       Assert.AreEqual(2, deal.Version);       Assert.AreEqual("2010-12-01T17:26:26".ToDateTime(), deal.LastUpdated);       Assert.AreEqual(202, deal.LastUpdatedUserId);       Assert.AreEqual("Meighoerner, Juergen", deal.LastUpdatedUser);       Assert.AreEqual("2010-02-09T13:10:46".ToDateTime(), deal.Created);       Assert.AreEqual(202, deal.CreatedUserId);       Assert.AreEqual("Meighoerner, Juergen", deal.CreatedUser);              var salesComparisonList = new List&lt;DealSales&gt;() {          new DealSales {            DealId = dealId,           TradeDate = tradeDate,           Priority = 1,            SalesId = 202,            SalesFirstName = "Juergen",            SalesLastName = "Meighoerner",           SalesTeamId = 801,           SalesTeamName = "_CM FICS R&amp;C Rates FFT",           PercentagePoints = 100         }       };       Assert.IsTrue(salesComparisonList.SequenceEqual(deal.SalesList, new DealSalesComparer()), "SalesLists differ");        var traderComparisonList = new List&lt;DealTrader&gt; {          new DealTrader {            DealId = dealId,           TradeDate = tradeDate,           Priority = 1,            TraderId = 736,            TraderFirstName = "Mike",            TraderLastName = "Dobson",           FrontOfficeBookId = 3052,           FrontOfficeBook = "MMSWEURSH"         }       };       Assert.IsTrue(traderComparisonList.SequenceEqual(deal.TraderList, new DealTraderComparer()), "TraderLists differ");        var dealTagComparisonList = new List&lt;DealTag&gt; {          new DealTag {            DealId = dealId,           DealTagTypeId = (int)DealTagTypeConst.BrokerId,            DealTagType = Convert.ToString(DealTagTypeConst.BrokerId),            DealTagValue = "BOWMANP",           DealTagFormatId = (int)DealTagFormatConst.String          }       };       Assert.IsTrue(dealTagComparisonList.SequenceEqual(deal.TagList, new DealTagComparer()), "TagLists differ");        var dealSourceSystemRefComparisonList = new List&lt;DealSourceSystemRef&gt; {          new DealSourceSystemRef {            DealId = dealId,           Priority = 1,            DealTypeId = (int)DealTypeConst.Standalone,           SourceSystemId = (int)SourceSystemConst.Summit,           SourceSystem = Convert.ToString(SourceSystemConst.Summit),            SourceSystemRef = "1049217UK",           SubRef = "2010-02-09_EUR_MEIGHOE_MMSWEURSH"         }       };       Assert.IsTrue(dealSourceSystemRefComparisonList.SequenceEqual(deal.SourceSystemRefList, new DealSourceSystemRefComparer()), "DealSourceSystemRefLists differ");     }      /// &lt;summary&gt;    /// Perform the asserts common to all types of BondBased Deals for an existing Deal     /// &lt;/summary&gt;    /// &lt;param name="deal"&gt;&lt;/param&gt;    private static void PerformExistingDealBondBaseAsserts(Deal deal)     {       Assert.AreEqual((int)ProductCodeTypeConst.SUMMIT, deal.ProductCodeTypeId);       Assert.AreEqual(EnumHelper.GetDescription(ProductCodeTypeConst.SUMMIT), deal.ProductCodeType);       Assert.AreEqual("1049217UK", deal.ProductRef);       Assert.AreEqual("SWAP", deal.ProductName);       Assert.AreEqual((int)CurrencyConst.EUR, deal.Ccy1Id);       Assert.AreEqual(EnumHelper.GetDescription(CurrencyConst.EUR), deal.Ccy1);       Assert.AreEqual(379900000M, deal.NominalCcy1);       Assert.AreEqual(379900000M, deal.NominalEur);     }      /// &lt;summary&gt;    /// Perform Deal.DetailsBond viewmodel asserts for an existing Deal     /// &lt;/summary&gt;    /// &lt;param name="dealDetailsBondViewModel"&gt;&lt;/param&gt;    /// &lt;param name="mode"&gt;&lt;/param&gt;    private static void PerformExistingDealDetailsViewModelBondAsserts(Commerzbank.PCS.Web.PCSZCM.ViewModels.Deal.DetailsBond dealDetailsBondViewModel, ScreenMode mode)     {       Assert.AreEqual("2013-03-02", dealDetailsBondViewModel.MaturityDate);       Assert.AreEqual("2006-08-03", dealDetailsBondViewModel.SettlementDate);        PerformExistingDealDetailsBondBaseViewModelAsserts(dealDetailsBondViewModel);       PerformExistingDealDetailsBaseViewModelAsserts(dealDetailsBondViewModel, MaskConst.Govie, mode);     }      /// &lt;summary&gt;    /// Perform Deal.DetailsBond viewmodel asserts for a new Deal     /// &lt;/summary&gt;    /// &lt;param name="dealDetailsBondViewModel"&gt;&lt;/param&gt;    /// &lt;param name="mode"&gt;&lt;/param&gt;    private static void PerformNewDealDetailsViewModelBondAsserts(Commerzbank.PCS.Web.PCSZCM.ViewModels.Deal.DetailsBond dealDetailsBondViewModel)     {       Assert.AreEqual("New Swap Euro Eurib 0-4", dealDetailsBondViewModel.Title);       Assert.AreEqual(DateTime.Today.ToISODateString(), dealDetailsBondViewModel.MaturityDate);       Assert.AreEqual(DateTime.Today.ToISODateString(), dealDetailsBondViewModel.SettlementDate);        PerformNewDealDetailsBondBaseViewModelAsserts(dealDetailsBondViewModel);       PerformNewDealDetailsBaseViewModelAsserts(dealDetailsBondViewModel, MaskConst.Govie);     }      /// &lt;summary&gt;    /// Perform the asserts common to all types of Deal.DetailsBondBase inheriting classes for a new Deal     /// &lt;/summary&gt;    /// &lt;param name="detailsBondBase"&gt;&lt;/param&gt;    private static void PerformNewDealDetailsBondBaseViewModelAsserts(Commerzbank.PCS.Web.PCSZCM.ViewModels.Deal.DetailsBondBase detailsBondBase)     {       Assert.AreEqual((int)ProductCodeTypeConst.Unknown, detailsBondBase.ProductCodeTypeId);       Assert.AreEqual(EnumHelper.GetDescription(ProductCodeTypeConst.Unknown), detailsBondBase.ProductCodeType);       Assert.AreEqual(null, detailsBondBase.ProductRef);       Assert.AreEqual(null, detailsBondBase.ProductName);       Assert.AreEqual((int)CurrencyConst.EUR, detailsBondBase.CcyId);       Assert.AreEqual(EnumHelper.GetDescription(CurrencyConst.EUR), detailsBondBase.Ccy);       Assert.AreEqual(0M, detailsBondBase.NominalCcy);       Assert.AreEqual(0M, detailsBondBase.NominalEur);     }      /// &lt;summary&gt;    /// Perform the asserts common to all types of Deal.DetailsBase inheriting classes for a new Deal     /// &lt;/summary&gt;    /// &lt;param name="detailsBase"&gt;&lt;/param&gt;    /// &lt;param name="dealMask"&gt;&lt;/param&gt;    private static void PerformNewDealDetailsBaseViewModelAsserts(Commerzbank.PCS.Web.PCSZCM.ViewModels.Deal.DetailsBase detailsBase, MaskConst dealMask)     {       Assert.AreEqual(ScreenMode.New, detailsBase.Mode);       Assert.AreEqual(dealMask, detailsBase.Mask);       Assert.AreEqual(null, detailsBase.DealId);       Assert.AreEqual(null, detailsBase.ParentDealId);       Assert.AreEqual((int)DealTypeConst.Standalone, detailsBase.DealTypeId);       Assert.AreEqual((int)DealStatusConst.Active, detailsBase.DealStatusId);       Assert.AreEqual(EnumHelper.GetDescription(DealStatusConst.Active), detailsBase.DealStatus);       Assert.AreEqual((int)SalesStatusConst.Confirmed, detailsBase.SalesStatusId);       Assert.AreEqual(EnumHelper.GetDescription(SalesStatusConst.Confirmed), detailsBase.SalesStatus);       Assert.AreEqual((int)TradingStatusConst.Pending, detailsBase.TradingStatusId);       Assert.AreEqual(EnumHelper.GetDescription(TradingStatusConst.Pending), detailsBase.TradingStatus);       Assert.AreEqual((int)UserConst.UnknownStructurer, detailsBase.StructurerId);       Assert.AreEqual(EnumHelper.GetDescription(UserConst.UnknownStructurer), detailsBase.Structurer);       Assert.AreEqual((int)SalesReasonConst.Unknown, detailsBase.SalesReasonId);       Assert.AreEqual(EnumHelper.GetDescription(SalesReasonConst.Unknown), detailsBase.SalesReason);       Assert.AreEqual((int)SideConst.SellReceive, detailsBase.SideId);       Assert.AreEqual(EnumHelper.GetDescription(SideConst.SellReceive), detailsBase.Side);       Assert.AreEqual((int)UnderlyingTypeConst.NotApplicable, detailsBase.UnderlyingTypeId);       Assert.AreEqual(EnumHelper.GetDescription(UnderlyingTypeConst.NotApplicable), detailsBase.UnderlyingType);       Assert.AreEqual((int)CurrencyConst.EUR, detailsBase.PCCcyId);       Assert.AreEqual(EnumHelper.GetDescription(CurrencyConst.EUR), detailsBase.PCCcy);       Assert.AreEqual(0, detailsBase.CompanyId);       Assert.AreEqual(null, detailsBase.Company);       Assert.AreEqual(DateTime.Today.ToISODateString(), detailsBase.TradeDate);       Assert.AreEqual(101, detailsBase.ProductTypeId);       Assert.AreEqual("Swaps", detailsBase.ProductType);       Assert.AreEqual(203, detailsBase.ProductSubTypeId);       Assert.AreEqual("Swap Euro Eurib 0-4", detailsBase.ProductSubType);       Assert.AreEqual(null, detailsBase.PrevDealId);       Assert.AreEqual(0M, detailsBase.Price);       Assert.AreEqual(0M, detailsBase.MarketSpotRate);       Assert.AreEqual(0M, detailsBase.SwapPoints);       Assert.AreEqual(false, detailsBase.IsPCCalculated);       Assert.AreEqual(null, detailsBase.SpreadAsDecimal);       Assert.AreEqual(null, detailsBase.DecimalShiftFactor);       Assert.AreEqual(0M, detailsBase.SIBPS);       Assert.AreEqual(false, detailsBase.SIBPSEntered);       Assert.AreEqual(0M, detailsBase.SICcy);       Assert.AreEqual(0M, detailsBase.SIEur);       Assert.AreEqual(0M, detailsBase.TMRBPS);       Assert.AreEqual(false, detailsBase.TMRBPSEntered);       Assert.AreEqual(0M, detailsBase.TMRCcy);       Assert.AreEqual(0M, detailsBase.TMREur);       Assert.AreEqual(false, detailsBase.SuppressTMR);       Assert.AreEqual(0M, detailsBase.TMBPS);       Assert.AreEqual(false, detailsBase.TMBPSEntered);       Assert.AreEqual(0M, detailsBase.TMCcy);       Assert.AreEqual(0M, detailsBase.TMEur);       Assert.AreEqual(0M, detailsBase.NTMBPS);       Assert.AreEqual(false, detailsBase.NTMBPSEntered);       Assert.AreEqual(0M, detailsBase.NTMCcy);       Assert.AreEqual(0M, detailsBase.NTMEur);       Assert.AreEqual(0M, detailsBase.AtRiskBPS);       Assert.AreEqual(false, detailsBase.AtRiskBPSEntered);       Assert.AreEqual(0M, detailsBase.AtRiskCcy);       Assert.AreEqual(0M, detailsBase.AtRiskEur);       Assert.AreEqual(0M, detailsBase.TotalPCBPS);       Assert.AreEqual(0M, detailsBase.TotalPCCcy);       Assert.AreEqual(0M, detailsBase.TotalPCEur);       Assert.AreEqual(null, detailsBase.Comments);       Assert.AreEqual(0M, detailsBase.BookOpenPrice);       Assert.AreEqual(0M, detailsBase.TradingPrice);       Assert.AreEqual(null, detailsBase.Underlying);       Assert.AreEqual(false, detailsBase.IsETicket);       Assert.AreEqual(false, detailsBase.IsComplete);       Assert.AreEqual(false, detailsBase.IsReportable);       Assert.AreEqual(0, detailsBase.Version);       Assert.AreEqual(null, detailsBase.LastUpdated);       Assert.AreEqual(0, detailsBase.LastUpdatedUserId);       Assert.AreEqual(null, detailsBase.LastUpdatedUser);       Assert.AreEqual(null, detailsBase.Created);       Assert.AreEqual(0, detailsBase.CreatedUserId);       Assert.AreEqual(null, detailsBase.CreatedUser);        var salesComparisonList = new List&lt;DetailsBase.DealSales&gt;();       Assert.IsTrue(salesComparisonList.SequenceEqual(detailsBase.SalesList, new DetailsBase.DealSalesComparer()), "SalesLists differ");        var traderComparisonList = new List&lt;DetailsBase.DealTrader&gt;();       Assert.IsTrue(traderComparisonList.SequenceEqual(detailsBase.TraderList, new DetailsBase.DealTraderComparer()), "TraderLists differ");        var dealTagComparisonList = new List&lt;DetailsBase.DealTag&gt;();       Assert.IsTrue(dealTagComparisonList.SequenceEqual(detailsBase.TagList, new DetailsBase.DealTagComparer()), "TagLists differ");        var dealSourceSystemRefComparisonList = new List&lt;DetailsBase.DealSourceSystemRef&gt;();       Assert.IsTrue(dealSourceSystemRefComparisonList.SequenceEqual(detailsBase.SourceSystemRefList, new DetailsBase.DealSourceSystemRefComparer()), "SourceSystemRefLists differ");     }      /// &lt;summary&gt;    /// Given a deal dictionary return JSON constructed from it     /// &lt;/summary&gt;    /// &lt;param name="dealDictionary"&gt;&lt;/param&gt;    /// &lt;returns&gt;&lt;/returns&gt;    private static string ConstructJSONFromDealDictionary(Dictionary&lt;string, string&gt; dealDictionary)     {       return "{" +          string.Join(",",            dealDictionary           .Select(pair =&gt; string.Format("\"{0}\":{1}", pair.Key, pair.Value))           ) +          "}";     }      #endregion      /*        [TestMethod]     public void Update_ProductType_and_return_updated_ProductType_once_complete()     {       //Create a ProductType which we expect to receive back from the controller       var productType = MakeProductType();        //Arrange       _productTypeDb.Setup(x =&gt; x.GetProductType(It.IsAny&lt;int&gt;()))         .Returns(productType);       _productTypeDb.Setup(x =&gt; x.AddProductType(It.IsAny&lt;int&gt;(), It.IsAny&lt;ProductType&gt;()))         .Returns(11);       _productTypeDb.Setup(x =&gt; x.GetProductTypeListByParentProductType(It.IsAny&lt;int&gt;()))         .Returns(new List&lt;ProductType&gt;());       _productSubTypeDb.Setup(x =&gt; x.GetProductSubTypeList(It.IsAny&lt;string&gt;(), It.IsAny&lt;bool?&gt;()))         .Returns(new List&lt;ProductSubType&gt;());        //Create a DetailsProductType view model for passing to controller for update       var newProductTypeViewModel = MakeDetailsProductType(true);        //Act       var result = _controller.AddUpdateProductType(newProductTypeViewModel);        //Assert       Assert.AreEqual((int)System.Net.HttpStatusCode.OK, _controller.Response.StatusCode, "Updated failed in controller");       Assert.IsInstanceOfType(result.Data, typeof(ProductType));       Assert.AreEqual(11, ((ProductType)result.Data).ProductTypeId);       Assert.AreEqual("A new Product Type", ((ProductType)result.Data).Name);       Assert.AreEqual(null, ((ProductType)result.Data).ParentProductTypeId);       Assert.AreEqual(string.Empty, ((ProductType)result.Data).ParentProductType);       Assert.AreEqual(true, ((ProductType)result.Data).IsActive);     }      [TestMethod]     public void Provide_AddUpdateProductType_with_an_invalid_model_and_ensure_bad_request_status_code_and_error_messages_are_returned()     {       _controller.ModelState.AddModelError("I'm willingly invalidating the ModelState to test failure performs as expected", new Exception("Dummy"));        //Act       var result = _controller.AddUpdateProductType(new Commerzbank.PCS.Web.PCSAdmin.ViewModels.ProductTypeSubType.DetailsProductType());       var output = new JavaScriptSerializer().Serialize(result.Data);        //Assert       Assert.AreEqual((int)System.Net.HttpStatusCode.BadRequest, _controller.Response.StatusCode);       Assert.IsTrue(output.Contains("\"Messages\":["), "Error messages are not being returned to the client - how will the user know what is wrong?");     }      #region Private      private static Commerzbank.PCS.Web.PCSAdmin.ViewModels.ProductTypeSubType.DetailsProductType MakeDetailsProductType(bool isUpdate)     {       var newProductTypeViewModel = new Commerzbank.PCS.Web.PCSAdmin.ViewModels.ProductTypeSubType.DetailsProductType       {         Mode = isUpdate ? (int)ScreenMode.Edit : (int)ScreenMode.New,         ProductTypeId = 11,         Name = "A new Product Type",         ParentProductTypeId = null,         ParentProductType = "",         IsActive = true,         ChildProductTypeIds = new int[0],         ChildProductSubTypeIds = new int[0]       };        return newProductTypeViewModel;     }      private static ProductType MakeProductType()     {       var productType = new ProductType       {         ProductTypeId = 11,         Name = "A new Product Type",         ParentProductTypeId = null,         ParentProductType = "",         IsActive = true       };        return productType;     }      #endregion      */   } }</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/6481191744859790339'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/6481191744859790339'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-7861984431989678317</id><published>2012-07-18T14:26:00.004+01:00</published><updated>2012-07-18T14:26:20.115+01:00</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>RenderRazorViewToString</title><content type='html'>using System; using System.Collections.Generic; using System.Linq; using System.Web; using System.Web.Mvc; using System.IO;  namespace MyNamespace {     /// &lt;summary&gt;    /// MVC HtmlHelper extension methods - controller extensions     /// &lt;/summary&gt;    public static class ControllerExtensions     {         /// &lt;summary&gt;        /// Author      : John Reilly         /// Description : Extension method to render a partial view to a string - taken from here: http://craftycodeblog.com/2010/05/15/asp-net-mvc-render-partial-view-to-string/         /// &lt;/summary&gt;        /// &lt;param name="controller"&gt;&lt;/param&gt;        /// &lt;param name="viewName"&gt;&lt;/param&gt;        /// &lt;param name="model"&gt;&lt;/param&gt;        /// &lt;returns&gt;&lt;/returns&gt;        public static string RenderRazorViewToString(this Controller controller, string viewName, object model)         {             if (controller == null)             {                 throw new ArgumentNullException("controller", "Extension method called on a null controller");             }              if (controller.ControllerContext == null)             {                 return string.Empty;             }              controller.ViewData.Model = model;             using (var sw = new StringWriter())             {                 var viewResult = ViewEngines.Engines.FindPartialView(controller.ControllerContext, viewName);                 var viewContext = new ViewContext(controller.ControllerContext, viewResult.View, controller.ViewData, controller.TempData, sw);                                  viewResult.View.Render(viewContext, sw);                 viewResult.ViewEngine.ReleaseView(controller.ControllerContext, viewResult.View);                  return sw.GetStringBuilder().ToString();             }         }     } }</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7861984431989678317'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7861984431989678317'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4925033677149512549</id><published>2012-07-16T07:17:00.001+01:00</published><updated>2021-03-04T18:09:07.339Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='asp.net mvc'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Kevin Craft'/><category scheme='http://www.blogger.com/atom/ns#' term='PartialView'/><category scheme='http://www.blogger.com/atom/ns#' term='JsonResult'/><title type='text'>Rendering Partial View to a String</title><content type='html'>&lt;h4&gt;Well done that man!&lt;/h4&gt;Every now and then I'm thinking to myself "&lt;i&gt;wouldn't it be nice if you could do x...&lt;/i&gt;"  And then I discover that someone else has thought the self same thoughts and better yet they have the answer!  I had this situation recently and discovered the wonderful Kevin Craft had been there, done that and made the T-shirt.  Here's his blog:&lt;br /&gt;&lt;br /&gt;&lt;a target="_blank" href="http://craftycodeblog.com/2010/05/15/asp-net-mvc-render-partial-view-to-string/"&gt;http://craftycodeblog.com/2010/05/15/asp-net-mvc-render-partial-view-to-string/&lt;/a&gt;&lt;br /&gt;&lt;br /&gt;I wanted to talk about how this simple post provided me with an elegant solution to something I've found niggling and unsatisfactory for a while now...&lt;br /&gt;&lt;br /&gt;&lt;h4&gt;How it helped&lt;/h4&gt;Just last week I was thinking about &lt;code&gt;Partial Views&lt;/code&gt;.  Some background.  I'm working on an ASP.NET MVC 3 project which provides users with a nice web interface to manage the workflow surrounding certain types of financial asset.  The user is presented with a web page which shows a kind of grid to the user.  As the user hovers over a row they are presented with a context menu which allows them to perform certain workflow actions.  If they perform an action then that row will need to be updated to reflect this.&lt;br /&gt;&lt;br /&gt;Back in the day this would have been achieved by doing a full postback to the server. At the server the action would be taken, the persistent storage updated and then the whole page would be served up to the user again with the relevant row of HTML updated but everything else staying as is.&lt;br /&gt;&lt;br /&gt;Now there's nothing wrong with this approach as such. I mean it works just fine.  But in my case since I knew that it was only that single row of HTML that was going to be updated and so I was loath to re-render the whole page.  It seemed a waste to get so much data back from the server when only a marginal amount was due to change.  And also I didn't want the user to experience the screen refresh flash.  Looks ugly.&lt;br /&gt;&lt;br /&gt;Now in the past when I've had a solution to this problem which from a UI perspective is good but from a development perspective slightly unsatisfactory.  I would have my page call a controller method (via &lt;code&gt;jQuery.ajax&lt;/code&gt;) to perform the action.  This controller would return a &lt;code&gt;JsonResult&lt;/code&gt; indicating success or failure and any data necessary to update the screen.  Then in the &lt;code&gt;success&lt;/code&gt; function I would manually update the HTML on the screen using the data provided.&lt;br /&gt;&lt;br /&gt;Now this solution works but there's a problem.  &lt;a href="http://en.wikipedia.org/wiki/Rolf_Harris" target="_blank"&gt;Can you tell what it is yet?&lt;/a&gt;  It's not very DRY.  I'm repeating myself.  When the page is initially rendered I have a &lt;code&gt;View&lt;/code&gt; which renders (in this example) all the relevant HTML for the screen *including* the HTML for my rows of data.  And likewise I have my JavaScript method for updating the screen too.  So with this solution I have duplicated my GUI logic.  If I update 1, I need to update the other.  It's not a massive hardship but it is, as I say, unsatisfactory.&lt;br /&gt;&lt;br /&gt;I was recently thinking that it would be nice if I could refactor my row HTML into a &lt;code&gt;Partial View&lt;/code&gt; which I could then use in 2 places: &lt;ol&gt;&lt;li&gt;In my standard &lt;code&gt;View&lt;/code&gt; as I iterated through each element for display&lt;br /&gt;&lt;br /&gt;and&lt;br /&gt;&lt;br /&gt;&lt;/li&gt;&lt;li&gt;Nested inside a &lt;code&gt;JsonResult&lt;/code&gt;...&lt;/li&gt;&lt;/ol&gt;The wonderful thing about approach 2 is that it allows me to massively simplify my &lt;code&gt;success&lt;/code&gt; to this:  &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;$("myRowSelector")&lt;br /&gt;    .empty()&lt;br /&gt;    .html(data.RowHTML); //Where RowHTML is the property that &lt;br /&gt;                         //contains my stringified PartialView&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; and if I later make changes to the &lt;code&gt;Partial View&lt;/code&gt; these changes will not require me to make any changes to my JavaScript at all.  Brilliant!  And entirely satisfactory.&lt;br /&gt;&lt;br /&gt;On the grounds that someone else might have had the same idea I did a little googling around.  Sure enough I discovered &lt;a target="_blank" href="http://craftycodeblog.com/2010/05/15/asp-net-mvc-render-partial-view-to-string/"&gt;Kevin Craft's post&lt;/a&gt; which was just the ticket.  It does exactly what I'd hoped.&lt;br /&gt;&lt;br /&gt;Besides being a nice and DRY solution this approach has a number of other advantages as well: &lt;ul&gt;&lt;li&gt;Given it's a &lt;code&gt;Partial View&lt;/code&gt; the Visual Studio IDE provides a nice experience when coding it up with regards to intellisense / highlighting etc.  Not something available when you're hand coding up a string which contains the HTML you'd like passed back...&lt;/li&gt;&lt;li&gt;A wonderful debug experience.  You can debug the rendering of a &lt;code&gt;Partial View&lt;/code&gt; being rendered to a string in the same way as if the ASP.NET MVC framework was serving it up.  I could have lived without this but it's fantastic to have it available.&lt;/li&gt;&lt;li&gt;It's possible to nest *&lt;b&gt;multiple&lt;/b&gt;* &lt;code&gt;Partial Views&lt;/code&gt; within your &lt;code&gt;JsonResult&lt;/code&gt;. THIS IS WONDERFUL!!!  This means that if several parts of your screen need to be updated (perhaps the row and a status panel as well) then as long as both are refactored into a &lt;code&gt;Partial View&lt;/code&gt; you can generate them on the fly and pass them back.&lt;/li&gt;&lt;/ul&gt;Excellent stuff!</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4925033677149512549'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4925033677149512549'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2012/07/rendering-partial-view-to-string.html' title='Rendering Partial View to a String'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5703618487402068938</id><published>2012-07-02T10:05:00.000+01:00</published><updated>2012-07-02T10:05:50.480+01:00</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Film reviews website plans</title><content type='html'>HTML5 Boilerplate Authenticate using FaceBook / Twitter / Google? Allows user to import a film from Netflix Create brand new Written using mvc and web.API. Expose data in multiple formats using web.api Responsive design? Backbone.js? OData? Hosted on azure? Source on github Web sockets? A sync script loading</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5703618487402068938'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5703618487402068938'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5531191185059450880</id><published>2012-07-01T18:52:00.003+01:00</published><updated>2021-03-04T19:05:43.142Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='asp.net mvc'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='html helper'/><category scheme='http://www.blogger.com/atom/ns#' term='javascript'/><category scheme='http://www.blogger.com/atom/ns#' term='cassette'/><title type='text'>Optimally Serving Up JavaScript</title><content type='html'>&lt;p&gt;I have occasionally done some server-side JavaScript with Rhino and Node.js but this is the exception rather than the rule.  Like most folk at the moment, almost all the JavaScript I write is in a web context.&lt;/p&gt; &lt;p&gt;Over time I've come to adopt a roughly standard approach to how I structure my JavaScript; both the JavaScript itself and how it is placed / rendered in the an HTML document.  I wanted to write about the approach I'm using.  Partly just to document the approach but also because I often find writing about something crystalises my feelings on the subject in one way or another.  I think that most of what I'm doing is sensible and rational but maybe as I write about this I'll come to some firmer conclusions about my direction of travel.&lt;/p&gt; &lt;h4&gt;What are you up to?&lt;/h4&gt;&lt;p&gt;Before I get started it's probably worth mentioning the sort of web development I'm generally called to do (as this has obviously influenced my decisions).&lt;/p&gt; &lt;p&gt;Most of my work tends to be on web applications used internally within a company.  That is to say, web applications accessible on a Company intranet.  Consequently, the user base for my applications tends to be smaller than the Amazons and Googles of this world.  It almost invariably sits on the ASP.NET stack in some way.  Either classic WebForms or MVC.&lt;/p&gt; &lt;h4&gt;"Render first. JS second."&lt;/h4&gt;&lt;p&gt;I took 2 things away from &lt;a href="http://www.stevesouders.com/blog/2010/09/30/render-first-js-second/" target="_blank"&gt;Steve Souder's article&lt;/a&gt;:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;Async script loading is better than synchronous script loading&lt;/li&gt;&lt;li&gt;Get your screen rendered and *&lt;b&gt;then&lt;/b&gt;* execute your JavaScript&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;I'm not doing any async script loading as yet; although I am thinking of giving it a try at some point.  In terms of choosing a loader I'll probably give RequireJS first crack of the whip (purely as it looks like most people are tending it's direction and that can't be without reason).&lt;/p&gt; &lt;p&gt;However - it seems that the concept of async script loading is kind of conflict with one of the other tenets of web wisdom: script bundling.  Script bundling, if you're not already aware, is the idea that you should combine all your scripts into a single file and then just serve that.  This prevents multiple HTTP requests as each script loads in.  Async script loading is obviously okay with multiple HTTP requests, presumably because of the asynchronous non-blocking pattern of loading.  So.  2 different ideas.  And there's further movement on this front right now as &lt;a href="http://www.hanselman.com/blog/VisualStudio2012RCIsReleasedTheBigWebRollup.aspx" target="_blank"&gt;Microsoft are baking in script bundling to .NET 4.5&lt;/a&gt;.&lt;/p&gt; &lt;p&gt;Rather than divide myself between these 2 horses I have at the moment tried to follow the "JS second" part of this advice in my own (perhaps slightly old fashioned) way...&lt;/p&gt; &lt;h4&gt;I want to serve you...&lt;/h4&gt;&lt;p&gt;I have been making sure that scripts are the last thing served to the screen by using a customised version of &lt;a href="http://frugalcoder.us/post/2009/06/29/Handling-Scripts-in-ASPNet-MVC.aspx" target="_blank"&gt;Michael J. Ryan's HtmlHelper&lt;/a&gt;.  This lovely helper allows you to add script references as required from a number of different sources (layout page, view, partial view etc - even the controller if you so desired).  It's simple to control the ordering of scripts by allowing you to set a priority for each script which determines the render order.&lt;/p&gt; &lt;p&gt;Then as a final step before rendering the &lt;code&gt;&amp;lt;/body&amp;gt;&lt;/code&gt; tag the scripts can be rendered in one block.  By this point the web page is rendered visually and a marginal amount of blocking is, in my view, acceptable.&lt;/p&gt; &lt;p&gt;If anyone is curious - the class below is my own version of Michael's helper.  My contribution is the go faster stripes relating to the caching suffix and the ability to specify dependancies using script references rather than using numeric priority mechanism):&lt;/p&gt; &lt;script src="https://gist.github.com/3019159.js?file=ScriptExtensions.cs"&gt;&lt;/script&gt; &lt;h4 id="WebOptimization"&gt;Minification - I want to serve you less...&lt;/h4&gt; &lt;p&gt;Another tweak I made to the script helper meant that when compiling either the debug or production (minified) versions of common JS files will be included if available.   This means in a production environment the users get minified JS files so faster loading.  And in  a development environment we get the full JS files which make debugging more straightforward.&lt;/p&gt; &lt;p&gt;What I haven't started doing is minifying my own JS files as yet.  I know I'm being somewhat inconsistent here by sometimes serving minified files and sometimes not.  I'm not proud.  Part of my rationale for this that since most of my users use my apps on a daily basis they will for the most part be using cached JS files.  Obviously there'll be slightly slower load times the first time they go to a page but nothing that significant I hope.&lt;/p&gt; &lt;p&gt;I have thought of starting to do my own minification as a build step but have held off for now.  Again this is something being baked into .NET 4.5; another reason why I have held off doing this a different way for now.&lt;/p&gt; &lt;p style="font-weight:bold"&gt;Update&lt;/p&gt;&lt;p&gt;It now looks like this Microsofts optimisations have become &lt;a href="http://nuget.org/packages/Microsoft.AspNet.Web.Optimization" target="_blank"&gt;this Nuget package&lt;/a&gt;.  It's early days (well it was released on 15th August 2012 and I'm writing this on the 16th) but I think this looks not to be tied to MVC 4 or .NET 4.5 in which case I could use it in my current MVC 3 projects.  I hope so...&lt;/p&gt;&lt;p&gt;By the way there's a &lt;a href="http://www.pluralsight.com/training/Courses/TableOfContents/mvc4#mvc4-m3-optimization" target="_blank"&gt;nice rundown of how to use this by K. Scott Allen of Pluralsight&lt;/a&gt;.  It's fantastic.  Recommended.&lt;/p&gt;&lt;p style="font-weight:bold"&gt;Update 2&lt;/p&gt;&lt;p&gt;Having done a little asking around I now understand that this *&lt;b&gt;can&lt;/b&gt;* be used with MVC 3 / .NET 4.0.  Excellent!&lt;/p&gt;&lt;p&gt;One rather nice alternative script serving mechanism I've seen (but not yet used) is Andrew Davey's &lt;a href="http://getcassette.net" target="_blank"&gt;Cassette&lt;/a&gt; which I mean to take for a test drive soon.  This looks fantastic (and is available as a &lt;a href="http://nuget.org/packages/Cassette" target="_blank"&gt;Nuget package&lt;/a&gt; - 10 points!).&lt;/p&gt; &lt;h4&gt;CDNs (they want to serve you)&lt;/h4&gt;&lt;p&gt;I've never professionally made use of CDNs at all.  There are &lt;a href="http://encosia.com/3-reasons-why-you-should-let-google-host-jquery-for-you/" target="_blank"&gt;clearly good reasons why you should&lt;/a&gt; but most of those good reasons relate most to public facing web apps.&lt;/p&gt; &lt;p&gt;As I've said, the applications I tend to work on sit behind firewalls and it's not always guaranteed what my users can see from the grand old world of web beyond.  (Indeed what they see can change on hour by hour basis sometimes...)  Combined with that, because my apps are only accessible by a select few I don't face the pressure to reduce load on the server that public web apps can face.&lt;/p&gt; &lt;p&gt;So while CDN's are clearly a good thing.  I don't use them at present.  And that's unlikely to change in the short term.&lt;/p&gt; &lt;h4&gt;TL:DR&lt;/h4&gt;&lt;ol&gt;&lt;li&gt;I don't use CDNs - they're clearly useful but they don't suit my particular needs&lt;/li&gt;&lt;li&gt;I serve each JavaScript file individually just before the body tag.  I don't bundle.&lt;/li&gt;&lt;li&gt;I don't minify my own scripts (though clearly it wouldn't be hard) but I do serve the minified versions of 3rd party libraries (eg jQuery) in a Production environment.&lt;/li&gt;&lt;li&gt;I don't use async script loaders at present.  I may in future; we shall see.&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;I expect some of the above may change (well, possibly not point #1) but this general approach is working well for me at present.&lt;/p&gt; &lt;p&gt;I haven't touched at all on how I'm structuring my JavaScript code itself.  Perhaps next time.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5531191185059450880'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5531191185059450880'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2012/06/how-im-structuring-my-javascript-in-web.html' title='Optimally Serving Up JavaScript'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3952849617756384200</id><published>2012-06-29T18:46:00.004+01:00</published><updated>2012-06-29T18:46:55.717+01:00</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>function decl vs function expre</title><content type='html'>&lt;br /&gt;&lt;br /&gt; scrips hosted internally rather than cdn scripts decided on server not client    When it comes to code I'm a little OCD about structure.  I like it; and with good reason.  Well structured code is easier to maintain (I'm sure this isn't news to anyone).  To that end I always have a rough idea of how I like my code to hang together.  There's usually some kind of rationale behind the approaches I use and I try not to change approaches too drastically unless there is good reason for it.  This makes it easier to come back to code later; if the style is familiar there's less to ramp up on.&lt;br /&gt;&lt;br /&gt;But just lately I've been questioning a particular style I've adopted for JavaScript code and I'm thinking of making a change.  Even as I write this I'm not certain about the change; my hope is that putting down my thoughts will help me reach some kind of conclusion.&lt;br /&gt;&lt;br /&gt;&lt;h4&gt;How I structure my JavaScript in a web context&lt;/h4&gt;   bullied by jslint multiple vars hoisting  JavaScript: Function Declarations vs Expressions *or* What's a good function structure for your JS code?    I'm keen on &lt;code&gt;#region&lt;/code&gt; blocks to group together similar or related code in my C#.  With my JavaScript I tend to avoid having &lt;code&gt;&amp;lt;script&amp;gt;&lt;/code&gt; directly in a page; instead  &lt;br /&gt;&lt;br /&gt;&lt;span style="font-weight:bold"&gt;&lt;h4&gt;Why does this matter?&lt;/h4&gt;&lt;/span&gt;fdfjsdfjdkfsj&lt;br /&gt;&lt;br /&gt;&lt;pre class="brush: js"&gt;&lt;br /&gt;&lt;br /&gt;&lt;script src="/Scripts/Globalize/globalize.js" type="text/javascript"&gt;&lt;/script&gt;&lt;br /&gt;&lt;script src="/Scripts/Globalize/cultures/globalize.culture.de-DE.js" type="text/javascript"&gt;&lt;/script&gt;&lt;br /&gt;&lt;br /&gt;Globalize.culture("de-DE");&lt;br /&gt;&lt;br /&gt;Globalize.format(new Date(2012,4,6), "yyyy-MM-dd"); &lt;br /&gt;//"2012-05-06" - ISO 8601 format&lt;br /&gt;Globalize.format(new Date(2012,4,6), Globalize.culture().calendar.patterns.d); &lt;br /&gt;//"06.05.2012" - the standard German short date format of dd.MM.yyyy&lt;br /&gt;Globalize.format(4576.34, "n1");&lt;br /&gt;//"4.576,3" - a number rendered to 1 decimal place&lt;br /&gt;&lt;br /&gt;&lt;/pre&gt;  http://javascriptweblog.wordpress.com/2010/07/06/function-declarations-vs-function-expressions/</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3952849617756384200'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3952849617756384200'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2668781904855053409</id><published>2012-06-29T16:51:00.001+01:00</published><updated>2012-06-29T16:51:22.447+01:00</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>ScriptExtensions.cs NEW</title><content type='html'>using System; using System.Collections.Generic; using System.Linq; using System.Web; using System.Web.Mvc; using System.IO; using System.Text;  namespace LNRCorporate.CommonWeb.Helpers {     /// &lt;summary&gt;    /// Author      : John Reilly     /// Description : MVC HtmlHelper extension methods - html element extensions     ///      /// This helper makes creation of script tags within a view straightforward.     /// If the specified file is missing an error is raised at runtime.  A v= suffix     /// is added to URLs using the VersionHelper to make caching behave as desired     /// both during development (where we don't want to cache as we make changes to code)     /// and during production (where we do want to cache to improve the user loading experience)     ///      /// There are 2 approaches available using this helper.     ///      /// 1. Straight script tag creation using the Script method.     ///      /// A usage of:     ///      /// @Html.Script("~/Scripts/jquery.tools.min.js")     ///      /// Would immediatedly render a tag as below: (please note the v= suffix to the URL)     ///      /// &lt;script src="/Scripts/jquery.tools.min.js?v=634765611410213405" type="text/javascript"&gt;&lt;/script&gt;    ///      /// 2. Script bundling     ///      /// This approach allows you to build up the scripts to be rendered across multiple     /// views / partial views / layout etc and then have them rendered in one hit (ideally     /// just prior to the body tag being rendered as at this point the screen will be visually     /// set up for the user and any script loading that causes blocking should not be a presentational     /// issue). This is heavily based on Michael Ryans work; see links below.     ///      /// [Links]     /// http://frugalcoder.us/post/2009/06/29/Handling-Scripts-in-ASPNet-MVC.aspx     /// http://stackoverflow.com/questions/5598167/mvc3-need-help-with-html-helper     ///      /// [Usage]     /// --- From each view / partial view ---     /// @Html.AddClientScript("~/Scripts/jquery.js")     /// @Html.AddClientScript("~/Scripts/jquery-ui.js")     /// @Html.AddClientScript("~/Scripts/site.js")     /// @Html.AddClientScript("~/Scripts/views/myview.js")     ///      /// --- From the main Master/View (just before last Body tag so all "registered" scripts are included) ---     /// @Html.ClientScripts()     /// &lt;/summary&gt;    public static class ScriptExtensions     {         #region Public          /// &lt;summary&gt;        /// Render a Script element given a URL         /// &lt;/summary&gt;        /// &lt;param name="helper"&gt;&lt;/param&gt;        /// &lt;param name="url"&gt;URL of script to render&lt;/param&gt;        /// &lt;returns&gt;&lt;/returns&gt;        public static MvcHtmlString Script(           this HtmlHelper helper,           string url)         {             return MvcHtmlString.Create(MakeScriptTag(helper, url));         }          /// &lt;summary&gt;        /// Add client script files to list of script files that will eventually be added to the view         /// &lt;/summary&gt;        /// &lt;param name="scriptPath"&gt;path to script file&lt;/param&gt;        /// &lt;param name="priority"&gt;priority of script 1-10 (1=highest, 10=lowest, default=5)&lt;/param&gt;        /// &lt;returns&gt;always MvcHtmlString.Empty&lt;/returns&gt;        public static MvcHtmlString AddClientScript(this HtmlHelper helper, string scriptPath, int priority = 5)         {             //Ensure priority is between 1 and 10             if (priority &gt; 10)                 priority = 10;             else if (priority &lt; 1)                 priority = 10;              var scripts = helper.ViewContext.HttpContext.Items["client-script-list"] as Dictionary&lt;string, KeyValuePair&lt;string, int&gt;&gt; ?? new Dictionary&lt;string, KeyValuePair&lt;string, int&gt;&gt;();              //Ensure scripts are not added twice             var scriptFilePath = GetScriptFilePath(helper, scriptPath);             var fi = new FileInfo(scriptFilePath);             if (scripts.ContainsKey(fi.FullName))             {                 //If attempting to add a script which has already been added but with a lower (and hence more important) priority then ensure that existing script entry has its priority changed                 if (scripts[fi.FullName].Value &gt; priority)                     scripts[fi.FullName] = new KeyValuePair&lt;string, int&gt;(scriptPath, priority);                  return MvcHtmlString.Empty;             }              //Add script to collection of scripts and save it away             scripts.Add(fi.FullName, new KeyValuePair&lt;string, int&gt;(scriptPath, priority));             helper.ViewContext.HttpContext.Items["client-script-list"] = scripts;              return MvcHtmlString.Empty;         }          /// &lt;summary&gt;        /// Add client script block to list of script blocks that will eventually be added to the view         /// &lt;/summary&gt;        /// &lt;param name="key"&gt;unique identifier for script block&lt;/param&gt;        /// &lt;param name="scriptBlock"&gt;script block&lt;/param&gt;        /// &lt;param name="priority"&gt;priority of script block 1-10 (1=highest, 10=lowest, default=5)&lt;/param&gt;        /// &lt;returns&gt;always MvcHtmlString.Empty&lt;/returns&gt;        public static MvcHtmlString AddClientScriptBlock(this HtmlHelper helper, string key, string scriptBlock, int priority = 5)         {             //Ensure priority is between 1 and 10             if (priority &gt; 10)                 priority = 10;             else if (priority &lt; 1)                 priority = 10;              var scriptBlocks = helper.ViewContext.HttpContext.Items["client-script-block-list"] as Dictionary&lt;string, KeyValuePair&lt;string, int&gt;&gt; ?? new Dictionary&lt;string, KeyValuePair&lt;string, int&gt;&gt;();              //Prevent duplication             if (scriptBlocks.ContainsKey(key)) return MvcHtmlString.Empty;              helper.ViewContext.HttpContext.Items["client-script-block-list"] = scriptBlocks;             scriptBlocks.Add(key, new KeyValuePair&lt;string, int&gt;(scriptBlock, priority));              return MvcHtmlString.Empty;         }          /// &lt;summary&gt;        /// Add a script tag for each "registered" script associated with the current view.         /// Output script tags in order of priority 1- 10         /// &lt;/summary&gt;        /// &lt;returns&gt;MvcHtmlString&lt;/returns&gt;        public static MvcHtmlString ClientScripts(this HtmlHelper helper)         {             var url = new UrlHelper(helper.ViewContext.RequestContext, helper.RouteCollection);             var scripts = helper.ViewContext.HttpContext.Items["client-script-list"] as Dictionary&lt;string, KeyValuePair&lt;string, int&gt;&gt; ?? new Dictionary&lt;string, KeyValuePair&lt;string, int&gt;&gt;();              //Build script tag block             var sb = new StringBuilder();             if (scripts.Count &gt; 0)             { #if DEBUG                 sb.AppendLine("&lt;!-- BEGIN - HtmlHelperScriptExtensions.ClientScripts() --&gt;"); #endif                 for (int i = 1; i &lt;= 10; i++)                 {                     scripts.Where(s =&gt; s.Value.Value == i)                            .Select(s =&gt; s.Value.Key) //We're only interested in scripts which have the priority of the key values value                            .ToList()                            .ForEach(s =&gt; sb.AppendLine(MakeScriptTag(helper, s))); //Add a script tag for each script                 } #if DEBUG                 sb.Append("&lt;!-- END - HtmlHelperScriptExtensions.ClientScripts() --&gt;"); #endif             }              //Output script tag block at point in view where method is called (by returning an MvcHtmlString)             return (sb.Length &gt; 0 ? MvcHtmlString.Create(sb.ToString()) : MvcHtmlString.Empty);         }          /// &lt;summary&gt;        /// Output all "registered" script blocks associated with the current view.         /// Output in order of priority 1- 10         /// &lt;/summary&gt;        /// &lt;returns&gt;MvcHtmlString&lt;/returns&gt;        public static MvcHtmlString ClientScriptBlocks(this HtmlHelper helper)         {             var url = new UrlHelper(helper.ViewContext.RequestContext, helper.RouteCollection);             var scripts = helper.ViewContext.HttpContext.Items["client-script-block-list"] as Dictionary&lt;string, KeyValuePair&lt;string, int&gt;&gt; ?? new Dictionary&lt;string, KeyValuePair&lt;string, int&gt;&gt;();              //Build script blocks section             var sb = new StringBuilder();             if (scripts.Count &gt; 0)             { #if DEBUG                 sb.AppendLine("&lt;!-- BEGIN - HtmlHelperScriptExtensions.ClientScriptBlocks() --&gt;"); #endif                 for (int i = 1; i &lt;= 10; i++)                 {                     scripts.Where(s =&gt; s.Value.Value == i)                            .Select(s =&gt; s.Value.Key) //We're only interested in script blocks which have the priority of the key values value                            .ToList()                            .ForEach(s =&gt; sb.AppendLine(string.Format("&lt;script type=\"text/javascript\"&gt;{0}{1}&lt;/script&gt;", Environment.NewLine, s))); //Add a script tag for each script block                 } #if DEBUG                 sb.Append("&lt;!-- END - HtmlHelperScriptExtensions.ClientScriptBlocks() --&gt;"); #endif             }              //Output script blocks section at point in view where method is called (by returning an MvcHtmlString)             return (sb.Length &gt; 0 ? MvcHtmlString.Create(sb.ToString()) : MvcHtmlString.Empty);         }                  /// &lt;summary&gt;        /// Take a URL, resolve it and a version suffix.  In Debug this will be based on DateTime.Now to prevent caching          /// on a development machine.  In Production this will be based on the version number of the appplication.         /// This means when the version number is incremented in subsequent releases script files should be recached automatically.         /// &lt;/summary&gt;        /// &lt;param name="helper"&gt;&lt;/param&gt;        /// &lt;param name="url"&gt;URL to resolve and add suffix to&lt;/param&gt;        /// &lt;returns&gt;&lt;/returns&gt;        public static string ResolveUrlWithVersion(HtmlHelper helper, string url)         { #if DEBUG             var suffix = DateTime.Now.Ticks.ToString(); #else             var suffix = VersionHelper.CurrentVersion; #endif              var urlWithVersionSuffix = string.Format("{0}?v={1}", url, suffix);             var urlResolved = new UrlHelper(helper.ViewContext.RequestContext, helper.RouteCollection).Content(urlWithVersionSuffix);              return urlResolved;         }          #endregion          #region Private          /// &lt;summary&gt;        /// Create the string that represents a script tag         /// &lt;/summary&gt;        /// &lt;param name="helper"&gt;&lt;/param&gt;        /// &lt;param name="url"&gt;&lt;/param&gt;        /// &lt;returns&gt;&lt;/returns&gt;        private static string MakeScriptTag(HtmlHelper helper, string url)         {             GetScriptFilePath(helper, url);              //Render script tag             var scriptTag = new TagBuilder("script");             scriptTag.Attributes["type"] = "text/javascript"; //This isn't really required with HTML 5 as this is the default.  As it does no real harm so I have left it for now. http://stackoverflow.com/a/9659074/761388             scriptTag.Attributes["src"] = SharedExtensions.ResolveUrlWithVersion(helper, url);              var scriptTagString = scriptTag.ToString();             return scriptTagString;         }          /// &lt;summary&gt;        /// Author      : John Reilly         /// Description : Get the script file path on the server - throw an exception if it doesn't exist         /// &lt;/summary&gt;        /// &lt;param name="helper"&gt;&lt;/param&gt;        /// &lt;param name="url"&gt;&lt;/param&gt;        /// &lt;returns&gt;&lt;/returns&gt;        private static string GetScriptFilePath(HtmlHelper helper, string url)         {             var scriptFilePath = helper.ViewContext.HttpContext.Server.MapPath(url);              //Throw an exception if there is no file with the supplied path - presumably the page won't work without it             if (!File.Exists(scriptFilePath)) throw new FileNotFoundException("Unable to render Script as " + scriptFilePath + " file does not exist");              return scriptFilePath;         }          #endregion     } }</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2668781904855053409'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2668781904855053409'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1602685019641268</id><published>2012-06-13T10:44:00.000+01:00</published><updated>2012-06-13T10:44:49.909+01:00</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>ValidationExtensions.cs</title><content type='html'>/* @Html.ValidationDialog(id: "ValidationDialog", minHeight: 200) */  using Commerzbank.Pcs.Web.Gui.Shared; using System.Web.Mvc;  namespace Commerzbank.Pcs.Web.Helpers {   /// &lt;summary&gt;  /// MVC HtmlHelper extension methods - html element extensions   /// &lt;/summary&gt;  public static class ValidationExtensions   {     /// &lt;summary&gt;    /// Render a Validation Dialog     /// &lt;/summary&gt;    /// &lt;param name="helper"&gt;&lt;/param&gt;    /// &lt;param name="id"&gt;&lt;/param&gt;    /// &lt;param name="htmlAttributes"&gt;&lt;/param&gt;    /// &lt;param name="cssClass"&gt;&lt;/param&gt;    /// &lt;param name="minHeight"&gt;&lt;/param&gt;    /// &lt;param name="validationDialogTitle"&gt;&lt;/param&gt;    /// &lt;param name="headerMessage"&gt;&lt;/param&gt;    /// &lt;returns&gt;&lt;/returns&gt;    public static MvcHtmlString ValidationDialog(this HtmlHelper helper, string id,        object htmlAttributes = null,       string cssClass = null, int? minHeight = null, //string okButtonCssClass = null,        string validationDialogTitle = null, string headerMessage = null)     {       //Render div container       var container = new TagBuilder("div");       container.Attributes["id"] = id;       container.Attributes["style"] = "display:none;"; //Validation dialog is initially hidden so the user doesn't see the "flash" as        container.Attributes["data-title"] = string.IsNullOrEmpty(validationDialogTitle) ? "Validation errors" : validationDialogTitle;       container.Attributes["data-caption-ok"] = SharedLib.GetResourceString("BUTTON_OK");       container.Attributes["data-min-height"] = minHeight.HasValue ? minHeight.Value.ToString() : "150";       if (htmlAttributes != null) container.MergeAttributes(HtmlHelper.AnonymousObjectToHtmlAttributes(htmlAttributes)); //Merge any passed in attributes        //Render span which is the header message above the error messages       var span = new TagBuilder("span");       span.InnerHtml = string.IsNullOrEmpty(headerMessage) ? "Please correct the following:" : headerMessage;       span.Attributes["class"] = string.IsNullOrEmpty(cssClass) ? "validationDialog" : cssClass;       container.InnerHtml += MvcHtmlString.Create(span.ToString());        //Render ul - this will contain error messages       var ul = new TagBuilder("ul");       ul.Attributes["class"] = string.IsNullOrEmpty(cssClass) ? "validationDialog" : cssClass;       container.InnerHtml += MvcHtmlString.Create(ul.ToString());              //Render validation related scripts       helper.AddClientScript(SharedLib.ScriptPath + "ValidationDialog-1.0.1.js");       helper.AddClientScript(SharedLib.UrljQueryValidate, 7);       helper.AddClientScript(SharedLib.UrljQueryValidateUnobtrusive, 7);       helper.AddClientScript(SharedLib.UrljQueryValidateUnobtrusivePCS, 7);       //A library which overrides part of the functionality of UrljQueryValidateUnobtrusive to add PCS specific behaviour       helper.AddClientScript(SharedLib.UrljQueryValidateUnobtrusiveExtension, 8); //PCS extension allowing dynamic inputs to be wired up for validation              return MvcHtmlString.Create(container.ToString());     }   } }</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1602685019641268'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1602685019641268'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6543844987056952385</id><published>2012-06-12T14:20:00.001+01:00</published><updated>2012-06-12T14:20:27.525+01:00</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Simple ActionFilter - though probably not the best example for unit testing reasons</title><content type='html'>I noticed that certain pieces of ViewBag data are used in all rendered views in IRIS.  For instance @ViewBag.UserFullName is used in _Layout.cshtml and consequently needs to be implemented for any view that uses it (ie all views at present).  To save on repeating ourselves Ive introduced the ViewBagCommonDataAttribute which is an ActionFilterAttribute.  This action filter executes during each call in the MVC pipeline and populates the ViewBag with common data (eg ViewBag.UserFullName).  Ive also added UserFullName to the UserSession object and amended our processing so this is populated just the once and at the same time as the UserName / UserID properties.   This should improve performance as were not hitting the UserDetailsRepository on every request now; only during initialisation (and since a users name is unlikely to ever change thats probably a safe assumption ).  Ive stored the ViewBagCommonDataAttribute in CommonWeb/ActionFilters as I imagine this could be useful in other situations as well.  To use it you just need to add filters.Add(new ViewBagCommonDataAttribute()); to the RegisterGlobalFilters method.    An alternative approach to using an action filter would have been to implement this within perhaps the Initialize method of BaseController.  We could switch to this very simply if required.        /// &lt;summary&gt;    /// ActionFilter which populates the ViewBag with common data (data used on all / most screens)     /// &lt;/summary&gt;    public class ViewBagCommonDataAttribute : ActionFilterAttribute     {         public override void OnActionExecuting(ActionExecutingContext filterContext)         {             base.OnActionExecuting(filterContext);              //Only set viewbag data if not a child action and not an AJAX request              //(These ViewBag properties are only used when rendering a full page)             if ((!filterContext.IsChildAction) &amp;&amp;                 (!filterContext.RequestContext.HttpContext.Request.IsAjaxRequest()))             {                 //Get ViewBag and cast controller as BaseController                 var viewBag = filterContext.Controller.ViewBag;                 var baseController = (BaseController)filterContext.Controller;                  //Set ViewBag properties used by all                  viewBag.UserName = baseController.CurrentUserSession.UserName;                 viewBag.UserFullName = baseController.CurrentUserSession.UserFullName;             }         }     }           public static void RegisterGlobalFilters(GlobalFilterCollection filters)         {             filters.Add(new HandleErrorAttribute());             filters.Add(new ViewBagCommonDataAttribute());         }</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/6543844987056952385'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/6543844987056952385'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4354684245272460017</id><published>2012-06-04T07:50:00.002+01:00</published><updated>2021-03-05T18:02:49.746Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Reasons to be Cheerful (why now is a good time to be a dev)</title><content type='html'>I've been a working as a developer in some way, shape or form for just over 10 years now.  And it occurred to me the other day that I can't think of a better time to be a software developer than &lt;u&gt;right now&lt;/u&gt;.  This year was better than last year.  Last year was better than the year before.  This is a happily recurring theme.&lt;br /&gt;&lt;br /&gt;So why?  Well I guess there are a whole host of reasons; this is my effort to identify just some of them...&lt;br /&gt;&lt;br /&gt;&lt;h4&gt;Google and the World Wide Web (other search providers are available)&lt;/h4&gt;When I first started out as a humble Delphi developer back in 1999 learning was not the straightforward proposition it is today.  If you want to know how to do something these days a good place to start is firing up your browser and putting your question into Google.  If I was to ask the question &lt;i&gt;"how do I use AJAX"&lt;/i&gt; of a search engine 10 years ago and now I would see very different things.&lt;br /&gt;&lt;br /&gt;&lt;div class="separator" style="clear: both; text-align: center;"&gt;&lt;a href="http://3.bp.blogspot.com/-3RqAJbKowtI/T8n2YaF-QoI/AAAAAAAAAOc/WGE0RScKX0o/s1600/AJAX%2Bbleach.jpg" imageanchor="1" style="margin-left:1em; margin-right:1em"&gt;&lt;img border="0" height="83" width="160" src="http://3.bp.blogspot.com/-3RqAJbKowtI/T8n2YaF-QoI/AAAAAAAAAOc/WGE0RScKX0o/s320/AJAX%2Bbleach.jpg" /&gt;&lt;/a&gt;&lt;a href="http://2.bp.blogspot.com/-R5WNmZ8ZKUM/T8n2YIh-RUI/AAAAAAAAAOQ/SsYNDiepSLo/s1600/AJAX%2Bsearch%2Bresults.png" imageanchor="1" style="margin-left:1em; margin-right:1em"&gt;&lt;img border="0" height="140" width="160" src="http://2.bp.blogspot.com/-R5WNmZ8ZKUM/T8n2YIh-RUI/AAAAAAAAAOQ/SsYNDiepSLo/s320/AJAX%2Bsearch%2Bresults.png" /&gt;&lt;/a&gt;&lt;/div&gt;On the left the past, on the right the present.  Do try not to let the presence of W3Schools in the search results detract... And also best ignore that the term AJAX wasn't coined until 2006...&lt;br /&gt;&lt;br /&gt;What I'm getting at is that finding out information these days is can be done really quickly. Excellent search engines are now the norm.  Back when I started out this was not the case and you were essentially reliant on what had been written down in books and the kindliness of more experienced developers.  Google (and others like them) have done us a great service.  They've made it easier to learn.&lt;br /&gt;&lt;br /&gt;&lt;h4&gt;Blogs / Screencasts / Training websites&lt;/h4&gt;Something else that has made it easier to learn is the rise and rise of blogs, screencasts and training websites.  Over the last 5 years the internet has been filling up with people writing blogs talking about tools, techniques and approaches they are using.  When you're searching for advice on how to do something you can pretty much guarantee these days that some good soul will have written about it already.  The most generous devs out there have gone a step further producing screencasts demonstrating them coding and sharing it with the world *&lt;b&gt;for free&lt;/b&gt;*.  See an example from the ever awesome Rebecca Murphey below:&lt;br /&gt;&lt;br /&gt;&lt;iframe src="http://player.vimeo.com/video/20457625" width="500" height="281" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen&gt;&lt;/iframe&gt;&lt;br /&gt;&lt;br /&gt;Similarly, there are now a number of commercially available screencasts which  make it really easy to ramp up and learn.  There's &lt;a href="http://tekpub.com/" target="_blank"&gt;TekPub&lt;/a&gt;, there's &lt;a href="http://www.pluralsight-training.net" target="_blank"&gt;Pluralsight&lt;/a&gt; (who have massively improved my commute with their mobile app by the way).  All of these help tug away the curtain away from the software development Wizard of Oz.  All this is a very wonderful thing indeed!&lt;br /&gt;&lt;br /&gt;&lt;h4&gt;Podcasts&lt;/h4&gt;If you're a Boogie Down Productions fan then you may be aware of the concept of &lt;a href="http://en.wikipedia.org/wiki/Edutainment_(album)" target="_blank"&gt;Edutainment&lt;/a&gt;.  That is to say, the bridge that can exist between entertainment and education.  This is what I've found podcasts to be.  I listen to a lot.  &lt;a href="http://www.hanselminutes.com/" target="_blank"&gt;Hanselminutes&lt;/a&gt;. &lt;a href="http://herdingcode.com/" target="_blank"&gt;Herding Code&lt;/a&gt;. &lt;a href="http://javascriptjabber.com/" target="_blank"&gt;JavaScript Jabber&lt;/a&gt;. &lt;a href="http://javascriptshow.com/" target="_blank"&gt;The JavaScript Show&lt;/a&gt;. &lt;a href="http://jesseliberty.com/podcast/" target="_blank"&gt;Yet Another Podcast&lt;/a&gt;.  There's more.&lt;br /&gt;&lt;br /&gt;There's something wonderful about about listening to other developers who are passionate about what they are doing. Interested in their work.  Enthusiastic about their projects.  It's infectious.  It makes you want to grab a keyboard and start trying things out.  I can't imagine I'm the only dev that feels this way.&lt;br /&gt;&lt;br /&gt;And of course I couldn't fail to mention my favourite podcast: &lt;a href="http://www.thisdeveloperslife.com/" target="_blank"&gt;This Developer's Life&lt;/a&gt;.  Put together by Scott Hanselman and Rob Conery (I love these guys by the way), and inspired by &lt;a href="http://www.thisamericanlife.org/" target="_blank"&gt;This American Life&lt;/a&gt;, this show tells some of the stories experienced by developers.  It gives an insight into what it's like to be a developer. This podcast is more entertaining than educational but it's absolutely *&lt;b&gt;fantastic&lt;/b&gt;*.&lt;br /&gt;&lt;br /&gt;&lt;h4&gt;JavaScript (and HTML and CSS too)&lt;/h4&gt;All of the above have eased the learning path of developers and made it easier to keep in touch with the latest and greatest happenings in the dev world.  Along with this there has, in my opinion, also been something of a unifying of purpose in the developer community of late.  I attribute this to JavaScript, HTML and CSS.&lt;br /&gt;&lt;br /&gt;Back when I started out it seemed much more the case that developers were split into different tribes.  There was the Delphi tribe, the Visual Basic tribe, the C++ tribe, the Java tribe (very much the "hip young gunslingers" tribe back then - I guess these days it'd be the Node.JS guys) as well as many others.  And each tribe more or less seemed to keep themselves to themselves.  This wasn't malicious that I could tell; that just seemed to be the way it was.&lt;br /&gt;&lt;br /&gt;But shortly after I started out the idea of the web application took off in a major way.  I was involved in this coming from the position of being an early adopter of ASP.NET (which I used, and loved, since it was first in beta).  Many other web application technologies were available; JSP, PHP, Perl and the like.  But what they all had in common was this: they all pumped out HTML and CSS to the user.  Suddenly all these developers from subtly different backgrounds were all targeting the same technology for their GUI.&lt;br /&gt;&lt;br /&gt;This unifying effect has been *&lt;b&gt;massively&lt;/b&gt;* reinforced by JavaScript.  Whereas HTML is a markup language, JavaScript is a programming language.  And more by accident than grand design JavaScript has kind of become the &lt;a href="http://www.hanselman.com/blog/JavaScriptIsAssemblyLanguageForTheWebPart2MadnessOrJustInsanity.aspx" target="_blank"&gt;VM of the web&lt;/a&gt;.  Given the rise and rise of the rich web client (driven onwards and upwards by the popularity of AJAX, Backbone.JS etc) this has meant that devs of all creeds and colours have been forced to pitch a tent on the same patch of dirt.  Pretty much all of the tribes now have an embassy in JavaScript land.&lt;br /&gt;&lt;br /&gt;So there are all these devs out there who are used to working with different server-side technologies from each other.  But when it comes to the client, we are all sharing the common language of JavaScript.  To a certain extent we're all creating data services that just pump out JSON to the client.  Through forums like &lt;a href="http://stackoverflow.com/" target="_blank"&gt;StackOverflow&lt;/a&gt; devs of all the tribes are helping each other with web client "stuff".  They're all interacting in ways that they probably wouldn't otherwise if the web client environment was as diverse as the server-side environment...&lt;br /&gt;&lt;br /&gt;&lt;h4&gt;The Browser Wars Begin Again&lt;/h4&gt;Didn't things seem a little dull around 2003/2004?  IE 6 had come out 3 years previously and had vanquished all comers.  Microsoft was really the only game in town browser-wise.  Things had stopped changing; it seemed like browsers were "done".  You know, good enough and there was no need to take things any further.&lt;br /&gt;&lt;br /&gt;Then came Firefox.  This lone browser appeared as an alternative to might of IE.  I must admit the thing that first attracted me to Firefox was the fact it had tabs.  I mean technically I knew Firefox was more secure than IE but honestly it was the tabs that attracted me in the first place.  (This may offer some insight as to why so many people still smoke...)&lt;br /&gt;&lt;br /&gt;And somehow Firefox managed to jolt Microsoft out of it's inertia on the web.  Microsoft started caring about IE again.  (Not enough until quite recently in my book but you've got to start somewhere.)  I'm a firm believer that change for it's own sake can often be a good thing.  Change makes you think about why you do what you do and wonder if there might be better approaches that could be used instead.  And these changes kind of feed into...&lt;br /&gt;&lt;br /&gt;&lt;h4&gt;...HTML 5!&lt;/h4&gt;That's right HTML 5 which is all about change. It's taking HTML as we know and love it and bolting on new stuff.  New elements (canvas), new styling (CSS 3), new JavaScript APIs, faster JavaScript engines, support for JavaScript 5.  The list goes on...&lt;br /&gt;&lt;br /&gt;And all this new stuff is exciting, whizzy, fun to play with.  That which wasn't possible yesterday is possible now.  Playing with new toys is half the fun of being a dev.  There's a lot of new toys about right now.&lt;br /&gt;&lt;br /&gt;&lt;h4&gt;The Feeling of Possibilites&lt;/h4&gt;This is what it comes down to I think.  It's so easy to learn these days and there's so much to learn about.&lt;br /&gt;&lt;br /&gt;Right now lots of things are happening above and beyond what I've mentioned above.  Open source has come of age and gone mainstream.  Github is with us.  Google are making contentious forays into new languages with Dart and Native Client.  Microsoft aren't remotely evil empire-like these days; they've made .NET like a Swiss army knife.  You can even run Node.js on IIS these days!  Signal-R, Websockets, Coffeescript, JS.Next, Backbone.JS, Entity Framework, LINQ, the mobile web, ASP.NET MVC, Razor, Knockout.JS, the cloud, Windows Azure...&lt;br /&gt;&lt;br /&gt;So much is happening right now.  People are making things.  It's a very interesting time to be a dev. There are many reasons to be cheerful. </content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4354684245272460017'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4354684245272460017'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2012/06/reasons-to-be-cheerful-why-now-is-good.html' title='Reasons to be Cheerful (why now is a good time to be a dev)'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='http://3.bp.blogspot.com/-3RqAJbKowtI/T8n2YaF-QoI/AAAAAAAAAOc/WGE0RScKX0o/s72-c/AJAX%2Bbleach.jpg' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1005778596094911145</id><published>2012-05-30T14:45:00.000+01:00</published><updated>2012-05-30T14:46:05.100+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Dad Didn't Buy Any Games</title><content type='html'>Inspired by &lt;a href="http://www.hanselman.com/blog/SheLetMeTakeTheComputerHomeHowDidYouGetStartedInComputersAndProgramming.aspx" target="_blank"&gt;Hanselmans post on how he got started in programming&lt;/a&gt; I thought I'd shared my own tale about how it all began...&lt;br /&gt;&lt;br /&gt;I grew up the 80's just outside London.  For those of you of a different vintage let me paint a picture.  These were the days when "Personal Computers", as they were then styled, were taking the world by storm.  Every house would be equipped with either a ZX Spectrum, a Commodore 64 or an Amstrad CPC.  These were 8 bit computers which were generally plugged into the family television and spent a good portion of their time loading games like &lt;a href="http://en.wikipedia.org/wiki/Target:_Renegade" target="renegade"&gt;Target: Renegade&lt;/a&gt; from an audio cassette.&lt;br /&gt;&lt;br /&gt;But not in our house; we didn't have a computer.  I remember mournfully pedalling home from friends houses on a number of occasions, glum as I compared my lot with theirs.  Whereas my friends would be spending their evenings gleefully battering their keyboards as they thrashed the life out of various end-of-level bosses I was reduced to *&lt;b&gt;wasting&lt;/b&gt;* my time reading.  That's right Enid Blyton - you were second best in my head.&lt;br /&gt;&lt;br /&gt;Then one happy day (and it may have been a Christmas present although I'm not certain) our family became the proud possessors of an &lt;a href="http://en.wikipedia.org/wiki/Amstrad_CPC" target="_blank"&gt;Amstrad CPC 6128&lt;/a&gt;:&lt;br /&gt;&lt;br /&gt;&lt;div class="separator" style="clear: both; text-align: center;"&gt;&lt;a href="http://1.bp.blogspot.com/-qDxpzoTqtSw/T8YemIrY8OI/AAAAAAAAANo/2tsumG-GKWc/s1600/CPC6128.jpg" imageanchor="1" style="margin-left:1em; margin-right:1em"&gt;&lt;img border="0" height="201" width="320" src="http://1.bp.blogspot.com/-qDxpzoTqtSw/T8YemIrY8OI/AAAAAAAAANo/2tsumG-GKWc/s320/CPC6128.jpg" /&gt;&lt;/a&gt;&lt;/div&gt;Glory be!  I was going to play so many games!  I would have such larks!  My evenings would be filled with pixelated keyboard related destruction!  Hallelujah!!&lt;br /&gt;&lt;br /&gt;But I was wrong.  I had reckoned without my father.  For reasons that I've never really got to the bottom of Dad had invested in the computer but not in the games.  Whilst I was firmly of the opinion that these 2 went together like Lennon and McCartney he was having none of it.  "You can write your own son" he intoned and handed over a manual which contained listings for games:&lt;br /&gt;&lt;br /&gt;&lt;div class="separator" style="clear: both; text-align: center;"&gt;&lt;a href="http://4.bp.blogspot.com/-1qdF1TnvOFI/T8YgSRNeyAI/AAAAAAAAAN0/6qcDSzDXFd0/s1600/6a0120a85dcdae970b0120a86ddeee970b.png" imageanchor="1" style="margin-left:1em; margin-right:1em"&gt;&lt;img border="0" height="320" width="241" src="http://4.bp.blogspot.com/-1qdF1TnvOFI/T8YgSRNeyAI/AAAAAAAAAN0/6qcDSzDXFd0/s320/6a0120a85dcdae970b0120a86ddeee970b.png" /&gt;&lt;/a&gt;&lt;br /&gt;It wasn't this - but it wasn't much different&lt;/div&gt;&lt;br /&gt;And that's where it first began really.  I would spend my evenings typing the Locomotive Basic listings for computer games into the family computer.  Each time I started I would be filled with great hopes for what might result.  Each time I tended to be rewarded with something that looked a bit like this:&lt;br /&gt;&lt;br /&gt;&lt;div class="separator" style="clear: both; text-align: center;"&gt;&lt;a href="http://2.bp.blogspot.com/-0VfRAk8gwNY/T8Yhz1zK1eI/AAAAAAAAAOA/dYKTsRTYdoM/s1600/images.jpg" imageanchor="1" style="margin-left:1em; margin-right:1em"&gt;&lt;img border="0" height="188" width="268" src="http://2.bp.blogspot.com/-0VfRAk8gwNY/T8Yhz1zK1eI/AAAAAAAAAOA/dYKTsRTYdoM/s320/images.jpg" /&gt;&lt;/a&gt;&lt;br /&gt;Frankly I prefer Double Dragon....&lt;/div&gt;&lt;br /&gt;I'm not sure that it's possible to learn to program by osmosis but if it is I'm definitely a viable test case.  I didn't become an expert Locomotive Basic programmer (was there ever such a thing?) but I did undoubtedly begin my understanding of software....  Thanks Dad!&lt;br /&gt;&lt;br /&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1005778596094911145'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1005778596094911145'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2012/05/dad-didnt-buy-any-games.html' title='Dad Didn&apos;t Buy Any Games'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='http://1.bp.blogspot.com/-qDxpzoTqtSw/T8YemIrY8OI/AAAAAAAAANo/2tsumG-GKWc/s72-c/CPC6128.jpg' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3150566258510858390</id><published>2012-05-22T11:14:00.000+01:00</published><updated>2012-05-22T11:14:20.930+01:00</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>jsTree.cs</title><content type='html'>using Commerzbank.PCS.Data; using System; using System.Collections; using System.Collections.Generic; using System.Xml; using System.Xml.XPath; using System.Web.Script.Serialization;  namespace Commerzbank.PCS.Web.Shared {   public class jsTreeNode   {     /* - alternate approach - commented out as not used for now     /// &lt;summary&gt;    /// Title of Node (ie visible text)     /// &lt;/summary&gt;    public string data;     */      /// &lt;summary&gt;    /// Data of node (including title)     /// &lt;/summary&gt;    public jsTreeData data;          /// &lt;summary&gt;    /// omit "attr" if not needed; the "attr" object gets passed to the jQuery "attr" function      /// &lt;/summary&gt;    public Dictionary&lt;string, string&gt; attr;       /// &lt;summary&gt;    /// Can be "closed" or "open"     /// &lt;/summary&gt;    public string state = "open";      /// &lt;summary&gt;    /// An array of child nodes objects      /// &lt;/summary&gt;    public List&lt;jsTreeNode&gt; children = null;   }    public class jsTreeData   {     /// &lt;summary&gt;    /// The node title     /// &lt;/summary&gt;    public string title;      /// &lt;summary&gt;    /// omit "attr" if not needed; the "attr" object gets passed to the jQuery "attr" function      /// &lt;/summary&gt;    public Dictionary&lt;string, string&gt; attr;           /// &lt;summary&gt;    /// if "icon" contains a slash / it is treated as a file, used for background     ///  otherwise - it is added as a class to the &lt;ins&gt; node     /// &lt;/summary&gt;    public string icon = "folder";   } }</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3150566258510858390'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3150566258510858390'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3766809831025953251</id><published>2012-05-22T10:24:00.000+01:00</published><updated>2012-05-22T10:24:02.176+01:00</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Example of how to use jsTree.aspx.cs</title><content type='html'>using Commerzbank.PCS.Data; using Commerzbank.PCS.Data.Access; using Commerzbank.PCS.Data.Models; using System; using System.Collections; using System.Collections.Generic; using System.ComponentModel; using System.Data; using System.Drawing; using System.Linq; using System.Text; using System.Web; using System.Web.Services; using System.Web.SessionState; using System.Web.UI; using System.Web.UI.HtmlControls; using System.Web.UI.WebControls;  namespace Commerzbank.PCS.Web.Shared {   /// &lt;summary&gt;  /// Code behind class   /// &lt;/summary&gt;  public partial class TradingHierarchyTreePickerList : PageBase   {     #region WebMethods      /// &lt;summary&gt;    /// Get tree results     /// &lt;/summary&gt;    /// &lt;param name="isSelectedTree"&gt;Is this the "selected" tree or the "search results" tree?&lt;/param&gt;    /// &lt;param name="allowedLevelTypeIds"&gt;If this is populated then only a restricted number of level types can be viewed eg only 1 - 9 on the DealSearchOptions screen&lt;/param&gt;    /// &lt;param name="id"&gt;Nullable id parameter. If passed then then the children of this item will be returned.  If null then a full tree will be returned&lt;/param&gt;    /// &lt;param name="ids"&gt;An array of the selected ids&lt;/param&gt;    /// &lt;param name="searchName"&gt;Search parameter&lt;/param&gt;    /// &lt;param name="searchId"&gt;Search parameter&lt;/param&gt;    /// &lt;param name="searchLevelTypeId"&gt;Search parameter&lt;/param&gt;    /// &lt;param name="searchStatus"&gt;Search parameter&lt;/param&gt;    /// &lt;param name="searchProductTypeIds"&gt;Search parameter&lt;/param&gt;    /// &lt;param name="searchProductSubTypeIds"&gt;Search parameter&lt;/param&gt;    /// &lt;param name="searchHMNodes"&gt;Search parameter&lt;/param&gt;    /// &lt;param name="searchHitSelected"&gt;Search parameter - the first hit required (eg 1 for the first page of data, 101 for the second assuming a page size of 100)&lt;/param&gt;    /// &lt;param name="searchHitPageSize"&gt;Search parameter - the size of page (eg 100 "hits" and their associated parents)&lt;/param&gt;    /// &lt;returns&gt;List of nodes - this is the only return type jsTree allows&lt;/returns&gt;    [WebMethod]     public static List&lt;jsTreeNode&gt; GetHierarchy(       bool isSelectedTree,       int[] allowedLevelTypeIds,       int? id,        int[] ids,       string searchName,       int? searchId,       int? searchLevelTypeId,       int? searchStatus,       int[] searchProductTypeIds,       int[] searchProductSubTypeIds,       bool? searchHMNodes,       int? searchHitSelected,       int? searchHitPageSize       )     {       var start = DateTime.Now;       var searchOptionsForLog = new List&lt;string&gt;();       try       {         var db = new NodeDb(DataAccessorFactory.CreateDataAccessor(GlobalSettings.DataAccessorType, GlobalSettings.ConnectionString, GlobalSettings.ConnectionTimeout));         var nodesToReturn = new List&lt;jsTreeNode&gt;();          //Determine the maximum level type allowed (if there is one - there may not be)         int? maxLevelTypeId = (allowedLevelTypeIds.Length &gt; 0)           ? allowedLevelTypeIds.Max()           : (int?)null;          //Explode / get the kids of a single company         if (id.HasValue)         {           //Get child nodes           var childNodes = db.GetNodeList(parentNodeId: id.Value)             .OrderBy(n =&gt; (n.LevelTypeId == (int)LevelTypeConst.FrontOfficeBook) ? n.Code : n.Name) //Order by Code for Front Office Books, Name for all else             .ToList();            //Build up list of nodes           foreach (var childNode in childNodes) nodesToReturn.Add(MakeMeATreeNode(node: childNode, maxLevelTypeId: maxLevelTypeId));            //Note search options           searchOptionsForLog.Add("Id: " + id.Value);         }         else          {           var nodes = new List&lt;Node&gt;();           int[] hits = null;           int? lastHitOnPage = null,             hitCount = null;            //This is a search           if (searchHitSelected.HasValue)           {             searchOptionsForLog.Add("LevelTypeId: " + searchLevelTypeId.Value);             if (!string.IsNullOrEmpty(searchName)) searchOptionsForLog.Add("Name: " + searchName);             if (searchId.HasValue) searchOptionsForLog.Add("Id: " + searchId.Value);             if (searchStatus.Value != (int)RecordStatus.All) searchOptionsForLog.Add("Status: " + searchStatus.Value);             if (!searchProductTypeIds.IsNullOrEmpty()) searchOptionsForLog.Add("ProductTypeIds: [" + string.Join(",", searchProductTypeIds) + "]");             if (!searchProductSubTypeIds.IsNullOrEmpty()) searchOptionsForLog.Add("ProductSubTypeIds: [" + string.Join(",", searchProductSubTypeIds) + "]");             if (searchHMNodes.HasValue) searchOptionsForLog.Add("HMNodes: " + searchHMNodes.Value.ToString().ToLower());             searchOptionsForLog.Add("SearchHitSelected: " + searchHitSelected.Value);             searchOptionsForLog.Add("SearchHitPageSize: " + searchHitPageSize.Value);              //Get the search results             nodes = GetTradingHierarchyNodeSearchResults(               db: db,               levelTypeId: searchLevelTypeId.Value,               name: searchName,               id: searchId,               statusId: searchStatus.Value,               productTypeIds: searchProductTypeIds,               productSubTypeIds: searchProductSubTypeIds,               hmNodes: searchHMNodes);              //Performing paging as necessary             hitCount = nodes.Count;             if (hitCount.Value &lt; searchHitPageSize.Value)             {               //The number of hits are smaller than a page size and so no paging will be required               lastHitOnPage = hitCount.Value;             }             else             {               //Extract the relevant page of data               nodes = nodes.Skip(searchHitSelected.Value - 1).Take(searchHitPageSize.Value).ToList();                //Since the first hit on the page is searchHitSelected the last hit on the page can be determined using that and the number of nodes left to return               lastHitOnPage = (searchHitSelected.Value - 1) + nodes.Count;             }              //Store away the ids returned as our "hits"             hits = nodes.Select(n =&gt; n.NodeId).ToArray();           }           else if (!ids.IsNullOrEmpty())           {             searchOptionsForLog.Add("IdsWithExplode: [" + string.Join(",", ids) + "]");              //Populate nodes from ids             foreach (var nodeId in ids) nodes.Add(db.GetNode(nodeId));           }            //Get full tree list data            //Get all nodes leading to the root           int[] parentIdsLeadingToRoot;           var nodesLeadingToRoot = GetNodesLeadingToRoot(nodesToDisplay: nodes,             db: db,             getSiblingsOfSelectedNode: false,             trimExcessiveResults: false,             parentIdsLeadingToRoot: out parentIdsLeadingToRoot);            //Get root companies           var rootNodes = nodesLeadingToRoot.Where(n =&gt; (!n.ParentNodeId.HasValue)).ToList();            //Build up parents side of hierarchy           foreach (var rootNode in rootNodes)           {             var newNode = MakeMeATreeNode(node: rootNode, maxLevelTypeId: maxLevelTypeId, hits: hits);              //If this is a parent Node then mark it as open             newNode.state = nodesLeadingToRoot.Any(n =&gt; n.ParentNodeId == rootNode.NodeId) ? "open" : "closed";              //Add as a child of the root node             nodesToReturn.Add(newNode);              //Populate child nodes             PopulateTree(id: rootNode.NodeId, parentIdsLeadingToRoot: parentIdsLeadingToRoot, parentNode: newNode, nodes: nodesLeadingToRoot, maxLevelTypeId: maxLevelTypeId, hits: hits);           }            //If this is a search and there are search results then include the pager info on the first node in the list           if ((searchHitSelected.HasValue) &amp;&amp; (nodesToReturn.Count &gt; 0))           {             nodesToReturn[0].attr.Add("data-pager-text",               SharedLib.GetResourceString("PAGER_CAPTION_HITS") + " " + searchHitSelected.Value + "-" + lastHitOnPage.Value + " " +                SharedLib.GetResourceString("PAGER_CAPTION_OF") + " " + hitCount.Value);              nodesToReturn[0].attr.Add("data-page-size", searchHitPageSize.Value.ToString());             //nodesToReturn[0].attr.Add("data-max-hits", iMaxHits.ToString());             nodesToReturn[0].attr.Add("data-hit-selected", searchHitSelected.Value.ToString());             nodesToReturn[0].attr.Add("data-last-hit-on-page", lastHitOnPage.Value.ToString());             nodesToReturn[0].attr.Add("data-hit-count", hitCount.Value.ToString());           }            //Note search options           searchOptionsForLog.Add("IsSelectedTree: " + isSelectedTree.ToString().ToLower());         }          WebLogger.Log("GetHierarchy search took " + (DateTime.Now - start).TotalSeconds.ToString(System.Globalization.CultureInfo.InvariantCulture) + " seconds" +           ((searchOptionsForLog.Count &gt; 0)             ? ", " + String.Join(", ", searchOptionsForLog)             : "") +           " and returned " + nodesToReturn.Count + " root nodes",           SharedLib.FriendlyUserName, SharedLib.UserId, HttpContext.Current.Request.Url.ToString());          return nodesToReturn;       }       catch (Exception exc)       {         //Log error         WebLogger.LogException(new Exception("Problem experienced getting Trading Hierarchy", exc), HttpContext.Current.Session, HttpContext.Current.Request);          if ((exc is DataAccessException) &amp;&amp; (((DataAccessException)exc).Number == DataAccessError.ConnectionLost))           throw new UserFriendlyException(SharedLib.GetResourceString("ERROR_SEARCH_HAS_TAKEN_TOO_LONG")); //Connection lost/timeout?         else           throw new UserFriendlyException(SharedLib.GetResourceString("ERROR_SEARCH_UNKNOWN_ERROR")); //Generic error       }     }      /// &lt;summary&gt;    /// Get a Node     /// &lt;/summary&gt;    /// &lt;param name="nodeId"&gt;&lt;/param&gt;    /// &lt;returns&gt;a dictionary representing a node&lt;/returns&gt;    [WebMethod]     public static Dictionary&lt;string, object&gt; GetNode(int nodeId)     {       try       {         var dac = DataAccessorFactory.CreateDataAccessor(GlobalSettings.DataAccessorType, GlobalSettings.ConnectionString, GlobalSettings.ConnectionTimeout);         var node = new NodeDb(dac).GetNode(nodeId);          if (node != null)         {           var dictionaryToReturn = new Dictionary&lt;string, object&gt;()           {             { "NodeId", node.NodeId.ToString() },             { "HMId", node.HMId.ToString() },             { "Code", node.Code },             { "Name", node.Name },             { "LevelType", node.LevelType },             { "LevelTypeId", node.LevelTypeId },             { "IsActive", node.IsActive }           };            switch (node.LevelTypeId)           {             case (int)LevelTypeConst.FunctionalUnit:               var functionalUnit = new FunctionalUnitDb(dac).GetFunctionalUnit(nodeId);               dictionaryToReturn.Add("Location", functionalUnit.Location);               break;              case (int)LevelTypeConst.TradingBook:               var tradingBook = new TradingBookDb(dac).GetTradingBook(nodeId);               dictionaryToReturn.Add("Trader", tradingBook.HeadTrader);               break;              case (int)LevelTypeConst.FrontOfficeBook:               var frontOfficeBook = new FrontOfficeBookDb(dac).GetFrontOfficeBook(nodeId);               dictionaryToReturn.Add("SourceSystem", frontOfficeBook.SourceSystem);               break;           }                      //Perform log           WebLogger.Log(node.LevelType + " " + ((node.LevelTypeId == (int)LevelTypeConst.FrontOfficeBook)              ? node.Code              : node.Name) +              " (NodeId: " + node.NodeId + ") looked up",             SharedLib.FriendlyUserName, SharedLib.UserId, HttpContext.Current.Request.Url.ToString());            return dictionaryToReturn;         }         else           throw new Exception("No node found with NodeId: " + nodeId);       }       catch (Exception exc)       {         //Log error         WebLogger.LogException(new Exception("Problem experienced getting Trading Hierarchy Node", exc), HttpContext.Current.Session, HttpContext.Current.Request);          if ((exc is DataAccessException) &amp;&amp; (((DataAccessException)exc).Number == DataAccessError.ConnectionLost))           throw new UserFriendlyException(SharedLib.GetResourceString("ERROR_SEARCH_HAS_TAKEN_TOO_LONG")); //Connection lost/timeout?         else           throw new UserFriendlyException(SharedLib.GetResourceString("ERROR_SEARCH_UNKNOWN_ERROR")); //Generic error       }     }      /// &lt;summary&gt;    /// Iterate through selected Ids making sure we have a full path of ids to the root     /// &lt;/summary&gt;    /// &lt;param name="nodesToDisplay"&gt;&lt;/param&gt;    /// &lt;param name="db"&gt;&lt;/param&gt;    /// &lt;param name="trimExcessiveResults"&gt;&lt;/param&gt;    /// &lt;param name="getSiblingsOfSelectedNode"&gt;&lt;/param&gt;    /// &lt;param name="parentIdsLeadingToRoot"&gt;&lt;/param&gt;    /// &lt;returns&gt;&lt;/returns&gt;    private static List&lt;Node&gt; GetNodesLeadingToRoot(List&lt;Node&gt; nodesToDisplay, NodeDb db, bool trimExcessiveResults, bool getSiblingsOfSelectedNode, out int[] parentIdsLeadingToRoot)     {       //Identify all the parent ids leading to the root       var parentIdsLeadingToRootList = new List&lt;int&gt;();        var nodes = new List&lt;Node&gt;();       foreach (var node in nodesToDisplay)       {         //Only get all siblings if this single selected node has a parent (would be too confusing if multiple were)         if ((getSiblingsOfSelectedNode) &amp;&amp; (node.ParentNodeId.HasValue) &amp;&amp; (nodesToDisplay.Count == 1))         {           //Get all the siblings and the current company           var allSiblings = db.GetNodeList(parentNodeId: node.ParentNodeId.Value)             .OrderBy(n =&gt; (n.LevelTypeId == (int)LevelTypeConst.FrontOfficeBook) ? n.Code : n.Name) //Order by Code for Front Office Books, Name for all else             .ToList();            //Remove the current node from the list           allSiblings.RemoveAt(allSiblings.IndexOf(allSiblings.Where(n =&gt; n.NodeId == node.NodeId).Single()));            //Insert the current node as the first entry in the list so is nice and clear to the user           allSiblings.Insert(0, node);            //We've got a lot of siblings so lets trim down for the user           var maxSiblings = 1000;           if ((trimExcessiveResults) &amp;&amp; (allSiblings.Count &gt; maxSiblings))           {             //Strip inactive Companies out             if (node.IsActive) allSiblings = allSiblings.Where(n =&gt; n.IsActive == true).ToList();              //If there's still more than 1000 items in the list then take only the first 1000             if (allSiblings.Count &gt; maxSiblings) allSiblings = allSiblings.Take(maxSiblings).ToList();           }            nodes.AddRange(allSiblings);         }         else         {           //Add current node - but check if this node is already in the list - only add it to the list if it is not           if (nodes.Where(n =&gt; n.NodeId == node.NodeId).SingleOrDefault() == null) nodes.Add(node);         }          //Walk up tree to root         var nodeToWalkTree = node;         while (nodeToWalkTree.ParentNodeId.HasValue)         {           if (parentIdsLeadingToRootList.Contains(nodeToWalkTree.ParentNodeId.Value))           {             //If the parent node is already in the parentIdsLeadingToRoot then we don't need to walk the tree             // - we can assume we have all the parents as well             break;           }           else           {             //Add parent id to list             parentIdsLeadingToRootList.Add(nodeToWalkTree.ParentNodeId.Value);              //Get the parent             nodeToWalkTree = db.GetNode(nodeToWalkTree.ParentNodeId.Value);              //Add node to list if it is not already in the list             //if (nodes.Where(n =&gt; n.NodeId == nodeToWalkTree.NodeId).SingleOrDefault() == null)               nodes.Add(nodeToWalkTree);             //else             //  break; //If it is in the list then we can assume we have all the parents as well and so don't need to keep walking the tree           }         }       }        //Turn into array for return       parentIdsLeadingToRoot = parentIdsLeadingToRootList.ToArray();        return nodes;     }      /// &lt;summary&gt;    /// A method to populate a Tree with children     /// &lt;/summary&gt;    private static void PopulateTree(int id, int[] parentIdsLeadingToRoot, jsTreeNode parentNode, List&lt;Node&gt; nodes, int? maxLevelTypeId, int[] hits)     {       //Get child nodes       var childNodes = nodes.Where(c =&gt; c.ParentNodeId == id).ToList();        // loop through each child product types       foreach (var childNode in childNodes)       {         // create a new node         var newNode = MakeMeATreeNode(node: childNode, maxLevelTypeId: maxLevelTypeId, hits: hits);          //Mark selected as open and parents as open         if (parentIdsLeadingToRoot.Contains(childNode.NodeId))         {           //parentNode.state = "open"; //DO WE NEED THIS?           newNode.state = "open";         }          // populate children of current company         PopulateTree(id: childNode.NodeId, parentIdsLeadingToRoot: parentIdsLeadingToRoot, parentNode: newNode, nodes: nodes, maxLevelTypeId: maxLevelTypeId, hits: hits);          // add the node to the "master" node         if (parentNode.children == null) parentNode.children = new List&lt;jsTreeNode&gt;(); //If not initialised then initialise         parentNode.children.Add(newNode);       }     }      /// &lt;summary&gt;    /// Construct a TreeNode based on a Node     /// &lt;/summary&gt;    /// &lt;param name="companySalesSplitDB"&gt;&lt;/param&gt;    /// &lt;param name="node"&gt;&lt;/param&gt;    /// &lt;returns&gt;jsTreeNode&lt;/returns&gt;    private static jsTreeNode MakeMeATreeNode(Node node, int? maxLevelTypeId, int[] hits = null)     {       var newNode = new jsTreeNode()       {         attr = new Dictionary&lt;string, string&gt;()            {              { "id", "n" + node.NodeId.ToString() },             { "data-level-type-id", node.LevelTypeId.ToString() } //Also decorate with company type id to facilitate client side checking           },         data = new jsTreeData()         {           title = LevelType.GetLevelTypeAbbreviation(node.LevelTypeId) + ": " + //Prefix all nodes by a level type abbreviation             ((node.LevelTypeId == (int)LevelTypeConst.FrontOfficeBook) ? node.Code : node.Name) //If FrontOfficeBook then display Code otherwise display Name         },         state = (           (             (node.LevelTypeId == (int)LevelTypeConst.FrontOfficeBook) ||  //null state if FrontOfficeBook or equal to maxLevelTypeId so the user can't see their kids (if indeed they have any)             (node.LevelTypeId == maxLevelTypeId)           )           ? null            : "closed")        };        var cssClasses = new List&lt;string&gt;();        //Highlight hits       if ((!hits.IsNullOrEmpty()) &amp;&amp; (hits.Contains(node.NodeId))) cssClasses.Add("pleaseNoticeMe");        //Highlight inactive companies       if (!node.IsActive) cssClasses.Add("highlighted");        //Apply classes       if (cssClasses.Count &gt; 0) newNode.data.attr = new Dictionary&lt;string, string&gt;() { { "class", string.Join(" ", cssClasses) } };        return newNode;     }      /// &lt;summary&gt;    /// Get TradingHierarchyNode search results     /// &lt;/summary&gt;    /// &lt;param name="db"&gt;&lt;/param&gt;    /// &lt;param name="levelTypeId"&gt;&lt;/param&gt;    /// &lt;param name="name"&gt;&lt;/param&gt;    /// &lt;param name="statusId"&gt;&lt;/param&gt;    /// &lt;param name="productTypeIds"&gt;&lt;/param&gt;    /// &lt;param name="productSubTypeIds"&gt;&lt;/param&gt;    /// &lt;param name="hmNodes"&gt;&lt;/param&gt;    /// &lt;returns&gt;&lt;/returns&gt;    private static List&lt;Node&gt; GetTradingHierarchyNodeSearchResults(       NodeDb db,       int levelTypeId,       string name,       int? id,       int statusId,       int[] productTypeIds,       int[] productSubTypeIds,       bool? hmNodes       )     {       //If a name has been provided then suffix the "*" character so that a LIKE style search is carried out       if ((!string.IsNullOrEmpty(name)) &amp;&amp; (!name.EndsWith("*"))) name += "*";        //Get nodes from database       var nodeList = db.GetNodeList(currentUserId: SharedLib.UserId,         levelTypeId: (id.HasValue ? (int?)null : levelTypeId), //If an id has been passed then don't pass levelType as a parameter - this will mean the user doesn't have to run the same search with each levelType         name: name,         nodeIds: (id.HasValue ? new int[] { id.Value } : null),         isActive: ((statusId == (int)RecordStatus.All) ? (bool?)null : ((statusId == (int)RecordStatus.Active) ? true : false)),         productTypeIds: productTypeIds,         productSubTypeIds: productSubTypeIds,         hmNodes: hmNodes);        return nodeList;     }      #endregion      #region Protected Methods      protected void Page_Load(object sender, System.EventArgs e)     {       //Postback processing       if (!Page.IsPostBack)       {         //Get arguments         GetArguments();          //Initialise page         InitialisePage();       }        //Add picker javascript       AddScripts();     }      /// &lt;summary&gt;    /// Output Picker script block     /// &lt;/summary&gt;    protected override void AddScripts()     {       base.AddScripts();        ScriptHelper.AddClientScript(SharedLib.URLjsTree);       ScriptHelper.AddClientScript(SharedLib.URLlibString);       ScriptHelper.AddClientScript(SharedLib.ScriptPath + "Picker/TradingHierarchyTreePicker/TradingHierarchyTreePickerList-1.0.0.js");     }      /// &lt;summary&gt;    /// Extract passed arguments     /// &lt;/summary&gt;    protected virtual void GetArguments()     {       //Record in data attributes        //Static data to be used on page       divHierarchyResults.Attributes.Add("data-ids", GetParameter("aIds", "[]")); //"[]" is an empty array       divHierarchyResults.Attributes.Add("data-multi-select", GetParameter("MultiSelect", "false"));       divHierarchyResults.Attributes.Add("data-status-id", GetParameter("StatusId", "-1"));       divHierarchyResults.Attributes.Add("data-db-extra-selectable-values", GetParameter("DBExtraSelectableValues", "[]"));       divHierarchyResults.Attributes.Add("data-values-to-exclude", GetParameter("aValuesToExclude", "[]"));       divHierarchyResults.Attributes.Add("data-product-type-ids", GetParameter("ProductTypeIds", "[]")); //"[]" is an empty array       divHierarchyResults.Attributes.Add("data-product-sub-type-ids", GetParameter("ProductSubTypeIds", "[]")); //"[]" is an empty array       divHierarchyResults.Attributes.Add("data-level-type-ids", GetParameter("LevelTypeIds", "[]")); //"[]" is an empty array       divHierarchyResults.Attributes.Add("data-hm-nodes", GetParameter("HMNodes", "null"));        genTitle.Text = GetParameter("Title", "");     }      /// &lt;summary&gt;    /// Initialise/localise page     /// &lt;/summary&gt;    protected override void InitialisePage()     {       base.InitialisePage();        //Captions       lblSearchName.Text = SharedLib.GetResourceString("CAPTION_NAME");       lblSearchId.Text = SharedLib.GetResourceString("CAPTION_ID");       rdoAll.Text = SharedLib.GetResourceString("CAPTION_ALL");       rdoActive.Text = SharedLib.GetResourceString("CAPTION_ACTIVE");       rdoInactive.Text = SharedLib.GetResourceString("CAPTION_INACTIVE");       btnSearch.Value = SharedLib.GetResourceString("BUTTON_SEARCH");        //Buttons       btnClearSearchName.Value = SharedLib.GetResourceString("CAPTION_CLEAR");       btnClearSearchId.Value = SharedLib.GetResourceString("CAPTION_CLEAR");        //rdoCompanyType       rdoAll.Attributes.Add("Value", ((int)RecordStatus.All).ToString());       rdoActive.Attributes.Add("Value", ((int)RecordStatus.Active).ToString());       rdoInactive.Attributes.Add("Value", ((int)RecordStatus.Inactive).ToString());        //drpLevelType - single parameter passed       var levelTypeIds = GetParameter("LevelTypeIds", null).GetIdsFromString();       int iLevelTypeIdToSelect = ((int)LevelTypeConst.FunctionalUnit);  //Default to FunctionalUnit if no LevelType supplied              //If a single level type supplied then use that       if ((levelTypeIds != null) &amp;&amp; (levelTypeIds.Length == 1)) iLevelTypeIdToSelect = levelTypeIds[0];        //Populate dropdown       foreach (string levelType in Enum.GetNames(typeof(LevelTypeConst)))       {         var levelTypeEnum = (LevelTypeConst)Enum.Parse(typeof(LevelTypeConst), levelType);         var iLevelTypeId = (int)levelTypeEnum;         var sLevelType = EnumHelper.GetDescription(levelTypeEnum);          //If only certain level types are allowed then restrict dropdown accordingly         if ((levelTypeIds != null) &amp;&amp; (levelTypeIds.Length &gt; 0))         {           //If the current level type is not in the array then skip over this entry           if (!levelTypeIds.Contains(iLevelTypeId)) continue;         }          //Add new list item (selected if appropriate)         drpLevelType.Items.Add(new ListItem()         {           Text = sLevelType,           Value = iLevelTypeId.ToString(),           Selected = (iLevelTypeIdToSelect == iLevelTypeId)         });       }        imgSearchResults.Src = ResolveUrl("~/Shared/Images/search.gif");       lblSearchResults.Text = SharedLib.GetResourceString("CAPTION_SEARCH_RESULTS");        imgSearchSelected.Src = ResolveUrl("~/Shared/Images/chosen.gif");       lblSearchSelected.Text = SharedLib.GetResourceString("CAPTION_CHOSEN") + " " + SharedLib.GetResourceString("CAPTION_TRADING_HIERARCHY");        btnAdd.Value = SharedLib.GetResourceString("BUTTON_ADD");       btnRemove.Value = SharedLib.GetResourceString("BUTTON_REMOVE");       btnClear.Value = SharedLib.GetResourceString("BUTTON_REMOVE_ALL");        //URLs to be used on page       divHierarchyResults.Attributes.Add("data-url-css-js-tree", ResolveUrl(SharedLib.URLCSSjsTree));       divHierarchyResults.Attributes.Add("data-get-hierarchy", HttpContext.Current.Request.Path + "/GetHierarchy");       divHierarchyResults.Attributes.Add("data-get-node", HttpContext.Current.Request.Path + "/GetNode");               //Error messages to be used on page       divHierarchyResults.Attributes.Add("data-error-node-already-exists", SharedLib.GetResourceString("ERROR_NODE_ALREADY_EXISTS"));       divHierarchyResults.Attributes.Add("data-error-node-select-correct-type", SharedLib.GetResourceString("ERROR_NODE_SELECT_CORRECT_TYPE"));       divHierarchyResults.Attributes.Add("data-question-slow-search", SharedLib.GetResourceString("QUESTION_SLOW_SEARCH"));        //Info tab       lblInfoId.Text = SharedLib.GetResourceString("CAPTION_ID");       lblInfoHMId.Text = "HM " + SharedLib.GetResourceString("CAPTION_ID");       lblInfoName.Text = SharedLib.GetResourceString("CAPTION_NAME");       lblInfoCode.Text = SharedLib.GetResourceString("CAPTION_CODE");       lblInfoType.Text = SharedLib.GetResourceString("CAPTION_TYPE");       lblInfoActive.Text = SharedLib.GetResourceString("CAPTION_ACTIVE");       lblInfoLocation.Text = SharedLib.GetResourceString("CAPTION_LOCATION");       lblInfoTrader.Text = SharedLib.GetResourceString("CAPTION_TRADER");       lblInfoSourceSystem.Text = SharedLib.GetResourceString("CAPTION_SOURCE_SYSTEM");        btnOK.Value = SharedLib.GetResourceString("BUTTON_OK");       btnOK.Style["width"] = SharedLib.GetResourceString("BUTTON_OK_WIDTH");        btnCancel.Value = SharedLib.GetResourceString("BUTTON_CANCEL");       btnCancel.Style["width"] = SharedLib.GetResourceString("BUTTON_CANCEL_WIDTH");     }      #endregion   } }</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3766809831025953251'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3766809831025953251'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-7574668744719877429</id><published>2012-05-16T09:25:00.000+01:00</published><updated>2012-05-16T09:25:26.975+01:00</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>numericTextBox.js - activate with:  $(".numericTextBox").numericTextBox();</title><content type='html'>/*  * jQuery numericTextBox plugin  *  * Author: John Reilly  *   * Depends:  * jQuery 1.7+  *  https://github.com/phiggins42/bloody-jquery-plugins/blob/master/pubsub.js  *  Globalize.js   *  * Html required:  * &lt;input class="numericTextBox" data-type="MarginBps" data-format="n2" id="MarginBps" name="MarginBps" type="text" value="456.12" /&gt; */ ;(function( $ ){    var oDefaults = {     format: "n0",     valueFieldSuffix: "_Value"    };    var methods = {      //===============================================================================     // Initialise a NumericTextBox     //===============================================================================     init : function( options ) {        return this.each(function(){          var $this = $(this), //text input             oData = $this.data(); //associated data                           if (!oData["isNumericTextBox"]) {            //Check to see if any required data attributes are missing and use defaults if necessary           if (!oData.hasOwnProperty("format")) { $this.data("format", oDefaults.format); }           if (!oData.hasOwnProperty("valueFieldSuffix")) { $this.data("valueFieldSuffix", oDefaults.valueFieldSuffix); }            //Re-get associated data following any changes made above           oData = $this.data();             //Create hidden field which will store total and add to the DOM just after the text input (it is initialised with the contents of the text field)           $('&lt;input type="hidden" id="' + this.id + oData.valueFieldSuffix + '" name="' + this.id + oData.valueFieldSuffix + '" value="' + this.value + '" /&gt;').appendTo($this.parent());            //Wire up events           $this.on("focus", methods.onFocus);           $this.on("blur",  methods.onBlur);                      //If disabled data attribute is set then render as readonly           if (oData.disabled) {             $this               .prop("readonly", true)               .addClass("readOnly");           }            //Ensure number is formatted correctly           this.value = Globalize.format(parseFloat(this.value), oData.format); //We can parseFloat as when initially rendering it will be in the format "56732.3232" - ie: ToString("F", CultureInfo.InvariantCulture)            //Set data attribute to indicate this is a setup numerictextbox           $this.data("isNumericTextBox", true);         }       });     },      //===============================================================================     // Uninitialise a NumericTextBox     //===============================================================================     destroy : function( ) {        return this.each(function() {          var $this = $(this), //text input             oData = $this.data(); //associated data                   //Remove the hidden element         $("#" + this.id + oData.valueFieldSuffix).remove();          //Un-wire up events         $this.off("focus", methods.onFocus);         $this.off("blur", methods.onBlur);          //Remove data attribute to indicate this is a setup numerictextbox         $this.removeData('isNumericTextBox');       });     },          //===============================================================================     // Replace formatted field text with value field text and select contents of textbox     //===============================================================================     onFocus: function (evt) {        var $numericTextBox = $(this),         sValue = $("#" + this.id + $numericTextBox.data("valueFieldSuffix")).val(); //Extract raw number from hidden field              $numericTextBox         .val(sValue.replace(/[.]/g, Globalize.culture().numberFormat["."])) //Present full raw number formatted so the local cultures decimal character is used ("," for Germany, "." for UK etc)         .select();     },      //===============================================================================     // Validate and store numeric value in value field     //===============================================================================     onBlur: function (evt) {        var $numericTextBox = $(this), //text input           oData = $numericTextBox.data(),           $ValueField = $("#" + this.id + oData.valueFieldSuffix), //value input           fCurrentTotal = parseFloat($ValueField.val()),           fNewTotal = Globalize.parseFloat(this.value.replace( /[m]/gi , "000000").replace( /[k]/gi , "000")), //Replace "M" with "000000" and "K" with "000"           bUpdate = (!isNaN(fNewTotal)); //If this is a number then it's probably and update              //Unless....       if ((oData.min) &amp;&amp; (fNewTotal &lt; oData.min)) {         bUpdate = false;       }       else if ((oData.max) &amp;&amp; (fNewTotal &gt; oData.max)) {         bUpdate = false;       }        if (bUpdate) {         //If we have a new total which is different to the current total then update the hidden field and publish out        if (fCurrentTotal !== fNewTotal) {            //Save new total to hidden field           $ValueField.val(fNewTotal);            //If there is a data-type tag then this will be used to publish the change event; if not the id will be used           $.publish("PCS." + ((oData.type) ? oData.type : this.id) + ".Change", [fNewTotal, $numericTextBox]);         }       }       else {          //Revert back to previous total         fNewTotal = fCurrentTotal;       }        //Format the field        this.value = Globalize.format(fNewTotal, oData.format);     },          //===============================================================================     // Get Total from Value Field     //===============================================================================     getTotal: function () {        var $numericTextBox = this;        return parseFloat($("#" + $numericTextBox.prop("id") + $numericTextBox.data("valueFieldSuffix")).val());     },      //===============================================================================     // Set NumericTextBox value/text     //===============================================================================     setTotal: function (fTotal) { //"this" should be $numericTextBox        var $numericTextBox = this;              $("#" + $numericTextBox.prop("id") + $numericTextBox.data("valueFieldSuffix")).val(fTotal);        //Ensure number is formatted correctly       $numericTextBox.val(Globalize.format(fTotal, $numericTextBox.data("format"))); //We can parseFloat as when initially rendering it will be in the format "56732.3232" - ie: ToString("F", CultureInfo.InvariantCulture)     }   };    //===============================================================================   // Declare numericTextBox plugin   //===============================================================================   $.fn.numericTextBox = function( method ) {          if ( methods[method] ) { //Calling a method inside the plugin       return methods[method].apply( this, Array.prototype.slice.call( arguments, 1 ));     }      else if ( typeof method === 'object' || ! method ) { //Initialisation       return methods.init.apply( this, arguments );     }      else {       $.error( 'Method ' +  method + ' does not exist on jQuery.numericTextBox' );     }          };  })( jQuery );</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7574668744719877429'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7574668744719877429'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2775378557172568313</id><published>2012-05-09T09:30:00.001+01:00</published><updated>2012-05-09T09:30:46.361+01:00</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>TraderPickerExtensions</title><content type='html'>/* eg usage:  @Html.TraderPickerFor(vm =&gt; vm.TraderId,           id: "Trader",           htmlAttributes: new           {             style = "width:150px;"           },           enabled: Model.EnabledProperties.Contains("Trader"),           statusId: (int)RecordStatus.Active) */ using Commerzbank.Pcs.Data.Access; using Commerzbank.Pcs.Data.Models; using Commerzbank.Pcs.Web.Gui.Shared; using System; using System.Collections.Generic; using System.Linq.Expressions; using System.Web.Mvc; using System.Web.Routing;  namespace Commerzbank.Pcs.Web.Helpers {   /// &lt;summary&gt;  /// MVC HtmlHelper extension methods - html element extensions   /// &lt;/summary&gt;  public static class TraderPickerExtensions   {     #region Public      /// &lt;summary&gt;    /// Render a Trader Picker     /// &lt;/summary&gt;    /// &lt;param name="helper"&gt;&lt;/param&gt;    /// &lt;param name="id"&gt;&lt;/param&gt;    /// &lt;param name="htmlAttributes"&gt;&lt;/param&gt;    /// &lt;param name="selectedIds"&gt;&lt;/param&gt;    /// &lt;param name="multiSelect"&gt;&lt;/param&gt;    /// &lt;param name="useAdvancedPicker"&gt;&lt;/param&gt;    /// &lt;param name="addClearButton"&gt;&lt;/param&gt;    /// &lt;param name="enabled"&gt;&lt;/param&gt;    /// &lt;param name="statusId"&gt;&lt;/param&gt;    /// &lt;param name="dbExtraSelectableValues"&gt;&lt;/param&gt;    /// &lt;param name="productTypeIds"&gt;Product Type Id list for filtering - string so can be dynamic&lt;/param&gt;    /// &lt;param name="productSubTypeIds"&gt;Product Sub Type Id list for filtering - string so can be dynamic&lt;/param&gt;    /// &lt;param name="tradingHierarchyNodeIds"&gt;Trading Hierarchy Node Id list for filtering - string so can be dynamic&lt;/param&gt;    /// &lt;param name="frontOfficeBookIds"&gt;Front Office Book Id list for filtering - string so can be dynamic&lt;/param&gt;    /// &lt;param name="textBoxCssClass"&gt;&lt;/param&gt;    /// &lt;param name="elipsisButtonCssClass"&gt;&lt;/param&gt;    /// &lt;param name="clearButtonCssClass"&gt;&lt;/param&gt;    /// &lt;param name="position"&gt;&lt;/param&gt;    /// &lt;returns&gt;&lt;/returns&gt;    public static MvcHtmlString TraderPicker(       this HtmlHelper helper,        string id, object htmlAttributes,       int[] selectedIds = null,       bool multiSelect = false, bool useAdvancedPicker = false, bool addClearButton = false, bool enabled = true, int statusId = (int)RecordStatus.All, int[] dbExtraSelectableValues = null,       string productTypeIds = null, string productSubTypeIds = null, string tradingHierarchyNodeIds = null, string frontOfficeBookIds = null,       string textBoxCssClass = null, string elipsisButtonCssClass = null, string clearButtonCssClass = null,       PickerPosition position = PickerPosition.RelativeToSourceElement)     {       var attributes = HtmlHelper.AnonymousObjectToHtmlAttributes(htmlAttributes);        return MakePicker(         helper: helper,         id: id,         attributes: attributes,         selectedIds: selectedIds,         multiSelect: multiSelect,         useAdvancedPicker: useAdvancedPicker,         addClearButton: addClearButton,         enabled: enabled,         statusId: statusId,         dbExtraSelectableValues: dbExtraSelectableValues,         productTypeIds: productTypeIds,         productSubTypeIds: productSubTypeIds,         tradingHierarchyNodeIds: tradingHierarchyNodeIds,         frontOfficeBookIds: frontOfficeBookIds,         textBoxCssClass: textBoxCssClass,         elipsisButtonCssClass: elipsisButtonCssClass,         clearButtonCssClass: clearButtonCssClass,         position: position);     }      /// &lt;summary&gt;    /// Render a Trader Picker     /// &lt;/summary&gt;    /// &lt;typeparam name="TModel"&gt;&lt;/typeparam&gt;    /// &lt;typeparam name="TProperty"&gt;&lt;/typeparam&gt;    /// &lt;param name="helper"&gt;&lt;/param&gt;    /// &lt;param name="expression"&gt;&lt;/param&gt;    /// &lt;param name="id"&gt;&lt;/param&gt;    /// &lt;param name="htmlAttributes"&gt;&lt;/param&gt;    /// &lt;param name="multiSelect"&gt;&lt;/param&gt;    /// &lt;param name="useAdvancedPicker"&gt;&lt;/param&gt;    /// &lt;param name="addClearButton"&gt;&lt;/param&gt;    /// &lt;param name="enabled"&gt;&lt;/param&gt;    /// &lt;param name="statusId"&gt;&lt;/param&gt;    /// &lt;param name="dbExtraSelectableValues"&gt;&lt;/param&gt;    /// &lt;param name="productTypeIds"&gt;Product Type Id list for filtering - string so can be dynamic&lt;/param&gt;    /// &lt;param name="productSubTypeIds"&gt;Product Sub Type Id list for filtering - string so can be dynamic&lt;/param&gt;    /// &lt;param name="tradingHierarchyNodeIds"&gt;Trading Hierarchy Node Id list for filtering - string so can be dynamic&lt;/param&gt;    /// &lt;param name="frontOfficeBookIds"&gt;Front Office Book Id list for filtering - string so can be dynamic&lt;/param&gt;    /// &lt;param name="textBoxCssClass"&gt;&lt;/param&gt;    /// &lt;param name="elipsisButtonCssClass"&gt;&lt;/param&gt;    /// &lt;param name="clearButtonCssClass"&gt;&lt;/param&gt;    /// &lt;param name="position"&gt;&lt;/param&gt;    /// &lt;returns&gt;&lt;/returns&gt;    public static MvcHtmlString TraderPickerFor&lt;TModel, TProperty&gt;(       this HtmlHelper&lt;TModel&gt; helper,       Expression&lt;Func&lt;TModel, TProperty&gt;&gt; expression,       string id, object htmlAttributes,       bool multiSelect = false, bool useAdvancedPicker = false, bool addClearButton = false, bool enabled = true, int statusId = (int)RecordStatus.All, int[] dbExtraSelectableValues = null,       string productTypeIds = null, string productSubTypeIds = null, string tradingHierarchyNodeIds = null, string frontOfficeBookIds = null,       string textBoxCssClass = null, string elipsisButtonCssClass = null, string clearButtonCssClass = null,       PickerPosition position = PickerPosition.RelativeToSourceElement)     {       var attributes = HtmlHelper.AnonymousObjectToHtmlAttributes(htmlAttributes);        //Determine if unobtrusive validation attributes should be applied       helper.ApplyUnobtrusiveValidationDataAttributes&lt;TModel, TProperty&gt;(expression, attributes);        //Determine selectedIds for the model       var selectedIds = helper.DetermineSelectedIds&lt;TModel, TProperty&gt;(expression);        return MakePicker(         helper: helper,         id: id,         attributes: attributes,         selectedIds: selectedIds,         multiSelect: multiSelect,         useAdvancedPicker: useAdvancedPicker,         addClearButton: addClearButton,         enabled: enabled,         statusId: statusId,         dbExtraSelectableValues: dbExtraSelectableValues,         productTypeIds: productTypeIds,         productSubTypeIds: productSubTypeIds,         tradingHierarchyNodeIds: tradingHierarchyNodeIds,         frontOfficeBookIds: frontOfficeBookIds,         textBoxCssClass: textBoxCssClass,         elipsisButtonCssClass: elipsisButtonCssClass,         clearButtonCssClass: clearButtonCssClass,         position: position);     }      #endregion      #region Private      /// &lt;summary&gt;    /// Common private method for rendering picker     /// &lt;/summary&gt;    /// &lt;param name="helper"&gt;&lt;/param&gt;    /// &lt;param name="id"&gt;&lt;/param&gt;    /// &lt;param name="htmlAttributes"&gt;&lt;/param&gt;    /// &lt;param name="selectedIds"&gt;&lt;/param&gt;    /// &lt;param name="multiSelect"&gt;&lt;/param&gt;    /// &lt;param name="useAdvancedPicker"&gt;&lt;/param&gt;    /// &lt;param name="addClearButton"&gt;&lt;/param&gt;    /// &lt;param name="enabled"&gt;&lt;/param&gt;    /// &lt;param name="statusId"&gt;&lt;/param&gt;    /// &lt;param name="dbExtraSelectableValues"&gt;&lt;/param&gt;    /// &lt;param name="productTypeIds"&gt;Product Type Id list for filtering - string so can be dynamic&lt;/param&gt;    /// &lt;param name="productSubTypeIds"&gt;Product Sub Type Id list for filtering - string so can be dynamic&lt;/param&gt;    /// &lt;param name="tradingHierarchyNodeIds"&gt;Trading Hierarchy Node Id list for filtering - string so can be dynamic&lt;/param&gt;    /// &lt;param name="frontOfficeBookIds"&gt;Front Office Book Id list for filtering - string so can be dynamic&lt;/param&gt;    /// &lt;param name="textBoxCssClass"&gt;&lt;/param&gt;    /// &lt;param name="elipsisButtonCssClass"&gt;&lt;/param&gt;    /// &lt;param name="clearButtonCssClass"&gt;&lt;/param&gt;    /// &lt;param name="position"&gt;&lt;/param&gt;    /// &lt;returns&gt;&lt;/returns&gt;    private static MvcHtmlString MakePicker(       this HtmlHelper helper,        string id, RouteValueDictionary attributes,        int[] selectedIds = null,       bool multiSelect = false, bool useAdvancedPicker = false, bool addClearButton = false, bool enabled = true, int statusId = (int)RecordStatus.All, int[] dbExtraSelectableValues = null,        string productTypeIds = null, string productSubTypeIds = null, string tradingHierarchyNodeIds = null, string frontOfficeBookIds = null,       string textBoxCssClass = null, string elipsisButtonCssClass = null, string clearButtonCssClass = null,       PickerPosition position = PickerPosition.RelativeToSourceElement)     {       //Get data for selected ids       string text; string[] tooltips;       InitialiseFromDatabase(selectedIds, out text, out tooltips);        //Make span container       var container = helper.MakePickerSpan(id);        //Render textbox to display to user       container.InnerHtml += helper.AddPickerTextBox(id, text, textBoxCssClass, attributes);        //Create picker data dictionary       var dynamicData = new Dictionary&lt;string, string&gt;();        //Add any "dynamic" entries to the dictionary - these will need to be evaluated when the picker is opened       if (productTypeIds != null) dynamicData.Add("productTypeIds", productTypeIds);       if (productSubTypeIds != null) dynamicData.Add("productSubTypeIds", productSubTypeIds);       if (tradingHierarchyNodeIds != null) dynamicData.Add("tradingHierarchyNodeIds", tradingHierarchyNodeIds);       if (frontOfficeBookIds != null) dynamicData.Add("frontOfficeBookIds", frontOfficeBookIds);        //Render picker elipsis button       container.InnerHtml += helper.AddPickerElipsisButton(         id: id,         type: "Trader",         multiSelect: multiSelect,         useAdvancedPicker: useAdvancedPicker,         tooltips: tooltips,         dbExtraSelectableValues: dbExtraSelectableValues,         enabled: enabled,         elipsisButtonCssClass: elipsisButtonCssClass,         addClearButton: addClearButton,         clearButtonCssClass: clearButtonCssClass,         pickerListUrl: SharedLib.ProcessUrl("~/Shared/UserControls/TraderPickerList.aspx"),         position: position,         dialogWidth: (((useAdvancedPicker) &amp;&amp; (multiSelect)) ? "600" : "250"),         dialogHeight: (((useAdvancedPicker) &amp;&amp; (multiSelect)) ? "250" : "228"),         title: SharedLib.GetResourceString("CAPTION_TRADER"),         extraData: new Dictionary&lt;string, object&gt;            {              { "data-status-id", statusId }           },         dynamicData: dynamicData       );        //Render "value" hidden input       container.InnerHtml += helper.AddPickerValue(id, selectedIds);        //Render scripts       helper.AddPickerScripts(multiSelect);        return MvcHtmlString.Create(container.ToString());     }      /// &lt;summary&gt;    /// Given the selected Ids retrieve the picker relevant information from the database     /// &lt;/summary&gt;    /// &lt;param name="selectedIds"&gt;&lt;/param&gt;    /// &lt;param name="text"&gt;&lt;/param&gt;    /// &lt;param name="tooltip"&gt;&lt;/param&gt;    private static void InitialiseFromDatabase(int[] selectedIds, out string text, out string[] tooltip)     {       try       {         var db = new UserDb(DataAccessorFactory.CreateDataAccessor(GlobalSettings.DataAccessorType, GlobalSettings.ConnectionString));          //Initialise to null         text = null;         tooltip = null;          if (selectedIds != null)         {           if (selectedIds.Length &gt; 1)           {             //Multiple items selected             text = SharedLib.GetResourceString("CAPTION_VARIOUS");              //Get tooltip             tooltip = db.GetNamesForIds(selectedIds, RoleConst.ZcmTrader).ToArray();           }           else if (selectedIds.Length == 1)           {             //Single item selected             var item = db.GetUser(selectedIds[0]);             if (item != null) text = item.FullNameReverse;           }         }       }       catch (Exception e)       {         throw new Exception("Unable to initialise from database!", e);       }     }      #endregion   } }</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2775378557172568313'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2775378557172568313'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2656646150429713145</id><published>2012-05-09T09:27:00.001+01:00</published><updated>2012-05-09T09:27:23.377+01:00</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>HtmlHelperElementExtensions.cs</title><content type='html'>using Commerzbank.Pcs.Web.Gui.Shared; using System; using System.Collections; using System.Collections.Generic; using System.ComponentModel; using System.ComponentModel.DataAnnotations; using System.Linq; using System.Linq.Expressions; using System.Web.Mvc; using System.Web.Mvc.Html;  namespace Commerzbank.Pcs.Web.Helpers {   //Using these approaches:   //  http://stackoverflow.com/questions/2386365/maxlength-attribute-of-a-text-box-from-the-dataannotations-stringlength-in-mvc2    /// &lt;summary&gt;  /// MVC HtmlHelper extension methods - html element extensions   /// &lt;/summary&gt;  public static class HtmlHelperElementExtensions   {     /// &lt;summary&gt;    /// Create custom TextBox     ///  - maxlength property automatically set from StringLengthAttribute     ///  - disabled property set from parameter     /// &lt;/summary&gt;    /// &lt;returns&gt;a TextBox element&lt;/returns&gt;    public static MvcHtmlString CustomTextBoxFor&lt;TModel, TProperty&gt;(       this HtmlHelper&lt;TModel&gt; htmlHelper,       Expression&lt;Func&lt;TModel, TProperty&gt;&gt; expression,       object htmlAttributes,       bool enabled = true,       bool readOnly = false     )     {       var attributes = HtmlHelper.AnonymousObjectToHtmlAttributes(htmlAttributes);        if (!attributes.ContainsKey("maxlength"))       {         var member = expression.Body as MemberExpression;         if (member != null)         {           var stringLength = member.Member             .GetCustomAttributes(typeof(StringLengthAttribute), false)             .FirstOrDefault() as StringLengthAttribute;            if (stringLength != null)           {             attributes.Add("maxlength", stringLength.MaximumLength);           }         }       }        if ((!attributes.ContainsKey("disabled")) &amp;&amp; (!enabled))       {         attributes.Add("disabled", "disabled");       }        if ((!attributes.ContainsKey("readonly")) &amp;&amp; (readOnly))       {         attributes.Add("readonly", "readonly");       }        return htmlHelper.TextBoxFor(expression, attributes);     }      /// &lt;summary&gt;    /// Create date TextBox specifically for DealPrints     /// &lt;/summary&gt;    /// &lt;returns&gt;a TextBox element&lt;/returns&gt;    public static MvcHtmlString PrintDateTextBoxFor&lt;TModel&gt;(       this HtmlHelper&lt;TModel&gt; htmlHelper,       Expression&lt;Func&lt;TModel, string&gt;&gt; expression,       object htmlAttributes = null)     {       var name = ExpressionHelper.GetExpressionText(expression);        string str = expression.Compile().Invoke(htmlHelper.ViewData.Model);        // Here you can format value as you wish       string valueToShow = str         .ToDateTime()         .ToString(SharedLib.CurrentCulture.DateTimeFormat.ShortDatePattern);        return htmlHelper.TextBox(name, valueToShow, htmlAttributes);     }      /// &lt;summary&gt;    /// Create custom DropDownList     ///  - disabled property set from parameter     /// &lt;/summary&gt;    /// &lt;returns&gt;a TextBox element&lt;/returns&gt;    public static MvcHtmlString CustomDropDownListFor&lt;TModel, TProperty&gt;(       this HtmlHelper&lt;TModel&gt; htmlHelper,       Expression&lt;Func&lt;TModel, TProperty&gt;&gt; expression,       IEnumerable&lt;SelectListItem&gt; selectList,       object htmlAttributes,       bool enabled = true     )     {       var attributes = HtmlHelper.AnonymousObjectToHtmlAttributes(htmlAttributes);        if ((!attributes.ContainsKey("disabled")) &amp;&amp; (!enabled))       {         attributes.Add("disabled", "disabled");       }        return htmlHelper.DropDownListFor(expression, selectList, attributes);     }      /// &lt;summary&gt;    /// Create custom DropDownList     ///  - checked property set from parameter     /// &lt;/summary&gt;    /// &lt;returns&gt;a TextBox element&lt;/returns&gt;    public static MvcHtmlString CustomRadioButtonFor&lt;TModel, TProperty&gt;(       this HtmlHelper&lt;TModel&gt; htmlHelper,       Expression&lt;Func&lt;TModel, TProperty&gt;&gt; expression,       object value,       object htmlAttributes,       bool isChecked = false     )     {       var attributes = HtmlHelper.AnonymousObjectToHtmlAttributes(htmlAttributes);        if ((!attributes.ContainsKey("checked")) &amp;&amp; (isChecked))       {         attributes.Add("checked", "checked");       }        return htmlHelper.RadioButtonFor(expression, value, attributes);     }   } }</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2656646150429713145'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2656646150429713145'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-7794088803719419829</id><published>2012-05-09T09:26:00.001+01:00</published><updated>2012-05-09T09:26:39.172+01:00</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>HtmlHelperScriptExtensions.cs</title><content type='html'>using System; using System.Collections.Generic; using System.IO; using System.Web.Mvc; using System.Text;  namespace Commerzbank.Pcs.Web.Helpers {   /// &lt;summary&gt;  /// MVC HtmlHelper extension methods - javascript   ///    /// [NB: methods return a MvcHtmlString so that calls do not have to be inside Razor code blocks]   ///    /// [Links]   /// http://frugalcoder.us/post/2009/06/29/Handling-Scripts-in-ASPNet-MVC.aspx   /// http://stackoverflow.com/questions/5598167/mvc3-need-help-with-html-helper   ///    /// [Usage]   /// --- From each view / partial view ---   /// @Html.AddClientScript("~/Scripts/jquery.js")   /// @Html.AddClientScript("~/Scripts/jquery-ui.js")   /// @Html.AddClientScript("~/Scripts/site.js")   /// @Html.AddClientScript("~/Scripts/views/myview.js")   ///    /// --- From the main Master/View (just before last Body tag so all "registered" scripts are included) ---   /// @Html.ClientScripts()   /// &lt;/summary&gt;  /// &lt;history&gt;  ///   &lt;change&gt;&lt;date&gt;26/07/2011&lt;/date&gt;&lt;name&gt;Anthony Hand&lt;/name&gt;&lt;description&gt;Created&lt;/description&gt;&lt;/change&gt;  /// &lt;/history&gt;  public static class HtmlHelperScriptExtensions   {     /// &lt;summary&gt;    /// Add client script files to list of script files that will eventually be added to the view     /// &lt;/summary&gt;    /// &lt;param name="scriptPath"&gt;path to script file&lt;/param&gt;    /// &lt;param name="priority"&gt;priority of script 1-10 (1=highest, 10=lowest, default=5)&lt;/param&gt;    /// &lt;returns&gt;always MvcHtmlString.Empty&lt;/returns&gt;    /// &lt;history&gt;    ///   &lt;change&gt;&lt;date&gt;26/07/2011&lt;/date&gt;&lt;name&gt;Anthony Hand&lt;/name&gt;&lt;description&gt;Created&lt;/description&gt;&lt;/change&gt;    /// &lt;/history&gt;    public static MvcHtmlString AddClientScript(this HtmlHelper helper, string scriptPath, int priority = 5)     {       //Ensure priority is between 1 and 10       if (priority &gt; 10)         priority = 10;       else if (priority &lt; 1)         priority = 10;        var scripts = helper.ViewContext.HttpContext.Items["client-script-list"] as Dictionary&lt;string, KeyValuePair&lt;string, int&gt;&gt; ?? new Dictionary&lt;string, KeyValuePair&lt;string, int&gt;&gt;();        //Throw an exception if there is no file with the supplied path - presumably the page won't work without it       string scriptFilePath = helper.ViewContext.HttpContext.Server.MapPath(scriptPath);       if (!File.Exists(scriptFilePath))         throw new Exception("Unable to AddClientScript as " + scriptFilePath + " file does not exist");        //Ensure scripts are not added twice       var fi = new FileInfo(scriptFilePath);       if (scripts.ContainsKey(fi.FullName))       {         //If attempting to add a script which has already been added but with a lower (and hence more important) priority then ensure that existing script entry has its priority changed         if (scripts[fi.FullName].Value &gt; priority)           scripts[fi.FullName] = new KeyValuePair&lt;string, int&gt;(scriptPath, priority);          return MvcHtmlString.Empty;       }        //Add script to collection of scripts and save it away       scripts.Add(fi.FullName, new KeyValuePair&lt;string, int&gt;(scriptPath, priority));       helper.ViewContext.HttpContext.Items["client-script-list"] = scripts;        return MvcHtmlString.Empty;     }      /// &lt;summary&gt;    /// Add client script block to list of script blocks that will eventually be added to the view     /// &lt;/summary&gt;    /// &lt;param name="key"&gt;unique identifier for script block&lt;/param&gt;    /// &lt;param name="scriptBlock"&gt;script block&lt;/param&gt;    /// &lt;param name="priority"&gt;priority of script block 1-10 (1=highest, 10=lowest, default=5)&lt;/param&gt;    /// &lt;returns&gt;always MvcHtmlString.Empty&lt;/returns&gt;    /// &lt;history&gt;    ///   &lt;change&gt;&lt;date&gt;26/07/2011&lt;/date&gt;&lt;name&gt;Anthony Hand&lt;/name&gt;&lt;description&gt;Created&lt;/description&gt;&lt;/change&gt;    /// &lt;/history&gt;    public static MvcHtmlString AddClientScriptBlock(this HtmlHelper helper, string key, string scriptBlock, int priority = 5)     {       //Ensure priority is between 1 and 10       if (priority &gt; 10)         priority = 10;       else if (priority &lt; 1)         priority = 10;        var scripts = helper.ViewContext.HttpContext.Items["client-script-block-list"] as Dictionary&lt;string, KeyValuePair&lt;string, int&gt;&gt; ?? new Dictionary&lt;string, KeyValuePair&lt;string, int&gt;&gt;();        if (scripts.ContainsKey(key))         return MvcHtmlString.Empty;        helper.ViewContext.HttpContext.Items["client-script-block-list"] = scripts;       scripts.Add(key, new KeyValuePair&lt;string, int&gt;(scriptBlock, priority));        return MvcHtmlString.Empty;     }      /// &lt;summary&gt;    /// Add a script tag for each "registered" script associated with the current view.     /// Output script tags in order of priority 1- 10     /// &lt;/summary&gt;    /// &lt;returns&gt;MvcHtmlString&lt;/returns&gt;    /// &lt;history&gt;    ///   &lt;change&gt;&lt;date&gt;26/07/2011&lt;/date&gt;&lt;name&gt;Anthony Hand&lt;/name&gt;&lt;description&gt;Created&lt;/description&gt;&lt;/change&gt;    /// &lt;/history&gt;    public static MvcHtmlString ClientScripts(this HtmlHelper helper)     {       var url = new UrlHelper(helper.ViewContext.RequestContext, helper.RouteCollection);       var scripts = helper.ViewContext.HttpContext.Items["client-script-list"] as Dictionary&lt;string, KeyValuePair&lt;string, int&gt;&gt; ?? new Dictionary&lt;string, KeyValuePair&lt;string, int&gt;&gt;();        //Build script tag block       var sb = new StringBuilder();       if (scripts.Count &gt; 0)       { #if DEBUG         sb.AppendLine("&lt;!-- BEGIN - HtmlHelperScriptExtensions.ClientScripts() --&gt;"); #endif         for (int i = 1; i &lt;= 10; i++)         {           foreach (var script in scripts)           {             if (script.Value.Value == i)               sb.AppendLine(string.Format(                 "&lt;script src=\"{0}\" type=\"text/javascript\"&gt;&lt;/script&gt;",                 url.Content(script.Value.Key)               ));           }         } #if DEBUG         sb.Append("&lt;!-- END - HtmlHelperScriptExtensions.ClientScripts() --&gt;"); #endif       }        //Output script tag block at start of view (by calling response.write)       //var response = helper.ViewContext.HttpContext.Response;       //response.Write(sb.ToString());       //return MvcHtmlString.Empty;        //Output script tag block at point in view where method is called (by returning an MvcHtmlString)       return (sb.Length &gt; 0 ? MvcHtmlString.Create(sb.ToString()) : MvcHtmlString.Empty);     }      /// &lt;summary&gt;    /// Output all "registered" script blocks associated with the current view.     /// Output in order of priority 1- 10     /// &lt;/summary&gt;    /// &lt;returns&gt;MvcHtmlString&lt;/returns&gt;    /// &lt;history&gt;    ///   &lt;change&gt;&lt;date&gt;26/07/2011&lt;/date&gt;&lt;name&gt;Anthony Hand&lt;/name&gt;&lt;description&gt;Created&lt;/description&gt;&lt;/change&gt;    /// &lt;/history&gt;    public static MvcHtmlString ClientScriptBlocks(this HtmlHelper helper)     {       var url = new UrlHelper(helper.ViewContext.RequestContext, helper.RouteCollection);       var scripts = helper.ViewContext.HttpContext.Items["client-script-block-list"] as Dictionary&lt;string, KeyValuePair&lt;string, int&gt;&gt; ?? new Dictionary&lt;string, KeyValuePair&lt;string, int&gt;&gt;();        //Build script blocks section       var sb = new StringBuilder();       if (scripts.Count &gt; 0)       { #if DEBUG         sb.AppendLine("&lt;!-- BEGIN - HtmlHelperScriptExtensions.ClientScriptBlocks() --&gt;"); #endif         for (int i = 1; i &lt;= 10; i++)         {           foreach (var script in scripts)           {             if (script.Value.Value == i)             {               sb.AppendLine("&lt;script type=\"text/javascript\"&gt;");               sb.Append(script.Value.Key);               sb.AppendLine("&lt;/script&gt;");             }           }         } #if DEBUG         sb.Append("&lt;!-- END - HtmlHelperScriptExtensions.ClientScriptBlocks() --&gt;"); #endif       }        //Output script script blocks section at start of view (by calling response.write)       //var response = helper.ViewContext.HttpContext.Response;       //response.Write(sb.ToString());       //return MvcHtmlString.Empty;        //Output script blocks section at point in view where method is called (by returning an MvcHtmlString)       return (sb.Length &gt; 0 ? MvcHtmlString.Create(sb.ToString()) : MvcHtmlString.Empty);     }   } }</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7794088803719419829'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7794088803719419829'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3064131205462773780</id><published>2012-05-09T09:25:00.003+01:00</published><updated>2012-05-09T09:25:46.089+01:00</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>PickerExtensions.cs</title><content type='html'>using Commerzbank.Pcs.Web.Gui.Shared; using Commerzbank.Pcs.Data.Models.Attributes; using System; using System.Collections.Generic; using System.Linq; using System.Linq.Expressions; using System.Web.Mvc; using System.Web.Routing; using System.Web.Script.Serialization;  namespace Commerzbank.Pcs.Web.Helpers {   /// &lt;summary&gt;  /// MVC HtmlHelper extension methods - html element extensions   /// &lt;/summary&gt;  public static class PickerExtensions   {     #region Public      public static string GetIdContainer(this HtmlHelper helper, string id) { return id + "_Container"; }     public static string GetIdTextInput(this HtmlHelper helper, string id) { return id + "_Text"; }     public static string GetIdPickerButton(this HtmlHelper helper, string id) { return id + "_Picker"; }     public static string GetIdValueInput(this HtmlHelper helper, string id) { return id + "_Value"; }          /// &lt;summary&gt;    /// Render scripts for picker     /// &lt;/summary&gt;    /// &lt;param name="helper"&gt;&lt;/param&gt;    /// &lt;param name="multiSelect"&gt;&lt;/param&gt;    public static void AddPickerScripts(this HtmlHelper helper, bool multiSelect = false)     {       helper.AddClientScript(SharedLib.UrlPickerBase);              if (multiSelect)       {         helper.AddClientScript(SharedLib.UrlPickerTooltip);       }        helper.AddClientScript(SharedLib.UrlPickerInitialiser);     }      /// &lt;summary&gt;    /// Make a span to contain the picker     /// &lt;/summary&gt;    /// &lt;param name="helper"&gt;&lt;/param&gt;    /// &lt;param name="id"&gt;&lt;/param&gt;    /// &lt;returns&gt;&lt;/returns&gt;    public static TagBuilder MakePickerSpan(this HtmlHelper helper, string id)     {       var container = new TagBuilder("span");        container.Attributes["id"] = GetIdContainer(helper, id);       container.Attributes["class"] = "picker"; //picker class is used to set up pickers        return container;     }      /// &lt;summary&gt;    /// Create and return a textbox input element for use by pickers     /// &lt;/summary&gt;    /// &lt;param name="helper"&gt;&lt;/param&gt;    /// &lt;param name="id"&gt;&lt;/param&gt;    /// &lt;param name="text"&gt;&lt;/param&gt;    /// &lt;param name="cssClass"&gt;&lt;/param&gt;    /// &lt;param name="htmlAttributes"&gt;&lt;/param&gt;    /// &lt;returns&gt;&lt;/returns&gt;    public static MvcHtmlString AddPickerTextBox(this HtmlHelper helper, string id, string text, string cssClass, IDictionary&lt;string, object&gt; htmlAttributes)     {       var textbox = new TagBuilder("input");       textbox.MergeAttributes(htmlAttributes); //Merge passed in attributes       textbox.Attributes["type"] = "text";       textbox.Attributes["id"] = GetIdTextInput(helper, id);       textbox.Attributes["name"] = textbox.Attributes["id"]; //Name being rendered so submitted form will contain this       textbox.Attributes["class"] = (string.IsNullOrEmpty(cssClass) ? "readOnly" : cssClass) + " pickerText"; //pickerText class is used to wire up tooltip       textbox.Attributes["readonly"] = "readonly";       textbox.Attributes["value"] = text;              return MvcHtmlString.Create(textbox.ToString(TagRenderMode.SelfClosing));     }      /// &lt;summary&gt;    /// Create and return an input elipsis button element for use by pickers     /// &lt;/summary&gt;    /// &lt;param name="helper"&gt;&lt;/param&gt;    /// &lt;param name="id"&gt;&lt;/param&gt;    /// &lt;param name="enabled"&gt;&lt;/param&gt;    /// &lt;param name="elipsisButtonCssClass"&gt;&lt;/param&gt;    /// &lt;param name="addClearButton"&gt;&lt;/param&gt;    /// &lt;param name="clearButtonCssClass"&gt;&lt;/param&gt;    /// &lt;param name="pickerListUrl"&gt;&lt;/param&gt;    /// &lt;param name="type"&gt;&lt;/param&gt;    /// &lt;param name="position"&gt;&lt;/param&gt;    /// &lt;param name="title"&gt;&lt;/param&gt;    /// &lt;param name="multiSelect"&gt;&lt;/param&gt;    /// &lt;param name="useAdvancedPicker"&gt;&lt;/param&gt;    /// &lt;param name="tooltips"&gt;&lt;/param&gt;    /// &lt;param name="dbExtraSelectableValues"&gt;&lt;/param&gt;    /// &lt;param name="valuesToExclude"&gt;&lt;/param&gt;    /// &lt;param name="clearPickerFunction"&gt;&lt;/param&gt;    /// &lt;param name="setPickerFunction"&gt;&lt;/param&gt;    /// &lt;param name="getDynamicDataFunction"&gt;&lt;/param&gt;    /// &lt;param name="dialogWidth"&gt;&lt;/param&gt;    /// &lt;param name="dialogHeight"&gt;&lt;/param&gt;    /// &lt;param name="extraData"&gt;&lt;/param&gt;    /// &lt;param name="dynamicData"&gt;&lt;/param&gt;    /// &lt;returns&gt;&lt;/returns&gt;    public static MvcHtmlString AddPickerElipsisButton(this HtmlHelper helper, string id, bool enabled, string elipsisButtonCssClass,        bool addClearButton, string clearButtonCssClass,       string pickerListUrl, string type, PickerPosition position, string title,        bool multiSelect = false, bool useAdvancedPicker = false,        string[] tooltips = null, int[] dbExtraSelectableValues = null, int[] valuesToExclude = null,       string clearPickerFunction = null, string setPickerFunction = null, string getDynamicDataFunction = null,       string dialogWidth = null, string dialogHeight = null,       Dictionary&lt;string, object&gt; extraData = null,       Dictionary&lt;string, string&gt; dynamicData = null)     {       //Default dialog width/height       if (string.IsNullOrEmpty(dialogWidth)) dialogWidth = "250";       if (string.IsNullOrEmpty(dialogHeight)) dialogHeight = "228";        var elipsisButton = new TagBuilder("button");       elipsisButton.Attributes["type"] = "button";       elipsisButton.Attributes["id"] = GetIdPickerButton(helper, id);       var elipsisButtonCssClasses = (string.IsNullOrEmpty(elipsisButtonCssClass)) ? "elipsisButton" : elipsisButtonCssClass;       elipsisButton.Attributes["class"] = elipsisButtonCssClasses + " pickerInvoker"; //pickerInvoker used to wire up button       if (!enabled) elipsisButton.Attributes["disabled"] = "disabled";       elipsisButton.InnerHtml = "...";        //decorate elipsis button with data attributes used on setup       elipsisButton.Attributes["data-id"] = id;       elipsisButton.Attributes["data-type"] = type;       elipsisButton.Attributes["data-url-picker-data-loader"] = SharedLib.ProcessUrl("~/Shared/UserControls/PickerDataLoader.aspx");       elipsisButton.Attributes["data-url-picker-list"] = pickerListUrl;       elipsisButton.Attributes["data-dialog-width"] = dialogWidth;       elipsisButton.Attributes["data-dialog-height"] = dialogHeight;        //Only supply clear button attributes if we're going to add a clear button       if (addClearButton)       {         elipsisButton.Attributes["data-add-clear-button"] = "true";         elipsisButton.Attributes["data-clear-button-css-class"] = (string.IsNullOrEmpty(clearButtonCssClass))                                                                     ? "standardButton"                                                                     : clearButtonCssClass;         elipsisButton.Attributes["data-caption-clear"] = SharedLib.GetResourceString("CAPTION_CLEAR");       }        //Optional data attributes       if (position != PickerPosition.RelativeToSourceElement) elipsisButton.Attributes["data-dialog-position"] = ((int)position).ToString();       if (multiSelect)        {         elipsisButton.Attributes["data-multi-select"] = multiSelect.ToString().ToLower();         elipsisButton.Attributes["data-caption-various"] = SharedLib.GetResourceString("CAPTION_VARIOUS");       }       if (useAdvancedPicker) elipsisButton.Attributes["data-use-advanced-picker"] = useAdvancedPicker.ToString().ToLower();       if (!string.IsNullOrEmpty(title)) elipsisButton.Attributes["data-title"] = title;       if (!string.IsNullOrEmpty(clearPickerFunction)) elipsisButton.Attributes["data-function-clear-picker"] = clearPickerFunction; //Only render if set       if (!string.IsNullOrEmpty(setPickerFunction)) elipsisButton.Attributes["data-function-set-picker"] = setPickerFunction; //Only render if set        //Only render if supplied       if ((tooltips != null) ||(dbExtraSelectableValues != null) || (valuesToExclude != null))       {         var serializer = new System.Web.Script.Serialization.JavaScriptSerializer();         if (dbExtraSelectableValues != null) elipsisButton.Attributes["data-db-extra-selectable-values"] = serializer.Serialize(dbExtraSelectableValues);         if (valuesToExclude != null) elipsisButton.Attributes["data-values-to-exclude"] = serializer.Serialize(valuesToExclude);         if (tooltips != null) elipsisButton.Attributes["data-tool-tip"] = serializer.Serialize(tooltips);       }        //Render all extraData in the data attributes       if (extraData != null)       {         foreach (var keyValue in extraData)         {           if (!keyValue.Key.StartsWith("data-")) throw new Exception("All data attributes must begin \"data-\" - " + keyValue.Key + " does not.");            if (keyValue.Value is string)             elipsisButton.Attributes[keyValue.Key] = (string)keyValue.Value;           else if (keyValue.Value is int)             elipsisButton.Attributes[keyValue.Key] = Convert.ToString((int)keyValue.Value);           else if (keyValue.Value is bool)             elipsisButton.Attributes[keyValue.Key] = Convert.ToString((bool)keyValue.Value).ToLower();         }       }        //Render out dynamic data if there is any       if ((dynamicData != null) &amp;&amp; (dynamicData.Keys.Count &gt; 0))       {         elipsisButton.Attributes["data-dynamic"] = new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(dynamicData);       }        return MvcHtmlString.Create(elipsisButton.ToString());     }      /// &lt;summary&gt;    /// Create and return a "value" hidden input element for use by pickers     /// &lt;/summary&gt;    /// &lt;param name="helper"&gt;&lt;/param&gt;    /// &lt;param name="id"&gt;&lt;/param&gt;    /// &lt;param name="selectedIds"&gt;&lt;/param&gt;    /// &lt;returns&gt;&lt;/returns&gt;    public static MvcHtmlString AddPickerValue(this HtmlHelper helper, string id, int[] selectedIds)     {       return AddPickerValue(helper, id,         value: ((selectedIds == null)           ? "" //Clear value           : new JavaScriptSerializer().Serialize(selectedIds) //Serialise and save to screen           ));     }      /// &lt;summary&gt;    /// Create and return a "value" hidden input element for use by pickers - this version takes a string array as an input instead of the standard int array     /// &lt;/summary&gt;    /// &lt;param name="helper"&gt;&lt;/param&gt;    /// &lt;param name="id"&gt;&lt;/param&gt;    /// &lt;param name="selectedIds"&gt;&lt;/param&gt;    /// &lt;returns&gt;&lt;/returns&gt;    public static MvcHtmlString AddPickerValue(this HtmlHelper helper, string id, string[] selectedIds)     {       return AddPickerValue(helper, id,         value: ((selectedIds == null)           ? "" //Clear value           : new JavaScriptSerializer().Serialize(selectedIds) //Serialise and save to screen           ));     }      /// &lt;summary&gt;    /// Create and return a "value" hidden input element for use by pickers     /// &lt;/summary&gt;    /// &lt;param name="helper"&gt;&lt;/param&gt;    /// &lt;param name="id"&gt;&lt;/param&gt;    /// &lt;param name="value"&gt;&lt;/param&gt;    /// &lt;returns&gt;&lt;/returns&gt;    public static MvcHtmlString AddPickerValue(this HtmlHelper helper, string id, string value)     {       var valueInput = new TagBuilder("input");       valueInput.Attributes["type"] = "hidden";       valueInput.Attributes["id"] = GetIdValueInput(helper, id);       valueInput.Attributes["name"] = valueInput.Attributes["id"]; //Name being rendered so submitted form will contain this       valueInput.Attributes["class"] = "pickerValue"; //pickerValue class is used to identify hidden value field       valueInput.Attributes["value"] = value;        return MvcHtmlString.Create(valueInput.ToString(TagRenderMode.SelfClosing));     }      /// &lt;summary&gt;    /// Determine the selected ids for the current model     /// &lt;/summary&gt;    /// &lt;typeparam name="TModel"&gt;&lt;/typeparam&gt;    /// &lt;typeparam name="TProperty"&gt;&lt;/typeparam&gt;    /// &lt;param name="helper"&gt;&lt;/param&gt;    /// &lt;param name="expression"&gt;&lt;/param&gt;    /// &lt;param name="attributes"&gt;&lt;/param&gt;    public static int[] DetermineSelectedIds&lt;TModel, TProperty&gt;(       this HtmlHelper&lt;TModel&gt; helper,       Expression&lt;Func&lt;TModel, TProperty&gt;&gt; expression)     {       var value = ModelMetadata.FromLambdaExpression(expression, helper.ViewData).Model;       if (value is int)       {         if ((int)value == 0)         {           //value is 0 which means this is not yet set (as 0 is not a valid id in our data model) - as such return an empty array           return new int[0];         }         else         {           //value is a single integer - instantiate a new array with that single item and pass it back           return new int[] { (int)value };         }       }       else if (value == null)       {         //value is null which means this is not yet set - as such return an empty array         return new int[0];       }       else if (value is int[])       {         //value already is an integer array; cast it as that and return         return (int[])value;       }       else       {         throw new ArgumentException("This doesn't appear to be null, an integer or an integer array.  We don't know what to do with this...");       }     }      /// &lt;summary&gt;    /// Determine the date for the current model     /// &lt;/summary&gt;    /// &lt;typeparam name="TModel"&gt;&lt;/typeparam&gt;    /// &lt;typeparam name="TProperty"&gt;&lt;/typeparam&gt;    /// &lt;param name="helper"&gt;&lt;/param&gt;    /// &lt;param name="expression"&gt;&lt;/param&gt;    /// &lt;param name="attributes"&gt;&lt;/param&gt;    public static DateTime? DetermineDate&lt;TModel, TProperty&gt;(       this HtmlHelper&lt;TModel&gt; helper,       Expression&lt;Func&lt;TModel, TProperty&gt;&gt; expression)     {       var value = ModelMetadata.FromLambdaExpression(expression, helper.ViewData).Model;       if (value is string)       {         return (string.IsNullOrEmpty((string)value))           ? (DateTime?)null           : ((string)value).ToDateTime();       }       else if (value is DateTime)       {         return (DateTime)value;       }       else if (value is DateTime?)       {         return (DateTime?)value;       }       else if (value == null)       {         return null;       }       else       {         throw new Exception("This doesn't appear to be a datetime.  We don't know what to do with this...");       }     }      /// &lt;summary&gt;    /// Apply unobtrusive validation data attributes     /// &lt;/summary&gt;    /// &lt;typeparam name="TModel"&gt;&lt;/typeparam&gt;    /// &lt;typeparam name="TProperty"&gt;&lt;/typeparam&gt;    /// &lt;param name="helper"&gt;&lt;/param&gt;    /// &lt;param name="expression"&gt;&lt;/param&gt;    /// &lt;param name="attributes"&gt;&lt;/param&gt;    public static void ApplyUnobtrusiveValidationDataAttributes&lt;TModel, TProperty&gt;(       this HtmlHelper&lt;TModel&gt; helper,       Expression&lt;Func&lt;TModel, TProperty&gt;&gt; expression,       RouteValueDictionary attributes)     {       var member = expression.Body as MemberExpression;       if (member != null)       {         var required = member.Member           .GetCustomAttributes(typeof(LocalisedRequiredAttribute), false)           .FirstOrDefault() as LocalisedRequiredAttribute;          if (required != null)         {           //Ensure the data-val-required attribue is included in attributes if it is not already           if (!attributes.ContainsKey("data-val-required"))           {             attributes.Add("data-val-required", string.Format(SharedLib.GetResourceString("ERROR_FIELD_IS_REQUIRED"), helper.GetDisplayName(expression)));           }         }          bool addDataValAttribute = false;         foreach (var attribute in attributes)         {           //We've found a singe data-val prefixed attribute so we should add the data-val attribute if not already present           if (attribute.Key.StartsWith("data-val"))           {             addDataValAttribute = true;             break;           }         }         if ((addDataValAttribute) &amp;&amp; (!attributes.ContainsKey("data-val"))) attributes.Add("data-val", "true");       }     }      #endregion      #region Private       #endregion   } }</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3064131205462773780'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3064131205462773780'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8184167128326440562</id><published>2012-05-09T09:25:00.001+01:00</published><updated>2012-05-09T09:25:19.666+01:00</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>DatePickerExtensions.cs</title><content type='html'>using Commerzbank.Pcs.Data.Access; using Commerzbank.Pcs.Data.Models; using Commerzbank.Pcs.Web.Gui.Shared; using System; using System.Collections.Generic; using System.ComponentModel.DataAnnotations; using System.IO; using System.Linq; using System.Linq.Expressions; using System.Web.Mvc; using System.Web.Mvc.Html; using System.Web.WebPages; using System.Web.Routing; using System.Web.Script.Serialization; using System.Globalization; using System.Web;  namespace Commerzbank.Pcs.Web.Helpers {   /// &lt;summary&gt;  /// MVC HtmlHelper extension methods - html element extensions   /// &lt;/summary&gt;  public static class DatePickerExtensions   {     #region Public      /// &lt;summary&gt;    /// Render a DatePicker     /// &lt;/summary&gt;    /// &lt;param name="helper"&gt;&lt;/param&gt;    /// &lt;param name="id"&gt;&lt;/param&gt;    /// &lt;param name="htmlAttributes"&gt;&lt;/param&gt;    /// &lt;param name="date"&gt;&lt;/param&gt;    /// &lt;returns&gt;&lt;/returns&gt;    public static MvcHtmlString DatePicker(       this HtmlHelper helper,        string id, object htmlAttributes,       DateTime date)     {       var attributes = HtmlHelper.AnonymousObjectToHtmlAttributes(htmlAttributes);        return MakePicker(         helper: helper,         id: id,         attributes: attributes,         date: date);     }      /// &lt;summary&gt;    /// Render a DatePicker for an element     /// &lt;/summary&gt;    /// &lt;typeparam name="TModel"&gt;&lt;/typeparam&gt;    /// &lt;typeparam name="TProperty"&gt;&lt;/typeparam&gt;    /// &lt;param name="helper"&gt;&lt;/param&gt;    /// &lt;param name="expression"&gt;&lt;/param&gt;    /// &lt;param name="id"&gt;&lt;/param&gt;    /// &lt;param name="htmlAttributes"&gt;&lt;/param&gt;    /// &lt;returns&gt;&lt;/returns&gt;    public static MvcHtmlString DatePickerFor&lt;TModel, TProperty&gt;(       this HtmlHelper&lt;TModel&gt; helper,       Expression&lt;Func&lt;TModel, TProperty&gt;&gt; expression,       string id,        object htmlAttributes = null)     {       var attributes = HtmlHelper.AnonymousObjectToHtmlAttributes(htmlAttributes);        //Determine if unobtrusive validation attributes should be applied       helper.ApplyUnobtrusiveValidationDataAttributes&lt;TModel, TProperty&gt;(expression, attributes);        //Determine selectedIds for the model       var date = helper.DetermineDate&lt;TModel, TProperty&gt;(expression);        return MakePicker(         helper: helper,         id: id,         attributes: attributes,         date: date);     }      #endregion      #region Private      /// &lt;summary&gt;    /// Common private method for rendering picker     /// &lt;/summary&gt;    /// &lt;param name="helper"&gt;&lt;/param&gt;    /// &lt;param name="id"&gt;&lt;/param&gt;    /// &lt;param name="attributes"&gt;&lt;/param&gt;    /// &lt;param name="date"&gt;&lt;/param&gt;    /// &lt;returns&gt;&lt;/returns&gt;    private static MvcHtmlString MakePicker(       this HtmlHelper helper,        string id, RouteValueDictionary attributes,        DateTime? date = null)     {       var textbox = new TagBuilder("input");        textbox.MergeAttributes(attributes); //Merge passed in attributes       textbox.Attributes["type"] = "text";       textbox.Attributes["id"] = id;       textbox.Attributes["name"] = textbox.Attributes["id"]; //Name being rendered so submitted form will contain this        //Add datepicker class to any other classes that may already be in place       var cssClass = "datepicker";       if (textbox.Attributes.ContainsKey("class")) cssClass += " " + textbox.Attributes["class"];       textbox.Attributes["class"] = cssClass;        //If a date has been passed then store it away in a data attribute to be used on initialisation       if (date.HasValue) textbox.Attributes["data-date-for-initialisation"] = date.Value.ToISODateString();        textbox.Attributes["value"] = "";        //Determine culture - GUI culture for preference, user selected culture as fallback       var currentCulture = CultureInfo.CurrentCulture;       var filePattern = SharedLib.ScriptPath + "jquery/ui/i18n/jquery.ui.datepicker-{0}.js";       var regionalisedFileToUse = string.Format(filePattern, "en-GB"); //Default localisation to use        //Try to pick a more appropriate regionalisation       if (File.Exists(HttpContext.Current.Server.MapPath(string.Format(filePattern, currentCulture.Name)))) //First try for a jquery.ui.datepicker-en-GB.js style file         regionalisedFileToUse = string.Format(filePattern, currentCulture.Name);       else if (File.Exists(HttpContext.Current.Server.MapPath(string.Format(filePattern, currentCulture.TwoLetterISOLanguageName)))) //That failed; now try for a jquery.ui.datepicker-de.js style file         regionalisedFileToUse = string.Format(filePattern, currentCulture.TwoLetterISOLanguageName);        //Render scripts       helper.AddClientScript(SharedLib.UrljQueryUI, 3); //JQuery UI library - this is probably unnecessary as should be in page already       helper.AddClientScript(regionalisedFileToUse, 3); //script that is responsible for regionalising the date picker.  IMPORTANT THAT THIS IS BEFORE DatePicker.js IN ORDER THAT DATEPICKERS ARE ALL SET TO THE SAME REGIONALISATION       helper.AddClientScript(SharedLib.UrlDatePickerInitialiser, 4); //script that is responsible for initialising date pickers        return MvcHtmlString.Create(textbox.ToString(TagRenderMode.SelfClosing));     }      #endregion   } }</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8184167128326440562'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8184167128326440562'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5143753822429804028</id><published>2012-05-07T08:11:00.003+01:00</published><updated>2021-03-03T21:20:17.792Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='jqueryui'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Globalize.JS'/><category scheme='http://www.blogger.com/atom/ns#' term='javascript'/><category scheme='http://www.blogger.com/atom/ns#' term='ASP.NET AJAX'/><category scheme='http://www.blogger.com/atom/ns#' term='Globalization'/><category scheme='http://www.blogger.com/atom/ns#' term='Richard D. Worth'/><title type='text'>Globalize.js - number and date localisation made easy</title><content type='html'>&lt;p&gt;I wanted to write about a JavaScript library which seems to have had very little attention so far.  And that surprises me as it's&lt;/p&gt;&lt;ol&gt;&lt;li&gt;Brilliant!&lt;/li&gt;&lt;li&gt;Solves a common problem that faces many app developers who work in the wonderful world of web; myself included&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;The library is called Globalize.js and can be found on &lt;a href="https://github.com/jquery/globalize" target="_blank"&gt;GitHub here&lt;/a&gt;.  Globalize.js is a simple JavaScript library that allows you to format and parse numbers and dates in culture specific fashion.&lt;/p&gt; &lt;h4&gt;Why does this matter?&lt;/h4&gt; &lt;p&gt;Because different countries and cultures do dates and numbers in different ways.  Christmas Day this year in England will be &lt;code&gt;25/12/2012&lt;/code&gt; (dd/MM/yyyy).  But for American eyes this should be &lt;code&gt;12/25/2012&lt;/code&gt; (M/d/yyyy).  And for German &lt;code&gt;25.12.2012&lt;/code&gt; (dd.MM.yyyy).  Likewise, if I was to express numerically the value of "one thousand exactly - to 2 decimal places", as a UK citizen I would do it like so: &lt;code&gt;1,000.00&lt;/code&gt;.  But if I was French I'd express it like this: &lt;code&gt;1.000,00&lt;/code&gt;.  You see my point?&lt;/p&gt; &lt;h4&gt;Why does this matter to me?&lt;/h4&gt; &lt;p&gt;For a number of years I've been working on applications that are used globally, from London to Frankfurt to Shanghai to New York to Singapore and many other locations besides.  The requirement has always been to serve up localised dates and numbers so users experience of the system is more natural. Since our applications are all ASP.NET we've never really had a problem server-side.  Microsoft have blessed us with all the goodness of &lt;a href="http://msdn.microsoft.com/en-us/library/system.globalization.aspx" target="_blank"&gt;System.Globalization&lt;/a&gt; which covers hundreds of different cultures and localisations.  It makes it frankly easy:&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;using System.Globalization;&lt;br /&gt;&lt;br /&gt;//Produces: "06.05.2012"&lt;br /&gt;new DateTime(2012,5,6).ToString("d", new CultureInfo("de-DE")); &lt;br /&gt;&lt;br /&gt;//Produces: "45,56"&lt;br /&gt;45.56M.ToString("n", new CultureInfo("fr-FR")); &lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;The problem has always been client-side.  If you need to localise dates and numbers on the client what do you do?&lt;/p&gt; &lt;h4&gt;JavaScript Date / Number Localisation - the Status Quo&lt;/h4&gt; &lt;p&gt;Well to be frank - it's a bit rubbish really.  What's on offer natively at present basically amounts to this:&lt;/p&gt; &lt;ul&gt;&lt;li&gt;&lt;a href="https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Date/toLocaleDateString" target="_blank"&gt;Date.toLocaleDateString&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Number/ToLocaleString" target="_blank"&gt;Number.ToLocaleString&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt; &lt;p&gt;This is better than nothing - but not by much.  There's no real control or flexibility here.  If you don't like the native localisation format or you want something slightly different then tough.  This is all you've got to play with.&lt;/p&gt; &lt;p&gt;For the longest time this didn't matter too much.  Up until relatively recently the world of web was far more about the thin client and the fat server.  It would be quite standard to have all HTML generated on the server.  And, as we've seen .NET (and many other back end enviroments as well) give you all the flexiblility you might desire given this approach.&lt;/p&gt; &lt;p&gt;&lt;a href="http://www.youtube.com/watch?v=k2sYIIjS-cQ" target="_blank"&gt;But the times they are a-changing&lt;/a&gt;.  And given the ongoing explosion of HTML 5 the rich client is very definitely with us.  So we need tools.&lt;/p&gt; &lt;h4&gt;Microsoft doing *good things*&lt;/h4&gt;&lt;p&gt;Hands up who remembers when Microsoft first shipped it's &lt;a href="http://msdn.microsoft.com/en-us/magazine/cc163300.aspx" target="_blank"&gt;ASP.NET AJAX&lt;/a&gt; library back in 2007?&lt;/p&gt; &lt;p&gt;Well a small part of this was the extensions ASP.NET AJAX added to JavaScripts native Date and Number objects....  These extensions allowed the localisation of Dates and Numbers to the current UI culture and the subsequent string parsing of these back into Dates / Numbers.  These extensions pretty much gave JavaScript the functionality that the server already had in &lt;code&gt;System.Globalization&lt;/code&gt;. (not quite like-for-like but near enough the mark)&lt;/p&gt; &lt;p&gt;I'm not aware of a great fuss ever being made about this - a fact I find surprising since one would imagine this is a common need.  There's good documentation about this on MSDN - here's some useful links:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;a href="http://msdn.microsoft.com/en-us/library/bb386572.aspx" target="_blank"&gt;Ajax Script Globalization and Localization&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="http://msdn.microsoft.com/en-us/library/bb386581.aspx" target="_blank"&gt;Walkthrough: Globalizing a Date by Using Client Script&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="http://msdn.microsoft.com/en-us/library/bb397506.aspx" target="_blank"&gt;JavaScript Base Type Extensions&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="http://msdn.microsoft.com/en-us/library/bb397521.aspx" target="_blank"&gt;Date.parseLocale&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="http://msdn.microsoft.com/en-us/library/bb383816.aspx" target="_blank"&gt;Date.localeFormat&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="http://msdn.microsoft.com/en-us/library/bb310813.aspx" target="_blank"&gt;Number.localeFormat&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="http://msdn.microsoft.com/en-us/library/bb310985.aspx" target="_blank"&gt;Number.parseLocale&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;   &lt;p&gt;When our team became aware of this we started to make use of it in our web applications.  I imagine we weren't alone...&lt;/p&gt; &lt;h4&gt;Microsoft doing *even better things* (Scott Gu to the rescue!)&lt;/h4&gt; &lt;p&gt;I started to think about this again when MVC reared it's lovely head.&lt;/p&gt; &lt;p&gt;Like many, I found I preferred the separation of concerns / testability etc that MVC allowed.  As such, our team was planning to, over time, migrate our ASP.NET WebForms applications over to MVC.  However, before we could even begin to do this we had a problem.  Our JavaScript localisation was dependant on the ScriptManager.  The &lt;a href="http://msdn.microsoft.com/en-us/library/system.web.ui.scriptmanager.aspx" target="_blank"&gt;ScriptManager&lt;/a&gt; is very much a WebForms construct.&lt;/p&gt; &lt;p&gt;What to do?  To the users it wouldn't be acceptable to remove the localisation functionality from the web apps.  The architecture of an application is, to a certain extent, meaningless from the users perspective - they're only interested in what directly impacts them.  That makes sense, even if it was a problem for us.&lt;/p&gt; &lt;p&gt;Fortunately the Great Gu had it in hand. Lo and behold the &lt;a href="http://forum.jquery.com/topic/proposal-for-a-globalization-plugin-jquery-glob-js" target="_blank"&gt;this post&lt;/a&gt; appeared on the jQuery forum and the following post appeared on Guthrie's blog:&lt;/p&gt; &lt;p&gt;&lt;a href="http://weblogs.asp.net/scottgu/archive/2010/06/10/jquery-globalization-plugin-from-microsoft.aspx" target="_blank"&gt;http://weblogs.asp.net/scottgu/archive/2010/06/10/jquery-globalization-plugin-from-microsoft.aspx&lt;/a&gt;&lt;/p&gt; &lt;p&gt;Yes that's right.  Microsoft were giving back to the jQuery community by contributing a jQuery globalisation plug-in.  They'd basically taken the work done with ASP.NET AJAX Date / Number extensions, jQuery-plug-in-ified it and put it out there.  Fantastic!&lt;/p&gt; &lt;p&gt;Using this we could localise / globalise dates and numbers whether we were working in WebForms or in MVC.  Or anything else for that matter.  If we were suddenly seized with a desire to re-write our apps in PHP we'd *&lt;b&gt;still&lt;/b&gt;* be able to use Globalize.js on the client to handle our regionalisation of dates and numbers.&lt;/p&gt; &lt;h4&gt;History takes a funny course...&lt;/h4&gt; &lt;p&gt;Now for my part I would have expected that this announcement to be followed in short order by dancing in the streets and widespread adoption.  Surprisingly, not so.  All went quiet on the globalisation front for some time and then out of the blue the following comment appeared on the jQuery forum by &lt;a href="http://rdworth.org/blog/" target="_blank"&gt;Richard D. Worth&lt;/a&gt; (he of jQuery UI fame):&lt;/p&gt; &lt;p&gt;&lt;a href="http://blog.jquery.com/2011/04/16/official-plugins-a-change-in-the-roadmap/#comment-527484" target="_blank"&gt;http://blog.jquery.com/2011/04/16/official-plugins-a-change-in-the-roadmap/#comment-527484&lt;/a&gt;&lt;/p&gt; &lt;p&gt;The long and short of which was:&lt;/p&gt; &lt;ul&gt;&lt;li&gt;The jQuery UI team were now taking care of (the re-named) Globalize.js library as the grid control they were developing had a need for some of Globalize.js's goodness.  Consequently a home for Globalize.js appeared on the jQuery UI website: &lt;a href="http://wiki.jqueryui.com/Globalize" target="_blank"&gt;http://wiki.jqueryui.com/Globalize&lt;/a&gt;&lt;/li&gt;&lt;li&gt;The source of Globalize.js moved to this location on GitHub: &lt;a href="https://github.com/jquery/globalize/" target="_blank"&gt;https://github.com/jquery/globalize/&lt;/a&gt;&lt;/li&gt;&lt;li&gt;Perhaps most significantly, the jQuery globalisation plug-in as developed by Microsoft had now been made a standalone JavaScript library.  This was clearly brilliant news for Node.js developers as they would now be able to take advantage of this and perform localisation / globalisation server-side - they wouldn't need to have jQuery along for the ride.  Also, this would be presumably be good news for users of other client side JavaScript libraries like Dojo / YUI etc.&lt;/li&gt;&lt;/ul&gt; &lt;p&gt;Globalize.js clearly has a rosy future in front of it.  Using the new Globalize.js library was still simplicity itself.  Here's some examples of localising dates / numbers using the German culture:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;&amp;lt;script &lt;br /&gt;  src="/Scripts/Globalize/globalize.js" &lt;br /&gt;  type="text/javascript"&amp;gt;&amp;lt;/script&amp;gt;&lt;br /&gt;&amp;lt;script &lt;br /&gt;  src="/Scripts/Globalize/cultures/globalize.culture.de-DE.js" &lt;br /&gt;  type="text/javascript"&amp;gt;&amp;lt;/script&amp;gt;&lt;br /&gt;&lt;br /&gt;Globalize.culture("de-DE");&lt;br /&gt;&lt;br /&gt;//"2012-05-06" - ISO 8601 format&lt;br /&gt;Globalize.format(new Date(2012,4,6), "yyyy-MM-dd");&lt;br /&gt;&lt;br /&gt;//"06.05.2012" - standard German short date format of dd.MM.yyyy&lt;br /&gt;Globalize.format(new Date(2012,4,6), Globalize.culture().calendar.patterns.d);   &lt;br /&gt;&lt;br /&gt;//"4.576,3" - a number rendered to 1 decimal place&lt;br /&gt;Globalize.format(4576.34, "n1");&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt;  &lt;h4&gt;Stick a fork in it - it's done&lt;/h4&gt; &lt;p&gt;The entry for Globalize.js on the jQuery UI site reads as follows:&lt;/p&gt; &lt;p&gt;&lt;blockquote&gt;&lt;em&gt;"version: 0.1.0a1 (not a jQuery UI version number, as this is a standalone utility)&lt;br /&gt;status: in development (part of Grid project)"&lt;/em&gt;&lt;/blockquote&gt;&lt;/p&gt; &lt;p&gt;I held back from making use of the library for some time, deterred by the "in development" status.  However, I had a bit of dialog with one of the jQuery UI team (I forget exactly who) who advised that the API was unlikely to change further and that the codebase was actually pretty stable.  Our team did some testing of Globalize.js and found this very much to be case.  Everything worked just as we expected and hoped. We're now using Globalize.js in a production environment with no problems reported; it's been doing a grand job.&lt;/p&gt; &lt;p&gt;In my opinion,  Number / Date localisation on the client is ready for primetime right now - it works! Unfortunately, because Globalize.js has been officially linked in with the jQuery UI grid project it seems unlikely that this will officially ship until the grid does. Looking at the jQuery UI &lt;a href="http://wiki.jqueryui.com/Roadmap" target="_blank"&gt;roadmap&lt;/a&gt; the grid is currently slated to release with jQuery UI 2.1.  There isn't yet a release date for jQuery UI 1.9 and so it could be a long time before the grid actually sees the light of day.&lt;/p&gt; &lt;p&gt;I'm hoping that the jQuery UI team will be persuaded to "officially" release Globalize.js long before the grid actually ships.  Obviously people can use Globalize.js as is right now (as we are) but it seems a shame that many others will be missing out on using this excellent functionality, deterred by the "in development" status. Either way, &lt;a href="http://www.youtube.com/watch?v=qEMytPF8YuY" target="_blank"&gt;the campaign to release Globalise.js officially starts here!&lt;/a&gt;&lt;/p&gt; &lt;h4&gt;The Future?&lt;/h4&gt; &lt;p&gt;There are plans to bake globalisation right into JavaScript natively with EcmaScript 5.1.  There's a good post on the topic &lt;a href="http://generatedcontent.org/post/59403168016/esintlapi" target="_blank"&gt;here&lt;/a&gt;.  And here's a couple of historical links worth reading too:&lt;/p&gt; &lt;p&gt;&lt;a href="http://norbertlindenberg.com/2012/02/ecmascript-internationalization-api/" target="_blank"&gt;http://norbertlindenberg.com/2012/02/ecmascript-internationalization-api/&lt;/a&gt;&lt;br /&gt;&lt;a href="http://wiki.ecmascript.org/doku.php?id=globalization:specification_drafts" target="_blank"&gt;http://wiki.ecmascript.org/doku.php?id=globalization:specification_drafts&lt;/a&gt;&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5143753822429804028'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5143753822429804028'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2012/05/globalizejs-number-and-date.html' title='Globalize.js - number and date localisation made easy'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-999268661425648065</id><published>2012-04-30T10:46:00.003+01:00</published><updated>2012-04-30T10:46:41.513+01:00</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Weird scenario with DateTimes</title><content type='html'>Client in one time zone  Server in another  Create date on client  Send it to server  How does it treat this date?  Is it +/- for timezone?  If so then maybe you still need to use yyyy-MM-dd manually?</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/999268661425648065'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/999268661425648065'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3982373537320764154</id><published>2012-04-28T06:56:00.003+01:00</published><updated>2021-03-05T17:47:37.012Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='Date'/><category scheme='http://www.blogger.com/atom/ns#' term='Sebastian Markbge'/><category scheme='http://www.blogger.com/atom/ns#' term='DateTime'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='System.Web.Script.Serialization.JavaScriptSerializer'/><category scheme='http://www.blogger.com/atom/ns#' term='EMCAScript standard'/><category scheme='http://www.blogger.com/atom/ns#' term='json'/><category scheme='http://www.blogger.com/atom/ns#' term='javascript'/><category scheme='http://www.blogger.com/atom/ns#' term='Serialization'/><category scheme='http://www.blogger.com/atom/ns#' term='Nathan Vonnahme'/><title type='text'>Beg, Steal or Borrow a Decent JavaScript DateTime Converter</title><content type='html'>I've so named this blog post because it shamelessly borrows from the fine work of others: Sebastian Markbge and Nathan Vonnahme.&lt;br /&gt;&lt;br /&gt;Sebastian wrote a blog post documenting a good solution to the ASP.NET JavaScriptSerializer DateTime problem at the tail end of last year.  However, his solution didn't get me 100% of the way there when I tried to use it because of a need to support IE 8 which lead me to use Nathan Vonnahme's ISO 8601 JavaScript Date parser.&lt;br /&gt;&lt;br /&gt;I thought it was worth documenting this, hence this post, but just so I'm clear; the hard work here was done by Sebastian Markbge and Nathan Vonnahme and not me.  Consider me just a curator in this case.  The original blog posts that I am drawing upon can be found here: &lt;ol&gt;&lt;li&gt;&lt;a href="http://blog.calyptus.eu/seb/2011/12/custom-datetime-json-serialization/" target="_blank"&gt;http://blog.calyptus.eu/seb/2011/12/custom-datetime-json-serialization/&lt;/a&gt;&lt;br /&gt;&lt;br /&gt;and here:&lt;br /&gt;&lt;br /&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="http://n8v.enteuxis.org/2010/12/parsing-iso-8601-dates-in-javascript/" target="_blank"&gt;http://n8v.enteuxis.org/2010/12/parsing-iso-8601-dates-in-javascript/&lt;/a&gt;&lt;/li&gt;&lt;/ol&gt;&lt;h4&gt;DateTime, JSON, JavaScript Dates....&lt;/h4&gt;Like many, I've long been frustrated with the quirky DateTime serialisation employed by the &lt;code&gt;System.Web.Script.Serialization.JavaScriptSerializer&lt;/code&gt; class.  When serialising DateTimes so they can be JSON.parsed on the client, this serialiser uses the following approach: (from MSDN)&lt;br /&gt;&lt;br /&gt;&lt;a href="http://msdn.microsoft.com/en-us/library/system.web.script.serialization.javascriptserializer.aspx" target="_blank"&gt;&lt;i&gt;Date object, represented in JSON as "\/Date(number of ticks)\/". The number of ticks is a positive or negative long value that indicates the number of ticks (milliseconds) that have elapsed since midnight 01 January, 1970 UTC."&lt;/i&gt;&lt;/a&gt;&lt;br /&gt;&lt;br /&gt;Now this is not particularly helpful in my opinion because it's not human readable (at least not this human; perhaps &lt;a href="http://stackoverflow.com/users/22656/jon-skeet" target="_blank"&gt;Jon Skeet&lt;/a&gt;...) When consuming your data from web services / PageMethods using &lt;a href="http://api.jquery.com/jQuery.ajax/" target="_blank"&gt;jQuery.ajax&lt;/a&gt; you are landed with the extra task of having to convert what were DateTimes on the server from Microsofts string Date format (eg &lt;code&gt;"\/Date(1293840000000)\/"&lt;/code&gt;) into actual JavaScript Dates.&lt;br /&gt;&lt;br /&gt;It's also unhelpful because it's divergent from the approach to DateTime / Date serialisation used by a native JSON serialisers:&lt;br /&gt;&lt;br /&gt;&lt;div class="separator" style="clear: both; text-align: center;"&gt;&lt;a href="http://2.bp.blogspot.com/-hvx7-FcclNg/T5kFVqosRTI/AAAAAAAAANE/7QJXX5fTqWs/s1600/FireBug-Dates.png" imageanchor="1" style="margin-left:1em; margin-right:1em"&gt;&lt;img border="0" height="145" width="320" src="http://2.bp.blogspot.com/-hvx7-FcclNg/T5kFVqosRTI/AAAAAAAAANE/7QJXX5fTqWs/s320/FireBug-Dates.png" /&gt;&lt;/a&gt;&lt;/div&gt;&lt;br /&gt;Just as an aside it's worth emphasising that one of the limitations of JSON is that the JSON.parsing of a JSON.stringified date will *&lt;b&gt;not&lt;/b&gt;* return you to a JavaScript Date but rather an ISO 8601 date string which will need to be subsequently converted into a Date.  Not JSON's fault - essentially down to the absence of a Date literal within JavaScript.&lt;br /&gt;&lt;br /&gt;&lt;h4&gt;Making JavaScriptSerializer behave more JSON'y&lt;/h4&gt;Anyway, I didn't think there was anything I could really do about this in an ASP.NET classic / WebForms world because, to my knowledge, it is not possible to swap out the serialiser that is used.  JavaScriptSerializer is the only game in town.  (Though I am optimistic about the future; given the announcement that I first picked up on Rick Strahl's blog that &lt;a href="http://www.west-wind.com/weblog/posts/2012/Mar/09/Using-an-alternate-JSON-Serializer-in-ASPNET-Web-API" target="_blank"&gt;Json.NET was going to be adopted as the default JSON serializer for ASP.NET Web API&lt;/a&gt;; what with Json.NET having out-of-the-box &lt;a href="http://james.newtonking.com/archive/2009/02/20/good-date-times-with-json-net.aspx" target="_blank"&gt;ISO 8601 support&lt;/a&gt;.  I digress...)&lt;br /&gt;&lt;br /&gt;Because it can make debugging a much more straightforward process I place a lot of value on being able to read the network traffic that web apps generate.  It's much easier to drop into Fiddler / FireBug / Chrome dev tools etc and watch what's happening there and then instead of having to manually process the data separately first so that you can understand it.  I think this is nicely aligned with the &lt;a href="http://en.wikipedia.org/wiki/KISS_principle" target="_blank"&gt;KISS principle&lt;/a&gt;. For that reason I've been generally converting DateTimes to ISO 8601 strings on the server before returning them to the client.  A bit of extra overhead but generally worth it for the gains in clarity in my opinion.&lt;br /&gt;&lt;br /&gt;So I was surprised and delighted when I happened upon &lt;a href="http://blog.calyptus.eu/seb/2011/12/custom-datetime-json-serialization/" target="_blank"&gt;Sebastian Markbge's blog post&lt;/a&gt; which provided a DateTime JavaScriptConverter that could be plugged into the JavaScriptSerializer.  You can see the code below (or on Sebastian's original post with a good explanation of how it works):&lt;br /&gt;&lt;br /&gt;&lt;script src="https://gist.github.com/2489976.js?file=DateTimeJavaScriptConverter.cs"&gt;&lt;/script&gt;&lt;br /&gt;Using this converter meant that a DateTime that previously would have been serialised as &lt;code&gt;"\/Date(1293840000000)\/"&lt;/code&gt; would now be serialised as &lt;code&gt;"2011-01-01T00:00:00.0000000Z"&lt;/code&gt; instead.  This is entirely agreeable because &lt;ol&gt;&lt;li&gt;it's entirely clear what a &lt;code&gt;"2011-01-01T00:00:00.0000000Z"&lt;/code&gt; style date represents and&lt;/li&gt;&lt;li&gt;this is more in line with native browser JSON implementations and &lt;code&gt;&amp;lt;statingTheObvious&amp;gt;&lt;/code&gt;consistency is a good thing.&lt;code&gt;&amp;lt;/statingTheObvious&amp;gt;&lt;/code&gt;&lt;/li&gt;&lt;/ol&gt;&lt;br /&gt;&lt;h4&gt;Getting your web services to use the ISO 8601 DateTime Converter&lt;/h4&gt;Sebastian alluded in his post to a &lt;code&gt;web.config&lt;/code&gt; setting that could be used to get web services / pagemethods etc. implementing his custom DateTime serialiser.  This is it: &lt;br /&gt;&lt;br /&gt;&lt;script src="https://gist.github.com/2489976.js?file=web.config"&gt;&lt;/script&gt;&lt;br /&gt;With this in place your web services / page methods will happily be able to serialise / deserialise ISO style date strings to your hearts content.&lt;br /&gt;&lt;br /&gt;&lt;h4&gt;What no ISO 8601 date string Date constructor?&lt;/h4&gt;As I mentioned earlier, Sebastian's solution didn't get me 100% of the way there.  There was still a fly in the ointment in the form of IE 8.  Unfortunately IE 8 doesn't have JavaScript &lt;a href="https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Date/parse" target="_blank"&gt;Date constructor that takes ISO 8601 date strings&lt;/a&gt;.  This lead me to using Nathan Vonnahme's ISO 8601 JavaScript Date parser, the code of which is below (or see his original post &lt;a href="http://n8v.enteuxis.org/2010/12/parsing-iso-8601-dates-in-javascript/" target="_blank"&gt;here&lt;/a&gt;):&lt;br /&gt;&lt;br /&gt;&lt;script src="https://gist.github.com/2489976.js?file=parseISO8601Date.js"&gt;&lt;/script&gt;&lt;br /&gt;With this in place I could parse ISO 8601 Dates just like anyone else.  Great stuff.  &lt;code&gt;parseISO8601Date("2011-01-01T00:00:00.0000000Z")&lt;/code&gt; would give me a JavaScript Date of &lt;code&gt;Sat Jan 1 00:00:00 UTC 2011&lt;/code&gt;.&lt;br /&gt;&lt;br /&gt;Obviously in the fullness of time the parseISO8601Date solution should no longer be necessary because &lt;a href="http://es5.github.com/#x15.9.3.2" target="_blank"&gt;EcmaScript 5 specifies an ISO 8601 date string constructor&lt;/a&gt;.  However, in the interim Nathan's solution is a lifesaver.&lt;br /&gt;&lt;br /&gt;Thanks again both to Sebastian Markbge and Nathan Vonnahme who have both generously allowed me use their work as the basis for this post.&lt;br /&gt;&lt;br /&gt;&lt;h4&gt;PS And it would have worked if it wasn't for that pesky IE 9...&lt;/h4&gt;Subsequent to writing this post I thought I'd check that IE 9 had implemented a JavaScript Date constructor that would process an ISO 8601 date string like this: &lt;code&gt;new Date("2011-01-01T00:00:00.0000000Z")&lt;/code&gt;.  It hasn't.  Take a look:&lt;br /&gt;&lt;br /&gt;&lt;div class="separator" style="clear: both; text-align: center;"&gt;&lt;a href="http://4.bp.blogspot.com/-ln4ZIA5DzCE/T5uPzPMOVgI/AAAAAAAAANU/sscYVL9E0XQ/s1600/IE9%2B%2528shakes%2Bfist%2529.png" imageanchor="1" style="margin-left:1em; margin-right:1em"&gt;&lt;img border="0" height="86" width="320" src="http://4.bp.blogspot.com/-ln4ZIA5DzCE/T5uPzPMOVgI/AAAAAAAAANU/sscYVL9E0XQ/s320/IE9%2B%2528shakes%2Bfist%2529.png" /&gt;&lt;/a&gt;&lt;/div&gt;&lt;br /&gt;This is slightly galling as the above code works dandy in Firefox and Chrome.  As you can see from the screenshot you can get the JavaScript IE 9 Date constructor to play nice by trimming off the final 4 "0"'s from the string.  Frustrating.  Obviously we can still use Nathan's solution but it's a shame that we can't use the native support.&lt;br /&gt;&lt;br /&gt;Based on what I've read &lt;a href="http://msdn.microsoft.com/en-us/library/az4se3k1.aspx#Roundtrip" target="_blank"&gt;here&lt;/a&gt; I think it would be possible to amend Sebastians serializer to fall in line with IE 9's pendantry by changing this:&lt;br /&gt;&lt;br /&gt;&lt;pre&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;return new CustomString(((DateTime)obj).ToUniversalTime()&lt;br /&gt;&lt;br /&gt;  .ToString(&lt;b&gt;"O"&lt;/b&gt;)&lt;br /&gt;&lt;br /&gt;);&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;br /&gt;&lt;br /&gt;To this:&lt;br /&gt;&lt;br /&gt;&lt;pre&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;return new CustomString(((DateTime)obj).ToUniversalTime()&lt;br /&gt;&lt;br /&gt;  .ToString(&lt;b&gt;"yyyy'-'MM'-'dd'T'HH':'mm':'ss'.'fffzzz"&lt;/b&gt;)&lt;br /&gt;&lt;br /&gt;);&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;br /&gt;&lt;br /&gt;I've held off from doing this myself as I rather like Sebastian's idea of being able to use Microsoft's Round-trip ("O", "o") Format Specifier.  And it seems perverse that we should have to move away from using Microsoft's Round-trip Format Specifier purely because of (Microsoft's) IE!  But it's a possibility to consider and so I put it out there.  I would hope that MS will improve their JavaScript Date constructor with IE 10.  A missed opportunity if they don't I think.&lt;br /&gt;&lt;br /&gt;&lt;h4&gt;PPS Just when you thought is over... IE 9 was right!&lt;/h4&gt;Sebastian got in contact after I first published this post and generously pointed out that, contrary to my expectation, IE 9 technically had the correct implementation.  According to the &lt;a href="http://es5.github.com/#x15.9.1.15" target="_blank"&gt;EMCAScript standard&lt;/a&gt; the Date constructor should not allow more than millisecond precision. In this case, Chrome and Firefox are being less strict - not more correct.&lt;br /&gt;&lt;br /&gt;On reflection this does rather make sense as the result of a &lt;code&gt;JSON.stringify(new Date())&lt;/code&gt; never results in an ISO date string to the 10 millionths of a second detail.  Sebastian has himself stopped using Microsoft's Round-trip ("O", "o") Format Specifier in favour of this format string:&lt;br /&gt;&lt;br /&gt;&lt;pre&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;return new CustomString(((DateTime)obj).ToUniversalTime()&lt;br /&gt;&lt;br /&gt;  .ToString(&lt;b&gt;"yyyy-MM-ddTHH:mm:ss.fffZ"&lt;/b&gt;)&lt;br /&gt;&lt;br /&gt;);&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;br /&gt;&lt;br /&gt;This results in date strings that comply perfectly with the ECMAScript spec.  I suspect I'll switch to using this also now.  Though I'll probably leave the first part of the post intact as I think the background remains interesting.&lt;br /&gt;&lt;br /&gt;Thanks again Sebastian!</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3982373537320764154'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3982373537320764154'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2012/04/beg-steal-or-borrow-decent-javascript.html' title='Beg, Steal or Borrow a Decent JavaScript DateTime Converter'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='http://2.bp.blogspot.com/-hvx7-FcclNg/T5kFVqosRTI/AAAAAAAAANE/7QJXX5fTqWs/s72-c/FireBug-Dates.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5276415101034013869</id><published>2012-04-23T10:13:00.001+01:00</published><updated>2012-04-23T10:13:29.849+01:00</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Using Knockout.js with jQuery UI's "sortable"</title><content type='html'></content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5276415101034013869'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5276415101034013869'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1650084301619455408</id><published>2012-04-23T06:28:00.001+01:00</published><updated>2021-03-03T21:37:19.232Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='JSLint for Visual Studio'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Coverity'/><category scheme='http://www.blogger.com/atom/ns#' term='Anton Kovalyov'/><category scheme='http://www.blogger.com/atom/ns#' term='javascript'/><category scheme='http://www.blogger.com/atom/ns#' term='paul irish'/><category scheme='http://www.blogger.com/atom/ns#' term='static code analysis'/><category scheme='http://www.blogger.com/atom/ns#' term='JSLint'/><category scheme='http://www.blogger.com/atom/ns#' term='JSHint'/><category scheme='http://www.blogger.com/atom/ns#' term='douglas crockford'/><title type='text'>JSHint - Customising your hurt feelings</title><content type='html'>As I've started making greater use of JavaScript to give a richer GUI experience the amount of JS in my ASP.NET apps has unsurprisingly ballooned.  If I'm honest, I hadn't given much consideration to the code quality of my JavaScript in the past.  However, if I was going to make increasing use of it (and given the way the web is going at the moment I'd say that's a given) I didn't think this was tenable position to maintain.&lt;br /&gt;&lt;br /&gt;A friend of mine works for &lt;a href="http://www.coverity.com/" target="_blank"&gt;Coverity&lt;/a&gt; which is a company that provides tools for analysing code quality.  I understand, from conversations with him, that their tools provide static analysis for compiled languages such as C++ / C# / Java etc.  I was looking for something similar for JavaScript.&lt;br /&gt;&lt;br /&gt;Like many, I have read and loved &lt;a href="http://www.amazon.com/JavaScript-Good-Parts-Douglas-Crockford/dp/0596517742" target="_blank"&gt;Douglas Crockford's "JavaScript: The Good Parts"&lt;/a&gt;; it is by some margin the most useful and interesting software related book I have read.So I was aware that Crockford had come up with his own JavaScript code quality tool called &lt;a href="http://www.jslint.com/" target="_blank"&gt;JSLint&lt;/a&gt;. JSLint is quite striking when you first encounter it:&lt;br /&gt;&lt;br /&gt;&lt;div class="separator" style="clear: both; text-align: center;"&gt;&lt;a href="http://3.bp.blogspot.com/-IRjPn_4FyIU/T4_9K3LqNoI/AAAAAAAAAM0/2E_I1KSBPzQ/s1600/JSLint.png" imageanchor="1" style="margin-left:1em; margin-right:1em"&gt;&lt;img border="0" height="193" width="320" src="http://3.bp.blogspot.com/-IRjPn_4FyIU/T4_9K3LqNoI/AAAAAAAAAM0/2E_I1KSBPzQ/s320/JSLint.png" /&gt;&lt;/a&gt;&lt;/div&gt;&lt;br /&gt;It's the "Warning! JSLint will hurt your feelings." that grabs you.  And it's not wrong.  I've copied and pasted code that I've written into JSLint and then gasped at the reams of errors JSLint would produce.  I subsequently tried JSLint-ing various well known JS libraries (jQuery etc) and saw that JSLint considered they were thoroughly problematic as well.  This made me feel slightly better.&lt;br /&gt;&lt;br /&gt;It was when I started examining some of the "errors" JSLint reported that I took exception.  Yes, I took exception to exceptions! (I'm *&lt;b&gt;very&lt;/b&gt;* pleased with that!)  Here's a few of the errors generated by JSLint when inspecting &lt;a href="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.js" target="_blank"&gt;jquery-1.7.2.js&lt;/a&gt;: &lt;ul&gt;&lt;li&gt;&lt;code&gt;Problem at line 16 character 10: Expected exactly one space between 'function' and '('.&lt;/code&gt;&lt;/li&gt;&lt;li&gt;&lt;code&gt;Problem at line 25 character 1: Expected 'var' at column 13, not column 1.&lt;/code&gt;&lt;/li&gt;&lt;li&gt;&lt;code&gt;Problem at line 31 character 5: Unexpected dangling '_' in '_jQuery'.&lt;/code&gt;&lt;/li&gt;&lt;/ul&gt;&lt;br /&gt;JSLint is, much like it's creator, quite opinionated.  Which is no bad thing.  Many of Crockfords opinions are clearly worth their salt.  It's just I didn't want all of them enforced upon me.  As you can see above most of these "problems" are essentially complaints about a different style rather than bugs or potential issues.  Now there are options in JSLint that you can turn on and off which looked quite promising.  But before I got to investigating them I heard about &lt;a href="http://www.jshint.com" target="_blank"&gt;JSHint&lt;/a&gt;, brainchild of Anton Kovalyov and Paul Irish. In their own words:&lt;br /&gt;&lt;br /&gt;&lt;i&gt;JSHint is a fork of JSLint, the tool written and maintained by Douglas Crockford.&lt;br /&gt;&lt;br /&gt;The project originally started as an effort to make a more configurable version of JSLintone that doesn't enforce one particular coding style on its usersbut then transformed into a separate static analysis tool with its own goals and ideals.&lt;/i&gt;&lt;br /&gt;&lt;br /&gt;This sounded right up my alley!  So I thought I'd repeat my jQuery test.  Here's a sample of what JSHint threw back at me, with its default settings in place: &lt;ul&gt;&lt;li&gt;&lt;code&gt;Line 230: return num == null ?  Expected '===' and instead saw '=='. &lt;/code&gt;&lt;/li&gt;&lt;li&gt;&lt;code&gt;Line 352: if ( (options = arguments[ i ]) != null ) {  Expected '!==' and instead saw '!='. &lt;/code&gt;&lt;/li&gt;&lt;li&gt;&lt;code&gt;Line 354: for ( name in options ) {  The body of a for in should be wrapped in an if statement to filter unwanted properties from the prototype. &lt;/code&gt;&lt;/li&gt;&lt;/ul&gt;&lt;br /&gt;These were much more the sort of "issues" I was interested in.  Plus it seemed there was plenty of scope to tweak my options.  Excellent.&lt;br /&gt;&lt;br /&gt;This was good.  The icing on my cake would have been a plug-in for Visual Studio which would allow me to evaluate my JS files from within my IDE.  Happily the world seems to be full of developers doing good turns for one another.  I discovered an extension for VS called &lt;a href="http://jslint4vs2010.codeplex.com/" target="_blank"&gt;JSLint for Visual Studio 2010&lt;/a&gt;:&lt;br /&gt;&lt;br /&gt;&lt;div class="separator" style="clear: both; text-align: center;"&gt;&lt;a href="http://2.bp.blogspot.com/-KJysDr-ilyg/T4_v_CHwouI/AAAAAAAAAMo/YmgD3Yg17DU/s1600/Extensions.png" imageanchor="1" style="margin-left:1em; margin-right:1em"&gt;&lt;img border="0" height="186" width="320" src="http://2.bp.blogspot.com/-KJysDr-ilyg/T4_v_CHwouI/AAAAAAAAAMo/YmgD3Yg17DU/s320/Extensions.png" /&gt;&lt;/a&gt;&lt;/div&gt;&lt;br /&gt;This was an extension that provided either JSLint *&lt;b&gt;or&lt;/b&gt;* JSHint evaluation as you preferred from within Visual Studio.  Fantastic!  With this extension in play you could add JavaScript static code analysis to your compilation process and so learn of all the issues in your code at the same time, whether they lay in C# or JS or [insert language here].&lt;br /&gt;&lt;br /&gt;You could control how JS problems were reported; as warnings, errors etc.  You could straightforwardly exclude files from evaluation (essential if you're reliant on a number of 3rd party JS libraries which you are not responsible for maintaining).  You could cater for predefined variables; allow for jQuery or DOJO.  You could simply evaluate a single file in your solution by right clicking it and hitting the "JS Lint" option in the context menu.  And it was simplicity itself to activate and deactivate the JSHint / JSLint extension as required.&lt;br /&gt;&lt;br /&gt;For a more exhaustive round up of the options available I advise taking a look here: &lt;a href="http://jslint4vs2010.codeplex.com/" target="_blank"&gt;http://jslint4vs2010.codeplex.com&lt;/a&gt;.  I would heartily recommend using JSHint if you're looking to improve your JS code quality.  I'm grateful to Crockford for making JSHint possible by first writing JSLint.  For my part though I think JSHint is the more pragmatic and useful tool and likely to be the one I stick with.&lt;br /&gt;&lt;br /&gt;For interest (and frankly sheer entertainment value at the crotchetiness of Crockford) it's definitely worth having a read up on how JSHint came to pass: &lt;ul&gt;&lt;li&gt;&lt;a href="http://anton.kovalyov.net/2011/02/20/why-i-forked-jslint-to-jshint/" target="_blank"&gt;http://anton.kovalyov.net/2011/02/20/why-i-forked-jslint-to-jshint/&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="http://badassjs.com/post/3364925033/jshint-an-community-driven-fork-of-jslint" target="_blank"&gt;http://badassjs.com/post/3364925033/jshint-an-community-driven-fork-of-jslint&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1650084301619455408'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1650084301619455408'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2012/04/jshint-customising-your-hurt-feelings.html' title='JSHint - Customising your hurt feelings'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='http://3.bp.blogspot.com/-IRjPn_4FyIU/T4_9K3LqNoI/AAAAAAAAAM0/2E_I1KSBPzQ/s72-c/JSLint.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3499216697576394430</id><published>2012-04-21T09:58:00.000+01:00</published><updated>2012-04-21T09:58:49.712+01:00</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>LINQ IEnumerable vs IQueryable confusion</title><content type='html'>LINQ operations can be carried out on IEnumerable; not just IQueryable IQueryable inherits IEnumerable Both allow for deferred execution   http://stackoverflow.com/a/2876655/761388  The difference is that IQueryable&lt;T&gt; is the interface that allows LINQ-to-SQL (LINQ.-to-anything really) to work. So if you further refine your query on an IQueryable&lt;T&gt;, that query will be executed in the database, if possible.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3499216697576394430'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3499216697576394430'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4590188756877144861</id><published>2012-04-18T10:59:00.002+01:00</published><updated>2012-04-18T10:59:42.299+01:00</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Exception Handling - I didn't know what I didn't know...</title><content type='html'></content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4590188756877144861'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/4590188756877144861'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3945898129111205752</id><published>2012-04-17T16:07:00.000+01:00</published><updated>2012-04-17T16:07:25.509+01:00</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Example of generic method</title><content type='html'>public class ChangeLog   {     // type parameter T in angle brackets     public class ChangeLogGeneric&lt;T&gt;    {       /// &lt;summary&gt;      ///  Generate a list of list of ChangeLog entries given an old object, a new object and details of who did the update and when       /// &lt;/summary&gt;      public static List&lt;ChangeLog&gt; GenerateChangeLogs(T originalObject, T changedObject, int id, DateTime lastUpdated, int lastUpdatedUserId)       {         var list = new List&lt;ChangeLog&gt;();         try         {           //Get the ChangeLogEntityID           int changeLogEntityId = -1;  #if DEBUG           //If in Debug mode then set ChangeLogEntity - easier for anyone debugging - not necessary if in Prod mode           string changeLogEntity = ""; #endif            var aCustomAttributes = originalObject.GetType().GetCustomAttributes(false);           if (aCustomAttributes.Length &gt; 0)           {             //Look for a ChangeLogAttribute             foreach (var oCustomAttribute in aCustomAttributes)             {               if (oCustomAttribute is ChangeLogEntityAttribute)               {                 changeLogEntityId = ((ChangeLogEntityAttribute)oCustomAttribute).ChangeLogEntityId;  #if DEBUG                 changeLogEntity = ((ChangeLogEntityAttribute)oCustomAttribute).Name; #endif                 //Found a ChangeLogAttribute so no need to look for any more                 break;               }             }           }            //Check to see if a CheckForComplexDifferences method exists on the object being compared.  If so then call it.           Dictionary&lt;string, bool&gt; dComplexDifferences = null;           var mCheckForComplexDifferences = originalObject.GetType().GetMethod("CheckForComplexDifferences");           if (mCheckForComplexDifferences != null)           {             dComplexDifferences = (Dictionary&lt;string, bool&gt;)mCheckForComplexDifferences.Invoke(originalObject, new object[] { changedObject });           }            //Deserialise into JSON (less verbose than XML)           var oSerializer = new System.Web.Script.Serialization.JavaScriptSerializer();                      //Loop through properties           foreach (System.Reflection.PropertyInfo property in originalObject.GetType().GetProperties())           {             //Get old / new values             object oldValue = property.GetValue(originalObject, null);             object newValue = property.GetValue(changedObject, null);              var bLog = false; //Default to false              //Check to see if this property should be logged             int iChangeLogItemId = -1;             aCustomAttributes = property.GetCustomAttributes(false);             if (aCustomAttributes.Length &gt; 0)             {               //Look for a ChangeLogAttribute               foreach (var oCustomAttribute in aCustomAttributes)               {                 if (oCustomAttribute is ChangeLogItemAttribute)                 {                   iChangeLogItemId = ((ChangeLogItemAttribute)oCustomAttribute).ChangeLogItemId;                    //Has this been identified as a complex difference?                   if ((dComplexDifferences != null) &amp;&amp; (dComplexDifferences.ContainsKey(property.Name)))                   {                     //Find out from dictionary if this should be logged                     bLog = dComplexDifferences[property.Name];                   }                   else                   {                     //If not identified as a complex difference then do a simple Equals compare to see if needs to be logged                     bLog = (!Equals(oldValue, newValue));                   }                    //Found a ChangeLogAttribute so no need to look for any more                   break;                 }               }             }              if (bLog)             {               //Serialize to JSON for storage (used because less verbose and tricky to implement than XML)               var sJsonOldValue = oSerializer.Serialize(oldValue);               var sJsonNewValue = oSerializer.Serialize(newValue);                /* NB Not used at present but if Tibor keen to push on with rollback functionality then this may become necessary               //Look up the ChangeLogItemConst using the Property name - this approach not used as info available in the attribute               //Left in code because the approach could be useful in the future               ChangeLogItemConst changeLogItem = (ChangeLogItemConst)Enum.Parse(typeof(ChangeLogItemConst), property.Name);               */                                var oChangeLog = new ChangeLog(); #if DEBUG               //If in Debug mode then set ChangeLogEntity/ChangeLogItem - easier for anyone debugging - not necessary if in Prod mode               oChangeLog.ChangeLogEntity = changeLogEntity;               oChangeLog.ChangeLogItem = ((ChangeLogItemConst)Enum.Parse(typeof(ChangeLogItemConst), property.Name)).ToString(); #endif               oChangeLog.ChangeLogEntityId = changeLogEntityId;               oChangeLog.Id = id; //ID of object changed               oChangeLog.ChangeLogItemId = iChangeLogItemId;               oChangeLog.LastUpdated = lastUpdated;               oChangeLog.LastUpdatedUserId = lastUpdatedUserId;               oChangeLog.OldValue = sJsonOldValue;               oChangeLog.NewValue = sJsonNewValue;                //Only store Ids if int               if (property.PropertyType == typeof(int))               {                 //Store Ids if int                 //int oldId, newId;                 //bool oldIsInt = int.TryParse(oldValue.ToString(), out oldId);                 //bool newIsInt = int.TryParse(newValue.ToString(), out newId);                  //if (oldIsInt) oChangeLog.OldId = oldId;                 //if (newIsInt) oChangeLog.NewId = newId;               }                list.Add(oChangeLog);             }           }         }         catch (Exception exc)         {           throw new Exception("Problem generating ChangeLogs!", exc);         }         return list;       }        /// &lt;summary&gt;      ///  Given an original object a rollback date and a list of the Change entries for this object then rollback the supplied object to the specified rollback date       /// &lt;/summary&gt;      public static string RollbackObject(ref T originalObject, DateTime rollbackDate, List&lt;ChangeLog&gt; changes)       {         try         {           string sReturnRollbackVersion = "Rollback version not identified"; // Should never be returned - just initialised to this so any problems are picked up            //Remove unnecessary changes from list           var lRollbackProperties = new List&lt;int&gt;();           for (int i = (changes.Count - 1); i &gt;= 0; i--)           {             //Extract the generic ChangeLogItem for the rollback to be returned at the end of the method             if ((changes[i].LastUpdated == rollbackDate) &amp;&amp; (changes[i].ChangeLogItemId &lt; 100))             {               sReturnRollbackVersion = changes[i].ChangeLogItem + ": " + rollbackDate.ToString("yyyy-MM-dd HH:mm:ss.fff", System.Globalization.DateTimeFormatInfo.InvariantInfo);             }              //Remove ChangeLog entries where LastUpdated &lt;= dteRollbackDate             if (changes[i].LastUpdated &lt;= rollbackDate)             {               //This change is older or equal to the current rollback date so remove from list               changes.RemoveAt(i);                //Go to next iteration of loop               continue;             }              //Rollback             if (lRollbackProperties.Contains(changes[i].ChangeLogItemId))             {               //We already have this property to rollback to, so remove current item from list               changes.RemoveAt(i);             }             else             {               //Add to the list of RollbackProperties we have already obtained               lRollbackProperties.Add(changes[i].ChangeLogItemId);             }           }            //Serialize from JSON (less verbose than XML)           var oSerializer = new System.Web.Script.Serialization.JavaScriptSerializer();            //Modify original object taking the OldValue settings in the lChanges list           foreach(var changeLog in changes)           {             var property = originalObject.GetType().GetProperty(changeLog.ChangeLogItem);              //If property looked up then set it             if (property != null)             {               //Deserialisation old value from JSON to object               var oldValueAsObject = oSerializer.Deserialize(changeLog.OldValue, property.PropertyType);                //Set value               property.SetValue(originalObject, oldValueAsObject, null);             }           }            //Return rollback version           return sReturnRollbackVersion;         }         catch (Exception exc)         {           throw new Exception("Problem rolling back!", exc);         }       }     }      #region Public Properties     /// &lt;summary&gt;    /// Indicates which entity this change log represents (initially only entity will be Deal)     /// &lt;/summary&gt;    public int ChangeLogEntityId { get; set; }      public string ChangeLogEntity { get; set; }      /// &lt;summary&gt;    /// This will be DealId / CompanyId etc (an entity can only be changelogged if it has an integer identity field)     /// &lt;/summary&gt;    public int Id { get; set; }      public int ChangeLogItemId { get; set; }     public string ChangeLogItem { get; set; }     public bool DisplayToUser { get; set; }     public DateTime? LastUpdated { get; set; }     public int LastUpdatedUserId { get; set; }     public string LastUpdatedUser { get; set; }     public string OldValue { get; set; }     public string NewValue { get; set; }     #endregion      #region Constructors/Finalizers     public ChangeLog()     {       ChangeLogItem = "";       DisplayToUser = true;       LastUpdatedUser = "";       OldValue = "";       NewValue = "";     }     #endregion   }</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3945898129111205752'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3945898129111205752'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-7337040570188991076</id><published>2012-04-16T10:12:00.001+01:00</published><updated>2021-03-03T21:01:32.977Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='constructor'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='unit testing'/><category scheme='http://www.blogger.com/atom/ns#' term='InternalsVisibleTo'/><category scheme='http://www.blogger.com/atom/ns#' term='MOQ'/><category scheme='http://www.blogger.com/atom/ns#' term='mocking'/><title type='text'>A Simple Technique for Initialising Properties with Internal Setters for Unit Testing</title><content type='html'>&lt;p&gt;I was recently working with my colleagues on refactoring a legacy application.  We didn't have an immense amount of time available for this but the plan was to try and improve what was there as much as possible.  In its initial state the application had no unit tests in place at all and so the plan was to refactor the code base in such a way as to make testing it a realistic proposition.  To that end the &lt;a href="http://en.wikipedia.org/wiki/Domain_layer" target="_blank"&gt;domain layer&lt;/a&gt; was being heavily adjusted and the GUI was being migrated from WebForms to MVC 3.  The intention was to build up a pretty solid collection of unit tests.  However, as we were working on this we realised we had a problem with  properties on our models with &lt;a href="http://msdn.microsoft.com/en-us/library/7c5ka91b(v=vs.80).aspx" target="_blank"&gt;&lt;code&gt;internal&lt;/code&gt;&lt;/a&gt; setters...&lt;/p&gt; &lt;h4&gt;Background&lt;/h4&gt;&lt;p&gt;The entities of the project in question used an approach which would store pertinent bits of &lt;a href="http://en.wikipedia.org/wiki/Database_normalization" target="_blank"&gt;normalised&lt;/a&gt; data for read-only purposes in related entities.  I've re-read that sentence and realise it's as clear as mud.  Here is an example to clarify:&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;&lt;br /&gt;public class Person&lt;br /&gt;{&lt;br /&gt;  public int Id { get; set; }&lt;br /&gt;  public string FirstName { get; set; }&lt;br /&gt;  public string LastName { get; set; }&lt;br /&gt;  public string Address { get; set; }&lt;br /&gt;  public DateTime DateOfBirth { get; set; }&lt;br /&gt;  /* Other fascinating properties... */&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;public class Order&lt;br /&gt;{&lt;br /&gt;  public int Id { get; set; }&lt;br /&gt;  public string ProductOrdered { get; set; }&lt;br /&gt;  public string OrderedById { get; set; }&lt;br /&gt;  public string OrderedByFirstName { get; internal set; }&lt;br /&gt;  public string OrderedByLastName { get; internal set; }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;In the example above you have 2 types of entity: &lt;code&gt;Person&lt;/code&gt; and &lt;code&gt;Order&lt;/code&gt;.  The &lt;code&gt;Order&lt;/code&gt; entity makes use of the the &lt;code&gt;Id&lt;/code&gt;, &lt;code&gt;FirstName&lt;/code&gt; and &lt;code&gt;LastName&lt;/code&gt; properties of the &lt;code&gt;Person&lt;/code&gt; entity in the properties &lt;code&gt;OrderedById&lt;/code&gt;, &lt;code&gt;OrderedByFirstName&lt;/code&gt; and &lt;code&gt;OrderedByLastName&lt;/code&gt;.  For persistence (ie saving to the database) purposes the only necessary &lt;code&gt;Person&lt;/code&gt; property is &lt;code&gt;OrderedById&lt;/code&gt; identity.  &lt;code&gt;OrderedByFirstName&lt;/code&gt; and &lt;code&gt;OrderedByLastName&lt;/code&gt; are just "nice to haves" - essentially present to make implementing the GUI more straightforward.&lt;/p&gt; &lt;p&gt;To express this behaviour / intention in the object model the setters for &lt;code&gt;OrderedByFirstName&lt;/code&gt; and &lt;code&gt;OrderedByLastName&lt;/code&gt; are marked as &lt;code&gt;internal&lt;/code&gt;.  The implication of this is that properties like this can only be initialised within the current assembly - or any explicitly associated "friend" assemblies.  In practice this meant that internally set properties were only populated when an object was read in from the database.  It wasn't possible to set these properties in other assemblies which meant less code was written (&lt;u&gt;a good thing&lt;/u&gt;) - after all, why set a property when you don't need to?&lt;/p&gt; &lt;p&gt;Background explanation over.  It may still be a little unclear but I hope you get the gist.&lt;/p&gt; &lt;h4&gt;What's our problem?&lt;/h4&gt; &lt;p&gt;I was writing unit tests for the controllers in our main web application and was having problems with my arrangements.  I was mocking the database calls in my controllers much in the manner that you might expect:&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-ts"&gt;&lt;br /&gt;  // Arrange&lt;br /&gt;  var orderDb = new Mock&amp;lt;IOrderDb&amp;gt;();&lt;br /&gt;  orderDb&lt;br /&gt;    .Setup(x =&gt; x.GetOrder(It.IsAny&amp;lt;int&amp;gt;()))&lt;br /&gt;    .Returns(new Order{&lt;br /&gt;      Id = 123,&lt;br /&gt;      ProductOrdered = "Packet of coffee",&lt;br /&gt;      OrderedById = 987456,&lt;br /&gt;      OrderedByFirstName = "John",&lt;br /&gt;      OrderedByLastName = "Reilly"&lt;br /&gt;    });&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;All looks fine doesn't it?  It's not.  Because &lt;code&gt;OrderedByFirstName&lt;/code&gt; and &lt;code&gt;OrderedByLastName&lt;/code&gt; have internal setters we are &lt;u&gt;unable&lt;/u&gt; to initialise them from within the context of our test project.  So what to do?&lt;/p&gt; &lt;p&gt;We toyed with 3 approaches and since each has merits I thought it worth going through each of them:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;p&gt;To the MOQumentation Batman!: &lt;a href="http://code.google.com/p/moq/wiki/QuickStart" target="_blank"&gt;http://code.google.com/p/moq/wiki/QuickStart&lt;/a&gt;!  Looking at the MOQ documentation it states the following:&lt;/p&gt; &lt;p&gt;&lt;em&gt;Mocking internal types of another project: add the following assembly attributes (typically to the AssemblyInfo.cs) to the project containing the internal types:&lt;/em&gt;&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;// This assembly is the default dynamic assembly generated Castle DynamicProxy, &lt;br /&gt;// used by Moq. Paste in a single line.&lt;br /&gt;[assembly:InternalsVisibleTo("DynamicProxyGenAssembly2,PublicKey=0024000004800000940000000602000000240000525341310004000001000100c547cac37abd99c8db225ef2f6c8a3602f3b3606cc9891605d02baa56104f4cfc0734aa39b93bf7852f7d9266654753cc297e7d2edfe0bac1cdcf9f717241550e0a7b191195b7667bb4f64bcb8e2121380fd1d9d46ad2d92d2d15605093924cceaf74c4861eff62abf69b9291ed0a340e113be11e6a7d3113e92484cf7045cc7")]&lt;br /&gt;[assembly: InternalsVisibleTo("The.NameSpace.Of.Your.Unit.Test")] //I'd hope it was shorter than that...&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;This looked to be exactly what we needed and in most situations it would make sense to go with this.  Unfortunately for us there was a gotcha.  Certain core shared parts of our application platform were &lt;a href="http://en.wikipedia.org/wiki/Global_Assembly_Cache" target="_blank"&gt;GAC&lt;/a&gt;'d.  A requirement for GAC-ing an assembly is that it is &lt;a href="http://msdn.microsoft.com/en-us/library/xc31ft41.aspx" target="_blank"&gt;signed&lt;/a&gt;.&lt;/p&gt; &lt;p&gt;The upshot of this was that if we wanted to use the &lt;code&gt;InternalsVisibleTo&lt;/code&gt; approach then we would need to sign our web application test project.  We weren't particularly averse to that and initially did so without much thought.  It was then we remembered that every assembly referenced by a signed assembly must also be signed as well.  We didn't really want to sign our main web application purely for testing purposes.  We could and if there weren't viable alternatives we well might have.  But it just seemed like the wrong reason to be taking that decision.  Like using a sledgehammer to crack a nut.&lt;/p&gt;&lt;/li&gt; &lt;li&gt;&lt;p&gt;The next approach we took was using mock objects.  Instead of using our objects straight we would mock them as below:&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;      //Create mock and set internal properties&lt;br /&gt;      var orderMock = new Mock&amp;lt;Order&amp;gt;();&lt;br /&gt;      orderMock.SetupGet(x =&gt; x.OrderedByFirstName).Returns("John");&lt;br /&gt;      orderMock.SetupGet(x =&gt; x.OrderedByLastName).Returns("Reilly");&lt;br /&gt;&lt;br /&gt;      //Set up standard properties&lt;br /&gt;      orderMock.SetupAllProperties();&lt;br /&gt;      var orderStub = orderMock.Object;&lt;br /&gt;      orderStub.Id = 123;&lt;br /&gt;      orderStub.ProductOrdered = "Packet of coffee";&lt;br /&gt;      orderStub.OrderedById = 987456;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Now this approach worked fine but had a couple of snags: &lt;ul&gt;&lt;li&gt;As you can see it's pretty verbose and much less clear to read than it was previously.&lt;/li&gt;&lt;li&gt;It required that we add the &lt;code&gt;virtual&lt;/code&gt; keyword to all our internally set properties like so: &lt;/p&gt; &lt;pre class="prettyprint"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;public class Order&lt;br /&gt;{&lt;br /&gt;  // ....&lt;br /&gt;  public virtual string OrderedByFirstName { get; internal set; }&lt;br /&gt;  public virtual string OrderedByLastName { get; internal set; }&lt;br /&gt;  // ...&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;/li&gt;&lt;li&gt;Our standard constructor already initialised the value of our internally set properties.  So adding &lt;code&gt;virtual&lt;/code&gt; to the internally set properties generated &lt;a href="http://www.jetbrains.com/resharper/" target="_blank"&gt;ReSharper&lt;/a&gt; warnings aplenty about virtual properties being initialised in the constructor.  Fair enough.&lt;/li&gt;&lt;/ul&gt; &lt;p&gt;Because of the snags it still felt like we were in nutcracking territory...&lt;/p&gt; &lt;/li&gt;&lt;li&gt;... and this took us to the approach that we ended up adopting: a special mocking constructor for each class we wanted to test, for example:   &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;    /// &lt;summary&gt;&lt;br /&gt;    /// Mocking constructor used to initialise internal properties&lt;br /&gt;    /// &lt;/summary&gt;&lt;br /&gt;    public Order(string orderedByFirstName = null, string orderedByLastName = null)&lt;br /&gt;      : this()&lt;br /&gt;    {&lt;br /&gt;      OrderedByFirstName = orderedByFirstName;&lt;br /&gt;      OrderedByLastName = orderedByLastName;&lt;br /&gt;    }&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Thanks to the ever lovely &lt;a href="http://msdn.microsoft.com/en-us/library/dd264739.aspx" target="_blank"&gt;Named and Optional Arguments&lt;/a&gt; feature of C# combined with &lt;a href="http://msdn.microsoft.com/en-us/library/bb397680.aspx" target="_blank"&gt;Object Initializers&lt;/a&gt; it meant it was possible to write quite expressive, succinct code using this approach; for example:&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;      var order = new Order(&lt;br /&gt;        orderedByFirstName: "John",&lt;br /&gt;        orderedByLastName: "Reilly"&lt;br /&gt;      )&lt;br /&gt;      {&lt;br /&gt;        Id = 123,&lt;br /&gt;        ProductOrdered = "Packet of coffee",&lt;br /&gt;        OrderedById = 987456&lt;br /&gt;      };&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Here we're calling the mocking constructor to set the internally set properties and subsequently initialising the other properties using the object initialiser mechanism.&lt;/p&gt; &lt;p&gt;Implementing these custom constructors wasn't a massive piece of work and so we ended up settling on this technique for initialising internal properties.&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7337040570188991076'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7337040570188991076'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2012/04/simple-technique-for-initialising.html' title='A Simple Technique for Initialising Properties with Internal Setters for Unit Testing'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8680133602632737625</id><published>2012-04-05T08:45:00.001+01:00</published><updated>2021-03-14T05:11:55.554Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='wkhtmltopdf'/><category scheme='http://www.blogger.com/atom/ns#' term='webkit'/><category scheme='http://www.blogger.com/atom/ns#' term='c#'/><category scheme='http://www.blogger.com/atom/ns#' term='html'/><category scheme='http://www.blogger.com/atom/ns#' term='pdf'/><title type='text'>Making PDFs from HTML in C# using WKHTMLtoPDF</title><content type='html'>&lt;h4&gt;Update 03/01/2013&lt;/h4&gt; &lt;p&gt;I've written a subsequent post which builds on the work of this original post.  The new post exposes this functionality via a WCF service and can be found &lt;a href="http://icanmakethiswork.blogspot.co.uk/2013/01/html-to-pdf-using-wcf-service.html" target="_blank"&gt;here&lt;/a&gt;.&lt;/p&gt; &lt;h4&gt;Making PDFs from HTML&lt;/h4&gt; &lt;p&gt;I wanted to talk about an approach I've discovered for making PDFs directly from HTML.  I realise that in these wild and crazy days of &lt;a href="http://mozilla.github.com/pdf.js/" target="_blank"&gt;PDF.js&lt;/a&gt; and the like that techniques like this must seem very old hat.  That said, this technique works and more importantly it solves a problem I was faced with but without forcing the users to move the "newest hottest version of X".  Much as many of would love to solve problems this way, alas many corporations move slower than that and in the meantime we still have to deliver - we still have to meet requirements.  Rather than just say "I did this" I thought I'd record how I got to this point in the first place. I don't know about you but I find the reasoning behind why different technical decisions get made quite an interesting topic...&lt;/p&gt; &lt;p&gt;For some time I've been developing / supporting an application which is used in an intranet environment where the company mandated browser is still IE 6.  It was a requirement that there be "print" functionality in this application.  As is well known (even by Microsoft themselves) the print functionality in IE 6 was never fantastic.  But the requirement for usable printouts remained.&lt;/p&gt; &lt;p&gt;The developers working on the system before me decided to leverage Crystal Reports (remember that?).  Essentially there was a reporting component to the application at the time which created custom reports using Crystal and rendered them to the user in the form of PDFs (which have been eminently printable for as long as I care to remember).  One of the developers working on the system realised that it would be perfectly possible to create some "reports" within Crystal which were really "print to PDF" screens for the app.&lt;/p&gt; &lt;p&gt;It worked well and this solution stayed in place for a very long time.  However, some years down the line the Crystal Reports was discarded as the reporting mechanism for the app.  But we were unable to decommission Crystal entirely because we still needed it for printing.&lt;/p&gt; &lt;p&gt;I'd never really liked the Crystal solution for a number of reasons:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;We needed custom stored procs to drive the Crystal print screens which were near duplicates of the main app procs.  This duplication of effort never felt right.&lt;/li&gt;&lt;li&gt;We had to switch IDEs whenever we were maintaining our print screens.  And the Crystal IDE is not a joy to use.&lt;/li&gt;&lt;li&gt;Perhaps most importantly, for certain users we needed to hide bits of information from the print.  The version of Crystal we were using did not make the dynamic customisation of our print screens a straightforward proposition. (In its defence we weren't really using it for what it was designed for.)  As a result the developers before me had ended up creating various versions of each print screen revealing different levels of information.  As you can imagine, this meant that the effort involved in making changes to the print screens had increased exponentially&lt;/li&gt;&lt;/ol&gt; &lt;p&gt;It occurred to me that it would be good if we could find some way of generating our own PDF reports without using Crystal that would be a step forward.  It was shortly after this that I happened upon &lt;a href="http://code.google.com/p/wkhtmltopdf/" target="_blank"&gt;WKHTMLtoPDF&lt;/a&gt;.  This is an open source project which describes itself as a &lt;i&gt;"Simple shell utility to convert html to pdf using the webkit rendering engine, and qt."&lt;/i&gt;  I tested it out on various websites and it worked.  It wasn't by any stretch of the imagination a perfect HTML to PDF tool but the quality it produced greatly outstripped the presentation currently in place via Crystal.&lt;/p&gt; &lt;p&gt;This was just the ticket.  Using WKHTMLtoPDF I could have simple web pages in the application which could be piped into WKHTMLtoPDF to make a PDF as needed.  It could be dynamic - because ASP.NET is dynamic.  We wouldn't need to write and maintain custom stored procs anymore.  And happily we would no longer need to use Crystal.&lt;/p&gt; &lt;p&gt;Before we could rid ourselves of Crystal though, I needed a way that I could generate these PDFs on the fly within the website.  For this I ended up writing a simple wrapper class for WKHTMLtoPDF which could be used to invoke it on the fly.  In fact a good portion of this was derived from various contributions on &lt;a href="http://stackoverflow.com/q/1331926" target="_blank"&gt;a post on StackOverflow&lt;/a&gt;.  It ended up looking like this:&lt;/p&gt; &lt;script src="https://gist.github.com/2341776.js?file=PdfGenerator.cs"&gt;&lt;/script&gt; &lt;p&gt;With this wrapper I could pass in URLs and extract out PDFs.  Here's a couple of examples of me doing just that:&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;    //Create PDF from a single URL&lt;br /&gt;    var pdfUrl = PdfGenerator.HtmlToPdf(pdfOutputLocation: "~/PDFs/",&lt;br /&gt;        outputFilenamePrefix: "GeneratedPDF",&lt;br /&gt;        urls: new string[] { "http://news.bbc.co.uk" });&lt;br /&gt;&lt;br /&gt;    //Create PDF from multiple URLs&lt;br /&gt;    var pdfUrl = PdfGenerator.HtmlToPdf(pdfOutputLocation: "~/PDFs/",&lt;br /&gt;        outputFilenamePrefix: "GeneratedPDF",&lt;br /&gt;        urls: new string[] { "http://www.google.co.uk", "http://news.bbc.co.uk" });&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;As you can see from the second example above it's possible to pipe a number of URLs into the wrapper all to be rendered to a single PDF.  Most of the time this was surplus to our requirements but it's good to know it's possible.  Take a look at the  BBC website PDF generated by the first example:&lt;/p&gt; &lt;iframe src="https://docs.google.com/file/d/0B87K8-qxOZGFYktEWGtXRXJSSS1ZWFR4emFfMmVxZw/preview" width="500" height="500"&gt;&lt;/iframe&gt; &lt;p&gt;Pretty good, no?  As you can see it's not perfect from looking at the titles (bit squashed) but I deliberately picked a more complicated page to show what WKHTMLtoPDF was capable of.  The print screens I had in mind to build would be significantly simpler than this.&lt;/p&gt; &lt;p&gt;Once this was in place I was able to scrap the Crystal solution.  It was replaced with a couple of "print to PDF" ASPXs in the main web app which would be customised when rendering to hide the relevant bits of data from the user.  These ASPXs would be piped into the HtmlToPdf method as needed and then the user would be redirected to that PDF.  If for some reason the PDF failed to render the users would see the straight "print to PDF" ASPX - just not as a PDF if you see what I mean.  I should say that it was pretty rare for a PDF to not render but this was my failsafe.&lt;/p&gt; &lt;p&gt;This new solution had a number of upsides from our perspective:&lt;/p&gt; &lt;ul&gt;&lt;li&gt;Development maintenance time (and consequently cost for our customers) for print screens was significantly reduced.  This was due to the print screens being part of the main web app.  This meant they shared styling etc with all the other web screens and the dynamic nature of ASP.NET made customising a screen on the fly simplicity itself.&lt;/li&gt;&lt;li&gt;We were now able to regionalise our print screens for the users in the same way as we did with our main web app.  This just wasn't realistic with the Crystal solution because of the amount of work involved.&lt;/li&gt;&lt;li&gt;I guess this is kind of a &lt;a href="http://en.wikipedia.org/wiki/Don%27t_repeat_yourself" target="_blank"&gt;DRY&lt;/a&gt; solution :-)&lt;/li&gt;&lt;/ul&gt; &lt;p&gt;You can easily make use of the above approach yourself.  All you need do is download and install &lt;a href="http://code.google.com/p/wkhtmltopdf/" target="_blank"&gt;WKHTMLtoPDF&lt;/a&gt; on your machine.  I advise using version 0.9.9 as the later release candidates appear slightly buggy at present.&lt;/p&gt; &lt;p&gt;Couple of gotchas:&lt;/p&gt; &lt;ol&gt;&lt;li&gt;Make sure that you pass the correct installation path to the HtmlToPdf method if you installed it anywhere other than the default location.  You'll see that the class assumes the default if it wasn't passed&lt;/li&gt;&lt;li&gt;Ensure that Read and Execute rights are granted to the wkhtmltopdf folder for the relevant process&lt;/li&gt;&lt;li&gt;Ensure that Write rights are granted for the location you want to create your PDFs for the relevant process&lt;/li&gt;&lt;/ol&gt; &lt;p&gt;In our situation we are are invoking this directly in our web application on demand.  I have no idea how this would scale - perhaps not well.  This is not really an issue for us as our user base is fairly small and this functionality isn't called excessively.  I think if this was used much more than it is I'd be tempted to hive off this functionality into a separate app.  But this works just dandy for now.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8680133602632737625'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8680133602632737625'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html' title='Making PDFs from HTML in C# using WKHTMLtoPDF'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8483456789773291349</id><published>2012-03-22T17:52:00.007Z</published><updated>2021-03-04T19:41:14.507Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='ServiceAuthorizationManager'/><category scheme='http://www.blogger.com/atom/ns#' term='Windows Account'/><category scheme='http://www.blogger.com/atom/ns#' term='Windows Service'/><category scheme='http://www.blogger.com/atom/ns#' term='configuration'/><category scheme='http://www.blogger.com/atom/ns#' term='WCF'/><category scheme='http://www.blogger.com/atom/ns#' term='authorisation'/><category scheme='http://www.blogger.com/atom/ns#' term='NetTcpBinding'/><title type='text'>WCF - moving from Config to Code, a simple WCF service harness (plus implementing your own Authorization)</title><content type='html'>&lt;p&gt;Last time I wrote about WCF I was getting up and running with &lt;a href="http://icanmakethiswork.blogspot.com/2012/02/wcf-transport-windows-authentication.html" target="_blank"&gt;WCF Transport Windows authentication using NetTcpBinding in an Intranet environment&lt;/a&gt;.  I ended up with a WCF service hosted in a Windows Service which did pretty much what the previous post name implies.&lt;/p&gt; &lt;p&gt;Since writing that I've taken things on a bit further and I thought it worth recording my approach whilst it's still fresh in my mind.  There's 3 things I want to go over:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;I've moved away from the standard config driven WCF approach to a more "code-first" style&lt;/li&gt;&lt;li&gt;I've established a basic Windows Service hosted WCF service / client harness which is useful if you're trying to get up and running with a WCF service quickly&lt;/li&gt;&lt;li&gt;I've locked down the WCF authorization to a single Windows account through the use of my own &lt;a href="http://msdn.microsoft.com/en-us/library/ms731774.aspx" target="_blank"&gt;ServiceAuthorizationManager&lt;/a&gt;&lt;/li&gt;&lt;/ol&gt; &lt;h4&gt;Moving from Config to Code&lt;/h4&gt; &lt;p&gt;So, originally I was doing what all the cool kids are doing and driving the configuration of my WCF service and all its clients through config files.  And why not?  I'm in good company.&lt;/p&gt; &lt;p&gt;Here's why not: it gets *&lt;b&gt;very&lt;/b&gt;* verbose *&lt;b&gt;very&lt;/b&gt;* quickly....&lt;/p&gt; &lt;p&gt;Okay - that's not the end of the world.  My problem was that I had ~10 Windows Services and 3 Web applications that needed to call into my WCF Service.  I didn't want to have to separately tweak 15 or so configs each time I wanted to make one standard change to WCF configuration settings.  I wanted everything in one place.&lt;/p&gt; &lt;p&gt;Now there's newer (and probably hipper) ways of achieving this.  &lt;a href="http://stackoverflow.com/a/2814286" target="_blank"&gt;Here's one possibility I happened upon on StackOverflow that looks perfectly fine.&lt;/a&gt;&lt;/p&gt; &lt;p&gt;Well I didn't use a hip new approach - no I went Old School with my old friend the &lt;a href="http://msdn.microsoft.com/en-us/library/ms228154.aspx" target="_blank"&gt;appSettings file attribute&lt;/a&gt;.  Remember that?  It's just a simple way to have all your common appSettings configuration settings in a single file which can be linked to from as many other apps as you like.  It's wonderful and I've been using it for a long time now.  Unfortunately it's pretty basic in that it's only the appSettings section that can be shared out; no &lt;code&gt;&amp;lt;system.serviceModel&amp;gt;&lt;/code&gt; or similar.&lt;/p&gt; &lt;p&gt;But that wasn't really a problem from my perspective.  I realised that there were actually very few things that needed to be configurable for my WCF service.  Really I wanted a basic WCF harness that could be initialised in code which implicitly set all the basic configuration with settings that worked (ie it was set up with defaults like maximum message size which were sufficiently sized).  On top of that I would allow myself to configure just those things that I needed to through the use of my own custom WCF config settings in the shared appSettings.config file.&lt;/p&gt; &lt;p&gt;Once done I massively reduced the size of my configs from frankly gazillions of entries to just these appSettings.config entries which were shared across each of my WCF service clients and by my Windows Service harness:&lt;/p&gt; &lt;pre class="prettyprint xml"&gt;&lt;br /&gt;&lt;code class="language-xml"&gt;&lt;br /&gt;  &amp;lt;appSettings&amp;gt;&lt;br /&gt;  &amp;lt;add key="WcfBaseAddressForClient" value="net.tcp://localhost:9700/"/&amp;gt;&lt;br /&gt;  &amp;lt;add key="WcfWindowsSecurityApplied" value="true" /&amp;gt;&lt;br /&gt;  &amp;lt;add key="WcfCredentialsUserName" value="myUserName" /&amp;gt;&lt;br /&gt;  &amp;lt;add key="WcfCredentialsPassword" value="myPassword" /&amp;gt;&lt;br /&gt;  &amp;lt;add key="WcfCredentialsDomain" value="myDomain" /&amp;gt;&lt;br /&gt;  &amp;lt;/appSettings&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;And these config settings used only by my Windows Service harness:&lt;/p&gt; &lt;pre class="prettyprint xml"&gt;&lt;br /&gt;&lt;code class="language-xml"&gt;&lt;br /&gt;  &amp;lt;appSettings file="../Shared/AppSettings.config"&amp;gt;&lt;br /&gt;    &amp;lt;add key="WcfBaseAddressForService" value="net.tcp://localhost:9700/"/&amp;gt;&lt;br /&gt;  &amp;lt;/appSettings&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt;  &lt;h4&gt;Show me your harness&lt;/h4&gt; &lt;p&gt;I ended up with a quite a nice basic "vanilla" framework that allowed me to quickly set up Windows Service hosted WCF services.  The framework also provided me with a simple way to consume these WCF services with a minimum of code an configuration.  No muss.  No fuss. :-)  So pleased with it was I that I thought I'd go through it here much in the manner of a chef baking a cake...&lt;/p&gt; &lt;p&gt;To start with I created myself a Windows Service in Visual Studio which I grandly called "WcfWindowsService".  The main service class looked like this:&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;  public class WcfWindowsService: ServiceBase&lt;br /&gt;  {&lt;br /&gt;    public static string WindowsServiceName = "WCF Windows Service";&lt;br /&gt;    public static string WindowsServiceDescription = "Windows service that hosts a WCF service.";&lt;br /&gt;    &lt;br /&gt;    private static readonly log4net.ILog _logger = log4net.LogManager.GetLogger(System.Reflection.MethodBase.GetCurrentMethod().DeclaringType);&lt;br /&gt;&lt;br /&gt;    public List&amp;lt;ServiceHost&amp;gt; _serviceHosts = null;&lt;br /&gt;&lt;br /&gt;    public WcfWindowsService()&lt;br /&gt;    {&lt;br /&gt;      ServiceName = WindowsServiceName;&lt;br /&gt;    }&lt;br /&gt;&lt;br /&gt;    public static void Main()&lt;br /&gt;    {&lt;br /&gt;      ServiceBase.Run(new WcfWindowsService());&lt;br /&gt;    }&lt;br /&gt;&lt;br /&gt;    /// &amp;lt;summary&amp;gt;&lt;br /&gt;    /// The Windows Service is starting&lt;br /&gt;    /// &amp;lt;/summary&amp;gt;&lt;br /&gt;    /// &amp;lt;param name="args"&amp;gt;&amp;lt;/param&amp;gt;&lt;br /&gt;    protected override void OnStart(string[] args)&lt;br /&gt;    {&lt;br /&gt;      try&lt;br /&gt;      {&lt;br /&gt;        CloseAndClearServiceHosts();&lt;br /&gt;&lt;br /&gt;        //Make log4net startup&lt;br /&gt;        XmlConfigurator.Configure();&lt;br /&gt;        _logger.Warn("WCF Windows Service starting...");&lt;br /&gt;        _logger.Info("Global.WcfWindowsSecurityApplied = " + Global.WcfWindowsSecurityApplied.ToString().ToLower());&lt;br /&gt;&lt;br /&gt;        if (Global.WcfWindowsSecurityApplied)&lt;br /&gt;        {&lt;br /&gt;          _logger.Info("Global.WcfOnlyAuthorizedForWcfCredentials = " + Global.WcfOnlyAuthorizedForWcfCredentials.ToString().ToLower());&lt;br /&gt;&lt;br /&gt;          if (Global.WcfOnlyAuthorizedForWcfCredentials)&lt;br /&gt;          {&lt;br /&gt;            _logger.Info("Global.WcfCredentialsDomain = " + Global.WcfCredentialsDomain);&lt;br /&gt;            _logger.Info("Global.WcfCredentialsUserName = " + Global.WcfCredentialsUserName);&lt;br /&gt;          }&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        //Create binding&lt;br /&gt;        var wcfBinding = WcfHelper.CreateBinding(Global.WcfWindowsSecurityApplied);&lt;br /&gt;&lt;br /&gt;        // Create a servicehost and endpoints for each service and open each&lt;br /&gt;        _serviceHosts = new List&amp;lt;ServiceHost&amp;gt;();&lt;br /&gt;        _serviceHosts.Add(WcfServiceFactory&amp;lt;IHello&amp;gt;.CreateAndOpenServiceHost(typeof(HelloService), wcfBinding));&lt;br /&gt;        _serviceHosts.Add(WcfServiceFactory&amp;lt;IGoodbye&amp;gt;.CreateAndOpenServiceHost(typeof(GoodbyeService), wcfBinding));&lt;br /&gt;&lt;br /&gt;        _logger.Warn("WCF Windows Service started.");&lt;br /&gt;      }&lt;br /&gt;      catch (Exception exc)&lt;br /&gt;      {&lt;br /&gt;        _logger.Error("Problem starting up", exc);&lt;br /&gt;&lt;br /&gt;        throw exc;&lt;br /&gt;      }&lt;br /&gt;    }&lt;br /&gt;&lt;br /&gt;    /// &amp;lt;summary&amp;gt;&lt;br /&gt;    /// The Windows Service is stopping&lt;br /&gt;    /// &amp;lt;/summary&amp;gt;&lt;br /&gt;    protected override void OnStop()&lt;br /&gt;    {&lt;br /&gt;      CloseAndClearServiceHosts();&lt;br /&gt;&lt;br /&gt;      _logger.Warn("WCF Windows Service stopped");&lt;br /&gt;    }&lt;br /&gt;&lt;br /&gt;    /// &amp;lt;summary&amp;gt;&lt;br /&gt;    /// Close and clear service hosts in list and clear it down&lt;br /&gt;    /// &amp;lt;/summary&amp;gt;&lt;br /&gt;    private void CloseAndClearServiceHosts()&lt;br /&gt;    {&lt;br /&gt;      if (_serviceHosts != null)&lt;br /&gt;      {&lt;br /&gt;        foreach (var serviceHost in _serviceHosts)&lt;br /&gt;        {&lt;br /&gt;          CloseAndClearServiceHost(serviceHost);&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        _serviceHosts.Clear();&lt;br /&gt;      }&lt;br /&gt;    }&lt;br /&gt;&lt;br /&gt;    /// &amp;lt;summary&amp;gt;&lt;br /&gt;    /// Close and clear the passed service host&lt;br /&gt;    /// &amp;lt;/summary&amp;gt;&lt;br /&gt;    /// &amp;lt;param name="serviceHost"&amp;gt;&amp;lt;/param&amp;gt;&lt;br /&gt;    private void CloseAndClearServiceHost(ServiceHost serviceHost)&lt;br /&gt;    {&lt;br /&gt;      if (serviceHost != null)&lt;br /&gt;      {&lt;br /&gt;        _logger.Info(string.Join(", ", serviceHost.BaseAddresses) + " is closing...");&lt;br /&gt;&lt;br /&gt;        serviceHost.Close();&lt;br /&gt;&lt;br /&gt;        _logger.Info(string.Join(", ", serviceHost.BaseAddresses) + " is closed");&lt;br /&gt;      }&lt;br /&gt;    }&lt;br /&gt;  }&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;As you've no doubt noticed this makes use of &lt;a href="http://logging.apache.org/log4net/" target="_blank"&gt;Log4Net&lt;/a&gt; for logging purposes (I'll assume you're aware of it).  My Windows Service implements such fantastic WCF services as HelloService and GoodbyeService.  Each revolutionary in their own little way. To give you a taste of the joie de vivre that these services exemplify take a look at this:&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;  // Implement the IHello service contract in a service class.&lt;br /&gt;  public class HelloService : WcfServiceAuthorizationManager, IHello&lt;br /&gt;  {&lt;br /&gt;    // Implement the IHello methods.&lt;br /&gt;    public string GreetMe(string thePersonToGreet)&lt;br /&gt;    {&lt;br /&gt;      return "well hello there " + thePersonToGreet;&lt;br /&gt;    }&lt;br /&gt;  }&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Exciting!  WcfWindowsService also references another class called "Global" which is a helper class - to be honest not much more than a wrapper for my config settings.  It looks like this:&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;  static public class Global&lt;br /&gt;  {&lt;br /&gt;    #region Properties&lt;br /&gt;&lt;br /&gt;    // eg "net.tcp://localhost:9700/"&lt;br /&gt;    public static string WcfBaseAddressForService { get { return ConfigurationManager.AppSettings["WcfBaseAddressForService"]; } }&lt;br /&gt;&lt;br /&gt;    // eg true&lt;br /&gt;    public static bool WcfWindowsSecurityApplied { get { return bool.Parse(ConfigurationManager.AppSettings["WcfWindowsSecurityApplied"]); } }&lt;br /&gt;&lt;br /&gt;    // eg true&lt;br /&gt;    public static bool WcfOnlyAuthorizedForWcfCredentials { get { return bool.Parse(ConfigurationManager.AppSettings["WcfOnlyAuthorizedForWcfCredentials"]); } }&lt;br /&gt;&lt;br /&gt;    // eg "myDomain"&lt;br /&gt;    public static string WcfCredentialsDomain { get { return ConfigurationManager.AppSettings["WcfCredentialsDomain"]; } }&lt;br /&gt;&lt;br /&gt;    // eg "myUserName"&lt;br /&gt;    public static string WcfCredentialsUserName { get { return ConfigurationManager.AppSettings["WcfCredentialsUserName"]; } }&lt;br /&gt;&lt;br /&gt;    // eg "myPassword" - this should *never* be stored unencrypted and is only ever used by clients that are not already running with the approved Windows credentials&lt;br /&gt;    public static string WcfCredentialsPassword { get { return ConfigurationManager.AppSettings["WcfCredentialsPassword"]; } }&lt;br /&gt;&lt;br /&gt;    #endregion&lt;br /&gt;  }&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;WcfWindowsService creates and hosts a HelloService and a GoodbyeService when it starts up.  It does this using my handy WcfServiceFactory:&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;  public class WcfServiceFactory&amp;lt;TInterface&amp;gt;&lt;br /&gt;  {&lt;br /&gt;    private static readonly log4net.ILog _logger = log4net.LogManager.GetLogger(System.Reflection.MethodBase.GetCurrentMethod().DeclaringType);&lt;br /&gt;&lt;br /&gt;    public static ServiceHost CreateAndOpenServiceHost(Type serviceType, NetTcpBinding wcfBinding)&lt;br /&gt;    {&lt;br /&gt;      var serviceHost = new ServiceHost(serviceType, new Uri(Global.WcfBaseAddressForService + ServiceHelper&amp;lt;TInterface&amp;gt;.GetServiceName()));&lt;br /&gt;      serviceHost.AddServiceEndpoint(typeof(TInterface), wcfBinding, "");&lt;br /&gt;      serviceHost.Authorization.ServiceAuthorizationManager = new WcfServiceAuthorizationManager(); // This allows us to control authorisation within WcfServiceAuthorizationManager&lt;br /&gt;      serviceHost.Open();&lt;br /&gt;&lt;br /&gt;      _logger.Info(string.Join(", ", serviceHost.BaseAddresses) + " is now listening.");&lt;br /&gt;&lt;br /&gt;      return serviceHost;&lt;br /&gt;    }&lt;br /&gt;  }&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;To do this it also uses my equally handy WcfHelper class:&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;  static public class WcfHelper&lt;br /&gt;  {&lt;br /&gt;    /// &amp;lt;summary&amp;gt;&lt;br /&gt;    /// Create a NetTcpBinding&lt;br /&gt;    /// &amp;lt;/summary&amp;gt;&lt;br /&gt;    /// &amp;lt;param name="useWindowsSecurity"&amp;gt;&amp;lt;/param&amp;gt;&lt;br /&gt;    /// &amp;lt;returns&amp;gt;&amp;lt;/returns&amp;gt;&lt;br /&gt;    public static NetTcpBinding CreateBinding(bool useWindowsSecurity)&lt;br /&gt;    {&lt;br /&gt;      var wcfBinding = new NetTcpBinding();&lt;br /&gt;      if (useWindowsSecurity)&lt;br /&gt;      {&lt;br /&gt;        wcfBinding.Security.Mode = SecurityMode.Transport;&lt;br /&gt;        wcfBinding.Security.Transport.ClientCredentialType = TcpClientCredentialType.Windows;&lt;br /&gt;      }&lt;br /&gt;      else&lt;br /&gt;        wcfBinding.Security.Mode = SecurityMode.None;&lt;br /&gt;&lt;br /&gt;      wcfBinding.MaxBufferSize = int.MaxValue;&lt;br /&gt;      wcfBinding.MaxReceivedMessageSize = int.MaxValue;&lt;br /&gt;      wcfBinding.ReaderQuotas.MaxArrayLength = int.MaxValue;&lt;br /&gt;      wcfBinding.ReaderQuotas.MaxDepth = int.MaxValue;&lt;br /&gt;      wcfBinding.ReaderQuotas.MaxStringContentLength = int.MaxValue;&lt;br /&gt;      wcfBinding.ReaderQuotas.MaxBytesPerRead = int.MaxValue;&lt;br /&gt;&lt;br /&gt;      return wcfBinding;&lt;br /&gt;    }&lt;br /&gt;  }&lt;br /&gt;&lt;br /&gt;  /// &amp;lt;summary&amp;gt;&lt;br /&gt;  /// Create a WCF Client for use anywhere (be it Windows Service or ASP.Net web application)&lt;br /&gt;  /// nb Credential fields are optional and only likely to be needed by web applications&lt;br /&gt;  /// &amp;lt;/summary&amp;gt;&lt;br /&gt;  /// &amp;lt;typeparam name="TInterface"&amp;gt;&amp;lt;/typeparam&amp;gt;&lt;br /&gt;  public class WcfClientFactory&amp;lt;TInterface&amp;gt;&lt;br /&gt;  {&lt;br /&gt;    public static TInterface CreateChannel(bool useWindowsSecurity, string wcfBaseAddress, string wcfCredentialsUserName = null, string wcfCredentialsPassword = null, string wcfCredentialsDomain = null)&lt;br /&gt;    {&lt;br /&gt;      //Create NetTcpBinding using universally&lt;br /&gt;      var wcfBinding = WcfHelper.CreateBinding(useWindowsSecurity);&lt;br /&gt;&lt;br /&gt;      //Get Service name from examining the ServiceNameAttribute decorating the interface&lt;br /&gt;      var serviceName = ServiceHelper&amp;lt;TInterface&amp;gt;.GetServiceName();&lt;br /&gt;&lt;br /&gt;      //Create the factory for creating your channel&lt;br /&gt;      var factory = new ChannelFactory&amp;lt;TInterface&amp;gt;(&lt;br /&gt;        wcfBinding,&lt;br /&gt;        new EndpointAddress(wcfBaseAddress + serviceName)&lt;br /&gt;        );&lt;br /&gt;&lt;br /&gt;      //if credentials have been supplied then use them&lt;br /&gt;      if (!string.IsNullOrEmpty(wcfCredentialsUserName))&lt;br /&gt;      {&lt;br /&gt;        factory.Credentials.Windows.ClientCredential = new System.Net.NetworkCredential(wcfCredentialsUserName, wcfCredentialsPassword, wcfCredentialsDomain);&lt;br /&gt;      }&lt;br /&gt;&lt;br /&gt;      //Create the channel&lt;br /&gt;      var channel = factory.CreateChannel();&lt;br /&gt;&lt;br /&gt;      return channel;&lt;br /&gt;    }&lt;br /&gt;  }&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Now the above WcfHelper class and it's comrade-in-arms the WcfClientFactory don't live in the WcfWindowsService project with the other classes.  No.  They live in a separate project called the WcfWindowsServiceContracts project with their old mucker the ServiceHelper:&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;  public class ServiceHelper&amp;lt;T&amp;gt;&lt;br /&gt;  {&lt;br /&gt;    public static string GetServiceName()&lt;br /&gt;    {&lt;br /&gt;      var customAttributes = typeof(T).GetCustomAttributes(false);&lt;br /&gt;      if (customAttributes.Length &gt; 0)&lt;br /&gt;      {&lt;br /&gt;        foreach (var customAttribute in customAttributes)&lt;br /&gt;        {&lt;br /&gt;          if (customAttribute is ServiceNameAttribute)&lt;br /&gt;          {&lt;br /&gt;            return ((ServiceNameAttribute)customAttribute).ServiceName;&lt;br /&gt;          }&lt;br /&gt;        }&lt;br /&gt;      }&lt;br /&gt;&lt;br /&gt;      throw new ArgumentException("Interface is missing ServiceNameAttribute");&lt;br /&gt;    }&lt;br /&gt;  }&lt;br /&gt;&lt;br /&gt;  [AttributeUsage(AttributeTargets.Interface, AllowMultiple = false)]&lt;br /&gt;  public class ServiceNameAttribute : System.Attribute&lt;br /&gt;  {&lt;br /&gt;    public ServiceNameAttribute(string serviceName)&lt;br /&gt;    {&lt;br /&gt;      this.ServiceName = serviceName;&lt;br /&gt;    }&lt;br /&gt;&lt;br /&gt;    public string ServiceName { get; set; }&lt;br /&gt;  }&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Now can you guess what the WcfWindowsServiceContracts project might contain?  Yes; contracts for your services (oh the excitement)!  What might one of these contracts look like I hear you ask... Well, like this:&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;  [ServiceContract()]&lt;br /&gt;  [ServiceName("HelloService")]&lt;br /&gt;  public interface IHello&lt;br /&gt;  {&lt;br /&gt;    [OperationContract]&lt;br /&gt;    string GreetMe(string thePersonToGreet);&lt;br /&gt;  }&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;The WcfWindowsServiceContracts project is included in *&lt;b&gt;any&lt;/b&gt;* WCF client solution that wants to call your WCF services.  It is also included in the WCF service solution.  It facilitates the calling of services.  What you're no doubt wondering is how this might be achieved.  Well here's how, it uses our old friend the &lt;code&gt;WcfClientFactory&lt;/code&gt;:&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;  var helloClient = WcfClientFactory&amp;lt;IHello&amp;gt;&lt;br /&gt;    .CreateChannel(&lt;br /&gt;      useWindowsSecurity:     Global.WcfWindowsSecurityApplied,  // eg true&lt;br /&gt;      wcfBaseAddress:         Global.WcfBaseAddressForClient,    // eg "net.tcp://localhost:9700/"&lt;br /&gt;      wcfCredentialsUserName: Global.WcfCredentialsUserName,     // eg "myUserName" - Optional parameter - only passed by web applications that need to impersonate the valid user&lt;br /&gt;      wcfCredentialsPassword: Global.WcfCredentialsPassword,     // eg "myPassword" - Optional parameter - only passed by web applications that need to impersonate the valid user&lt;br /&gt;      wcfCredentialsDomain:   Global.WcfCredentialsDomain        // eg "myDomain" - Optional parameter - only passed by web applications that need to impersonate the valid user&lt;br /&gt;    );&lt;br /&gt;  var greeting = helloClient.GreetMe("John"); //"well hello there John"&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;See?  Simple as simple.  The eagle eyed amongst you will have noticed that client example above is using "&lt;code&gt;Global&lt;/code&gt;" which is essentially a copy of the &lt;code&gt;Global&lt;/code&gt; class mentioned above that is part of the WcfWindowsService project.&lt;/p&gt; &lt;h4&gt;Locking down Authorization to a single Windows account&lt;/h4&gt; &lt;p&gt;I can tell you think i've forgotten something.  "Tell me about this locking down to the single Windows account / what is this mysterious &lt;code&gt;WcfServiceAuthorizationManager&lt;/code&gt; class that all your WCF services inherit from?  Don't you fob me off now.... etc"&lt;/p&gt; &lt;p&gt;Well ensuring that only a single Windows account is authorised (yes dammit the original English spelling) to access our WCF services is achieved by implementing our own &lt;code&gt;ServiceAuthorizationManager&lt;/code&gt; class.  This implementation is used for authorisation by your &lt;code&gt;ServiceHost&lt;/code&gt; and the logic sits in the overridden &lt;code&gt;CheckAccessCore&lt;/code&gt; method.  All of our WCF service classes will inherit from our &lt;code&gt;ServiceAuthorizationManager&lt;/code&gt; class and so trigger the &lt;code&gt;CheckAccessCore&lt;/code&gt; authorisation each time they are called.&lt;/p&gt; &lt;p&gt;As you can see from the code below, depending on our configuration, we lock down access to all our WCF services to a specific Windows account.  This is far from the only approach that you might want to take to authorisation; it's simply the one that we've been using.  However the power of being able to implement your own authorisation in the &lt;code&gt;CheckAccessCore&lt;/code&gt; method allows you the flexibility to do pretty much anything you want:&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;  public class WcfServiceAuthorizationManager : ServiceAuthorizationManager&lt;br /&gt;  {&lt;br /&gt;    protected static readonly log4net.ILog _logger = log4net.LogManager.GetLogger(System.Reflection.MethodBase.GetCurrentMethod().DeclaringType);&lt;br /&gt;&lt;br /&gt;    protected override bool CheckAccessCore(OperationContext operationContext)&lt;br /&gt;    {&lt;br /&gt;      if (Global.WcfWindowsSecurityApplied)&lt;br /&gt;      {&lt;br /&gt;        if ((operationContext.ServiceSecurityContext.IsAnonymous) ||&lt;br /&gt;          (operationContext.ServiceSecurityContext.PrimaryIdentity == null))&lt;br /&gt;        {&lt;br /&gt;          _logger.Error("WcfWindowsSecurityApplied = true but no credentials have been supplied");&lt;br /&gt;          return false;&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        if (Global.WcfOnlyAuthorizedForWcfCredentials)&lt;br /&gt;        {&lt;br /&gt;          if (operationContext.ServiceSecurityContext.PrimaryIdentity.Name.ToLower() == Global.WcfCredentialsDomain.ToLower() + "\\" + Global.WcfCredentialsUserName.ToLower())&lt;br /&gt;          {&lt;br /&gt;            _logger.Debug("WcfOnlyAuthorizedForWcfCredentials = true and the valid user (" + operationContext.ServiceSecurityContext.PrimaryIdentity.Name + ") has been supplied and access allowed");&lt;br /&gt;            return true;&lt;br /&gt;          }&lt;br /&gt;          else&lt;br /&gt;          {&lt;br /&gt;            _logger.Error("WcfOnlyAuthorizedForWcfCredentials = true and an invalid user (" + operationContext.ServiceSecurityContext.PrimaryIdentity.Name + ") has been supplied and access denied");&lt;br /&gt;            return false;&lt;br /&gt;          }&lt;br /&gt;        }&lt;br /&gt;        else&lt;br /&gt;        {&lt;br /&gt;          _logger.Debug("WcfOnlyAuthorizedForWcfCredentials = false, credentials were supplied (" + operationContext.ServiceSecurityContext.PrimaryIdentity.Name + ") so access allowed");&lt;br /&gt;          return true;&lt;br /&gt;        }&lt;br /&gt;      }&lt;br /&gt;      else&lt;br /&gt;      {&lt;br /&gt;        _logger.Info("WcfWindowsSecurityApplied = false so we are allowing unfettered access");&lt;br /&gt;        return true;&lt;br /&gt;      }&lt;br /&gt;    }&lt;br /&gt;  }&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;Phewwww... I know this has ended up as a bit of a brain dump but hopefully people will find it useful.  At some point I'll try to put up the above solution on GitHub so people can grab it easily for themselves.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8483456789773291349'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8483456789773291349'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2012/03/wcf-moving-from-config-to-code-simple.html' title='WCF - moving from Config to Code, a simple WCF service harness (plus implementing your own Authorization)'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-7307314278393594977</id><published>2012-03-18T15:27:00.000Z</published><updated>2012-03-18T15:27:05.279Z</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>PDFGenerator.cs</title><content type='html'>Moving away from Crystal Reports export to PDF  Install WebKit HTML to PDF  1. Run the main setup wkhtmltopdf-0.9.9-installer.exe 2. On the License Agreement dialog, click I agree 3. Click Install  Following installation, click Close.  &lt;!-- PDF Printing settings --&gt;  &lt;add key="PDFHtmlToPdfExePath" value="C:\Program Files\wkhtmltopdf\wkhtmltopdf.exe" /&gt; &lt;!-- This is the location of the WKHTMLToPDF.exe --&gt;  &lt;add key="PDFOutputLocation" value="~/PDFs/" /&gt; &lt;!-- The output folder needs to be writeable by the ASP.NET process of IIS running on the server (in the same way as used for uploads folder in PCS) --&gt;  &lt;add key="PDFLogin" value="ta2pcsd" /&gt; &lt;!-- Login details which are to be used for authentication when generating PDF reports --&gt;  &lt;add key="PDFPassword" value="#Peach01" /&gt; &lt;!-- Login password is not to be stored unencrypted in AppSettings.config - encrypted storage of this is fine (as with connection strings) --&gt; //Generate a PDF from a single URL and redirect to it in a controller (MVC):      public ActionResult PrintToPDF(int id)     {       //Determine Print URL and suffix PDF related parameters which will be picked up in Session_Start       var url = Url.Action("Print", "Deal", new { id = id }, "http") +          "?bGeneratePDF=true" +         "&amp;sImpersonateUser=" + _sharedLib.FullUserName +         "&amp;sUserCulture=" + _sharedLib.CurrentCulture.Name;        //Generate PDF       string pdfUrl = _pdfGenerator.GetHtmlToPdfUrl(         outputFilenamePrefix: string.Format("DealPrint_{0}", id.ToString()),  //Use DealId for filename         url: url         );        //Which URL to call? PDF if available (otherwise go to HTML)       string urlToCall = (pdfUrl ?? url);        _webLogger.MvcLog("Deal Print called for DealId: " + id.ToString(), _sharedLib.FriendlyUserName, _sharedLib.UserId, Request.Url.ToFriendlyString());        //Redirect       return Redirect(urlToCall);     }   //Generate a PDF from multiple URLs and redirect to it in the code behind of an ASPX (WebForms):            var lURL = new List&lt;string&gt;();           if (mask != null)           {             GetURLs(lURL: lURL, dealId: iDealId, mask: mask, maskDB: maskDb, structureDB: structureDB);           }           else           {             Response.Redirect(url: "Error.aspx?sMessage=" + Server.UrlEncode("The Deal has been deleted by another User. Please refresh."), endResponse: false); //endResponse false to stop exception being thrown on Response.End used internally: http://support.microsoft.com/default.aspx?scid=kb;en-us;312629           }            //If there are more than 5 URLs in the list then just use the first one (ie the Structure screen URL which shows the legs anyway)           //If too many URLs are piped to the PDF Generator then it will hang - in testing 5 seemed to be a reliable ceiling.           //If there are less than 5 URLs then it should be fine to use them all; PDF should be generated safely.           if (lURL.Count &gt; 5) lURL = lURL.Take(1).ToList();            //Convert URLs to fully qualified URLs (http:// etc)           var lFullURL = new List&lt;string&gt;();           foreach (var sURL in lURL) lFullURL.Add(string.Format("http://{0}{1}", Request.Url.Host, Page.ResolveUrl(sURL)));            //Generate PDF           string sPDFURL = PDFGenerator.HtmlToPdf(             outputFilenamePrefix: string.Format("DealPrint_{0}", iDealId.ToString()),  //Use DealId for filename             urls: lFullURL.ToArray()             );            //Which URL to call? PDF if available (otherwise go to HTML)           string sURLToCall = (sPDFURL ?? lURL[0]);            WebLogger.Log("DealPrint called for DealId: " + iDealId.ToString(), SharedLib.FriendlyUserName, SharedLib.UserId, Request.Url.ToFriendlyString());            //Redirect           Response.Redirect(             url: sURLToCall,             endResponse: false //endResponse false to stop exception being thrown on Response.End used internally: http://support.microsoft.com/default.aspx?scid=kb;en-us;312629             );  //Generate a PDF and redirect to it in the code behind of an ASPX:    using System; using System.Collections.Generic; using System.Linq; using System.Web;  namespace Commerzbank.PCS.Web.Shared {   public class PDFGenerator   {     /// &lt;summary&gt;    /// Convert Html page at a given URL to a PDF file using open-source tool wkhtml2pdf     ///   wkhtml2pdf can be found at: http://code.google.com/p/wkhtmltopdf/     ///   Useful code: http://stackoverflow.com/questions/1331926/calling-wkhtmltopdf-to-generate-pdf-from-html/1698839     ///   An online manual can be found here: http://madalgo.au.dk/~jakobt/wkhtmltoxdoc/wkhtmltopdf-0.9.9-doc.html     ///        /// Ensure that the output folder specified is writeable by the ASP.NET process of IIS running on your server (in the same way as used for uploads folder in PCS)     ///      /// This code requires that the Windows installer is installed on the relevant server / client.  This can either be found at:     ///   http://code.google.com/p/wkhtmltopdf/downloads/list - download wkhtmltopdf-0.9.9-installer.exe     ///        /// OR you can get the installer at:     ///   \\sv068116\proj-iis-deve$\Apps\WKHTMLtoPDF\wkhtmltopdf-0.9.9-installer.exe     /// &lt;/summary&gt;    /// &lt;param name="url"&gt;&lt;/param&gt;    /// &lt;param name="outputFilenamePrefix"&gt;&lt;/param&gt;    /// &lt;returns&gt;Either the URL of the generated PDF or null (if nowt generated)&lt;/returns&gt;    /// &lt;history&gt;    ///   &lt;change&gt;&lt;date&gt;14/06/2011&lt;/date&gt;&lt;name&gt;John Reilly&lt;/name&gt;&lt;description&gt;Generated&lt;/description&gt;&lt;/change&gt;    /// &lt;/history&gt;    public static string HtmlToPdf(string outputFilenamePrefix, string url = null, string[] urls = null, bool imagePage = false, string pageWidth = null, string pageHeight = null)     {       try       {         //Determine inputs         string inputs;         if ((url == null) &amp;&amp; (urls == null))           throw new Exception("No input URLs provided for HtmlToPdf");         else         {           if (url != null)             inputs = url;           else             inputs = String.Join(" ", urls); //Concatenate URLs         }                  string outputFolder = GlobalSettings.PDFOutputLocation;         string outputFilename = outputFilenamePrefix + "_" + Guid.NewGuid().ToString() + ".PDF";          // assemble destination PDF file name         string filename = HttpContext.Current.Server.MapPath(outputFolder + outputFilename);          //Switches to control output created by WKHTMLToPDF         var switches = new List&lt;string&gt;        {           "--username " + GlobalSettings.PDFLogin,           "--password " + GlobalSettings.PDFPassword,           "--print-media-type"//,"--margin-top 4mm","--margin-bottom 4mm","--margin-right 0mm","--margin-left 0mm","--page-size A4","--no-background","--redirect-delay 100"         };          //Is this an image page?         if (imagePage)          {           switches.Add("--disable-pdf-compression");           switches.Add("--disable-smart-shrinking");         }          if ((pageWidth == null) &amp;&amp; (pageHeight == null))         {           //Orientation landscape           switches.Add("-O Landscape");         }         else         {           //Set dimensions?           if (pageWidth != null) switches.Add("--page-width " + pageWidth);           if (pageHeight != null) switches.Add("--page-height " + pageHeight);         }          var p = new System.Diagnostics.Process()         {           StartInfo =           {             FileName = GlobalSettings.PDFHtmlToPdfExePath,             Arguments = String.Join(" ", switches) + " " + inputs + " " + filename,             UseShellExecute = false, // needs to be false in order to redirect output             RedirectStandardOutput = true,             RedirectStandardError = true,             RedirectStandardInput = true, // redirect all 3, as it should be all 3 or none             WorkingDirectory = HttpContext.Current.Server.MapPath(outputFolder)           }         };          p.Start();          // read the output here...         string output = p.StandardOutput.ReadToEnd();          // ...then wait n milliseconds for exit (as after exit, it can't read the output)         p.WaitForExit(60000);          // read the exit code, close process         int returnCode = p.ExitCode;         p.Close();          // if 0 or 2, it worked so return path of pdf         if ((returnCode == 0) || (returnCode == 2))           return outputFolder + outputFilename;         else           return null;       }       catch (Exception exc)       {         throw new Exception("Problem generating PDF from HTML, URL: " + url + ", outputFilename: " + outputFilenamePrefix, exc);       }     }      /// &lt;summary&gt;    /// Essentially a wrapper method of HtmlToPdf to be used in Unit tests     /// &lt;/summary&gt;    /// &lt;param name="outputFilenamePrefix"&gt;&lt;/param&gt;    /// &lt;param name="url"&gt;&lt;/param&gt;    /// &lt;param name="urls"&gt;&lt;/param&gt;    /// &lt;param name="imagePage"&gt;&lt;/param&gt;    /// &lt;param name="pageWidth"&gt;&lt;/param&gt;    /// &lt;param name="pageHeight"&gt;&lt;/param&gt;    /// &lt;returns&gt;&lt;/returns&gt;    public virtual string GetHtmlToPdfUrl(string outputFilenamePrefix, string url = null, string[] urls = null, bool imagePage = false, string pageWidth = null, string pageHeight = null)     {       return HtmlToPdf(outputFilenamePrefix : outputFilenamePrefix,          url: url,          urls: urls,          imagePage: imagePage,          pageWidth: pageWidth,          pageHeight: pageHeight);     }   } }</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7307314278393594977'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7307314278393594977'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3415493205374153591</id><published>2012-03-17T13:00:00.004Z</published><updated>2021-03-05T18:00:08.489Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='inheritance'/><category scheme='http://www.blogger.com/atom/ns#' term='javascript'/><category scheme='http://www.blogger.com/atom/ns#' term='c#'/><category scheme='http://www.blogger.com/atom/ns#' term='observer pattern'/><category scheme='http://www.blogger.com/atom/ns#' term='pubsub'/><title type='text'>Using the PubSub / Observer pattern to emulate constructor chaining without cluttering up global scope</title><content type='html'>Yes the title of this post is *&lt;b&gt;painfully&lt;/b&gt;* verbose.  Sorry about that.&lt;br /&gt;&lt;br /&gt;Couple of questions for you: &lt;ul&gt;&lt;li&gt;Have you ever liked the way you can have base classes in C# which can then be inherited and subclassed &lt;u&gt;in a different file / class&lt;/u&gt;?&lt;/li&gt;&lt;li&gt;Have you ever thought; gosh it'd be nice to do something like that in JavaScript...&lt;/li&gt;&lt;li&gt;Have you then looked at JavaScripts prototypical inheritance and thought "right....  I'm sure it's possible but this going to end up like &lt;a href="http://en.wikipedia.org/wiki/War_and_Peace" target="_blank"&gt;War and Peace&lt;/a&gt;"&lt;/li&gt;&lt;li&gt;Have you then subsequently thought "and hold on a minute... even if I did implement this using the prototype and split things between different files / modules wouldn't I have to pollute the global scope to achieve that?  And wouldn't that mean that my code was exposed to the vagaries of any other scripts on the page? Hmmm..."&lt;/li&gt;&lt;li&gt;&lt;a href="http://www.thrillingdetective.com/eyes/oxford.html" target="_blank"&gt;Men! Are you skinny? Do bullies kick sand in your face?&lt;/a&gt; (Just wanted to see if you were still paying attention...)&lt;/li&gt;&lt;/ul&gt; &lt;h4&gt;The Problem&lt;/h4&gt;Well, the above thoughts occurred to me just recently.  I had a situation where I was working on an MVC project and needed to build up quite large objects within JavaScript representing various models.  The models in question were already implemented on the server side using classes and made extensive use of inheritance because many of the properties were shared between the various models.  That is to say we would have models which were implemented through the use of a class inheriting a base class which in turn inherits a further base class.  With me?  Good.&lt;br /&gt;&lt;br /&gt;Perhaps I can make it a little clearer with an example.  Here are my 3 classes.  First BaseReilly.cs: &lt;pre class="brush: c#"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;    public class BaseReilly&lt;br /&gt;    {&lt;br /&gt;        public string LastName { get; set; }&lt;br /&gt;&lt;br /&gt;        public BaseReilly()&lt;br /&gt;        {&lt;br /&gt;            LastName = "Reilly";&lt;br /&gt;        }&lt;br /&gt;    }&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt;Next BoyReilly.cs (which inherits from BaseReilly): &lt;pre class="brush: c#"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;    public class BoyReilly : BaseReilly&lt;br /&gt;    {&lt;br /&gt;        public string Sex { get; set; }&lt;br /&gt;&lt;br /&gt;        public BoyReilly()&lt;br /&gt;            : base()&lt;br /&gt;        {&lt;br /&gt;            Sex = "It is a manchild";&lt;br /&gt;        }&lt;br /&gt;    }&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt;And finally JohnReilly.cs (which inherits from BoyReilly which in turn inherits from BaseReilly): &lt;pre class="brush: c#"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;    public class JohnReilly : BoyReilly&lt;br /&gt;    {&lt;br /&gt;        public string FirstName { get; set; }&lt;br /&gt;&lt;br /&gt;        public JohnReilly()&lt;br /&gt;            : base()&lt;br /&gt;        {&lt;br /&gt;            FirstName = "John";&lt;br /&gt;        }&lt;br /&gt;    }&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt;Using the above I can create myself my very own "JohnReilly" like so: &lt;pre class="brush: c#"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;var johnReilly = new JohnReilly();&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt;And it will look like this: &lt;div class="separator" style="clear: both; text-align: center;"&gt;JohnReilly made in C#&lt;br /&gt;&lt;a href="http://1.bp.blogspot.com/-bzrR_jHm8Wo/T2RYBCQmlxI/AAAAAAAAALQ/fSaT7klxPPk/s1600/C%2523%2Bversion%2Bof%2BJohnReilly.png" imageanchor="1" style="margin-left:1em; margin-right:1em"&gt;&lt;img border="0" height="140" width="320" src="http://1.bp.blogspot.com/-bzrR_jHm8Wo/T2RYBCQmlxI/AAAAAAAAALQ/fSaT7klxPPk/s320/C%2523%2Bversion%2Bof%2BJohnReilly.png" /&gt;&lt;/a&gt;&lt;/div&gt;&lt;br /&gt;I was looking to implement something similar on the client and within JavaScript.  I was keen to ensure &lt;a href="http://en.wikipedia.org/wiki/Code_reuse" target="_blank"&gt;code reuse&lt;/a&gt;.  And my inclination to keep things simple made me wary of making use of the &lt;a href="http://bonsaiden.github.com/JavaScript-Garden/#object.prototype" target="_blank"&gt;prototype&lt;/a&gt;.  It is undoubtedly powerful but I don't think even the mighty &lt;a href="http://javascript.crockford.com/prototypal.html" target="_blank"&gt;Crockford&lt;/a&gt; would consider it "simple".  Also I had the reservation of exposing my object to the global scope.&lt;br /&gt;&lt;br /&gt;So what to do?  I had an idea....&lt;br /&gt;&lt;br /&gt; &lt;h4&gt;The Big Idea&lt;/h4&gt; For a while I've been making use explicit use of the &lt;a href="http://en.wikipedia.org/wiki/Observer_pattern" target="_blank"&gt;Observer pattern&lt;/a&gt; in my JavaScript, better known by most as the publish/subscribe (or "PubSub") pattern.   There's a million JavaScript libraries that facilitate this and after some experimentation I finally settled on &lt;a href="https://github.com/phiggins42/bloody-jquery-plugins/blob/master/pubsub.js" target="_blank"&gt;higgins&lt;/a&gt; implementation as it's simple and I saw a &lt;a href="http://jsperf.com/pubsubjs-vs-jquery-custom-events/11" target="_blank"&gt;JSPerf&lt;/a&gt; which demonstrated it as either the fastest or second fastest in class.&lt;br /&gt;&lt;br /&gt;Up until now my main use for it had been to facilitate loosely coupled GUI interactions.  If I wanted one component on the screen to influence anothers behaviour I simply needed to get the first component to publish out the relevant events and the second to subscribe to these self-same events.&lt;br /&gt;&lt;br /&gt;One of the handy things about publishing out events this way is that with them you can also include data.  This data can be useful when driving the response in the subscribers.&lt;br /&gt;&lt;br /&gt;However, it occurred to me that it would be equally possible to pass an object when publishing an event.  &lt;b&gt;&lt;u&gt;And the subscribers could enrich that object with data as they saw fit.&lt;/u&gt;&lt;/b&gt;&lt;br /&gt;&lt;br /&gt;Now this struck me as a pretty useful approach.  It's not rock solid secure as it's always possible that someone could subscribe to your events and get access to your object as you published out.  However, that's pretty unlikely to happen accidentally; certainly far less likely than someone else's global object clashing with your global object.&lt;br /&gt;&lt;br /&gt;&lt;h4&gt;What might this look like in practice?&lt;/h4&gt;So this is what it ended up looking like when I turned my 3 classes into JavaScript files / modules.  First BaseReilly.js: &lt;pre class="brush: js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;$(function () {&lt;br /&gt;&lt;br /&gt;    $.subscribe("PubSub.Inheritance.Emulation", function (obj) {&lt;br /&gt;        obj.LastName = "Reilly";&lt;br /&gt;    });&lt;br /&gt;});&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt;Next BoyReilly.js: &lt;pre class="brush: js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;$(function () {&lt;br /&gt;&lt;br /&gt;    $.subscribe("PubSub.Inheritance.Emulation", function (obj) {&lt;br /&gt;        obj.Sex = "It is a manchild";&lt;br /&gt;    });&lt;br /&gt;});&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt;And finally JohnReilly.js: &lt;pre class="brush: js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;$(function () {&lt;br /&gt;&lt;br /&gt;    $.subscribe("PubSub.Inheritance.Emulation", function (obj) {&lt;br /&gt;        obj.FirstName = "John";&lt;br /&gt;    });&lt;br /&gt;});&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt;If the above scripts have been included in a page I can create myself my very own "JohnReilly" in JavaScript like so: &lt;pre class="brush: js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;    var oJohnReilly = {}; //Empty object&lt;br /&gt;    &lt;br /&gt;    $.publish("PubSub.Inheritance.Emulation", [oJohnReilly]); //Empty object "published" so it can be enriched by subscribers&lt;br /&gt;&lt;br /&gt;    console.log(JSON.stringify(oJohnReilly)); //Show me this thing you call "JohnReilly"&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt;And it will look like this: &lt;div class="separator" style="clear: both; text-align: center;"&gt;JohnReilly made in JavaScript &lt;a href="http://4.bp.blogspot.com/-apPrP8S4SgY/T2RYJ0ySKwI/AAAAAAAAALc/03IKWUPKSCg/s1600/JavaScript%2Bversion%2Bof%2BJohnReilly.png" imageanchor="1" style="margin-left:1em; margin-right:1em"&gt;&lt;img border="0" height="137" width="320" src="http://4.bp.blogspot.com/-apPrP8S4SgY/T2RYJ0ySKwI/AAAAAAAAALc/03IKWUPKSCg/s320/JavaScript%2Bversion%2Bof%2BJohnReilly.png" /&gt;&lt;/a&gt;&lt;/div&gt;&lt;br /&gt;And it works. Obviously the example I've given above it somewhat naive - in reality my object properties are driven by GUI components rather than hard-coded.  But I hope this illustrates the point.&lt;br /&gt;&lt;br /&gt;This technique allows you to simply share functionality between different JavaScript files and so keep your codebase tight.  I certainly wouldn't recommend it for all circumstances but when you're doing something as simple as building up an object to be used to pass data around (as I am) then it works very well indeed.&lt;br /&gt;&lt;br /&gt;&lt;h4&gt;A Final Thought on Script Ordering&lt;/h4&gt;A final thing that maybe worth mentioning is script ordering.  The order in which functions are called is driven by the order in which subscriptions are made.&lt;br /&gt;&lt;br /&gt;In my example I was registering the scripts in this order: &lt;pre class="brush: html"&gt;&lt;br /&gt;&lt;code class="language-html"&gt;&lt;br /&gt;        &amp;lt;script src="/Scripts/PubSubInheritanceDemo/BaseReilly.js"&amp;gt;&amp;lt;/script&amp;gt;&lt;br /&gt;        &amp;lt;script src="/Scripts/PubSubInheritanceDemo/BoyReilly.js"&amp;gt;&amp;lt;/script&amp;gt;&lt;br /&gt;        &amp;lt;script src="/Scripts/PubSubInheritanceDemo/JohnReilly.js"&amp;lt;&amp;gt;/script&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt;So when my event was published out the functions in the above JS files would be called in this order: &lt;ol&gt;&lt;li&gt;BaseReilly.js&lt;/li&gt;&lt;li&gt;BoyReilly.js&lt;/li&gt;&lt;li&gt;JohnReilly.js&lt;/li&gt;&lt;/ol&gt;If you were so inclined you could use this to emulate inheritance in behaviour.  Eg you could set a property in &lt;code&gt;BaseReilly.js&lt;/code&gt; which was subsequently overridden in &lt;code&gt;JohnReilly.js&lt;/code&gt; or &lt;code&gt;BoyReilly.js&lt;/code&gt; if you so desired.  I'm not doing that myself but it occurred as a possibility.&lt;br /&gt;&lt;br /&gt;&lt;h4&gt;PS&lt;/h4&gt;If you're interested in learning more about JavaScript stabs at inheritance you could do far worse than look at Bob Inces in depth StackOverflow &lt;a href="http://stackoverflow.com/a/1598077/761388" target="_blank"&gt;answer&lt;/a&gt;.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3415493205374153591'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3415493205374153591'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2012/03/using-pubsub-observer-pattern-to.html' title='Using the PubSub / Observer pattern to emulate constructor chaining without cluttering up global scope'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='http://1.bp.blogspot.com/-bzrR_jHm8Wo/T2RYBCQmlxI/AAAAAAAAALQ/fSaT7klxPPk/s72-c/C%2523%2Bversion%2Bof%2BJohnReilly.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-9216884746304497451</id><published>2012-03-12T09:29:00.002Z</published><updated>2021-03-05T17:43:02.820Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='naming convention'/><category scheme='http://www.blogger.com/atom/ns#' term='javascript'/><category scheme='http://www.blogger.com/atom/ns#' term='Hungarian Notation'/><category scheme='http://www.blogger.com/atom/ns#' term='DOJO'/><title type='text'>Striving for (JavaScript) Convention</title><content type='html'>&lt;h4&gt;Update&lt;/h4&gt; The speed of change makes fools of us all.  Since I originally wrote this post all of 3 weeks ago Visual Studio 11 beta has been released and the issues I was seeking to solve have pretty much been resolved by the new innovations found therein.  It's nicely detailed in  &lt;a href="http://www.twitter.com/carlbergenhem"&gt;@carlbergenhem&lt;/a&gt;'s blog post: &lt;a href="http://blogs.telerik.com/blogs/posts/12-03-26/my-top-5-visual-studio-11-designer-improvements-for-asp-net-4-5-development.aspx" target="_blank"&gt;My Top 5 Visual Studio 11 Designer Improvements for ASP.NET 4.5 Development&lt;/a&gt;.&lt;br /&gt;&lt;br /&gt;I've left the post in place below but much of what I said (particularly with regard to Hungarian Notation) I've now moved away from.  That was originally my intention anyway so that's no bad thing.  The one HN artefact that I've held onto is using "$" as a prefix for jQuery objects.  I think that still makes sense.    &lt;br /&gt;I would have written my first line of JavaScript in probably 2000.  It probably looked something like this: &lt;code&gt;alert('hello world')&lt;/code&gt;.&lt;br /&gt;&lt;br /&gt;I know.  Classy.&lt;br /&gt;&lt;br /&gt;As I've mentioned before it was around 2010 before I took JavaScript in any way seriously.  Certainly it was then when I started to actively learn the language.  Because up until this point I'd been studiously avoiding writing any JavaScript at all I'd never really given thought to forms and conventions.  When I wrote any JavaScript I just used the same style and approaches as I used in my main development language (of C#).  By and large I have been following the .net naming conventions which are ably explained by Pete Brown &lt;a href="http://10rem.net/articles/net-naming-conventions-and-programming-standards---best-practices" target="_blank"&gt;here&lt;/a&gt;.&lt;br /&gt;&lt;br /&gt;Over time I have started to move away from this approach.  Without a deliberate intention to do so I have found myself adopting a different style for my JavaScript code as compared with anything else I write.  I wouldn't go so far as to say I'm completely happy with the style I'm currently using.  But I find it more helpful than not and thought it might be worth talking about.&lt;br /&gt;&lt;br /&gt;It was really 2 things that started me down the road of "rolling my own" convention: dynamic typing and the lack of safety nets. Let's take each in turn....&lt;br /&gt;&lt;br /&gt;&lt;h5&gt;1. Dynamic typing&lt;/h5&gt; Having grown up (in a development sense) using compiled and strongly-typed languages I was used to the IDE making it pretty clear what was what through friendly tooltips and the like:&lt;br /&gt;&lt;br /&gt;&lt;div class="separator" style="clear: both; text-align: center;"&gt;&lt;a href="http://1.bp.blogspot.com/-EsqzX-fI1_o/T1r2zdlD2PI/AAAAAAAAAKg/4Gj8hgM9XhI/s1600/IDE.png" imageanchor="1" style="margin-left:1em; margin-right:1em"&gt;&lt;img border="0" height="58" width="174" src="http://1.bp.blogspot.com/-EsqzX-fI1_o/T1r2zdlD2PI/AAAAAAAAAKg/4Gj8hgM9XhI/s320/IDE.png" /&gt;&lt;/a&gt;&lt;br /&gt;Doesn't Visual Studio just spoil us?&lt;/div&gt;&lt;br /&gt;JavaScript is loosely / dynamically typed (&lt;a href="http://stackoverflow.com/questions/9154388/does-untyped-also-mean-dynamically-typed-in-the-academic-cs-world" target="_blank"&gt;occasionally called "untyped" but let's not go there&lt;/a&gt;).  This means that the IDE can't easily determine what's what.  So no tooltips for you sunshine.&lt;br /&gt;&lt;br /&gt;&lt;h5&gt;2. The lack of safety nets / running with scissors&lt;/h5&gt; Now I've come to love it but what I realised pretty quickly when getting into JavaScript was this: you are running with scissors.  If you're not careful and you don't take precautions it can bloody quickly.&lt;br /&gt;&lt;br /&gt;If I'm writing C# I have a lot of safety nets.  Not the least of which is "does it compile"?  If I declare an integer and then subsequently try to assign a string value to it &lt;u&gt;it won't let me&lt;/u&gt;.  But JavaScript is forgiving.  Some would say too forgiving.  Let's do something mad:&lt;br /&gt;&lt;br /&gt;&lt;pre&gt;&lt;code class="language-js"&gt;&lt;br /&gt;var iAmANumber = 77;&lt;br /&gt;&lt;br /&gt;console.log(iAmANumber); //Logs a number&lt;br /&gt;&lt;br /&gt;iAmANumber = "It's a string";&lt;br /&gt;&lt;br /&gt;console.log(iAmANumber); //Logs a string&lt;br /&gt;&lt;br /&gt;iAmANumber = { &lt;br /&gt;  description: "I am an object"&lt;br /&gt;};&lt;br /&gt;&lt;br /&gt;console.log(iAmANumber); //Logs an object&lt;br /&gt;&lt;br /&gt;iAmANumber = function (myVariable) {&lt;br /&gt;&lt;br /&gt;  console.log(myVariable);&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;console.log(iAmANumber); //Logs a function&lt;br /&gt;iAmANumber("I am not a number, I am a free man!"); //Calls a function which performs a log&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;Now if I were to attempt something similar in C# fuggedaboudit but JavaScript; no I'm romping home free:&lt;br /&gt;&lt;br /&gt;&lt;div class="separator" style="clear: both; text-align: center;"&gt;&lt;a href="http://4.bp.blogspot.com/-eXsAuYmXRms/T1xT7Dl9D7I/AAAAAAAAALE/93Odb9vWNZI/s1600/Mad%2BStuff.png" imageanchor="1" style="margin-left:1em; margin-right:1em"&gt;&lt;img border="0" height="251" width="320" src="http://4.bp.blogspot.com/-eXsAuYmXRms/T1xT7Dl9D7I/AAAAAAAAALE/93Odb9vWNZI/s320/Mad%2BStuff.png" /&gt;&lt;/a&gt;&lt;br /&gt;Sir, your tolerance is extreme...&lt;/div&gt;&lt;br /&gt;Now I'm not saying that you should ever do the above, and thinking about it I can't think of a situation where you'd want to (suggestions on a postcard).  But the point is it's possible.  And because it's possible to do this deliberately, it's doubly possible to do this accidentally.  My point is this: it's easy to make bugs in JavaScript.&lt;br /&gt;&lt;br /&gt;&lt;h4&gt;What &lt;del&gt;Katy&lt;/del&gt; Johnny Did Next&lt;/h4&gt;I'd started making more and more extensive use of JavaScript.  I was beginning to move in the direction of using the &lt;a href="http://en.wikipedia.org/wiki/Single-page_application" target="_blank"&gt;single-page application&lt;/a&gt; approach (&lt;i&gt;&amp;lt;sideNote&amp;gt;although more in the sense of giving application style complexity to individual pages rather than ensuring that entire applications ended up in a single page&amp;lt;/sideNote&amp;gt;&lt;/i&gt;).&lt;br /&gt;&lt;br /&gt;This meant that whereas in the past I'd had the occasional 2 lines of JavaScript I now had a multitude of functions which were all interacting in response to user input.  All these functions would contain a number of different variables.  As well as this I was making use of jQuery for both Ajax purposes and to smooth out the DOM inconsistencies between various browsers.  This only added to the mix as variables in one of my functions could be any one of the following: &lt;ul&gt;&lt;li&gt;a number&lt;/li&gt;&lt;li&gt;a string&lt;/li&gt;&lt;li&gt;a boolean&lt;/li&gt;&lt;li&gt;a date&lt;/li&gt;&lt;li&gt;an object&lt;/li&gt;&lt;li&gt;an array&lt;/li&gt;&lt;li&gt;a function&lt;/li&gt;&lt;li&gt;a jQuery object - not strictly a distinct JavaScript type obviously but treated pretty much as one in the sense that it has a particular functions / properties etc associated with it&lt;/li&gt;&lt;/ul&gt;&lt;br /&gt;As I started doing this sort of work I made no changes to my coding style.  Wherever possible I did *&lt;b&gt;exactly&lt;/b&gt;* what I would have been doing in C# in JavaScript.  And it worked fine.  Until....&lt;br /&gt;&lt;br /&gt;Okay there is no "until" as such, it did work fine.  But what I found was that I would do a piece of work, check it into source control, get users to test it, release the work into Production and promptly move onto the next thing.  However, a little way down the line there would be a request to add a new feature or perhaps a bug was reported and I'd find myself back looking at the code.  And, as is often the case, despite the comments I would realise that it wasn't particularly clear why something worked in the way it did.  (Happily it's not just me that has this experience, paranoia has lead me to ask many a fellow developer and they have confessed to similar)&lt;br /&gt;&lt;br /&gt;  When it came to bug hunting in particular I found myself cursing the lack of friendly tooltips and the like.  Each time I wanted to look at a variable I'd find myself tracking back through the function, looking for the initial use of the variable to determine the type.  Then I'd be tracking forward through the function for each subsequent use to ensure that it conformed.&lt;br /&gt;&lt;br /&gt;Distressingly, I would find examples of where it looked like I'd forgotten the type of the variable towards the end of a function (for which I can only, regrettably, blame myself).  Most commonly I would have a situation like this:&lt;br /&gt;&lt;br /&gt;&lt;pre&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;var tableCell = $("#ItIsMostDefinitelyATableCell"); //I jest ;-)&lt;br /&gt;&lt;br /&gt;/* ...THERE WOULD BE SOME CODE DOING SOMETHING HERE... */&lt;br /&gt;&lt;br /&gt;tableCell.className = "makeMeProminent"; //Oh dear - not good.&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;br /&gt;You see what happened above?  I forgot I had a jQuery object and instead treated it like it was a standard DOM element.  Oh dear.&lt;br /&gt;&lt;br /&gt;&lt;h4&gt;Spinning my own safety net; Hungarian style&lt;/h4&gt; After I'd experienced a few of the situations described above I decided that steps needed to be taken to minimise the risk of this.  In this case, I decided that "steps" meant &lt;a href="http://en.wikipedia.org/wiki/Hungarian_notation" target="_blank"&gt;Hungarian notation&lt;/a&gt;.  I know.  I bet you're wincing right now.&lt;br /&gt;&lt;br /&gt;For those of you that don't remember HN was pretty much the standard way of coding at one point (although at the point that I started coding professionally it had already started to decline).  It was adopted in simpler times long before the modern IDE's that tell you what each variable is became the norm.  Back when you couldn't be sure of the types you were dealing with.  In short, kind of like my situation with JavaScript right now.&lt;br /&gt;&lt;br /&gt;There's not much to it.  By and large HN simply means having a lowercase prefix of 1-3 characters on all your variables indicating type.  It doesn't solve all your problems.  It doesn't guarantee to stop bugs.  But because each instance of the variables use implicitly indicates it's type it makes bugs more glaringly obvious.  This means when writing code I'm less likely to misuse a variable (eg &lt;code&gt;iNum = "JIKJ"&lt;/code&gt;) because part of my brain would be bellowing: "that just looks wrong... pay better attention lad!".  Likewise, if I'm scanning through some JavaScript and searching for a bug then this can make it more obvious.&lt;br /&gt;&lt;br /&gt;Here's some examples of different types of variables declared using the style I have adopted:&lt;br /&gt;&lt;pre&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;var iInteger = 4;&lt;br /&gt;var dDecimal = 10.50;&lt;br /&gt;var sString = "I am a string";&lt;br /&gt;var bBoolean = true;&lt;br /&gt;var dteDate = new Date();&lt;br /&gt;var oObject = {&lt;br /&gt;  description: "I am an object"&lt;br /&gt;};&lt;br /&gt;var aArray = [34, 77];&lt;br /&gt;var fnFunction = function () {&lt;br /&gt;  //Do something&lt;br /&gt;};&lt;br /&gt;var $jQueryObject = $("#ItIsMostDefinitelyATableCell");&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;br /&gt;Some of you have read this and thought "hold on a minute... JavaScript doesn't have integers / decimals etc".  You're quite right.  My style is not specifically stating the type of a variable.  More it is seeking to provide a guide on how a variable should be used.  JavaScript does not have integers.  But oftentimes I'll be using a number variable which i will only ever want to treat as an integer.  And so I'll name it accordingly.&lt;br /&gt;&lt;br /&gt;&lt;h4&gt;Spinning a better safety net; DOJO style&lt;/h4&gt;I would be the first to say that alternative approaches are available.  And here's one I recently happened upon that I rather like the look of: look 2/3rds down at the parameters section of &lt;a href="http://dojotoolkit.org/community/styleGuide" target="_blank"&gt;the DOJO styleguide&lt;/a&gt;&lt;br /&gt;&lt;br /&gt;Essentially they advise specifying parameter types through the use of prefixed comments.  See the examples below: &lt;pre&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;function(/*String*/ foo, /*int*/ bar)...&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;or &lt;pre&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;function(/*String?*/ foo, /*int*/ bar, /*String[]?*/ baz)...&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;I really rather like this approach and I'm thinking about starting to adopt it.  It's not possible in Hungarian Notation to be so clear about the purpose of a variable.  At least not without starting to adopt all kinds of kooky conventions that take in all the possible permutations of variable types.  And if you did that you'd really be defeating yourself anyway as it would simply reduce the clarity of your code and make bugs more likely.&lt;br /&gt;&lt;br /&gt;&lt;h4&gt;Spinning a better safety net; unit tests&lt;/h4&gt;Despite being quite used to writing unit tests for all my server-side code I have not yet fully embraced unit testing on the client.  Partly I've been holding back because of the variety of JavaScript testing frameworks available.  I wasn't sure which to start with.&lt;br /&gt;&lt;br /&gt;But given that it is so easy to introduce bugs into JavaScript I have come to the conclusion that it's better to have some tests in place rather than none.  Time to embrace the new.&lt;br /&gt;&lt;br /&gt;&lt;h4&gt;Conclusion&lt;/h4&gt;I've found using Hungarian Notation useful whilst working in JavaScript.  Not everyone will feel the same and I think that's fair enough; within reason I think it's generally a good idea to go with what you find useful.&lt;br /&gt;&lt;br /&gt;However, I am giving genuine consideration to moving to the DOJO style and moving back to my more standard camel-cased variable names instead of Hungarian Notation.  Particularly since I strive to keep my functions short with the view that ideally each should 1 thing well.  Keep it simple etc...&lt;br /&gt;&lt;br /&gt;And so in a perfect world the situation of forgetting a variables purpose shouldn't really arise...  I think once I've got up and running with JavaScript unit tests I may make that move. Hungarian Notation may have proved to be just a stop-gap measure until better techniques were employed...&lt;br /&gt;&lt;br /&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/9216884746304497451'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/9216884746304497451'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2012/03/striving-for-javascript-convention.html' title='Striving for (JavaScript) Convention'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='http://1.bp.blogspot.com/-EsqzX-fI1_o/T1r2zdlD2PI/AAAAAAAAAKg/4Gj8hgM9XhI/s72-c/IDE.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1825634548402124376</id><published>2012-03-03T09:22:00.004Z</published><updated>2021-03-17T21:27:18.141Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='jquery'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='jquery remote validation'/><category scheme='http://www.blogger.com/atom/ns#' term='jquery unobtrusive validation'/><title type='text'>jQuery Unobtrusive Remote Validation</title><content type='html'>&lt;p&gt;Just recently I have been particularly needing to make use of remote / server-side validation in my ASP.NET MVC application and found that the unobtrusive way of using this seemed to be rather inadequately documented (of course it's possible that it's well documented and I just didn't find the resources).  Anyway I've rambled on much longer than I intended to in this post so here's the TL;DR:&lt;/p&gt; &lt;ul&gt;&lt;li&gt;You *&lt;b&gt;can&lt;/b&gt;* use remote validation driven by unobtrusive data attributes&lt;/li&gt;&lt;li&gt;Using remote validation you can supply *&lt;b&gt;multiple&lt;/b&gt;* parameters to be evaluated&lt;/li&gt;&lt;li&gt;It is possible to block validation and force it to be re-evaluted - although using a slightly hacky method which I document here.  For what it's worth I acknowledge up front that this is *&lt;b&gt;not&lt;/b&gt;* an ideal solution but it does seem to work.  I really hope there is a better solution out there and if anyone knows about it then please get in contact and let me know.&lt;/li&gt;&lt;/ul&gt; &lt;p&gt;Off we go...  So, jQuery unobtrusive validation; clearly the new cool right?&lt;/p&gt; &lt;p&gt;I'd never been particularly happy with the validation that I had traditionally been using with ASP.NET classic.  It worked... but it always seemed a little... clunky?  I realise that's not the most well expressed concern.  For basic scenarios it seemed fine, but I have recollections of going through some pain as soon as I stepped outside of the basic form validation.  Certainly when it came to validating custom controls that we had developed it never seemed entirely straightforward to get validation to play nice.&lt;/p&gt; &lt;p&gt;Based on this I was keen to try something new and the opportunity presented itself when we started integrating MVC into our classic WebForms app.  (By the way if you didn't know that MVC and ASP.NET could live together in perfect harmony, well, they can!  And a good explanation on how to achieve it is offered by Colin Farr  &lt;a href="http://www.britishdeveloper.co.uk/2011/05/convert-web-forms-mvc3-how-to.html" target="_blank"&gt;here&lt;/a&gt;.)&lt;/p&gt; &lt;p&gt;Jrn Zaefferer came out with the &lt;a href="http://bassistance.de/jquery-plugins/jquery-plugin-validation/" target="_blank"&gt;jQuery validation plug-in&lt;/a&gt; way back in 2006.  And mighty fine it is too.  Microsoft (gor' bless 'em) really brought something new to the jQuery validation party when they came out with their unobtrusive javascript validation library along with MVC 3.  What this library does, in short, is allows for jQuery validation to be driven by &lt;code&gt;data-val-*&lt;/code&gt; attributes alone as long as the &lt;a href="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.9/jquery.validate.js" target="_blank"&gt;jquery.validate.js&lt;/a&gt; and &lt;a href="http://ajax.aspnetcdn.com/ajax/mvc/3.0/jquery.validate.unobtrusive.js" target="_blank"&gt;jquery.validate.unobtrusive.js&lt;/a&gt; libraries are included in the screen (I have assumed you are already including jQuery).  I know; powerful stuff!&lt;/p&gt; &lt;p&gt;A good explanation of unobtrusive validation is given by Brad Wilson &lt;a href="http://bradwilson.typepad.com/blog/2010/10/mvc3-unobtrusive-validation.html" target="_blank"&gt;here&lt;/a&gt;.&lt;/p&gt; &lt;p&gt;Anyway, to my point: what about remote validation?  That is to say, what about validation which needs to go back to the server to perform the necessary tests?  Well I struggled to find decent examples of how to use this.  Those that I did find seemed to universally be php examples; not so useful for an ASP.NET user.  Also, when I did root out an ASP.NET example there seemed to be a fundamental flaw.  Namely, if remote validation hadn't been triggered and completed successfully then the submit could fire anyway.  This seems to be down to the asynchronous nature of the test; ie because it is *&lt;b&gt;not&lt;/b&gt;* synchronous there is no "block" to the submit.  And out of the box with unobtrusive validation there seems no way to make this synchronous.  I could of course wire this up manually and simply side-step the restrictions of unobtrusive validation but that wasn't what I wanted.&lt;/p&gt; &lt;p&gt;&lt;b&gt;&lt;i&gt;Your mission John, should you decide to accept it, is this: &lt;u&gt;block the submit until remote validation has completed successfully&lt;/u&gt;.  As always, should you or any of your I.M. Force be caught or killed, the Secretary will disavow any knowledge of your actions.&lt;/i&gt;&lt;/b&gt;&lt;/p&gt; &lt;p&gt;So that's what I wanted to do.  Make it act like it's synchronous even though it's asynchronous.  Bit horrible but I had a deadline to meet and so this is my pragmatic solution.  There may be better alternatives but this worked for me.&lt;/p&gt; &lt;p&gt;First of all the HTML:&lt;/p&gt; &lt;pre class="prettyprint html"&gt;&lt;br /&gt;&lt;code class="language-html"&gt;&lt;br /&gt;&amp;lt;form action="/Dummy/ValidationDemo.mvc/SaveUser" &lt;br /&gt;    id="ValidationForm" method="post"&amp;gt;  &lt;br /&gt;&lt;br /&gt;  First name: &lt;br /&gt;  &amp;lt;input data-val="true" data-val-required="First Name required" &lt;br /&gt;      id="FirstName" name="FirstName" type="text" value="" /&amp;gt;&lt;br /&gt;&lt;br /&gt;  Last name: &lt;br /&gt;  &amp;lt;input data-val="true" data-val-required="Last Name required" &lt;br /&gt;      id="LastName" name="LastName" type="text" value="" /&amp;gt;&lt;br /&gt;&lt;br /&gt;  User name: &lt;br /&gt;  &amp;lt;input id="UserName" name="UserName" type="text" value=""&lt;br /&gt;    data-val="true" &lt;br /&gt;    data-val-required="You must enter a user name before we can validate it remotely"&lt;br /&gt;    data-val-remote="&amp;amp;amp;#39;UserNameInput&amp;amp;amp;#39; is invalid." &lt;br /&gt;    data-val-remote-additionalfields="*.FirstName,*.LastName" &lt;br /&gt;    data-val-remote-url="/Dummy/ValidationDemo/IsUserNameValid" /&amp;gt;&lt;br /&gt;&lt;br /&gt;  &amp;lt;input id="SaveMyDataButton" name="SaveMyDataButton" &lt;br /&gt;      type="button" value="Click to Save" /&amp;gt;&lt;br /&gt;&amp;lt;/form&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;I should mention that on my actual page (a cshtml partial view) the HTML for the inputs is generated by the use of the &lt;a href="http://msdn.microsoft.com/en-us/library/system.web.mvc.html.inputextensions.textboxfor.aspx" target="_blank"&gt;InputExtensions.TextBoxFor&lt;/a&gt; method which is lovely.  It takes your model and using the validation attributes that decorate your models properties it generates the relevant jQuery unobtrusive validation data attributes so you don't have to do it manually.&lt;/p&gt; &lt;p&gt;But for the purposes of seeing what's "under the bonnet" I thought it would be more useful to post the raw HTML so it's entirely clear what is being used.  Also there doesn't appear to be a good way (that I've yet seen) for automatically generating Remote validation data attributes in the way that I've found works.  So I'm manually specifying the &lt;code&gt;data-val-remote-*&lt;/code&gt; attributes using the htmlAttributes parameter of the TextBoxFor (&lt;a href="http://stackoverflow.com/questions/4844001/html5-data-with-asp-net-mvc-textboxfor-html-attributes" target="_blank"&gt;using "_" to replace "-"&lt;/a&gt; obviously).&lt;/p&gt; &lt;p&gt;Next the JavaScript that performs the validation:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;$(document).ready(function () {&lt;br /&gt;&lt;br /&gt;  var intervalId = null,&lt;br /&gt;&lt;br /&gt;  //&lt;br /&gt;  // DECLARE FUNCTION EXPRESSIONS&lt;br /&gt;  //&lt;br /&gt;&lt;br /&gt;  //======================================================&lt;br /&gt;  // function that triggers update when remote validation &lt;br /&gt;  // completes successfully&lt;br /&gt;  //======================================================&lt;br /&gt;  pendingValidationComplete = function () {&lt;br /&gt;&lt;br /&gt;    var i, errorList, errorListForUsers;&lt;br /&gt;    var $ValidationForm = $("#ValidationForm");&lt;br /&gt;    if ($ValidationForm.data("validator").pendingRequest === 0) {&lt;br /&gt;&lt;br /&gt;      clearInterval(intervalId);&lt;br /&gt;&lt;br /&gt;      //Force validation to present to user &lt;br /&gt;      //(this will *not* retrigger remote validation)&lt;br /&gt;      if ($ValidationForm.valid()) {&lt;br /&gt;&lt;br /&gt;        alert("Validation has succeeded - you can now submit");&lt;br /&gt;      }&lt;br /&gt;      else {&lt;br /&gt;&lt;br /&gt;        //Validation failed! &lt;br /&gt;        errorList = $ValidationForm.data("validator").errorList;&lt;br /&gt;        errorListForUsers = [];&lt;br /&gt;        for (i = 0; i &lt; errorList.length; i++) {&lt;br /&gt;          errorListForUsers.push(errorList[i].message);&lt;br /&gt;        }&lt;br /&gt;&lt;br /&gt;        alert(errorListForUsers.join("\r\n"));&lt;br /&gt;      }&lt;br /&gt;    }&lt;br /&gt;  },&lt;br /&gt;&lt;br /&gt;  //======================================================&lt;br /&gt;  // Trigger validation&lt;br /&gt;  //======================================================&lt;br /&gt;  triggerValidation = function (evt) {&lt;br /&gt;&lt;br /&gt;    //Removed cached values where remote is concerned&lt;br /&gt;    // so remote validation is retriggered&lt;br /&gt;    $("#UserName").removeData("previousValue");&lt;br /&gt;&lt;br /&gt;    //Trigger validation&lt;br /&gt;    $("#ValidationForm").valid();&lt;br /&gt;&lt;br /&gt;    //Setup interval which will evaluate validation &lt;br /&gt;    //(this approach because of remote validation)&lt;br /&gt;    intervalId = setInterval(pendingValidationComplete, 50);&lt;br /&gt;  };&lt;br /&gt;&lt;br /&gt;  //&lt;br /&gt;  //ASSIGN EVENT HANDLERS&lt;br /&gt;  //&lt;br /&gt;  $("#SaveMyDataButton").click(triggerValidation);&lt;br /&gt;});&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;And finally the Controller:&lt;/p&gt; &lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;public JsonResult IsUserNameValid(string UserName,&lt;br /&gt;                                  string FirstName, &lt;br /&gt;                                  string LastName)&lt;br /&gt;{&lt;br /&gt;  var userNameIsUnique = IsUserNameUnique(UserName);&lt;br /&gt;  if (userNameIsUnique)&lt;br /&gt;    return Json(true, JsonRequestBehavior.AllowGet);&lt;br /&gt;  else&lt;br /&gt;    return Json(string.Format(&lt;br /&gt;                  "{0} is already taken I'm afraid {1} {2}",&lt;br /&gt;                  UserName, FirstName, LastName), &lt;br /&gt;                JsonRequestBehavior.AllowGet);&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;private bool IsUserNameUnique(string potentialUserName)&lt;br /&gt;{&lt;br /&gt;  return false;&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;So what happens here exactly?  Well it's like this:&lt;/p&gt; &lt;ol&gt;&lt;li&gt;The user enters their first name, last name and desired user name and hits the "Click to Save" button.&lt;br /&gt;&lt;br /&gt;&lt;/li&gt;&lt;li&gt;This forces validation by first removing any cached validation values stored in &lt;code&gt;previousValue&lt;/code&gt; data attribute and then triggering the &lt;code&gt;valid&lt;/code&gt; method.&lt;br /&gt;&lt;br /&gt;Disclaimer: I KNOW THIS IS A LITTLE HACKY. I would have expected there would be some way in the API to manually re-force validation.  Unless I've missed something there doesn't appear to be.  (&lt;a href="http://stackoverflow.com/a/3797712/761388" target="_blank"&gt;And the good citizens of Stack Overflow would seem to concur.&lt;/a&gt;)  I would guess that the underlying assumption is that if nothing has changed on the client then that's all that matters.  Clearly that's invalid for our remote example given that a username could be "claimed" at any time; eg in between people first entering their username (when validation should have fired automatically) and actually submitting the form.  Anyway - this approach seems to get us round the problem.&lt;br /&gt;&lt;br /&gt;&lt;/li&gt;&lt;li&gt;When validation takes place the IsUserNameValid action / method on our controller will be called.  It's important to note that I have set up a method that takes 3 inputs; UserName, which is supplied by default as the UserName input is the one which is decorated with remote validation attributes as well as the 2 extra inputs of FirstName and LastName.  In the example I've given I don't actually need these extra attributes.  I'm doing this because I know that I have situations in remote validation where I *&lt;b&gt;need&lt;/b&gt;* to supply multiple inputs and so essentially I did it here as a proof of concept.&lt;br /&gt;&lt;br /&gt;The addition of these 2 extra inputs was achieved through the use of the &lt;code&gt;data-val-remote-additionalfields&lt;/code&gt; attribute.  When searching for documentation about this I found absolutely &lt;u&gt;none&lt;/u&gt;.  I assume there is some out there - if anyone knows then I'd very pleased to learn about it.  I only learned about it in the end by finding an example of someone using this out in the great wide world and understanding how to use it based on their example.&lt;br /&gt;&lt;br /&gt;To understand how the &lt;code&gt;data-val-remote-additionalfields&lt;/code&gt; attribute works you can look at jquery.validate.unobtrusive.js.  If you're just looking to get up and running then I found that the following works:&lt;br /&gt;&lt;code&gt;data-val-remote-additionalfields="*.FirstName,*.LastName"&lt;/code&gt;&lt;br /&gt;&lt;br /&gt;You will notice that:&lt;br /&gt;- Each parameter is supplied in the format &lt;i&gt;*.[InputName]&lt;/i&gt; and inputs are delimited by ","'s&lt;br /&gt;- Name is a &lt;u&gt;required&lt;/u&gt; attribute for an input if you wish it to be evaluated with unobtrusive validation.  (Completely obvious statement I realise; I'm writing that sentence more for my benefit than yours)&lt;br /&gt;- Finally, our validation always fails.  That's deliberate - I just wanted to be clear on the approach used to get remote unobtrusive validation with extra parameters up and running.&lt;br /&gt;&lt;br /&gt;&lt;/li&gt;&lt;li&gt;Using &lt;code&gt;setInterval&lt;/code&gt; we intend to trigger the &lt;code&gt;pendingValidationComplete&lt;/code&gt; function to check if remote validation has completed every 50ms - again I try to avoid setInterval wherever possible but this seems to be the most sensible solution in this case.&lt;br /&gt;&lt;br /&gt;&lt;/li&gt;&lt;li&gt;When the remote request finally completes (ie when &lt;code&gt;pendingRequest&lt;/code&gt; has a value of 0) then we can safely proceed on the basis of our validation results.  In the example above I'm simply alerting to the screen based on my results; this is *&lt;b&gt;not&lt;/b&gt;* advised for any finished work; I'm just using this mechanism here to demonstrate the principle.&lt;/li&gt;&lt;/ol&gt; &lt;p&gt;Validation in action:&lt;/p&gt; &lt;div class="separator" style="clear: both; text-align: center;"&gt;&lt;img border="0" height="320" width="315" src="http://1.bp.blogspot.com/-wSc0vM8JiG4/T1CPMcElBII/AAAAAAAAAKU/gKw4UrE5OGs/s320/validation-screenshot2.png" /&gt;&lt;/div&gt; &lt;p&gt;Well I've gone on for far too long but I am happy to have an approach that does what I need.  It does feel like a slightly hacky solution and I expect that there is a better approach for this that I'm not aware of.  As much as anything else I've written this post in the hope that someone who knows this better approach will set me straight.  In summary, this works.  But if you're aware of a better solution then please do get in contact - I'd love to know!&lt;/p&gt; &lt;p&gt;&lt;b&gt;PS:&lt;/b&gt;Just in case you're in the process of initially getting up and running with unobtrusive validation I've listed below a couple of general helpful bits of config etc:&lt;/p&gt; &lt;p&gt;The following setting is essential for Application_Start in Global.asax.cs:&lt;/p&gt;&lt;pre class="prettyprint cs"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;DataAnnotationsModelValidatorProvider.AddImplicitRequiredAttributeForValueTypes = false;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;The following settings should be used in your Web.Config:&lt;/p&gt; &lt;pre class="prettyprint xml"&gt;&lt;br /&gt;&lt;code class="language-xml"&gt;&lt;br /&gt;&amp;lt;appSettings&amp;gt;&lt;br /&gt;  &amp;lt;add key="ClientValidationEnabled" value="true" /&amp;gt;&lt;br /&gt;  &amp;lt;add key="UnobtrusiveJavaScriptEnabled" value="true "/&amp;gt;&lt;br /&gt;&amp;lt;/appSettings&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;My example used the following scripts:&lt;/p&gt; &lt;pre class="prettyprint html"&gt;&lt;br /&gt;&lt;code class="language-html"&gt;&lt;br /&gt;&amp;lt;script src="Scripts/jquery-1.7.1.js"&amp;gt;&amp;lt;/script&amp;gt;&lt;br /&gt;&amp;lt;script src="Scripts/jquery.validate.js"&amp;gt;&amp;lt;/script&amp;gt;&lt;br /&gt;&amp;lt;script src="Scripts/jquery.validate.unobtrusive.js"&amp;gt;&amp;lt;/script&amp;gt;&lt;br /&gt;&amp;lt;script src="Scripts/ValidationDemo.js"&amp;gt;&amp;lt;/script&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1825634548402124376'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1825634548402124376'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2012/03/jquery-unobtrusive-remote-validation.html' title='jQuery Unobtrusive Remote Validation'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='http://1.bp.blogspot.com/-wSc0vM8JiG4/T1CPMcElBII/AAAAAAAAAKU/gKw4UrE5OGs/s72-c/validation-screenshot2.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2532709066772783644</id><published>2012-03-01T09:56:00.000Z</published><updated>2012-03-01T09:56:03.480Z</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Example of how to use jsTree.aspx</title><content type='html'>&lt;%@ Page Language="C#" AutoEventWireup="true" CodeBehind="TradingHierarchyTreePickerList.aspx.cs" Inherits="Commerzbank.PCS.Web.Shared.TradingHierarchyTreePickerList" %&gt;&lt;!DOCTYPE html&gt;&lt;html&gt;  &lt;head runat="server"&gt;    &lt;title runat="server" id="genTitle"&gt;&lt;/title&gt;  &lt;/head&gt;  &lt;body runat="server" id="genBody" class="simplePickerBody"&gt;    &lt;form id="frmPickerList" method="post" runat="server"&gt;			&lt;table id="tblSearch" class="somePadding" style="margin: 5px;"&gt;			  &lt;tr&gt;				  &lt;td&gt;&lt;asp:label id="lblSearchName" runat="server" cssclass="lblCaption"&gt;Name&lt;/asp:label&gt;&lt;/td&gt;				  &lt;td&gt;&lt;input id="txtSearchName" type="text" class="txtControl" style="width:80px; margin-right: 2px;" /&gt;&lt;input id="btnClearSearchName" runat="server" type="button" class="btnStandard" value="Clear" data-clear-id="txtSearchName" /&gt;&lt;/td&gt;          &lt;td&gt;&lt;asp:label id="lblSearchId" runat="server" cssclass="lblCaption"&gt;Id&lt;/asp:label&gt;&lt;/td&gt;          &lt;td&gt;&lt;input id="txtSearchId" type="text" class="txtControl" style="width:80px; margin-right: 2px;" /&gt;&lt;input id="btnClearSearchId" runat="server" type="button" class="btnStandard" value="Clear" data-clear-id="txtSearchId" /&gt;&lt;/td&gt;				  &lt;td&gt;&lt;asp:dropdownlist id="drpLevelType" runat="server" cssclass="txtControl" /&gt;&lt;/td&gt;				  &lt;td&gt;            &lt;asp:RadioButton id="rdoAll" runat="server" GroupName="rdoSearchActive" CssClass="rdoControl" Text="All" /&gt;            &lt;asp:RadioButton id="rdoActive" runat="server" GroupName="rdoSearchActive" CssClass="rdoControl" Text="Active" Checked="True" /&gt;            &lt;asp:RadioButton id="rdoInactive" runat="server" GroupName="rdoSearchActive" CssClass="rdoControl" Text="Inactive" /&gt;				  &lt;/td&gt;          &lt;td&gt;&lt;input id="btnSearch" runat="server" type="button" value="Search" class="btnProminent" style="margin-left: 10px" /&gt;&lt;/td&gt;			  &lt;/tr&gt;		  &lt;/table&gt;      &lt;table class="noPadding" style="width: 100%;"&gt;        &lt;tr&gt;          &lt;td id="tdContainerResults"&gt;            &lt;div style="border: solid 1px black; padding: 2px; width: 98%; margin-left:auto; margin-right:auto;"&gt;              &lt;table style="margin-left:auto; margin-right: 5px;"&gt;                &lt;tr&gt;                  &lt;td style="width:17px;"&gt;&lt;img id="imgSearchResults" runat="server" /&gt;&lt;/td&gt;                  &lt;td style="width:100%;"&gt;&lt;asp:label id="lblSearchResults" runat="server" CssClass="screenFont" /&gt;&lt;/td&gt;                  &lt;td id="tdPage" data-page-size="100" data-hit-selected="1" style="background-color:#fff7e1; display:none;"&gt;                    &lt;span style="padding-left:5px; padding-right: 5px;"&gt;                      &lt;a id="lnkFirst" class="btnNav"&gt;&amp;lt;&amp;lt;&lt;/a&gt;                      &lt;a id="lnkPrev" class="btnNav"&gt;&amp;lt;&lt;/a&gt;                      &lt;span id="lblHitCount" class="btnNav" style="white-space:nowrap; margin-left: 5px; margin-right: 5px;"&gt;&lt;/span&gt;                      &lt;a id="lnkNext" class="btnNav"&gt;&amp;gt;&lt;/a&gt;                      &lt;a id="lnkLast" class="btnNav"&gt;&amp;gt;&amp;gt;&lt;/a&gt;                    &lt;/span&gt;                  &lt;/td&gt;                &lt;/tr&gt;              &lt;/table&gt;              &lt;div id="divContainerResults" style="overflow:auto; "&gt;                &lt;div id="divHierarchyResults" runat="server" class="screenFont"&gt;&lt;/div&gt;              &lt;/div&gt;            &lt;/div&gt;          &lt;/td&gt;          &lt;td id="tdControls" style="vertical-align: middle; text-align: center; display: none;"&gt;            &lt;input id="btnAdd" runat="server" type="button" class="btnStandard" value="Add" style="width: 80px; margin:5px;" /&gt;&lt;br /&gt;            &lt;input id="btnRemove" runat="server" type="button" class="btnStandard" value="Remove" style="width: 80px; margin:5px;" /&gt;&lt;br /&gt;            &lt;input id="btnClear" runat="server" type="button" class="btnStandard" value="Remove All" style="width: 80px; margin:5px;" /&gt;          &lt;/td&gt;          &lt;td id="tdContainerSelected" style="display: none;"&gt;            &lt;div style="border: solid 1px black; padding: 2px; width: 98%; margin-left:auto; margin-right:auto;"&gt;              &lt;table&gt;                &lt;tr&gt;                  &lt;td style="width:17px;"&gt;&lt;img id="imgSearchSelected" runat="server" /&gt;&lt;/td&gt;                  &lt;td&gt;&lt;asp:label id="lblSearchSelected" runat="server" CssClass="screenFont" /&gt;&lt;/td&gt;                &lt;/tr&gt;              &lt;/table&gt;              &lt;div id="divContainerSelected" style="overflow:auto;"&gt;                &lt;div id="divHierarchySelected" runat="server" class="screenFont"&gt;&lt;/div&gt;              &lt;/div&gt;            &lt;/div&gt;          &lt;/td&gt;        &lt;/tr&gt;      &lt;/table&gt;      &lt;table id="tblInfo" class="somePadding" style="margin-left: auto; margin-right: auto; margin-top: 5px;"&gt;        &lt;tr&gt;          &lt;td&gt;&lt;asp:label ID="lblInfoId" runat="server" cssclass="lblCaptionVerySmall"&gt;Id&lt;/asp:label&gt;&lt;/td&gt;          &lt;td&gt;&lt;input id="txtInfoId" type="text" class="txtControlReadOnlySmall" readonly="readonly" style="width:70px; margin-right: 10px;" /&gt;&lt;/td&gt;          &lt;td&gt;&lt;asp:label ID="lblInfoName" runat="server" cssclass="lblCaptionVerySmall"&gt;Name&lt;/asp:label&gt;&lt;/td&gt;          &lt;td&gt;&lt;input id="txtInfoName" type="text" class="txtControlReadOnlySmall" readonly="readonly" style="width:180px; margin-right: 10px;" /&gt;&lt;/td&gt;          &lt;td&gt;&lt;asp:label ID="lblInfoType" runat="server" cssclass="lblCaptionVerySmall"&gt;Type&lt;/asp:label&gt;&lt;/td&gt;          &lt;td&gt;&lt;input id="txtInfoType" type="text" class="txtControlReadOnlySmall" readonly="readonly" style="width:120px; margin-right: 10px;" /&gt;&lt;/td&gt;          &lt;td&gt;            &lt;span id="spnFunctionalUnit" style="display:none;"&gt;              &lt;asp:label ID="lblInfoLocation" runat="server" cssclass="lblCaptionVerySmall"&gt;Location&lt;/asp:label&gt;              &lt;input id="txtInfoLocation" type="text" class="txtControlReadOnlySmall" readonly="readonly" style="width:150px;" /&gt;            &lt;/span&gt;            &lt;span id="spnTradingBook" style="display:none;"&gt;              &lt;asp:label ID="lblInfoTrader" runat="server" cssclass="lblCaptionVerySmall"&gt;Trader&lt;/asp:label&gt;              &lt;input id="txtInfoTrader" type="text" class="txtControlReadOnlySmall" readonly="readonly" style="width:150px;" /&gt;            &lt;/span&gt;            &lt;span id="spnFrontOfficeBook" style="display:none;"&gt;              &lt;asp:label ID="lblInfoSourceSystem" runat="server" cssclass="lblCaptionVerySmall"&gt;SourceSystem&lt;/asp:label&gt;              &lt;input id="txtInfoSourceSystem" type="text" class="txtControlReadOnlySmall" readonly="readonly" style="width:150px;" /&gt;            &lt;/span&gt;          &lt;/td&gt;        &lt;/tr&gt;        &lt;tr&gt;          &lt;td&gt;&lt;asp:label ID="lblInfoHMId" runat="server" cssclass="lblCaptionVerySmall"&gt;HM Id&lt;/asp:label&gt;&lt;/td&gt;          &lt;td&gt;&lt;input id="txtInfoHMId" type="text" class="txtControlReadOnlySmall" readonly="readonly" style="width:70px" /&gt;&lt;/td&gt;          &lt;td&gt;&lt;asp:label ID="lblInfoCode" runat="server" cssclass="lblCaptionVerySmall"&gt;Code&lt;/asp:label&gt;&lt;/td&gt;          &lt;td&gt;&lt;input id="txtInfoCode" type="text" class="txtControlReadOnlySmall" readonly="readonly" style="width:180px" /&gt;&lt;/td&gt;          &lt;td&gt;&lt;asp:label ID="lblInfoActive" runat="server" cssclass="lblCaptionVerySmall"&gt;Active&lt;/asp:label&gt;&lt;/td&gt;          &lt;td colspan="2"&gt;&lt;input id="txtInfoActive" type="text" class="txtControlReadOnlySmall" readonly="readonly" style="width:120px" /&gt;&lt;/td&gt;        &lt;/tr&gt;      &lt;/table&gt;      &lt;div id="divButtons" style="margin:2px; padding:2px; text-align: center; display: none;"&gt;        &lt;input id="btnOK" runat="server" type="button" class="btnProminent" value="OK" style="width:85px;" /&gt;        &lt;input id="btnCancel" runat="server" type="button" class="btnProminent" value="Cancel" style="width:85px;" /&gt;      &lt;/div&gt;    &lt;/form&gt;  &lt;/body&gt;&lt;/html&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2532709066772783644'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2532709066772783644'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6980062745638105944</id><published>2012-03-01T09:53:00.002Z</published><updated>2012-03-01T09:53:27.048Z</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Example of how to use jsTree.js</title><content type='html'>//=============================================================================== // Method called when DOM loaded (this is earlier than the window onload method and so allows the screen to be set up faster) //=============================================================================== $(document).ready(function () {    //   // VARIABLES SHARED BY FUNCTION EXPRESSIONS - AS FEW AS POSSIBLE   //   var iTreesBeingCreated = 0,     iFunctionalUnitLevelTypeId = 6,     iTradingBookLevelTypeId = 9,     iFrontOfficeBookLevelTypeId = 10,     oCheckboxClasses = {       checkbox: "treepicker-checkbox",       checked: "treepicker-checked",       unchecked: "treepicker-unchecked"     };    //   // DECLARE FUNCTION EXPRESSIONS   //    //===============================================================================   // Create a JSTree   //===============================================================================   var fnCreateTree = function ($divTree, bPerformSearch) {      //Set search controls disabled while if no trees are currently being created (in which case controls should already be disabled)     if (iTreesBeingCreated &lt; 1) fnSetSearchControlsEnabled(false);      //Increment count of trees being created     iTreesBeingCreated++;      //Either use passed tree (which will be divHierarchyResults) or get it now     var $divHierarchyResults = ($divTree.prop("id") === "divHierarchyResults") ? $divTree : $("#divHierarchyResults"),       $tdPage = $("#tdPage");      //Get properties used by search     var bMultiSelect = $divHierarchyResults.data("multiSelect"),       sUrlTree = $divHierarchyResults.data("getHierarchy"),       sUrlCssJsTree = $divHierarchyResults.data("urlCssJsTree"),       aLevelTypeIds = $divHierarchyResults.data("levelTypeIds"),       aProductTypeIds = $divHierarchyResults.data("productTypeIds"),       aProductSubTypeIds = $divHierarchyResults.data("productSubTypeIds"),       bHMNodes = $divHierarchyResults.data("hmNodes"),       bIsSelectedTree = ($divTree.prop("id") === "divHierarchySelected"),       aIds = null;      bPerformSearch = bPerformSearch || false; //Make sure false if not supplied      $divTree       .jstree({          //"core": { "html_titles": true },          "plugins": ((bMultiSelect)             ? ["themes", "json_data", "ui", "crrm"] //multi select             : ["themes", "json_data", "ui"] //single select           ),          "json_data": {           "progressive_render": true, //Used to handle very large tree structures with acceptable performance (only renders necessary nodes)           "progressive_unload": true, //Used to handle very large tree structures with acceptable performance (unrenders nodes that are hidden)           "ajax": {             "url": sUrlTree,              "data": function (n) {                if (bPerformSearch) {                  //At the start of all searches hide the pager                 $tdPage.hide();                }               else {                  //Only populate aIds in certain circumstances                  if ((bMultiSelect) &amp;&amp; (bIsSelectedTree)) {                    //if this is the selected tree and it's multiselect mode                   aIds = (n.prop)                     ? fnGenerateSelectedIds(true) //This is a child load so make use of existing selected nodes                     : fnGetSelectedIds($divHierarchyResults); //This is probably a first load of the screen - use metadata on the div                 }                 else if ((!bMultiSelect) &amp;&amp; (!bIsSelectedTree)) {                    //it's not the selected tree and it's not multiselect mode (this will ensure all trees populate correctly when initialised)                   aIds = fnGetSelectedIds($divHierarchyResults);                 }               }                //Stringify the required parameters for passing to the server               return JSON.stringify({                  //Indicate if this is the selected tree or not                 isSelectedTree: bIsSelectedTree,                  //Indicate if there are restrictions on the number of level types being used in this picker                 allowedLevelTypeIds: aLevelTypeIds,                  //Only this supplied if getting child nodes                 id: n.prop                   ? parseInt(n.prop("id").substring(1), 10) //Lop off the starting "n"                   : null,                  //Only this supplied if getting selected ids                 ids: (bPerformSearch) ? null : aIds,                  //All these supplied if doing a search                 searchName: ((bPerformSearch) ? $("#txtSearchName").val() : null),                 searchId: ((bPerformSearch) ? $("#txtSearchId").val() : null),                 searchLevelTypeId: ((bPerformSearch) ? parseInt($("#drpLevelType").val(), 10) : null),                 searchStatus: ((bPerformSearch) ? $("input[name='rdoSearchActive']:checked").val() : null),                 searchProductTypeIds: ((bPerformSearch) ? aProductTypeIds : null),                 searchProductSubTypeIds: ((bPerformSearch) ? aProductSubTypeIds : null),                 searchHMNodes: ((bPerformSearch) ? bHMNodes : null),                 searchHitSelected: ((bPerformSearch) ? $tdPage.data("hitSelected") : null),                 searchHitPageSize: ((bPerformSearch) ? $tdPage.data("pageSize") : null)               });             },             "type": "POST",             "dataType": "json",             "contentType": "application/json",              "success": function (data, textStatus, jqXHR) {                //Decrement count of trees being created               iTreesBeingCreated--;                //Set search controls enabled if no trees being created               if (iTreesBeingCreated &lt; 1) {                  fnSetSearchControlsEnabled(true);                  //Reset focus                 if ($divHierarchyResults.data("focusId")) $("#" + $divHierarchyResults.data("focusId")).focus();               }                //If performing search and there are some hits then make use of pager               if (bPerformSearch) {                  //Set flag to false so subsequent "get child" requests don't attempt to set pager details                 bPerformSearch = false;                  //Set pager                 fnSetPagerBasedOnSearchResults($tdPage, data.d)               }                //Data is wrapped in ASP.NETs "d" security property so extract below               return data.d;             },              "error": function (jqXHR, textStatus, errorThrown) {                //Decrement count of trees being created               iTreesBeingCreated--;                //Set search controls enabled if no trees being created               if (iTreesBeingCreated &lt; 1) fnSetSearchControlsEnabled(true);                if (errorThrown) {                  //Failed                 alert("Problem - please alert PCS Admin");               }             }           }         },          "themes": {           "theme": "default",           "dots": true,           "icons": true,           "url": sUrlCssJsTree         },          "ui": {           "select_limit": ((bMultiSelect) ? -1 : 1), //Unlimited in multiselect           "disable_selecting_children": true,           "selected_parent_open": true,           "initially_select": (((!bMultiSelect) &amp;&amp; (aIds) &amp;&amp; (aIds.length &gt; 0))             ? ["n" + aIds[0]] //Extract the id, Prefix with an "n" and pass it into the array             : []) //Only initially select in non multiselect mode         }       })       .bind("select_node.jstree", function (evt, data) {          var sId = data.rslt.obj.prop("id").substring(1); // "data.rslt.obj" is the jquery extended node that was clicked          //Look up trading hierarchy node details if different to what has already been looked up         if ($("#txtInfoId").val() !== sId) {           fnDisplayNodeDetails(parseInt(sId, 10)); //Lop off the starting "n"         }       });   },    //===============================================================================   // Set the pager based on search results   //===============================================================================   fnSetPagerBasedOnSearchResults = function ($tdPage, nodes) {      if (nodes.length &gt; 0) {        var $lblHitCount = $("#lblHitCount"),         $lnkNext = $("#lnkNext,#lnkLast"),         $PrevFirstButtons = $("#lnkFirst,#lnkPrev"),         pagerDataHolder = nodes[0].attr;        var pagerData = {         pageSize: parseInt(pagerDataHolder["data-page-size"], 10),         hitCount: parseInt(pagerDataHolder["data-hit-count"], 10),         hitSelected: parseInt(pagerDataHolder["data-hit-selected"], 10),         lastHitOnPage: parseInt(pagerDataHolder["data-last-hit-on-page"], 10),         pagerText: pagerDataHolder["data-pager-text"],         hitSelectedHistory: ($tdPage.data("hitSelectedHistory") ? $tdPage.data("hitSelectedHistory") : []) //If there is an existing value then hold onto it       };        //Store pager data       $tdPage.data(pagerData);        //Set Pager text       $lblHitCount.text(pagerData.pagerText)        //Show/hide the Prev/First Page buttons?       if ((pagerData.hitCount &gt; 0) &amp;&amp; (pagerData.hitSelected &gt; 1)) {          $PrevFirstButtons.show();       }       else {         $PrevFirstButtons.hide();       }        //Show the Next Page button?       if (pagerData.lastHitOnPage &lt; pagerData.hitCount) {         $lnkNext.show();       }       else {         $lnkNext.hide();       }        //Show the pager       $tdPage.show();     }   },    //===============================================================================   // Determine pager data for a search   //===============================================================================   fnDeterminePagerDataForASearch = function (sId) {      var $tdPage = $("#tdPage");     var pagerData = $tdPage.data(),         savePagerData = false;      //Handle paging     if (pagerData) {        switch (sId) {          case "lnkPrev":           pagerData.hitSelected = pagerData.hitSelectedHistory.pop();           savePagerData = true;           break;          case "lnkNext":           pagerData.hitSelectedHistory.push(pagerData.hitSelected);           pagerData.hitSelected = pagerData.lastHitOnPage + 1;           savePagerData = true;           break;          case "lnkLast":           pagerData.hitSelectedHistory = [];           pagerData.hitSelected = 1;           while (pagerData.hitSelected &lt; pagerData.hitCount) {              pagerData.hitSelectedHistory.push(pagerData.hitSelected);             pagerData.hitSelected = pagerData.hitSelected + pagerData.pageSize;           }           pagerData.hitSelected = pagerData.hitSelectedHistory.pop();           savePagerData = true;           break;          default: // "lnkFirst" and new searches will both drop into this clause           pagerData.hitSelected = 1;           pagerData.lastHitOnPage = 0;           pagerData.hitSelectedHistory = [];           savePagerData = true;           break;       }        //Save pager data       if (savePagerData) $tdPage.data(pagerData);     }   },    //===============================================================================   // Decide if we have enough criteria to trigger a search (don't want to get so many results the picker doesn't perform for the user)   //===============================================================================   fnShouldWeTriggerASearch = function ($divHierarchyResults, bCheckWithTheUser) {      var sSearchName = $("#txtSearchName").val();     if ((bCheckWithTheUser) &amp;&amp; (sSearchName.indexOf("*") !== -1)) {        //Check if the user is sure       return confirm($divHierarchyResults.data("questionSlowSearch").replace(/\\r\\n/g, "\r\n"))     }     else {       return (         (sSearchName) ||         ($("#txtSearchId").val()) ||         ($divHierarchyResults.data("productTypeIds").length &gt; 0) ||         ($divHierarchyResults.data("productSubTypeIds").length &gt; 0)         );     }   },    //===============================================================================   // Trigger a search   //===============================================================================   fnPerformSearch = function (evt) {      var $divHierarchyResults = $("#divHierarchyResults"),       bShouldWeTriggerASearch = true;      //Don't need to check if we should be doing a search if people are clicking the paging buttons     if ((evt) &amp;&amp; (evt.target) &amp;&amp; (evt.target.id.indexOf("lnk") !== 0)) {       bShouldWeTriggerASearch = fnShouldWeTriggerASearch($divHierarchyResults, true);     }      //Only trigger a search if one of the below is true     if (bShouldWeTriggerASearch) {        if ((evt) &amp;&amp; (evt.target)) {          //Save away current element for refocussing         $divHierarchyResults.data("focusId", evt.target.id);          fnDeterminePagerDataForASearch(evt.target.id);       }        //Destroy the tree and then recreate       $divHierarchyResults.empty();       $divHierarchyResults.jstree("destroy");        //Make me a tree       fnInitialiseResultsTree(true);     }   },    //===============================================================================   // Initialise the Results tree   //===============================================================================   fnInitialiseResultsTree = function (bPerformSearch) {      var $divHierarchyResults = $("#divHierarchyResults");      //Create the tree     fnCreateTree($divHierarchyResults, bPerformSearch);      //Bind the relevant double click event handler     $divHierarchyResults.bind("dblclick.jstree", (($divHierarchyResults.data("multiSelect"))      //if multi select type picker then use the UI plugin bind double click event for selecting an item       ? function (evt) {          var $dblClickedNode = $(evt.target).closest("li");          //Add this trading hierarchy node         fnAddNode(null, $dblClickedNode, $divHierarchyResults);       }      //if single select type picker then use the UI plugin bind double click event for selecting an item       : function (evt) {          var $dblClickedNode = $(evt.target).closest("li"),           aLevelTypeIds = $divHierarchyResults.data("levelTypeIds"),           bUseThisNode = true;          //Ensure users select only nodes from the level they are allowed to         if (aLevelTypeIds.length &gt; 0) {            //Check the current node level type is acceptable           if ($.inArray($dblClickedNode.data("levelTypeId"), aLevelTypeIds) === -1) {              bUseThisNode = false;             alert($divHierarchyResults.data("errorNodeSelectCorrectType").format($("#drpLevelType").text()));           }         }          //Return the selected trading hierarchy node to the picker         if (bUseThisNode) fnReturnValuesToPicker(null, [parseInt($dblClickedNode.prop("id").substring(1), 10)]);       }       ));      //if single select then bind loaded event     if (!$divHierarchyResults.data("multiSelect")) {        //Select selected trading hierarchy node on load       $divHierarchyResults.bind("loaded.jstree", function (evt, data) {          //Any trading hierarchy node to select?         var aIds = fnGetSelectedIds($divHierarchyResults);          //There is, so let's select it - this used as "initially_select" doesn't seem to be working...         if ((aIds) &amp;&amp; (aIds.length &gt; 0)) {            $divHierarchyResults.jstree("select_node", "#n" + aIds[0]);         }       });     }   },    //===============================================================================   // Initialise the Selected tree   //===============================================================================   fnInitialiseSelectedTree = function ($divHierarchySelected) {      //Either use passed or get afresh     $divHierarchySelected = $divHierarchySelected || $("#divHierarchySelected");      //Create the tree     fnCreateTree($divHierarchySelected);      //if user double clicks on a selected trading hierarchy node then it is removed from tree     $divHierarchySelected.bind("dblclick.jstree", function (evt) {        var $dblClickedNode = $(evt.target).closest("li");        //Remove selected node from the tree       fnRemoveNode(null, $dblClickedNode, $divHierarchySelected);     });      /*     //Add checkboxes now it has loaded     $divHierarchySelected.bind("loaded.jstree", function (evt, data) {      //Get checkboxes in there     fnEnrichSelectedTreeWithCheckboxes($divHierarchySelected);      });     */      //After each load of nodes add checkboxes in     $divHierarchySelected.bind("load_node.jstree", function (evt, data) {        //Get checkboxes in there       fnEnrichSelectedTreeWithCheckboxes($divHierarchySelected, (         (data.rslt.obj === -1)           ? null           : data.rslt.obj.prop("id")));      });   },    //===============================================================================   // Enrich selected tree with checkboxes   //===============================================================================   fnEnrichSelectedTreeWithCheckboxes = function ($divHierarchySelected, sParentId) {      //Either use passed or get afresh     $divHierarchySelected = $divHierarchySelected || $("#divHierarchySelected");      //Get selected ids     var aSelectedIds = (sParentId)       ? fnGenerateSelectedIds(false, $divHierarchySelected) //This is a child load so make use of existing selected nodes       : fnGetSelectedIds(); //This is probably a first load of the screen - use metadata on the div      //Remove existing checkboxes     $divHierarchySelected.find("span." + oCheckboxClasses.checkbox).remove();      //Iterate through all list items in selected tree     $divHierarchySelected.find("li").each(function (index, li) {        var iId = parseInt(li.id.substring(1), 10),         $li = $(li);        //If in selected ids array then we should check this       var bShouldCheck = ($.inArray(iId, aSelectedIds) !== -1);        //If not already checking this node then see if this a child of the parent - if it is then it should be checked       if ((!bShouldCheck) &amp;&amp; ($li.parents("li").prop("id") === sParentId)) { bShouldCheck = true; }        //Create checkbox html       var $checkbox = $("&lt;span/&gt;", {         "class": (oCheckboxClasses.checkbox + " " + //"class" in quotes as is a reserved word           ((bShouldCheck)             ? oCheckboxClasses.checked             : oCheckboxClasses.unchecked)),         id: "c" + iId,         click: fnCheckUncheck       });        //Add checkbox       $checkbox.insertAfter($li.children("a").children("ins"));     });   },    //===============================================================================   // Check and uncheck checkboxes   //===============================================================================   fnCheckUncheck = function (evt) {      var $checkbox = $(this);     var $li = $checkbox.closest("li");      if ($checkbox.hasClass(oCheckboxClasses.checked)) {        //Make selected checkbox unchecked       $checkbox         .removeClass(oCheckboxClasses.checked)         .addClass(oCheckboxClasses.unchecked);        //Make child checkboxes unchecked       $li.find("span." + oCheckboxClasses.checkbox)         .removeClass(oCheckboxClasses.checked)         .addClass(oCheckboxClasses.unchecked);      }     else {        //Make checked       $checkbox         .removeClass(oCheckboxClasses.unchecked)         .addClass(oCheckboxClasses.checked);        //Make child checkboxes checked       $li.find("span." + oCheckboxClasses.checkbox)         .removeClass(oCheckboxClasses.unchecked)         .addClass(oCheckboxClasses.checked);     }   },    //===============================================================================   // Add the selected trading hierarchy node   //===============================================================================   fnAddNode = function (evt, $NodesToAdd, $divHierarchyResults) {      var aSelectedIds, aParentIdsAlreadyInArray, j, k, iIdToAdd, iPosOfItemToRemove;     var $divHierarchySelected = $("#divHierarchySelected"),       bAddNode = true;      //Set search controls disabled     fnSetSearchControlsEnabled(false);      //Either use passed or get afresh     $divHierarchyResults = $divHierarchyResults || $("#divHierarchyResults");     $NodesToAdd = $NodesToAdd || $divHierarchyResults.jstree("get_selected");      //If something is selected then proceed     if ($NodesToAdd.length &gt; 0) {        //Get the array of selected ids       aSelectedIds = fnGenerateSelectedIds(false, $divHierarchySelected);        //Check that nodes that we want to add aren't already in selected array       for (j = 0; j &lt; $NodesToAdd.length; j++) {          iIdToAdd = parseInt($NodesToAdd[j].id.substring(1));          //If node to add is a child of an existing selected node then remove it in favour of this         aParentIdsAlreadyInArray = fnAreAnyOfThisNodesParentsAlreadyInArray($NodesToAdd[j], aSelectedIds);          //Some parents of the node to add are already selected - let's remove them from the selected array since this node we are going to add is a child of this (and may not be the only one)         if (aParentIdsAlreadyInArray.length &gt; 0) {            for (k = 0; k &lt; aParentIdsAlreadyInArray.length; k++) {              iPosOfItemToRemove = $.inArray(aParentIdsAlreadyInArray[k], aSelectedIds);             aSelectedIds.splice(iPosOfItemToRemove, 1);           }         }         else if (           ($.inArray(iIdToAdd, aSelectedIds) !== -1) || //Check if this node is already selected           ($divHierarchySelected.find("#n" + iIdToAdd).length &gt; 0) //That the node to add is not in the selection (if it is then it must be parent of an existing selected node since we've established it's not a child and not already selected)           ) {            bAddNode = false;            //Show user an error message and return           alert($divHierarchyResults.data("errorNodeAlreadyExists").format($($NodesToAdd[j]).children("a").text()));         }          //If still want to add node then remove the node from the results tree and add it to the new tree via ajax load         if (bAddNode) {            //Add our node to the list           aSelectedIds.push(iIdToAdd);         }         else {            //We for some reason don't want to add a node so lets stop iterating through nodes to add           break;         }       }        if (bAddNode) {          //Remove selected node from the results tree         $divHierarchyResults.jstree("remove", $NodesToAdd);          //Save away the selected trading hierarchy nodes with our additional trading hierarchy node so it gets loaded when the tree is recreated         $divHierarchyResults.data("ids", aSelectedIds);          //Destroy the selected tree         $divHierarchySelected.empty();         $divHierarchySelected.jstree("destroy");          //Recreate the selected tree         fnInitialiseSelectedTree($divHierarchySelected);       }     }      //Set search controls enabled     fnSetSearchControlsEnabled(true);   },    //===============================================================================   // Remove the selected trading hierarchy node   //===============================================================================   fnRemoveNode = function (evt, $nodeToRemove, $divHierarchySelected) {      //Set search controls disabled     fnSetSearchControlsEnabled(false);      //Either use passed or get afresh     $divHierarchySelected = $divHierarchySelected || $("#divHierarchySelected");     $nodeToRemove = $nodeToRemove || $divHierarchySelected.jstree("get_selected");      //If something is selected then proceed     if ($nodeToRemove.length &gt; 0) {        //Remove selected node from the results tree       $divHierarchySelected.jstree("remove", $nodeToRemove);     }      //Set search controls enabled     fnSetSearchControlsEnabled(true);   },    //===============================================================================   // Generate an array of the selected ids   //===============================================================================   fnGenerateSelectedIds = function (bIncludeUnchecked, $divHierarchySelected) {      //Get already selected Companies     var $parents, i, sId, bIsChecked, bAddThisNode;      //Either use passed or get afresh     $divHierarchySelected = $divHierarchySelected || $("#divHierarchySelected");      //Get all list items in selected tree     var $selectedNodes = $divHierarchySelected.find("li"),       aSelectedIds = [];      for (i = 0; i &lt; $selectedNodes.length; i++) {        //Get id       sId = $selectedNodes[i].id.substring(1),         bAddThisNode = bIncludeUnchecked;        //If not already adding the node then decide if we should - this path will only be taken when *not* including unchecked nodes       if (!bAddThisNode) {          //Is the associated checkbox checked?         bIsChecked = $("#c" + sId).hasClass("treepicker-checked");          if (bIsChecked) {            //Are any of this nodes parents already in the list of selected ids?  If they are then we need not add this for obvious reasons           bAddThisNode = (fnAreAnyOfThisNodesParentsAlreadyInArray($selectedNodes[i], aSelectedIds).length === 0);         }       }        //Add to array if flag set       if (bAddThisNode) {          //Extract actual id from element id by lopping off the starting "n" and turning into an integer         aSelectedIds.push(parseInt(sId, 10));       }     }      //Either return the array or false to indicate that      return aSelectedIds;   },    //===============================================================================   // Get an array of the selected ids   //===============================================================================   fnAreAnyOfThisNodesParentsAlreadyInArray = function (node, aSelectedIds) {      var iParentId, posInLoop;     var $parents = $(node).parents("li"),       aParentIdsAlreadyInArray = [];      //Loop through parents     for (posInLoop = 0; posInLoop &lt; $parents.length; posInLoop++) {        //Check to see if the current parent being examined is already selected        iParentId = parseInt($parents[posInLoop].id.substring(1), 10);       if ($.inArray(iParentId, aSelectedIds) !== -1) {          //A parent of this node is already selected         aParentIdsAlreadyInArray.push(iParentId);       }     }      return aParentIdsAlreadyInArray;   },    //===============================================================================   // Get an array of the selected ids   //===============================================================================   fnGetSelectedIds = function ($divHierarchyResults) {      //Either use passed or get afresh     $divHierarchyResults = $divHierarchyResults || $("#divHierarchyResults");      //Get selected trading hierarchy node data from the saved meta data     var aIds = $divHierarchyResults.data("ids");      //If we got some selected trading hierarchy node data then convert into an array     if (!aIds) {       //Nullify       aIds = null;     }      return aIds;   },    //===============================================================================   // Clear the Selected tree   //===============================================================================   fnClearSelectedTree = function (evt) {      //Clear the tree     var $divHierarchySelected = $("#divHierarchySelected");     $divHierarchySelected.jstree("delete_node", $divHierarchySelected.find("&gt; ul &gt; li"));    },    //===============================================================================   // Set whether a seach is in progress or not   //===============================================================================   fnSetSearchControlsEnabled = function (bEnabled) {      //Get text and button controls separately     var $tblSearch = $("#tblSearch"),       $divHierarchyResults = $("#divHierarchyResults");     var $textInputs = $tblSearch.find("input[type='text']"),       $buttonInputs = $tblSearch.find("input[type='button']");      //Enable / disable as appropriate     $textInputs.prop("disabled", !bEnabled);     $buttonInputs.prop("disabled", !bEnabled);      //Remove the class (if assigned)     $textInputs.removeClass("ajaxLoading");      //Assign loading class only if setting screen controls to disabled     if (!bEnabled) $textInputs.addClass("ajaxLoading");      // Special handling for dropdown and radio buttons as they may be permanently disabled depending on the inputs to the picker      //Status - only disable / re-enable if status not fixed to active / inactive     if ($divHierarchyResults.data("statusId") === _oRecordStatus.All) {        $("#rdoAll").prop("disabled", !bEnabled);       $("#rdoActive").prop("disabled", !bEnabled);       $("#rdoInactive").prop("disabled", !bEnabled);     }      //LevelTypeIds - only disable / re-enable if picker isn't fixed to a single levelTypeId     if ($divHierarchyResults.data("levelTypeIds").length !== 1) { $("#drpLevelType").prop("disabled", !bEnabled); }   },    //===============================================================================   // Get trading hierarchy node for display to user   //===============================================================================   fnDisplayNodeDetails = function (iNodeId) {      //Show waiting image     var $inputText = $("#tblInfo").find("input[type='text']"),       $divHierarchyResults = $("#divHierarchyResults");      $inputText.removeClass("ajaxLoading").addClass("ajaxLoading");      //Get Node     var oRequest = $.ajax($divHierarchyResults.data("getNode"),           {             data: JSON.stringify({ nodeId: iNodeId }),  // For empty input data use "{}",             type: "POST",             contentType: "application/json",             complete: function (oJSONData, sStatus) {                if (sStatus === "success") {                  //Translate JSON response into object and get Node out of the "d" (ASP.NET security feature)                 var node = JSON.parse(oJSONData.responseText).d;                  if (node) {                    //Display Node details                   $("#txtInfoId").val(node.NodeId);                   $("#txtInfoHMId").val(node.HMId);                   $("#txtInfoCode").val(node.Code)                   $("#txtInfoName").val(node.Name);                   $("#txtInfoType").val(node.LevelType);                   $("#txtInfoActive").val(node.IsActive)                    //Show custom level type details                   var $spnFunctionalUnit = $("#spnFunctionalUnit"),                     $spnTradingBook = $("#spnTradingBook"),                     $spnFrontOfficeBook = $("#spnFrontOfficeBook");                    switch (node.LevelTypeId) {                      case iFunctionalUnitLevelTypeId:                       $spnFunctionalUnit.show();                       $spnTradingBook.hide();                       $spnFrontOfficeBook.hide();                       $("#txtInfoLocation").val(node.Location);                       break;                      case iTradingBookLevelTypeId:                       $spnFunctionalUnit.hide();                       $spnTradingBook.show();                       $spnFrontOfficeBook.hide();                       $("#txtInfoTrader").val(node.Trader);                       break;                      case iFrontOfficeBookLevelTypeId:                       $spnFunctionalUnit.hide();                       $spnTradingBook.hide();                       $spnFrontOfficeBook.show();                       $("#txtInfoSourceSystem").val(node.SourceSystem);                       break;                      default:                       $spnFunctionalUnit.hide();                       $spnTradingBook.hide();                       $spnFrontOfficeBook.hide();                   }                    //Hide loading image                   $inputText.removeClass("ajaxLoading");                 }               }               else {                  //Failed                 alert("Problem looking up Node - please alert PCS Admin");               }             }           });   },    //================================================================================   // Return ids to picker   //===============================================================================   fnReturnValuesToPicker = function (evt, aIds, $divHierarchyResults) {      var i, $li;      //Set search controls disabled     fnSetSearchControlsEnabled(false);      //Either use passed or get afresh     aIds = aIds || fnGenerateSelectedIds(false);      //Generate names from ids     var aNames = [];     for (i = 0; i &lt; aIds.length; i++) {        //Get the node in question       $li = $("#n" + aIds[i]);        //Get the text in the Anchor tag and add to array       aNames.push($.trim($li.children("a").text()));     }      //Return ids     window.returnValue = { aIds: aIds, aNames: aNames };     window.close();   },    //================================================================================   // Close the picker and return a null value   //===============================================================================   fnReturnNothing = function () {      window.top.returnValue = null; //Clear return value     window.top.close();   },    //===============================================================================   // Resizes the tree to fit to the page   //===============================================================================   fnResizePage = function (event) {      //Get objects used to determine new height     var $window = $(window),       $tblSearch = $("#tblSearch"),       $tblInfo = $("#tblInfo"),       $divHierarchyResults = $("#divHierarchyResults"),       $divContainerResults = $("#divContainerResults"),       $divContainerSelected = $("#divContainerSelected"),       $divButtons = $("#divButtons");      var bMultiSelect = $divHierarchyResults.data("multiSelect");      //Determine height     var iHeight = $window.height() - $tblSearch.height() - $tblInfo.height() - $divButtons.height() - 30;     if (bMultiSelect) iHeight -= 25; //Bit shorter for multiselect      //Set div heights     $divContainerResults.height(iHeight);     $divContainerSelected.height(iHeight);      //Set width only for selectors     if ($divHierarchyResults.data("isSelector")) {        $divContainerResults.width($window.width() - 10);      }     else if (bMultiSelect) {        //MultiSelect       var iWidth = parseInt(($window.width() / 2) - 60, 10);       $divContainerResults.width(iWidth);       $divContainerSelected.width(iWidth);      }     else {        //SingleSelect       $divContainerResults.width($window.width() - 10);     }   },    //===============================================================================   // Clear handler   //===============================================================================   fnClearSearchControl = function () {      $("#" + $(this).data("clearId")).val("");   },    //===============================================================================   // Initialise   //===============================================================================   fnInitialise = function () {      //Focus on Name control     var $divHierarchyResults = $("#divHierarchyResults"),       $rdoAll = $("#rdoAll"),       $rdoActive = $("#rdoActive"),       $rdoInactive = $("#rdoInactive"),       $startFocusInput = $("#txtSearchName");      //Set and save away focus     $startFocusInput.focus();     $divHierarchyResults.data("focusId", $startFocusInput.prop("id"));      //Manually trigger resize event handler so sizing is correct     fnResizePage();      //Multi-Select only      if ($divHierarchyResults.data("multiSelect")) {        //Initialise the selected tree (multiselect only)       fnInitialiseSelectedTree();        //Show multiselect controls       $("#tdControls,#tdContainerSelected,#divButtons").show();     }      //Status     if ($divHierarchyResults.data("statusId") === _oRecordStatus.Active) {        $rdoAll.prop("disabled", true);       $rdoActive         .prop("checked", true)         .prop("disabled", true);       $rdoInactive.prop("disabled", true);     }     else if ($divHierarchyResults.data("statusId") === _oRecordStatus.Inactive) {        $rdoAll.prop("disabled", true);       $rdoActive.prop("disabled", true);       $rdoInactive         .prop("checked", true)         .prop("disabled", true);     }      //If only a single levelTypeId allowed then disable the dropdown     if ($divHierarchyResults.data("levelTypeIds").length === 1) { $("#drpLevelType").prop("disabled", true); }      //Initialise the results tree     fnInitialiseResultsTree(fnShouldWeTriggerASearch($divHierarchyResults, false)); //The true triggers a search on first opening   };    //   //ASSIGN CLICK EVENT HANDLERS   //   $("#btnClearSearchName,#btnClearSearchId").click(fnClearSearchControl);   $("#btnSearch,#lnkFirst,#lnkPrev,#lnkNext,#lnkLast").click(fnPerformSearch);   $("#btnAdd").click(fnAddNode);   $("#btnRemove").click(fnRemoveNode);   $("#btnClear").click(fnClearSelectedTree);   $("#btnOK").click(fnReturnValuesToPicker);   $("#btnCancel").click(fnReturnNothing);    //   //ASSIGN CHANGE EVENT HANDLERS   //   $("#rdoAll,#rdoActive,#rdoInactive,#drpLevelType").change(fnPerformSearch);    //   //ASSIGN PASTE EVENT HANDLERS   //   $("#txtSearchName").bind("paste", function (evt) {     setTimeout(function () {       fnPerformSearch(evt);     }, 0); // note the 0 milliseconds - we are doing this so we capture the value correctly: http://stackoverflow.com/questions/2055224/how-to-get-the-value-of-a-field-during-the-paste-event   });    //   //ASSIGN RESIZE EVENT HANDLERS   //   $(window).bind("smartresize", fnResizePage);    //   //ASSIGN KEYPRESS EVENT HANDLERS   //   $("body").keypress(function (evt) {      var $divHierarchyResults = $("#divHierarchyResults");      //Return key handling     if (evt.keyCode === 13) {        //If the hit "enter" in the search controls we should trigger a search       if ($("#tblSearch").find("#" + evt.target.id).length &gt; 0) {          fnPerformSearch(evt);        }       else if (!$divHierarchyResults.data("multiSelect")) {          //Return key handling for non-multiselect tree pickers          //Pass selected li         var $selectedNode = $divHierarchyResults.jstree("get_selected");          //Return selected node         fnReturnValuesToPicker(null, [parseInt($selectedNode.prop("id").substring(1), 10)], $divHierarchyResults);       }     }     else if (evt.keyCode === 27) { //Escape key handling for all pickers        fnReturnNothing();      }   });    //   //INITIALISE PAGE DISPLAY   //   fnInitialise();  }); </content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/6980062745638105944'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/6980062745638105944'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8963928003798922448</id><published>2012-03-01T09:52:00.000Z</published><updated>2012-03-01T09:52:10.617Z</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Example of how to call jqGrid.js</title><content type='html'>var _oPageData = null;  //=============================================================================== // Method called when DOM loaded (this is earlier than the window onload method and so allows the screen to be set up faster) //=============================================================================== $(document).ready(function () {    //   // DECLARE GLOBAL FUNCTION EXPRESSIONS (AS FEW AS POSSIBLE)   //    //===============================================================================   // Build a table given an object and a model   //===============================================================================   window.BuildTableFromObject = function (oObject, aTableModel) {      var i, j, sRowClass;     var aFormattedValue = ['&lt;table class="noPadding changeLogValue"&gt;&lt;tr&gt;'];      //Build header     for (i = 0; i &lt; aTableModel.length; i++) {       aFormattedValue.push('&lt;th class="changeLogValueHeader"&gt;' + aTableModel[i].sHeader + '&lt;/th&gt;');     }     aFormattedValue.push('&lt;/tr&gt;');      //Build contents     for (i = 0; i &lt; oObject.length; i++) {        sRowClass = "changeLogRow";       if (i % 2 === 0) sRowClass = "changeLogRowAlternate";        aFormattedValue.push('&lt;tr class="' + sRowClass + '"&gt;')       for (j = 0; j &lt; aTableModel.length; j++) {         aFormattedValue.push('&lt;td&gt;' + oObject[i][aTableModel[j].sDataField] + '&lt;/td&gt;');       }       aFormattedValue.push('&lt;/tr&gt;');     }     aFormattedValue.push('&lt;/table&gt;');      //Render as string and return     return aFormattedValue.join("");   };    //   // DECLARE FUNCTION EXPRESSIONS   //    //===============================================================================   // Populate page with data   //===============================================================================   var fnPageDataCallback = function (oJSONData, sStatus) {      var dteDate, i;     var sHTML = "";      if (sStatus === "success") {        //Translate JSON response into object       _oPageData = JSON.parse(oJSONData.responseText).d; //Stored in "d" because of ASP.NET AJAX security measure        $("#spnEntity").text(_oPageData.CaptionChangeLogEntity + ": ");       $("#txtEntity").val(_oPageData.ChangeLogEntity);       $("#spnID").text(_oPageData.CaptionId + ": ");       $("#txtID").val(_oPageData.Id);       $("#spnRollbackVersion").text(_oPageData.CaptionRollbackVersion + ": ");       $("#btnRollback").val(_oPageData.CaptionRollback);        //Show or hide restore points       if (_oPageData.RestorePoints.length &gt; 0) {          //Populate dropdown         for (i = 0; i &lt; _oPageData.RestorePoints.length; i++) {           sHTML += '&lt;option value="' + _oPageData.RestorePoints[i][0] + '"&gt;' + //Date only                   _oPageData.RestorePoints[i][1] + ': ' + _oPageData.RestorePoints[i][2] + '&lt;/option&gt;'; //Show Generic ChangeLogItem and Date         }         $('#drpRollbackVersion').append(sHTML);          //Assign click event         $('#btnRollback').click(function () {            if (confirm(_oPageData.CaptionAreYouSure)) {             window.top.returnValue = $("select[id='drpRollbackVersion'] option:selected").val();             window.top.close();           }          });          //Show rollback         $("#divRollback").show();       }     }     else {        //Failed       alert("Failed to load page data");      }   },    //===============================================================================   // Perform post load processing   //===============================================================================   fnPostLoadProcessing = function ($Grid, oData) {      var iPosOfChangeLogItemId, oRow, iChangeLogItemId;     var bRollbacksVisible = $("#divRollback").is(":visible");      //Loop through table rows applying formatting     for (var i = 0; i &lt; oData.rows.length; i++) {        iPosOfChangeLogItemId = _oJQGUserSettings.aColNames.length + $.inArray('ChangeLogItemId', _oJQGProperties.aExtraDataColumns);       oRow = oData.rows[i]; //Get Row       iChangeLogItemId = parseInt(oRow.cell[iPosOfChangeLogItemId], 10); //Get ChangeLogItemID        //Generic change log items (those with an ID &lt; 100) should be drawn attention to - so apply myHighlight class       if (iChangeLogItemId &lt;= 100) {          //Emphasise rollback points - first row (i == 0) is *not* a rollback point, BulkUpdates are *never* a rollback point         var sClass = (((bRollbacksVisible) &amp;&amp; (i &gt; 0) &amp;&amp; (iChangeLogItemId != _oChangeLogItem["BulkUpdated"])) ? 'myHighlight myRollbacks' : 'myHighlight');         $Grid.jqGrid('setRowData', oRow.id, false, sClass);        }       else {         //Set vertical align to top         iChangeLogItemId = parseInt(oRow.cell[_oJQG.dColumns["ChangeLogItemId"]], 10);         switch (iChangeLogItemId) {           case _oChangeLogItem["SalesList"]:           case _oChangeLogItem["TraderList"]:           case _oChangeLogItem["TagList"]:             $Grid.jqGrid('setRowData', oRow.id, false, 'myVerticalAlign');             break;         }       }     }   },    //===============================================================================   // Resizes the grid to fit to the page   //===============================================================================   fnResizePage = function (event) {      //Get objects used to determine new height     var $window = $(window),       $divChangeLog = $("#divChangeLog"),       $Grid = $('#' + _oJQG.sId);      //Determine new height of div using the height of the window / position of the top of the div on the page     var iNewHeight = $window.height() - $divChangeLog.offset().top - 10;      //Set reports div height     $divChangeLog.height(iNewHeight);      //Set grid height     $Grid.setGridWidth($window.width() - 15);     $Grid.setGridHeight(iNewHeight - 55);   },    //================================================================================   // Perform initialisation   //===============================================================================   fnInitialise = function () {      //Hide rollback     $("#divRollback").hide();      //Wire up resize event to the ResizePage function in the iframe     $(window).bind("smartresize", fnResizePage);      //Perform AJAX call     $.ajax(_sURLGetPageData, //URL of PageMethod used to populate the screen         {         data: JSON.stringify({           changeLogEntityId: parseInt(window.dialogArguments["changeLogEntityId"], 10),           id: parseInt(window.dialogArguments["changeLogId"], 10),           getRestorePoints: true         }),  // For empty input data use "{}",         type: "POST",         contentType: "application/json",         complete: fnPageDataCallback       });      //Create grid     _oJQG.CreateGrid({       fnCreateGridCallback: function () {          //Make sure the grid fits the screen         fnResizePage();          //Populate Grid with ChangeLog items         _oJQG.PopulateGrid();       },       fnResizePage: fnResizePage,       fnPostLoadProcessing: fnPostLoadProcessing     });   };    //   //ASSIGN KEYPRESS EVENT HANDLERS   //   $("body").keypress(function (event) {      if (event.keyCode === 13) {        //Return key - do nothing       event.preventDefault();      }     else if (event.keyCode === 27) {        //Escape key       window.top.close();      }   });    //   //INITIALISE PAGE DISPLAY   //   fnInitialise();  });  //=============================================================================== // FormatChangeLogValue function - expand existing _oJQGFormatters object //=============================================================================== _oJQGFormatters.FormatChangeLogValue = function (sCellValue, oOptions, oRow) {    if ($.trim(sCellValue).length === 0)     return "&amp;nbsp;";   else {      //Get ChangeLogItemID     var iChangeLogItemId = parseInt(oRow[_oJQG.dColumns["ChangeLogItemId"]], 10);      if (iChangeLogItemId &gt; 100) { //Is not generic change log item        //Objectify value       var oObject = JSON.parse(sCellValue); // eval("(" + sCellValue + ")") - alternative approach?        var sFormattedValue;       switch (iChangeLogItemId) {         case _oChangeLogItem["SalesList"]:           var aTableModel = [{ sHeader: 'Sales', sDataField: 'SalesFullNameReverse' }, { sHeader: 'SalesTeam', sDataField: 'SalesTeamName' }, { sHeader: '%', sDataField: 'PercentagePoints'}];           sFormattedValue = BuildTableFromObject(oObject, aTableModel);           break;          case _oChangeLogItem["TraderList"]:           var aTableModel = [{ sHeader: 'Trader', sDataField: 'TraderFullNameReverse' }, { sHeader: 'FrontOfficeBook', sDataField: 'FrontOfficeBook'}];           sFormattedValue = BuildTableFromObject(oObject, aTableModel);           break;          case _oChangeLogItem["TagList"]:           var aTableModel = [{ sHeader: 'Type', sDataField: 'DealTagType' }, { sHeader: 'Value', sDataField: 'DealTagValue'}];           sFormattedValue = BuildTableFromObject(oObject, aTableModel);           break;          case _oChangeLogItem["TradeDate"]:         case _oChangeLogItem["MaturityDate"]:         case _oChangeLogItem["SettlementDate"]:           var dteDate = GetDateFromJSONDateString(oObject)           sFormattedValue = Globalize.format(dteDate, Globalize.culture().calendar.patterns["d"]);           break;          default:           if (oObject == null)             sFormattedValue = "null";           else             sFormattedValue = oObject.toString();           break;       }        //Return formatted value field       return sFormattedValue;     }     else {       //Return value as is       return sCellValue;     }   } }  </content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8963928003798922448'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8963928003798922448'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8011082798263799539</id><published>2012-03-01T09:50:00.006Z</published><updated>2012-03-01T09:50:59.354Z</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>PagedSearchResponse.cs</title><content type='html'>using Commerzbank.PCS.Web.Helpers; using System; using System.Collections.Generic; using System.Data; using System.Globalization; using System.Linq;  namespace Commerzbank.PCS.Web.Models {   /// &lt;summary&gt;  /// Encapsulate a JSON deal paged search response   /// &lt;/summary&gt;  /// &lt;history&gt;  ///   &lt;change&gt;&lt;date&gt;05/08/2011&lt;/date&gt;&lt;name&gt;Anthony Hand&lt;/name&gt;&lt;description&gt;Created based on JQGrid.ascx.cs&lt;/description&gt;&lt;/change&gt;  /// &lt;/history&gt;    public class PagedSearchResponse   {     public class Row     {       public int id { get; set; }       public List&lt;string&gt; cell { get; set; }        public Row()       {         cell = new List&lt;string&gt;();       }     }      public string Message { get; set; }     public int page { get; set; }     public int total { get; set; }     public int records { get; set; }     public List&lt;Row&gt; rows { get; set; }      public PagedSearchResponse()     {       rows = new List&lt;Row&gt;();     }      #region Public Methods     /// &lt;summary&gt;    /// Initialise from dataset     /// &lt;/summary&gt;    /// &lt;param name="dataSet"&gt;dataset containing data&lt;/param&gt;    /// &lt;param name="originalColumnDefinition"&gt;the definition of the structure of the grid (generally taken from the xml files eg DealList.xml)&lt;/param&gt;    /// &lt;param name="extraColumns"&gt;[OPTIONAL] Extra columns that are *not* to be displayed in the grid but may be used in the rendering of other columns.  Eg A company IsisID is necessary as well as a company name in order that the link can be properly generated in javascript.  See FormatCompany or PostLoadProcessing javascript methods to see how these are used&lt;/param&gt;    /// &lt;param name="id"&gt;[OPTIONAL] the field name in the data that contains the id (must be an integer) - if one isn't available then it will come up with its own Id (basically starting at 0 and going up)&lt;/param&gt;    /// &lt;param name="pageSelected"&gt;[OPTIONAL] if paging through data then this contains the current page in question (eg 2 as in 2 out of 10 pages of data)&lt;/param&gt;    /// &lt;param name="pageCount"&gt;[OPTIONAL] if paging through data then this contains the number of pages of data that exist (eg 10 as in 1000 / 100 = 10)&lt;/param&gt;    /// &lt;param name="recordCount"&gt;[OPTIONAL] the maximum number of records that can be examined via the grid - if not passed then will initialise to -1 which basically means "give me all records in the data"&lt;/param&gt;    /// &lt;param name="logMessage"&gt;[OPTIONAL] pass a log message to be used if logging is being performed (if not passed then a default one will be generated)&lt;/param&gt;    /// &lt;param name="logSearch"&gt;[OPTIONAL] decide whether a log should be performed or not (default true)&lt;/param&gt;    public void Initialise(DataSet dataSet,       Dictionary&lt;string, object&gt;[] originalColumnDefinition,       string[] extraColumns = null,       string id = null,       int pageSelected = 1,       int pageCount = 1,       int recordCount = -1,       string logMessage = null,       bool logSearch = true)     {       //If no data then throw error       if (dataSet == null || dataSet.Tables.Count &lt; 1)         throw new Exception("Either dataset is null or there are no tables in dataset.");        Initialise(         dataTable: dataSet.Tables[0], //Take first table in dataset         originalColumnDefinition: originalColumnDefinition,         extraColumns: extraColumns,         id: id,         pageSelected: pageSelected,         pageCount: pageCount,         recordCount: recordCount,         logMessage: logMessage,         logSearch: logSearch);     }      /// &lt;summary&gt;    /// Initialise from a datatable     /// &lt;/summary&gt;    /// &lt;param name="dataTable"&gt;datatable containing data&lt;/param&gt;    /// &lt;param name="originalColumnDefinition"&gt;the definition of the structure of the grid (generally taken from the xml files eg DealList.xml)&lt;/param&gt;    /// &lt;param name="extraColumns"&gt;[OPTIONAL] Extra columns that are *not* to be displayed in the grid but may be used in the rendering of other columns.  Eg A company IsisID is necessary as well as a company name in order that the link can be properly generated in javascript.  See FormatCompany or PostLoadProcessing javascript methods to see how these are used&lt;/param&gt;    /// &lt;param name="id"&gt;[OPTIONAL] the field name in the data that contains the id (must be an integer) - if one isn't available then it will come up with its own Id (basically starting at 0 and going up)&lt;/param&gt;    /// &lt;param name="pageSelected"&gt;[OPTIONAL] if paging through data then this contains the current page in question (eg 2 as in 2 out of 10 pages of data)&lt;/param&gt;    /// &lt;param name="pageCount"&gt;[OPTIONAL] if paging through data then this contains the number of pages of data that exist (eg 10 as in 1000 / 100 = 10)&lt;/param&gt;    /// &lt;param name="recordCount"&gt;[OPTIONAL] the maximum number of records that can be examined via the grid - if not passed then will initialise to -1 which basically means "give me all records in the data"&lt;/param&gt;    /// &lt;param name="logMessage"&gt;[OPTIONAL] pass a log message to be used if logging is being performed (if not passed then a default one will be generated)&lt;/param&gt;    /// &lt;param name="logSearch"&gt;[OPTIONAL] decide whether a log should be performed or not (default true)&lt;/param&gt;    /// &lt;returns&gt;a PagedSearchResponse data object&lt;/returns&gt;    /// &lt;history&gt;    ///   &lt;change&gt;&lt;date&gt;05/08/2011&lt;/date&gt;&lt;name&gt;Anthony Hand&lt;/name&gt;&lt;description&gt;Created&lt;/description&gt;&lt;/change&gt;    /// &lt;/history&gt;    public void Initialise(DataTable dataTable,       Dictionary&lt;string, object&gt;[] originalColumnDefinition,       string[] extraColumns = null,       string id = null,        int pageSelected = 1,        int pageCount = 1,        int recordCount = -1,       string logMessage = null,        bool logSearch = true)     {       //Use null coalescing operator to initialise aExtraColumns with empty string array if value not passed       extraColumns = extraColumns ?? new string[0];        try       {         //If not set then initialise iRecordCount from dataset         if (recordCount == -1)           recordCount = dataTable.Rows.Count;          //Build up data set         for (int i = 0; i &lt; dataTable.Rows.Count; i++)         {           DataRow dataRow = dataTable.Rows[i];           PagedSearchResponse.Row row = new PagedSearchResponse.Row();            //Write out ID of line           row.id = (id != null)             ? Convert.ToInt32(dataRow[id])             : i;            //Write out data in the same order as the colModel           foreach (var column in originalColumnDefinition)           {             if (dataTable.Columns.Contains(column["name"].ToString()))             {               object oValue = dataRow[column["name"].ToString()];               if (column.Keys.Contains("datatype"))               {                 /* NOT BEING USED BUT LEFT IN CASE USEFUL IN FUTURE                 Dictionary&lt;string, object&gt; formatOptions = (Dictionary&lt;string, object&gt;)column["formatoptions"];                  ci.NumberFormat.CurrencyDecimalSeparator = formatOptions["decimalSeparator"].ToString();                 ci.NumberFormat.CurrencyGroupSeparator = formatOptions["thousandsSeparator"].ToString();                 ci.NumberFormat.CurrencyDecimalDigits = Convert.ToInt32(formatOptions["decimalPlaces"]);                 */                  if (oValue == System.DBNull.Value)                   row.cell.Add(""); //Add empty cell                 else                 {                   switch (column["datatype"].ToString())                   {                     /*                     //Not used for now due to UTC issues (Date seen by users changes based on regionalisation - will come back to this at some point perhaps)                     case "DateTime":                     case "Date":                       //Add cell as a JSON date field.  This is to allow efficent javascript creation of a Date object                       row.cell.Add(GetDateTimeAsJavascriptDateTicks(Convert.ToDateTime(oValue)).ToString());                      */                      case "DateTime":                       //Add cell as javascript date constructor parameters.  This will allow efficent javascript creation of a Date object                       row.cell.Add(JavascriptHelper.GetDateTimeAsJavascriptDateConstructorParameters(Convert.ToDateTime(oValue)));                       break;                      case "Date":                       //Add cell as javascript date constructor parameters.  This will allow efficent javascript creation of a Date object                       row.cell.Add(JavascriptHelper.GetDateAsJavascriptDateConstructorParameters(Convert.ToDateTime(oValue)));                        break;                      case "Decimal":                       //Add cell as a decimal field rendered using invariant culture.  This is because javascript uses "." for its decimal separator always                       decimal dDecimal = Convert.ToDecimal(oValue);                       row.cell.Add(Convert.ToString(dDecimal, NumberFormatInfo.InvariantInfo));                       break;                      default:                       throw new Exception("Unknown datatype: " + column["datatype"].ToString());                   }                 }               }               else               {                 //Add cell                 row.cell.Add(oValue.ToString());               }             }             else             {               //Add empty cell               row.cell.Add("");             }           }            //Write out any remaining data columns           foreach (var column in extraColumns)           {             //Add cell             if (dataRow.Table.Columns[column].DataType == System.Type.GetType("System.DateTime"))             {               //Add cell as a JSON date field.  This is to allow efficent javascript creation of a Date object               row.cell.Add(JavascriptHelper.GetDateTimeAsJavascriptDateConstructorParameters(Convert.ToDateTime(dataRow[column])));             }             else               row.cell.Add(dataRow[column].ToString());           }            this.rows.Add(row);         }          this.page = pageSelected;         this.total = pageCount;  // Set this to total pages in your result...         this.records = recordCount;       }       catch (Exception exc)       {         throw new Exception("Problem initialising PagedSearchResponse from DataTable", exc);       }     }     #endregion   } }</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8011082798263799539'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8011082798263799539'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1013611975186791587</id><published>2012-03-01T09:50:00.003Z</published><updated>2012-03-01T09:50:34.144Z</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>PagedSearchRequest.cs</title><content type='html'>using System; using System.Collections.Generic;  namespace Commerzbank.PCS.Web.Models {   /// &lt;summary&gt;  /// Encapsulate a JSON delivered deal paged search request.   ///    /// MVC currently has a problem deserializing complex objects. The workaround is to recieve everthing as a   /// string and explicitly deserialize the complex objects.   ///    /// [Links]   /// http://stackoverflow.com/questions/4710729/post-json-dictionary-asp-net-mvc#5397743   /// http://connect.microsoft.com/VisualStudio/feedback/details/636647/make-jsonvalueproviderfactory-work-with-dictionary-types-in-asp-net-mvc   /// &lt;/summary&gt;  public class PagedSearchRequest   {     #region Private Members     private Dictionary&lt;string, string&gt; _searchOptions = null;     private Dictionary&lt;string, object&gt;[] _originalColumnDefinition = null;     private string[] _extraDataColumns = null;     #endregion      #region Public Properties     public int? iPageSize { get; set; }     public int? iPage { get; set; }     public int? iMaxRecords { get; set; }     public string sSortField { get; set; }     public string sSortOrder { get; set; }          public string dSearchOptions { get; set; }     public Dictionary&lt;string, string&gt; SearchOptions { get { return _searchOptions; } }      public string aOriginalColumnDefinition { get; set; }     public Dictionary&lt;string, object&gt;[] OriginalColumnDefinition { get { return _originalColumnDefinition; } }      public string aExtraDataColumns { get; set; }     public string[] ExtraDataColumns { get { return _extraDataColumns; } }     #endregion      #region Public Methods     /// &lt;summary&gt;    /// Deserialise all complex properties     /// &lt;/summary&gt;    /// &lt;history&gt;    ///   &lt;change&gt;&lt;date&gt;03/08/2011&lt;/date&gt;&lt;name&gt;Anthony Hand&lt;/name&gt;&lt;description&gt;Created&lt;/description&gt;&lt;/change&gt;    /// &lt;/history&gt;    public void DeserialiseComplexProperties()     {       var ser = new System.Web.Script.Serialization.JavaScriptSerializer();        _searchOptions = ser.Deserialize&lt;Dictionary&lt;string, string&gt;&gt;(dSearchOptions);       _originalColumnDefinition = ser.Deserialize&lt;Dictionary&lt;string, object&gt;[]&gt;(aOriginalColumnDefinition);       _extraDataColumns = ser.Deserialize&lt;string[]&gt;(aExtraDataColumns);     }      /// &lt;summary&gt;    /// Get SearchOptions string     /// &lt;/summary&gt;    /// &lt;history&gt;    ///   &lt;change&gt;&lt;date&gt;08/02/2011&lt;/date&gt;&lt;name&gt;John Reilly&lt;/name&gt;&lt;description&gt;Created&lt;/description&gt;&lt;/change&gt;    /// &lt;/history&gt;    public string GetSearchOptionsString(string sPrefix = "")     {       var lSearchOptions = new List&lt;string&gt;();       foreach (var searchOption in _searchOptions)       {         //Exclude values that are blank         if (string.IsNullOrEmpty(searchOption.Value)) continue;          //Not perfect but a way to exclude pickers that are blank (based on assumption of a naming convention that includes "pk" for pickers         //Look to make this "nicer" in the future         if ((searchOption.Key.Contains("pk")) &amp;&amp; (searchOption.Value == "[]")) continue;          lSearchOptions.Add(searchOption.Key + ": " + searchOption.Value);       }        if (lSearchOptions.Count &gt; 0)         return sPrefix + String.Join(", ", lSearchOptions);       else         return "";     }     #endregion   } }</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1013611975186791587'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1013611975186791587'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-7910894143296185920</id><published>2012-03-01T09:49:00.002Z</published><updated>2012-03-01T09:49:54.706Z</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>PagedSearchGridHelper.cs</title><content type='html'>using Commerzbank.PCS.Web.Shared; using System; using System.Collections.Generic; using System.Data; using System.Globalization; using System.Linq; using System.Text; using System.Web; using System.Web.Mvc;  namespace Commerzbank.PCS.Web.Helpers {   /// &lt;summary&gt;  /// PagedSearchGrid "helper"   /// &lt;/summary&gt;  /// &lt;history&gt;  ///   &lt;change&gt;&lt;date&gt;09/08/2011&lt;/date&gt;&lt;name&gt;Anthony Hand&lt;/name&gt;&lt;description&gt;Created via copy&amp;paste from JQGrid.ascx&lt;/description&gt;&lt;/change&gt;  /// &lt;/history&gt;  public class PagedSearchGridHelper   {     #region Public Properties      public string AddColumnChooser { get; set; }     public string CaptionClipboard { get; set; }     public string CaptionClipboardCopying { get; set; }     public string CaptionColumns { get; set; }     public string CaptionColumnsReorder { get; set; }     public string CaptionDefaultErrorMessage { get; set; }     public string CookieName { get; set; }     public string CurrentCulture { get; set; }     public string DefaultSortName { get; set; }     public string DefaultSortOrder { get; set; }     public string ExtraDataColumns { get; set; }     public string GridDefinitionFile     {       get       {         return GetLocalisedGridDefinitionFile();       }     }     public string GridSettingsFile { get; set; }     public string LoadingImage { get; set; }     public string LoadingPanelMarginLeft { get; set; }     public string LoadingPanelMarginTop { get; set; }     public string MaxRecords { get; set; }     public string PageSize { get; set; }     public string PageSizes { get; set; }     public string SearchOptionParameters { get; set; }     public string SortName { get; set; }     public string SortOrder { get; set; }     public string URL { get; set; }     public string URLJSONUserSettings { get; set; }     public string WaitType { get; set; }     #endregion      #region Constructors/Finalizers     /// &lt;summary&gt;    /// Default constructor     /// &lt;/summary&gt;    /// &lt;history&gt;    ///   &lt;change&gt;&lt;date&gt;28/07/2011&lt;/date&gt;&lt;name&gt;Anthony Hand&lt;/name&gt;&lt;description&gt;Created&lt;/description&gt;&lt;/change&gt;    /// &lt;/history&gt;    public PagedSearchGridHelper()     {     }     #endregion      #region Static Methods     /// &lt;summary&gt;    /// Build JQGrid Script based on Properties that can be customised for specific users     /// &lt;/summary&gt;    /// &lt;history&gt;    ///   &lt;change&gt;&lt;date&gt;30/12/2010&lt;/date&gt;&lt;name&gt;John Reilly&lt;/name&gt;&lt;description&gt;Created&lt;/description&gt;&lt;/change&gt;    /// &lt;/history&gt;    public static string BuildJSONUserSettings(Dictionary&lt;string, string&gt; dUserSettings, string sGridDefinitionFile,       string sPageSize = "-1", string sSortName = "", string sSortOrder = "", //These parameters will be overwritten by any entries in the dUserSettings dictionary if they exist.  These parameters essentially define fallback values       bool bAttemptToReloadUserSettings = false)     {       try       {         //Get grid definition / version number from file         string[] aDefaultColumnList;         string sVersion;         var dGridDefinition = GetGridDefinition(sGridDefinitionFile, out sVersion, out aDefaultColumnList);          //Set from dictionary if version number is the same as in the grid definition         string[] aColumnList = new string[0];         if ((dUserSettings != null) &amp;&amp; (dUserSettings.ContainsKey("sVersion")) &amp;&amp; (sVersion == dUserSettings["sVersion"]))         {           if (dUserSettings.ContainsKey("sColumnList"))           {             //Get column list from user settings             aColumnList = dUserSettings["sColumnList"].Split('~');              //If the column list passed in doesn't contain the same number of columns as the default column list             //then revert back to defaults (this test is included to make it nicer for any developer changing the              //column definition file on the fly. (should never happen in prod situation)             if (aColumnList.Length != aDefaultColumnList.Length) aColumnList = new string[0];           }           if (dUserSettings.ContainsKey("iPageSize")) sPageSize = dUserSettings["iPageSize"];           if (dUserSettings.ContainsKey("sSortName")) sSortName = dUserSettings["sSortName"];           if (dUserSettings.ContainsKey("sSortOrder")) sSortOrder = dUserSettings["sSortOrder"];         }          //Determine is user has custom column list         bool bCustomColumnList = ((aColumnList.Length &gt; 0) &amp;&amp; (String.Join(",", aColumnList) != String.Join(",", aDefaultColumnList)));          //Log column order         WebLogger.MvcLog("JQGrid UserSettings" +           (((sSortName != null) &amp;&amp; (sSortName.Length &gt; 0)) ? (" ordered by " + sSortName + " " + sSortOrder) : "") +           ((!bCustomColumnList)             ? " of the default column settings"             : (                 " of the following columns/widths: " + String.Join(", ", aColumnList)               )             ) +             (bAttemptToReloadUserSettings ? "[Will attempt to reload user settings (presumably no data found in cookie for this grid and JSONUserSettings URL is available)] " : "") +           " requested", SharedLib.FriendlyUserName, SharedLib.UserId, HttpContext.Current.Request.Url.ToString());           //Write out column model         var sbColModel = new StringBuilder();         var lColModel = new List&lt;string&gt;();         var lColHeaders = new List&lt;string&gt;();         var lColNames = new List&lt;string&gt;();          bool bIsIE6or7 = ((HttpContext.Current.Request.Browser.Browser == "IE") &amp;&amp; (HttpContext.Current.Request.Browser.MajorVersion &lt; 8));         int i = 0;         foreach (var columnDefinition in dGridDefinition)         {           string sColName = ((aColumnList.Length &gt; 0) ? aColumnList[i].Split('|')[0] : "");           var column = (((sColName.Length &gt; 0) &amp;&amp; (dGridDefinition.ContainsKey(sColName)))             ? dGridDefinition[sColName] //Use column model defined in users settings             : columnDefinition.Value); //Take default column from grid definition file            //Populate _oJQGUserSettings.aColNames (column header names)           lColNames.Add("\"" + column["label"] + "\"");            //Handle custom formatting (note - only required for header cells not of type "headertablecell"           if ((column["headercelltype"].Length &gt; 0) &amp;&amp; (column["headercelltype"] != "headertablecell"))           {             lColHeaders.Add("{ " +               "name: \"" + ((column["datafield"].Length &gt; 0) ? column["datafield"] : column["label"]) + "\", " +               "formatter: \"" + column["headercelltype"] + "\"" +               " }");           }            //Clear stringbuilder           sbColModel.Clear();            //Build colModel for current field           bool bIsSortable = Convert.ToBoolean(column["sortable"]);           sbColModel.Append(" { ");           sbColModel.Append("name: \"" + ((column["datafield"].Length &gt; 0) ? column["datafield"] : column["label"]) + "\"");           sbColModel.Append(", sortable: " + bIsSortable.ToString().ToLower() + "");           if (bIsSortable) sbColModel.Append(", index: \"" + column["sortexpression"] + "\"");           if (Convert.ToBoolean(column["mandatory"])) sbColModel.Append(", hidedlg: true"); //If set to true this column will not appear in the modal dialog where users can choose which columns to show or hide           sbColModel.Append(", align: \"" + column["align"] + "\"");           sbColModel.Append(", title: false"); //This is to prevent the title tag being rendered on each TD - this reduces memory usage           sbColModel.Append(", width: ");           if (aColumnList.Length == 0)           {             sbColModel.Append(column["width"]); //Take default column from grid definition           }           else           {             var aColumn = aColumnList[i].Split('|');             sbColModel.Append(aColumn[1]); //Use column width defined in user settings             if (aColumn[2] == "0") sbColModel.Append(", hidden: true"); //If "0" specified in user settings then hide column           }            //Handle custom formatting           switch (column["template"].ToLower())           {             case "datetemplate":               sbColModel.Append(", formatter: _oJQGFormatters.FormatLocalDate");               sbColModel.Append(", datatype: \"Date\""); //Custom field               break;              case "datetimetemplate":               sbColModel.Append(", formatter: _oJQGFormatters.FormatLocalDateTime");               sbColModel.Append(", datatype: \"DateTime\""); //Custom field               break;              case "longdecimaltemplate":               sbColModel.Append(", formatter: \"number\"");               sbColModel.Append(", formatoptions: {decimalSeparator: \"" + CultureInfo.CurrentCulture.NumberFormat.CurrencyDecimalSeparator + "\"" +                 ", thousandsSeparator: \"" + CultureInfo.CurrentCulture.NumberFormat.CurrencyGroupSeparator + "\"" +                 ((column["decimalplaces"].Length &gt; 0) ? (", decimalPlaces: " + column["decimalplaces"]) : "") +                 "}");               sbColModel.Append(", datatype: \"Decimal\""); //Custom field               //", decimalPlaces: " + ((column["decimalplaces"].Length &gt; 0) ? column["decimalplaces"] : "0") + "}");                break;              case "texttemplate":               if (bIsIE6or7) sbColModel.Append(", formatter: _oJQGFormatters.FormatText"); //Note - only necessary for ie 6 and 7 to get round cell border bug in these browsers when rendering empty cells               break;              case "linktemplate":               sbColModel.Append(", formatter: _oJQGFormatters.FormatLink");               sbColModel.Append(", link: \"" + column["link"] + "\"");               sbColModel.Append(", textfield: \"" + ((column["textfield"].Length &gt; 0) ? column["textfield"] : column["datafield"]) + "\"");               break;              case "companytemplate":               sbColModel.Append(", formatter: _oJQGFormatters.FormatCompany");               break;              case "percenttemplate":               sbColModel.Append(", formatter: _oJQGFormatters.FormatPercent");               sbColModel.Append(", datatype: \"Decimal\""); //Custom field               break;              case "moneytemplate":               sbColModel.Append(", formatter: \"number\"");               sbColModel.Append(", formatoptions: {decimalSeparator: \"" + CultureInfo.CurrentCulture.NumberFormat.CurrencyDecimalSeparator + "\"" +                 ", thousandsSeparator: \"" + CultureInfo.CurrentCulture.NumberFormat.CurrencyGroupSeparator + "\"" +                 ", decimalPlaces: " + ((column["decimalplaces"].Length &gt; 0) ? column["decimalplaces"] : "0") + "}");               sbColModel.Append(", datatype: \"Decimal\""); //Custom field               break;              case "tickcrosstemplate":             case "readonlycheckboxtemplate":               sbColModel.Append(", formatter: \"checkbox\"");               break;              case "checkboxtemplate":               sbColModel.Append(", formatter: \"checkbox\", formatoptions: {disabled : false}");               break;              case "salesstatustemplate":               sbColModel.Append(", formatter: _oJQGFormatters.FormatSalesStatus");               sbColModel.Append(", allowcheckboxes: " + column["allowcheckboxes"]);               break;              case "tradingstatustemplate":               sbColModel.Append(", formatter: _oJQGFormatters.FormatTradingStatus");               break;              case "tradingstatusupdateabletemplate":               sbColModel.Append(", formatter: _oJQGFormatters.FormatTradingStatusUpdateable");               break;              case "rejectreasontemplate":               sbColModel.Append(", formatter: _oJQGFormatters.FormatRejectReason");               break;              case "changelogvaluetemplate":               sbColModel.Append(", formatter: _oJQGFormatters.FormatChangeLogValue");               break;              case "numerictextboxtemplate":               sbColModel.Append(", formatter: _oJQGFormatters.FormatNumericTextBox");               sbColModel.Append(", decimalSeparator: \"" + CultureInfo.CurrentCulture.NumberFormat.CurrencyDecimalSeparator + "\""); //Custom field               sbColModel.Append(", datatype: \"Decimal\""); //Custom field               break;              default:                //Is this a dynamic function formatter?               if (column["template"].ToLower().StartsWith("functionformattertemplate"))               {                 //The functionformattertemplate should be suffixed with a "|" followed by the name of the javascript function                 //eg "functionformattertemplate|_oJQGFormatters.FormatChangeLogValue"                 sbColModel.Append(", formatter: " + column["template"].Split('|')[1]);               }               break;           }            sbColModel.Append(" }");            //Add to list           lColModel.Add(sbColModel.ToString());            //Increment counter           i++;         }          //Write out general details         var lGeneralSettings = new List&lt;string&gt;();         lGeneralSettings.Add("\"bLoadedFromUserSettings\": " + ((dUserSettings == null) ? "false" : "true"));         lGeneralSettings.Add("\"bReadyToUse\": " + ((bAttemptToReloadUserSettings) ? "false" : "true")); //Indicator which tells the client when the grid settings are ready to be used.  If user settings could not be loaded then this will be set to true on the client in the AttemptToReloadUserSettings() function         lGeneralSettings.Add("\"iPageSize\": " + ((sPageSize == null) ? "-1" : sPageSize)); //-1 means show all records         lGeneralSettings.Add("\"sSortName\": \"" + sSortName + "\"");         lGeneralSettings.Add("\"sSortOrder\": \"" + sSortOrder + "\"");         lGeneralSettings.Add("\"sVersion\": \"" + sVersion + "\"");          return "{" + SharedLib.JoinDelimiterRows +           String.Join(SharedLib.JoinDelimiter, lGeneralSettings) + "," + SharedLib.JoinDelimiterRows +           "\"aColNames\": " + SharedLib.JoinDelimiterRows + "[" + SharedLib.JoinDelimiterRows + String.Join(",", lColNames) + SharedLib.JoinDelimiterRows + "]," + SharedLib.JoinDelimiterRows +           "\"aColHeaders\": " + SharedLib.JoinDelimiterRows + "[" + SharedLib.JoinDelimiterRows + String.Join(SharedLib.JoinDelimiter, lColHeaders) + SharedLib.JoinDelimiterRows + "]," + SharedLib.JoinDelimiterRows +           "\"aColModel\": " + SharedLib.JoinDelimiterRows + "[" + SharedLib.JoinDelimiterRows + String.Join(SharedLib.JoinDelimiter, lColModel) + SharedLib.JoinDelimiterRows + "]" + SharedLib.JoinDelimiterRows +           "}";       }       catch (Exception exc)       {         throw new Exception("Problem building jqGrid user settings.", exc);       }     }      /// &lt;summary&gt;    /// Get grid settings datatable     /// &lt;/summary&gt;    /// &lt;history&gt;    ///   &lt;change&gt;&lt;date&gt;06/07/2010&lt;/date&gt;&lt;name&gt;John Reilly&lt;/name&gt;&lt;description&gt;Created&lt;/description&gt;&lt;/change&gt;    /// &lt;/history&gt;    public static Dictionary&lt;string, Dictionary&lt;string, string&gt;&gt; GetGridDefinition(string sFileName, out string sVersion, out string[] aDefaultColumnList)     {       //Get grid settings       DataSet dsGridSettings = GetGridSettingsDataSet(sFileName);        //Extract version       sVersion = Convert.ToString(dsGridSettings.Tables[0].Rows[0]["version"]);        //Initialise       List&lt;string&gt; lDefaultColumnList = new List&lt;string&gt;();        //Get grid settings       DataTable dtGridSettings = dsGridSettings.Tables[1];        //Move into Dictionary       Dictionary&lt;string, Dictionary&lt;string, string&gt;&gt; dGridDefinition = new Dictionary&lt;string, Dictionary&lt;string, string&gt;&gt;();       for (int i = 0; i &lt; dtGridSettings.Rows.Count; i++)       {         DataRow row = dtGridSettings.Rows[i];          Dictionary&lt;string, string&gt; gridColumn = new Dictionary&lt;string, string&gt;();          string sDataField = row["datafield"].ToString();         string sLabel = row["label"].ToString();         bool bIsSortable = Convert.ToBoolean(row["sortable"]);          gridColumn.Add("datafield", sDataField);         gridColumn.Add("sortable", bIsSortable.ToString().ToLower());         gridColumn.Add("sortexpression", (bIsSortable ? row["sortexpression"].ToString() : ""));         gridColumn.Add("mandatory", row["mandatory"].ToString().ToLower());         gridColumn.Add("template", row["template"].ToString());         gridColumn.Add("headercelltype", (row.Table.Columns["headercelltype"] == null) ? "" : row["headercelltype"].ToString().ToLower());         gridColumn.Add("width", row["width"].ToString());         gridColumn.Add("align", row["horizontalalign"].ToString());         gridColumn.Add("label", sLabel);         gridColumn.Add("link", (row.Table.Columns["link"] == null) ? "" : row["link"].ToString());         gridColumn.Add("textfield", (row.Table.Columns["textfield"] == null) ? "" : row["textfield"].ToString());         gridColumn.Add("decimalplaces", (row.Table.Columns["decimalplaces"] == null) ? "" : row["decimalplaces"].ToString());         gridColumn.Add("allowcheckboxes", (row.Table.Columns["allowcheckboxes"] == null) ? "" : row["allowcheckboxes"].ToString().ToLower());          //Add grid definition         dGridDefinition.Add(           ((sDataField.Length &gt; 0) ? sDataField : sLabel), //Datafield will be used for a key unless is blank in which case use label           gridColumn);          //Build up default column list         lDefaultColumnList.Add(((gridColumn["datafield"].Length &gt; 0) ? gridColumn["datafield"] : gridColumn["label"]) + "|" + gridColumn["width"] + "|1");       }        aDefaultColumnList = lDefaultColumnList.ToArray();        return dGridDefinition;     }      /// &lt;summary&gt;    /// Get grid settings dataset     /// &lt;/summary&gt;    /// &lt;history&gt;    ///   &lt;change&gt;&lt;date&gt;09/07/2010&lt;/date&gt;&lt;name&gt;John Reilly&lt;/name&gt;&lt;description&gt;Created&lt;/description&gt;&lt;/change&gt;    /// &lt;/history&gt;    public static DataSet GetGridSettingsDataSet(string sFileName)     {       try       {         string sPhysicalPath = HttpContext.Current.Request.MapPath(SharedLib.ProcessUrl(sFileName));          //Generate dataset from xml file         DataSet ds = new DataSet();         ds.ReadXml(sPhysicalPath);          DataColumn idColumn = new DataColumn("id", System.Type.GetType("System.String"));         ds.Tables[1].Columns.Add(idColumn);          for (int i = 0; i &lt; ds.Tables[1].Rows.Count; i++)         {           DataRow dataRow = ds.Tables[1].Rows[i];           dataRow["id"] = Convert.ToString(i + 1);         }          //Set primary key of column table         ds.Tables[1].PrimaryKey = new DataColumn[] { ds.Tables[1].Columns["id"] };          return ds;       }       catch (Exception e)       {         throw new Exception("Unable to retrieve grid settings dataset! (" + sFileName + ")" + Environment.NewLine + e.Message, e);       }     }     #endregion      #region Public Methods      /// &lt;summary&gt;    /// GetLocalisedGridCaptionsScript     /// &lt;/summary&gt;    public string GetLocalisedGridCaptionsScript()     {       try       {         return (System.IO.File.Exists(HttpContext.Current.Server.MapPath(SharedLib.ScriptPath + "jquery/jqGrid/i18n/grid.locale-" + CurrentCulture + ".js")))           ? SharedLib.ScriptPath + "jquery/jqGrid/i18n/grid.locale-" + CurrentCulture + ".js"           : SharedLib.ScriptPath + "jquery/jqGrid/i18n/grid.locale-en.js";       }       catch (Exception exc)       {         throw new Exception("Problem generating localised grid captions script, " +           "CurrentCulture: " + ((CurrentCulture == null) ? "null" : CurrentCulture),            exc);       }     }      /// &lt;summary&gt;    /// GetLocalisedGridDefinitionFile     /// &lt;/summary&gt;    public string GetLocalisedGridDefinitionFile()     {       try       {         return (System.IO.File.Exists(HttpContext.Current.Server.MapPath("~/Resources/XML/" + CurrentCulture + "/" + GridSettingsFile)))           ? "~/Resources/XML/" + CurrentCulture + "/" + GridSettingsFile           : "~/Resources/XML/" + GridSettingsFile;       }       catch (Exception exc)       {         throw new Exception("Problem generating localised grid definition file, " +           "CurrentCulture: " + ((CurrentCulture == null) ? "null" : CurrentCulture) +           "GridSettingsFile: " + ((GridSettingsFile == null) ? "null" : GridSettingsFile),            exc);       }     }      /// &lt;summary&gt;    /// GetGridUserSettingsScriptBlock     /// &lt;/summary&gt;    /// &lt;history&gt;    ///   &lt;change&gt;&lt;date&gt;28/07/2011&lt;/date&gt;&lt;name&gt;Anthony Hand&lt;/name&gt;&lt;description&gt;Created&lt;/description&gt;&lt;/change&gt;    /// &lt;/history&gt;    public string GetGridUserSettingsScriptBlock()     {       //Get dictionary from Cookie       var dCookie = SharedLib.GetJSONCookieAsDictionary(this.CookieName);        //If cookie not obtained and a URL for obtaining UserSettings exists then set bAttemptToReloadUserSettings flag to true       bool bAttemptToReloadUserSettings = ((dCookie == null) &amp;&amp; (this.URLJSONUserSettings != null));        //If cookie obtained then build JSON properties based on it - if not then attempt to get settings out of localStorage / userData on the client       // NB It is desirable to get it out of the cookie because then the grid will immediately be ready to go as soon as the screen loads       string sUserSettings = "var _oJQGUserSettings = " +         BuildJSONUserSettings(           dUserSettings: dCookie,           sGridDefinitionFile: GridDefinitionFile,           sPageSize: PageSize,           sSortName: SortName,           sSortOrder: SortOrder,           bAttemptToReloadUserSettings: bAttemptToReloadUserSettings) + //Pass whether we should attempt to reload user settings (if cookies didn't exist and reload URL is available)           Environment.NewLine;        //If failed to obtain definition from cookie then attempt to obtain it from jStorage       if (bAttemptToReloadUserSettings) sUserSettings += "_oJQG.AttemptToReloadUserSettings();" + Environment.NewLine;        return sUserSettings;     }      /// &lt;summary&gt;    /// GetJQGridPropertiesScriptBlock     /// &lt;/summary&gt;    /// &lt;history&gt;    ///   &lt;change&gt;&lt;date&gt;28/07/2011&lt;/date&gt;&lt;name&gt;Anthony Hand&lt;/name&gt;&lt;description&gt;Created&lt;/description&gt;&lt;/change&gt;    /// &lt;/history&gt;    public string GetJQGridPropertiesScriptBlock()     {       var list = new List&lt;string&gt;();        list.Add("bAddColumnChooser: " + ((AddColumnChooser != null) ? AddColumnChooser : "true")); //Add column chooser by default       list.Add("sCaptionClipboard: \"" + ((CaptionClipboard != null) ? CaptionClipboard : SharedLib.GetResourceString("BUTTON_CLIPBOARD")) + "\"");       list.Add("sCaptionClipboardCopying: \"" + ((CaptionClipboardCopying != null) ? CaptionClipboardCopying : SharedLib.GetResourceString("MESSAGE_CLIPBOARD")) + "\"");       list.Add("sCaptionColumns: \"" + ((CaptionColumns != null) ? CaptionColumns : SharedLib.GetResourceString("CAPTION_COLUMNS")) + "\"");       list.Add("sCaptionColumnsReorder: \"" + ((CaptionColumnsReorder != null) ? CaptionColumnsReorder : SharedLib.GetResourceString("CAPTION_COLUMNS_REORDER")) + "\"");       list.Add("sCaptionDefaultErrorMessage: \"" + ((CaptionDefaultErrorMessage != null) ? CaptionDefaultErrorMessage : SharedLib.GetResourceString("MESSAGE_SEARCH_HAS_TAKEN_TOO_LONG")) + "\"");       list.Add("sCookieName: \"" + CookieName + "\"");       list.Add("sDefaultSortName: " + ((DefaultSortName != null) ? ("\"" + DefaultSortName + "\"") : "null"));       list.Add("sDefaultSortOrder: " + ((DefaultSortOrder != null) ? ("\"" + DefaultSortOrder + "\"") : "null"));       list.Add("aExtraDataColumns: " + ((ExtraDataColumns != null) ? ExtraDataColumns : "[]")); // use [] if there are no extra data columns       list.Add("sGridDefinitionFile: \"" + GridDefinitionFile + "\"");       list.Add("sLoadingImage: \"" + ((LoadingImage != null) ? LoadingImage : (SharedLib.ImageDir + "WaitBig.gif")) + "\"");       list.Add("sLoadingPanelMarginLeft: \"" + ((LoadingPanelMarginLeft != null) ? LoadingPanelMarginLeft : "-50px") + "\"");       list.Add("sLoadingPanelMarginTop: \"" + ((LoadingPanelMarginTop != null) ? LoadingPanelMarginTop : "-30px") + "\"");       list.Add("iMaxRecords: " + ((MaxRecords != null) ? MaxRecords : "0"));       list.Add("aPageSizes: " + ((PageSizes != null) ? PageSizes : "[]"));       list.Add("aSearchOptionParameters: " + ((SearchOptionParameters != null) ? SearchOptionParameters : "[]")); // use [] if there are no search option parameters       list.Add("sURL: \"" + URL + "\""); //URL of WebService/PageMethod used to populate the grid       list.Add("sURLJSONUserSettings: " + ((URLJSONUserSettings != null) ? ("\"" + URLJSONUserSettings + "\"") : "null")); //URL of WebService/PageMethod used to get the JSON user settings from a supplied dictionary       list.Add("sWaitType: \"" + ((WaitType != null) ? WaitType : "block") + "\""); //set to block by default        return "var _oJQGProperties = {"         + SharedLib.JoinDelimiterRows         + String.Join(SharedLib.JoinDelimiter, list)         + SharedLib.JoinDelimiterRows         + "}" + Environment.NewLine;     }     #endregion   } }</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7910894143296185920'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7910894143296185920'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5435082568783315279</id><published>2012-03-01T09:48:00.002Z</published><updated>2012-03-01T09:48:05.598Z</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>jqGrid.ascx.cs</title><content type='html'>namespace Commerzbank.PCS.Web.Shared {   using Commerzbank.PCS.Data;   using Commerzbank.PCS.Web.Shared;   using System;   using System.Collections.Generic;   using System.Data;   using System.Globalization;   using System.Linq;   using System.Text;   using System.Web;   using System.Web.UI;   using System.Web.UI.WebControls;    public partial class JQGrid : System.Web.UI.UserControl   {     public string AddColumnChooser { get; set; }     public string CaptionClipboard { get; set; }     public string CaptionClipboardCopying { get; set; }     public string CaptionColumns { get; set; }     public string CaptionColumnsReorder { get; set; }     public string CaptionDefaultErrorMessage { get; set; }     public string CookieName { get; set; }     public string CurrentCulture { get; set; }     public string DefaultSortName { get; set; }     public string DefaultSortOrder { get; set; }     public string ExtraDataColumns { get; set; }     public string GridDefinitionFile { get; set; }     public string LoadingImage { get; set; }     public string LoadingPanelMarginLeft { get; set; }     public string LoadingPanelMarginTop { get; set; }     public string MaxRecords { get; set; }     public string PageSize { get; set; }     public string PageSizes { get; set; }     public string SearchOptionParameters { get; set; }     public string SortName { get; set; }     public string SortOrder { get; set; }     public string URL { get; set; }     public string URLJSONUserSettings { get; set; }     public string WaitType { get; set; }          #region Public Static Methods      /// &lt;summary&gt;    /// Get grid settings datatable     /// &lt;/summary&gt;    /// &lt;history&gt;    ///   &lt;change&gt;&lt;date&gt;06/07/2010&lt;/date&gt;&lt;name&gt;John Reilly&lt;/name&gt;&lt;description&gt;Created&lt;/description&gt;&lt;/change&gt;    /// &lt;/history&gt;    public static Dictionary&lt;string, Dictionary&lt;string, string&gt;&gt; GetGridDefinition(string sFileName, out string sVersion, out string[] aDefaultColumnList)     {       //Get grid settings       DataSet dsGridSettings = GetGridSettingsDataSet(sFileName);        //Extract version       sVersion = Convert.ToString(dsGridSettings.Tables[0].Rows[0]["version"]);        //Initialise       List&lt;string&gt; lDefaultColumnList = new List&lt;string&gt;();        //Get grid settings       DataTable dtGridSettings = dsGridSettings.Tables[1];        //Move into Dictionary       Dictionary&lt;string, Dictionary&lt;string, string&gt;&gt; dGridDefinition = new Dictionary&lt;string, Dictionary&lt;string, string&gt;&gt;();       for (int i = 0; i &lt; dtGridSettings.Rows.Count; i++)       {         DataRow row = dtGridSettings.Rows[i];          Dictionary&lt;string, string&gt; gridColumn = new Dictionary&lt;string, string&gt;();          string sDataField = row["datafield"].ToString();         string sLabel = row["label"].ToString();         bool bIsSortable = Convert.ToBoolean(row["sortable"]);          gridColumn.Add("datafield", sDataField);         gridColumn.Add("sortable", bIsSortable.ToString().ToLower());         gridColumn.Add("sortexpression", (bIsSortable ? row["sortexpression"].ToString() : ""));         gridColumn.Add("mandatory", row["mandatory"].ToString().ToLower());         gridColumn.Add("template", row["template"].ToString());         gridColumn.Add("headercelltype", (row.Table.Columns["headercelltype"] == null) ? "" : row["headercelltype"].ToString().ToLower());         gridColumn.Add("width", row["width"].ToString());         gridColumn.Add("align", row["horizontalalign"].ToString());         gridColumn.Add("label", sLabel);         gridColumn.Add("link", (row.Table.Columns["link"] == null) ? "" : row["link"].ToString());         gridColumn.Add("textfield", (row.Table.Columns["textfield"] == null) ? "" : row["textfield"].ToString());         gridColumn.Add("decimalplaces", (row.Table.Columns["decimalplaces"] == null) ? "" : row["decimalplaces"].ToString());         gridColumn.Add("allowcheckboxes", (row.Table.Columns["allowcheckboxes"] == null) ? "" : row["allowcheckboxes"].ToString().ToLower());          //Add grid definition         dGridDefinition.Add(           ((sDataField.Length &gt; 0) ? sDataField : sLabel), //Datafield will be used for a key unless is blank in which case use label           gridColumn);          //Build up default column list         lDefaultColumnList.Add(((gridColumn["datafield"].Length &gt; 0) ? gridColumn["datafield"] : gridColumn["label"]) + "|" + gridColumn["width"] + "|1");       }        aDefaultColumnList = lDefaultColumnList.ToArray();        return dGridDefinition;     }      /// &lt;summary&gt;    /// Get grid settings dataset     /// &lt;/summary&gt;    /// &lt;history&gt;    ///   &lt;change&gt;&lt;date&gt;09/07/2010&lt;/date&gt;&lt;name&gt;John Reilly&lt;/name&gt;&lt;description&gt;Created&lt;/description&gt;&lt;/change&gt;    /// &lt;/history&gt;    public static DataSet GetGridSettingsDataSet(string sFileName)     {       try       {         string sPhysicalPath = HttpContext.Current.Request.MapPath(SharedLib.ProcessUrl(sFileName));          //Generate dataset from xml file         DataSet ds = new DataSet();         ds.ReadXml(sPhysicalPath);          DataColumn idColumn = new DataColumn("id", System.Type.GetType("System.String"));         ds.Tables[1].Columns.Add(idColumn);          for (int i = 0; i &lt; ds.Tables[1].Rows.Count; i++)         {           DataRow dataRow = ds.Tables[1].Rows[i];           dataRow["id"] = Convert.ToString(i + 1);         }          //Set primary key of column table         ds.Tables[1].PrimaryKey = new DataColumn[] { ds.Tables[1].Columns["id"] };          return ds;       }       catch (Exception e)       {         throw new Exception("Unable to retrieve grid settings dataset! (" + sFileName + ")" + Environment.NewLine + e.Message, e);       }     }      /// &lt;summary&gt;    /// Build JQGrid Script based on Properties that can be customised for specific users     /// &lt;/summary&gt;    /// &lt;history&gt;    ///   &lt;change&gt;&lt;date&gt;30/12/2010&lt;/date&gt;&lt;name&gt;John Reilly&lt;/name&gt;&lt;description&gt;Created&lt;/description&gt;&lt;/change&gt;    /// &lt;/history&gt;    public static string BuildJSONUserSettings(Dictionary&lt;string, string&gt; dUserSettings, string sGridDefinitionFile,       string sPageSize = "-1", string sSortName = "", string sSortOrder = "", //These parameters will be overwritten by any entries in the dUserSettings dictionary if they exist.  These parameters essentially define fallback values       bool bAttemptToReloadUserSettings = false)     {       try       {         //Get grid definition / version number from file         string[] aDefaultColumnList;         string sVersion;         var dGridDefinition = GetGridDefinition(sGridDefinitionFile, out sVersion, out aDefaultColumnList);          //Set from dictionary if version number is the same as in the grid definition         string[] aColumnList = new string[0];         if ((dUserSettings != null) &amp;&amp; (dUserSettings.ContainsKey("sVersion")) &amp;&amp; (sVersion == dUserSettings["sVersion"]))         {           if (dUserSettings.ContainsKey("sColumnList"))           {             //Get column list from user settings             aColumnList = dUserSettings["sColumnList"].Split('~');              //If the column list passed in doesn't contain the same number of columns as the default column list             //then revert back to defaults (this test is included to make it nicer for any developer changing the              //column definition file on the fly. (should never happen in prod situation)             if (aColumnList.Length != aDefaultColumnList.Length) aColumnList = new string[0];           }           if (dUserSettings.ContainsKey("iPageSize")) sPageSize = dUserSettings["iPageSize"];           if (dUserSettings.ContainsKey("sSortName")) sSortName = dUserSettings["sSortName"];           if (dUserSettings.ContainsKey("sSortOrder")) sSortOrder = dUserSettings["sSortOrder"];         }          //Determine is user has custom column list         bool bCustomColumnList = ((aColumnList.Length &gt; 0) &amp;&amp; (String.Join(",", aColumnList) != String.Join(",", aDefaultColumnList)));          //Log column order         WebLogger.Log("JQGrid UserSettings" +           (((sSortName != null) &amp;&amp; (sSortName.Length &gt; 0)) ? (" ordered by " + sSortName + " " + sSortOrder) : "") +           ((!bCustomColumnList)             ? " of the default column settings"             : (                 " of the following columns/widths: " + String.Join(", ", aColumnList)               )             ) +             (bAttemptToReloadUserSettings ? "[Will attempt to reload user settings (presumably no data found in cookie for this grid and JSONUserSettings URL is available)] " : "") +           " requested", SharedLib.FriendlyUserName, SharedLib.UserId, HttpContext.Current.Request.Url.ToString());          //Write out column model         var sbColModel = new StringBuilder();         var lColModel = new List&lt;string&gt;();         var lColHeaders = new List&lt;string&gt;();         var lColNames = new List&lt;string&gt;();          bool bIsIE6or7 = ((HttpContext.Current.Request.Browser.Browser == "IE") &amp;&amp; (HttpContext.Current.Request.Browser.MajorVersion &lt; 8));         int i = 0;         foreach (var columnDefinition in dGridDefinition)         {           string sColName = ((aColumnList.Length &gt; 0) ? aColumnList[i].Split('|')[0] : "");           var column = (((sColName.Length &gt; 0) &amp;&amp; (dGridDefinition.ContainsKey(sColName)))             ? dGridDefinition[sColName] //Use column model defined in users settings             : columnDefinition.Value); //Take default column from grid definition file            //Populate _oJQGUserSettings.aColNames (column header names)           lColNames.Add("\"" + column["label"] + "\"");            //Handle custom formatting (note - only required for header cells not of type "headertablecell"           if ((column["headercelltype"].Length &gt; 0) &amp;&amp; (column["headercelltype"] != "headertablecell"))           {             lColHeaders.Add("{ " +               "name: \"" + ((column["datafield"].Length &gt; 0) ? column["datafield"] : column["label"]) + "\", " +               "formatter: \"" + column["headercelltype"] + "\"" +               " }");           }            //Clear stringbuilder           sbColModel.Clear();            //Build colModel for current field           bool bIsSortable = Convert.ToBoolean(column["sortable"]);           sbColModel.Append(" { ");           sbColModel.Append("name: \"" + ((column["datafield"].Length &gt; 0) ? column["datafield"] : column["label"]) + "\"");           sbColModel.Append(", sortable: " + bIsSortable.ToString().ToLower() + "");           if (bIsSortable) sbColModel.Append(", index: \"" + column["sortexpression"] + "\"");           if (Convert.ToBoolean(column["mandatory"])) sbColModel.Append(", hidedlg: true"); //If set to true this column will not appear in the modal dialog where users can choose which columns to show or hide           sbColModel.Append(", align: \"" + column["align"] + "\"");           sbColModel.Append(", title: false"); //This is to prevent the title tag being rendered on each TD - this reduces memory usage           sbColModel.Append(", width: ");           if (aColumnList.Length == 0)           {             sbColModel.Append(column["width"]); //Take default column from grid definition           }           else           {             var aColumn = aColumnList[i].Split('|');             sbColModel.Append(aColumn[1]); //Use column width defined in user settings             if (aColumn[2] == "0") sbColModel.Append(", hidden: true"); //If "0" specified in user settings then hide column           }            //Handle custom formatting           switch (column["template"].ToLower())           {             case "datetemplate":               sbColModel.Append(", formatter: _oJQGFormatters.FormatLocalDate");               sbColModel.Append(", datatype: \"Date\""); //Custom field               break;              case "datetimetemplate":               sbColModel.Append(", formatter: _oJQGFormatters.FormatLocalDateTime");               sbColModel.Append(", datatype: \"DateTime\""); //Custom field               break;              case "longdecimaltemplate":               sbColModel.Append(", formatter: \"number\"");               sbColModel.Append(", formatoptions: {decimalSeparator: \"" + CultureInfo.CurrentCulture.NumberFormat.CurrencyDecimalSeparator + "\"" +                 ", thousandsSeparator: \"" + CultureInfo.CurrentCulture.NumberFormat.CurrencyGroupSeparator + "\"" +                  ((column["decimalplaces"].Length &gt; 0) ? (", decimalPlaces: " + column["decimalplaces"]) : "") +                  "}");               sbColModel.Append(", datatype: \"Decimal\""); //Custom field                 //", decimalPlaces: " + ((column["decimalplaces"].Length &gt; 0) ? column["decimalplaces"] : "0") + "}");                break;              case "texttemplate":               if (bIsIE6or7) sbColModel.Append(", formatter: _oJQGFormatters.FormatText"); //Note - only necessary for ie 6 and 7 to get round cell border bug in these browsers when rendering empty cells               break;              case "linktemplate":               sbColModel.Append(", formatter: _oJQGFormatters.FormatLink");               sbColModel.Append(", link: \"" + column["link"] + "\"");               sbColModel.Append(", textfield: \"" + ((column["textfield"].Length &gt; 0) ? column["textfield"] : column["datafield"]) + "\"");               break;              case "companytemplate":               sbColModel.Append(", formatter: _oJQGFormatters.FormatCompany");               break;              case "percenttemplate":               sbColModel.Append(", formatter: _oJQGFormatters.FormatPercent");               sbColModel.Append(", datatype: \"Decimal\""); //Custom field               break;              case "moneytemplate":               sbColModel.Append(", formatter: \"number\"");               sbColModel.Append(", formatoptions: {decimalSeparator: \"" + CultureInfo.CurrentCulture.NumberFormat.CurrencyDecimalSeparator + "\"" +                 ", thousandsSeparator: \"" + CultureInfo.CurrentCulture.NumberFormat.CurrencyGroupSeparator + "\"" +                 ", decimalPlaces: " + ((column["decimalplaces"].Length &gt; 0) ? column["decimalplaces"] : "0") + "}");               sbColModel.Append(", datatype: \"Decimal\""); //Custom field               break;              case "tickcrosstemplate":             case "readonlycheckboxtemplate":               sbColModel.Append(", formatter: \"checkbox\"");               break;              case "checkboxtemplate":               sbColModel.Append(", formatter: \"checkbox\", formatoptions: {disabled : false}");               break;              case "salesstatustemplate":               sbColModel.Append(", formatter: _oJQGFormatters.FormatSalesStatus");               sbColModel.Append(", allowcheckboxes: " + column["allowcheckboxes"]);               break;              case "tradingstatustemplate":               sbColModel.Append(", formatter: _oJQGFormatters.FormatTradingStatus");               break;              case "tradingstatusupdateabletemplate":               sbColModel.Append(", formatter: _oJQGFormatters.FormatTradingStatusUpdateable");               break;              case "rejectreasontemplate":               sbColModel.Append(", formatter: _oJQGFormatters.FormatRejectReason");               break;              case "changelogvaluetemplate":               sbColModel.Append(", formatter: _oJQGFormatters.FormatChangeLogValue");               break;              case "numerictextboxtemplate":               sbColModel.Append(", formatter: _oJQGFormatters.FormatNumericTextBox");               sbColModel.Append(", decimalSeparator: \"" + CultureInfo.CurrentCulture.NumberFormat.CurrencyDecimalSeparator + "\""); //Custom field               sbColModel.Append(", datatype: \"Decimal\""); //Custom field               break;              default:                //Is this a dynamic function formatter?               if (column["template"].ToLower().StartsWith("functionformattertemplate"))               {                 //The functionformattertemplate should be suffixed with a "|" followed by the name of the javascript function                 //eg "functionformattertemplate|_oJQGFormatters.FormatChangeLogValue"                 sbColModel.Append(", formatter: " + column["template"].Split('|')[1]);               }               break;           }            sbColModel.Append(" }");            //Add to list           lColModel.Add(sbColModel.ToString());            //Increment counter           i++;         }          //Write out general details         var lGeneralSettings = new List&lt;string&gt;();         lGeneralSettings.Add("\"bLoadedFromUserSettings\": " + ((dUserSettings == null) ? "false" : "true"));         lGeneralSettings.Add("\"bReadyToUse\": " + ((bAttemptToReloadUserSettings) ? "false" : "true")); //Indicator which tells the client when the grid settings are ready to be used.  If user settings could not be loaded then this will be set to true on the client in the AttemptToReloadUserSettings() function         lGeneralSettings.Add("\"iPageSize\": " + ((sPageSize == null) ? "-1" : sPageSize)); //-1 means show all records         lGeneralSettings.Add("\"sSortName\": \"" + sSortName + "\"");         lGeneralSettings.Add("\"sSortOrder\": \"" + sSortOrder + "\"");         lGeneralSettings.Add("\"sVersion\": \"" + sVersion + "\"");          return "{" + SharedLib.JoinDelimiterRows +           String.Join(SharedLib.JoinDelimiter, lGeneralSettings) + "," + SharedLib.JoinDelimiterRows +           "\"aColNames\": " + SharedLib.JoinDelimiterRows + "[" + SharedLib.JoinDelimiterRows + String.Join(",", lColNames) + SharedLib.JoinDelimiterRows + "]," + SharedLib.JoinDelimiterRows +           "\"aColHeaders\": " + SharedLib.JoinDelimiterRows + "[" + SharedLib.JoinDelimiterRows + String.Join(SharedLib.JoinDelimiter, lColHeaders) + SharedLib.JoinDelimiterRows + "]," + SharedLib.JoinDelimiterRows +           "\"aColModel\": " + SharedLib.JoinDelimiterRows + "[" + SharedLib.JoinDelimiterRows + String.Join(SharedLib.JoinDelimiter, lColModel) + SharedLib.JoinDelimiterRows + "]" + SharedLib.JoinDelimiterRows +            "}";       }       catch (Exception exc)       {         throw new Exception("Problem building jqGrid user settings.", exc);       }     }      #endregion      /// &lt;summary&gt;    /// Register JQGrid Libraries     /// &lt;/summary&gt;    public void RegisterJQGridLibraries()     {       //Register CSS       RegisterCSS();        //Where minimised scripts are available then use them in Release mode       string sCurrentCulture = (CurrentCulture != null) ? CurrentCulture : CultureInfo.CurrentCulture.TwoLetterISOLanguageName;       string sLocalisedGridCaptions = (System.IO.File.Exists(Server.MapPath(SharedLib.ScriptPath + "jquery/jqGrid/i18n/grid.locale-" + sCurrentCulture + ".js")))         ? SharedLib.ScriptPath + "jquery/jqGrid/i18n/grid.locale-" + sCurrentCulture + ".js"         : SharedLib.ScriptPath + "jquery/jqGrid/i18n/grid.locale-en.js";        //IMPORTANT: DO NOT CHANGE ORDER OF SCRIPT REGISTRATION BELOW       //Register JQuery scripts       ScriptHelper.AddClientScript(SharedLib.URLjQueryUI, 4);           //JQuery UI library       ScriptHelper.AddClientScript(sLocalisedGridCaptions, 4);          //JQuery Regionalisation of Grid captions (Depending on localisation selected we should serve the relevant script) NB - THIS SCRIPT IS REQUIRED BEFORE THE JQGRID SCRIPT.  WEIRD BUT TRUE.       ScriptHelper.AddClientScript(SharedLib.URLUIMultiSelect, 4);      //JQuery Multiselect library used by Column Chooser       ScriptHelper.AddClientScript(SharedLib.URLjqGrid, 4);             //JQuery Grid library       ScriptHelper.AddClientScript(SharedLib.URLjQueryLocalisation, 4); //JQuery Localisation library used by Column Chooser - may not be necessary?       ScriptHelper.AddClientScript(SharedLib.URLjQueryScrollTo, 4);     //JQuery ScrollTo library used by Column Chooser        //Register our scripts       ScriptHelper.AddClientScript(SharedLib.URLlibString);  //Get libString for clipboard       ScriptHelper.AddClientScript(SharedLib.URLjqGridList); //ListPage library - used to reduce code written per ListPage     }      /// &lt;summary&gt;    /// Add CSS links to Header     /// &lt;/summary&gt;    public void RegisterCSS()     {       // Custom JQuery css - alternatives can be built / downloaded from http://www.jqueryui.com       var cssjQueryUI = new System.Web.UI.HtmlControls.HtmlLink();       cssjQueryUI.Href = SharedLib.URLCSSjQueryUI;       cssjQueryUI.Attributes.Add("rel", "stylesheet");       cssjQueryUI.Attributes.Add("type", "text/css");        // Standard jqGrid css       var cssjqGrid = new System.Web.UI.HtmlControls.HtmlLink();       cssjqGrid.Href = SharedLib.URLCSSjqGrid;       cssjqGrid.Attributes.Add("rel", "stylesheet");       cssjqGrid.Attributes.Add("type", "text/css");        // Multiselect css used by Column Chooser       var cssUIMultiselect = new System.Web.UI.HtmlControls.HtmlLink();       cssUIMultiselect.Href = SharedLib.URLCSSMultiSelect;       cssUIMultiselect.Attributes.Add("rel", "stylesheet");       cssUIMultiselect.Attributes.Add("type", "text/css");        // Add the HtmlLinks to the Head section of the page.       Page.Header.Controls.Add(cssjQueryUI);       Page.Header.Controls.Add(cssjqGrid);       Page.Header.Controls.Add(cssUIMultiselect);     }      /// &lt;summary&gt;    /// Register JQGrid Scripts     /// &lt;/summary&gt;    public void RegisterJQGridScript()     {       try       {         // Register general JQGrid properties         RegisterJQGridProperties();          // Register JQGrid properties that can be different from user to user         //         //Get dictionary from Cookie         var dCookie = SharedLib.GetJSONCookieAsDictionary(CookieName);          //If cookie not obtained and a URL for obtaining UserSettings exists then set bAttemptToReloadUserSettings flag to true         bool bAttemptToReloadUserSettings = ((dCookie == null) &amp;&amp; (URLJSONUserSettings != null));                  //If cookie obtained then build JSON properties based on it - if not then attempt to get settings out of localStorage / userData on the client         // NB It is desirable to get it out of the cookie because then the grid will immediately be ready to go as soon as the screen loads         string sUserSettings = "var _oJQGUserSettings = " +            BuildJSONUserSettings(             dUserSettings: dCookie,             sGridDefinitionFile: GridDefinitionFile,              sPageSize: PageSize,             sSortName: SortName,              sSortOrder: SortOrder,             bAttemptToReloadUserSettings: bAttemptToReloadUserSettings) + //Pass whether we should attempt to reload user settings (if cookies didn't exist and reload URL is available)             Environment.NewLine;          //If failed to obtain definition from cookie then attempt to obtain it from jStorage         if (bAttemptToReloadUserSettings) sUserSettings += "_oJQG.AttemptToReloadUserSettings();" + Environment.NewLine;          //Register script         ScriptHelper.AddClientScriptBlock("GridUserSettings", sUserSettings);       }       catch (Exception exc)       {         throw new Exception("Problem registering jqGrid scripts.", exc);       }     }      /// &lt;summary&gt;    /// Register JQGrid Properties     /// &lt;/summary&gt;    /// &lt;history&gt;    ///   &lt;change&gt;&lt;date&gt;30/12/2010&lt;/date&gt;&lt;name&gt;John Reilly&lt;/name&gt;&lt;description&gt;Created&lt;/description&gt;&lt;/change&gt;    /// &lt;/history&gt;    private void RegisterJQGridProperties()     {       try       {         var lJQGridProperties = new List&lt;string&gt;();          lJQGridProperties.Add("bAddColumnChooser: " + ((AddColumnChooser != null) ? AddColumnChooser : "true")); //Add column chooser by default         lJQGridProperties.Add("sCaptionClipboard: \"" + ((CaptionClipboard != null) ? CaptionClipboard : SharedLib.GetResourceString("BUTTON_CLIPBOARD")) + "\"");         lJQGridProperties.Add("sCaptionClipboardCopying: \"" + ((CaptionClipboardCopying != null) ? CaptionClipboardCopying : SharedLib.GetResourceString("MESSAGE_CLIPBOARD")) + "\"");         lJQGridProperties.Add("sCaptionColumns: \"" + ((CaptionColumns != null) ? CaptionColumns : SharedLib.GetResourceString("CAPTION_COLUMNS")) + "\"");         lJQGridProperties.Add("sCaptionColumnsReorder: \"" + ((CaptionColumnsReorder != null) ? CaptionColumnsReorder : SharedLib.GetResourceString("CAPTION_COLUMNS_REORDER")) + "\"");         lJQGridProperties.Add("sCaptionDefaultErrorMessage: \"" + ((CaptionDefaultErrorMessage != null) ? CaptionDefaultErrorMessage : SharedLib.GetResourceString("MESSAGE_SEARCH_HAS_TAKEN_TOO_LONG")) + "\"");         lJQGridProperties.Add("sCookieName: \"" + CookieName + "\"");         lJQGridProperties.Add("sDefaultSortName: " + ((DefaultSortName != null) ? ("\"" + DefaultSortName + "\"") : "null"));         lJQGridProperties.Add("sDefaultSortOrder: " + ((DefaultSortOrder != null) ? ("\"" + DefaultSortOrder + "\"") : "null"));         lJQGridProperties.Add("aExtraDataColumns: " + ((ExtraDataColumns != null) ? ExtraDataColumns : "[]")); // use [] if there are no extra data columns         lJQGridProperties.Add("sGridDefinitionFile: \"" + GridDefinitionFile + "\"");         lJQGridProperties.Add("sLoadingImage: \"" + ((LoadingImage != null) ? LoadingImage : (SharedLib.ImageDir + "WaitBig.gif")) + "\"");         lJQGridProperties.Add("sLoadingPanelMarginLeft: \"" + ((LoadingPanelMarginLeft != null) ? LoadingPanelMarginLeft : "-50px") + "\"");         lJQGridProperties.Add("sLoadingPanelMarginTop: \"" + ((LoadingPanelMarginTop != null) ? LoadingPanelMarginTop : "-30px") + "\"");         lJQGridProperties.Add("iMaxRecords: " + ((MaxRecords != null) ? MaxRecords : "0"));         lJQGridProperties.Add("aPageSizes: " + ((PageSizes != null) ? PageSizes : "[]"));         lJQGridProperties.Add("aSearchOptionParameters: " + ((SearchOptionParameters != null) ? SearchOptionParameters : "[]")); // use [] if there are no search option parameters         lJQGridProperties.Add("sURL: \"" + URL + "\""); //URL of WebService/PageMethod used to populate the grid         lJQGridProperties.Add("sURLJSONUserSettings: " + ((URLJSONUserSettings != null) ? ("\"" + URLJSONUserSettings + "\"") : "null")); //URL of WebService/PageMethod used to get the JSON user settings from a supplied dictionary         lJQGridProperties.Add("sWaitType: \"" + ((WaitType != null) ? WaitType : "block") + "\""); //set to block by default                  //Register javascript object literal         ScriptHelper.AddClientScriptBlock("JQGridProperties",            "var _oJQGProperties = {" + SharedLib.JoinDelimiterRows +           String.Join(SharedLib.JoinDelimiter, lJQGridProperties) + SharedLib.JoinDelimiterRows +           "}" + Environment.NewLine);       }       catch (Exception exc)       {         throw new Exception("Problem registering jqGrid properties.", exc);       }     }      #region JQGrid Data object      /// &lt;summary&gt;    ///  Returns a JQGrid data object constructed from a DataSet     /// &lt;/summary&gt;    /// &lt;param name="ds"&gt;dataset containing data&lt;/param&gt;    /// &lt;param name="aOriginalColumnDefinition"&gt;the definition of the structure of the grid (generally taken from the xml files eg DealList.xml)&lt;/param&gt;    /// &lt;param name="aExtraColumns"&gt;[OPTIONAL] Extra columns that are *not* to be displayed in the grid but may be used in the rendering of other columns.  Eg A company IsisID is necessary as well as a company name in order that the link can be properly generated in javascript.  See FormatCompany or PostLoadProcessing javascript methods to see how these are used&lt;/param&gt;    /// &lt;param name="sId"&gt;[OPTIONAL] the field name in the data that contains the id (must be an integer) - if one isn't available then it will come up with its own ID (basically starting at 0 and going up)&lt;/param&gt;    /// &lt;param name="sSortField"&gt;[OPTIONAL] the sort field of the data (eg "DealId") - only passed for logging purposes&lt;/param&gt;    /// &lt;param name="sSortOrder"&gt;[OPTIONAL] the sort order of the data ("asc" / "desc") - only passed for logging purposes&lt;/param&gt;    /// &lt;param name="iPageSelected"&gt;[OPTIONAL] if paging through data then this contains the current page in question (eg 2 as in 2 out of 10 pages of data)&lt;/param&gt;    /// &lt;param name="iPageCount"&gt;[OPTIONAL] if paging through data then this contains the number of pages of data that exist (eg 10 as in 1000 / 100 = 10)&lt;/param&gt;    /// &lt;param name="iRecordCount"&gt;[OPTIONAL] the maximum number of records that can be examined via the grid - if not passed then will initialise to -1 which basically means "give me all records in the data"&lt;/param&gt;    /// &lt;param name="sLogMessage"&gt;[OPTIONAL] pass a log message to be used if logging is being performed (if not passed then a default one will be generated)&lt;/param&gt;    /// &lt;param name="bLogSearch"&gt;[OPTIONAL] decide whether a log should be performed or not (default true)&lt;/param&gt;    /// &lt;returns&gt;a JQGrid data object&lt;/returns&gt;    /// &lt;history&gt;    ///   &lt;change&gt;&lt;date&gt;19/01/2011&lt;/date&gt;&lt;name&gt;John Reilly&lt;/name&gt;&lt;description&gt;Created&lt;/description&gt;&lt;/change&gt;    /// &lt;/history&gt;    public static JQGridData GetJQGridFromDataSet(DataSet ds, Dictionary&lt;string, object&gt;[] aOriginalColumnDefinition,        string[] aExtraColumns = null,       string sId = null,        string sSortField = null,        string sSortOrder = null,        int iPageSelected = 1,        int iPageCount = 1,        int iRecordCount = -1,       string sLogMessage = null,        bool bLogSearch = true)     {       //If no data then throw error       if (ds == null || ds.Tables.Count &lt; 1) throw new Exception("Either dataset is null or there are no tables in dataset.");        return GetJQGridFromDataTable(         dt: ds.Tables[0], //Take first table in dataset         aOriginalColumnDefinition: aOriginalColumnDefinition,         aExtraColumns: aExtraColumns,         sId: sId,         sSortField: sSortField,         sSortOrder: sSortOrder,         iPageSelected: iPageSelected,         iPageCount: iPageCount,         iRecordCount: iRecordCount,         sLogMessage: sLogMessage,         bLogSearch: bLogSearch         );     }      /// &lt;summary&gt;    ///  Returns a JQGrid data object constructed from a DataTable     /// &lt;/summary&gt;    /// &lt;param name="dt"&gt;datatable containing data&lt;/param&gt;    /// &lt;param name="aOriginalColumnDefinition"&gt;the definition of the structure of the grid (generally taken from the xml files eg DealList.xml)&lt;/param&gt;    /// &lt;param name="aExtraColumns"&gt;[OPTIONAL] Extra columns that are *not* to be displayed in the grid but may be used in the rendering of other columns.  Eg A company IsisID is necessary as well as a company name in order that the link can be properly generated in javascript.  See FormatCompany or PostLoadProcessing javascript methods to see how these are used&lt;/param&gt;    /// &lt;param name="sId"&gt;[OPTIONAL] the field name in the data that contains the id (must be an integer) - if one isn't available then it will come up with its own ID (basically starting at 0 and going up)&lt;/param&gt;    /// &lt;param name="sSortField"&gt;[OPTIONAL] the sort field of the data (eg "DealId") - only passed for logging purposes&lt;/param&gt;    /// &lt;param name="sSortOrder"&gt;[OPTIONAL] the sort order of the data ("asc" / "desc") - only passed for logging purposes&lt;/param&gt;    /// &lt;param name="iPageSelected"&gt;[OPTIONAL] if paging through data then this contains the current page in question (eg 2 as in 2 out of 10 pages of data)&lt;/param&gt;    /// &lt;param name="iPageCount"&gt;[OPTIONAL] if paging through data then this contains the number of pages of data that exist (eg 10 as in 1000 / 100 = 10)&lt;/param&gt;    /// &lt;param name="iRecordCount"&gt;[OPTIONAL] the maximum number of records that can be examined via the grid - if not passed then will initialise to -1 which basically means "give me all records in the data"&lt;/param&gt;    /// &lt;param name="sLogMessage"&gt;[OPTIONAL] pass a log message to be used if logging is being performed (if not passed then a default one will be generated)&lt;/param&gt;    /// &lt;param name="bLogSearch"&gt;[OPTIONAL] decide whether a log should be performed or not (default true)&lt;/param&gt;    /// &lt;returns&gt;a JQGrid data object&lt;/returns&gt;    /// &lt;history&gt;    ///   &lt;change&gt;&lt;date&gt;19/01/2011&lt;/date&gt;&lt;name&gt;John Reilly&lt;/name&gt;&lt;description&gt;Created&lt;/description&gt;&lt;/change&gt;    /// &lt;/history&gt;    public static JQGridData GetJQGridFromDataTable(DataTable dt, Dictionary&lt;string, object&gt;[] aOriginalColumnDefinition,       string[] aExtraColumns = null,       string sId = null,        string sSortField = null,        string sSortOrder = null,        int iPageSelected = 1,        int iPageCount = 1,        int iRecordCount = -1,       string sLogMessage = null,        bool bLogSearch = true)     {       JQGridData jqGrid = new JQGridData();        //Use null coalescing operator to initialise aExtraColumns with empty string array if value not passed       aExtraColumns = aExtraColumns ?? new string[0];        try       {         //If not set then initialise iRecordCount from dataset         if (iRecordCount == -1) iRecordCount = dt.Rows.Count;          //Build up data set         for (int i = 0; i &lt; dt.Rows.Count; i++)         {           DataRow dataRow = dt.Rows[i];           JQGridData.Row row = new JQGridData.Row();            //Write out ID of line           row.id = (sId != null)             ? Convert.ToInt32(dataRow[sId])             : i;            //Write out data in the same order as the colModel           foreach (var column in aOriginalColumnDefinition)           {             if (dt.Columns.Contains(column["name"].ToString()))             {               object oValue = dataRow[column["name"].ToString()];               if (column.Keys.Contains("datatype"))               {                 /* NOT BEING USED BUT LEFT IN CASE USEFUL IN FUTURE                 Dictionary&lt;string, object&gt; formatOptions = (Dictionary&lt;string, object&gt;)column["formatoptions"];                  ci.NumberFormat.CurrencyDecimalSeparator = formatOptions["decimalSeparator"].ToString();                 ci.NumberFormat.CurrencyGroupSeparator = formatOptions["thousandsSeparator"].ToString();                 ci.NumberFormat.CurrencyDecimalDigits = Convert.ToInt32(formatOptions["decimalPlaces"]);                 */                  if (oValue == System.DBNull.Value)                   row.cell.Add(""); //Add empty cell                 else                 {                   switch (column["datatype"].ToString())                   {                     /*                     //Not used for now due to UTC issues (Date seen by users changes based on regionalisation - will come back to this at some point perhaps)                     case "DateTime":                     case "Date":                       //Add cell as a JSON date field.  This is to allow efficent javascript creation of a Date object                       row.cell.Add(GetDateTimeAsJavascriptDateTicks(Convert.ToDateTime(oValue)).ToString());                      */                      case "DateTime":                       //Add cell as javascript date constructor parameters.  This will allow efficent javascript creation of a Date object                       row.cell.Add(GetDateTimeAsJavascriptDateConstructorParameters(Convert.ToDateTime(oValue)));                       break;                      case "Date":                       //Add cell as javascript date constructor parameters.  This will allow efficent javascript creation of a Date object                       row.cell.Add(GetDateAsJavascriptDateConstructorParameters(Convert.ToDateTime(oValue)));                        break;                      case "Decimal":                       //Add cell as a decimal field rendered using invariant culture.  This is because javascript uses "." for its decimal separator always                       decimal dDecimal = Convert.ToDecimal(oValue);                       row.cell.Add(Convert.ToString(dDecimal, NumberFormatInfo.InvariantInfo));                       break;                      default:                       throw new Exception("Unknown datatype: " + column["datatype"].ToString());                   }                 }               }               else               {                 //Add cell                 row.cell.Add(oValue.ToString());               }             }             else             {               //Add empty cell               row.cell.Add("");             }           }            //Write out any remaining data columns           foreach (var column in aExtraColumns)           {             //Add cell             if (dataRow.Table.Columns[column].DataType == System.Type.GetType("System.DateTime"))             {               //Add cell as a JSON date field.  This is to allow efficent javascript creation of a Date object               row.cell.Add(GetDateTimeAsJavascriptDateConstructorParameters(Convert.ToDateTime(dataRow[column])));             }             else               row.cell.Add(dataRow[column].ToString());           }            jqGrid.rows.Add(row);         }          jqGrid.page = iPageSelected;         jqGrid.total = iPageCount;  // Set this to total pages in your result...         jqGrid.records = iRecordCount;          //Log search         if (bLogSearch) WebLogger.Log(((sLogMessage != null) ? sLogMessage : "Search performed") +           ", " + jqGrid.rows.Count.ToString() + " rows returned" +           (((sSortField != null) &amp;&amp; (sSortField.Length &gt; 0)) ? (" ordered by " + sSortField + " " + sSortOrder) : "") +           ((jqGrid.page &gt; 1) ? (", this was page " + jqGrid.page.ToString() + " of " + jqGrid.total.ToString()) : ""),           SharedLib.FriendlyUserName, SharedLib.UserId, HttpContext.Current.Request.Url.ToString());       }       catch (Exception exc)       {         WebLogger.LogException(new Exception("Problem creating JQGrid from DataSet", exc), HttpContext.Current.Session, HttpContext.Current.Request);       }        return jqGrid;     }      /// &lt;summary&gt;    ///  Returns the javascript Date constructor parameters (year, month, day) which can be used to construct a Date on the client     ///  javascript: new Date(year, month, day);     /// &lt;/summary&gt;    /// &lt;history&gt;    ///   &lt;change&gt;&lt;date&gt;19/01/2011&lt;/date&gt;&lt;name&gt;John Reilly&lt;/name&gt;&lt;description&gt;Created&lt;/description&gt;&lt;/change&gt;    /// &lt;/history&gt;    public static string GetDateAsJavascriptDateConstructorParameters(DateTime dt)     {       return dt.Year.ToString() + "|" +         Convert.ToString(dt.Month - 1) + "|" + //Adjustment for javascript         dt.Day.ToString();     }      /// &lt;summary&gt;    ///  Returns the javascript Date constructor parameters (year, month, day, hours, minutes, seconds, milliseconds) which can be used to construct a Date on the client     ///  javascript: new Date(year, month, day, hours, minutes, seconds, milliseconds);     /// &lt;/summary&gt;    /// &lt;history&gt;    ///   &lt;change&gt;&lt;date&gt;19/01/2011&lt;/date&gt;&lt;name&gt;John Reilly&lt;/name&gt;&lt;description&gt;Created&lt;/description&gt;&lt;/change&gt;    /// &lt;/history&gt;    public static string GetDateTimeAsJavascriptDateConstructorParameters(DateTime dt)     {       return dt.Year.ToString() + "|" +         Convert.ToString(dt.Month - 1) + "|" + //Adjustment for javascript         dt.Day.ToString() + "|" +         dt.Hour.ToString() + "|" +         dt.Minute.ToString() + "|" +         dt.Second.ToString() + "|" +         dt.Millisecond.ToString();     }      /// &lt;summary&gt;    ///  Returns the number of milliseconds since Jan 1, 1970 (useful for converting C# dates to JS dates)     /// &lt;/summary&gt;    /// &lt;history&gt;    ///   &lt;change&gt;&lt;date&gt;19/01/2011&lt;/date&gt;&lt;name&gt;John Reilly&lt;/name&gt;&lt;description&gt;Created&lt;/description&gt;&lt;/change&gt;    /// &lt;/history&gt;    public static long GetDateTimeAsJavascriptDateTicks(DateTime dt)     {       return (long)(dt.ToUniversalTime() - unixEpoch).TotalMilliseconds;     }      private static readonly DateTime unixEpoch = new DateTime(1970, 1, 1, 0, 0, 0, 0, DateTimeKind.Utc);      public class JQGridData     {       public class Row       {         public int id { get; set; }         public List&lt;string&gt; cell { get; set; }          public Row()         {           cell = new List&lt;string&gt;();         }       }        public int page { get; set; }       public int total { get; set; }       public int records { get; set; }       public List&lt;Row&gt; rows { get; set; }        public JQGridData()       {         rows = new List&lt;Row&gt;();       }     }      #endregion    } }</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5435082568783315279'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5435082568783315279'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8539690246003820676</id><published>2012-03-01T09:47:00.001Z</published><updated>2012-03-01T09:47:16.290Z</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>jqGridList.js</title><content type='html'>// Useful links: //  http://www.trirand.com/blog/ //  http://www.trirand.com/jqgridwiki/doku.php //  http://www.trirand.com/blog/jqgrid/downloads/jqgriddocs.pdf //  http://www.secondpersonplural.ca/jqgriddocs/_2eb0fhx9s.htm var _oJQG = {    dColumns: null,   bCreated: false,   oMessageDiv: null,   oWaitImage: null,   oRequest: {}, //Object that holds request objects so they can be aborted    //The entries below can be populated during the CreateGrid call   bIsMVC: false,   sId: "grid",   sPager: "pager",   fnRowDoubleClick: function (id, rowIndex, colIndex, evt) { }, //Empty function that is used if one is not supplied   fnCreateGridCallback: null,   fnResizePage: null,   fnPreLoadProcessing: null,   fnPostLoadProcessing: null,   fnApplyCustomClipboardFormatting: null,    //===============================================================================   // Creates the grid.   //===============================================================================   CreateGrid: function (oConfig) {      var i;      //Store passed config properties     if (oConfig) {        //Properties       if (oConfig.hasOwnProperty("bIsMVC")) this.bIsMVC = oConfig["bIsMVC"];       if (oConfig.hasOwnProperty("sId")) this.sId = oConfig["sId"];       if (oConfig.hasOwnProperty("sPager")) this.sPager = oConfig["sPager"];        //Functions       if (oConfig.hasOwnProperty("fnRowDoubleClick")) this.fnRowDoubleClick = oConfig["fnRowDoubleClick"];       if (oConfig.hasOwnProperty("fnCreateGridCallback")) this.fnCreateGridCallback = oConfig["fnCreateGridCallback"];       if (oConfig.hasOwnProperty("fnResizePage")) this.fnResizePage = oConfig["fnResizePage"];       if (oConfig.hasOwnProperty("fnPreLoadProcessing")) this.fnPreLoadProcessing = oConfig["fnPreLoadProcessing"];       if (oConfig.hasOwnProperty("fnPostLoadProcessing")) this.fnPostLoadProcessing = oConfig["fnPostLoadProcessing"];       if (oConfig.hasOwnProperty("fnApplyCustomClipboardFormatting")) this.fnApplyCustomClipboardFormatting = oConfig["fnApplyCustomClipboardFormatting"];     }      //If the user settings are not yet ready to use then drop out of this method and reattempt in 50ms (this would only ever happen if loading settings from jStorage rather than cookies - rare)     if ((_oJQGUserSettings == null) || (_oJQGUserSettings.bReadyToUse == false)) {        //Use anonymous function to call CreateGrid on the _oJQG object again       setTimeout(function () {         _oJQG.CreateGrid();       }, 25);       return;     }      //Get Grid     var $Grid = $('#' + this.sId);      //Populate columns dictionary based on _oJQGUserSettings.aColModel and _oJQGProperties.aExtraDataColumns - THIS MUST BE DONE FIRST AS IS USED LATER IN THE METHOD     this.dColumns = {};      for (i = 0; i &lt; _oJQGUserSettings.aColModel.length; i++) {       this.dColumns[_oJQGUserSettings.aColModel[i].name] = i;     }      //Ensure that the dColumns dictionary is populated with any extra data columns     for (i = 0; i &lt; _oJQGProperties.aExtraDataColumns.length; i++) {       this.dColumns[_oJQGProperties.aExtraDataColumns[i]] = (i + _oJQGUserSettings.aColModel.length);     }      //Initialise grid     $Grid.jqGrid({       // setup custom parameter names to pass to server       prmNames: {         nd: null,         rows: "iPageSize",         page: "iPage",         totalrows: "iMaxRecords",         sort: "sSortField",         order: "sSortOrder"       },        // add by default to avoid webmethod parameter conflicts       postData: { dSearchOptions: {}, aOriginalColumnDefinition: _oJQGUserSettings.aColModel, aExtraDataColumns: _oJQGProperties.aExtraDataColumns },        // retrieves data for grid - initialised to local to allow create to be visually created without loading data       datatype: 'local',        altRows: true, //Activate alternate rows       colNames: _oJQGUserSettings.aColNames,       colModel: _oJQGUserSettings.aColModel, //defines the individual grid columns as an array of properties http://www.secondpersonplural.ca/jqgriddocs/_2eb0fihps.htm       gridview: true, //When we use the option gridview set to true it is possibe to speed the reading process from 5-10 times. This is achieved by reading the data at once. This mode has some limitations - it is not possible to use treeGrid, subGrid and afterInsertRow (event).       loadui: _oJQGProperties.sWaitType, //determines user interaction during search       ondblClickRow: this.fnRowDoubleClick, //Function called when a row is double clicked on       onSortCol: JQGridColumnSort, //Function called on sort       pager: '#' + this.sPager,       rowList: _oJQGProperties.aPageSizes,       rowNum: _oJQGUserSettings.iPageSize,       rowTotal: _oJQGProperties.iMaxRecords,       shrinkToFit: false, //Ensures that Grid does not resize columns to fill grid space       sortable: true, //Enables drag/drop/reorder columns       sortname: ((_oJQGUserSettings.sSortName.length &gt; 0) ? _oJQGUserSettings.sSortName : ((_oJQGProperties.sDefaultSortName != null) ? _oJQGProperties.sDefaultSortName : '')), //Attempt to use sort name / order unless blank, in which case attempt to use the default if available, failing that empty string       sortorder: ((_oJQGUserSettings.sSortOrder.length &gt; 0) ? _oJQGUserSettings.sSortOrder : ((_oJQGProperties.sDefaultSortOrder != null) ? _oJQGProperties.sDefaultSortOrder : '')),       viewrecords: true, //Defines whether we want to display the number of total records from the query in the pager bar       viewsortcols: [true, 'horizontal', false] //[Show sortable column icons at all times: true / false, Icon placement: 'vertical' (on top of each other) / 'horizontal' (next to each other), Click functionality - if true the columns are sorted if the header is clicked but if false the columns are sorted only when the icons are clicked)]     });      //Set custom column headers if required     if (_oJQGUserSettings.aColHeaders.length &gt; 0) this.SetCustomColumnHeaders($Grid);      //Set which pager controls should be visible      $Grid.jqGrid('navGrid', '#' + this.sPager, { add: false, edit: false, del: false, search: false, refresh: false });      //Add column chooser control if property set     if (_oJQGProperties.bAddColumnChooser) {       //Add Column Chooser control       $Grid.jqGrid('navButtonAdd', '#' + this.sPager, {         caption: _oJQGProperties.sCaptionColumns,         title: _oJQGProperties.sCaptionColumnsReorder,         onClickButton: function () {           $Grid.jqGrid('columnChooser', {             width: 600,             height: 270,             done: function (perm) {               if (perm) {                  //Remap columns with new order                 this.jqGrid("remapColumns", perm, true);                  //Save grid definition                 _oJQG.SaveGridDefinition(this, this.jqGrid('getGridParam', 'sortname'), this.jqGrid('getGridParam', 'sortorder'));               }             }           });         }       });     }      //Add copy to clipboard button     $Grid.jqGrid('navButtonAdd', '#' + this.sPager, {       caption: _oJQGProperties.sCaptionClipboard,       buttonicon: 'ui-icon-clipboard',       title: _oJQGProperties.sCaptionClipboard,       onClickButton: function () {         _oJQG.CopyToClipboard();       }     });      //Initialise Loading... image     var ts = $("#" + this.sId + ".ui-jqgrid-btable")[0];     var oDiv = $("#load_" + ts.p.id)[0];     oDiv.style.marginLeft = _oJQGProperties.sLoadingPanelMarginLeft;     oDiv.style.marginTop = _oJQGProperties.sLoadingPanelMarginTop;     oDiv.style.opacity = "0.80";     oDiv.style.filter = 'alpha(opacity=80)';     oDiv.innerHTML = ""; //Clear "Loading..." text      this.oWaitImage = $('&lt;img /&gt;').attr('src', _oJQGProperties.sLoadingImage).attr('style', 'padding: 60px 100px 60px 100px;'); //Preload image     this.oMessageDiv = $('&lt;div /&gt;').attr('style', 'width:166px; padding: 60px 50px 60px 50px;');      this.oWaitImage.appendTo(oDiv); //Set image     this.oMessageDiv.appendTo(oDiv); //Add message Div      //Set bCreated flag     this.bCreated = true;      //Trigger callback if it exists     if (this.fnCreateGridCallback) this.fnCreateGridCallback();   },    //===============================================================================   // Populates the grid.  If called for the first time then the grid changes the datatype first   //===============================================================================   PopulateGrid: function () {      //Perform pre load processing if a function is defined     if (this.fnPreLoadProcessing) this.fnPreLoadProcessing();      var $Grid = $('#' + this.sId);      //In case a message was being displayed to users hide it     this.LoadingPanelHide(this.sId);      //Load data for grid     $Grid.setGridParam({       datatype: GetJQGridData,       page: 1     }).trigger('reloadGrid');   },    //===============================================================================   // Builds up a SearchOptions object based on the aParameters array.  This is    //   used to pass data back to the webmethod / pagemethod   //===============================================================================   GetSearchOptions: function (aParameters) {      var oSearchOptions = {};      //Loop through parameters building up SearchOptions     for (var i = 0; i &lt; aParameters.length; i++) {        //Split by "|" character.  The second parameter will determine how to extract the value       var aParameter = aParameters[i].split('|');       var sParameterName = aParameter[0];       var sParameterType = aParameter[1].toLowerCase();       var sValue = "";        switch (sParameterType) {         case "value":           sValue = $("#" + sParameterName).val();           break;          case "dialogarguments":           sValue = window.dialogArguments[sParameterName];           break;          case "picker":           sValue = _oPicker.GetSelectedId(sParameterName);           break;          case "datepicker":           sValue = DateToSystemDateString($("#" + sParameterName).datepicker("getDate"));           break;          case "radiobutton":           sValue = $("input[name='" + sParameterName + "']:checked").val();           break;          case "checked":           sValue = $('#' + sParameterName).prop("checked");           break;          default:           //If not of set type then take the type as an explicit value           sValue = sParameterType;           break;       }        //Add the search option       oSearchOptions[sParameterName] = sValue;     }      return oSearchOptions;   },    //===============================================================================   // Save GridDefinition to Cookie / localStorage   //===============================================================================   SaveGridDefinition: function ($Grid, sSortName, sSortOrder) {      //Write out Cookie containing grid definition information     var sVersion = _oJQGUserSettings.sVersion;     var aColumnList = [];     var iPageSize = $Grid.jqGrid('getGridParam', 'rowNum');     var aColModel = $Grid.jqGrid('getGridParam', 'colModel');      $.each(aColModel, function (i) {        aColumnList.push(this.name + "|" + this.width + "|" + ((this.hidden == true) ? '0' : '1'));      });      var sColumnList = aColumnList.join("~");      var oUserSettings = {       sVersion: sVersion,       sColumnList: sColumnList,       sSortName: sSortName,       sSortOrder: sSortOrder,       iPageSize: ((iPageSize &gt; 100) ? 100 : iPageSize) //Maximum page size to save to cookie of 100     };      //Stringify object     var sUserSettings = JSON.stringify(oUserSettings);      //Write to Cookie     $.cookie(_oJQGProperties.sCookieName, sUserSettings, { expires: 28 });      //Save to userdata / local storage just in case the user is experiencing the "Commerzbank Cookie problem"     $.jStorage.set(_oJQGProperties.sCookieName, oUserSettings);   },    //===============================================================================   // Attempt to reload user settings - this is only intended to cater for users experiencing the "Commerzbank Cookie problem"   //===============================================================================   AttemptToReloadUserSettings: function () {      //Attempt to retrieve user settings from jStorage     var oUserSettings = $.jStorage.get(_oJQGProperties.sCookieName, null);      //If obtained then reload UserSettings     if (oUserSettings != null) {        //If a call is in process then abort it before a new one is started       if (this.oRequest[_oJQGProperties.sURLJSONUserSettings] != null) {         try {           this.oRequest[_oJQGProperties.sURLJSONUserSettings].abort();         }         catch (e) {         }       }        //Perform AJAX call and store jqXHR Object so it can be aborted later if necessary       this.oRequest[_oJQGProperties.sURLJSONUserSettings] = $.ajax(_oJQGProperties.sURLJSONUserSettings, //URL of WebService/PageMethod used to get the JSON user settings from a supplied dictionary         {         data: JSON.stringify({ dUserSettings: oUserSettings, sGridDefinitionFile: _oJQGProperties.sGridDefinitionFile }),         type: "POST",         contentType: "application/json",         complete: function (oJSONData, sStatus) {            //Wipe the jqXHR object (direct reference to _oJQG because context changed at this point)           _oJQG.oRequest[_oJQGProperties.sURLJSONUserSettings] = null;            if (sStatus === "success") {              var oData = JSON.parse(oJSONData.responseText);              //Save to UserSettings ready for use             //Data stored in "d" because of ASP.NET AJAX security measure             //Eval is necessary to return this to an object (http://www.json.org/js.html)             //This is not ideal as effectively there is a double eval taking place with the JSON.parse and then the eval below purely because ASP.NET seems unwilling to pass this as an object and will only pass this JSON as a string             //There seems to be no *nice* way around this and so for reasons of simplicity this has been left as is to avoid confusion for others looking at this             //Arguably this is not a massive problem as this call will only be made in exceptional circumstances             _oJQGUserSettings = eval('(' + oData.d + ')');            }           else if (sStatus === "abort") {             //Do nothing           }           else {              //Failed so alert user that will revert to defaults             alert("Failed to load saved grid settings because: " + sStatus + "\r\n\r\nWill revert to default grid settings.")              //Set flag to true so grid is used with defaults             _oJQGUserSettings.bReadyToUse = true;            }         }       });     }     else {        //User settings were not obtained so set flag to true so grid is used with defaults       _oJQGUserSettings.bReadyToUse = true;     }   },    //===============================================================================   // Perform jobs before the grid loads (eg show "loading" message)   //===============================================================================   ShowMessage: function (sMessage) {      //Hide Loading image     this.oWaitImage.hide();      //Show the message     this.oMessageDiv.html(sMessage);     this.oMessageDiv.show();      //Show LoadingPanel     this.LoadingPanelShow(this.sId);   },    //===============================================================================   // Perform jobs before the grid loads (eg show "loading" message)   //===============================================================================   HideMessage: function (sGridName, sMessage) {      //Hide Loading image     this.oWaitImage.show();      //Show the message     this.oMessageDiv.hide();      //Show LoadingPanel     this.LoadingPanelHide(sGridName);   },    //===============================================================================   // Perform jobs before the grid loads (eg show "loading" message)   //===============================================================================   BeginGridRequest: function (sGridName) {      //Hide Message/Show Loading image     this.oMessageDiv.hide();     this.oWaitImage.show();      this.LoadingPanelShow(sGridName);   },    //===============================================================================   // Show LoadingPanel   //===============================================================================   LoadingPanelShow: function (sGridName) {      var ts = $("#" + sGridName + ".ui-jqgrid-btable")[0];     if (!ts.grid.hDiv.loading) {       ts.grid.hDiv.loading = true;       if (ts.p.hiddengrid) { return; }       switch (ts.p.loadui) {         case "disable":           break;         case "enable":           $("#load_" + ts.p.id).show();           break;         case "block":           $("#lui_" + ts.p.id).show();           $("#load_" + ts.p.id).show();           break;       }     }   },    //===============================================================================   // Perform jobs after the grid loads (eg hide "loading" message)   //===============================================================================   EndGridRequest: function (sGridName) {      this.LoadingPanelHide(sGridName);   },    //===============================================================================   // Hide LoadingPanel   //===============================================================================   LoadingPanelHide: function (sGridName) {      var ts = $("#" + sGridName + ".ui-jqgrid-btable")[0];     if (ts.grid.hDiv.loading) {       ts.grid.hDiv.loading = false;       if (ts.p.hiddengrid) { return; }       switch (ts.p.loadui) {         case "disable":           break;         case "enable":           $("#load_" + ts.p.id).hide();           break;         case "block":           $("#lui_" + ts.p.id).hide();           $("#load_" + ts.p.id).hide();           break;       }     }   },    //===============================================================================   // Copy the contents of the grid to the clipboard   //===============================================================================   CopyToClipboard: function () {      var j, sCell;     var sb = new StringBuilder();      //Show and hide message     this.ShowMessage(_oJQGProperties.sCaptionClipboardCopying);      //Get Headers     for (j = 0; j &lt; _oJQGUserSettings.aColNames.length; j++) {       if (j &gt; 0) sb.append('\t'); //Add tab       sb.append(_oJQGUserSettings.aColNames[j]); //Add column header     }     sb.append('\r\n'); //Add newline      //Get DataIDs     var $Grid = $('#' + this.sId);     var aDataIds = $Grid.getDataIDs();      //Loop through table rows applying colour banding if necessary     for (var i = 0; i &lt; aDataIds.length; i++) {        try {         //Get row         var oRow = $Grid.getRowData(aDataIds[i]);          for (j = 0; j &lt; _oJQGUserSettings.aColModel.length; j++) {           if (j &gt; 0) sb.append('\t'); //Add tab            //Get cell data           sCell = oRow[_oJQGUserSettings.aColModel[j].name];            //Perform custom formatting if a function is defined           if (this.fnApplyCustomClipboardFormatting) sCell = this.fnApplyCustomClipboardFormatting(sCell, _oJQGUserSettings.aColModel[j]);            sb.append(sCell);  //Add data         }       }       catch (e) {         //If wacky stuff in cells then fall back to this         for (j = 0; j &lt; _oJQGUserSettings.aColModel.length; j++) {           if (j &gt; 0) sb.append('\t'); //Add tab            if (_oJQGUserSettings.aColModel[j].formatter == _oJQGFormatters.FormatChangeLogValue) {             //If this is a FormatChangeLogValue field - cannot be copied to clipboard due to formatting             sCell = "Cannot be copied to clipboard due to formatting";           }           else {             //Get cell data             sCell = $Grid.getCell(aDataIds[i], _oJQGUserSettings.aColModel[j].name);           }            sb.append(sCell);  //Add data         }        }        sb.append('\r\n'); //Add newline     }      SetClipboardText(sb.toString());      //Hide message after 1 second     setTimeout(function () {       _oJQG.LoadingPanelHide(_oJQG.sId);     }, 1000);    },    //==============================================================================   // Get selected ID from grid (if set)   //==============================================================================   GetSelectedId: function () {      var $Grid = $('#' + this.sId);     var iRowID = $Grid.getGridParam("selrow");      if (iRowID)       return iRowID;     else       return null;   },    //===============================================================================   // Set column headers   //===============================================================================   SetCustomColumnHeaders: function ($Grid) {      //Loop through custom column headers     for (var i = 0; i &lt; _oJQGUserSettings.aColHeaders.length; i++) {        var oColumnHeader = _oJQGUserSettings.aColHeaders[i];        //Call the relevant column header formatter function to set the custom column headers       switch (oColumnHeader.formatter) {          case "salesstatusheadertablecell":           $Grid.setLabel(oColumnHeader.name, _oJQGFormatters.FormatHeaderSalesStatus(_oJQGUserSettings.aColNames[this.dColumns[oColumnHeader.name]], oColumnHeader), "");           break;          case "tradingstatusupdateableheadertablecell":           $Grid.setLabel(oColumnHeader.name, _oJQGFormatters.FormatHeaderTradingStatusUpdateable(_oJQGUserSettings.aColNames[this.dColumns[oColumnHeader.name]], oColumnHeader), "");           break;          case "rejectreasonheadertablecell":           $Grid.setLabel(oColumnHeader.name, _oJQGFormatters.FormatHeaderRejectReason(_oJQGUserSettings.aColNames[this.dColumns[oColumnHeader.name]], oColumnHeader), "");           break;        }     }   } };   //=============================================================================== // Formatters encapsulated in _oJQGFormatters object //===============================================================================  var _oJQGFormatters = {   //===============================================================================   // FormatLocalDateTime function - dependant on Globalize library   //===============================================================================   FormatLocalDateTime: function (sCellValue, oOptions, oRow) {      if ($.trim(sCellValue).length === 0)       return "&amp;nbsp;";     else {        //var dteDate = new Date(parseInt(sCellValue, 10)); JSON Date       var aDate = sCellValue.split("|");       var dteDate = new Date(aDate[0], aDate[1], aDate[2], aDate[3], aDate[4], aDate[5], aDate[6]);        return Globalize.format(dteDate, Globalize.culture().calendar.patterns["d"] + " " + Globalize.culture().calendar.patterns["t"]);     }   },    //===============================================================================   // FormatLocalDate function - dependant on Globalize library   //===============================================================================   FormatLocalDate: function (sCellValue, oOptions, oRow) {      if ($.trim(sCellValue).length == 0)       return "&amp;nbsp;";     else {        //var dteDate = new Date(parseInt(sCellValue, 10)); //JSON Date       var aDate = sCellValue.split("|");       var dteDate = new Date(aDate[0], aDate[1], aDate[2]);        return Globalize.format(dteDate, Globalize.culture().calendar.patterns["d"]);     }   },    //===============================================================================   // FormatText function    //   - only necessary for ie 6 and 7 to get round cell border bug in these browsers when rendering empty cells   //===============================================================================   FormatText: function (sCellValue, oOptions, oRow) {      if ($.trim(sCellValue).length === 0)       return "&amp;nbsp;";     else       return sCellValue;   },    //===============================================================================   // FormatLink function    //===============================================================================   FormatLink: function (sCellValue, oOptions, oRow) {      //Add link?     if ($.trim(sCellValue).length === 0)       return "&amp;nbsp;";     else {        var sHref = oOptions.colModel.link.format(sCellValue),         sHtml = oRow[_oJQG.dColumns[oOptions.colModel.textfield]];        //If this is a javascript URL then make use of OnClick       return (oOptions.colModel.link.indexOf('javascript') !== -1)         ? "&lt;a href=\"javascript:void(0);\" onclick=\"" + sHref + "\"&gt;" + sHtml + "&lt;/a&gt;"         : "&lt;a href=\"" + sHref + "\"&gt;" + sHtml + "&lt;/a&gt;";     }   },    //===============================================================================   // FormatPercent function    //===============================================================================   FormatPercent: function (sCellValue, oOptions, oRow) {      //Transform to percent     var dPercent = parseFloat(sCellValue) * 100;      //Return integer of float to strip off decimal places     return parseInt(dPercent, 10);   },    //===============================================================================   // FormatNumericTextBox function   //===============================================================================   FormatNumericTextBox: function (sCellValue, oOptions, oRow) {      //Use javascript regular expression to render localisation specific decimal separators (replacing ".")     var sLocalised = sCellValue.replace(".", oOptions.colModel.decimalSeparator);      //Render input textbox     return "&lt;input type=\"text\" id=\"NumericTextBox" + oOptions.rowId + "\" value=\"" + sLocalised + "\" class=\"txtControl\" style=\"text-align:right;\" /&gt;&amp;nbsp;";   } }  //=============================================================================== // The functions below are callbacks and so sit outside _oJQG because  // they could not access _oJQG using the "this" keyword if they sat inside it //===============================================================================  //=============================================================================== // Get data for grid from AJAX call. NB This is a callback and so _oJQG. referred to directly rather than this. //=============================================================================== var GetJQGridData = function (oPostData) {    var sJSONData;   var $Grid = $('#' + _oJQG.sId);    //Show "Loading"   _oJQG.BeginGridRequest(_oJQG.sId);    //Get latest SearchOptions / sort settings   oPostData.dSearchOptions = _oJQG.GetSearchOptions(_oJQGProperties.aSearchOptionParameters);   oPostData.sSortField = $Grid.jqGrid('getGridParam', 'sortname');   oPostData.sSortOrder = $Grid.jqGrid('getGridParam', 'sortorder');    //If a call is in process then abort it before a new one is started   if (_oJQG.oRequest[_oJQGProperties.sURL] != null) {      try {       _oJQG.oRequest[_oJQGProperties.sURL].abort();     }     catch (e) {     }   }    //Currently there is a deserialization bug in MVC (http://connect.microsoft.com/VisualStudio/feedback/details/636647/make-jsonvalueproviderfactory-work-with-dictionary-types-in-asp-net-mvc)   //This is a workaround until it is fixed.   if (_oJQG.bIsMVC) {      // Deep copy     var oPostDataCopy = $.extend(true, {}, oPostData);      oPostDataCopy.dSearchOptions = JSON.stringify(oPostDataCopy.dSearchOptions);     oPostDataCopy.aOriginalColumnDefinition = JSON.stringify(oPostDataCopy.aOriginalColumnDefinition);     oPostDataCopy.aExtraDataColumns = JSON.stringify(oPostDataCopy.aExtraDataColumns);      sJSONData = JSON.stringify(oPostDataCopy);    }   else {      sJSONData = JSON.stringify(oPostData);   }    //Perform AJAX call and store jqXHR Object so it can be aborted later if necessary   _oJQG.oRequest[_oJQGProperties.sURL] = $.ajax(_oJQGProperties.sURL, //URL of WebService/PageMethod used to populate the grid     {       data: sJSONData, // For empty input data use "{}",       type: "POST",       contentType: "application/json",       complete: GetJQGridDataCallback     }); },  //=============================================================================== // Method triggered when the AJAX call completes.  NB This is a callback and so _oJQG. referred to directly rather than this. //=============================================================================== GetJQGridDataCallback =  function (oJSONData, sStatus) {    //Wipe the jqXHR object   _oJQG.oRequest[_oJQGProperties.sURL] = null;       if (sStatus === "abort") {     //Do nothing   }   else {          //Translate JSON response into object     var oData = JSON.parse(oJSONData.responseText);     var $Grid = $('#' + _oJQG.sId); //Get grid      if (sStatus === "success") {        var oGridData = ((_oJQG.bIsMVC)          ? oData         : oData.d //Data stored in "d" because of ASP.NET AJAX security measure         );        //Populate grid with data       $Grid[0].addJSONData(oGridData);        //Perform post load processing if a function is defined       if (_oJQG.fnPostLoadProcessing) _oJQG.fnPostLoadProcessing($Grid, oGridData);        //Maximise grid       if (_oJQG.fnResizePage) _oJQG.fnResizePage();        //Save grid definition       _oJQG.SaveGridDefinition($Grid, $Grid.jqGrid('getGridParam', 'sortname'), $Grid.jqGrid('getGridParam', 'sortorder'));        //Hide "Loading"       _oJQG.EndGridRequest(_oJQG.sId);     }     else {        //Common cause of timeouts is sort criteria - so switch to the defaults       if ((_oJQGProperties.sDefaultSortName != null) &amp;&amp; (_oJQGProperties.sDefaultSortOrder != null)) {          //Set grid criteria back to defaults         $Grid.setGridParam({           sortname: _oJQGProperties.sDefaultSortName,           sortorder: _oJQGProperties.sDefaultSortOrder//,           //((_oJQGProperties.aPageSizes.length &gt; 0) ? _oJQGProperties.aPageSizes[0] : 100) - COMMENTED OUT FOR NOW; BRING BACK IF SEEMS USEFUL         });          //Set grid search image         $Grid.sortGrid(_oJQGProperties.sDefaultSortName, false);       }        var sError = _oJQGProperties.sCaptionDefaultErrorMessage;       try {          //Extract user friendly error if available         if (oData.Message !== "There was an error processing the request.") sError = oData.Message;       }       catch (e) {       }        //Inform user of error       _oJQG.ShowMessage(sError)     }   } },  //=============================================================================== // What to do when sorting by column - event is called just after clicking to sort but before actual sorting... //=============================================================================== JQGridColumnSort = function (sSortName, iCol, sSortOrder) {    var sSortNameToUse = sSortName;    //If sSortName has been prefixed with the grid id (eg does it look like this: "grid_TradeDate") then chop off prefix   if (sSortName.indexOf(this.id + "_") !== -1) {     sSortNameToUse = sSortName.split("_")[1];   }    //Change the sort name / sort order variables   _oJQGUserSettings.sSortName = _oJQGUserSettings.aColModel[_oJQG.dColumns[sSortNameToUse]].index;   _oJQGUserSettings.sSortOrder = sSortOrder;    //Perform pre load processing if a function is defined   if (_oJQG.fnPreLoadProcessing) _oJQG.fnPreLoadProcessing(); }  </content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8539690246003820676'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/8539690246003820676'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2842532742205514326</id><published>2012-02-29T12:06:00.000Z</published><updated>2012-02-29T12:06:44.019Z</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>pubsub validation gui implementation</title><content type='html'>ValidationExtension:  using Commerzbank.PCS.Data; using Commerzbank.PCS.Web.Shared; using System; using System.Collections.Generic; using System.ComponentModel.DataAnnotations; using System.IO; using System.Linq; using System.Linq.Expressions; using System.Web.Mvc; using System.Web.Mvc.Html; using System.Web.WebPages; using System.Web.Routing; using System.Web.Script.Serialization;  namespace Commerzbank.PCS.Web.Helpers {   /// &lt;summary&gt;  /// MVC HtmlHelper extension methods - html element extensions   /// &lt;/summary&gt;  public static class ValidationExtensions   {     /// &lt;summary&gt;    /// Render a Validation Dialog     /// &lt;/summary&gt;    /// &lt;param name="helper"&gt;&lt;/param&gt;    /// &lt;param name="id"&gt;&lt;/param&gt;    /// &lt;param name="htmlAttributes"&gt;&lt;/param&gt;    /// &lt;param name="validationDialogCssClass"&gt;&lt;/param&gt;    /// &lt;param name="okButtonCssClass"&gt;&lt;/param&gt;    /// &lt;param name="headerMessage"&gt;&lt;/param&gt;    /// &lt;returns&gt;&lt;/returns&gt;    public static MvcHtmlString ValidationDialog(this HtmlHelper helper, string id,        object htmlAttributes = null,       string cssClass = null, int? minHeight = null, //string okButtonCssClass = null,        string validationDialogTitle = null, string headerMessage = null)     {       //Render div container       var container = new TagBuilder("div");       container.Attributes["id"] = id;       container.Attributes["style"] = "display:none;"; //Validation dialog is initially hidden so the user doesn't see the "flash" as        container.Attributes["data-title"] = string.IsNullOrEmpty(validationDialogTitle) ? "Validation errors" : validationDialogTitle;       container.Attributes["data-caption-ok"] = SharedLib.GetResourceString("BUTTON_OK");       container.Attributes["data-min-height"] = minHeight.HasValue ? minHeight.Value.ToString() : "150";       if (htmlAttributes != null) container.MergeAttributes(HtmlHelper.AnonymousObjectToHtmlAttributes(htmlAttributes)); //Merge any passed in attributes        //Render span which is the header message above the error messages       var span = new TagBuilder("span");       span.InnerHtml = string.IsNullOrEmpty(headerMessage) ? "Please correct the following:" : headerMessage;       span.Attributes["class"] = string.IsNullOrEmpty(cssClass) ? "validationDialog" : cssClass;       container.InnerHtml += MvcHtmlString.Create(span.ToString());        //Render ul - this will contain error messages       var ul = new TagBuilder("ul");       ul.Attributes["class"] = string.IsNullOrEmpty(cssClass) ? "validationDialog" : cssClass;       container.InnerHtml += MvcHtmlString.Create(ul.ToString());              /*       //Render ok button - this will allow users to close the dialog       var okButton = new TagBuilder("input");       okButton.Attributes["type"] = "button";       okButton.Attributes["value"] = SharedLib.GetResourceString("BUTTON_OK");       okButton.Attributes["class"] = string.IsNullOrEmpty(okButtonCssClass) ? "btnProminent" : okButtonCssClass;       okButton.Attributes["style"] = "width:" + SharedLib.GetResourceString("BUTTON_OK_WIDTH") + ";margin-left:auto; margin-right:auto;";       container.InnerHtml += MvcHtmlString.Create(okButton.ToString(TagRenderMode.SelfClosing));       */        //Render validation related scripts       helper.AddClientScript(SharedLib.ScriptPath + "ValidationDialog-1.0.0.js");       helper.AddClientScript(SharedLib.URLjQueryValidate, 7);       helper.AddClientScript(SharedLib.URLjQueryValidateUnobtrusive, 7);       helper.AddClientScript(SharedLib.URLjQueryValidateUnobtrusivePCS, 7);       //A library which overrides part of the functionality of URLjQueryValidateUnobtrusive to add PCS specific behaviour       helper.AddClientScript(SharedLib.URLjQueryValidateUnobtrusiveExtension, 8); //PCS extension allowing dynamic inputs to be wired up for validation              return MvcHtmlString.Create(container.ToString());     }   } }  ValidationDialog.js:  $(document).ready(function () {    var $ValidationDialog = $("#ValidationDialog"),     $selects = $("select"); //Get all selects on screen    //   // Create Validation Dialog   //   $ValidationDialog     .show()     .dialog({       autoOpen: false,       buttons: [           {             text: $ValidationDialog.data("captionOk"),             click: function () {                //Close the dialog               $(this).dialog("close");                //Show all selects that were hidden when the dialog opened               $selects.show();             }           }       ],       closeOnEscape: true,       minHeight: $ValidationDialog.data("minHeight"),       modal: true,       open: function (evt, ui) {          //Hide all selects - in place because of IE select zIndex bug         $selects.hide();       },       resizable: true,       title: $ValidationDialog.data("title")     }); //.parent().appendTo($contents);    //   // Subscribe to any published validate error messages so they are rendered into the GUI   //   $.subscribe("PCS.Validation.ErrorMessages", function (evt, aErrorMessages) {      //Render failures to screen     $ValidationDialog       .children("ul")       .html("&lt;li&gt;" + aErrorMessages.join("&lt;/li&gt;&lt;li&gt;") + "&lt;/li&gt;");      //Show dialog if not already visible     if (!$ValidationDialog.dialog("isOpen")) { $ValidationDialog.dialog("open"); }   });    /*   //   // Assign OK button click event handler to close dialog   //   $ValidationDialog.children("input:button").click(function (evt) {      $ValidationDialog.dialog("close");   });   */ });  Override default behaviour from unobtrusive JavaScript:  //=============================================================================== // Method called when DOM loaded //=============================================================================== $(document).ready(function () {    /// &lt;summary&gt;  /// Display form validation errors in an alert box. PCS specific behavior    /// &lt;/summary&gt;  /// &lt;param name="form"&gt;&lt;/param&gt;  /// &lt;param name="validator"&gt;&lt;/param&gt;  $("form").bind("invalid-form.validate", function (form, validator) {      var aErrorMessages = [];     for (var name in validator.errorList) {            aErrorMessages.push(validator.errorList[name].message);      }      //Publish "PCS.Validation.ErrorMessages" so error messages can be displayed nicely to the user     $.publish("PCS.Validation.ErrorMessages", [aErrorMessages]);   }); });  jquery.ba-tinypubsub.js  Generated dialog HTML:  &lt;div data-caption-ok="OK" data-min-height="200" data-title="This is our Validation Dialog" id="ValidationDialog" style="display:none;"&gt;&lt;span class="validationDialog"&gt;Please address the following:&lt;/span&gt;&lt;ul class="validationDialog"&gt;&lt;/ul&gt;&lt;/div&gt; Links for HtmlHelperScriptExtensions:    /// http://frugalcoder.us/post/2009/06/29/Handling-Scripts-in-ASPNet-MVC.aspx   /// http://stackoverflow.com/questions/5598167/mvc3-need-help-with-html-helper   &lt;div class="separator" style="clear: both; text-align: center;"&gt;How the validation dialog looks:&lt;br /&gt;&lt;a href="http://3.bp.blogspot.com/-PQjAW4opwt8/T04Uc8DTl5I/AAAAAAAAAKI/8To_hHmYrJI/s1600/Validation-Screenshot.png" imageanchor="1" style="margin-left:1em; margin-right:1em"&gt;&lt;img border="0" height="208" width="308" src="http://3.bp.blogspot.com/-PQjAW4opwt8/T04Uc8DTl5I/AAAAAAAAAKI/8To_hHmYrJI/s320/Validation-Screenshot.png" /&gt;&lt;/a&gt;&lt;/div&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2842532742205514326'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/2842532742205514326'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='http://3.bp.blogspot.com/-PQjAW4opwt8/T04Uc8DTl5I/AAAAAAAAAKI/8To_hHmYrJI/s72-c/Validation-Screenshot.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1978473549612375932</id><published>2012-02-29T09:36:00.001Z</published><updated>2012-02-29T09:36:17.653Z</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Testing ViewModel can be constructed from JSON</title><content type='html'>Test only endpoints  Action method      public JsonResult AddUpdateProductType(DetailsProductType detailsViewModel)     {       JsonResult response;        var errorMessages = CheckModelStateAndReturnAnyErrorMessages(detailsViewModel);       if (errorMessages.Count &gt; 0)       {         Response.StatusCode = (int)System.Net.HttpStatusCode.BadRequest;         response = new JsonResult { Data = new { Messages = errorMessages } };       }       else       {         try         {           //Create ProductType from ProductTypeDetailsViewModel           var productType = new ProductType()           {             ProductTypeId = detailsViewModel.ProductTypeId,             Name = detailsViewModel.Name,             ParentProductTypeId = detailsViewModel.ParentProductTypeId,             IsActive = detailsViewModel.IsActive //IsEnabled will become IsActive during v20           };            //Add or update product type           bool isUpdate = (productType.ProductTypeId &gt; -1);           if (isUpdate)             _productTypeDb.UpdateProductType(_sharedLib.UserId, productType);           else             _productTypeDb.AddProductType(_sharedLib.UserId, productType);            //If child product types have been changed then update them if so           var currentChildProductTypeIds = GetChildProductTypeIds(productType.ProductTypeId);           if (currentChildProductTypeIds != detailsViewModel.ChildProductTypeIds)           {             var deselectedChildProductTypeIds = currentChildProductTypeIds.Where(id =&gt; !detailsViewModel.ChildProductTypeIds.Contains(id));             foreach (var deselectedChildProductTypeId in deselectedChildProductTypeIds)             {               var deselectedChildProductType = GetProductType(deselectedChildProductTypeId);                //This ProductType is no longer a child of the current ProductType so remove its parent               deselectedChildProductType.ParentProductTypeId = null;                //Update amended ProductType               _productTypeDb.UpdateProductType(SharedLib.UserId, deselectedChildProductType);             }              //Iterated through each existing ProductType and either set or unset the ParentProductType             if (!detailsViewModel.ChildProductTypeIds.IsNullOrEmpty())             {               foreach (int selectedChildProductTypeId in detailsViewModel.ChildProductTypeIds)               {                 var selectedChildProductType = GetProductType(selectedChildProductTypeId);                  //This ProductType is set as a child of the current ProductType currently being edited                 selectedChildProductType.ParentProductTypeId = productType.ProductTypeId;                  //Update amended ProductType                 _productTypeDb.UpdateProductType(SharedLib.UserId, selectedChildProductType);               }             }           }            //If child product sub types have been changed then update them if so           var currentChildProductSubTypeIds = GetChildProductSubTypeIds(productType.ProductTypeId);           if (currentChildProductSubTypeIds != detailsViewModel.ChildProductSubTypeIds)           {             var deselectedChildProductSubTypeIds = currentChildProductSubTypeIds.Where(id =&gt; !detailsViewModel.ChildProductSubTypeIds.Contains(id));             foreach (var deselectedChildProductSubTypeId in deselectedChildProductSubTypeIds)             {               var deselectedChildProductSubType = GetProductSubType(deselectedChildProductSubTypeId);                //This ProductSubType is no longer a child of the current ProductType so assign it to the Unknown ProductType               deselectedChildProductSubType.ProductTypeId = (int)ProductTypeConst.Unknown;                //Update amended ProductSubType               _productSubTypeDb.UpdateProductSubType(SharedLib.UserId, deselectedChildProductSubType);             }              //Iterated through each existing ProductSubType and either set or unset the ParentProductSubType             if (!detailsViewModel.ChildProductSubTypeIds.IsNullOrEmpty())             {               foreach (int selectedChildProductSubTypeId in detailsViewModel.ChildProductSubTypeIds)               {                 var selectedChildProductSubType = GetProductSubType(selectedChildProductSubTypeId);                  //This ProductSubType is set as a child of the current ProductType currently being edited                 selectedChildProductSubType.ProductTypeId = productType.ProductTypeId;                  //Update amended ProductType                 _productSubTypeDb.UpdateProductSubType(SharedLib.UserId, selectedChildProductSubType);               }             }           }            //Log           _webLogger.MvcLog("ProductType " + productType.Name + " with ProductTypeId: " + productType.ProductTypeId + (isUpdate ? " updated" : " created"), _sharedLib.FriendlyUserName, _sharedLib.UserId, Request.Url.ToString());            //Pass back newly updated product type so can set screen properties           response = new JsonResult { Data = GetProductType(productType.ProductTypeId) };         }         catch (Exception exc)         {           _webLogger.MvcLogException(new Exception("Problem experienced updating product type", exc), HttpContext.Session, HttpContext.Request);            Response.StatusCode = (int)System.Net.HttpStatusCode.BadRequest;           response = new JsonResult { Data = new { Messages = new List&lt;string&gt;() { _sharedLib.GetResourceString("ERROR_UNKNOWN") } } };         }       }        return response;     }   Test:       [TestMethod]     public void DetailsProductType_can_be_successfully_deserialised_from_JSON()     {       Commerzbank.PCS.Web.PCSAdmin.ViewModels.ProductTypeSubType.DetailsProductType detailsProductType = null;        try       {         //http://stackoverflow.com/questions/8964646/javascriptserializer-and-asp-net-mvc-model-binding-yield-different-results         /*         Examples of JSON'd detailsViewModels:         "{"Mode":2,"ProductTypeId":104,"Name":"Credit","ParentProductTypeId":null,"ParentProductType":"","IsActive":true,"ChildProductTypeIds":[196,192,195,194,204,205,207],"ChildProductSubTypeIds":[]}"         "{"Mode":2,"ProductTypeId":196,"Name":"Credit Derivatives","ParentProductTypeId":104,"ParentProductType":"Credit","IsActive":true,"ChildProductTypeIds":[72],"ChildProductSubTypeIds":[]}"         */          //Take JSON and get an object         var json = "{" +           "\"Mode\":2," +           "\"ProductTypeId\":104," +           "\"Name\":\"Credit\"," +           "\"ParentProductTypeId\":null," +           "\"ParentProductType\":\"\"," +           "\"IsActive\":true," +           "\"ChildProductTypeIds\":[196,192,195,194,204,205,207]," +           "\"ChildProductSubTypeIds\":[]" +           "}";          var serializer = new JavaScriptSerializer();         detailsProductType = serializer.Deserialize&lt;Commerzbank.PCS.Web.PCSAdmin.ViewModels.ProductTypeSubType.DetailsProductType&gt;(json);       }       catch (Exception)       {         //Just consume message       }        //Check deserialisation was successful       Assert.AreNotEqual(null, detailsProductType, "Problem deserialising JSON to ProductTypeSubType.DetailsProductType - if the model has changed you probably want to amend PCSAdmin/Scripts/Views/ProductTypeSubType/DetailsProductType.js also.");        //Test that the parameters are as expected       Assert.AreEqual(2, detailsProductType.Mode);       Assert.AreEqual(104, detailsProductType.ProductTypeId);       Assert.AreEqual("Credit", detailsProductType.Name);       Assert.AreEqual(null, detailsProductType.ParentProductTypeId);       Assert.AreEqual(string.Empty, detailsProductType.ParentProductType);       Assert.AreEqual(true, detailsProductType.IsActive);       CollectionAssert.AreEqual(new int[] { 196, 192, 195, 194, 204, 205, 207 }, detailsProductType.ChildProductTypeIds);       CollectionAssert.AreEqual(new int[0], detailsProductType.ChildProductSubTypeIds);     }</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1978473549612375932'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/1978473549612375932'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-9158586544145694367</id><published>2012-02-23T13:52:00.002Z</published><updated>2021-03-05T17:34:53.659Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Dave Ward'/><category scheme='http://www.blogger.com/atom/ns#' term='json'/><category scheme='http://www.blogger.com/atom/ns#' term='Encosia'/><category scheme='http://www.blogger.com/atom/ns#' term='Christian Heilmann javascript object literal'/><category scheme='http://www.blogger.com/atom/ns#' term='douglas crockford'/><title type='text'>The Joy of JSON</title><content type='html'>So back to JSON.  For those of you that don't know JSON stands for JavaScript Object Notation and is lightweight text based data interchange format.  Rather than quote other people verbatim you can find thorough explanations of JSON here: &lt;ul&gt;&lt;li&gt;&lt;a href="http://www.json.org/" target="_blank"&gt;Introducing JSON&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="http://www.json.org/js.html" target="_blank"&gt;JSON in Javascript&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;br /&gt;As mentioned in my previous &lt;a href="http://icanmakethiswork.blogspot.com/2012/02/potted-history-of-using-ajax-on.html" target="_blank"&gt;post on Ajax&lt;/a&gt; I came upon JSON quite by accident and was actually using it for some time without having any idea.&lt;br /&gt;&lt;br /&gt;But let's pull back a bit.  Let's start with the JavaScript Object Literal.  Some years ago I came upon this article by Christan Heilmann about the JavaScript Object Literal which had been published all the way back in 2006: &lt;a href="http://christianheilmann.com/2006/02/16/show-love-to-the-object-literal/" target="_blank"&gt;Show love to the JavaScript Object Literal&lt;/a&gt;&lt;br /&gt;&lt;br /&gt;Now when I read this it was a revelation to me.  I hadn't really used JavaScript objects a great deal at this point (yes I am one of those people that started using JavaScript without actually learning the thing) and when I had used them is was through the &lt;code&gt;var obj = new Object()&lt;/code&gt; pattern (as that's the only approach I knew).&lt;br /&gt;&lt;br /&gt;So it was wonderful to discover that instead of the needlessly verbose:&lt;br /&gt;&lt;br /&gt;&lt;pre&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;var myCar = new Object();&lt;br /&gt;myCar.wheels = 4;&lt;br /&gt;myCar.colour = "blue";&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;br /&gt;I could simply use the much more concise object literal syntax to declare an object instead:&lt;br /&gt;&lt;br /&gt;&lt;pre&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;var myCar = { wheels: 4, colour: "blue" };&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;br /&gt;Lovely.  Henceforth I adopted this approach in my code as I'm generally a believer that brevity is best.&lt;br /&gt;&lt;br /&gt;It was sometime later that I happened upon JSON (when I started looking into &lt;a href="http://icanmakethiswork.blogspot.com/2012/01/jqgrid-its-just-far-better-grid.html" target="_blank"&gt;jqGrid&lt;/a&gt;).  Basically I was looking to pass complex data structures backward and forward to the server and, as far as I knew, there was no way to achieve this simply in JavaScript.  I was expecting that I would have to manually serialise and deserialise (yes dammit I will use the English spellings!) objects when ever I wanted to do this sort of thing.&lt;br /&gt;&lt;br /&gt;However, I was reading the the fantastic Dave Ward's &lt;a href="http://encosia.com/" target="_blank"&gt;Encosia&lt;/a&gt; blog which on this occasion was talking about the &lt;a href="http://encosia.com/why-aspnet-ajax-updatepanels-are-dangerous/" target="_blank"&gt;troubles of UpdatePanels&lt;/a&gt; (a subject close to my heart by the way) and more interestingly the use of PageMethods in ASP.NET.  This is what he said that made me prick up my ears:&lt;br /&gt;&lt;br /&gt;&lt;i&gt;"Page methods allow ASP.NET AJAX pages to directly execute a pages static methods, using JSON (JavaScript Object Notation). JSON is basically a minimalistic version of SOAP, which is perfectly suited for light weight communication between client and server."&lt;/i&gt;&lt;br /&gt;&lt;br /&gt;JSON is a lightweight SOAP eh?  I've used SOAP.  I wonder if I could use this....&lt;br /&gt;&lt;br /&gt;To my complete surprise, and may I say delight, I discovered that a wonderful fellow called Douglas Crockford, he of &lt;a href="http://www.amazon.co.uk/JavaScript-Good-Parts-Douglas-Crockford/dp/0596517742" target="_blank"&gt;JavaScript, The Good Parts&lt;/a&gt; fame had quietly come up with JSON some time ago.  JSON, from my perspective, turned out to be a simple way to turn an object into a string and then from a string back into an object.  So simple that it consists of 2 methods on a JSON object:&lt;br /&gt;&lt;br/&gt;&lt;ul&gt;&lt;li&gt;JSON.stringify(myObject) - take an object and make me a JSON string. (and by the way isn't "stringify" just the loveliest method name ever?)&lt;/li&gt;&lt;li&gt;JSON.parse(myJSONString) - take a JSON string and make me an object&lt;/li&gt;&lt;/ul&gt;Let me illustrate the above method names using the myCar example from earlier:&lt;br /&gt;&lt;br /&gt;&lt;pre&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;var myCar = { wheels: 4, colour: "blue" };&lt;br /&gt;// myCar is an object&lt;br /&gt;&lt;br /&gt;var myCarJSON = JSON.stringify(myCar);&lt;br /&gt;//myCarJSON will look like this: '{"wheels":4,"colour":"blue"}'&lt;br /&gt;&lt;br /&gt;var anotherCarMadeFromMyJSON = JSON.parse(myCarJSON); &lt;br /&gt;//anotherCarMadeFromMyJSON will be a brand new "car" object&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;br /&gt;I've also demonstrated this using the Chrome Console:&lt;br /&gt;&lt;br /&gt;&lt;div class="separator" style="clear: both; text-align: center;"&gt;&lt;a href="http://1.bp.blogspot.com/-WXd8aSQ0BGE/T0DHsTvFM_I/AAAAAAAAAJ8/PKKB1oBoHks/s1600/Using%2BJSON.png" imageanchor="1" style="margin-left:1em; margin-right:1em"&gt;&lt;img border="0" height="77" width="320" src="http://1.bp.blogspot.com/-WXd8aSQ0BGE/T0DHsTvFM_I/AAAAAAAAAJ8/PKKB1oBoHks/s320/Using%2BJSON.png" /&gt;&lt;/a&gt;&lt;br /&gt;(click on the image to see it a little larger)&lt;/div&gt;&lt;br /&gt;Crockford initially invented/discovered JSON himself and wrote a little helper library which provided a JSON object to be used by all and sundry.  This can be found here: &lt;a href="https://github.com/douglascrockford/JSON-js" target="_blank"&gt;JSON on GitHub&lt;/a&gt;&lt;br /&gt;&lt;br /&gt;Because JSON was so clearly wonderful, glorious and useful it ended up becoming a part of the EcmaScript 5 spec (in fact it's worth reading the brilliant &lt;a href="http://ejohn.org/blog/ecmascript-5-strict-mode-json-and-more/" target="_blank"&gt;John Resig's blog post&lt;/a&gt; on this).  This has lead to JSON being offered &lt;a href="http://en.wikipedia.org/wiki/JSON#Native_encoding_and_decoding_in_browsers" target="_blank"&gt;natively in browsers&lt;/a&gt; for quite some time.  However, for those of us (and I am one alas) still supporting IE 6 and the like we still have Crockfords JSON2.js to fall back on.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/9158586544145694367'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/9158586544145694367'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2012/02/joy-of-json.html' title='The Joy of JSON'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='http://1.bp.blogspot.com/-WXd8aSQ0BGE/T0DHsTvFM_I/AAAAAAAAAJ8/PKKB1oBoHks/s72-c/Using%2BJSON.png' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6048575964366293447</id><published>2012-02-19T10:33:00.001Z</published><updated>2012-02-19T10:33:01.985Z</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>javascript serializer</title><content type='html'>javascript serializer  access to the same objects client side and server side (only really used for file uploads)?  I had been using json For years. And I had no idea. I had never watched the pipe. Firebug. Asp.net Ajax library. It's just object in string format. Stringify. Isn't that the loveliest function name in the world?  AJA-JSON  only send a single string as a return type and unpackaged on the client</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/6048575964366293447'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/6048575964366293447'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-7470875386331997912</id><published>2012-02-15T22:25:00.002Z</published><updated>2021-03-05T17:33:40.041Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='clientCredentialType'/><category scheme='http://www.blogger.com/atom/ns#' term='Security'/><category scheme='http://www.blogger.com/atom/ns#' term='Windows'/><category scheme='http://www.blogger.com/atom/ns#' term='WCF'/><category scheme='http://www.blogger.com/atom/ns#' term='Authentication'/><category scheme='http://www.blogger.com/atom/ns#' term='the server has rejected the client credentials'/><category scheme='http://www.blogger.com/atom/ns#' term='NetTcpBinding'/><title type='text'>WCF Transport Windows authentication using NetTcpBinding in an Intranet environment</title><content type='html'>&lt;h4&gt;Update&lt;/h4&gt;Since I wrote this initial post I've taken thinks on a bit further.  Take a look at this post to see what I mean: &lt;a href="http://icanmakethiswork.blogspot.com/2012/03/wcf-moving-from-config-to-code-simple.html" target="_blank"&gt;http://icanmakethiswork.blogspot.com/2012/03/wcf-moving-from-config-to-code-simple.html&lt;/a&gt; &lt;br /&gt;I know I said I'd write about JSON this time.  I will get to that but not this time.  This time WCF authentication quirks.&lt;br /&gt;&lt;br /&gt;I've been working on a project that uses .NET Remoting to have a single central point to which web applications and Windows services can call into.  This is used in an intranet environment and all the websites and Windows services were hosted on the same single server along with our .NET Remoting Windows service.  (They could quite easily have been on different servers but there was no need in this case.)&lt;br /&gt;&lt;br /&gt;It was decided to "embrace the new" by migrating this .NET Remoting project over to WCF.  The plan wasn't to do anything revolutionary, just to move from one approach to the other as easily as possible.  I found the following useful article on MSDN:&lt;br /&gt;&lt;br /&gt;&lt;a href="http://msdn.microsoft.com/en-us/library/aa730857%28v=vs.80%29.aspx" target="_blank"&gt;http://msdn.microsoft.com/en-us/library/aa730857%28v=vs.80%29.aspx&lt;/a&gt;&lt;br /&gt;&lt;br /&gt;This particular article was helpful and following the steps enclosed I was quickly up and running with a basic WCF service hosted in a Windows service.  It was at this point I started thinking about security.  The existing .NET Remoting approach had no security in place.  This wasn't ideal but also probably wasn't the worry you might think.  It was hosted in an intranet environment and hence not so exposed to the rigours of the Wild Wild Web.  However, since I was looking at WCF I thought it would be a good opportunity to get some basic security in place.  This generally pleases auditors.  I opted to use &lt;a href="http://msdn.microsoft.com/en-us/library/ms733089.aspx" target="_blank"&gt;Windows Transport authentication&lt;/a&gt; as this seemed pretty appropriate for an intranet environment.  The idea being that we'd authenticate with Windows for an account in our domain.&lt;br /&gt;&lt;br /&gt;After headbutting Windows for some time I managed to get a successful client call going from the website running on my development machine to the (separate) development server that was hosting our WCF Window service using Transport Windows authentication.&lt;br /&gt;&lt;br /&gt;However, when deploying the website to the development server I discovered we would experience the following error when the website attempted to call the WCF service (on the same server).&lt;br /&gt;&lt;br /&gt;&lt;pre&gt;&lt;code&gt;&lt;br /&gt;Event Type:            Failure Audit&lt;br /&gt;Event Source:         Security&lt;br /&gt;Event Category:     Logon/Logoff &lt;br /&gt;Event ID: 537&lt;br /&gt;Date:                       15/02/2012&lt;br /&gt;Time:                       16:32:04&lt;br /&gt;User:                       NT AUTHORITY\SYSTEM&lt;br /&gt;Computer:               MINE999&lt;br /&gt;Description:&lt;br /&gt;Logon Failure:&lt;br /&gt;               Reason:                   An error occurred during logon&lt;br /&gt;               Logon Type:            3&lt;br /&gt;               Logon Process:         ^&lt;br /&gt;               Authentication Package:         NTLM&lt;br /&gt;               Status code:            0xC000006D&lt;br /&gt;&lt;/code&gt;&lt;/pre&gt;&lt;br /&gt;Not terribly helpful.  At the end of the day it seemed we were suffering from a security "feature" introduced by Microsoft to prevent services calling services on the same box with a fully qualified name.  An explanation of this can be found here:&lt;br /&gt;&lt;br /&gt;&lt;a href="http://developers.de/blogs/damir_dobric/archive/2009/08/28/authentication-problems-by-using-of-ntlm.aspx" target="_blank"&gt;http://developers.de/blogs/damir_dobric/archive/2009/08/28/authentication-problems-by-using-of-ntlm.aspx&lt;/a&gt;&lt;br /&gt;&lt;br /&gt;Using method 1 in the enclosed link I initially worked round this by amending the registry and rebooting the server:&lt;br /&gt;&lt;br /&gt;&lt;a href="http://support.microsoft.com/kb/887993" target="_blank"&gt;http://support.microsoft.com/kb/887993&lt;/a&gt;&lt;br /&gt;&lt;br /&gt;This was not a fantastic solution.  Fortunately I subsequently found a better one but since the resources on the web are *&lt;b&gt;ATROCIOUS&lt;/b&gt;* on this point I thought I should take the time to note down the full explanation since otherwise it'll be lost in the mists of time.  Here we go:&lt;br /&gt;&lt;br /&gt;The equivalent security to the previous .NET Remoting solution in WCF was to use this config setting on client and service:&lt;br /&gt;&lt;br /&gt;&lt;pre class="prettyprint xml"&gt;&lt;br /&gt;&lt;code class="language-xml"&gt;&lt;br /&gt;&amp;lt;security mode="None" /&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt;&lt;br /&gt;As I've said, this is an intranet environment and so having this "none" security setting in place is made less worrying by the fact that the network itself is secured.  But obviously this is not ideal and unlikely to be audit compliant.  To use Windows security you need this netTcpBinding config setting on client and service:&lt;br /&gt;&lt;br /&gt;&lt;pre class="prettyprint xml"&gt;&lt;br /&gt;&lt;code class="language-xml"&gt;&lt;br /&gt;&amp;lt;security mode="Transport"&amp;gt;&lt;br /&gt;  &amp;lt;transport clientCredentialType="Windows" /&amp;gt;&lt;br /&gt;&amp;lt;/security&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt;&lt;br /&gt;To call the service with this setting in place you will need to be an authenticated Windows user.  (Or at the very least impersonating one - but you knew that.)&lt;br /&gt;&lt;br /&gt;&lt;b&gt;NOW FOR THE MOST IMPORTANT BIT.....&lt;/b&gt;&lt;br /&gt;&lt;br /&gt;The endpoint addresses *&lt;b&gt;must&lt;/b&gt;* be "localhost" for &lt;u&gt;both&lt;/u&gt; client and service when both are deployed to the same server.  If this is not the case then you will suffer from the aforementioned security "feature" which will provide you with unhelpful "the server has rejected the client credentials" messages and *&lt;b&gt;nothing&lt;/b&gt;* else.&lt;br /&gt;&lt;br /&gt;&lt;b&gt;OK FINISHED - MOVE ALONG NOW... NOTHING MORE TO SEE HERE&lt;/b&gt;&lt;br /&gt;&lt;br /&gt;With WCF Windows Transport authentication in place you can interrogate the calling user id within the service methods by simply evaluating ServiceSecurityContext.Current.PrimaryIdentity.Name (which will be something like "myDomain\myUserName").  So we you wanted to, we could have a simple step which evaluated if the calling user is on the "approved" / "authorised" list.  I'm sure this could be made more sophisticated by using groups etc I guess - though I haven't investigated it further as yet.  In fact, I suspect Microsoft may have something even more sophisticated still available for use which I'm unaware of - if anyone knows a simple explanation of this then please do let me know!&lt;br /&gt;&lt;br /&gt;In closing, I do think Microsoft could work on providing more helpful error messages than "the server has rejected the client credentials".  Going by what I read as I researched this error many people seem to have struggled much as I did before eventually bailing out and ended up chancing it by turning security off in their applications.  Clearly it is not desirable to have people so confused by errors that they give up and settle for a less secure solution.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7470875386331997912'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/7470875386331997912'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2012/02/wcf-transport-windows-authentication.html' title='WCF Transport Windows authentication using NetTcpBinding in an Intranet environment'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-356642731180739913</id><published>2012-02-06T08:53:00.000Z</published><updated>2012-02-06T08:53:56.888Z</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>ideas</title><content type='html'>Different post: javascript.  Absolutely rubbish isn't it?  black box different post: what is mvc  javascript serializer  jstree wrapper in c# array.push  I used it for wiring up click handlers wiring up all hover behaviour for ie 6 ** data attributes * ajax ** grep map inArray .hover - getElementsByClassName() which is not possible in ie6    javascript globalize library  http://javascript.crockford.com/javascript.html   - almost certainly the finest development related book I have every read. &lt;a href="http://www.youtube.com/watch?v=GKfHdOrR3lw" target="_blank"&gt;John Resig (author of jQuery) talking about JavaScript&lt;/a&gt;BUILD UP A LIST OF USEFUL JavaScript RESOURCES / blogs / videos etc   I don't particularly want to repeat his work since he's done it so well.  I suppose I just want to summarise At the end of reading his series I felt like Paul when the scales fell from his eyes.  Important differences:  Toolkit of Js scripts  dogs breakfast functions as first class objects javascript object literal dynamic - used to strongly typed compiled languages so didn't realise what was possible</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/356642731180739913'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/356642731180739913'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5635885589685161460</id><published>2012-02-05T11:20:00.001Z</published><updated>2021-03-04T17:43:39.281Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='ajax'/><category scheme='http://www.blogger.com/atom/ns#' term='jquery'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='webservice.htc'/><category scheme='http://www.blogger.com/atom/ns#' term='json'/><category scheme='http://www.blogger.com/atom/ns#' term='microsoft'/><title type='text'>A Potted History of using Ajax (on the Microsoft Stack of Love)</title><content type='html'>This post originally started out as an explanation of JSON.  However as I wrote this quickly got abandoned in favour of writing about how I came to use JSON in the first place - which was through the use of Ajax.  Having written a goodly amount I've now decided to move the actual JSON stuff into another post since I think Ajax is probably worth thinking about by itself rather than as an aside.&lt;br /&gt;&lt;br /&gt;So let me start at the beginning and explain how I came to use Ajax in the first place (this may take some time so please bear with me).  In late 2004 I first started working on a project which I was to remain involved with (on and off) for a very long time indeed.  The project was part financial reporting system and part sales incentivisation tool; it was used internally in the investment bank in which I was working.  The project had been in existence for a number of years and had a web front end which at that point would been built in a combination of HTML, JavaScript, classic ASP and with a Visual Basic 6.0 back end.  One of the reasons I had been brought on to the project was to help ".Net-ify" the thing and migrate it to ASP.NET and C#.&lt;br /&gt;&lt;br /&gt;I digress.  The interesting thing about this app was that there were actually some quite advanced things being done with it (despite the classic ASP / VB).  The users could enter trades into the system which represented actual trades that had been entered into a trading system elsewhere in the organisation.  These trades would be assigned a reporting value which would be based on their various attributes.  (Stay with me people this will get more interesting I *&lt;b&gt;promise&lt;/b&gt;*.)&lt;br /&gt;&lt;br /&gt;The calculation of the reporting value was quite an in depth process and needed to be performed server-side.  However, the users had decreed that it wasn't acceptable to do a full postback to the server to perform this calculation; they wanted it done "on-the-fly".  Now if you asked me at the time I'd have said "can't be done".  Fortunately the other people working on the project then weren't nearly so defeatist.  Instead they went away and found Microsoft's &lt;a href="http://msdn.microsoft.com/en-us/library/ie/ms531033%28v=vs.85%29.aspx" target="_blank"&gt;webservice.htc&lt;/a&gt; library.  For those of you that don't know this was a JavaScript library that Microsoft came up with to enable the access of Web Services on the client.  Given that it was designed to work with IE 5 I suspect it was created between 1999-2001 (but I'm not certain about that).&lt;br /&gt;&lt;br /&gt;  Now it came as a revelation to me but this was a JavaScript library that talked to our web services through the medium of XML.  In short it was my first encounter with anything remotely &lt;a href="http://en.wikipedia.org/wiki/Ajax_(programming)" target="_blank"&gt;Ajax&lt;/a&gt;-y.  It was exciting!  However, the possibilities of what we could do didn't actually become apparent to me for some years.  It's worth saying that the way we were using webservice.htc was exceedingly simplistic and rather than investigating further I took the limited ways we were using it as indications of the limitations of Ajax and / or webservice.htc.  So for a long time I thought the following: &lt;ul&gt;&lt;li&gt;The only way to pass multiple arguments to a web service was to package up arguments into a single string with delimiters which you could &lt;a href="http://en.wikipedia.org/wiki/Comparison_of_programming_languages_(string_functions)#split" target="_blank"&gt;split&lt;/a&gt; and unpackage as your first step on the server.&lt;/li&gt;&lt;li&gt;The only valid return type was a single string.  And so if you wanted to return a number of numeric values (as we did) the only way to do this was to package up return values into a very long string with delimiters in and (you guessed it!) &lt;a href="http://en.wikipedia.org/wiki/Comparison_of_programming_languages_(string_functions)#split" target="_blank"&gt;split&lt;/a&gt; and unpackage as your first step on the client.&lt;/li&gt;&lt;li&gt;The only thing that you could (or would want to) send back and forth between client and server was XML&lt;/li&gt;&lt;/ul&gt;&lt;br /&gt;So to recap, I'm now aware that it's possible for JavaScript to interact with the server through the use of web services.  It's possible, but ugly, not that quick and requires an awful lot of manual serialization / deserialization operations.  It's clearly powerful but not much fun at all.  And that's where I left it for a number of years.  Let's fade to black...&lt;br /&gt;&lt;br /&gt;It's now 2007 and Microsoft have released ASP.NET Ajax, the details of which are well explained in this &lt;a href="http://msdn.microsoft.com/en-us/magazine/cc163499.aspx" target="_blank"&gt;article&lt;/a&gt; (which I have only recently discovered).  Now I'm always interested in "the new" and so I was naturally interested in this.&lt;br /&gt;&lt;br /&gt;Just to be completely upfront about this I should confess that when I first discovered ASP.NET Ajax I didn't clock the power of it at all.  Initially I just switched over from using webservice.htc to ASP.NET Ajax.  This alone gave us a *&lt;b&gt;massive&lt;/b&gt;* performance improvement (I know it was massive since we actually received a "well done" email from our users which is testament to the difference it was making to their  experience of the system).  But we were still performing our manual serialisation / deserialisation of values on the client and the server.  ie. Using Ajax was now much faster but still not too much fun.&lt;br /&gt;&lt;br /&gt;Let's jump forward in time again to around 2010 to the point in time when I was discovering jQuery and that JavaScript wasn't actually evil.&lt;br /&gt;&lt;br /&gt;It's not unusual for me to play around with "what if" scenarios in my code, just to see what might might be possible.  Sometimes I discover things.  So it was with JSON.  We had a web service in the system that allowed us to look up a counterparty (ie a bank account) with an identifier.  Once we looked it up we packaged up the counterparty details (eg name, location etc) into a big long string with delimiters and sent it back to client.  One day I decided to change the return type on the web service from a string to the actual counterparty class.  So we went from something like this:&lt;br /&gt;&lt;br /&gt;&lt;pre class="brush:c#"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;[WebService(Namespace = "http://tempuri.org/")]&lt;br /&gt;[WebServiceBinding(ConformsTo = WsiProfiles.BasicProfile1_1)]&lt;br /&gt;[ScriptService]&lt;br /&gt;public class CounterpartyWebService : System.Web.Services.WebService&lt;br /&gt;{&lt;br /&gt;  [WebMethod]&lt;br /&gt;  public string GetCounterparty(string parameters)&lt;br /&gt;  {&lt;br /&gt;    string[] aParameters = parameters.Split("|");&lt;br /&gt;    int counterpartyId = int.Parse(aParameters[0]);&lt;br /&gt;    bool includeLocation = (aParameters[1] == "1");&lt;br /&gt;    Counterparty counterparty = _counterpartyDb&lt;br /&gt;      .GetCounterparty(counterpartyId);&lt;br /&gt;&lt;br /&gt;    string returnValue = counterparty.Id + &lt;br /&gt;                       "|" + counterparty.Name + &lt;br /&gt;                       (includeLocation&lt;br /&gt;                         ? "|" + counterparty.Location &lt;br /&gt;                         : "");&lt;br /&gt;&lt;br /&gt;    return returnValue;&lt;br /&gt;  }&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt;To something like this:&lt;br /&gt;&lt;br /&gt;&lt;pre class="brush:c#"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;[WebMethod]&lt;br /&gt;public Counterparty GetCounterparty(string parameters)&lt;br /&gt;{&lt;br /&gt;  string[] aParameters = parameters.Split("|");&lt;br /&gt;  int counterpartyId = int.Parse(aParameters[0]);&lt;br /&gt;  bool includeLocation = (aParameters[1] == "1");&lt;br /&gt;  Counterparty counterparty = _counterpartyDb&lt;br /&gt;    .GetCounterparty(counterpartyId);&lt;br /&gt;&lt;br /&gt;  return counterparty;&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt;I genuinely expected that this was just going to break.  It didn't.  Suddenly on the client I'm sat there with a full blown object that looks just like the object I had on the server.  &lt;b&gt;WHAT BLACK MAGIC COULD THIS BE??????????&lt;/b&gt;&lt;br /&gt;&lt;br /&gt;Certain that I'd discovered witchcraft I decided to try something else.  What would happen if I changed the signature on the method so it received individual parameters and passed my individual parameters to the web service instead of packaging them up into a string?  I tried this:&lt;br /&gt;&lt;br /&gt;&lt;pre class="brush:c#"&gt;&lt;br /&gt;&lt;code class="language-cs"&gt;&lt;br /&gt;[WebMethod]&lt;br /&gt;public Counterparty GetCounterparty(int counterpartyId,&lt;br /&gt;                                    bool includeLocation)&lt;br /&gt;{&lt;br /&gt;  Counterparty counterparty = _counterpartyDb&lt;br /&gt;    .GetCounterparty(counterpartyId);&lt;br /&gt;&lt;br /&gt;  return counterparty;&lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt;And it worked! &lt;b&gt;&lt;a href="http://www.youtube.com/watch?v=N_dWpCy8rdc&amp;feature=related" target="_blank"&gt;IT WORKED!!!!!!!!!!!!!!!!!!!!!&lt;/a&gt;&lt;/b&gt;  (And yes I know I wasn't actually using the includeLocation parameter - but the point was it was being passed to the server and I could have used it if I'd wanted to.)  I couldn't believe it.  For &lt;b&gt;years&lt;/b&gt; I'd been using Ajax and without &lt;b&gt;any&lt;/b&gt; idea of the power available to me.  The ignorance!  The stupidity of the man!  To my complete surprise it turned out that: &lt;ul&gt;&lt;li&gt;Ajax could be quick!  ASP.NET Ajax was lightening fast when compared to webservice.htc&lt;/li&gt;&lt;li&gt;You could send multiple arguments to a web service without all that packaging nonsense&lt;/li&gt;&lt;li&gt;You could return complex objects without the need for packaging it all up yourself.&lt;/li&gt;&lt;/ul&gt;&lt;br /&gt;Essentially the source of all this goodness was the magic of JSON.  I wouldn't really come to comprehend this until I moved away from using the ASP.NET Ajax client libraries in favour of using the &lt;a href="http://api.jquery.com/jQuery.ajax/" target="_blank"&gt;jQuery.ajax&lt;/a&gt; functionality.  (Yes, having mostly rattled on about using webservice.htc and ASP.NET Ajax I should clarify that I have now forsaken both for jQuery as I find it more powerful and more configurable - but it's the journey that counts I guess!)&lt;br /&gt;&lt;br /&gt;It's abysmal that I didn't discover the power of Ajax sooner but the difference this discovery made to me was immense.  Approaches that I would have dismissed or shied away from previously because of the amount of "plumbing" involved now became easy.  This massively contributed to my &lt;a href="http://www.hanselman.com/blog/HanselminutesPodcast260NETAPIDesignThatOptimizesForProgrammerJoyWithJonathanCarter.aspx" target="_blank"&gt;programmer joy&lt;/a&gt;!&lt;br /&gt;&lt;br /&gt;Next time I promise I'll aim to actually get onto JSON.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5635885589685161460'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/5635885589685161460'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2012/02/potted-history-of-using-ajax-on.html' title='A Potted History of using Ajax (on the Microsoft Stack of Love)'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><georss:featurename>Twickenham, Greater London</georss:featurename><georss:point>51.444581 -0.335246</georss:point><georss:box>51.4247875 -0.374728 51.4643745 -0.29576399999999997</georss:box></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-584148239798300001</id><published>2012-01-30T20:49:00.003Z</published><updated>2021-03-05T17:57:22.679Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='javascript'/><category scheme='http://www.blogger.com/atom/ns#' term='c#'/><category scheme='http://www.blogger.com/atom/ns#' term='elijah manor'/><category scheme='http://www.blogger.com/atom/ns#' term='douglas crockford'/><title type='text'>JavaScript - getting to know the beast...</title><content type='html'>So it's 2010 and I've started using jQuery.  jQuery is a JavaScript library.  This means that I'm writing JavaScript...  Gulp!&lt;br /&gt;&lt;br /&gt;I should say that at this point in time I *&lt;b&gt;hated&lt;/b&gt;* JavaScript (I have mentioned this previously).  But what I know now is that I barely understood the language at all.  All the JavaScript I knew was the result of copying and pasting after I'd hit "view source".  I don't feel too bad about this - not because my ignorance was laudable but because I certainly wasn't alone in this.  It seems that up until recently hardly anyone knew anything about JavaScript.  It puzzles me now that I thought this was okay.  I suppose like many people I didn't think JavaScript was capable of much and hence felt time spent researching it would be wasted.&lt;br /&gt;&lt;br /&gt;Just to illustrate where I was then, here is 2009 John's idea of some pretty "advanced" JavaScript:&lt;br /&gt;&lt;br /&gt;&lt;pre class="prettyprint html"&gt;&lt;br /&gt;&lt;code class="language-html"&gt;&lt;br /&gt;function GiveMeASum(iNum1, iNum2) &lt;br /&gt;{&lt;br /&gt;  var dteDate = new Date();&lt;br /&gt;  var iTotal = iNum1 + iNum2;&lt;br /&gt;  return "This is your total: " + iTotal + ", at this time: " + dteDate.toString();&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;&amp;lt;input type="text" id="Number1" value="4" /&amp;gt;&lt;br /&gt;&amp;lt;input type="text" id="Number2" value="6" /&amp;gt;&lt;br /&gt;&amp;lt;input type="button" &lt;br /&gt;  value="Click Me To Add" &lt;br /&gt;  onclick="alert(GiveMeASum(parseInt(document.getElementById(Number1).value, 10), parseInt(document.getElementById(Number2).value, 10)))" /&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt;&lt;br /&gt;I know - I'm not to proud of it...  Certainly if it was a horse you'd shoot it.&lt;br /&gt;&lt;br /&gt;Basically, at that point I knew the following: &lt;ul&gt;&lt;li&gt;JavaScript had functions (but I knew only one way to use them - see above)&lt;/li&gt;&lt;li&gt;It had some concept of numbers (but I had no idea of the type of numbers I was dealing with; integer / float / decimal / who knows?)&lt;/li&gt;&lt;li&gt;It had some concept of strings&lt;/li&gt;&lt;li&gt;It had a date object&lt;/li&gt;&lt;/ul&gt;&lt;br /&gt;This was about the limit of my knowledge.  If I was right, and that's all there was to JavaScript then my evaluation of it as utter rubbish would have been accurate.  I was wrong. SOOOOOOOOOOOO WRONG!&lt;br /&gt;&lt;br /&gt;I first realised how wrong I was when I opened up the jQuery source to have a read.  Put simply I had *&lt;b&gt;no&lt;/b&gt;* idea what I was looking at.  For a while I wondered if I was actually looking at JavaScript; the code was so different to what I was expecting that for a goodly period I considered jQuery to be some kind of strange black magic; written in a language I did not understand.&lt;br /&gt;&lt;br /&gt;I was half right.  jQuery wasn't black magic.  But it was written in a language I didn't understand; namely JavaScript. :-(  Here beginneth the lessons...&lt;br /&gt;&lt;br /&gt;I started casting around looking for information about JavaScript.  Before very long I discovered one &lt;a href="http://www.elijahmanor.com/" target="_blank"&gt;Elijah Manor&lt;/a&gt; who had helpfully done a number of talks and blog posts directed at C# developers (which I was) about JavaScript.  My man! &lt;br /&gt;&lt;ul&gt;&lt;li&gt;&lt;a href="http://enterprisejquery.com/2010/10/how-good-c-habits-can-encourage-bad-javascript-habits-part-1/" target="_blank"&gt;How good C# habits can encourage bad JavaScript habits part 1&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="http://enterprisejquery.com/2010/10/how-good-c-habits-can-encourage-bad-javascript-habits-part-2/" target="_blank"&gt;How good C# habits can encourage bad JavaScript habits part 2&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="http://enterprisejquery.com/2010/10/how-good-c-habits-can-encourage-bad-javascript-habits-part-3/" target="_blank"&gt;How good C# habits can encourage bad JavaScript habits part 3&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="http://blogs.msdn.com/b/ukmsdn/archive/2011/06/10/javascript-for-the-c-developer.aspx"&gt;Video of Elijah Manor talking through the above material&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;br /&gt;For me this was all massively helpful.  In my development life so far I had only ever dealt with strongly typed, compiled "classical" languages.  I had little to no experience of functional, dynamic and loosely typed languages (essentially what JavaScript is).  Elijahs work opened up my eyes to some of the massive differences that exist.&lt;br /&gt;&lt;br /&gt;He also pointed me in the direction of the (never boring) Doug Crockford, author of the best programming book I have ever purchased: &lt;a href="http://www.amazon.co.uk/JavaScript-Good-Parts-Douglas-Crockford/dp/0596517742" target="_blank"&gt;JavaScript: The Good Parts&lt;/a&gt;.  Who could not like a book about JavaScript which starts each chapter with a quote from Shakespeare and still comes in at only a 100 pages?  It's also worth watching the man in person as he's a thoroughly engaging presence.  There's loads of videos of him out there but this one is pretty good: &lt;a href="http://www.youtube.com/watch?v=v2ifWcnQs6M" target="_blank"&gt;Douglas Crockford: The JavaScript Programming Language&lt;/a&gt;.&lt;br /&gt;&lt;br /&gt;I don't want to waste your time by attempting to rehash what these guys have done already.  I think it's always best to go to the source so I'd advise you to check them out for yourselves.  That said it's probably worth summarising some of the main points I took away from them (you can find better explanations of all of these through looking at their posts): &lt;ol&gt;&lt;li&gt;JavaScript has objects but has no classes.  Instead it has (what I still consider to be) the weirdest type of inheritance going: prototypical inheritance.&lt;br /&gt;&lt;br /&gt;&lt;/li&gt;&lt;li&gt;JavaScript has the simplest and loveliest way of creating a new object out there; the "JavaScript Object Literal".  Using this we can simply&lt;br /&gt;&lt;code&gt;var myCar = { wheels: 4, colour: "blue" }&lt;/code&gt;&lt;br /&gt;and ladies and gents we have ourselves a car! (object)&lt;br /&gt;&lt;br /&gt;&lt;/li&gt;&lt;li&gt;In JavaScript functions are &lt;a href="http://en.wikipedia.org/wiki/First-class_function" target="_blank"&gt;first class objects&lt;/a&gt;.  This means functions can be assigned to variables (as easily as you'd assign a string to a variable) and crucially you can pass them as parameters to a function and pass them back as a return type.  Herein lies power!&lt;br /&gt;&lt;br /&gt;&lt;/li&gt;&lt;li&gt;JavaScript has 6 possible values (false, null, undefined, empty strings, 0 and NaN) which it evaluates as false.  These are known as the "false-y" values.  It's a bit weird but on the plus side this can lead to some nicely terse code.&lt;br /&gt;&lt;br /&gt;&lt;/li&gt;&lt;li&gt;To perform comparisons in JavaScript you should avoid == and != and instead use === and !==.  Before I discovered this I had been using == and != and then regularly puzzling over some truly odd behaviour.  Small though it may sound, this may be the most important discovery of the lot as it was this that lead to me actually *&lt;b&gt;trusting&lt;/b&gt;* the language.  Prior to this I vaguely thought I was picking up on some kind of bug in the JavaScript language which I plain didn't understand.  (After all, in any sane universe should this really evaluate to true?: &lt;code&gt;0 == ""&lt;/code&gt;)&lt;br /&gt;&lt;br /&gt;&lt;/li&gt;&lt;li&gt;Finally JavaScript has function scope rather than block scope.  Interestingly it "hoists" variable declaration to the top of each function which can lead to some very surprising behaviour if you don't realise what is happening.&lt;br /&gt;&lt;br /&gt;&lt;/li&gt;&lt;/ol&gt;I now realise that JavaScript is a fantastic language because of it's flexibility.  It is also a deeply flawed language; in part due to it's unreasonably forgiving nature (you haven't finished your line with a semi-colon; that's okay - I can see you meant to so I'll stick one in / you haven't declared your variable; not a problem I won't tell you but I'll create a new variable stick it in global scope and off we go etc).  It is without question the easiest language with which to create a proper dogs breakfast.&lt;br /&gt;&lt;br /&gt;To get the best out of JavaScript we need to understand the quirks of the language and we need good patterns.  If you're interested in getting to grips with it I really advise you to check out the Elijah and Dougs work - it really helped me.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/584148239798300001'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/584148239798300001'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2012/01/javascript-getting-to-know-beast.html' title='JavaScript - getting to know the beast...'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><georss:featurename>Twickenham, Greater London</georss:featurename><georss:point>51.4483595 -0.3292407</georss:point><georss:box>51.4458855 -0.3341762 51.4508335 -0.3243052</georss:box></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-875555191236525084</id><published>2012-01-24T22:54:00.001Z</published><updated>2021-03-03T22:03:19.921Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='jqgrid'/><category scheme='http://www.blogger.com/atom/ns#' term='ajax'/><category scheme='http://www.blogger.com/atom/ns#' term='jquery'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='scott gu'/><category scheme='http://www.blogger.com/atom/ns#' term='microsoft'/><title type='text'>What on earth is jQuery?  And why should I care?</title><content type='html'>&lt;p&gt;What on earth is jQuery?  What's a jQuery plugin?&lt;/p&gt; &lt;p&gt;These were the questions I was asking myself shortly after discovering that jqGrid was a "jQuery plugin".  I'd been vaguely aware of the phrase "jQuery" being increasingly mentioned on various techical websites since about 2009.  But for some reason I'd felt no urge to find out what it was.  I seem to remember that I read the name "jQuery" and jumped to the perfectly logical (in my head) conclusion that this must be a Java SQL engine of some sort. (After all "j" as a prefix to anything so far had generally been Java and "Query" just rang of databases to me.)  Clearly I was wrong - life's full of surprises.&lt;/p&gt; &lt;p&gt;I soon discovered that, contrary to expectations, jQuery had nothing to do with Java *&lt;b&gt;and&lt;/b&gt;* nothing to do with databases either.  It was in fact a JavaScript library written by the amazing &lt;a href="http://ejohn.org/about/" target="_blank"&gt;John Resig&lt;/a&gt;.  At the time I had no love for JavaScript.  I now realise I knew nearly nothing about it but my feeling was that JavaScript was awful - evil even.  However, given JavaScripts ubiquity in the world of web it seemed to be a necessary evil.&lt;/p&gt; &lt;p&gt;I took a look at the &lt;a href="http://jquery.com/" target="_blank"&gt;jQuery website&lt;/a&gt; and after reading round a bit I noticed that it could be used for &lt;a href="http://en.wikipedia.org/wiki/Ajax_%28programming%29" target="_blank"&gt;Ajax&lt;/a&gt; operations.  This lead to me reaching the (incorrect) conclusion that jQuery was basically an alternative to the &lt;a href="http://en.wikipedia.org/wiki/ASP.NET_AJAX#Microsoft_Ajax_Library" target="_blank"&gt;Microsoft Ajax library&lt;/a&gt; which we were already using to call various Web Services.  But I remained frankly suspicious of jQuery.  What was the point of this library?  Why did it exist?&lt;/p&gt; &lt;p&gt;I read the the &lt;a href="http://weblogs.asp.net/scottgu/archive/2008/09/28/jquery-and-microsoft.aspx" target="_blank"&gt;blog&lt;/a&gt; by Scott Gu announcing Microsoft was going to start shipping jQuery with Visual Studio.  The Great Gu trusted it.  Therefore, I figured, it must be okay...  Right?&lt;/p&gt; &lt;p&gt;The thing was, I was quite happy with the Microsoft Ajax library.  I was familiar with it.  It worked.  Why switch?  I saw the various operations Scott Gu was doing to divs on the screen using jQuery.  I didn't want to do anything like that at all.  As I said; I had no love for JavaScript - I viewed it as C#'s simple-minded idiot cousin.  My unofficial motto when doing web stuff was "wherever possible, do it on the server".  &lt;/p&gt; &lt;p&gt;I think I would have ignored jQuery entirely but for the fact of jqGrid.  If I wanted to use jqGrid I had to use jQuery as well.  In the end I decided I'd allow it house room just for the sake of jqGrid and I'd just ignore it apart from that.  And that's how it was for a while.&lt;/p&gt; &lt;p&gt;Then I had an epiphany.  Okay - that's overplaying it.  What actually happened was I realised that something we were doing elsewhere could be done faster and easier with jQuery.  It's something so ridiculously feeble that I feel vaguely embarrassed sharing it.  Anyway.&lt;/p&gt; &lt;p&gt;So, you know the css hover behaviour is only implemented for anchor tags in IE6?  No?  Well read this &lt;a href="http://stackoverflow.com/questions/36605/ie-6-css-hover-non-anchor-tag" target="_blank"&gt;Stack Overflow&lt;/a&gt; entry - it'll clarify.  Well, the app that I was working on was an internal web application only used by people with the corporate installation of IE 6 on their desktops.  And it was "terribly important" that buttons had hover behaviour.  For reasons that now escape me we were doing this by manually adding inline onmouseover / onmouseout event handlers to each input button on the screen in turn in every page in the &lt;a href="http://msdn.microsoft.com/en-us/library/ms178472.aspx" target="_blank"&gt;Page_Load&lt;/a&gt; event server side.  I think we were aware it wasn't fantastic to have to wire up each button in turn.  But it worked and as with so many development situations we had other pressures, other requirements to fulfil and other fish to fry - so we left it at that.&lt;/p&gt; &lt;p&gt;And then it occurred to me...  What about using the &lt;a href="http://api.jquery.com/class-selector/" target="_blank"&gt;jQuery class selector&lt;/a&gt; in conjunction with the &lt;a href="http://api.jquery.com/hover/" target="_blank"&gt;jQuery hover event&lt;/a&gt;?  I could have one method that I called on a page which would wire up all of my hover behaviours in one fell swoop.  I wouldn't need to do input-by-input wireups anymore!  Hallelujah!  This is what I did:&lt;/p&gt; &lt;p&gt;The buttons I would like to style: &lt;pre class="prettyprint html"&gt;&lt;br /&gt;&lt;code class="language-html"&gt;&lt;br /&gt;&amp;lt;input type="button" value="I am a button" class="itIsAButton" /&amp;gt;&lt;br /&gt;&amp;lt;input type="button" value="So am I" class="itIsAButton" /&amp;gt;&lt;br /&gt;&amp;lt;input type="button" value="Me too" class="itIsAButton" /&amp;gt;&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;My CSS (filter, by the way, is just linear gradients in IE 6-9):&lt;/p&gt; &lt;pre class="prettyprint css"&gt;&lt;br /&gt;&lt;code class="language-css"&gt;&lt;br /&gt;.itIsAButton&lt;br /&gt;{&lt;br /&gt;  filter:progid:DXImageTransform.Microsoft.Gradient (GradientType=0,StartColorStr='#ededed',EndColorStr='#cdcdcd');   &lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;.itIsAButton:hover, .itIsAButton_hover /* "_hover" is for IE6 */&lt;br /&gt;{&lt;br /&gt;  filter:progid:DXImageTransform.Microsoft.Gradient (GradientType=0,StartColorStr='#f6f6f6',EndColorStr='#efefef');   &lt;br /&gt;}&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;My jQuery:&lt;/p&gt; &lt;pre class="prettyprint js"&gt;&lt;br /&gt;&lt;code class="language-js"&gt;&lt;br /&gt;$(document).ready(function () {&lt;br /&gt;&lt;br /&gt;  //Add hover behaviour on picker buttons for IE6&lt;br /&gt;  if (($.browser.msie) &amp;&amp; &lt;br /&gt;      (parseInt($.browser.version, 10) &lt; 7)) {&lt;br /&gt;&lt;br /&gt;    var fnButtonHover = function (handlerInOut) {&lt;br /&gt;&lt;br /&gt;      var $btn = $(this);&lt;br /&gt;      var sOriginalClass = $btn.prop("class");&lt;br /&gt;&lt;br /&gt;      if (handlerInOut.type === "mouseenter") {&lt;br /&gt;&lt;br /&gt;        //If not already hovering class then apply it&lt;br /&gt;        if (sOriginalClass.indexOf("_hover") === -1) {&lt;br /&gt;&lt;br /&gt;          $btn.prop("class", sOriginalClass + "_hover");&lt;br /&gt;        }&lt;br /&gt;      }&lt;br /&gt;      else if (handlerInOut.type === "mouseleave") {&lt;br /&gt;&lt;br /&gt;        //If not already non-hovering class then apply it&lt;br /&gt;        if (sOriginalClass.indexOf("_hover") !== -1) {&lt;br /&gt;&lt;br /&gt;          $btn.prop("class", sOriginalClass.split("_")[0]);&lt;br /&gt;        }&lt;br /&gt;      }&lt;br /&gt;    };&lt;br /&gt;&lt;br /&gt;    $(".itIsAButton").hover(fnButtonHover);&lt;br /&gt;  }&lt;br /&gt;});&lt;br /&gt;&lt;/code&gt;&lt;br /&gt;&lt;/pre&gt; &lt;p&gt;And it worked.  I didn't really understand this much about this jQuery "thing" at that point but I could now see that it clearly had at least one use.  I've come to appreciate that jQuery is one of the best pieces of software I've ever encountered.  Over time I may go further into some of the good stuff of jQuery.  It is, quite simply, brilliant.&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/875555191236525084'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/875555191236525084'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2012/01/what-on-earth-is-jquery-and-why-should.html' title='What on earth is jQuery?  And why should I care?'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><georss:featurename>Twickenham, Greater London, UK</georss:featurename><georss:point>51.444581 -0.335246</georss:point><georss:box>51.4247875 -0.374728 51.4643745 -0.29576399999999997</georss:box></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-390453375104214873</id><published>2012-01-14T10:25:00.000Z</published><updated>2012-02-04T06:44:57.897Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='jqgrid'/><category scheme='http://www.blogger.com/atom/ns#' term='ajax'/><category scheme='http://www.blogger.com/atom/ns#' term='jquery'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='datagrid'/><category scheme='http://www.blogger.com/atom/ns#' term='Dave Ward'/><category scheme='http://www.blogger.com/atom/ns#' term='json'/><category scheme='http://www.blogger.com/atom/ns#' term='no postback'/><category scheme='http://www.blogger.com/atom/ns#' term='Encosia'/><category scheme='http://www.blogger.com/atom/ns#' term='tony tomov'/><title type='text'>jqGrid - it's just a far better grid</title><content type='html'>The year was 2010 (not really that long ago I know) and the project that I was working on was sorely in need of a new grid component.  It was an &lt;a href="http://www.asp.net/web-forms" target="_blank"&gt;ASP.NET WebForms&lt;/a&gt; project and for some time we'd been using what was essentially a glorified &lt;a href="http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.datagrid.aspx" target="_blank"&gt;datagrid&lt;/a&gt; which had a few extra features implemented to allow us to change column order / columns displayed / copy contents to clipboard etc.&lt;br /&gt;&lt;br /&gt;Our grid worked perfectly fine - it gave us the functionality we needed.  However, it looked pretty terrible, and had some "quirky" approaches in place for supporting IE and Firefox side by side.  Also, at the time we were attempting to make our app seem new and exciting again for the users.  The surprising truth is that users seem to be more impressed with a visual revamp than with new or amended functionality.  So I was looking for something which would make them sit up and say "oooh - isn't it pretty!".&lt;br /&gt;&lt;br /&gt;Unfortunately the nature of the organisation I was working for was not one that lended itself to paying for components.  They were occasionally willing to do that but the hoops that would have to be jumped through first, the forms that would need to be signed in triplicate by people that had nearly nothing to do with the project made that an unattractive prospect.  So I began my search initially looking at the various open source offerings that were around.&lt;br /&gt;&lt;br /&gt;As a minimum I was looking for something that would do what our home-grown component did already (change column order / columns displayed / copy contents to clipboard etc) but hopefully in a "nicer" way.  Also, I had long been unhappy with the fact that to get our current grid to render results we did a *&lt;b&gt;full postback&lt;/b&gt;* to the server and re-rendered the whole page.  Pointless!  Why should you need to do all this each time when you only wanted to refresh the data?&lt;br /&gt;&lt;br /&gt;Instead I was thinking about using an &lt;a href="http://en.wikipedia.org/wiki/Ajax_%28programming%29" target="_blank"&gt;Ajax&lt;/a&gt; approach; a grid that could just get the data that it needed and render it to the client.  This seemed to me a vastly "cleaner" solution - why update a whole screen when you only want to update a small part of it?  Why not save yourself the trouble of having to ensure that all other screen controls are persisted just as you'd like them after the postback?  I also thought it was probably something that would scale better as it would massively reduce the amount of data moving backwards and forwards between client and server.  No need for a full page life cycle on the server each time the grid refreshes.  Just simple data travelling down the pipes of web.&lt;br /&gt;&lt;br /&gt;With the above criteria in mind I set out on my Google quest for a grid.  Quite soon I found that there was a component out there which seemed to do all that I wanted and far more besides.  It was called &lt;a href="http://www.trirand.com/blog/" target="_blank"&gt;jqGrid&lt;/a&gt;:&lt;br /&gt;&lt;br /&gt;&lt;div class="separator" style="clear: both; text-align: center;"&gt;&lt;a href="http://2.bp.blogspot.com/-hRNgR6DMdWw/TwlZW0MbUEI/AAAAAAAAAJI/-Q6kLWPUHl8/s1600/jqgrid%2Bin%2Ball%2Bits%2Bglory.png" imageanchor="1" style="margin-left:1em; margin-right:1em"&gt;&lt;img border="0" height="225" width="320" src="http://2.bp.blogspot.com/-hRNgR6DMdWw/TwlZW0MbUEI/AAAAAAAAAJI/-Q6kLWPUHl8/s320/jqgrid%2Bin%2Ball%2Bits%2Bglory.png" /&gt;&lt;/a&gt;&lt;/div&gt;&lt;br /&gt;Oooh look at the goodness!  It had both column re-ordering and column choosing built in!:  This was a *&lt;b&gt;very promising sign&lt;/b&gt;*!&lt;br /&gt;&lt;br /&gt;Now it's time for me to demonstrate my ignorance.  According to the website this grid component was a "jQuery plugin".  At the time I read this I had no idea what jQuery was at all - let alone what a plugin for it was.  Anyway, I don't want to get diverted so let's just say that reading this lead to me getting an urgent education about some of the client side aspects of the modern web that I had been previously unaware of.&lt;br /&gt;&lt;br /&gt;I digress.  This component did exactly what I wanted in terms of just sending data down the pipe.  jqGrid worked with a whole number of possible data sources; XML, Array but the most exciting for me was obviously &lt;a href="http://www.json.org/" target="_blank"&gt;JSON&lt;/a&gt;.  Take a look a the grid rendered below and the JSON that powered it (all from a simple &lt;a href="http://www.trirand.com/blog/jqgrid/server.php?q=2&amp;_search=false&amp;nd=1326531357333&amp;rows=10&amp;page=1&amp;sidx=id&amp;sord=desc" target="_blank"&gt;GET&lt;/a&gt; request):&lt;br /&gt;&lt;br /&gt;&lt;div class="separator" style="clear: both; text-align: center;"&gt;&lt;a href="http://2.bp.blogspot.com/-8eKdnv9fMbo/TxFE8Yb1IOI/AAAAAAAAAJg/2ZqSBDQtfuQ/s1600/Check%2Bout%2Bthe%2BJSON.png" imageanchor="1" style="margin-left:1em; margin-right:1em"&gt;&lt;img border="0" height="264" width="320" src="http://2.bp.blogspot.com/-8eKdnv9fMbo/TxFE8Yb1IOI/AAAAAAAAAJg/2ZqSBDQtfuQ/s320/Check%2Bout%2Bthe%2BJSON.png" /&gt;&lt;/a&gt;&lt;/div&gt;&lt;br /&gt;As you can see from the above screenshot, the grid has populated itself using the results of a web request.  The only information that has gone to the server are the relevant criteria to drive the search results.  The only information that has come back from the server is the data needed to drive the grid.  Simple.  Beautiful.  I loved it and I wanted to use it.  So I did!&lt;br /&gt;&lt;br /&gt;I had to take a few steps that most people thinking about using a grid component probably wont need to.  First of all I had to write an ASP.Net WebForms wrapper for jqGrid which could be implemented in a similar way to our current custom datagrid.  This was because, until the users were convinced that the new grid was better than the old both had to co-exist in the project and the user would have the option to switch between the two.  This WebForms wrapper plugged into our old school XML column definition files and translated them into JSON for the grid.  It also took &lt;a href="http://msdn.microsoft.com/en-us/library/system.data.dataset.aspx" target="_blank"&gt;datasets&lt;/a&gt; (which drove our old grid) and translated them into jqGrid-friendly JSON.  I wanted to power the jqGrid using WebMethods on ASPX's.  After a little digging I found &lt;a href="http://encosia.com/using-jquery-to-directly-call-aspnet-ajax-page-methods/" target="_blank"&gt;Dave Ward of Encosia's post&lt;/a&gt; which made it very simple (and in line with this I switched over from &lt;a href="http://en.wikipedia.org/wiki/GET_%28HTTP%29#Request_methods" target="_blank"&gt;GET&lt;/a&gt; requests to &lt;a href="http://en.wikipedia.org/wiki/POST_%28HTTP%29" target="_blank"&gt;POSTs&lt;/a&gt;).   Finally I wrote some custom javascript which added a button to jqGrid which, if clicked, would copy the contents of the jqGrid to the clipboard (this was the only bit of functionality that didn't appear to be implemented out of the box with jqGrid).&lt;br /&gt;&lt;br /&gt;I think I'm going to leave it there for now but I just wanted to say that I think jqGrid is a fantastic component and it's certainly made my life better!  It's: &lt;ul&gt;&lt;li&gt;well supported, there is lots on &lt;a href="http://stackoverflow.com/questions/tagged/jqgrid" target="_blank"&gt;StackOverflow&lt;/a&gt; and the like about it&lt;/li&gt;&lt;li&gt;there are regular &lt;a href="http://www.trirand.com/blog/" target="_blank"&gt;releases / upgrades&lt;/a&gt;&lt;/li&gt;  &lt;li&gt;there are good online &lt;a href="http://trirand.com/blog/jqgrid/jqgrid.html" target="_blank"&gt;demonstrations&lt;/a&gt; and &lt;a href="http://www.trirand.com/jqgridwiki/doku.php" target="_blank"&gt;documentation&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;br /&gt;I think Tony Tomov (the man behind jqGrid) has come up with something truly brilliant.  It's worth saying that the equally brilliant jQueryUI team are in the process of writing an official &lt;a href="http://wiki.jqueryui.com/w/page/34246941/Grid" target="_blank"&gt;jQuery UI grid component&lt;/a&gt; which uses jqGrid as one of its inspirations.  However, this is still a long way from even a "zero feature" release.  In the meantime jqGrid is continuing to go from strength to strength and as such I heartily recommend it.&lt;br /&gt;&lt;br /&gt;Finally, you can take a look at jqGrid's source on &lt;a href="https://github.com/tonytomov/jqGrid" target="_blank"&gt;GitHub&lt;/a&gt;.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/390453375104214873'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/390453375104214873'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2012/01/jqgrid-its-just-far-better-grid.html' title='jqGrid - it&apos;s just a far better grid'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='http://2.bp.blogspot.com/-hRNgR6DMdWw/TwlZW0MbUEI/AAAAAAAAAJI/-Q6kLWPUHl8/s72-c/jqgrid%2Bin%2Ball%2Bits%2Bglory.png' height='72' width='72'/><georss:featurename>Twickenham, Greater London, UK</georss:featurename><georss:point>51.444581 -0.335246</georss:point><georss:box>51.4247875 -0.374728 51.4643745 -0.29576399999999997</georss:box></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3761567502519761674</id><published>2012-01-07T15:33:00.000Z</published><updated>2014-10-30T09:30:05.387Z</updated><category scheme='http://www.blogger.com/atom/ns#' term='delphi'/><category scheme='http://www.blogger.com/atom/ns#' term='asp.net'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Hanselman'/><category scheme='http://www.blogger.com/atom/ns#' term='developer'/><category scheme='http://www.blogger.com/atom/ns#' term='amstrad'/><category scheme='http://www.blogger.com/atom/ns#' term='microsoft'/><title type='text'>Standing on the Shoulders of Giants...</title><content type='html'>&lt;p&gt;It started with Scott Hanselman.  I had no particular plans to start a blog at all.  However, I was reading Scott Hanselman's turn of the year &lt;a href="http://www.hanselman.com/blog/YourBlogIsTheEngineOfCommunity.aspx" target="_blank"&gt;post&lt;/a&gt; and I was struck with an idea.&lt;/p&gt; &lt;p&gt;First, let me give a little background about myself.  I'm a software developer.  I've been in the industry for coming up to 15 years.  I started out professionally writing call centre software.  I moved on to code in a variety of different industries from straight IT to marketing and, for the last 7 years, finance.&lt;/p&gt; &lt;p&gt;Though I initially started out writing in Delphi I fast found myself moving toward the Microsoft "stack of love".  I should say that this move was not because I instinctively liked Microsofts stuff (in fact in the beginning I actively disliked it - moving from Delphi 3.0 to Visual Studio 5 left me finding Microsoft's offering very much wanting).  Rather it was pragmatic.  I needed a job and at the time VB was a far more transferable skill than Delphi.  What with the all encompassing &lt;a href="http://en.wikipedia.org/wiki/Dot-com_bubble" target="_blank"&gt;dot-com bubble&lt;/a&gt; of the late 90's I soon found myself working in the webtastic world of classic ASP (weep) and VB server components (remember them?).&lt;/p&gt; &lt;p&gt;Though things can improve - and in my opinion they really did when Microsoft coughed up the first furball of ASP.NET Beta in (I think) 2001. I grabbed on with both hands.  Since that point I've been earning my bread pretty much, though not exclusively, in the ASP.NET universe.&lt;/p&gt; &lt;p&gt;The one thing that might not be clear from the above curriculum vitae is this: &lt;b&gt;I AM A COMPLETE AMATEUR.&lt;/b&gt;  I mean this in both senses of the word:&lt;/p&gt; &lt;ol&gt;&lt;li&gt;I have no formal training to speak of - I didn't do a computer sciences degree.  In fact my first real coding experience was writing a program in &lt;a href="http://en.wikipedia.org/wiki/Locomotive_BASIC" target="_blank"&gt;Locomotive Basic&lt;/a&gt; for my father on our humble Amstrad CPC.&lt;/li&gt;&lt;li&gt;That said, I love it.  I find writing code an intellectually, emotionally, creatively satisfying act.  And whilst I undoubtedly have less of the theoretical knowledge which most professional developers seem to have, I probably counter-balance that with a hunger to keep learning and keep trying new things.  And since software never sits still that's probably just as well.  Keep watching the horizon - there will be something coming over it!&lt;br /&gt;&lt;br /&gt;And it's worth saying, I have an instinct for developing which serves me pretty well.  I'm good at coming up with elegant and pragmatic solutions.  Put simply: I'm good at making code work.&lt;/li&gt;&lt;/ol&gt; &lt;p&gt;So back to the point.  In my daily work life, like any other developer, I am repeatedly called on to turn someones requirement into a reality.  Very rarely do I achieve this on my own.  Like most of us I'm a dwarf standing on the shoulders of giants.  There's a lot of people out there who come up with useful tools / components / plug-ins that make it possible for me to deliver much more than I would given my own abilities.&lt;/p&gt; &lt;p&gt;So that's what I want to do: I want to talk about the tools, components and techniques that I have found useful in the everyday working life of a developer.  It's likely to be quite a "webby" blog as I probably find that the most interesting area of development at the moment.&lt;/p&gt; &lt;p&gt;I don't know how often I will write but my plan is that when I do, each time I'll talk about something I've found useful - why I found it useful, what problems it solved, what issues it still presented me with and so on.  This is probably not going to be a "techie techie" blog.  Rather a blog that deals with the situations that can confront a developer and how I've responded to them.  I hope you find it interesting.  And if you don't; please keep it to yourself :-)&lt;/p&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3761567502519761674'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/posts/default/3761567502519761674'/><link rel='alternate' type='text/html' href='https://icanmakethiswork.blogspot.com/2012/01/standing-on-shoulders-of-giants.html' title='Standing on the Shoulders of Giants...'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><georss:featurename>Twickenham, Greater London, UK</georss:featurename><georss:point>51.444581 -0.335246</georss:point><georss:box>51.4247875 -0.374728 51.4643745 -0.29576399999999997</georss:box></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8408589607301027829</id><published>2012-03-19T07:16:47.833Z</published><updated>2012-03-19T07:16:47.833Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>You should really take a look at Minion:

https://...</title><content type='html'>You should really take a look at Minion:&lt;br /&gt;&lt;br /&gt;https://github.com/gigafied/minion&lt;br /&gt;&lt;br /&gt;Robust pub/sub implementation along with some other goodies.&lt;br /&gt;&lt;br /&gt;Classical Inheritance, with dependency management, without polluting the global namespace.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3415493205374153591/comments/default/8408589607301027829'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3415493205374153591/comments/default/8408589607301027829'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/03/using-pubsub-observer-pattern-to.html?showComment=1332141407833#c8408589607301027829' title=''/><author><name>gigafied</name><uri>https://www.blogger.com/profile/03721749939922367294</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/03/using-pubsub-observer-pattern-to.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-3415493205374153591' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/3415493205374153591' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-966240555'/><gd:extendedProperty name='blogger.displayTime' value='19 March 2012 at 07:16'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8690108504751959510</id><published>2012-03-21T10:56:08.104Z</published><updated>2012-03-21T10:56:08.104Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Thanks - this looks really interesting...</title><content type='html'>Thanks - this looks really interesting...</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3415493205374153591/comments/default/8690108504751959510'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3415493205374153591/comments/default/8690108504751959510'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/03/using-pubsub-observer-pattern-to.html?showComment=1332327368104#c8690108504751959510' title=''/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/03/using-pubsub-observer-pattern-to.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-3415493205374153591' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/3415493205374153591' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='21 March 2012 at 10:56'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-390549684241558565</id><published>2012-04-18T11:38:06.995+01:00</published><updated>2012-04-18T11:38:06.995+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>We&amp;#39;ve hit a similar problem before now, and ou...</title><content type='html'>We&amp;#39;ve hit a similar problem before now, and our approach was to create Fake objects that inherited from the class, and use protected members of the base class so that only our Fake objects can monkey with them. For example:&lt;br /&gt;&lt;br /&gt;public class Order&lt;br /&gt;{&lt;br /&gt;  protected string _salesOrderPrefix;&lt;br /&gt;&lt;br /&gt;  public string OrderNumber {&lt;br /&gt;    get&lt;br /&gt;    {&lt;br /&gt;      return _salesOrderPrefix;&lt;br /&gt;    }&lt;br /&gt;    private set&lt;br /&gt;    {&lt;br /&gt;      _salesOrderPrefix = value;&lt;br /&gt;    }&lt;br /&gt;  }&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;public class OrderFake : Order&lt;br /&gt;{&lt;br /&gt;  public SetOrderNumber(string orderNumber)&lt;br /&gt;  {&lt;br /&gt;    public new string OrderNumber &lt;br /&gt;    {&lt;br /&gt;      get { return base._salesOrderPrefix; }&lt;br /&gt;      set { base._salesOrderPrefix = value; }&lt;br /&gt;    }&lt;br /&gt;  }&lt;br /&gt;}&lt;br /&gt;&lt;br /&gt;Going the constructor route, do you have safeguards to stop live code digging into these constructors?</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/7337040570188991076/comments/default/390549684241558565'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/7337040570188991076/comments/default/390549684241558565'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/04/simple-technique-for-initialising.html?showComment=1334745486995#c390549684241558565' title=''/><author><name>Russ_Allen</name><uri>https://www.blogger.com/profile/01497253518661242194</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/04/simple-technique-for-initialising.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-7337040570188991076' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/7337040570188991076' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-603816162'/><gd:extendedProperty name='blogger.displayTime' value='18 April 2012 at 11:38'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-654115074310739840</id><published>2012-04-18T12:39:12.027+01:00</published><updated>2012-04-18T12:39:12.027+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi Russ,

Good question!  We don&amp;#39;t have any sa...</title><content type='html'>Hi Russ,&lt;br /&gt;&lt;br /&gt;Good question!  We don&amp;#39;t have any safeguards to prevent live code using these constructors on the grounds that the properties in question would do no harm if set; so effectively we&amp;#39;re saying &amp;quot;we don&amp;#39;t mind&amp;quot;.  That said, we could make use of #if preprocessor directives to hide these constructors if we were so inclined (would need to check out how our build server is configured to see if there would be any impact there but seems perfectly feasible).&lt;br /&gt;&lt;br /&gt;Following your post I got into a chat with a colleague of mine on another team who suggested 2 other possibilities:&lt;br /&gt;&lt;br /&gt;1. Similar to your OrderFake : Order solution but having the extra constructor moved to the subclass.  This, and your solution both strike me as equally valid.  I think I favour using the constructor solution as it&amp;#39;s terser.&lt;br /&gt;&lt;br /&gt;2. Removing the internal setter from the models and instead signifying that it is normalised data through the use of an attribute.  This is quite good but has the disadvantage that someone coding against a model is no longer driven in the direction of not setting unnecessary properties by compiler errors.&lt;br /&gt;&lt;br /&gt;I need to think about it some more to see if I missed anything but I&amp;#39;m inclined to move to sub-classing the object using the extra constructor (ie choice #1).  &lt;br /&gt;&lt;br /&gt;Thanks very much for commenting!</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/7337040570188991076/comments/default/654115074310739840'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/7337040570188991076/comments/default/654115074310739840'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/04/simple-technique-for-initialising.html?showComment=1334749152027#c654115074310739840' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/7337040570188991076/comments/default/390549684241558565'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/04/simple-technique-for-initialising.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-7337040570188991076' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/7337040570188991076' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='18 April 2012 at 12:39'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5567961094185296030</id><published>2012-05-23T10:14:05.994+01:00</published><updated>2012-05-23T10:14:05.994+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hey, thanks for your post! Can you share the relev...</title><content type='html'>Hey, thanks for your post! Can you share the relevant chunks of the config files for both server and client? I&amp;#39;m setting the security to Transport/Windows but I&amp;#39;m still getting the rejection message when it&amp;#39;s set to Windows. I can get through if I set it to None, but then I obviously can&amp;#39;t identify the origins of the request. Cheers!</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/7470875386331997912/comments/default/5567961094185296030'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/7470875386331997912/comments/default/5567961094185296030'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/02/wcf-transport-windows-authentication.html?showComment=1337764445994#c5567961094185296030' title=''/><author><name>Marc</name><uri>https://www.blogger.com/profile/06876079838349758257</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='32' height='32' src='//3.bp.blogspot.com/-uVOGpl2mono/TkURuqrBoiI/AAAAAAAAAl4/9ciq5W6dxWE/s32/liverpool_sq.jpg'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/02/wcf-transport-windows-authentication.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-7470875386331997912' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/7470875386331997912' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1269350618'/><gd:extendedProperty name='blogger.displayTime' value='23 May 2012 at 10:14'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4978609081628456757</id><published>2012-06-04T08:18:58.724+01:00</published><updated>2012-06-04T08:18:58.724+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Thanks for sharing</title><content type='html'>Thanks for sharing</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1825634548402124376/comments/default/4978609081628456757'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1825634548402124376/comments/default/4978609081628456757'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/03/jquery-unobtrusive-remote-validation.html?showComment=1338794338724#c4978609081628456757' title=''/><author><name>freshblood</name><uri>https://www.blogger.com/profile/02241744425908687861</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/03/jquery-unobtrusive-remote-validation.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1825634548402124376' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1825634548402124376' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-531595465'/><gd:extendedProperty name='blogger.displayTime' value='4 June 2012 at 08:18'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4321686513196419325</id><published>2012-06-05T16:54:48.973+01:00</published><updated>2012-06-05T16:54:48.973+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi Marc,

I&amp;#39;m afraid I don&amp;#39;t have access t...</title><content type='html'>Hi Marc,&lt;br /&gt;&lt;br /&gt;I&amp;#39;m afraid I don&amp;#39;t have access to those config files now but I can tell you I based in on the contents of this link:&lt;br /&gt;&lt;br /&gt;&lt;a href="http://msdn.microsoft.com/en-us/library/ms733089.aspx" rel="nofollow"&gt;http://msdn.microsoft.com/en-us/library/ms733089.aspx&lt;/a&gt;&lt;br /&gt;&lt;br /&gt;If you pull out the config stuff from there it should work without too much tweaking (at least it did for me).</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/7470875386331997912/comments/default/4321686513196419325'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/7470875386331997912/comments/default/4321686513196419325'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/02/wcf-transport-windows-authentication.html?showComment=1338911688973#c4321686513196419325' title=''/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/02/wcf-transport-windows-authentication.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-7470875386331997912' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/7470875386331997912' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='5 June 2012 at 16:54'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2186102608400317436</id><published>2012-09-26T14:41:03.609+01:00</published><updated>2012-09-26T14:41:03.609+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Useful stuff, thanks1</title><content type='html'>Useful stuff, thanks1</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/2186102608400317436'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/2186102608400317436'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html?showComment=1348666863609#c2186102608400317436' title=''/><author><name>Tridus</name><uri>https://www.blogger.com/profile/14207065992394675380</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-2414704032922872709' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/2414704032922872709' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-713092988'/><gd:extendedProperty name='blogger.displayTime' value='26 September 2012 at 14:41'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-81732261855488461</id><published>2012-09-27T14:54:41.946+01:00</published><updated>2012-09-27T14:54:41.946+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>My pleasure!</title><content type='html'>My pleasure!</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/81732261855488461'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/81732261855488461'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html?showComment=1348754081946#c81732261855488461' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/2186102608400317436'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-2414704032922872709' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/2414704032922872709' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='27 September 2012 at 14:54'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6876689351113026699</id><published>2012-11-10T07:11:26.586Z</published><updated>2012-11-10T07:11:26.586Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>John,

I am trying to use globalize.js to parse IS...</title><content type='html'>John,&lt;br /&gt;&lt;br /&gt;I am trying to use globalize.js to parse ISO date formats.  In general it works pretty well.  However, I strike a problem because sometimes the date string being parsed includes decisseconds, sometimes centiseconds, sometimes milliseconds and sometimes nothing!  Is there a single custom format I can use to parse the date that will handle this variability?</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5143753822429804028/comments/default/6876689351113026699'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5143753822429804028/comments/default/6876689351113026699'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/05/globalizejs-number-and-date.html?showComment=1352531486586#c6876689351113026699' title=''/><author><name>MelbourneRave</name><uri>https://www.blogger.com/profile/12639711307683241551</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/05/globalizejs-number-and-date.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-5143753822429804028' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/5143753822429804028' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-70748856'/><gd:extendedProperty name='blogger.displayTime' value='10 November 2012 at 07:11'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-250197182052629846</id><published>2012-11-21T22:19:30.840Z</published><updated>2012-11-21T22:19:30.840Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>nice post... I&amp;#39;m also interesting on Bloomberg...</title><content type='html'>nice post... I&amp;#39;m also interesting on Bloomberg simulator to test and develop at home but no news about it...&lt;br /&gt;&lt;br /&gt;please, post the response in case they reply your mail.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/250197182052629846'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/250197182052629846'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html?showComment=1353536370840#c250197182052629846' title=''/><author><name>pichulines</name><uri>https://www.blogger.com/profile/11238719866072116696</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='32' height='24' src='//photos1.blogger.com/blogger/3881/985/1600/profile.jpg'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1492382956545126674' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1492382956545126674' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-767669459'/><gd:extendedProperty name='blogger.displayTime' value='21 November 2012 at 22:19'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4190289780551332060</id><published>2012-11-22T22:27:01.999Z</published><updated>2012-11-22T22:27:01.999Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Will do - no news as yet I&amp;#39;m afraid...</title><content type='html'>Will do - no news as yet I&amp;#39;m afraid...</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/4190289780551332060'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/4190289780551332060'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html?showComment=1353623221999#c4190289780551332060' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/250197182052629846'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1492382956545126674' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1492382956545126674' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='22 November 2012 at 22:27'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-969037858349672121</id><published>2012-11-25T09:24:47.917Z</published><updated>2012-11-25T09:24:47.917Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi,

Thanks for the comment - sorry for the delay ...</title><content type='html'>Hi,&lt;br /&gt;&lt;br /&gt;Thanks for the comment - sorry for the delay in replying.  Actually I think I may have covered this in another post - check out the &amp;quot;What no ISO 8601 date string Date constructor?&amp;quot; section of this post:&lt;br /&gt;&lt;br /&gt;&lt;a href="http://icanmakethiswork.blogspot.co.uk/2012/04/beg-steal-or-borrow-decent-javascript.html" rel="nofollow"&gt;http://icanmakethiswork.blogspot.co.uk/2012/04/beg-steal-or-borrow-decent-javascript.html&lt;/a&gt;&lt;br /&gt;&lt;br /&gt;Essentially I&amp;#39;ve taken to using Nathan Vonnahme&amp;#39;s ISO 8601 JavaScript Date parser - parseISO8601Date rather than Globalize.  Hope this helps.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5143753822429804028/comments/default/969037858349672121'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5143753822429804028/comments/default/969037858349672121'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/05/globalizejs-number-and-date.html?showComment=1353835487917#c969037858349672121' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5143753822429804028/comments/default/6876689351113026699'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/05/globalizejs-number-and-date.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-5143753822429804028' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/5143753822429804028' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='25 November 2012 at 09:24'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1103918302201416833</id><published>2012-12-10T16:15:44.447Z</published><updated>2012-12-10T16:15:44.447Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Thanks for the informative post! We&amp;#39;re definit...</title><content type='html'>Thanks for the informative post! We&amp;#39;re definitely trying to improve the experience for new users of the Bloomberg Open API, and your feedback will help get things moving in the right direction.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/1103918302201416833'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/1103918302201416833'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html?showComment=1355156144447#c1103918302201416833' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/08469026033058090172</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1492382956545126674' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1492382956545126674' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-284871374'/><gd:extendedProperty name='blogger.displayTime' value='10 December 2012 at 16:15'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5395047612704882388</id><published>2012-12-11T08:53:02.163Z</published><updated>2012-12-11T08:53:02.163Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Glad to be of service Kevin!</title><content type='html'>Glad to be of service Kevin!</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/5395047612704882388'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/5395047612704882388'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html?showComment=1355215982163#c5395047612704882388' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/1103918302201416833'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1492382956545126674' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1492382956545126674' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='11 December 2012 at 08:53'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4245478455502591081</id><published>2012-12-18T15:05:31.305Z</published><updated>2012-12-18T15:05:31.305Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Is there a way to make this work for HTML content ...</title><content type='html'>Is there a way to make this work for HTML content which requires authenticated session before web-server will generate and return the desired HTML to convert to PDF?</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/4245478455502591081'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/4245478455502591081'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html?showComment=1355843131305#c4245478455502591081' title=''/><author><name>cusman</name><uri>https://www.blogger.com/profile/07258911497965551732</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-8680133602632737625' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/8680133602632737625' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1901384808'/><gd:extendedProperty name='blogger.displayTime' value='18 December 2012 at 15:05'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1556899064519729665</id><published>2012-12-18T15:06:51.956Z</published><updated>2012-12-18T15:06:51.956Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>BTW, your comments section is non-functional on Op...</title><content type='html'>BTW, your comments section is non-functional on Opera browser and forced me to use Chrome to post my simple question. Just FYI.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/1556899064519729665'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/1556899064519729665'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html?showComment=1355843211956#c1556899064519729665' title=''/><author><name>cusman</name><uri>https://www.blogger.com/profile/07258911497965551732</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-8680133602632737625' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/8680133602632737625' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1901384808'/><gd:extendedProperty name='blogger.displayTime' value='18 December 2012 at 15:06'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2722390022470327540</id><published>2012-12-18T15:51:52.210Z</published><updated>2012-12-18T15:51:52.210Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi Cusman,

Good question, and the answer is &amp;quot...</title><content type='html'>Hi Cusman,&lt;br /&gt;&lt;br /&gt;Good question, and the answer is &amp;quot;kind of&amp;quot;.  You can pass username and password into the options parameter.  If your app is set to run with Windows Authentication then this means you should be able to fire into the application authenticated as the user that you passed in (presuming your credentials were correct).&lt;br /&gt;&lt;br /&gt;If memory serves that would look a little like this: &lt;br /&gt;&lt;br /&gt;PdfGenerator.HtmlToPdf(....,&lt;br /&gt;options: new string[] { &amp;quot;--username myUserName&amp;quot;, &amp;quot;--password myPassword&amp;quot; })&lt;br /&gt;&lt;br /&gt;However, if you&amp;#39;re reliant on some kind of login screen then this just isn&amp;#39;t going to work for you.&lt;br /&gt;&lt;br /&gt;When I made use of this approach I was working on an application which made use of Windows Authentication so that was great.  However, I did have another hurdle which was the fact that I just didn&amp;#39;t have my users username and passwords (not terribly surprising).  &lt;br /&gt;&lt;br /&gt;I did come up with a workaround, which I&amp;#39;m not enormously proud of but which certainly worked.  I created a new user in our domain called &amp;quot;PdfUser&amp;quot;.  As you can probably guess this user was used to create all of our PDFs.  Our app always passed the username / password options using these same credentials so we could authenticate.  We would append the username for the desired user into the querystring.  The application had logic in place to pick this particular parameter up and switch the user context to this user (we had rolled our own internal authorisation and so could control this).  Given that this approach effectively introduced a potential back door into the system we took a few other steps for security purposes to cover that off which I won&amp;#39;t go into here.&lt;br /&gt;&lt;br /&gt;I hope this helps; though it&amp;#39;s not the cleanest solution in the world.&lt;br /&gt;&lt;br /&gt;By the way you can read the WKHTMLtoPDF documentation here for more details:&lt;br /&gt;&lt;br /&gt;&lt;a href="http://madalgo.au.dk/~jakobt/wkhtmltoxdoc/wkhtmltopdf-0.9.9-doc.html" rel="nofollow"&gt;http://madalgo.au.dk/~jakobt/wkhtmltoxdoc/wkhtmltopdf-0.9.9-doc.html&lt;/a&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/2722390022470327540'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/2722390022470327540'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html?showComment=1355845912210#c2722390022470327540' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/4245478455502591081'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-8680133602632737625' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/8680133602632737625' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='18 December 2012 at 15:51'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4474611635945525648</id><published>2013-01-03T22:35:35.428Z</published><updated>2013-01-03T22:35:35.428Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hey I just came across this when trying to point s...</title><content type='html'>Hey I just came across this when trying to point someone to a helpful example of using Moq with EF. I&amp;#39;m happy that my &amp;quot;balanced&amp;quot; position about designing repositories spoke to you. :) And while I have a lot of respect for him, I couldn&amp;#39;t help but laugh at your comment about Ladislav&amp;#39;s &amp;quot;one man war&amp;quot; against using repos with EF.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3336760366966567957/comments/default/4474611635945525648'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3336760366966567957/comments/default/4474611635945525648'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/10/unit-testing-and-entity-framework-filth.html?showComment=1357252535428#c4474611635945525648' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/18024884930595039206</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/10/unit-testing-and-entity-framework-filth.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-3336760366966567957' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/3336760366966567957' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1644992161'/><gd:extendedProperty name='blogger.displayTime' value='3 January 2013 at 22:35'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5330525594801114765</id><published>2013-01-04T09:10:14.650Z</published><updated>2013-01-04T09:10:14.650Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Thanks Julie, glad to be useful. :-)  Ladislav is ...</title><content type='html'>Thanks Julie, glad to be useful. :-)  Ladislav is certainly not half-hearted in his views! - Though I must say I&amp;#39;m glad of that as if he wasn&amp;#39;t so forceful I wonder if I would have thought about the topic as much I ended up doing.&lt;br /&gt;&lt;br /&gt;I may be about to take another look at this actually.  I remain involved in a number of projects which are driven database first.  Consequently our workflow has been:&lt;br /&gt;&lt;br /&gt;1. Database is updated&lt;br /&gt;2. DbContext / DbSets are updated using the &amp;quot;Update Model from Database...&amp;quot; functionality in the EDMX.&lt;br /&gt;3. Make changes in our custom Repository / Unit of Work wrappers for DbSet / DbContext.&lt;br /&gt;&lt;br /&gt;I&amp;#39;ve recently become aware that it&amp;#39;s possible to reverse engineer a Code First DbContext using the Entity Framework Power Tools.  So I&amp;#39;m now thinking that it may be possible to switch over to using the following workflow:&lt;br /&gt;&lt;br /&gt;1. Database is updated&lt;br /&gt;2. DbContext / DbSets are updated using the &amp;quot;Reverse Engineer Code First&amp;quot; functionality from the EF Power Tools.&lt;br /&gt;&lt;br /&gt;Im hoping this would enable us to bin our custom Repository / Unit of Work wrappers and just employ a MOQ / Fakes for unit tests.  (Whilst still having integration tests in place but actually directly using DbContext this time.)   I dont know if this will end up panning out or not  Im going to give it a try and see how feasible this is&lt;br /&gt;&lt;br /&gt;If I never mention this again then you can imagine it turned out an abject failure :-)&lt;br /&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3336760366966567957/comments/default/5330525594801114765'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3336760366966567957/comments/default/5330525594801114765'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/10/unit-testing-and-entity-framework-filth.html?showComment=1357290614650#c5330525594801114765' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3336760366966567957/comments/default/4474611635945525648'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/10/unit-testing-and-entity-framework-filth.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-3336760366966567957' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/3336760366966567957' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='4 January 2013 at 09:10'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6296138675945189536</id><published>2013-01-04T14:48:26.254Z</published><updated>2013-01-04T14:48:26.254Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>i&amp;#39;m not sure that will be a good workflow. rev...</title><content type='html'>i&amp;#39;m not sure that will be a good workflow. reverse engineer creates classes for every single table in the database and then one big context. With code first, you do have the possiblity of changing the model and the updating the database schema to reflect those schema changes. Is it possible to use that path rather than making the changes to the database?</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3336760366966567957/comments/default/6296138675945189536'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3336760366966567957/comments/default/6296138675945189536'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/10/unit-testing-and-entity-framework-filth.html?showComment=1357310906254#c6296138675945189536' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/18024884930595039206</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/10/unit-testing-and-entity-framework-filth.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-3336760366966567957' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/3336760366966567957' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1644992161'/><gd:extendedProperty name='blogger.displayTime' value='4 January 2013 at 14:48'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5532713849967145893</id><published>2013-01-04T15:15:57.685Z</published><updated>2013-01-04T15:15:57.685Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Not quite - all changes happen at a database level...</title><content type='html'>Not quite - all changes happen at a database level first rather than a code level. (This is out of my control unfortunately)&lt;br /&gt;&lt;br /&gt;Though it may be possible to reverse engineer the classes up front, keep only that which I need and then manually keep those classes in line with future database schema changes.&lt;br /&gt;&lt;br /&gt;Provided schema changes aren&amp;#39;t extreme (generally they aren&amp;#39;t) this is probably a reasonable workflow.  I must admit I&amp;#39;m a little fearful as to what a mismatch between my Code-First classes and the database schema might look like but hopefully the EF team have come up with errors that make that sort of mistake relatively easy to diagnose.&lt;br /&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3336760366966567957/comments/default/5532713849967145893'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3336760366966567957/comments/default/5532713849967145893'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/10/unit-testing-and-entity-framework-filth.html?showComment=1357312557685#c5532713849967145893' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3336760366966567957/comments/default/6296138675945189536'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/10/unit-testing-and-entity-framework-filth.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-3336760366966567957' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/3336760366966567957' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='4 January 2013 at 15:15'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5783483516578266352</id><published>2013-01-08T08:11:51.923Z</published><updated>2013-01-08T08:11:51.923Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hey nice post. Would be really interested in stand...</title><content type='html'>Hey nice post. Would be really interested in standalone simulator, have you heard anything further?</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/5783483516578266352'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/5783483516578266352'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html?showComment=1357632711923#c5783483516578266352' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/17558153705198451138</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1492382956545126674' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1492382956545126674' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-744753166'/><gd:extendedProperty name='blogger.displayTime' value='8 January 2013 at 08:11'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4798746754508622206</id><published>2013-01-08T08:49:32.786Z</published><updated>2013-01-08T08:49:32.786Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Thanks Patrick!  

Nothing definitive but I&amp;#39;ve...</title><content type='html'>Thanks Patrick!  &lt;br /&gt;&lt;br /&gt;Nothing definitive but I&amp;#39;ve heard that they&amp;#39;re hoping to ship it within the next 6 months (so by June 2013 I guess) and perhaps earlier still.  &lt;br /&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/4798746754508622206'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/4798746754508622206'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html?showComment=1357634972786#c4798746754508622206' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/5783483516578266352'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1492382956545126674' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1492382956545126674' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='8 January 2013 at 08:49'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-7888400004812063083</id><published>2013-01-11T07:49:27.415Z</published><updated>2013-01-11T07:49:27.415Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Thanks, very helpful :)</title><content type='html'>Thanks, very helpful :)</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/9066088698325396956/comments/default/7888400004812063083'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/9066088698325396956/comments/default/7888400004812063083'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/01/twitterbootstrapmvc4-meet-bootstrap.html?showComment=1357890567415#c7888400004812063083' title=''/><author><name>KiwiSkeptic</name><uri>https://www.blogger.com/profile/04304547469700761459</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/01/twitterbootstrapmvc4-meet-bootstrap.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-9066088698325396956' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/9066088698325396956' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-548568024'/><gd:extendedProperty name='blogger.displayTime' value='11 January 2013 at 07:49'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4621892126965841399</id><published>2013-01-15T18:28:18.046Z</published><updated>2013-01-15T18:28:18.046Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Thanks for the post.  Any open source api options ...</title><content type='html'>Thanks for the post.  Any open source api options as alternatives to Bloomberg until the simulator is available?</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/4621892126965841399'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/4621892126965841399'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html?showComment=1358274498046#c4621892126965841399' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/04866473695428978444</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1492382956545126674' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1492382956545126674' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-907318948'/><gd:extendedProperty name='blogger.displayTime' value='15 January 2013 at 18:28'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1026647612493152293</id><published>2013-01-16T09:35:56.769Z</published><updated>2013-01-16T09:35:56.769Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Not that I&amp;#39;m aware of, no.  If I find out abou...</title><content type='html'>Not that I&amp;#39;m aware of, no.  If I find out about any I&amp;#39;ll post here.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/1026647612493152293'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/1026647612493152293'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html?showComment=1358328956769#c1026647612493152293' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/4621892126965841399'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1492382956545126674' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1492382956545126674' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='16 January 2013 at 09:35'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3633725160665294395</id><published>2013-01-17T16:25:25.802Z</published><updated>2013-01-17T16:25:25.802Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Really Nice! straight 2the point!!!
and Yesssss Yo...</title><content type='html'>Really Nice! straight 2the point!!!&lt;br /&gt;and Yesssss You can make this work!&lt;br /&gt;cheers</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/3633725160665294395'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/3633725160665294395'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html?showComment=1358439925802#c3633725160665294395' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/16133296649231987475</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-2414704032922872709' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/2414704032922872709' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1452054616'/><gd:extendedProperty name='blogger.displayTime' value='17 January 2013 at 16:25'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5835989431114256379</id><published>2013-01-17T16:26:48.033Z</published><updated>2013-01-17T16:26:48.033Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>and yes, i forgot to thank you!!!:O
so thank you!</title><content type='html'>and yes, i forgot to thank you!!!:O&lt;br /&gt;so thank you!</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/5835989431114256379'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/5835989431114256379'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html?showComment=1358440008033#c5835989431114256379' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/3633725160665294395'/><author><name>Unknown</name><uri>https://www.blogger.com/profile/16133296649231987475</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-2414704032922872709' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/2414704032922872709' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1452054616'/><gd:extendedProperty name='blogger.displayTime' value='17 January 2013 at 16:26'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-7737151628321882535</id><published>2013-01-17T19:41:06.114Z</published><updated>2013-01-17T19:41:06.114Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>My pleasure Boris - you&amp;#39;ve made me chuckle!</title><content type='html'>My pleasure Boris - you&amp;#39;ve made me chuckle!</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/7737151628321882535'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/7737151628321882535'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html?showComment=1358451666114#c7737151628321882535' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/3633725160665294395'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-2414704032922872709' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/2414704032922872709' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='17 January 2013 at 19:41'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-9204686710012718165</id><published>2013-01-19T00:44:29.318Z</published><updated>2013-01-19T00:44:29.318Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi Anyone please point me out as how to use this w...</title><content type='html'>Hi Anyone please point me out as how to use this with SharePoint windows authentication?&lt;br /&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/9204686710012718165'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/9204686710012718165'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html?showComment=1358556269318#c9204686710012718165' title=''/><author><name>Krunal Patel</name><uri>https://www.blogger.com/profile/05771670804928417312</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-8680133602632737625' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/8680133602632737625' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1754570888'/><gd:extendedProperty name='blogger.displayTime' value='19 January 2013 at 00:44'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8932145641718042425</id><published>2013-01-19T05:52:55.536Z</published><updated>2013-01-19T05:52:55.536Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi Krunal, I have no SharePoint experience but my ...</title><content type='html'>Hi Krunal, I have no SharePoint experience but my guess is Windows Authentication is still the same.  In which case my response to Cusman above may help...</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/8932145641718042425'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/8932145641718042425'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html?showComment=1358574775536#c8932145641718042425' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/9204686710012718165'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-8680133602632737625' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/8680133602632737625' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='19 January 2013 at 05:52'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1979646780219023160</id><published>2013-01-20T03:42:41.049Z</published><updated>2013-01-20T03:42:41.049Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Everything (almost) works great! This is probably ...</title><content type='html'>Everything (almost) works great! This is probably a dumb question, but I can&amp;#39;t figure out how to get the default date to be something other than 1/1/0001. I tried &lt;br /&gt;&lt;br /&gt;    $(&amp;#39;.datepicker&amp;#39;).datepicker({&lt;br /&gt;        language: language,&lt;br /&gt;        setStartDate: &amp;#39;01/01/2012&amp;#39;&lt;br /&gt;    });&lt;br /&gt;&lt;br /&gt;But that didn&amp;#39;t seem to do it. Do you know what I might be missing?&lt;br /&gt;&lt;br /&gt;Thanks!&lt;br /&gt;Jason</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/4560332740682155168/comments/default/1979646780219023160'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/4560332740682155168/comments/default/1979646780219023160'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/01/twitterbootstrapmvc4-meet-bootstrap_14.html?showComment=1358653361049#c1979646780219023160' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/05969340065350675379</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/01/twitterbootstrapmvc4-meet-bootstrap_14.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-4560332740682155168' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/4560332740682155168' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1925005554'/><gd:extendedProperty name='blogger.displayTime' value='20 January 2013 at 03:42'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8189247606032284948</id><published>2013-01-20T06:53:27.028Z</published><updated>2013-01-20T06:53:27.028Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi Jason,

You&amp;#39;re quite right - it&amp;#39;s not r...</title><content type='html'>Hi Jason,&lt;br /&gt;&lt;br /&gt;You&amp;#39;re quite right - it&amp;#39;s not really that clear from the documentation.  Having had a little look around I think you&amp;#39;ve basically got 2 choices:&lt;br /&gt;&lt;br /&gt;1. Initialise the value of the datepicker input text element to the date you want to be your default (eg &amp;#39;01/01/2012&amp;#39;).&lt;br /&gt;&lt;br /&gt;This will mean that the datepicker is set to that value from the off.&lt;br /&gt;&lt;br /&gt;or &lt;br /&gt;&lt;br /&gt;2. Use some code like this:&lt;br /&gt;&lt;br /&gt;$(&amp;#39;.datepicker&amp;#39;).datepicker({ language: language }).datepicker(&amp;quot;setDate&amp;quot;, (Globalize.parseDate(&amp;#39;01/01/2012&amp;#39;)));&lt;br /&gt;&lt;br /&gt;This will set the date to the supplied value.&lt;br /&gt;&lt;br /&gt;If I were to contrast the 2 approaches I&amp;#39;d say that 1. is kind of the declaritive approach and 2. is the imperative. &lt;br /&gt;&lt;br /&gt;Hope this helps.&lt;br /&gt;&lt;br /&gt;John</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/4560332740682155168/comments/default/8189247606032284948'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/4560332740682155168/comments/default/8189247606032284948'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/01/twitterbootstrapmvc4-meet-bootstrap_14.html?showComment=1358664807028#c8189247606032284948' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/4560332740682155168/comments/default/1979646780219023160'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/01/twitterbootstrapmvc4-meet-bootstrap_14.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-4560332740682155168' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/4560332740682155168' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='20 January 2013 at 06:53'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1971785504768873826</id><published>2013-01-25T20:53:03.684Z</published><updated>2013-01-25T20:53:03.684Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>I found Bloomberg API Simulator over at CodePlex. ...</title><content type='html'>I found Bloomberg API Simulator over at CodePlex.  http://bemu.codeplex.com/&lt;br /&gt;&lt;br /&gt;I tested it out with my Bloomberg account and it seems to work.  It includes three examples that show how it works.  Maybe you can give it a try.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/1971785504768873826'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/1971785504768873826'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html?showComment=1359147183684#c1971785504768873826' title=''/><author><name>Jordan</name><uri>https://www.blogger.com/profile/00752922321735939230</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1492382956545126674' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1492382956545126674' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-767491329'/><gd:extendedProperty name='blogger.displayTime' value='25 January 2013 at 20:53'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1736016225322391926</id><published>2013-01-28T08:37:16.385Z</published><updated>2013-01-28T08:37:16.385Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Thanks Jordan!</title><content type='html'>Thanks Jordan!</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/1736016225322391926'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/1736016225322391926'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html?showComment=1359362236385#c1736016225322391926' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/1971785504768873826'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1492382956545126674' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1492382956545126674' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='28 January 2013 at 08:37'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2576847458639756579</id><published>2013-01-30T21:47:15.315Z</published><updated>2013-01-30T21:47:15.315Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>I hope you find it useful.  I am trying to spread ...</title><content type='html'>I hope you find it useful.  I am trying to spread the word about this project so that I can get some feedback and make it better.  I think it fills a need that nothing else fills.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/2576847458639756579'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/2576847458639756579'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html?showComment=1359582435315#c2576847458639756579' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/1971785504768873826'/><author><name>Jordan</name><uri>https://www.blogger.com/profile/00752922321735939230</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1492382956545126674' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1492382956545126674' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-767491329'/><gd:extendedProperty name='blogger.displayTime' value='30 January 2013 at 21:47'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2014917979252816633</id><published>2013-02-06T18:28:34.630Z</published><updated>2013-02-06T18:28:34.630Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Studly, mojo-risin code.  Thank you.</title><content type='html'>Studly, mojo-risin code.  Thank you.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/9066088698325396956/comments/default/2014917979252816633'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/9066088698325396956/comments/default/2014917979252816633'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/01/twitterbootstrapmvc4-meet-bootstrap.html?showComment=1360175314630#c2014917979252816633' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/12688781505760419669</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/01/twitterbootstrapmvc4-meet-bootstrap.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-9066088698325396956' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/9066088698325396956' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1246209289'/><gd:extendedProperty name='blogger.displayTime' value='6 February 2013 at 18:28'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8573806557442661600</id><published>2013-02-08T10:58:52.954Z</published><updated>2013-02-08T10:58:52.954Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Thanks for the article John.  It&amp;#39;s a topic I&amp;#...</title><content type='html'>Thanks for the article John.  It&amp;#39;s a topic I&amp;#39;ve been researching lately so found this very interesting :)</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3336760366966567957/comments/default/8573806557442661600'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3336760366966567957/comments/default/8573806557442661600'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/10/unit-testing-and-entity-framework-filth.html?showComment=1360321132954#c8573806557442661600' title=''/><author><name>phil n</name><uri>https://www.blogger.com/profile/13542662240070203417</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/10/unit-testing-and-entity-framework-filth.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-3336760366966567957' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/3336760366966567957' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-471365831'/><gd:extendedProperty name='blogger.displayTime' value='8 February 2013 at 10:58'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-9008010398274162284</id><published>2013-02-08T11:21:28.804Z</published><updated>2013-02-08T11:21:28.804Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Thanks Phil.  It is the subject that never dies!  ...</title><content type='html'>Thanks Phil.  It is the subject that never dies!  I&amp;#39;ve recently joined a new project and so been discussing this topic again with the new team.&lt;br /&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3336760366966567957/comments/default/9008010398274162284'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3336760366966567957/comments/default/9008010398274162284'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/10/unit-testing-and-entity-framework-filth.html?showComment=1360322488804#c9008010398274162284' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3336760366966567957/comments/default/8573806557442661600'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/10/unit-testing-and-entity-framework-filth.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-3336760366966567957' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/3336760366966567957' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='8 February 2013 at 11:21'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5172366758729683092</id><published>2013-02-09T09:27:43.246Z</published><updated>2013-02-09T09:27:43.246Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hello,
      Can we convert pdf to html using c# w...</title><content type='html'>Hello,&lt;br /&gt;      Can we convert pdf to html using c# without using any third party toll as well as without any dll?.&lt;br /&gt;&lt;br /&gt;Please suggest me as i need to complete my project.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/5172366758729683092'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/5172366758729683092'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html?showComment=1360402063246#c5172366758729683092' title=''/><author><name>Anonymous</name><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//resources.blogblog.com/img/blank.gif'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-8680133602632737625' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/8680133602632737625' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1995697193'/><gd:extendedProperty name='blogger.displayTime' value='9 February 2013 at 09:27'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1355529669171285922</id><published>2013-02-11T02:05:45.608Z</published><updated>2013-02-11T02:05:45.608Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Thank you. Amazing job. Very useful.</title><content type='html'>Thank you. Amazing job. Very useful.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/1355529669171285922'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/1355529669171285922'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html?showComment=1360548345608#c1355529669171285922' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/17649531548084122734</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-2414704032922872709' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/2414704032922872709' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-435218955'/><gd:extendedProperty name='blogger.displayTime' value='11 February 2013 at 02:05'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3885140611782289046</id><published>2013-02-19T16:35:19.506Z</published><updated>2013-02-19T16:35:19.506Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>John, interested in doing some Bloomberg API softw...</title><content type='html'>John, interested in doing some Bloomberg API software development ? Please contact me for more information: leonardo.horta@sparta.com.br</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/3885140611782289046'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/3885140611782289046'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html?showComment=1361291719506#c3885140611782289046' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/07538552020003448701</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1492382956545126674' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1492382956545126674' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-484272523'/><gd:extendedProperty name='blogger.displayTime' value='19 February 2013 at 16:35'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5585520373376814645</id><published>2013-02-22T11:37:44.404Z</published><updated>2013-02-22T11:37:44.404Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Looks great!
Could you share your work in a download?</title><content type='html'>Looks great!&lt;br /&gt;Could you share your work in a download?</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1867217689836748667/comments/default/5585520373376814645'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1867217689836748667/comments/default/5585520373376814645'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/02/unit-testing-mvc-controllers-mocking.html?showComment=1361533064404#c5585520373376814645' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/11856247889713338255</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/02/unit-testing-mvc-controllers-mocking.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1867217689836748667' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1867217689836748667' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1262932581'/><gd:extendedProperty name='blogger.displayTime' value='22 February 2013 at 11:37'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6599696106908646320</id><published>2013-02-22T12:09:24.612Z</published><updated>2013-02-22T12:09:24.612Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Glad you liked it Robert!  If you click on one of ...</title><content type='html'>Glad you liked it Robert!  If you click on one of the &amp;quot;This Gist&amp;quot; links at the bottom of each code section you should be taken to GitHub and you&amp;#39;ll be able to download the work there.  Or use this link:&lt;br /&gt;&lt;br /&gt;https://gist.github.com/johnnyreilly/4959924</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1867217689836748667/comments/default/6599696106908646320'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1867217689836748667/comments/default/6599696106908646320'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/02/unit-testing-mvc-controllers-mocking.html?showComment=1361534964612#c6599696106908646320' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1867217689836748667/comments/default/5585520373376814645'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/02/unit-testing-mvc-controllers-mocking.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1867217689836748667' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1867217689836748667' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='22 February 2013 at 12:09'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5182616851115974324</id><published>2013-03-03T13:23:22.012Z</published><updated>2013-03-03T13:23:22.012Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Made me laugh, I think it&amp;#39;s more &amp;quot;arrogan...</title><content type='html'>Made me laugh, I think it&amp;#39;s more &amp;quot;arrogance, thy name is software developer&amp;quot;, we&amp;#39;re a cocky bunch.  &lt;br /&gt;Excellent, articulate post as always john, you hit on some points that I&amp;#39;d forgotten.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/6463585883554513120/comments/default/5182616851115974324'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/6463585883554513120/comments/default/5182616851115974324'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/03/unit-testing-modelstate.html?showComment=1362317002012#c5182616851115974324' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/14477328715918421432</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/03/unit-testing-modelstate.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-6463585883554513120' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/6463585883554513120' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-768567001'/><gd:extendedProperty name='blogger.displayTime' value='3 March 2013 at 13:23'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-350082928547679477</id><published>2013-03-07T13:15:41.758Z</published><updated>2013-03-07T13:15:41.758Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi John,

I&amp;#39;d be very interested in how you we...</title><content type='html'>Hi John,&lt;br /&gt;&lt;br /&gt;I&amp;#39;d be very interested in how you went with the new project and any insights so far with your choice.&lt;br /&gt;&lt;br /&gt;We&amp;#39;re currently planning a huge code-base refactoring and I&amp;#39;m a bit conflicted about this subject in particular.&lt;br /&gt;&lt;br /&gt;Thanks!</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3336760366966567957/comments/default/350082928547679477'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3336760366966567957/comments/default/350082928547679477'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/10/unit-testing-and-entity-framework-filth.html?showComment=1362662141758#c350082928547679477' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3336760366966567957/comments/default/8573806557442661600'/><author><name>Unknown</name><uri>https://www.blogger.com/profile/15942458407416165193</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/10/unit-testing-and-entity-framework-filth.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-3336760366966567957' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/3336760366966567957' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-429131423'/><gd:extendedProperty name='blogger.displayTime' value='7 March 2013 at 13:15'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-7307452337294877900</id><published>2013-03-07T16:28:58.084Z</published><updated>2013-03-07T16:28:58.084Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi Alex,

I&amp;#39;m not sure that my insights have d...</title><content type='html'>Hi Alex,&lt;br /&gt;&lt;br /&gt;I&amp;#39;m not sure that my insights have developed that much as in the new project we a slightly unusual situation.  We&amp;#39;ve got a legacy database which, at least initially, we&amp;#39;re having to build on top of.  This legacy database doesn&amp;#39;t quite reflect our domain as it should be and so we&amp;#39;re starting the slightly painful exercise of establishing our own domain and having a mapping layer that moves us from the database modeling of the data to our domain model.&lt;br /&gt;&lt;br /&gt;I digress.&lt;br /&gt;&lt;br /&gt;In the end I think this is all about trade-offs and choices.  One thing I am certain of is that I&amp;#39;d probably only go with the Repository / Unit of Work patterns on top of ObjectSet / ObjectContext or DbSet / DbContext approach if I had full control of the structure of the database.  I say that as if you&amp;#39;re at the mercy of database structure changes that don&amp;#39;t particularly lend themselves to unit testing in a straightforward fashion (step forward navigation properties, lazy loading etc) then you can end up in some painful places.&lt;br /&gt;&lt;br /&gt;Hope that helps.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3336760366966567957/comments/default/7307452337294877900'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3336760366966567957/comments/default/7307452337294877900'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/10/unit-testing-and-entity-framework-filth.html?showComment=1362673738084#c7307452337294877900' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3336760366966567957/comments/default/8573806557442661600'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/10/unit-testing-and-entity-framework-filth.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-3336760366966567957' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/3336760366966567957' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='7 March 2013 at 16:28'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4843815548830788713</id><published>2013-03-14T19:16:06.037Z</published><updated>2013-03-14T19:16:06.037Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Did you see this?: http://msdn.microsoft.com/en-us...</title><content type='html'>Did you see this?: http://msdn.microsoft.com/en-us/library/gg508808(v=vs.98).aspx. It might be new(er), but it looks exactly like what you are doing. It worked great for me.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1825634548402124376/comments/default/4843815548830788713'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1825634548402124376/comments/default/4843815548830788713'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/03/jquery-unobtrusive-remote-validation.html?showComment=1363288566037#c4843815548830788713' title=''/><author><name>Robert</name><uri>https://www.blogger.com/profile/15595919503970160633</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='31' height='21' src='//bp1.blogger.com/_wUqNFVMuF8M/SBYmnc5AAmI/AAAAAAAAALo/KZ6xEvH6L-Y/S220-s31/_DSC2097.jpg'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/03/jquery-unobtrusive-remote-validation.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1825634548402124376' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1825634548402124376' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-305768664'/><gd:extendedProperty name='blogger.displayTime' value='14 March 2013 at 19:16'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3219899972324514027</id><published>2013-03-14T20:29:16.341Z</published><updated>2013-03-14T20:29:16.341Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Thanks for posting this John. I&amp;#39;m in the proce...</title><content type='html'>Thanks for posting this John. I&amp;#39;m in the process of writing my first Bloomberg API .NET app and I found your post very useful.&lt;br /&gt;&lt;br /&gt;My understanding from your post is that you need to run the .NET app on the machine where Bloomberg Terminal is running. By looking at your code I noticed that you can specify the host address/port:&lt;br /&gt;    private readonly string _serverHost;&lt;br /&gt;    private readonly int _serverPort;&lt;br /&gt;&lt;br /&gt;Do you think that is possible to run the .NET app on a remote machine? I am asking because, like you, I am using a shared Bloomberg Terminal, and it would great if I can debug the app directly on my workstation.&lt;br /&gt;&lt;br /&gt;Doru&lt;br /&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/3219899972324514027'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/3219899972324514027'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html?showComment=1363292956341#c3219899972324514027' title=''/><author><name>Doru</name><uri>https://www.blogger.com/profile/09052097293330532897</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='25' height='32' src='//4.bp.blogspot.com/-rDxDdi5LkSA/UMt2Ya3Z9-I/AAAAAAAAHMk/rkbx2AthAto/s32/Doru.jpg'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1492382956545126674' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1492382956545126674' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1228286218'/><gd:extendedProperty name='blogger.displayTime' value='14 March 2013 at 20:29'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-7569478695288658573</id><published>2013-03-15T09:19:35.445Z</published><updated>2013-03-15T09:19:35.445Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Thanks for letting me know about this Robert - I&amp;#...</title><content type='html'>Thanks for letting me know about this Robert - I&amp;#39;ll take a look!</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1825634548402124376/comments/default/7569478695288658573'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1825634548402124376/comments/default/7569478695288658573'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/03/jquery-unobtrusive-remote-validation.html?showComment=1363339175445#c7569478695288658573' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1825634548402124376/comments/default/4843815548830788713'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/03/jquery-unobtrusive-remote-validation.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1825634548402124376' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1825634548402124376' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='15 March 2013 at 09:19'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-459488812727237361</id><published>2013-03-16T20:00:55.449Z</published><updated>2013-03-16T20:00:55.449Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Followed the exact same steps, did not work for me...</title><content type='html'>Followed the exact same steps, did not work for me. I dont know why</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/9066088698325396956/comments/default/459488812727237361'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/9066088698325396956/comments/default/459488812727237361'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/01/twitterbootstrapmvc4-meet-bootstrap.html?showComment=1363464055449#c459488812727237361' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/08587890382578713564</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/01/twitterbootstrapmvc4-meet-bootstrap.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-9066088698325396956' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/9066088698325396956' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1853791525'/><gd:extendedProperty name='blogger.displayTime' value='16 March 2013 at 20:00'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8874564744028860029</id><published>2013-03-16T22:25:12.708Z</published><updated>2013-03-16T22:25:12.708Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi John,

Thanks for doing this post.

I managed t...</title><content type='html'>Hi John,&lt;br /&gt;&lt;br /&gt;Thanks for doing this post.&lt;br /&gt;&lt;br /&gt;I managed to get it working, but get a validation error &amp;#39;The field StartDate must be a date&amp;#39;  when I select anything greater than day 12 in the datepicker eg. 13/03/2015&lt;br /&gt;&lt;br /&gt;Any help appreciated.&lt;br /&gt;&lt;br /&gt;Regards,&lt;br /&gt;&lt;br /&gt;Paul (UK - Lichfield)</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/9066088698325396956/comments/default/8874564744028860029'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/9066088698325396956/comments/default/8874564744028860029'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/01/twitterbootstrapmvc4-meet-bootstrap.html?showComment=1363472712708#c8874564744028860029' title=''/><author><name>wadep</name><uri>https://www.blogger.com/profile/03945111588155254351</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/01/twitterbootstrapmvc4-meet-bootstrap.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-9066088698325396956' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/9066088698325396956' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-741792523'/><gd:extendedProperty name='blogger.displayTime' value='16 March 2013 at 22:25'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-411694376849014450</id><published>2013-03-17T06:27:57.458Z</published><updated>2013-03-17T06:27:57.458Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi Peter / Paul,

Sorry to hear you&amp;#39;ve had pro...</title><content type='html'>Hi Peter / Paul,&lt;br /&gt;&lt;br /&gt;Sorry to hear you&amp;#39;ve had problems with this.  Why don&amp;#39;t you take a look at my GitHub repo below:&lt;br /&gt;&lt;br /&gt;https://github.com/johnnyreilly/BootstrapMvcSample&lt;br /&gt;&lt;br /&gt;This has the (internationalised I think) version of the Bootstrap datepicker in place and should prove a useful example for you....</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/9066088698325396956/comments/default/411694376849014450'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/9066088698325396956/comments/default/411694376849014450'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/01/twitterbootstrapmvc4-meet-bootstrap.html?showComment=1363501677458#c411694376849014450' title=''/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/01/twitterbootstrapmvc4-meet-bootstrap.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-9066088698325396956' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/9066088698325396956' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='17 March 2013 at 06:27'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4648446236333696685</id><published>2013-03-17T14:27:45.365Z</published><updated>2013-03-17T14:27:45.365Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi John,

Excellent! Got it working:)

Your GitHub...</title><content type='html'>Hi John,&lt;br /&gt;&lt;br /&gt;Excellent! Got it working:)&lt;br /&gt;&lt;br /&gt;Your GitHub really helped.&lt;br /&gt;&lt;br /&gt;Thank you.&lt;br /&gt;&lt;br /&gt;Regards,&lt;br /&gt;&lt;br /&gt;Paul</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/9066088698325396956/comments/default/4648446236333696685'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/9066088698325396956/comments/default/4648446236333696685'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/01/twitterbootstrapmvc4-meet-bootstrap.html?showComment=1363530465365#c4648446236333696685' title=''/><author><name>wadep</name><uri>https://www.blogger.com/profile/03945111588155254351</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/01/twitterbootstrapmvc4-meet-bootstrap.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-9066088698325396956' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/9066088698325396956' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-741792523'/><gd:extendedProperty name='blogger.displayTime' value='17 March 2013 at 14:27'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2351662836945614116</id><published>2013-03-21T11:44:59.135Z</published><updated>2013-03-21T11:44:59.135Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Wowww!!!!! Looking for 3 days to solve this issue....</title><content type='html'>Wowww!!!!! Looking for 3 days to solve this issue... You were the only one who made it working in few simple steps! Thanks!</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/2351662836945614116'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/2351662836945614116'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html?showComment=1363866299135#c2351662836945614116' title=''/><author><name>Evdin URSAN</name><uri>https://www.blogger.com/profile/05206893602690232681</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='31' height='21' src='//bp0.blogger.com/_jcpeM9Y9xBc/SIguGFeePAI/AAAAAAAAAS8/SHqzf8X60AI/S220-s31/Sovata_-_Drumul_spre_casa_-_18_Iulie_2008_143.JPG'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-2414704032922872709' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/2414704032922872709' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1181309947'/><gd:extendedProperty name='blogger.displayTime' value='21 March 2013 at 11:44'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-7978448531933519612</id><published>2013-03-23T10:30:58.629Z</published><updated>2013-03-23T10:30:58.629Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hello, thanks very much for your sol, but I am won...</title><content type='html'>Hello, thanks very much for your sol, but I am wondering, does this work for local urls ?? or should it be online?</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/7978448531933519612'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/7978448531933519612'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html?showComment=1364034658629#c7978448531933519612' title=''/><author><name> </name><uri>https://www.blogger.com/profile/15943694900950994383</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-8680133602632737625' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/8680133602632737625' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-856662691'/><gd:extendedProperty name='blogger.displayTime' value='23 March 2013 at 10:30'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6372641647451311159</id><published>2013-03-23T12:10:16.697Z</published><updated>2013-03-23T12:10:16.697Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>It works equally well for either!</title><content type='html'>It works equally well for either!</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/6372641647451311159'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/6372641647451311159'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html?showComment=1364040616697#c6372641647451311159' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/7978448531933519612'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-8680133602632737625' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/8680133602632737625' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='23 March 2013 at 12:10'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1536225568637728309</id><published>2013-03-30T16:46:24.642Z</published><updated>2013-03-30T16:46:24.642Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>aah, great great work! Thanks.</title><content type='html'>aah, great great work! Thanks.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/9066088698325396956/comments/default/1536225568637728309'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/9066088698325396956/comments/default/1536225568637728309'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/01/twitterbootstrapmvc4-meet-bootstrap.html?showComment=1364661984642#c1536225568637728309' title=''/><author><name>Thuto Paul Gaotingwe ideas</name><uri>https://www.blogger.com/profile/16019328772511450168</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/01/twitterbootstrapmvc4-meet-bootstrap.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-9066088698325396956' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/9066088698325396956' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-183081413'/><gd:extendedProperty name='blogger.displayTime' value='30 March 2013 at 16:46'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6970228943751672551</id><published>2013-04-02T13:21:58.930+01:00</published><updated>2013-04-02T13:21:58.930+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hello, 

I am not so familiar with bloomberg API, ...</title><content type='html'>Hello, &lt;br /&gt;&lt;br /&gt;I am not so familiar with bloomberg API, so sorry for my simple question:&lt;br /&gt;&lt;br /&gt;I have question about this string:&lt;br /&gt;public BloombergApi(string serverHost = &amp;quot;localhost&amp;quot;, int serverPort = 8194)&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;I thought that I should connect to the boomberg&amp;#39;s servers directly to make API request. &lt;br /&gt;But as I see I should install some service on localhost:8194 and make request to this service, am I right ?&lt;br /&gt;If yes, where can I get this software ?&lt;br /&gt;Do I need bloomberg terminal to use their API ?&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;Thank you very much.&lt;br /&gt;&lt;br /&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/6970228943751672551'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/6970228943751672551'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html?showComment=1364905318930#c6970228943751672551' title=''/><author><name>123</name><uri>https://www.blogger.com/profile/15415118861451822828</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1492382956545126674' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1492382956545126674' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-760709371'/><gd:extendedProperty name='blogger.displayTime' value='2 April 2013 at 13:21'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3365477531219951940</id><published>2013-04-02T14:15:58.752+01:00</published><updated>2013-04-02T14:15:58.752+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>There are no publicly available Bloomberg API serv...</title><content type='html'>There are no publicly available Bloomberg API servers; in order to use the API to access market data, you need a Bloomberg service subscription of some form. With that subscription in place, you would have connection information and authentication credentials to supply to make the API connection.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/3365477531219951940'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/3365477531219951940'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html?showComment=1364908558752#c3365477531219951940' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/08469026033058090172</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1492382956545126674' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1492382956545126674' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-284871374'/><gd:extendedProperty name='blogger.displayTime' value='2 April 2013 at 14:15'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3213674217295419681</id><published>2013-04-13T17:36:41.761+01:00</published><updated>2013-04-13T17:36:41.761+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Finally a sample that works.  thanks.</title><content type='html'>Finally a sample that works.  thanks.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/9066088698325396956/comments/default/3213674217295419681'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/9066088698325396956/comments/default/3213674217295419681'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/01/twitterbootstrapmvc4-meet-bootstrap.html?showComment=1365871001761#c3213674217295419681' title=''/><author><name>Marnee</name><uri>https://www.blogger.com/profile/11113570768738120302</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='32' height='21' src='//1.bp.blogspot.com/-RwOkZlYIgJU/UWmJtrBviBI/AAAAAAAAAAk/kiKo8JIMwLg/s32/CouchProfile.jpg'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/01/twitterbootstrapmvc4-meet-bootstrap.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-9066088698325396956' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/9066088698325396956' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-381479586'/><gd:extendedProperty name='blogger.displayTime' value='13 April 2013 at 17:36'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4503782491395816064</id><published>2013-04-14T17:37:29.464+01:00</published><updated>2013-04-14T17:37:29.464+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi Doru, I also have the need to remotely debug on...</title><content type='html'>Hi Doru, I also have the need to remotely debug on my pc on a remote bloomberg terminal, did you have any success trying to connect to it remotely ? &lt;br /&gt;Thx&lt;br /&gt;Giacomo&lt;br /&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/4503782491395816064'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/4503782491395816064'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html?showComment=1365957449464#c4503782491395816064' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/3219899972324514027'/><author><name>Skyline</name><uri>https://www.blogger.com/profile/10682126052401358793</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1492382956545126674' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1492382956545126674' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-480036524'/><gd:extendedProperty name='blogger.displayTime' value='14 April 2013 at 17:37'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1944714215957883887</id><published>2013-04-15T08:35:39.591+01:00</published><updated>2013-04-15T08:35:39.591+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi Doru,

I suspect it&amp;#39;s possible but I haven&amp;...</title><content type='html'>Hi Doru,&lt;br /&gt;&lt;br /&gt;I suspect it&amp;#39;s possible but I haven&amp;#39;t tried it.  I&amp;#39;d imagine you may have do jump through a few permissioning hoops.&lt;br /&gt;&lt;br /&gt;Give it a go I say - I&amp;#39;d be interested to know if it&amp;#39;s a success...&lt;br /&gt;&lt;br /&gt;John  </content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/1944714215957883887'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/1944714215957883887'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html?showComment=1366011339591#c1944714215957883887' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/3219899972324514027'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1492382956545126674' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1492382956545126674' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='15 April 2013 at 08:35'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1623659561321137739</id><published>2013-04-15T11:35:31.107+01:00</published><updated>2013-04-15T11:35:31.107+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Well I tried in one remote pc where is running Blo...</title><content type='html'>Well I tried in one remote pc where is running Bloomberg terminal , but even I setup a dyndns account and routed port 8194 to the correct pc , I&amp;#39;m not able to connect through the test program written in .net which is working fine if I run directly on the remote bloomberg pc. &lt;br /&gt;Maybe I have to double check the connections routing.&lt;br /&gt;If I&amp;#39;ll discover something I&amp;#39;ll let you know...&lt;br /&gt;&lt;br /&gt;Cheers,&lt;br /&gt;Giacomo</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/1623659561321137739'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/1623659561321137739'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html?showComment=1366022131107#c1623659561321137739' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/3219899972324514027'/><author><name>Skyline</name><uri>https://www.blogger.com/profile/10682126052401358793</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1492382956545126674' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1492382956545126674' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-480036524'/><gd:extendedProperty name='blogger.displayTime' value='15 April 2013 at 11:35'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3973125934073902194</id><published>2013-04-15T14:56:39.673+01:00</published><updated>2013-04-15T14:56:39.673+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>A Bloomberg Professional Service terminal only sup...</title><content type='html'>A Bloomberg Professional Service terminal only supports API applications running on the same PC as the terminal itself (this is a contractual obligation in the license for the terminal). It does not allow connections from API clients to the terminal from any other systems.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/3973125934073902194'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/3973125934073902194'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html?showComment=1366034199673#c3973125934073902194' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/3219899972324514027'/><author><name>Unknown</name><uri>https://www.blogger.com/profile/08469026033058090172</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1492382956545126674' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1492382956545126674' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-284871374'/><gd:extendedProperty name='blogger.displayTime' value='15 April 2013 at 14:56'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2801400946779749409</id><published>2013-04-15T15:25:54.277+01:00</published><updated>2013-04-15T15:25:54.277+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Well that sounds pretty definitive - thanks Kevin.</title><content type='html'>Well that sounds pretty definitive - thanks Kevin.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/2801400946779749409'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/2801400946779749409'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html?showComment=1366035954277#c2801400946779749409' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/3219899972324514027'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1492382956545126674' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1492382956545126674' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='15 April 2013 at 15:25'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4652327409579559517</id><published>2013-04-15T15:31:35.581+01:00</published><updated>2013-04-15T15:31:35.581+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Thx for point that out I guess there was some limi...</title><content type='html'>Thx for point that out I guess there was some limitation in contract. Btw this means that the whole open api bloomberg stuff are quite useless if developer is not the bloomberg terminal owner. Actually to develop something for my client I have to blindly write code (without any way to debug what I wrote on my pc), then send whole project to client&amp;#39;s pc to see if it&amp;#39;s working as intended and repeat so on...a waste of time.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/4652327409579559517'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/4652327409579559517'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html?showComment=1366036295581#c4652327409579559517' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/3219899972324514027'/><author><name>Skyline</name><uri>https://www.blogger.com/profile/10682126052401358793</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1492382956545126674' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1492382956545126674' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-480036524'/><gd:extendedProperty name='blogger.displayTime' value='15 April 2013 at 15:31'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6954643690352348637</id><published>2013-04-15T15:35:06.120+01:00</published><updated>2013-04-15T15:35:06.120+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>If you look at the remainder of this page, you&amp;#39...</title><content type='html'>If you look at the remainder of this page, you&amp;#39;ll see that this has been discussed in a number of different ways. We&amp;#39;re fully aware of the problems caused by the lack of a simulator/testing tool, and we&amp;#39;re actively working on addressing that, but it is taking more time than we planned.&lt;br /&gt;&lt;br /&gt;If you are developing an application for your client, you can ask them to get you a temporary terminal license, so you can install the terminal on your own system. They should be easily able to add a terminal to their account, although if the development time period is short this may be more expense than they are willing to bear.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/6954643690352348637'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/6954643690352348637'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html?showComment=1366036506120#c6954643690352348637' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/3219899972324514027'/><author><name>Unknown</name><uri>https://www.blogger.com/profile/08469026033058090172</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1492382956545126674' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1492382956545126674' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-284871374'/><gd:extendedProperty name='blogger.displayTime' value='15 April 2013 at 15:35'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8066425488748707272</id><published>2013-04-15T16:02:25.247+01:00</published><updated>2013-04-15T16:02:25.247+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Thank for suggest , I will tell to my client if it...</title><content type='html'>Thank for suggest , I will tell to my client if it&amp;#39;s possible to install temp terminal license, it will be far better to debug and develop more easily.&lt;br /&gt;&lt;br /&gt;Cheers,&lt;br /&gt;Giacomo&lt;br /&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/8066425488748707272'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/8066425488748707272'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html?showComment=1366038145247#c8066425488748707272' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/3219899972324514027'/><author><name>Skyline</name><uri>https://www.blogger.com/profile/10682126052401358793</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1492382956545126674' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1492382956545126674' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-480036524'/><gd:extendedProperty name='blogger.displayTime' value='15 April 2013 at 16:02'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4555742646221113763</id><published>2013-04-25T08:20:04.839+01:00</published><updated>2013-04-25T08:20:04.839+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Image display in HTML but not in PDF using WKHTMLT...</title><content type='html'>Image display in HTML but not in PDF using WKHTMLTOPDF:&lt;br /&gt;&lt;br /&gt;Hi am using Wkhtmltopdf to create PDF from Html page using c#, Asp.net. PDF are created smoothly, but when I add images to HTML it does not get displayed on PDF.&lt;br /&gt;&lt;br /&gt;This is my HTML code area to display Image..&lt;br /&gt;&lt;br /&gt; src=&amp;quot;../TempLogo/chafa.jpg&amp;quot;&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;I have used &amp;quot;file:///E:/AMS/AMS/AMS.WEB/TempLogo/chafa.jpg&amp;quot; &amp;amp; &amp;quot;src=&amp;quot;localhost:5822/AMS.WEB/TempLogo/chafa.jpg&amp;quot;; also but it does not work. I also tried to change Version from 0.11 to 0.9 but it also not succeed .&lt;br /&gt;&lt;br /&gt;I have used your code , it works fine with google.com but does not work in my site.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/4555742646221113763'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/4555742646221113763'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html?showComment=1366874404839#c4555742646221113763' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/12250610612501746999</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-8680133602632737625' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/8680133602632737625' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-694139345'/><gd:extendedProperty name='blogger.displayTime' value='25 April 2013 at 08:20'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-891015863737012381</id><published>2013-04-25T09:09:13.645+01:00</published><updated>2013-04-25T09:09:13.645+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi Sanjay,

Without seeing the code I&amp;#39;d have t...</title><content type='html'>Hi Sanjay,&lt;br /&gt;&lt;br /&gt;Without seeing the code I&amp;#39;d have to guess that it&amp;#39;s probably something to do with using a relative path.  I&amp;#39;d steer away from 0.11 as last time I used it it was very unreliable.&lt;br /&gt;&lt;br /&gt;My advice is to try again using 0.9 and ensure that your src is fully qualified (looks something like this: http://localhost:5822/AMS.WEB/TempLogo/chafa.jpg )&lt;br /&gt;&lt;br /&gt;Sorry I can&amp;#39;t be of more help.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/891015863737012381'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/891015863737012381'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html?showComment=1366877353645#c891015863737012381' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/4555742646221113763'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-8680133602632737625' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/8680133602632737625' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='25 April 2013 at 09:09'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8715823915942428791</id><published>2013-04-25T09:45:17.172+01:00</published><updated>2013-04-25T09:45:17.172+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>My code:

     var pdfUrl = AMS.BAL.PDF_Generater....</title><content type='html'>My code:&lt;br /&gt;&lt;br /&gt;     var pdfUrl = AMS.BAL.PDF_Generater.HtmlToPdf(pdfOutputLocation: &amp;quot;~/ExcelData/&amp;quot;,&lt;br /&gt;   outputFilenamePrefix: &amp;quot;InvoicePDF&amp;quot;,&lt;br /&gt;   urls: new string[] { &amp;quot;..//HTMLTemplates//temp.html&amp;quot; });&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&lt;br /&gt; public static string HtmlToPdf(string pdfOutputLocation, string outputFilenamePrefix, string[] urls,&lt;br /&gt;            string[] options = null,&lt;br /&gt;            // string pdfHtmlToPdfExePath = &amp;quot;C:\\Program Files (x86)\\wkhtmltopdf\\wkhtmltopdf.exe&amp;quot;)&lt;br /&gt;&lt;br /&gt;           string pdfHtmlToPdfExePath = &amp;quot;C:\\Program Files\\wkhtmltopdf\\wkhtmltopdf.exe&amp;quot;)&lt;br /&gt;        {&lt;br /&gt;            string urlsSeparatedBySpaces = string.Empty;&lt;br /&gt;            try&lt;br /&gt;            {&lt;br /&gt;                //Determine inputs&lt;br /&gt;                if ((urls == null) || (urls.Length == 0))&lt;br /&gt;                    throw new Exception(&amp;quot;No input URLs provided for HtmlToPdf&amp;quot;);&lt;br /&gt;                else&lt;br /&gt;                    urlsSeparatedBySpaces = String.Join(&amp;quot; &amp;quot;, urls); //Concatenate URLs&lt;br /&gt;&lt;br /&gt;                string outputFolder = pdfOutputLocation;&lt;br /&gt;                string outputFilename = outputFilenamePrefix + &amp;quot;_&amp;quot; + DateTime.Now.ToString(&amp;quot;yyyy-MM-dd-hh-mm-ss-fff&amp;quot;) + &amp;quot;.PDF&amp;quot;; // assemble destination PDF file name&lt;br /&gt;&lt;br /&gt;                var p = new System.Diagnostics.Process()&lt;br /&gt;                {&lt;br /&gt;                    StartInfo =&lt;br /&gt;                    {&lt;br /&gt;                        FileName = pdfHtmlToPdfExePath,&lt;br /&gt;                        Arguments = ((options == null) ? &amp;quot;&amp;quot; : String.Join(&amp;quot; &amp;quot;, options)) + &amp;quot; &amp;quot; + urlsSeparatedBySpaces + &amp;quot; &amp;quot; + outputFilename,&lt;br /&gt;                        UseShellExecute = false, // needs to be false in order to redirect output&lt;br /&gt;                        RedirectStandardOutput = true,&lt;br /&gt;                        RedirectStandardError = true,&lt;br /&gt;                        RedirectStandardInput = true, // redirect all 3, as it should be all 3 or none&lt;br /&gt;                        WorkingDirectory = HttpContext.Current.Server.MapPath(outputFolder),&lt;br /&gt;                        CreateNoWindow = true&lt;br /&gt;                    }&lt;br /&gt;                };&lt;br /&gt;&lt;br /&gt;                p.Start();&lt;br /&gt;&lt;br /&gt;                // read the output here...&lt;br /&gt;                var output = p.StandardOutput.ReadToEnd();&lt;br /&gt;                var errorOutput = p.StandardError.ReadToEnd();&lt;br /&gt;&lt;br /&gt;                // ...then wait n milliseconds for exit (as after exit, it can&amp;#39;t read the output)&lt;br /&gt;                p.WaitForExit(60000);&lt;br /&gt;&lt;br /&gt;                // read the exit code, close process&lt;br /&gt;                int returnCode = p.ExitCode;&lt;br /&gt;                p.Close();&lt;br /&gt;&lt;br /&gt;                // if 0 or 2, it worked so return path of pdf&lt;br /&gt;                if ((returnCode == 0) || (returnCode == 2))&lt;br /&gt;                    return outputFolder + outputFilename;&lt;br /&gt;                else&lt;br /&gt;                    throw new Exception(errorOutput);&lt;br /&gt;            }&lt;br /&gt;            catch (Exception exc)&lt;br /&gt;            {&lt;br /&gt;                throw new Exception(&amp;quot;Problem generating PDF from HTML, URLs: &amp;quot; + urlsSeparatedBySpaces + &amp;quot;, outputFilename: &amp;quot; + outputFilenamePrefix, exc);&lt;br /&gt;            }&lt;br /&gt;        }&lt;br /&gt;    }</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/8715823915942428791'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/8715823915942428791'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html?showComment=1366879517172#c8715823915942428791' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/12250610612501746999</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-8680133602632737625' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/8680133602632737625' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-694139345'/><gd:extendedProperty name='blogger.displayTime' value='25 April 2013 at 09:45'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2806695557723788484</id><published>2013-04-25T15:26:07.701+01:00</published><updated>2013-04-25T15:26:07.701+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Sorry for the silly question. This is my first att...</title><content type='html'>Sorry for the silly question. This is my first attempt to work with Bloomberg database. My client wants a tool in c# to get the company information from Bloomberg based on the ticker provided. &lt;br /&gt;&lt;br /&gt;He is having the Bloomberg license. If we install the application in his machine, what should be the ServerHost and ServerPort number? Can we give the same &amp;quot;localhost&amp;quot; and &amp;quot;8194&amp;quot; or will it vary? Moreover, do we need pass any user credentials to the server, even if we installed Bloomberg Terminal in his machine?&lt;br /&gt;&lt;br /&gt;Thanks in advance. It is really urgent.&lt;br /&gt;&lt;br /&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/2806695557723788484'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/2806695557723788484'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html?showComment=1366899967701#c2806695557723788484' title=''/><author><name>vijay</name><uri>https://www.blogger.com/profile/16546588732095287782</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1492382956545126674' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1492382956545126674' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-565046616'/><gd:extendedProperty name='blogger.displayTime' value='25 April 2013 at 15:26'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4793250094596508057</id><published>2013-04-25T15:28:04.060+01:00</published><updated>2013-04-25T15:28:04.060+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>If you are running your application on the same ma...</title><content type='html'>If you are running your application on the same machine where the Bloomberg Professional terminal is running, you won&amp;#39;t need to do anything special at all. The API libraries can connect to port 8194 on localhost, and no authentication is needed.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/4793250094596508057'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/4793250094596508057'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html?showComment=1366900084060#c4793250094596508057' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/2806695557723788484'/><author><name>Unknown</name><uri>https://www.blogger.com/profile/08469026033058090172</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1492382956545126674' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1492382956545126674' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-284871374'/><gd:extendedProperty name='blogger.displayTime' value='25 April 2013 at 15:28'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-261800195788936959</id><published>2013-04-26T05:16:24.831+01:00</published><updated>2013-04-26T05:16:24.831+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Thanks you very much.</title><content type='html'>Thanks you very much.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/261800195788936959'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/261800195788936959'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html?showComment=1366949784831#c261800195788936959' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/2806695557723788484'/><author><name>vijay</name><uri>https://www.blogger.com/profile/16546588732095287782</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1492382956545126674' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1492382956545126674' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-565046616'/><gd:extendedProperty name='blogger.displayTime' value='26 April 2013 at 05:16'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1964516534123326667</id><published>2013-04-27T16:28:58.864+01:00</published><updated>2013-04-27T16:28:58.864+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Can u please give me a sample code to get EQY_FUND...</title><content type='html'>Can u please give me a sample code to get EQY_FUND_TICKER, ID_CUSIP, ID_ISIN, GICS_SECTOR_NAME, COUNTRY, COMPANY_ADDRESS from bloomberg. I don&amp;#39;t find any of the above field in the example documentation provided by Bloomberg Open source API. </content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/1964516534123326667'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/1964516534123326667'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html?showComment=1367076538864#c1964516534123326667' title=''/><author><name>vijay</name><uri>https://www.blogger.com/profile/16546588732095287782</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1492382956545126674' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1492382956545126674' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-565046616'/><gd:extendedProperty name='blogger.displayTime' value='27 April 2013 at 16:28'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1766225317691273011</id><published>2013-04-29T10:06:47.167+01:00</published><updated>2013-04-29T10:06:47.167+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hey John,

Great post! I arrived at virtually the ...</title><content type='html'>Hey John,&lt;br /&gt;&lt;br /&gt;Great post! I arrived at virtually the same solution (I use validator.pendingRequest in the interval though) but wondered if you had come across an issue where you have, say, a required field, click save, it is marked invalid, but if you correct it before the interval has done its thing, it will reset the validator or something and submit the form as part of the previous request!? Really has me stumped.&lt;br /&gt;&lt;br /&gt;Gus </content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1825634548402124376/comments/default/1766225317691273011'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1825634548402124376/comments/default/1766225317691273011'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/03/jquery-unobtrusive-remote-validation.html?showComment=1367226407167#c1766225317691273011' title=''/><author><name>guspalmer24</name><uri>https://www.blogger.com/profile/05338177199905267316</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/03/jquery-unobtrusive-remote-validation.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1825634548402124376' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1825634548402124376' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-71525133'/><gd:extendedProperty name='blogger.displayTime' value='29 April 2013 at 10:06'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-365225578032537759</id><published>2013-04-29T11:42:10.508+01:00</published><updated>2013-04-29T11:42:10.508+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi Gus,

Glad you enjoyed it! I&amp;#39;m not sure if ...</title><content type='html'>Hi Gus,&lt;br /&gt;&lt;br /&gt;Glad you enjoyed it! I&amp;#39;m not sure if I have encountered the issue you mentioned but I&amp;#39;ve got a vague recollection of seeing something on GitHub (I follow jQuery Validate) around the re-ordering of firing of validations to ensure that remote validation was last in line to fire.&lt;br /&gt;&lt;br /&gt;I *think* that this may have gone in with the latest version of jQuery Validation (1.11) but I&amp;#39;m not certain.  You could try upgrading to this and see if that addresses your issue..</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1825634548402124376/comments/default/365225578032537759'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1825634548402124376/comments/default/365225578032537759'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/03/jquery-unobtrusive-remote-validation.html?showComment=1367232130508#c365225578032537759' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1825634548402124376/comments/default/1766225317691273011'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/03/jquery-unobtrusive-remote-validation.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1825634548402124376' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1825634548402124376' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='29 April 2013 at 11:42'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4373831194187340379</id><published>2013-04-29T17:08:48.748+01:00</published><updated>2013-04-29T17:08:48.748+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>This is really not a good place for technical help...</title><content type='html'>This is really not a good place for technical help with the Bloomberg API. I suggest that you contact the Bloomberg help desk for assistance, as there are team members there that are trained in helping developers use the API.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/4373831194187340379'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/4373831194187340379'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html?showComment=1367251728748#c4373831194187340379' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/08469026033058090172</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1492382956545126674' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1492382956545126674' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-284871374'/><gd:extendedProperty name='blogger.displayTime' value='29 April 2013 at 17:08'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5458867851587240784</id><published>2013-05-10T05:48:21.803+01:00</published><updated>2013-05-10T05:48:21.803+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Thank you fixed my problem as well. Like you I had...</title><content type='html'>Thank you fixed my problem as well. Like you I had 2 Internet Explorers in the list and not able to debug JS. The really annoying thing for me was that when I exited IE it would not stop the debugger. The problem appeared when I updated from IE9 to IE10 as well (I am running Win 7 x64)&lt;br /&gt;Followed your instructions and now working perfectly, thanks again!</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/4158515250667393929/comments/default/5458867851587240784'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/4158515250667393929/comments/default/5458867851587240784'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/04/ie-10-install-torches-javascript.html?showComment=1368161301803#c5458867851587240784' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/00111419265402475601</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/04/ie-10-install-torches-javascript.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-4158515250667393929' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/4158515250667393929' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1510476954'/><gd:extendedProperty name='blogger.displayTime' value='10 May 2013 at 05:48'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2054415941833336636</id><published>2013-05-10T08:45:30.769+01:00</published><updated>2013-05-10T08:45:30.769+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Glad to hear it!  I was running Windows Server 200...</title><content type='html'>Glad to hear it!  I was running Windows Server 2008 when it happened to me so it&amp;#39;s good to know that different OS&amp;#39;s are affected alike.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/4158515250667393929/comments/default/2054415941833336636'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/4158515250667393929/comments/default/2054415941833336636'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/04/ie-10-install-torches-javascript.html?showComment=1368171930769#c2054415941833336636' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/4158515250667393929/comments/default/5458867851587240784'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/04/ie-10-install-torches-javascript.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-4158515250667393929' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/4158515250667393929' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='10 May 2013 at 08:45'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-401057670333350044</id><published>2013-05-10T15:07:00.884+01:00</published><updated>2013-05-10T15:07:00.884+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Thanks for the article.
What do you think about a ...</title><content type='html'>Thanks for the article.&lt;br /&gt;What do you think about a in-memory database test approach? I think that it could be a good solution to have testing without having to write code to implement the Repository/Unit Of Work pattern that, in case of medium/small projects can be oversized. What do you think about this?&lt;br /&gt;Thanks.&lt;br /&gt;Federico</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3336760366966567957/comments/default/401057670333350044'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3336760366966567957/comments/default/401057670333350044'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/10/unit-testing-and-entity-framework-filth.html?showComment=1368194820884#c401057670333350044' title=''/><author><name>Federico Orlandini</name><uri>https://www.blogger.com/profile/10378158313072412759</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/10/unit-testing-and-entity-framework-filth.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-3336760366966567957' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/3336760366966567957' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1071696622'/><gd:extendedProperty name='blogger.displayTime' value='10 May 2013 at 15:07'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3682787374818420579</id><published>2013-05-10T15:22:20.481+01:00</published><updated>2013-05-10T15:22:20.481+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi Federico,

Thanks for that.  I haven&amp;#39;t seen...</title><content type='html'>Hi Federico,&lt;br /&gt;&lt;br /&gt;Thanks for that.  I haven&amp;#39;t seen an in-memory database test approach demonstrated so I can&amp;#39;t really say.  It sounds quite promising but I&amp;#39;d have to see it in action to form a view.  I guess the &amp;quot;must have&amp;quot; would be that it performed the exact same operations as an actual database (so LINQ to Entities not LINQ to Objects).&lt;br /&gt;&lt;br /&gt;If you&amp;#39;ve a good example in mind then do point me to it - I&amp;#39;m interested!</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3336760366966567957/comments/default/3682787374818420579'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3336760366966567957/comments/default/3682787374818420579'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/10/unit-testing-and-entity-framework-filth.html?showComment=1368195740481#c3682787374818420579' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3336760366966567957/comments/default/401057670333350044'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/10/unit-testing-and-entity-framework-filth.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-3336760366966567957' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/3336760366966567957' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='10 May 2013 at 15:22'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5598678759718536278</id><published>2013-06-03T16:23:49.615+01:00</published><updated>2013-06-03T16:23:49.615+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Only works in IE10 mode.  If you add 

meta http-e...</title><content type='html'>Only works in IE10 mode.  If you add &lt;br /&gt;&lt;br /&gt;meta http-equiv=&amp;quot;X-UA-Compatible&amp;quot; content=&amp;quot;IE=9&amp;quot;&lt;br /&gt;&lt;br /&gt;to force IE9 mode so anyone else that gets upgraded uses the correct mode, then this doesn&amp;#39;t work :(</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1965872403036778857/comments/default/5598678759718536278'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1965872403036778857/comments/default/5598678759718536278'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/04/making-ie-10s-clear-field-x-button-and.html?showComment=1370273029615#c5598678759718536278' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/17574374233217042863</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/04/making-ie-10s-clear-field-x-button-and.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1965872403036778857' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1965872403036778857' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-172696459'/><gd:extendedProperty name='blogger.displayTime' value='3 June 2013 at 16:23'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8844974048953552695</id><published>2013-06-03T16:44:10.460+01:00</published><updated>2013-06-03T16:44:10.460+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>That&amp;#39;s a shame.  Though I&amp;#39;m quite surprise...</title><content type='html'>That&amp;#39;s a shame.  Though I&amp;#39;m quite surprised you&amp;#39;re looking to use X-UA-Compatible to force you into the IE9 compatible mode.  Would you not rather go with the default rendering engine - my experience has been that the compatibility modes come with a few bugs which is why I try to avoid them...</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1965872403036778857/comments/default/8844974048953552695'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1965872403036778857/comments/default/8844974048953552695'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/04/making-ie-10s-clear-field-x-button-and.html?showComment=1370274250460#c8844974048953552695' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1965872403036778857/comments/default/5598678759718536278'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/04/making-ie-10s-clear-field-x-button-and.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1965872403036778857' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1965872403036778857' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='3 June 2013 at 16:44'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-7110785153098132460</id><published>2013-06-28T12:56:01.351+01:00</published><updated>2013-06-28T12:56:01.351+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Fantastic, simple and clear!

Thanks!</title><content type='html'>Fantastic, simple and clear!&lt;br /&gt;&lt;br /&gt;Thanks!</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1965872403036778857/comments/default/7110785153098132460'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1965872403036778857/comments/default/7110785153098132460'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/04/making-ie-10s-clear-field-x-button-and.html?showComment=1372420561351#c7110785153098132460' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/17361181648358981115</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/04/making-ie-10s-clear-field-x-button-and.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1965872403036778857' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1965872403036778857' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-73845941'/><gd:extendedProperty name='blogger.displayTime' value='28 June 2013 at 12:56'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1732541418259697806</id><published>2013-06-28T13:29:12.836+01:00</published><updated>2013-06-28T13:29:12.836+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>My pleasure!</title><content type='html'>My pleasure!</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1965872403036778857/comments/default/1732541418259697806'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1965872403036778857/comments/default/1732541418259697806'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/04/making-ie-10s-clear-field-x-button-and.html?showComment=1372422552836#c1732541418259697806' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1965872403036778857/comments/default/7110785153098132460'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/04/making-ie-10s-clear-field-x-button-and.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1965872403036778857' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1965872403036778857' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='28 June 2013 at 13:29'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8015981463366435776</id><published>2013-07-03T13:54:20.006+01:00</published><updated>2013-07-03T14:58:01.410+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'></title><content type='html'>This comment has been removed by the author.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/8015981463366435776'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/8015981463366435776'/><author><name>Unknown</name><uri>https://www.blogger.com/profile/09118138094016227980</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-8680133602632737625' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/8680133602632737625' type='text/html'/><gd:extendedProperty name='blogger.contentRemoved' value='true'/><gd:extendedProperty name='blogger.itemClass' value='pid-1500481807'/><gd:extendedProperty name='blogger.displayTime' value='3 July 2013 at 13:54'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4622918603001233792</id><published>2013-07-05T13:21:24.374+01:00</published><updated>2013-07-05T13:21:24.374+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>BasePriority = &amp;#39;process.BasePriority&amp;#39; thre...</title><content type='html'>BasePriority = &amp;#39;process.BasePriority&amp;#39; threw an exception of type &amp;#39;System.InvalidOperationException&amp;#39;&lt;br /&gt;&lt;br /&gt;and Process.ExitCode is 1</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/4622918603001233792'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/4622918603001233792'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html?showComment=1373026884374#c4622918603001233792' title=''/><author><name>Anonymous</name><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//resources.blogblog.com/img/blank.gif'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-8680133602632737625' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/8680133602632737625' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1995697193'/><gd:extendedProperty name='blogger.displayTime' value='5 July 2013 at 13:21'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3966121199009360991</id><published>2013-07-15T19:16:23.226+01:00</published><updated>2013-07-15T19:16:23.226+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hey, regarding the in-memory database, I was curio...</title><content type='html'>Hey, regarding the in-memory database, I was curious if anyone has employed the use of EFFORT in their projects.&lt;br /&gt;&lt;br /&gt;http://effort.codeplex.com/&lt;br /&gt;&lt;br /&gt;I have messed with it a little, and it does work well, but it&amp;#39;s currently in Beta, and apparently, when you upgrade to EF6 (which is also in Beta at the moment), you have to build against a reference to Entity Framework itself, which works, but I fear for future implications.&lt;br /&gt;&lt;br /&gt;I&amp;#39;m surprised Microsoft hasn&amp;#39;t created anything to streamline this, or have a way to make IEnumerables behave as if they were linq-to-entities. The only problem is the eager loading Include() method would cause many of headaches, which makes me fall back to the in-memory database.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3336760366966567957/comments/default/3966121199009360991'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3336760366966567957/comments/default/3966121199009360991'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/10/unit-testing-and-entity-framework-filth.html?showComment=1373912183226#c3966121199009360991' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/13500212764259779101</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/10/unit-testing-and-entity-framework-filth.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-3336760366966567957' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/3336760366966567957' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-332138815'/><gd:extendedProperty name='blogger.displayTime' value='15 July 2013 at 19:16'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-292554575288357151</id><published>2013-07-17T08:37:27.367+01:00</published><updated>2013-07-17T08:37:27.367+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>I got this working on my local machine. I&amp;#39;ve u...</title><content type='html'>I got this working on my local machine. I&amp;#39;ve uploaded the code to the web server and installed wkhtmltopdf on that machine. &lt;br /&gt;The problem is that everytime I generate a pdf with it, it returns me an empty document with the correct amount of pages but nothing on them and on my local machine it works.&lt;br /&gt;&lt;br /&gt;Does somebody have a clue what the problem could be? I gave the correct permissions on the folders.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/292554575288357151'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/292554575288357151'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html?showComment=1374046647367#c292554575288357151' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/09118138094016227980</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-8680133602632737625' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/8680133602632737625' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1500481807'/><gd:extendedProperty name='blogger.displayTime' value='17 July 2013 at 08:37'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5983055331835317935</id><published>2013-07-17T09:22:05.942+01:00</published><updated>2013-07-17T09:22:05.942+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi Jurgen,  

It&amp;#39;s a long time since I looked ...</title><content type='html'>Hi Jurgen,  &lt;br /&gt;&lt;br /&gt;It&amp;#39;s a long time since I looked at this but I have an idea this *may* be to do with the permissions for web page that you&amp;#39;re looking to make into a PDF.  Not certain but could be worth a try.  Take a look at my reply to Cusman above and that may help.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/5983055331835317935'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/5983055331835317935'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html?showComment=1374049325942#c5983055331835317935' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/292554575288357151'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-8680133602632737625' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/8680133602632737625' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='17 July 2013 at 09:22'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8657103815523530150</id><published>2013-07-17T09:45:08.406+01:00</published><updated>2013-07-17T09:45:08.406+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Thank you for your reply but if I use wkhtmltopdf ...</title><content type='html'>Thank you for your reply but if I use wkhtmltopdf in a DOS screen my page just generates perfectly. So there has to be something wrong in code and not on web page level I think. &lt;br /&gt;&lt;br /&gt;You can test it yourself if you want with following urls:&lt;br /&gt;- this is the page I want to convert to pdf:&lt;br /&gt;http://staging-web.matexi.be/home/onze-projecten/pdf/project_no/P0089&lt;br /&gt;- this is the page where I&amp;#39;m calling your function:&lt;br /&gt;Under the overview table you have a link called &amp;#39;Print een overzicht van alle loten&amp;#39;. Click on it and normally you get an empty PDF with 2 pages.&lt;br /&gt;http://staging-web.matexi.be/home/onze-projecten/detail/project_no/P0089/tab/living&lt;br /&gt;(I&amp;#39;m sorry for the dutch)&lt;br /&gt;&lt;br /&gt;Also try it in a DOS screen and you will see that it works. </content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/8657103815523530150'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/8657103815523530150'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html?showComment=1374050708406#c8657103815523530150' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/292554575288357151'/><author><name>Unknown</name><uri>https://www.blogger.com/profile/09118138094016227980</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-8680133602632737625' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/8680133602632737625' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1500481807'/><gd:extendedProperty name='blogger.displayTime' value='17 July 2013 at 09:45'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5068434924281018692</id><published>2013-07-17T10:44:54.152+01:00</published><updated>2013-07-17T10:44:54.152+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi Jurgen,

I see what you mean.  I&amp;#39;m not invo...</title><content type='html'>Hi Jurgen,&lt;br /&gt;&lt;br /&gt;I see what you mean.  I&amp;#39;m not involved in the project that used wkhtmltopdf anymore and so I&amp;#39;m a little distant from the technology.  As I remember, most issues I experienced came down to permissions.  Either of:&lt;br /&gt;&lt;br /&gt;1. wkhtmltopdf (the exe) &lt;br /&gt;&lt;br /&gt;or&lt;br /&gt;&lt;br /&gt;2. the process running wkhtmltopdf &lt;br /&gt;&lt;br /&gt;or &lt;br /&gt;&lt;br /&gt;3. the permissioning of the website (which doesn&amp;#39;t appear to apply to your situation)&lt;br /&gt;&lt;br /&gt;I&amp;#39;d advise you to investigate 1 and 2.  Sorry I can&amp;#39;t be more helpful than that.  By the way, nicely styled site!</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/5068434924281018692'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/5068434924281018692'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html?showComment=1374054294152#c5068434924281018692' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/292554575288357151'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-8680133602632737625' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/8680133602632737625' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='17 July 2013 at 10:44'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2725352441230172785</id><published>2013-07-17T14:12:23.979+01:00</published><updated>2013-07-17T14:12:23.979+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Thank you though for your help. This blog post hel...</title><content type='html'>Thank you though for your help. This blog post helped me a lot. It can be the process and I will look into that.&lt;br /&gt;&lt;br /&gt;Thank you that you like the site!</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/2725352441230172785'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/2725352441230172785'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html?showComment=1374066743979#c2725352441230172785' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/292554575288357151'/><author><name>Unknown</name><uri>https://www.blogger.com/profile/09118138094016227980</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-8680133602632737625' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/8680133602632737625' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1500481807'/><gd:extendedProperty name='blogger.displayTime' value='17 July 2013 at 14:12'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1362498549986557577</id><published>2013-07-17T22:06:23.261+01:00</published><updated>2013-07-17T22:06:23.261+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>I am using XSD.exe to generate the xsd file from x...</title><content type='html'>I am using XSD.exe to generate the xsd file from xml file as you did in the &amp;quot;Update - using Xsd.exe to generate XSD from XML&amp;quot; section above.  However, I noticed that the type of the &amp;quot;heightInInches&amp;quot; element is xs:string where as in the initial example using &amp;quot;XSD/XML Schema Generator&amp;quot; the type is xs:byte.&lt;br /&gt;&lt;br /&gt;Are you aware of how to get xsd.exe to create an xsd file with appropriate types instead of all xs:string?</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/7839976006063557799/comments/default/1362498549986557577'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/7839976006063557799/comments/default/1362498549986557577'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/11/xsdxml-schema-generator-xsdexe-taking.html?showComment=1374095183261#c1362498549986557577' title=''/><author><name>Len</name><uri>https://www.blogger.com/profile/16061184259744107328</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/11/xsdxml-schema-generator-xsdexe-taking.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-7839976006063557799' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/7839976006063557799' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-631895876'/><gd:extendedProperty name='blogger.displayTime' value='17 July 2013 at 22:06'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4112697222168262309</id><published>2013-07-18T13:13:38.821+01:00</published><updated>2013-07-18T13:13:38.821+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi Len,

No I&amp;#39;m not - I think that xsd.exe is ...</title><content type='html'>Hi Len,&lt;br /&gt;&lt;br /&gt;No I&amp;#39;m not - I think that xsd.exe is a slightly limited tool and I generally don&amp;#39;t use it for that reason.  It may be possible but if it is I&amp;#39;m not aware of how.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/7839976006063557799/comments/default/4112697222168262309'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/7839976006063557799/comments/default/4112697222168262309'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/11/xsdxml-schema-generator-xsdexe-taking.html?showComment=1374149618821#c4112697222168262309' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/7839976006063557799/comments/default/1362498549986557577'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/11/xsdxml-schema-generator-xsdexe-taking.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-7839976006063557799' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/7839976006063557799' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='18 July 2013 at 13:13'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8661672586499017368</id><published>2013-07-23T07:29:21.532+01:00</published><updated>2013-07-23T07:29:21.532+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Thanks man! I will start playing with this right n...</title><content type='html'>Thanks man! I will start playing with this right now! ;)</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3528895325491418415/comments/default/8661672586499017368'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3528895325491418415/comments/default/8661672586499017368'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/07/how-im-using-cassette-part-3-typescript.html?showComment=1374560961532#c8661672586499017368' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/03186658891344967956</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/07/how-im-using-cassette-part-3-typescript.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-3528895325491418415' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/3528895325491418415' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-869776765'/><gd:extendedProperty name='blogger.displayTime' value='23 July 2013 at 07:29'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6156577528406897836</id><published>2013-07-23T09:27:02.120+01:00</published><updated>2013-07-23T09:27:02.120+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Glad to help Daniel! Let me know if you experience...</title><content type='html'>Glad to help Daniel! Let me know if you experience any issues with it.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3528895325491418415/comments/default/6156577528406897836'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3528895325491418415/comments/default/6156577528406897836'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/07/how-im-using-cassette-part-3-typescript.html?showComment=1374568022120#c6156577528406897836' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3528895325491418415/comments/default/8661672586499017368'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/07/how-im-using-cassette-part-3-typescript.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-3528895325491418415' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/3528895325491418415' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='23 July 2013 at 09:27'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6573175466111051311</id><published>2013-08-04T20:38:03.172+01:00</published><updated>2013-08-04T20:38:03.172+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>I did exactly what you did....
But i get this erro...</title><content type='html'>I did exactly what you did....&lt;br /&gt;But i get this error... The field D.O.B must be a date&lt;br /&gt;&lt;br /&gt;What could be the problem..&lt;br /&gt;My system date is dd-MM-yyy&lt;br /&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/9066088698325396956/comments/default/6573175466111051311'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/9066088698325396956/comments/default/6573175466111051311'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/01/twitterbootstrapmvc4-meet-bootstrap.html?showComment=1375645083172#c6573175466111051311' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/14231373094314110458</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/01/twitterbootstrapmvc4-meet-bootstrap.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-9066088698325396956' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/9066088698325396956' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-348484404'/><gd:extendedProperty name='blogger.displayTime' value='4 August 2013 at 20:38'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-328430544529808537</id><published>2013-08-05T09:24:30.034+01:00</published><updated>2013-08-05T09:24:30.034+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi Shanker,

You might want to try the Globalized ...</title><content type='html'>Hi Shanker,&lt;br /&gt;&lt;br /&gt;You might want to try the Globalized picker - check this post:&lt;br /&gt;&lt;br /&gt;http://icanmakethiswork.blogspot.com/2013/01/twitterbootstrapmvc4-meet-bootstrap_14.html</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/9066088698325396956/comments/default/328430544529808537'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/9066088698325396956/comments/default/328430544529808537'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/01/twitterbootstrapmvc4-meet-bootstrap.html?showComment=1375691070034#c328430544529808537' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/9066088698325396956/comments/default/6573175466111051311'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/01/twitterbootstrapmvc4-meet-bootstrap.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-9066088698325396956' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/9066088698325396956' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='5 August 2013 at 09:24'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8306585263869969529</id><published>2013-08-07T22:50:35.840+01:00</published><updated>2013-08-07T22:50:35.840+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi wadep,

I have the same issue, how did you mana...</title><content type='html'>Hi wadep,&lt;br /&gt;&lt;br /&gt;I have the same issue, how did you manage to fix it??</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/9066088698325396956/comments/default/8306585263869969529'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/9066088698325396956/comments/default/8306585263869969529'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/01/twitterbootstrapmvc4-meet-bootstrap.html?showComment=1375912235840#c8306585263869969529' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/9066088698325396956/comments/default/8874564744028860029'/><author><name>Unknown</name><uri>https://www.blogger.com/profile/09663071524191448357</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/01/twitterbootstrapmvc4-meet-bootstrap.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-9066088698325396956' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/9066088698325396956' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1873378297'/><gd:extendedProperty name='blogger.displayTime' value='7 August 2013 at 22:50'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4009596032276217276</id><published>2013-08-09T02:42:01.040+01:00</published><updated>2013-08-09T02:42:01.040+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hello,

Thank you for posting this!

Is it possibl...</title><content type='html'>Hello,&lt;br /&gt;&lt;br /&gt;Thank you for posting this!&lt;br /&gt;&lt;br /&gt;Is it possible to put a range or minimum date for Dates?&lt;br /&gt;&lt;br /&gt;Something like data-val-range-min=&amp;quot;1/1/2013&amp;quot;  ? </content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2537929858771005565/comments/default/4009596032276217276'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2537929858771005565/comments/default/4009596032276217276'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/06/jquery-validate-native-unobtrusive-validation.html?showComment=1376012521040#c4009596032276217276' title=''/><author><name>ZaneSaysThis</name><uri>https://www.blogger.com/profile/06992793590950881448</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/06/jquery-validate-native-unobtrusive-validation.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-2537929858771005565' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/2537929858771005565' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-96903581'/><gd:extendedProperty name='blogger.displayTime' value='9 August 2013 at 02:42'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8502015805970157898</id><published>2013-08-09T15:04:25.274+01:00</published><updated>2013-08-09T15:04:25.274+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi Zane,  I think this will work if the specified ...</title><content type='html'>Hi Zane,  I think this will work if the specified input type is a date (using data-rule-min) but I&amp;#39;m not sure how widely the input date has been implemented in browsers.  Certainly I don&amp;#39;t depend on it..</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2537929858771005565/comments/default/8502015805970157898'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2537929858771005565/comments/default/8502015805970157898'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/06/jquery-validate-native-unobtrusive-validation.html?showComment=1376057065274#c8502015805970157898' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2537929858771005565/comments/default/4009596032276217276'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/06/jquery-validate-native-unobtrusive-validation.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-2537929858771005565' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/2537929858771005565' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='9 August 2013 at 15:04'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3277084862897763606</id><published>2013-08-13T21:50:21.430+01:00</published><updated>2013-08-13T21:50:21.430+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>This is really cool stuff, mate. I&amp;#39;ve tried yo...</title><content type='html'>This is really cool stuff, mate. I&amp;#39;ve tried your example and it works nicely. &lt;br /&gt;&lt;br /&gt;My next step is applying a header and footer to all pages. Let&amp;#39;s see if I can do that and then place it all on a webserver for remote generation. :) </content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/6628728608690018897/comments/default/3277084862897763606'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/6628728608690018897/comments/default/3277084862897763606'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/01/html-to-pdf-using-wcf-service.html?showComment=1376427021430#c3277084862897763606' title=''/><author><name>Marquito</name><uri>https://www.blogger.com/profile/14579069635784583157</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='32' height='30' src='//3.bp.blogspot.com/-M5cXhDybXu8/Ul1J_lipmII/AAAAAAAAC2Q/D8CUzHgR8ws/s32/Marquito.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/01/html-to-pdf-using-wcf-service.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-6628728608690018897' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/6628728608690018897' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1028530630'/><gd:extendedProperty name='blogger.displayTime' value='13 August 2013 at 21:50'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8092085457664598710</id><published>2013-08-14T13:29:11.858+01:00</published><updated>2013-08-14T13:29:11.858+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>On our website I&amp;#39;m trying to generate the PDF ...</title><content type='html'>On our website I&amp;#39;m trying to generate the PDF files from password-protected areas (client areas). Do you have any suggeestions on how I&amp;#39;d go about generating these PDFs since the pages require the user to be authenticated? (i.e. when I try to generate the PDF I get the login page instead in the PDF file)</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/6628728608690018897/comments/default/8092085457664598710'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/6628728608690018897/comments/default/8092085457664598710'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/01/html-to-pdf-using-wcf-service.html?showComment=1376483351858#c8092085457664598710' title=''/><author><name>Marquito</name><uri>https://www.blogger.com/profile/14579069635784583157</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='32' height='30' src='//3.bp.blogspot.com/-M5cXhDybXu8/Ul1J_lipmII/AAAAAAAAC2Q/D8CUzHgR8ws/s32/Marquito.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/01/html-to-pdf-using-wcf-service.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-6628728608690018897' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/6628728608690018897' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1028530630'/><gd:extendedProperty name='blogger.displayTime' value='14 August 2013 at 13:29'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8153824685449934267</id><published>2013-08-27T00:58:59.733+01:00</published><updated>2013-08-27T00:58:59.733+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi friends

I have the same issue, i have a hostin...</title><content type='html'>Hi friends&lt;br /&gt;&lt;br /&gt;I have the same issue, i have a hosting with godaddy and i can&amp;#39;t generate the pdf file, in my test  &amp;amp; development environment it works perfectly, but when i upload the deploy to godaddy the exception appears.&lt;br /&gt;&lt;br /&gt;Currently i work with forms authentication and i think that the wkhtmltopdf.exe file isn&amp;#39;t run in godaddy servers for the permissons.&lt;br /&gt;&lt;br /&gt;Somebody knows about how to fix this issue?&lt;br /&gt;&lt;br /&gt;Really appreciate your help to solve this.&lt;br /&gt;&lt;br /&gt;Alfred</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/8153824685449934267'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/8153824685449934267'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html?showComment=1377561539733#c8153824685449934267' title=''/><author><name>.....</name><uri>https://www.blogger.com/profile/12535658817673372596</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-8680133602632737625' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/8680133602632737625' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1230682684'/><gd:extendedProperty name='blogger.displayTime' value='27 August 2013 at 00:58'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5457462517755516967</id><published>2013-08-27T12:05:15.180+01:00</published><updated>2013-08-27T12:05:15.180+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Great idea...been looking for something like this ...</title><content type='html'>Great idea...been looking for something like this for a couple of years since!&lt;br /&gt;&lt;br /&gt;Thanks Paul</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/5457462517755516967'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/5457462517755516967'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html?showComment=1377601515180#c5457462517755516967' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/14414956724339528980</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-5753576792954274953' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/5753576792954274953' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-2142690741'/><gd:extendedProperty name='blogger.displayTime' value='27 August 2013 at 12:05'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-7288227464850640570</id><published>2013-08-27T12:38:27.895+01:00</published><updated>2013-08-27T12:38:27.895+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Glad to have helped Paul!</title><content type='html'>Glad to have helped Paul!</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/7288227464850640570'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/7288227464850640570'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html?showComment=1377603507895#c7288227464850640570' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/5457462517755516967'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-5753576792954274953' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/5753576792954274953' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='27 August 2013 at 12:38'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-787177650504868559</id><published>2013-08-27T14:54:25.199+01:00</published><updated>2013-08-27T14:54:25.199+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Great post, thanks!</title><content type='html'>Great post, thanks!</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3528895325491418415/comments/default/787177650504868559'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3528895325491418415/comments/default/787177650504868559'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/07/how-im-using-cassette-part-3-typescript.html?showComment=1377611665199#c787177650504868559' title=''/><author><name>SteveM</name><uri>https://www.blogger.com/profile/11134416413725861626</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/07/how-im-using-cassette-part-3-typescript.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-3528895325491418415' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/3528895325491418415' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-819941825'/><gd:extendedProperty name='blogger.displayTime' value='27 August 2013 at 14:54'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-7548997152192065120</id><published>2013-08-28T20:07:04.897+01:00</published><updated>2013-08-28T20:07:04.897+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi John, Are you interested in doing some freelanc...</title><content type='html'>Hi John, Are you interested in doing some freelance development work for a bloomberg Open API project I am working on?  Drop me an email - knowlesi07@googlemail.com if you fancy discussing further.  </content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/7548997152192065120'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/7548997152192065120'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html?showComment=1377716824897#c7548997152192065120' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/16373023744832693804</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1492382956545126674' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1492382956545126674' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1009620548'/><gd:extendedProperty name='blogger.displayTime' value='28 August 2013 at 20:07'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1007781992145910934</id><published>2013-09-04T17:18:59.988+01:00</published><updated>2013-09-04T17:18:59.988+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Nice, but the only problem is that the user has to...</title><content type='html'>Nice, but the only problem is that the user has to know to mouseover the field to show the tooltip.  This might seem obvious to some, but to many is not.  Maybe a better way is to show the tooltip as long as focus is on the field and there is a validation error on the field as well as on mouseover.&lt;br /&gt;&lt;br /&gt;The other thing I noticed is that when I click &amp;quot;validate&amp;quot; only one tooltip validation shows, so then it might become a matter of click, fix, click, fix, etc.  Maybe show all the tooltips off to the right of the field on validation click and if it&amp;#39;s too crowded then just post some message at the top of the form that says something like &amp;quot;there are validation errors, please click on each field for more information&amp;quot;, or something like that.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/1007781992145910934'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/1007781992145910934'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html?showComment=1378311539988#c1007781992145910934' title=''/><author><name>Jim</name><uri>https://www.blogger.com/profile/01666274362718155663</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-5753576792954274953' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/5753576792954274953' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1508509946'/><gd:extendedProperty name='blogger.displayTime' value='4 September 2013 at 17:18'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1761492183659863038</id><published>2013-09-04T17:53:57.319+01:00</published><updated>2013-09-04T17:53:57.319+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi Jim,

Thanks for the feedback - you make some g...</title><content type='html'>Hi Jim,&lt;br /&gt;&lt;br /&gt;Thanks for the feedback - you make some good points.  &lt;br /&gt;&lt;br /&gt;My intention with this post was to demonstrate how simply the tooltip effect could be made to work with jQuery Validation.  I&amp;#39;d advise anyone using this approach to amend this technique in whatever way they want to get the user interface they desire.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/1761492183659863038'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/1761492183659863038'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html?showComment=1378313637319#c1761492183659863038' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/1007781992145910934'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-5753576792954274953' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/5753576792954274953' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='4 September 2013 at 17:53'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4044282765657241796</id><published>2013-09-05T21:08:51.788+01:00</published><updated>2013-09-05T21:08:51.788+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Thanks John !Nice work! </title><content type='html'>Thanks John !Nice work! </content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/9066088698325396956/comments/default/4044282765657241796'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/9066088698325396956/comments/default/4044282765657241796'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/01/twitterbootstrapmvc4-meet-bootstrap.html?showComment=1378411731788#c4044282765657241796' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/06557400199595803672</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/01/twitterbootstrapmvc4-meet-bootstrap.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-9066088698325396956' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/9066088698325396956' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-724239417'/><gd:extendedProperty name='blogger.displayTime' value='5 September 2013 at 21:08'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6665024062256779593</id><published>2013-09-07T07:46:09.079+01:00</published><updated>2013-09-07T07:46:09.079+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi,
Thanks for the tool, but I have styling issues...</title><content type='html'>Hi,&lt;br /&gt;Thanks for the tool, but I have styling issues while generating pdfs from html.&lt;br /&gt;HTML looks awesome but when PDFs are generated then all styles are disturbed and also images look fade and dull.&lt;br /&gt;&lt;br /&gt;Please tell me, is there any solution towards style issue.&lt;br /&gt;&lt;br /&gt;Thanks</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/6665024062256779593'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/6665024062256779593'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html?showComment=1378536369079#c6665024062256779593' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/03790077450684038837</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-8680133602632737625' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/8680133602632737625' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1815346778'/><gd:extendedProperty name='blogger.displayTime' value='7 September 2013 at 07:46'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3130964425422549146</id><published>2013-09-07T08:34:53.461+01:00</published><updated>2013-09-07T08:34:53.461+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi Vikas,  I&amp;#39;d say this is a function of the W...</title><content type='html'>Hi Vikas,  I&amp;#39;d say this is a function of the WebKit rendering engine.  That being the case I&amp;#39;m afraid it&amp;#39;s a case of take it or leave it...</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/3130964425422549146'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/3130964425422549146'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html?showComment=1378539293461#c3130964425422549146' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/6665024062256779593'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-8680133602632737625' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/8680133602632737625' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='7 September 2013 at 08:34'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1337990138872604622</id><published>2013-09-09T06:10:12.158+01:00</published><updated>2013-09-09T06:10:12.158+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hello John,

Thanks for reply. Can this problem be...</title><content type='html'>Hello John,&lt;br /&gt;&lt;br /&gt;Thanks for reply. Can this problem be solved if we use HTML 5?</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/1337990138872604622'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/1337990138872604622'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html?showComment=1378703412158#c1337990138872604622' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/6665024062256779593'/><author><name>Unknown</name><uri>https://www.blogger.com/profile/03790077450684038837</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-8680133602632737625' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/8680133602632737625' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1815346778'/><gd:extendedProperty name='blogger.displayTime' value='9 September 2013 at 06:10'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3912989365351536291</id><published>2013-09-09T09:25:30.482+01:00</published><updated>2013-09-09T09:25:30.482+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi Vikas,  I&amp;#39;m not sure I follow what you&amp;#39;...</title><content type='html'>Hi Vikas,  I&amp;#39;m not sure I follow what you&amp;#39;re suggesting.  Care to elaborate?</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/3912989365351536291'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/3912989365351536291'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html?showComment=1378715130482#c3912989365351536291' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/6665024062256779593'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-8680133602632737625' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/8680133602632737625' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='9 September 2013 at 09:25'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2588297892920917107</id><published>2013-09-09T14:32:17.634+01:00</published><updated>2013-09-09T14:32:17.634+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi John,
You said that it is the issue of Webkit r...</title><content type='html'>Hi John,&lt;br /&gt;You said that it is the issue of Webkit rendering engine. But if we use HTML 5 and CSS 3 then can we overcome the styling issues(distorting of images/disturbed layout)? &lt;br /&gt;&lt;br /&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/2588297892920917107'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/2588297892920917107'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html?showComment=1378733537634#c2588297892920917107' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/6665024062256779593'/><author><name>Unknown</name><uri>https://www.blogger.com/profile/03790077450684038837</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-8680133602632737625' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/8680133602632737625' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1815346778'/><gd:extendedProperty name='blogger.displayTime' value='9 September 2013 at 14:32'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5241140666245631471</id><published>2013-09-09T14:54:37.954+01:00</published><updated>2013-09-09T14:54:37.954+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi Vikas,

I suppose you could try tweaking your C...</title><content type='html'>Hi Vikas,&lt;br /&gt;&lt;br /&gt;I suppose you could try tweaking your CSS to try and achieve more satisfactory outputs.  I don&amp;#39;t think that will make any difference to the image processing though. And I doubt that anything in HTML 5 / CSS 3&amp;#39;s toolbox is particularly going to help you here either...</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/5241140666245631471'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/5241140666245631471'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html?showComment=1378734877954#c5241140666245631471' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/6665024062256779593'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-8680133602632737625' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/8680133602632737625' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='9 September 2013 at 14:54'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8442344597473753186</id><published>2013-09-10T07:38:34.626+01:00</published><updated>2013-09-10T07:38:34.626+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Thanks John,

I also think tweaking CSS is the onl...</title><content type='html'>Thanks John,&lt;br /&gt;&lt;br /&gt;I also think tweaking CSS is the only way around for the moment now.&lt;br /&gt;&lt;br /&gt;Apart from this, do you have idea of another tool(free/paid) which generates almost exact copy of HTML page?</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/8442344597473753186'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/8442344597473753186'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html?showComment=1378795114626#c8442344597473753186' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/6665024062256779593'/><author><name>Unknown</name><uri>https://www.blogger.com/profile/03790077450684038837</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-8680133602632737625' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/8680133602632737625' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1815346778'/><gd:extendedProperty name='blogger.displayTime' value='10 September 2013 at 07:38'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6977652354537153873</id><published>2013-09-14T21:42:04.731+01:00</published><updated>2013-09-14T21:42:04.731+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Excellent, I have been looking for this to see if ...</title><content type='html'>Excellent, I have been looking for this to see if it was possible but didn&amp;#39;t find anything after looking around the official site. Well done for blogging about it.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2537929858771005565/comments/default/6977652354537153873'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2537929858771005565/comments/default/6977652354537153873'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/06/jquery-validate-native-unobtrusive-validation.html?showComment=1379191324731#c6977652354537153873' title=''/><author><name>Matthew Fedak</name><uri>https://www.blogger.com/profile/15833220124685342070</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='32' height='32' src='//1.bp.blogspot.com/-ZbAPzr_3-6Y/UjTKOxB_hcI/AAAAAAAAAI0/obSapGO4SAM/s32/photo.jpg'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/06/jquery-validate-native-unobtrusive-validation.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-2537929858771005565' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/2537929858771005565' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-704349224'/><gd:extendedProperty name='blogger.displayTime' value='14 September 2013 at 21:42'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-17299926651557869</id><published>2013-09-14T21:47:32.647+01:00</published><updated>2013-09-14T21:47:32.647+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>My pleasure Matthew!</title><content type='html'>My pleasure Matthew!</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2537929858771005565/comments/default/17299926651557869'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2537929858771005565/comments/default/17299926651557869'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/06/jquery-validate-native-unobtrusive-validation.html?showComment=1379191652647#c17299926651557869' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2537929858771005565/comments/default/6977652354537153873'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/06/jquery-validate-native-unobtrusive-validation.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-2537929858771005565' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/2537929858771005565' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='14 September 2013 at 21:47'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-9057409253343747465</id><published>2013-09-27T10:17:29.415+01:00</published><updated>2013-09-27T10:17:29.415+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi John,
useful article and thanks for your effort...</title><content type='html'>Hi John,&lt;br /&gt;useful article and thanks for your efforts&lt;br /&gt;&lt;br /&gt;Unfortunately I have an issue with the NuGet package. It is forcing me to upgrade to the latest jQuery, but I need to maintain for IE7,  :(, therefore I am stuck with jQuery 1.10. I assume it is forcing the upgrade because the dependencies do not specify a minimum version. Would it be possible for you to alter this so I can make use of the NuGet package? In the mean time I&amp;#39;ve just imported it by hand.&lt;br /&gt;&lt;br /&gt;I have an additional query. In the source supplied on GitHub you&amp;#39;ve not added the html lang reading code. Am I correct in assuming this was intentional to not force people down the same route as this article and we need to add this code ourselves (or some other means of achieving the same thing, like Scott&amp;#39;s meta tag)? I just want to check I am not missing something else where Globalize figures this one out for itself (which doesn&amp;#39;t work for me if there is).&lt;br /&gt;&lt;br /&gt;Cheers,&lt;br /&gt;Adam</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/9057409253343747465'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/9057409253343747465'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html?showComment=1380273449415#c9057409253343747465' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/03327807485957623710</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-2414704032922872709' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/2414704032922872709' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1535534802'/><gd:extendedProperty name='blogger.displayTime' value='27 September 2013 at 10:17'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6986540127365164779</id><published>2013-09-27T10:44:26.031+01:00</published><updated>2013-09-27T10:44:26.031+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi Adam,

Thanks for the feedback - I&amp;#39;ll look ...</title><content type='html'>Hi Adam,&lt;br /&gt;&lt;br /&gt;Thanks for the feedback - I&amp;#39;ll look into the jQuery version issue you mention as soon as I get a moment.  (As it happens I planned to make a minor tweak to the library anyway.)&lt;br /&gt;&lt;br /&gt;You&amp;#39;re quite correct that the code for determining culture is separate from the library itself.  This is deliberate as not everyone is using the same server side technologies and this allows for people to with different back ends to all use this.  &lt;br /&gt;&lt;br /&gt;Assuming you are using a .NET backend then you might want to take a look at this link:&lt;br /&gt;&lt;br /&gt;http://jqueryvalidationunobtrusivenative.azurewebsites.net/AdvancedDemo/Globalize&lt;br /&gt;&lt;br /&gt;This demonstrates how this might be used with jQuery Validation Unobtrusive Native (a project of mine).  However, the &amp;quot;Determine which culture to use&amp;quot; tab should give you what you need in terms of determining the culture server side and initializing client side with that culture.  It uses a different approach to Scotts but to the same end.  You can take this and use it however feels best for you.&lt;br /&gt;&lt;br /&gt;Hope that helps - any questions then let me know.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/6986540127365164779'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/6986540127365164779'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html?showComment=1380275066031#c6986540127365164779' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/9057409253343747465'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-2414704032922872709' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/2414704032922872709' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='27 September 2013 at 10:44'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6657306495050583623</id><published>2013-09-30T10:05:54.744+01:00</published><updated>2013-09-30T10:05:54.744+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Thanks. I&amp;#39;ll keep an eye on the NuGet package ...</title><content type='html'>Thanks. I&amp;#39;ll keep an eye on the NuGet package then :-).&lt;br /&gt;&lt;br /&gt;I figured this was the case and wired up as per this article. I&amp;#39;ll have a glance over the suggested page to see if there is anything else of use there.&lt;br /&gt;&lt;br /&gt;Thank you for your assistance.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/6657306495050583623'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/6657306495050583623'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html?showComment=1380531954744#c6657306495050583623' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/9057409253343747465'/><author><name>Unknown</name><uri>https://www.blogger.com/profile/03327807485957623710</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-2414704032922872709' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/2414704032922872709' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1535534802'/><gd:extendedProperty name='blogger.displayTime' value='30 September 2013 at 10:05'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3565501813640208637</id><published>2013-09-30T10:38:43.527+01:00</published><updated>2013-09-30T10:38:43.527+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>No problem Adam - I updated the nuget package on S...</title><content type='html'>No problem Adam - I updated the nuget package on Saturday - you should be good to go!</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/3565501813640208637'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/3565501813640208637'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html?showComment=1380533923527#c3565501813640208637' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/9057409253343747465'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-2414704032922872709' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/2414704032922872709' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='30 September 2013 at 10:38'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8263993979922091737</id><published>2013-09-30T13:50:14.564+01:00</published><updated>2013-09-30T13:50:14.564+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>That seems to have done the trick. Thanks for the ...</title><content type='html'>That seems to have done the trick. Thanks for the quick turn around.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/8263993979922091737'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/8263993979922091737'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html?showComment=1380545414564#c8263993979922091737' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/03327807485957623710</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-2414704032922872709' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/2414704032922872709' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1535534802'/><gd:extendedProperty name='blogger.displayTime' value='30 September 2013 at 13:50'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6343075672370097585</id><published>2013-09-30T16:27:31.079+01:00</published><updated>2013-09-30T16:27:31.079+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Excellent post, much appreciated and really useful...</title><content type='html'>Excellent post, much appreciated and really useful for getting me started on testing the ModelState</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/6463585883554513120/comments/default/6343075672370097585'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/6463585883554513120/comments/default/6343075672370097585'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/03/unit-testing-modelstate.html?showComment=1380554851079#c6343075672370097585' title=''/><author><name>SteveC</name><uri>https://www.blogger.com/profile/09672985727827812146</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/03/unit-testing-modelstate.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-6463585883554513120' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/6463585883554513120' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1511238756'/><gd:extendedProperty name='blogger.displayTime' value='30 September 2013 at 16:27'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6343298730624069606</id><published>2013-09-30T16:50:32.486+01:00</published><updated>2013-09-30T16:50:32.486+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Glad to help Steve!</title><content type='html'>Glad to help Steve!</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/6463585883554513120/comments/default/6343298730624069606'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/6463585883554513120/comments/default/6343298730624069606'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/03/unit-testing-modelstate.html?showComment=1380556232486#c6343298730624069606' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/6463585883554513120/comments/default/6343075672370097585'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/03/unit-testing-modelstate.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-6463585883554513120' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/6463585883554513120' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='30 September 2013 at 16:50'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5755938639042264952</id><published>2013-09-30T21:02:15.165+01:00</published><updated>2013-09-30T21:02:15.165+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>John,

I&amp;#39;ve got this all integrated and wired ...</title><content type='html'>John,&lt;br /&gt;&lt;br /&gt;I&amp;#39;ve got this all integrated and wired up and it appears to be working well, however I have one small issue that I&amp;#39;m stuck on...&lt;br /&gt;&lt;br /&gt;If I enter an invalid date for a DateTime property and tab out of the text box, I instantly get a validation error, however it is always in english and reads: The field DateField must be a date.&lt;br /&gt;&lt;br /&gt;All other fields will display the validation message in the appropriate language, any ideas?&lt;br /&gt;&lt;br /&gt;Thanks!</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/5755938639042264952'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/5755938639042264952'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html?showComment=1380571335165#c5755938639042264952' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/04658098333687066977</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-2414704032922872709' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/2414704032922872709' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-965736466'/><gd:extendedProperty name='blogger.displayTime' value='30 September 2013 at 21:02'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8731499069396371410</id><published>2013-09-30T21:15:43.289+01:00</published><updated>2013-09-30T21:15:43.289+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi Mike,

Its hard to tell without seeing the code...</title><content type='html'>Hi Mike,&lt;br /&gt;&lt;br /&gt;Its hard to tell without seeing the code but I&amp;#39;d speculate that the date message hasn&amp;#39;t been customised. You&amp;#39;ll need to set the invalid date message. I think this can achieved by adding a data-msg-date attribute which contains your custom message.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/8731499069396371410'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/8731499069396371410'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html?showComment=1380572143289#c8731499069396371410' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/5755938639042264952'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-2414704032922872709' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/2414704032922872709' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='30 September 2013 at 21:15'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6097449084744711416</id><published>2013-10-04T13:48:21.981+01:00</published><updated>2013-10-04T13:48:21.981+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Awesome, all working for me!</title><content type='html'>Awesome, all working for me!</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/9066088698325396956/comments/default/6097449084744711416'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/9066088698325396956/comments/default/6097449084744711416'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/01/twitterbootstrapmvc4-meet-bootstrap.html?showComment=1380890901981#c6097449084744711416' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/04861823924404311691</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/01/twitterbootstrapmvc4-meet-bootstrap.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-9066088698325396956' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/9066088698325396956' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1173976763'/><gd:extendedProperty name='blogger.displayTime' value='4 October 2013 at 13:48'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4420968803197270458</id><published>2013-10-16T21:58:47.808+01:00</published><updated>2013-10-16T21:58:47.808+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Thank you! Instead of having to mock a bunch of ob...</title><content type='html'>Thank you! Instead of having to mock a bunch of objects in several lines of code, this solved my problem with a mere 2 lines. Thanks again!</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1867217689836748667/comments/default/4420968803197270458'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1867217689836748667/comments/default/4420968803197270458'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/02/unit-testing-mvc-controllers-mocking.html?showComment=1381957127808#c4420968803197270458' title=''/><author><name>Alan</name><uri>https://www.blogger.com/profile/14978517118599802301</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='32' height='32' src='//images-blogger-opensocial.googleusercontent.com/gadgets/proxy?url=http://3.bp.blogspot.com/-mkduBhhZLos/VKhjtebD1NI/AAAAAAAAARM/WCkqhz8olcc/s150/*&amp;container=blogger&amp;gadget=a&amp;rewriteMime=image/*'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/02/unit-testing-mvc-controllers-mocking.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1867217689836748667' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1867217689836748667' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-2075893424'/><gd:extendedProperty name='blogger.displayTime' value='16 October 2013 at 21:58'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1688506653690037366</id><published>2013-10-17T09:23:36.638+01:00</published><updated>2013-10-17T09:23:36.638+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>My pleasure Alan!</title><content type='html'>My pleasure Alan!</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1867217689836748667/comments/default/1688506653690037366'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1867217689836748667/comments/default/1688506653690037366'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/02/unit-testing-mvc-controllers-mocking.html?showComment=1381998216638#c1688506653690037366' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1867217689836748667/comments/default/4420968803197270458'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/02/unit-testing-mvc-controllers-mocking.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1867217689836748667' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1867217689836748667' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='17 October 2013 at 09:23'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3944529987260270722</id><published>2013-10-23T15:19:59.317+01:00</published><updated>2013-10-23T15:19:59.317+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi John

Thanks for this article. I am also resear...</title><content type='html'>Hi John&lt;br /&gt;&lt;br /&gt;Thanks for this article. I am also researching this  as I am involved in a project where we want to use DI container to inject the DbContext, however my problem was how to test our repositories without a full blown integration test.&lt;br /&gt;&lt;br /&gt;I think this article and a few others and also Ladislav&amp;#39;s have made me decide that the halfway house is probably the best option for us. I am not sure why Microsoft have not provided the way forward on this matter as it seems to be a bone of contention for many developers.. I digres&lt;br /&gt;&lt;br /&gt;Anyway, thanks for the good work and keep it up</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3336760366966567957/comments/default/3944529987260270722'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3336760366966567957/comments/default/3944529987260270722'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/10/unit-testing-and-entity-framework-filth.html?showComment=1382537999317#c3944529987260270722' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/04155058122927569874</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/10/unit-testing-and-entity-framework-filth.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-3336760366966567957' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/3336760366966567957' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1124260368'/><gd:extendedProperty name='blogger.displayTime' value='23 October 2013 at 15:19'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1599586144679317595</id><published>2013-10-28T15:54:27.549Z</published><updated>2013-10-28T15:54:27.549Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi John,

I have a similar issue where I am using ...</title><content type='html'>Hi John,&lt;br /&gt;&lt;br /&gt;I have a similar issue where I am using struts-tag to generate my input field.  and the &amp;#39;x&amp;#39; is appearing on my textfield which I do not want to get displayed. Please could you let me know how you resolved to get rid of the pseudo element event in this case. &lt;br /&gt;--R</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1965872403036778857/comments/default/1599586144679317595'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1965872403036778857/comments/default/1599586144679317595'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/04/making-ie-10s-clear-field-x-button-and.html?showComment=1382975667549#c1599586144679317595' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1965872403036778857/comments/default/7110785153098132460'/><author><name>Unknown</name><uri>https://www.blogger.com/profile/00818372449982562892</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/04/making-ie-10s-clear-field-x-button-and.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1965872403036778857' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1965872403036778857' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1643974349'/><gd:extendedProperty name='blogger.displayTime' value='28 October 2013 at 15:54'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3427384680817095670</id><published>2013-11-09T18:04:37.819Z</published><updated>2013-11-09T18:04:37.819Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>&lt;a href="http://codeshop.co" rel="nofollow"&gt;bootst...</title><content type='html'>&lt;a href="http://codeshop.co" rel="nofollow"&gt;bootstrap&lt;/a&gt; modal (the frame) is an extended backbone view (its thin layer is defined inside the lib), the backbone modal .... Subscribe to: Post Comments (Atom)&lt;a href="http://codeshop.co" rel="nofollow"&gt;bootstrap&lt;/a&gt;&lt;br /&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/3427384680817095670'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/3427384680817095670'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html?showComment=1384020277819#c3427384680817095670' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/06062356502571970176</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-5753576792954274953' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/5753576792954274953' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1006092999'/><gd:extendedProperty name='blogger.displayTime' value='9 November 2013 at 18:04'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6033536643269906268</id><published>2013-11-14T04:17:17.817Z</published><updated>2013-11-14T04:17:17.817Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Thanks John, excellent article on Cassette.</title><content type='html'>Thanks John, excellent article on Cassette.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3969527661757943742/comments/default/6033536643269906268'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3969527661757943742/comments/default/6033536643269906268'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/06/how-im-using-cassette-part-2.html?showComment=1384402637817#c6033536643269906268' title=''/><author><name>James Star</name><uri>https://www.blogger.com/profile/08588150745648618010</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/06/how-im-using-cassette-part-2.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-3969527661757943742' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/3969527661757943742' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-2119198672'/><gd:extendedProperty name='blogger.displayTime' value='14 November 2013 at 04:17'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6386062843211917677</id><published>2013-11-19T16:54:52.766Z</published><updated>2013-11-19T16:54:52.766Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Good day sir John!,

        I&amp;#39;m new in MVC ap...</title><content type='html'>Good day sir John!,&lt;br /&gt;&lt;br /&gt;        I&amp;#39;m new in MVC app and I was pretty amaze on doing the looping part in view that was +100 for me. could you please make some tutorials about it? from Model &amp;gt; DBContext &amp;gt; Controller &amp;gt; View... because I have a bunch of maintenance module like(Employee, Department, Position and etc maintenance on database) and I want to do it on just one View and one Controller which I could reuse it with different models... Is it possible?? or impossible to implement it? thank you sir for making this creative tutorials!.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/9066088698325396956/comments/default/6386062843211917677'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/9066088698325396956/comments/default/6386062843211917677'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/01/twitterbootstrapmvc4-meet-bootstrap.html?showComment=1384880092766#c6386062843211917677' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/09142154308982488678</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/01/twitterbootstrapmvc4-meet-bootstrap.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-9066088698325396956' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/9066088698325396956' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1815798051'/><gd:extendedProperty name='blogger.displayTime' value='19 November 2013 at 16:54'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-223692962582815551</id><published>2013-11-30T06:17:21.613Z</published><updated>2013-11-30T06:17:21.613Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Just wanted to let you know I came across the post...</title><content type='html'>Just wanted to let you know I came across the post while looking for a method to raise an error on 4 fields when any one of them caused an error and then remove the error class from all 4 when they all passed again.&lt;br /&gt;&lt;br /&gt;Nothing to do with tooltips but your post really helped my understand the showErrors and the code to remove all valid errors was the winner&lt;br /&gt;&lt;br /&gt;thank you :)</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/223692962582815551'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/223692962582815551'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html?showComment=1385792241613#c223692962582815551' title=''/><author><name>Marky Roden</name><uri>https://www.blogger.com/profile/17317724219454040781</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-5753576792954274953' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/5753576792954274953' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-245084710'/><gd:extendedProperty name='blogger.displayTime' value='30 November 2013 at 06:17'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8629621730086389675</id><published>2013-11-30T06:58:56.853Z</published><updated>2013-11-30T06:58:56.853Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Happy to have helped (albeit in an unexpected way!)</title><content type='html'>Happy to have helped (albeit in an unexpected way!)</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/8629621730086389675'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/8629621730086389675'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html?showComment=1385794736853#c8629621730086389675' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/223692962582815551'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-5753576792954274953' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/5753576792954274953' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='30 November 2013 at 06:58'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-7420787718096994076</id><published>2013-12-12T05:50:16.282Z</published><updated>2013-12-12T05:50:16.282Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hey there,
                Your blog is great,..Th...</title><content type='html'>Hey there,&lt;br /&gt;                Your blog is great,..Thanks for this great knowledge sharing blog,...Continue this knowledge spreading task,...It would be very helpful, if you add some more topics on Hibernate and struts...&lt;a href="http://codeshop.co" rel="nofollow"&gt;Bootstrap3.0-100% Responsive&lt;/a&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/9066088698325396956/comments/default/7420787718096994076'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/9066088698325396956/comments/default/7420787718096994076'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/01/twitterbootstrapmvc4-meet-bootstrap.html?showComment=1386827416282#c7420787718096994076' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/07639505174790169369</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/01/twitterbootstrapmvc4-meet-bootstrap.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-9066088698325396956' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/9066088698325396956' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1741732061'/><gd:extendedProperty name='blogger.displayTime' value='12 December 2013 at 05:50'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1683443205324812742</id><published>2013-12-17T16:29:03.987Z</published><updated>2013-12-17T16:29:03.987Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi John,

i have used the tool to generate the PDF...</title><content type='html'>Hi John,&lt;br /&gt;&lt;br /&gt;i have used the tool to generate the PDFs and its working fine only with one exception. some times the URL that i parse to PDF have additional information that is added to the web page at run time and this is with a third party. &lt;br /&gt;&lt;br /&gt;In these cases the generate PDF doesn&amp;#39;t show the full text on the PDF.&lt;br /&gt;&lt;br /&gt;is there a way i can make the tool to wait for certain time before generating the PDF.&lt;br /&gt;WaitForExit(300000)&lt;br /&gt;isn&amp;#39;t working because it kicks in if the application stops responding and in my case it completes the operation in less than 3 seconds.&lt;br /&gt;&lt;br /&gt;- Harpreet</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/1683443205324812742'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/1683443205324812742'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html?showComment=1387297743987#c1683443205324812742' title=''/><author><name>Monty</name><uri>https://www.blogger.com/profile/12068092319519836797</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-8680133602632737625' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/8680133602632737625' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1641063111'/><gd:extendedProperty name='blogger.displayTime' value='17 December 2013 at 16:29'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6407238043485412524</id><published>2013-12-26T21:24:20.932Z</published><updated>2013-12-26T21:24:20.932Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>this is not working for phoneUS validation, Can yo...</title><content type='html'>this is not working for phoneUS validation, Can you help, why ?</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/6407238043485412524'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/6407238043485412524'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html?showComment=1388093060932#c6407238043485412524' title=''/><author><name>Harsh Pandya</name><uri>https://www.blogger.com/profile/13930110751075906584</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-5753576792954274953' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/5753576792954274953' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1284932866'/><gd:extendedProperty name='blogger.displayTime' value='26 December 2013 at 21:24'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8009932993195178954</id><published>2013-12-30T19:17:52.906Z</published><updated>2013-12-30T19:17:52.906Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Any idea how to deal with route constraints that m...</title><content type='html'>Any idea how to deal with route constraints that may make the test fail?  Just curious as it would appear that Moq doesn&amp;#39;t really provide a way to handle these.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1867217689836748667/comments/default/8009932993195178954'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1867217689836748667/comments/default/8009932993195178954'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/02/unit-testing-mvc-controllers-mocking.html?showComment=1388431072906#c8009932993195178954' title=''/><author><name>Atorian</name><uri>https://www.blogger.com/profile/04677940929016642141</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/02/unit-testing-mvc-controllers-mocking.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1867217689836748667' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1867217689836748667' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1039911550'/><gd:extendedProperty name='blogger.displayTime' value='30 December 2013 at 19:17'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1741265688114700649</id><published>2014-01-03T23:36:38.352Z</published><updated>2014-01-03T23:36:38.352Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Had issues implementing the controller context as ...</title><content type='html'>Had issues implementing the controller context as all my unit test are against the WebAPI controller context, but while searching how to implement the MVC controller context, I came across your previous post from Feb about mocking it and it&amp;#39;s all been put together into a nice and elegant solution to test my data annotations.&lt;br /&gt;Thanks!</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/6463585883554513120/comments/default/1741265688114700649'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/6463585883554513120/comments/default/1741265688114700649'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/03/unit-testing-modelstate.html?showComment=1388792198352#c1741265688114700649' title=''/><author><name>MattG</name><uri>https://www.blogger.com/profile/16535851536788152589</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/03/unit-testing-modelstate.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-6463585883554513120' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/6463585883554513120' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1858407350'/><gd:extendedProperty name='blogger.displayTime' value='3 January 2014 at 23:36'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3812387949388196288</id><published>2014-01-10T00:20:19.285Z</published><updated>2014-01-10T00:20:19.285Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Folks
I&amp;#39;ve written a few simplified Bloomberg ...</title><content type='html'>Folks&lt;br /&gt;I&amp;#39;ve written a few simplified Bloomberg API examples / tutorials using Win32 C++ applications and the Bloomberg Desktop API Feel free to share: http://holowczak.com/category/bloomberg/</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/3812387949388196288'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/3812387949388196288'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html?showComment=1389313219285#c3812387949388196288' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/16098572831514746090</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1492382956545126674' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1492382956545126674' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-2036596462'/><gd:extendedProperty name='blogger.displayTime' value='10 January 2014 at 00:20'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5096417388745687598</id><published>2014-01-13T10:53:38.217Z</published><updated>2014-01-13T10:53:38.217Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi John,

This is very nice script, thank you for ...</title><content type='html'>Hi John,&lt;br /&gt;&lt;br /&gt;This is very nice script, thank you for that. I would like to ask you for a problem that my solution came with: why is the browser culture always taken instead of the Thread.CurrentThread.CurrentCulture? Will that be always the case, because I am not happy using that culture all the time for validations. &lt;br /&gt;&lt;br /&gt;Thank you a lot.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/5096417388745687598'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/5096417388745687598'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html?showComment=1389610418217#c5096417388745687598' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/06706396026762384166</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-2414704032922872709' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/2414704032922872709' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-834844683'/><gd:extendedProperty name='blogger.displayTime' value='13 January 2014 at 10:53'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4298484096536897542</id><published>2014-01-13T11:05:38.088Z</published><updated>2014-01-13T11:05:38.088Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi Kristina,

Glad you like it!  

To your questio...</title><content type='html'>Hi Kristina,&lt;br /&gt;&lt;br /&gt;Glad you like it!  &lt;br /&gt;&lt;br /&gt;To your question: this is probably a question for Microsoft rather than me :-)  If you hook in the below code then this is the behaviour:&lt;br /&gt;&lt;br /&gt;&amp;lt;globalization culture=&amp;quot;auto&amp;quot; uiCulture=&amp;quot;auto&amp;quot; /&amp;gt;&lt;br /&gt;&lt;br /&gt;I don&amp;#39;t know for sure but perhaps it&amp;#39;s possible to hook into this mechanism and tweak it a little for your own purposes.  Best of luck!</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/4298484096536897542'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/4298484096536897542'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html?showComment=1389611138088#c4298484096536897542' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/5096417388745687598'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-2414704032922872709' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/2414704032922872709' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='13 January 2014 at 11:05'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3703480907443292834</id><published>2014-01-13T11:47:22.394Z</published><updated>2014-01-13T11:47:22.394Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Thank you John for the prompt answer. 

I am confu...</title><content type='html'>Thank you John for the prompt answer. &lt;br /&gt;&lt;br /&gt;I am confused a little bit. Can you please tell me if the lang attribute of the html will be always ignored because of the language set in the browser?</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/3703480907443292834'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/3703480907443292834'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html?showComment=1389613642394#c3703480907443292834' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/5096417388745687598'/><author><name>Unknown</name><uri>https://www.blogger.com/profile/06706396026762384166</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-2414704032922872709' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/2414704032922872709' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-834844683'/><gd:extendedProperty name='blogger.displayTime' value='13 January 2014 at 11:47'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1269818812206707844</id><published>2014-01-13T15:00:12.186Z</published><updated>2014-01-13T15:00:12.186Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi Kristina,

The lang attribute is set from the S...</title><content type='html'>Hi Kristina,&lt;br /&gt;&lt;br /&gt;The lang attribute is set from the System.Globalization.CultureInfo.CurrentUICulture.Name.  The CurrentUICulture itself is driven by whether you have set the globalization web config setting to auto (or indeed to another fixed locale - eg &amp;quot;de-DE&amp;quot;).  If it hasn&amp;#39;t been set then I believe that the CurrentUICulture is driven by the machine hosting the code.&lt;br /&gt;&lt;br /&gt;Does that answer your question?</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/1269818812206707844'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/1269818812206707844'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html?showComment=1389625212186#c1269818812206707844' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/5096417388745687598'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-2414704032922872709' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/2414704032922872709' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='13 January 2014 at 15:00'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5890208183360327670</id><published>2014-01-28T13:08:35.213Z</published><updated>2014-01-28T13:08:35.213Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hello John,

First of all, thanks for sharing!! ;)...</title><content type='html'>Hello John,&lt;br /&gt;&lt;br /&gt;First of all, thanks for sharing!! ;)&lt;br /&gt;&lt;br /&gt;How could I use you script with multiple forms groups in ASP.NET. I have some differents form groups in the same page. Is there some way to validate this groups separately?</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/5890208183360327670'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/5890208183360327670'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html?showComment=1390914515213#c5890208183360327670' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/08949620190120746818</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-5753576792954274953' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/5753576792954274953' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-2100251540'/><gd:extendedProperty name='blogger.displayTime' value='28 January 2014 at 13:08'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5702248087364514260</id><published>2014-01-28T14:17:33.110Z</published><updated>2014-01-28T14:17:33.110Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>My pleasure Fernando!

I&amp;#39;m not sure I understa...</title><content type='html'>My pleasure Fernando!&lt;br /&gt;&lt;br /&gt;I&amp;#39;m not sure I understand your question.  Are you talking about the groups option of jQuery Validate? ( http://jqueryvalidation.org/validate )  </content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/5702248087364514260'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/5702248087364514260'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html?showComment=1390918653110#c5702248087364514260' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/5890208183360327670'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-5753576792954274953' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/5753576792954274953' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='28 January 2014 at 14:17'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4660770873735977660</id><published>2014-01-28T22:30:50.466Z</published><updated>2014-01-28T22:30:50.466Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Great validation with tooltip option. 
here is ant...</title><content type='html'>Great validation with tooltip option. &lt;br /&gt;here is anther way to validate with bootstrap. &lt;br /&gt;http://twitterbootstrap.org/bootstrap-form-validation/&lt;br /&gt;&lt;br /&gt;thansk</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/4660770873735977660'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/4660770873735977660'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html?showComment=1390948250466#c4660770873735977660' title=''/><author><name>Roz</name><uri>https://www.blogger.com/profile/00198927758783829421</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-5753576792954274953' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/5753576792954274953' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1747181693'/><gd:extendedProperty name='blogger.displayTime' value='28 January 2014 at 22:30'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1455281634544199748</id><published>2014-02-03T07:15:44.483Z</published><updated>2014-02-03T07:40:39.286Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'></title><content type='html'>This comment has been removed by the author.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/1455281634544199748'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/1455281634544199748'/><author><name>Unknown</name><uri>https://www.blogger.com/profile/06702030495122508627</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-5753576792954274953' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/5753576792954274953' type='text/html'/><gd:extendedProperty name='blogger.contentRemoved' value='true'/><gd:extendedProperty name='blogger.itemClass' value='pid-1125692375'/><gd:extendedProperty name='blogger.displayTime' value='3 February 2014 at 07:15'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4286310925486796312</id><published>2014-02-03T07:42:12.282Z</published><updated>2014-02-03T07:42:12.282Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>the string text box accepting number also....is th...</title><content type='html'>the string text box accepting number also....is there any validation for string </content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/4286310925486796312'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/4286310925486796312'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html?showComment=1391413332282#c4286310925486796312' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/06702030495122508627</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-5753576792954274953' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/5753576792954274953' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1125692375'/><gd:extendedProperty name='blogger.displayTime' value='3 February 2014 at 07:42'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-7761521346736949685</id><published>2014-02-13T09:43:42.256Z</published><updated>2014-02-13T09:43:42.256Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>How can we do this in IE8, same problem happening ...</title><content type='html'>How can we do this in IE8, same problem happening in IE8 also. Please advise. </content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1965872403036778857/comments/default/7761521346736949685'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1965872403036778857/comments/default/7761521346736949685'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/04/making-ie-10s-clear-field-x-button-and.html?showComment=1392284622256#c7761521346736949685' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/01979359825654402746</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/04/making-ie-10s-clear-field-x-button-and.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1965872403036778857' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1965872403036778857' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1773421048'/><gd:extendedProperty name='blogger.displayTime' value='13 February 2014 at 09:43'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4189103035436028728</id><published>2014-02-14T17:18:32.543Z</published><updated>2014-02-14T17:18:32.543Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Nice article - exactly the stuff i was debating wi...</title><content type='html'>Nice article - exactly the stuff i was debating with others - provides lots of things to think about</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3336760366966567957/comments/default/4189103035436028728'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3336760366966567957/comments/default/4189103035436028728'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/10/unit-testing-and-entity-framework-filth.html?showComment=1392398312543#c4189103035436028728' title=''/><author><name>Mike O'Connor</name><uri>https://www.blogger.com/profile/03183367175303655990</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/10/unit-testing-and-entity-framework-filth.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-3336760366966567957' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/3336760366966567957' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-358717281'/><gd:extendedProperty name='blogger.displayTime' value='14 February 2014 at 17:18'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2046607784162669826</id><published>2014-02-14T18:21:59.300Z</published><updated>2014-02-14T18:21:59.300Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Fantastic. This is exactly what I was looking for....</title><content type='html'>Fantastic. This is exactly what I was looking for. Weird that it isn&amp;#39;t documented yet. Maybe we should help out!</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2537929858771005565/comments/default/2046607784162669826'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2537929858771005565/comments/default/2046607784162669826'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/06/jquery-validate-native-unobtrusive-validation.html?showComment=1392402119300#c2046607784162669826' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/05125815485824813864</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/06/jquery-validate-native-unobtrusive-validation.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-2537929858771005565' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/2537929858771005565' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1428224286'/><gd:extendedProperty name='blogger.displayTime' value='14 February 2014 at 18:21'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2818230100570712568</id><published>2014-02-15T06:02:21.084Z</published><updated>2014-02-15T06:02:21.084Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Great idea Peter!</title><content type='html'>Great idea Peter!</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2537929858771005565/comments/default/2818230100570712568'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2537929858771005565/comments/default/2818230100570712568'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/06/jquery-validate-native-unobtrusive-validation.html?showComment=1392444141084#c2818230100570712568' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2537929858771005565/comments/default/2046607784162669826'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/06/jquery-validate-native-unobtrusive-validation.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-2537929858771005565' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/2537929858771005565' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='15 February 2014 at 06:02'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5021367689679388206</id><published>2014-02-15T18:03:06.426Z</published><updated>2014-02-15T18:03:06.426Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>I don&amp;#39;t think this is controversial at all. Af...</title><content type='html'>I don&amp;#39;t think this is controversial at all. After my first experience developing a complex UI in HTML/JS as a &amp;quot;single page app&amp;quot; a few years ago, initially I assumed it was going to be painful. After a while I realised it was the most productive such platform I&amp;#39;d ever used (most recent ones being desktop WPF and Winforms).&lt;br /&gt;&lt;br /&gt;Furthermore I resolved that whatever platform I was supposed to develop UIs for in the future, I would host a browser engine so I could use HTML/JS to implement it!&lt;br /&gt;&lt;br /&gt;In fact I did this in 2012 for an extension to Microsoft Office 2010. I wrote a very simple minimal core extension in C++ that wrapped IE so it appears as a docked pane in Excel or Word, and then everything else is done in JS/HTML/CSS. (The same idea is now built into Office 2013 as a standard SDK feature.) </content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8425334825255073023/comments/default/5021367689679388206'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8425334825255073023/comments/default/5021367689679388206'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2014/02/wpf-and-mystic-meg-or-playing.html?showComment=1392487386426#c5021367689679388206' title=''/><author><name>Daniel</name><uri>https://www.blogger.com/profile/11384619047799752406</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2014/02/wpf-and-mystic-meg-or-playing.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-8425334825255073023' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/8425334825255073023' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-520573228'/><gd:extendedProperty name='blogger.displayTime' value='15 February 2014 at 18:03'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3095404269594371367</id><published>2014-02-15T18:52:49.505Z</published><updated>2014-02-15T18:52:49.505Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>That&amp;#39;s fascinating Daniel - thanks for sharing...</title><content type='html'>That&amp;#39;s fascinating Daniel - thanks for sharing that.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8425334825255073023/comments/default/3095404269594371367'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8425334825255073023/comments/default/3095404269594371367'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2014/02/wpf-and-mystic-meg-or-playing.html?showComment=1392490369505#c3095404269594371367' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8425334825255073023/comments/default/5021367689679388206'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2014/02/wpf-and-mystic-meg-or-playing.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-8425334825255073023' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/8425334825255073023' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='15 February 2014 at 18:52'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-569168448859172032</id><published>2014-03-02T16:55:10.797Z</published><updated>2014-03-02T16:55:10.797Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi John, thank you very much for your post. Though...</title><content type='html'>Hi John, thank you very much for your post. Though, using your code I am facing a problem while reading the output. It seems that it never gets throught it despite the fact that it creates the pdf document. Here&amp;#39;s the line where it stays and never pass it. &lt;br /&gt;// read the output here...&lt;br /&gt;var output = p.StandardOutput.ReadToEnd();&lt;br /&gt;&lt;br /&gt;Of course, I have to re-open Visual Studio in order to access the pdf document cause the tool is using it. Any ideas?</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/569168448859172032'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/569168448859172032'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html?showComment=1393779310797#c569168448859172032' title=''/><author><name>Anonymous</name><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//resources.blogblog.com/img/blank.gif'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-8680133602632737625' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/8680133602632737625' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1995697193'/><gd:extendedProperty name='blogger.displayTime' value='2 March 2014 at 16:55'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5451860065590476443</id><published>2014-03-03T12:28:53.851Z</published><updated>2014-03-03T12:28:53.851Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Isn&amp;#39;t there a bit of a security issue at hand ...</title><content type='html'>Isn&amp;#39;t there a bit of a security issue at hand if we store usernames and passwords in a file? Maybe it is encrypted or compiled into a format not readable by humans?</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8483456789773291349/comments/default/5451860065590476443'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8483456789773291349/comments/default/5451860065590476443'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/03/wcf-moving-from-config-to-code-simple.html?showComment=1393849733851#c5451860065590476443' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/16353449287452813689</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/03/wcf-moving-from-config-to-code-simple.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-8483456789773291349' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/8483456789773291349' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-124642361'/><gd:extendedProperty name='blogger.displayTime' value='3 March 2014 at 12:28'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6157695093307599334</id><published>2014-03-03T12:45:38.495Z</published><updated>2014-03-03T12:45:38.495Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>That&amp;#39;s a completely valid point Johan.   I wou...</title><content type='html'>That&amp;#39;s a completely valid point Johan.   I would always advise encrypting sensitive information in any kind of production application.   This was more a &amp;quot;how to do it&amp;quot; type post and I didn&amp;#39;t want to divert off into that at the same time.  &lt;br /&gt;&lt;br /&gt;But in case that wasn&amp;#39;t clear from the post - I agree with you that security is of paramount importance.  Let&amp;#39;s be careful out there! :-)</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8483456789773291349/comments/default/6157695093307599334'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8483456789773291349/comments/default/6157695093307599334'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/03/wcf-moving-from-config-to-code-simple.html?showComment=1393850738495#c6157695093307599334' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8483456789773291349/comments/default/5451860065590476443'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/03/wcf-moving-from-config-to-code-simple.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-8483456789773291349' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/8483456789773291349' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='3 March 2014 at 12:45'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8993161735250734382</id><published>2014-03-05T16:51:29.942Z</published><updated>2014-03-05T16:51:29.942Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>You save my day. Thank you !!! </title><content type='html'>You save my day. Thank you !!! </content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/4158515250667393929/comments/default/8993161735250734382'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/4158515250667393929/comments/default/8993161735250734382'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/04/ie-10-install-torches-javascript.html?showComment=1394038289942#c8993161735250734382' title=''/><author><name>creatigent</name><uri>https://www.blogger.com/profile/06648423720108206401</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/04/ie-10-install-torches-javascript.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-4158515250667393929' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/4158515250667393929' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-500223981'/><gd:extendedProperty name='blogger.displayTime' value='5 March 2014 at 16:51'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-15022624196879819</id><published>2014-03-06T10:19:01.519Z</published><updated>2014-03-06T10:19:01.519Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Great validation with tooltip option. 
I am using ...</title><content type='html'>Great validation with tooltip option. &lt;br /&gt;I am using captcha in my form. How can i validate captcha?</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/15022624196879819'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/15022624196879819'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html?showComment=1394101141519#c15022624196879819' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/15158826476397633662</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-5753576792954274953' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/5753576792954274953' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-458209086'/><gd:extendedProperty name='blogger.displayTime' value='6 March 2014 at 10:19'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8321615079933351251</id><published>2014-03-06T15:02:24.918Z</published><updated>2014-03-06T15:02:24.918Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Glad it helped!  I&amp;#39;m afraid I can&amp;#39;t help w...</title><content type='html'>Glad it helped!  I&amp;#39;m afraid I can&amp;#39;t help with captcha.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/8321615079933351251'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/8321615079933351251'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html?showComment=1394118144918#c8321615079933351251' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/15022624196879819'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-5753576792954274953' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/5753576792954274953' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='6 March 2014 at 15:02'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-7046986883309877068</id><published>2014-03-10T21:27:01.026Z</published><updated>2014-03-10T21:27:01.026Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Thank you very much for the post...to the point......</title><content type='html'>Thank you very much for the post...to the point...keep posting...</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/6463585883554513120/comments/default/7046986883309877068'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/6463585883554513120/comments/default/7046986883309877068'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/03/unit-testing-modelstate.html?showComment=1394486821026#c7046986883309877068' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/09926561781727148385</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/03/unit-testing-modelstate.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-6463585883554513120' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/6463585883554513120' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-362307402'/><gd:extendedProperty name='blogger.displayTime' value='10 March 2014 at 21:27'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8703058584652611069</id><published>2014-03-13T15:43:26.357Z</published><updated>2014-03-13T15:43:26.357Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>This helped me out today. I found it when looking ...</title><content type='html'>This helped me out today. I found it when looking around to find out if this was even a possibility. Thanks for taking the time to write it up.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/7273363052780837835/comments/default/8703058584652611069'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/7273363052780837835/comments/default/8703058584652611069'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/10/using-web-optimization-with-mvc-3.html?showComment=1394725406357#c8703058584652611069' title=''/><author><name>Brad Teller</name><uri>https://www.blogger.com/profile/09209189727822767520</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/10/using-web-optimization-with-mvc-3.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-7273363052780837835' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/7273363052780837835' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-104981939'/><gd:extendedProperty name='blogger.displayTime' value='13 March 2014 at 15:43'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8523244217287090701</id><published>2014-03-13T20:31:12.328Z</published><updated>2014-03-13T20:31:12.328Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Thank you so much for finding this and giving such...</title><content type='html'>Thank you so much for finding this and giving such a great, detailed example. This is *exactly* what I wanted.&lt;br /&gt;&lt;br /&gt;jQuery Validate has always been my go-to validation tool, but I&amp;#39;ve been wanting to declare validation rules with data attributes for a while now. With this being undocumented I went ahead and tried out Parsley and Verify, both of which currently don&amp;#39;t quite match my expectations and needs.&lt;br /&gt;&lt;br /&gt;After a lot of unsuccessful fiddling, I had one more &amp;quot;let&amp;#39;s Google this&amp;quot; moment and came across your post. Amazing!</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2537929858771005565/comments/default/8523244217287090701'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2537929858771005565/comments/default/8523244217287090701'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/06/jquery-validate-native-unobtrusive-validation.html?showComment=1394742672328#c8523244217287090701' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/14049903962981226806</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/06/jquery-validate-native-unobtrusive-validation.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-2537929858771005565' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/2537929858771005565' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-2048097440'/><gd:extendedProperty name='blogger.displayTime' value='13 March 2014 at 20:31'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8184335657207020430</id><published>2014-03-13T20:33:38.795Z</published><updated>2014-03-13T20:33:38.795Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Happy to help!</title><content type='html'>Happy to help!</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2537929858771005565/comments/default/8184335657207020430'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2537929858771005565/comments/default/8184335657207020430'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/06/jquery-validate-native-unobtrusive-validation.html?showComment=1394742818795#c8184335657207020430' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2537929858771005565/comments/default/8523244217287090701'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/06/jquery-validate-native-unobtrusive-validation.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-2537929858771005565' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/2537929858771005565' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='13 March 2014 at 20:33'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6995138048720160540</id><published>2014-03-18T09:50:42.000Z</published><updated>2014-03-18T09:50:42.000Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi John,

Thanks for sharing exactly what I was lo...</title><content type='html'>Hi John,&lt;br /&gt;&lt;br /&gt;Thanks for sharing exactly what I was looking for, since days!&lt;br /&gt;I, however, am stuck at the very beginning of it.&lt;br /&gt;&lt;br /&gt;When I try to implement the above code, my Firefox doesn&amp;#39;t recognize it and returns me an error message saying &lt;br /&gt;&lt;br /&gt;&amp;#39;ReferenceError: Q is not defined&amp;#39;&lt;br /&gt;&lt;br /&gt;Any idea what I might be doing wrong? Any heads-up will be highly appreciated.&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;Thanks,&lt;br /&gt;Wilson!</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/6102727490268694692/comments/default/6995138048720160540'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/6102727490268694692/comments/default/6995138048720160540'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/11/rolling-your-own-confirm-mechanism.html?showComment=1395136242000#c6995138048720160540' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/05219455720226247004</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/11/rolling-your-own-confirm-mechanism.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-6102727490268694692' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/6102727490268694692' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-242147865'/><gd:extendedProperty name='blogger.displayTime' value='18 March 2014 at 09:50'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5706294140563173631</id><published>2014-03-18T10:00:11.722Z</published><updated>2014-03-18T10:00:11.722Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi Wilson,

Glad you like it! You need to referenc...</title><content type='html'>Hi Wilson,&lt;br /&gt;&lt;br /&gt;Glad you like it! You need to reference jQuery, jQuery UI and Q before the code I list. With those in place you should be good to go.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/6102727490268694692/comments/default/5706294140563173631'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/6102727490268694692/comments/default/5706294140563173631'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/11/rolling-your-own-confirm-mechanism.html?showComment=1395136811722#c5706294140563173631' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/6102727490268694692/comments/default/6995138048720160540'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/11/rolling-your-own-confirm-mechanism.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-6102727490268694692' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/6102727490268694692' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='18 March 2014 at 10:00'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3764298226781319614</id><published>2014-03-19T10:39:13.952Z</published><updated>2014-03-19T10:39:13.952Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Great thanks !!!
This is working but i have issue ...</title><content type='html'>Great thanks !!!&lt;br /&gt;This is working but i have issue like the confirmDialog is not stopping like confirm&lt;br /&gt;for example &lt;br /&gt; confirmDialog(&amp;#39;Did this player1, &amp;quot;ok&amp;quot;, &amp;quot;cancel&amp;quot;, &amp;quot;title&amp;quot;).then(function (confirmed) { if (confirmed !== true) {                                return false; } });&lt;br /&gt; confirmDialog(&amp;#39;Did this player&amp;#39;2, &amp;quot;ok&amp;quot;, &amp;quot;cancel&amp;quot;, &amp;quot;title&amp;quot;).then(function (confirmed) {if (confirmed !== true) {                return false; }});&lt;br /&gt; Here i have two confirmDialog but the first Dialog popup is not stop the execution of next Dialog, directly i am getting  the second box message &lt;br /&gt; &lt;br /&gt; conformvalue = confirm(&amp;quot;Did.&amp;quot;);  if (conformvalue !== true) { return false; }&lt;br /&gt; conformvalue = confirm(&amp;quot;Did2&amp;quot;);   if (conformvalue !== true) { return false; }</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/6102727490268694692/comments/default/3764298226781319614'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/6102727490268694692/comments/default/3764298226781319614'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/11/rolling-your-own-confirm-mechanism.html?showComment=1395225553952#c3764298226781319614' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/05219455720226247004</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/11/rolling-your-own-confirm-mechanism.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-6102727490268694692' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/6102727490268694692' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-242147865'/><gd:extendedProperty name='blogger.displayTime' value='19 March 2014 at 10:39'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8919197336691116512</id><published>2014-03-19T11:00:53.823Z</published><updated>2014-03-19T11:00:53.823Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi Wilson,

I can&amp;#39;t quite follow your code but...</title><content type='html'>Hi Wilson,&lt;br /&gt;&lt;br /&gt;I can&amp;#39;t quite follow your code but it looks like you&amp;#39;re not making use of promises.  It looks like you need to break your second confirm dialog into a subsequent &amp;quot;then&amp;quot; if you follow my meaning.  Remember you&amp;#39;re dealing with async.  Hope that helps.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/6102727490268694692/comments/default/8919197336691116512'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/6102727490268694692/comments/default/8919197336691116512'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/11/rolling-your-own-confirm-mechanism.html?showComment=1395226853823#c8919197336691116512' title=''/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/11/rolling-your-own-confirm-mechanism.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-6102727490268694692' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/6102727490268694692' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='19 March 2014 at 11:00'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4925925105184027123</id><published>2014-03-20T13:59:45.389Z</published><updated>2014-03-20T13:59:45.389Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Thanks John for this helpful blog :)

Why not init...</title><content type='html'>Thanks John for this helpful blog :)&lt;br /&gt;&lt;br /&gt;Why not initialise culture in layout page as below:&lt;br /&gt;&lt;br /&gt;$(document).ready(function () {&lt;br /&gt; &lt;br /&gt;    // Set Globalize to the current culture driven by the html lang property&lt;br /&gt;&lt;br /&gt;    if (currentCulture) {&lt;br /&gt;        Globalize.culture(&amp;quot;@Thread.CurrentThread.CurrentUICulture.Name&amp;quot;);&lt;br /&gt;    }&lt;br /&gt;&lt;br /&gt;});</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/4925925105184027123'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/4925925105184027123'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html?showComment=1395323985389#c4925925105184027123' title=''/><author><name>Mihir</name><uri>https://www.blogger.com/profile/06675405178563900259</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-2414704032922872709' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/2414704032922872709' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-2071775831'/><gd:extendedProperty name='blogger.displayTime' value='20 March 2014 at 13:59'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-7039557631980083194</id><published>2014-03-23T20:33:41.880Z</published><updated>2014-03-23T20:33:41.880Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Thank you very much for this. I am very new to thi...</title><content type='html'>Thank you very much for this. I am very new to this and trying to figure out how I would do Email address validation using this. Please let me know. Thanks.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/7039557631980083194'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/7039557631980083194'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html?showComment=1395606821880#c7039557631980083194' title=''/><author><name>SFStroller</name><uri>https://www.blogger.com/profile/09503573203703448813</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-5753576792954274953' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/5753576792954274953' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1345409282'/><gd:extendedProperty name='blogger.displayTime' value='23 March 2014 at 20:33'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3077167259640336104</id><published>2014-03-23T21:48:47.196Z</published><updated>2014-03-23T21:48:47.196Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>I would guess data-rule-email is what you need. I ...</title><content type='html'>I would guess data-rule-email is what you need. I don&amp;#39;t think I&amp;#39;ve used it so do report back if that&amp;#39;s correct.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/3077167259640336104'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/3077167259640336104'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html?showComment=1395611327196#c3077167259640336104' title=''/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-5753576792954274953' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/5753576792954274953' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='23 March 2014 at 21:48'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6320493493279898611</id><published>2014-03-26T04:09:32.421Z</published><updated>2014-03-26T04:09:32.421Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>If I have 2 select box , then it is not showing er...</title><content type='html'>If I have 2 select box , then it is not showing error on second box.&lt;br /&gt;&lt;br /&gt;Is there any issue with two select box in form ?</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/6320493493279898611'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/6320493493279898611'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html?showComment=1395806972421#c6320493493279898611' title=''/><author><name>Gaurav Bhargava</name><uri>https://www.blogger.com/profile/07614498138476535242</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-5753576792954274953' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/5753576792954274953' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-707642211'/><gd:extendedProperty name='blogger.displayTime' value='26 March 2014 at 04:09'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1095585627688768192</id><published>2014-03-26T08:12:46.626Z</published><updated>2014-03-26T08:12:46.626Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Not to my knowledge no.  I&amp;#39;ve had multiple sel...</title><content type='html'>Not to my knowledge no.  I&amp;#39;ve had multiple selects on a screen.  Only 1 tooltip shows at a time but that&amp;#39;s the nature of the tooltip implementation I think.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/1095585627688768192'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/1095585627688768192'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html?showComment=1395821566626#c1095585627688768192' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/6320493493279898611'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-5753576792954274953' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/5753576792954274953' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='26 March 2014 at 08:12'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5744557769527750969</id><published>2014-04-01T10:03:39.774+01:00</published><updated>2014-04-01T10:09:21.619+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'></title><content type='html'>This comment has been removed by the author.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/5744557769527750969'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/5744557769527750969'/><author><name>Unknown</name><uri>https://www.blogger.com/profile/16527477692012861311</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-8680133602632737625' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/8680133602632737625' type='text/html'/><gd:extendedProperty name='blogger.contentRemoved' value='true'/><gd:extendedProperty name='blogger.itemClass' value='pid-925716713'/><gd:extendedProperty name='blogger.displayTime' value='1 April 2014 at 10:03'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3370991093160465161</id><published>2014-04-01T10:13:17.685+01:00</published><updated>2014-04-01T10:13:17.685+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hey John, sorry about my deleting for update my qu...</title><content type='html'>Hey John, sorry about my deleting for update my question and that&amp;#39;s a good job. But for my case, i got an error which is: &lt;br /&gt;The directory name is invalid &lt;br /&gt;Description: An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code. &lt;br /&gt;&lt;br /&gt;Exception Details: System.ComponentModel.Win32Exception: The directory name is invalid&lt;br /&gt;&lt;br /&gt;Source Error: &lt;br /&gt;&lt;br /&gt;&lt;br /&gt;Line 59:                 };&lt;br /&gt;Line 60:  &lt;br /&gt;Line 61:                 p.Start();&lt;br /&gt;Line 62:  &lt;br /&gt;Line 63:                 // read the output here... &lt;br /&gt;&lt;br /&gt;Source File: c:\www\Development\demo.aspx.cs    Line: 61 &lt;br /&gt;&lt;br /&gt;what to do with that? may i have ur guiding?&lt;br /&gt;&lt;br /&gt;Sorry that i am a newbie in programming, hopefully can get your reply and thank you very much!</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/3370991093160465161'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/3370991093160465161'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html?showComment=1396343597685#c3370991093160465161' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/16527477692012861311</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-8680133602632737625' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/8680133602632737625' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-925716713'/><gd:extendedProperty name='blogger.displayTime' value='1 April 2014 at 10:13'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-7370601719132593544</id><published>2014-04-01T16:31:12.275+01:00</published><updated>2014-04-01T16:31:12.275+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Very helpful! Thank you very much!
But what if I o...</title><content type='html'>Very helpful! Thank you very much!&lt;br /&gt;But what if I omit the database logical name? Does it snapshot all database files, log included? </content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3111642035150099553/comments/default/7370601719132593544'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3111642035150099553/comments/default/7370601719132593544'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2014/01/integration-testing-with-entity.html?showComment=1396366272275#c7370601719132593544' title=''/><author><name>Van Fanel</name><uri>https://www.blogger.com/profile/10006632317540392942</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2014/01/integration-testing-with-entity.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-3111642035150099553' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/3111642035150099553' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-437516940'/><gd:extendedProperty name='blogger.displayTime' value='1 April 2014 at 16:31'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2857595028484556613</id><published>2014-04-01T21:18:08.174+01:00</published><updated>2014-04-01T21:18:08.174+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Some proxy servers and CDNs will strip off the get...</title><content type='html'>Some proxy servers and CDNs will strip off the get parameters before deciding if they should cache it or not, which is really the argument against using a get parameter to cache bust.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/4241616656191588777/comments/default/2857595028484556613'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/4241616656191588777/comments/default/2857595028484556613'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2014/03/caching-and-cache-busting-with-requirejs.html?showComment=1396383488174#c2857595028484556613' title=''/><author><name>airtonix</name><uri>https://www.blogger.com/profile/17182658340733365873</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='21' height='32' src='//2.bp.blogspot.com/_7Dw0tO1HPl0/S3WLfomcd4I/AAAAAAAAAAM/URnwXG1nPAE/S220-s32/logo.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2014/03/caching-and-cache-busting-with-requirejs.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-4241616656191588777' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/4241616656191588777' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1824071454'/><gd:extendedProperty name='blogger.displayTime' value='1 April 2014 at 21:18'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-313567026636169902</id><published>2014-04-02T08:21:00.435+01:00</published><updated>2014-04-02T08:21:00.435+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Damn it! You forgot to mention that database snaps...</title><content type='html'>Damn it! You forgot to mention that database snapshot are available only in ENTERPRISE EDITION of SQL Server! We cannot afford Enterprise Edition on all our machines :( &lt;br /&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3111642035150099553/comments/default/313567026636169902'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3111642035150099553/comments/default/313567026636169902'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2014/01/integration-testing-with-entity.html?showComment=1396423260435#c313567026636169902' title=''/><author><name>Van Fanel</name><uri>https://www.blogger.com/profile/10006632317540392942</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2014/01/integration-testing-with-entity.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-3111642035150099553' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/3111642035150099553' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-437516940'/><gd:extendedProperty name='blogger.displayTime' value='2 April 2014 at 08:21'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6092957789382157719</id><published>2014-04-02T09:13:35.185+01:00</published><updated>2014-04-02T09:13:35.185+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Oh that is frustrating!</title><content type='html'>Oh that is frustrating!</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3111642035150099553/comments/default/6092957789382157719'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3111642035150099553/comments/default/6092957789382157719'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2014/01/integration-testing-with-entity.html?showComment=1396426415185#c6092957789382157719' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3111642035150099553/comments/default/313567026636169902'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2014/01/integration-testing-with-entity.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-3111642035150099553' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/3111642035150099553' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='2 April 2014 at 09:13'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1596225627825310816</id><published>2014-04-02T14:44:50.519+01:00</published><updated>2014-04-02T14:44:50.519+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Thanks for pointing this out. I&amp;#39;ve been using ...</title><content type='html'>Thanks for pointing this out. I&amp;#39;ve been using the technique of &amp;quot;instance methods&amp;quot; already in my current JavaScript code, and happy that it is easy to achieve with TypeScript. It&amp;#39;s nothing more than keeping a reference to this in a closure, frequently seen as `var that = this;`.&lt;br /&gt;&lt;br /&gt;However, I&amp;#39;ve always wondered what would be the impact on performance and memory consumption with this approach. Since functions are objects, and using this technique could potentially create many objects per instance. Prototypes should help to only have single function definition objects in memory. Are JavaScript engines smart enough to realize that a certain instance method may already have been defined in memory, and that it can reference to the existing function object, instead of creating a new one?&lt;br /&gt;&lt;br /&gt;Any thoughts on this, or perhaps an answer?</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/7720980564026370784/comments/default/1596225627825310816'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/7720980564026370784/comments/default/1596225627825310816'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2014/04/typescript-instance-methods.html?showComment=1396446290519#c1596225627825310816' title=''/><author><name>Bart Verkoeijen</name><uri>https://www.blogger.com/profile/13048321036344749368</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='32' height='32' src='//2.bp.blogspot.com/-cVYvKRqJj6o/VfkJJmqglkI/AAAAAAAAUG8/v5RxIZ6YcEA/s32/dscf9811.jpg'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2014/04/typescript-instance-methods.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-7720980564026370784' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/7720980564026370784' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1317995523'/><gd:extendedProperty name='blogger.displayTime' value='2 April 2014 at 14:44'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2972044058777141680</id><published>2014-04-02T16:20:46.916+01:00</published><updated>2014-04-02T16:20:46.916+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Thats an excellent question!

I&amp;#39;ve a couple o...</title><content type='html'>Thats an excellent question!&lt;br /&gt;&lt;br /&gt;I&amp;#39;ve a couple of thoughts.  Initially when I heard of function.bind I thought that solved this particular problem.  However when I looked further I discovered that the bind method creates a new function rather than ensuring that this  has a specific value when methods are invoked. (Read more here: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/bind )  So bind has the same memory issues that Instance methods have. &lt;br /&gt;&lt;br /&gt;What Ive come to realise is that it comes down to problem that youre trying to solve.  Instance methods are bulletproof in terms of relying on a specific instance of this regardless of how a method is invoked.  But for many of my use cases thats overkill.  Lets take the original (prototype methods) Greeter example:&lt;br /&gt;&lt;br /&gt;var Greeter = (function () {&lt;br /&gt;    function Greeter(message) {&lt;br /&gt;        this.greeting = message;&lt;br /&gt;    }&lt;br /&gt;    Greeter.prototype.greet = function () {&lt;br /&gt;        return &amp;quot;Hello, &amp;quot; + this.greeting;&lt;br /&gt;    };&lt;br /&gt;    return Greeter;&lt;br /&gt;})();&lt;br /&gt;&lt;br /&gt;var greeter = new Greeter(&amp;quot;world&amp;quot;);&lt;br /&gt;var greeter2 = new Greeter(&amp;quot;universe&amp;quot;);&lt;br /&gt;&lt;br /&gt;console.log(greeter.greet()); // Hello, world&lt;br /&gt;console.log(greeter2.greet()); // Hello, universe&lt;br /&gt;&lt;br /&gt;As you can see above, provided I invoke my greet method in the context of my created object then I can rely on this being what I would hope.&lt;br /&gt;&lt;br /&gt;That being the case my general practice has not been to use exclusively Instance methods *or* prototype methods.  What I tend to do is start out only with prototype methods on my classes and switch them over to be an Instance method if there is an actual need to ensure context.  So my TypeScript classes tend to be a combination of prototype methods and Instance methods.&lt;br /&gt;&lt;br /&gt;More often than not the prototype methods are just fine.  It tends to be where an object is interacting with some kind of presentation framework (Knockout / Angular etc) or being invoked as part of a callback (eg AJAX scenarios) where I need Instance methods.  &lt;br /&gt;&lt;br /&gt;In all honesty its been quite a while since I encountered a situation where performance was an issue and so I wouldnt be over-worried about using Instance methods only.  That said, I always try and design for performance and so Im unlikely to ever do that.  &lt;br /&gt;&lt;br /&gt;Thanks for the question  good thing to think about.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/7720980564026370784/comments/default/2972044058777141680'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/7720980564026370784/comments/default/2972044058777141680'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2014/04/typescript-instance-methods.html?showComment=1396452046916#c2972044058777141680' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/7720980564026370784/comments/default/1596225627825310816'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2014/04/typescript-instance-methods.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-7720980564026370784' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/7720980564026370784' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='2 April 2014 at 16:20'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5778179604897762921</id><published>2014-04-03T18:09:56.563+01:00</published><updated>2014-04-03T18:09:56.563+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>You saved me, the docs on the Globalize github are...</title><content type='html'>You saved me, the docs on the Globalize github are out of date...</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5143753822429804028/comments/default/5778179604897762921'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5143753822429804028/comments/default/5778179604897762921'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/05/globalizejs-number-and-date.html?showComment=1396544996563#c5778179604897762921' title=''/><author><name>Omer Sabic</name><uri>https://www.blogger.com/profile/09751204577754500705</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/05/globalizejs-number-and-date.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-5143753822429804028' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/5143753822429804028' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1743430939'/><gd:extendedProperty name='blogger.displayTime' value='3 April 2014 at 18:09'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8280837503368682053</id><published>2014-04-03T19:00:19.378+01:00</published><updated>2014-04-03T19:00:19.378+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>HAppy to help. For what its worth my docs are the ...</title><content type='html'>HAppy to help. For what its worth my docs are the out of date ones. Globalize is evolving as we speak!</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5143753822429804028/comments/default/8280837503368682053'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5143753822429804028/comments/default/8280837503368682053'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/05/globalizejs-number-and-date.html?showComment=1396548019378#c8280837503368682053' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5143753822429804028/comments/default/5778179604897762921'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/05/globalizejs-number-and-date.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-5143753822429804028' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/5143753822429804028' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='3 April 2014 at 19:00'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-256529514610061358</id><published>2014-04-03T19:10:42.098+01:00</published><updated>2014-04-03T19:10:42.098+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>I downloaded 0.1.1 release and there was no &amp;quot;...</title><content type='html'>I downloaded 0.1.1 release and there was no &amp;quot;formatNumber&amp;quot; method and the params are specified as an object { ... } but it does not work, so your docs are correct for the latest release :)</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5143753822429804028/comments/default/256529514610061358'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5143753822429804028/comments/default/256529514610061358'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/05/globalizejs-number-and-date.html?showComment=1396548642098#c256529514610061358' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5143753822429804028/comments/default/5778179604897762921'/><author><name>Omer Sabic</name><uri>https://www.blogger.com/profile/09751204577754500705</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/05/globalizejs-number-and-date.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-5143753822429804028' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/5143753822429804028' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1743430939'/><gd:extendedProperty name='blogger.displayTime' value='3 April 2014 at 19:10'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3833850155834410232</id><published>2014-04-05T22:48:51.223+01:00</published><updated>2014-04-05T22:48:51.223+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>The Developer Edition has all the features of the ...</title><content type='html'>The Developer Edition has all the features of the Enterprise Edition, including snapshots.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3111642035150099553/comments/default/3833850155834410232'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3111642035150099553/comments/default/3833850155834410232'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2014/01/integration-testing-with-entity.html?showComment=1396734531223#c3833850155834410232' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3111642035150099553/comments/default/313567026636169902'/><author><name>Justin Constantino</name><uri>https://www.blogger.com/profile/05403247517188644380</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2014/01/integration-testing-with-entity.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-3111642035150099553' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/3111642035150099553' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1300838112'/><gd:extendedProperty name='blogger.displayTime' value='5 April 2014 at 22:48'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4925376847324333290</id><published>2014-04-07T20:38:32.925+01:00</published><updated>2014-04-07T20:38:32.925+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Awesome! I just gotta say &amp;quot;you rock!&amp;quot;  Y...</title><content type='html'>Awesome! I just gotta say &amp;quot;you rock!&amp;quot;  You have solved a problem I have been wracking my brain over for quite some time. Thanks for posting this information in a very easy to read and follow format. Funny think is, I almost thought this was a joke since you posted it on April Fools day. LOL!</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5055874890201691490/comments/default/4925376847324333290'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5055874890201691490/comments/default/4925376847324333290'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/04/death-to-compatibility-mode.html?showComment=1396899512925#c4925376847324333290' title=''/><author><name>ExNihilo</name><uri>https://www.blogger.com/profile/04361384802083676595</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/04/death-to-compatibility-mode.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-5055874890201691490' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/5055874890201691490' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1317090945'/><gd:extendedProperty name='blogger.displayTime' value='7 April 2014 at 20:38'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6928328536772010240</id><published>2014-04-07T20:53:02.709+01:00</published><updated>2014-04-07T20:53:02.709+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hah! Maybe I should change the date on the post :-...</title><content type='html'>Hah! Maybe I should change the date on the post :-)&lt;br /&gt;&lt;br /&gt;Happy to have helped.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5055874890201691490/comments/default/6928328536772010240'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5055874890201691490/comments/default/6928328536772010240'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/04/death-to-compatibility-mode.html?showComment=1396900382709#c6928328536772010240' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5055874890201691490/comments/default/4925376847324333290'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/04/death-to-compatibility-mode.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-5055874890201691490' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/5055874890201691490' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='7 April 2014 at 20:53'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-497175898825601085</id><published>2014-04-09T01:19:18.517+01:00</published><updated>2014-04-09T01:19:18.517+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Thanks for posting. I think things have changed wi...</title><content type='html'>Thanks for posting. I think things have changed with Bootstrap 3. I had to add the &amp;#39;has-error&amp;#39; class to the parent. This is what worked for me:&lt;br /&gt;&lt;br /&gt;$element.parent().addClass(&amp;quot;has-error&amp;quot;);&lt;br /&gt;            $element.tooltip(&amp;quot;destroy&amp;quot;) // Destroy any pre-existing tooltip so we can repopulate with new tooltip content&lt;br /&gt;                    .data(&amp;quot;title&amp;quot;, error.message)&lt;br /&gt;                    .tooltip(); // Create a new tooltip based on the error messsage we just set in the title&lt;br /&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/497175898825601085'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/497175898825601085'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html?showComment=1397002758517#c497175898825601085' title=''/><author><name>srlm</name><uri>https://www.blogger.com/profile/06337155395376430057</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-5753576792954274953' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/5753576792954274953' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-317073177'/><gd:extendedProperty name='blogger.displayTime' value='9 April 2014 at 01:19'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5436860486372225159</id><published>2014-04-09T10:24:05.747+01:00</published><updated>2014-04-09T10:24:05.747+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>the form is allways valid :(</title><content type='html'>the form is allways valid :(</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/5436860486372225159'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/5436860486372225159'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html?showComment=1397035445747#c5436860486372225159' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/14288544645373045100</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-5753576792954274953' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/5753576792954274953' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1733279985'/><gd:extendedProperty name='blogger.displayTime' value='9 April 2014 at 10:24'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4211948728619948057</id><published>2014-04-09T10:43:16.959+01:00</published><updated>2014-04-09T10:43:16.959+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>you can find my example here :
http://www.developp...</title><content type='html'>you can find my example here :&lt;br /&gt;http://www.developpez.net/forums/d1430019/webmasters-developpement-web/javascript/bibliotheques-frameworks/jquery/validation-input-ajout-addmethod/#post7768698</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/4211948728619948057'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/4211948728619948057'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html?showComment=1397036596959#c4211948728619948057' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/5436860486372225159'/><author><name>Unknown</name><uri>https://www.blogger.com/profile/14288544645373045100</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-5753576792954274953' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/5753576792954274953' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1733279985'/><gd:extendedProperty name='blogger.displayTime' value='9 April 2014 at 10:43'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2199857668279141937</id><published>2014-04-09T11:03:12.228+01:00</published><updated>2014-04-09T11:03:12.228+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>I&amp;#39;m looking for an advanced validation solutio...</title><content type='html'>I&amp;#39;m looking for an advanced validation solution, and although this looks promising, I&amp;#39;m wondering if jquery can the following validations:&lt;br /&gt;&lt;br /&gt;1) Your username cannot be the same as a username already registered on our site (for this you can pretend there is a javascript array present on the page with all the names that you can not choose from).&lt;br /&gt;&lt;br /&gt;2) If a number is filled out in input X, then the number in this input must be greater than number X.&lt;br /&gt;&lt;br /&gt;3) If a checkbox is checked, then use validation rule A for this input, otherwise use validation rule B.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2537929858771005565/comments/default/2199857668279141937'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2537929858771005565/comments/default/2199857668279141937'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/06/jquery-validate-native-unobtrusive-validation.html?showComment=1397037792228#c2199857668279141937' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/11484834188989293244</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/06/jquery-validate-native-unobtrusive-validation.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-2537929858771005565' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/2537929858771005565' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-15831939'/><gd:extendedProperty name='blogger.displayTime' value='9 April 2014 at 11:03'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1017282017989912247</id><published>2014-04-09T14:54:32.689+01:00</published><updated>2014-04-09T14:54:32.689+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>This sounds quite custom to me. You could use jQue...</title><content type='html'>This sounds quite custom to me. You could use jQuery Validation as part of this though.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2537929858771005565/comments/default/1017282017989912247'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2537929858771005565/comments/default/1017282017989912247'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/06/jquery-validate-native-unobtrusive-validation.html?showComment=1397051672689#c1017282017989912247' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2537929858771005565/comments/default/2199857668279141937'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/06/jquery-validate-native-unobtrusive-validation.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-2537929858771005565' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/2537929858771005565' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='9 April 2014 at 14:54'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2268254530265601848</id><published>2014-04-11T16:28:00.043+01:00</published><updated>2014-04-11T16:28:00.043+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi
I&amp;#39;m trying to use your plugin, but it don&amp;#...</title><content type='html'>Hi&lt;br /&gt;I&amp;#39;m trying to use your plugin, but it don&amp;#39;t seem to work for me...&lt;br /&gt;&lt;br /&gt;I have specified &lt;br /&gt;&lt;br /&gt;            $(document).ready(function () {&lt;br /&gt;                Globalize.culture(&amp;#39;sr-Latn&amp;#39;);&lt;br /&gt;            }); &lt;br /&gt;&lt;br /&gt;in my js file, and when i enter (for example) 1.25 or 1,25 return value is true for both...&lt;br /&gt;&lt;br /&gt;1.25 is converted to 125 and recognized as a number, and 1,25 is converted to 1.25 and recognized as a number again. For sr-Latn culture right decimal separator is &amp;quot;,&amp;quot; (comma).&lt;br /&gt;&lt;br /&gt;When i change culture to (for example again) &amp;quot;de&amp;quot;, 1.25 is shown as 1.25 and accepted, and 1,25 is shown as 125 and again, accepted... &lt;br /&gt;&lt;br /&gt;Can You help me with this?</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5143753822429804028/comments/default/2268254530265601848'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5143753822429804028/comments/default/2268254530265601848'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/05/globalizejs-number-and-date.html?showComment=1397230080043#c2268254530265601848' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/12554796318930818974</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/05/globalizejs-number-and-date.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-5143753822429804028' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/5143753822429804028' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1915037692'/><gd:extendedProperty name='blogger.displayTime' value='11 April 2014 at 16:28'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3196015770646881213</id><published>2014-04-14T09:45:59.430+01:00</published><updated>2014-04-14T09:45:59.430+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Thanks for the comment airtonix.  

I&amp;#39;m aware ...</title><content type='html'>Thanks for the comment airtonix.  &lt;br /&gt;&lt;br /&gt;I&amp;#39;m aware of proxy servers which don&amp;#39;t cache resources when querystring params are present.  As I mention in the post this is okay for my use cases.  &lt;br /&gt;&lt;br /&gt;Could you provide any details on the proxy servers / CDN issue you mention please?  Despite a reasonable amount of digging I&amp;#39;ve been unable discover any examples of proxy servers / CDNs that strip off querystring params and then cache the querystring param-less resources.  As you rightly observe - that would be problematic if it happens.&lt;br /&gt;&lt;br /&gt;For my general use cases (intranet apps) this is not a problem for me.  But I&amp;#39;d certainly like to know details if the scenario you describe is valid.  I don&amp;#39;t want to be a source of bad guidance.  </content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/4241616656191588777/comments/default/3196015770646881213'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/4241616656191588777/comments/default/3196015770646881213'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2014/03/caching-and-cache-busting-with-requirejs.html?showComment=1397465159430#c3196015770646881213' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/4241616656191588777/comments/default/2857595028484556613'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2014/03/caching-and-cache-busting-with-requirejs.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-4241616656191588777' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/4241616656191588777' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='14 April 2014 at 09:45'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6711775614311359374</id><published>2014-04-14T10:05:08.352+01:00</published><updated>2014-04-14T10:05:08.352+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi OneDevTeam,

I&amp;#39;d be happy to help but I&amp;#39...</title><content type='html'>Hi OneDevTeam,&lt;br /&gt;&lt;br /&gt;I&amp;#39;d be happy to help but I&amp;#39;m afraid I&amp;#39;m not too clear what you&amp;#39;re asking.  Would you like to share some code that illustrates the issue?  &lt;br /&gt;&lt;br /&gt;Best,&lt;br /&gt;John</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5143753822429804028/comments/default/6711775614311359374'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5143753822429804028/comments/default/6711775614311359374'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/05/globalizejs-number-and-date.html?showComment=1397466308352#c6711775614311359374' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5143753822429804028/comments/default/2268254530265601848'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/05/globalizejs-number-and-date.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-5143753822429804028' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/5143753822429804028' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='14 April 2014 at 10:05'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2999330356844003914</id><published>2014-04-14T14:37:02.470+01:00</published><updated>2014-04-14T14:37:02.470+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Thanks for response. There is no actually code i c...</title><content type='html'>Thanks for response. There is no actually code i could show you, i put everything out of box from your site and pasted in to my application. &lt;br /&gt;&lt;br /&gt;Problem is that validation accepted both &amp;#39;.&amp;#39; and &amp;#39;,&amp;#39; as valid decimal separator. &lt;br /&gt;I managed to solve it by changing &lt;br /&gt;&amp;quot;integer = integer.split( groupSep ).join( &amp;quot;&amp;quot; );&amp;quot; to &amp;quot;integer = integer.split(groupSep).join(nf[&amp;quot;.&amp;quot;]);&amp;quot;&lt;br /&gt;&lt;br /&gt;inside parseFloat function of Globalize.js in section where group separator is handled.&lt;br /&gt;&lt;br /&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5143753822429804028/comments/default/2999330356844003914'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5143753822429804028/comments/default/2999330356844003914'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/05/globalizejs-number-and-date.html?showComment=1397482622470#c2999330356844003914' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5143753822429804028/comments/default/2268254530265601848'/><author><name>Unknown</name><uri>https://www.blogger.com/profile/12554796318930818974</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/05/globalizejs-number-and-date.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-5143753822429804028' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/5143753822429804028' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1915037692'/><gd:extendedProperty name='blogger.displayTime' value='14 April 2014 at 14:37'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2098806649850963699</id><published>2014-04-24T02:45:39.890+01:00</published><updated>2014-04-24T02:45:39.890+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Thanks for the tutorial. It&amp;#39;s very useful. I h...</title><content type='html'>Thanks for the tutorial. It&amp;#39;s very useful. I have a question. I can see you called this declaratively using this line:&lt;br /&gt;string pdfHtmlToPdfExePath = &amp;quot;C:\\Program Files\\wkhtmltopdf\\wkhtmltopdf.exe&amp;quot;)&lt;br /&gt;I just wonder how this is handle in a shared hosting environment since my web application is hosted by a hosting service and there is way they would allow me to install WKHTMLTOPDF on their server.&lt;br /&gt;&lt;br /&gt;Thanks </content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/2098806649850963699'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/2098806649850963699'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html?showComment=1398303939890#c2098806649850963699' title=''/><author><name>ryan</name><uri>https://www.blogger.com/profile/17237938871461497678</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-8680133602632737625' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/8680133602632737625' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-312694318'/><gd:extendedProperty name='blogger.displayTime' value='24 April 2014 at 02:45'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8207999213522459175</id><published>2014-04-24T02:50:03.797+01:00</published><updated>2014-04-24T02:50:03.797+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>I am using asp.net in Visual Studio 2012, by the w...</title><content type='html'>I am using asp.net in Visual Studio 2012, by the way.&lt;br /&gt;&lt;br /&gt;Thanks </content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/8207999213522459175'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/8207999213522459175'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html?showComment=1398304203797#c8207999213522459175' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/2098806649850963699'/><author><name>ryan</name><uri>https://www.blogger.com/profile/17237938871461497678</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-8680133602632737625' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/8680133602632737625' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-312694318'/><gd:extendedProperty name='blogger.displayTime' value='24 April 2014 at 02:50'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-7182978426668636430</id><published>2014-04-28T11:02:35.815+01:00</published><updated>2014-04-28T11:02:35.815+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Great post, helped me get 99% of they way.
Was not...</title><content type='html'>Great post, helped me get 99% of they way.&lt;br /&gt;Was not quite working for me as I was MVC bundling, and the order that you bundle does matter otherwise script error occurs $.validator undefined.&lt;br /&gt;&lt;br /&gt;My fix was to make sure I bundle the jquery.validate.globalize.js AFTER jquery.validate.js&lt;br /&gt;&lt;br /&gt;E.g.&lt;br /&gt;&lt;br /&gt;bundles.Add(new ScriptBundle(&amp;quot;~/bundles/jqueryval&amp;quot;).Include(&lt;br /&gt;                        &amp;quot;~/Scripts/jquery.validate.js&amp;quot;,&lt;br /&gt;                        &amp;quot;~/Scripts/jquery.validate.unobtrusive.js&amp;quot;,&lt;br /&gt;                        &amp;quot;~/Scripts/jquery.unobtrusive*&amp;quot;,&lt;br /&gt;                        &amp;quot;~/Scripts/MvcFoolproofJQueryValidation.*&amp;quot;,&lt;br /&gt;                        &amp;quot;~/Scripts/mvcfoolproof.unobtrusive*&amp;quot;,&lt;br /&gt;                        &amp;quot;~/Scripts/jquery.validate.globalize.js&amp;quot;));&lt;br /&gt;&lt;br /&gt;Thanks.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/7182978426668636430'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/7182978426668636430'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html?showComment=1398679355815#c7182978426668636430' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/08991056309417758598</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-2414704032922872709' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/2414704032922872709' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-891208789'/><gd:extendedProperty name='blogger.displayTime' value='28 April 2014 at 11:02'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3799273336326841325</id><published>2014-05-02T06:48:50.710+01:00</published><updated>2014-05-02T06:48:50.710+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Straight to the point with examples, appreciated, ...</title><content type='html'>Straight to the point with examples, appreciated, thanks. </content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/7273363052780837835/comments/default/3799273336326841325'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/7273363052780837835/comments/default/3799273336326841325'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/10/using-web-optimization-with-mvc-3.html?showComment=1399009730710#c3799273336326841325' title=''/><author><name>Kreloses</name><uri>https://www.blogger.com/profile/17566912859965567543</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/10/using-web-optimization-with-mvc-3.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-7273363052780837835' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/7273363052780837835' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1621281408'/><gd:extendedProperty name='blogger.displayTime' value='2 May 2014 at 06:48'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-340064238724899991</id><published>2014-05-08T19:25:47.002+01:00</published><updated>2014-05-08T19:25:47.002+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Now this is a very interesting technique I will te...</title><content type='html'>Now this is a very interesting technique I will teach in my MVC class.&lt;br /&gt;&lt;br /&gt;Thanks a lot !&lt;br /&gt;&lt;br /&gt;Christiane Lagac&lt;br /&gt;http://christianelagace.com</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/6463585883554513120/comments/default/340064238724899991'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/6463585883554513120/comments/default/340064238724899991'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/03/unit-testing-modelstate.html?showComment=1399573547002#c340064238724899991' title=''/><author><name>Christiane Lagac</name><uri>https://www.blogger.com/profile/07083867846976046185</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='32' height='32' src='//3.bp.blogspot.com/-1fHX3_I5Zpw/U2vMay0-cjI/AAAAAAAAAMQ/w3KEu9EjdY4/s32/*'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/03/unit-testing-modelstate.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-6463585883554513120' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/6463585883554513120' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1584501847'/><gd:extendedProperty name='blogger.displayTime' value='8 May 2014 at 19:25'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-7477702063659377695</id><published>2014-05-13T18:47:20.976+01:00</published><updated>2014-05-13T18:47:20.976+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi,

Is there a way to do the same in pure javascr...</title><content type='html'>Hi,&lt;br /&gt;&lt;br /&gt;Is there a way to do the same in pure javascript without using Jquery or Q libraries.&lt;br /&gt;&lt;br /&gt;Thanks</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/6102727490268694692/comments/default/7477702063659377695'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/6102727490268694692/comments/default/7477702063659377695'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/11/rolling-your-own-confirm-mechanism.html?showComment=1400003240976#c7477702063659377695' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/14349850433062274766</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/11/rolling-your-own-confirm-mechanism.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-6102727490268694692' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/6102727490268694692' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-32975306'/><gd:extendedProperty name='blogger.displayTime' value='13 May 2014 at 18:47'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6731424286920863846</id><published>2014-05-22T06:03:44.833+01:00</published><updated>2014-05-22T06:03:44.833+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>the string text box accepts number also....is ther...</title><content type='html'>the string text box accepts number also....is there any validation for string only?</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/6731424286920863846'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/6731424286920863846'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html?showComment=1400735024833#c6731424286920863846' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/00397136838149350224</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-5753576792954274953' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/5753576792954274953' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1514374152'/><gd:extendedProperty name='blogger.displayTime' value='22 May 2014 at 06:03'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4921031177296236251</id><published>2014-05-23T19:51:58.147+01:00</published><updated>2014-05-23T19:51:58.147+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Nice post! This is the second post of yours that I...</title><content type='html'>Nice post! This is the second post of yours that I use in my codes. Keep doing it!</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/4921031177296236251'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/4921031177296236251'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html?showComment=1400871118147#c4921031177296236251' title=''/><author><name>Marco Alves</name><uri>https://www.blogger.com/profile/11725306367432431999</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='32' height='24' src='//3.bp.blogspot.com/_I-kgGAzQqAg/S1S5zakvySI/AAAAAAAAADI/MnRKrBQmLIc/S220-s32/HPIM2090.JPG'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-5753576792954274953' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/5753576792954274953' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-599213931'/><gd:extendedProperty name='blogger.displayTime' value='23 May 2014 at 19:51'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5765072165500607962</id><published>2014-05-27T04:31:57.822+01:00</published><updated>2014-05-27T04:31:57.822+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hah thats what i just posted on the gitHub page.</title><content type='html'>Hah thats what i just posted on the gitHub page.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/5765072165500607962'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/5765072165500607962'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html?showComment=1401161517822#c5765072165500607962' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/4925925105184027123'/><author><name>Unknown</name><uri>https://www.blogger.com/profile/15219645162615352882</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-2414704032922872709' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/2414704032922872709' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1395661645'/><gd:extendedProperty name='blogger.displayTime' value='27 May 2014 at 04:31'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-938462585375380514</id><published>2014-05-27T04:39:39.398+01:00</published><updated>2014-05-27T04:39:39.398+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Kristina - As it is written the lang attribute wil...</title><content type='html'>Kristina - As it is written the lang attribute will always be ignored because jquery.validate.globalize.js just overrides the jquery.validate.js methods like this:&lt;br /&gt;&lt;br /&gt;    $.validator.methods.date = function (value, element) {&lt;br /&gt;        var val = Globalize.parseDate(value);&lt;br /&gt;        return this.optional(element) || (val instanceof Date);&lt;br /&gt;    };&lt;br /&gt;&lt;br /&gt;whereas Globalize.parseDate is actually defined like this:&lt;br /&gt;&lt;br /&gt;Globalize.parseDate = function (value, formats, culture) {}&lt;br /&gt;&lt;br /&gt;Since jquery.validate.js is not passing in a culture parameter Globalize will just use the default culture (which will be the UICulture of your browser) even if you have supplied a culture override via the GlobalizeUrls.GlobalizeClientCulture in the article above. If like me you wanted a site selected culture whereby user can view your site in a language other than browser locale then as far as this plugin is concerned you will have to override the override in this plugin like so:&lt;br /&gt;&lt;br /&gt;    $.validator.methods.min = function (value, element, param) {&lt;br /&gt;        var val = Globalize.parseFloat(value, null, Globalize.cultureSelector);&lt;br /&gt;        return originalMethods.min.call(this, val, element, param);&lt;br /&gt;    };&lt;br /&gt;&lt;br /&gt;where Globalize.cultureSelector could be set in document.OnReady. &lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/938462585375380514'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/938462585375380514'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html?showComment=1401161979398#c938462585375380514' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/5096417388745687598'/><author><name>Unknown</name><uri>https://www.blogger.com/profile/15219645162615352882</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-2414704032922872709' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/2414704032922872709' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1395661645'/><gd:extendedProperty name='blogger.displayTime' value='27 May 2014 at 04:39'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-7881611630485685040</id><published>2014-05-27T14:24:52.786+01:00</published><updated>2014-05-27T14:24:52.786+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>TNX!</title><content type='html'>TNX!</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1965872403036778857/comments/default/7881611630485685040'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1965872403036778857/comments/default/7881611630485685040'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/04/making-ie-10s-clear-field-x-button-and.html?showComment=1401197092786#c7881611630485685040' title=''/><author><name>letsjump</name><uri>https://www.blogger.com/profile/08924809822857761889</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/04/making-ie-10s-clear-field-x-button-and.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1965872403036778857' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1965872403036778857' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-466563569'/><gd:extendedProperty name='blogger.displayTime' value='27 May 2014 at 14:24'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3734307196230545663</id><published>2014-06-02T15:54:44.532+01:00</published><updated>2014-06-02T15:54:44.532+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Go on John... like it, interesting...</title><content type='html'>Go on John... like it, interesting...</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1635211266608740454/comments/default/3734307196230545663'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1635211266608740454/comments/default/3734307196230545663'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2014/06/migrating-from-angularjs-to-angularts.html?showComment=1401720884532#c3734307196230545663' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/16467121654396825114</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2014/06/migrating-from-angularjs-to-angularts.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1635211266608740454' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1635211266608740454' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-720920256'/><gd:extendedProperty name='blogger.displayTime' value='2 June 2014 at 15:54'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-9110259876217014903</id><published>2014-06-04T21:07:25.688+01:00</published><updated>2014-06-04T21:07:25.688+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>I tried this and it worked in IE 10 but I this is ...</title><content type='html'>I tried this and it worked in IE 10 but I this is not working properly in chrome. Could anyone confirm that it is working fine in chrome?</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/9066088698325396956/comments/default/9110259876217014903'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/9066088698325396956/comments/default/9110259876217014903'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/01/twitterbootstrapmvc4-meet-bootstrap.html?showComment=1401912445688#c9110259876217014903' title=''/><author><name>nitinverma</name><uri>https://www.blogger.com/profile/04756277514068536940</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='24' height='32' src='//1.bp.blogspot.com/-MfvFTYVVnGQ/Tzuar_TQrUI/AAAAAAAAAEI/s0h5XlkJ-AI/s32/NV.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/01/twitterbootstrapmvc4-meet-bootstrap.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-9066088698325396956' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/9066088698325396956' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1098622520'/><gd:extendedProperty name='blogger.displayTime' value='4 June 2014 at 21:07'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2850084591038903603</id><published>2014-06-05T06:40:03.695+01:00</published><updated>2014-06-05T06:40:03.695+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>When I copy HTML to local and run in browser, it d...</title><content type='html'>When I copy HTML to local and run in browser, it does noting And the UI is awkward. Does this require any additional thing to get work?</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/2850084591038903603'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/2850084591038903603'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html?showComment=1401946803695#c2850084591038903603' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/16206746886810262141</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-5753576792954274953' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/5753576792954274953' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-15539637'/><gd:extendedProperty name='blogger.displayTime' value='5 June 2014 at 06:40'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8409676271506949010</id><published>2014-06-07T17:28:20.984+01:00</published><updated>2014-06-07T17:28:20.984+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Great article, really got me thinking about our im...</title><content type='html'>Great article, really got me thinking about our implementation.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3336760366966567957/comments/default/8409676271506949010'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3336760366966567957/comments/default/8409676271506949010'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/10/unit-testing-and-entity-framework-filth.html?showComment=1402158500984#c8409676271506949010' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/10103705836833933301</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/10/unit-testing-and-entity-framework-filth.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-3336760366966567957' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/3336760366966567957' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1178038501'/><gd:extendedProperty name='blogger.displayTime' value='7 June 2014 at 17:28'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-391631473013921296</id><published>2014-06-07T17:38:56.886+01:00</published><updated>2014-06-07T17:38:56.886+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Thanks Martyn!</title><content type='html'>Thanks Martyn!</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3336760366966567957/comments/default/391631473013921296'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3336760366966567957/comments/default/391631473013921296'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/10/unit-testing-and-entity-framework-filth.html?showComment=1402159136886#c391631473013921296' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/3336760366966567957/comments/default/8409676271506949010'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/10/unit-testing-and-entity-framework-filth.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-3336760366966567957' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/3336760366966567957' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='7 June 2014 at 17:38'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8967677646592413714</id><published>2014-06-09T02:09:41.242+01:00</published><updated>2014-06-09T02:09:41.242+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Thank you John. It helped :)</title><content type='html'>Thank you John. It helped :)</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/7839976006063557799/comments/default/8967677646592413714'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/7839976006063557799/comments/default/8967677646592413714'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/11/xsdxml-schema-generator-xsdexe-taking.html?showComment=1402276181242#c8967677646592413714' title=''/><author><name>veeru</name><uri>https://www.blogger.com/profile/10563358723454651042</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/11/xsdxml-schema-generator-xsdexe-taking.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-7839976006063557799' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/7839976006063557799' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1300767656'/><gd:extendedProperty name='blogger.displayTime' value='9 June 2014 at 02:09'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2130465420063940748</id><published>2014-06-12T10:12:17.440+01:00</published><updated>2014-06-12T10:12:17.440+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi Kevin,
this code works perfectly when the user ...</title><content type='html'>Hi Kevin,&lt;br /&gt;this code works perfectly when the user is logged in to the terminal. &lt;br /&gt;How can we add authentication to the code, in case user is not logged in? I want the app runs like a startup application in windows...&lt;br /&gt;I could not find a sample yet.&lt;br /&gt;Thanks and regards.&lt;br /&gt;A&lt;br /&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/2130465420063940748'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/2130465420063940748'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html?showComment=1402564337440#c2130465420063940748' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/2806695557723788484'/><author><name>zgr zkan AKDEMRC</name><uri>https://www.blogger.com/profile/16360457028071002083</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='32' height='24' src='//1.bp.blogspot.com/-DGuuMNun-hQ/UVG5lKVxi5I/AAAAAAAAAN4/yQpBKDroFCA/s32/IMG_2795.JPG'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1492382956545126674' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1492382956545126674' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1469776666'/><gd:extendedProperty name='blogger.displayTime' value='12 June 2014 at 10:12'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3980041525634527039</id><published>2014-06-12T10:13:53.988+01:00</published><updated>2014-06-12T10:13:53.988+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Btw, The pc still has BB Terminal...
</title><content type='html'>Btw, The pc still has BB Terminal...&lt;br /&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/3980041525634527039'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/3980041525634527039'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html?showComment=1402564433988#c3980041525634527039' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1492382956545126674/comments/default/2806695557723788484'/><author><name>zgr zkan AKDEMRC</name><uri>https://www.blogger.com/profile/16360457028071002083</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='32' height='24' src='//1.bp.blogspot.com/-DGuuMNun-hQ/UVG5lKVxi5I/AAAAAAAAAN4/yQpBKDroFCA/s32/IMG_2795.JPG'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/11/a-nicer-net-api-for-bloombergs-open-api.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1492382956545126674' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1492382956545126674' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1469776666'/><gd:extendedProperty name='blogger.displayTime' value='12 June 2014 at 10:13'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-934353930729311404</id><published>2014-06-24T14:05:47.966+01:00</published><updated>2014-06-24T14:05:47.966+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Nice article, I&amp;#39;m thinking to move from Javasc...</title><content type='html'>Nice article, I&amp;#39;m thinking to move from Javascript to TypeScript at my work and this will be useful to convince my superiors :-)&lt;br /&gt;&lt;br /&gt;Just a question: now that TypeScript has better support for JsDoc strings, does it generates them correctly (filling classes and namespaces and generating type definitions) on the Javascript transpiled code so regular JsDoc documentation can be generated from them?</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5294321863550376612/comments/default/934353930729311404'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5294321863550376612/comments/default/934353930729311404'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2014/05/typescript-jsdoc-and-intellisense.html?showComment=1403615147966#c934353930729311404' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/08179680964017621349</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2014/05/typescript-jsdoc-and-intellisense.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-5294321863550376612' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/5294321863550376612' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1902482956'/><gd:extendedProperty name='blogger.displayTime' value='24 June 2014 at 14:05'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5401536863607065161</id><published>2014-06-24T14:39:57.978+01:00</published><updated>2014-06-24T14:39:57.978+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Thanks Jess!

In answer to your question the answ...</title><content type='html'>Thanks Jess!&lt;br /&gt;&lt;br /&gt;In answer to your question the answer is &amp;quot;no, for now&amp;quot;.  Though I believe if you look on the TypeScript CodePlex site you can see this has been logged as feature request which (I believe) is under consideration.  </content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5294321863550376612/comments/default/5401536863607065161'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5294321863550376612/comments/default/5401536863607065161'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2014/05/typescript-jsdoc-and-intellisense.html?showComment=1403617197978#c5401536863607065161' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5294321863550376612/comments/default/934353930729311404'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2014/05/typescript-jsdoc-and-intellisense.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-5294321863550376612' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/5294321863550376612' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='24 June 2014 at 14:39'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6701841239476683514</id><published>2014-06-24T14:44:05.410+01:00</published><updated>2014-06-24T14:44:05.410+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Cool! I&amp;#39;ll take a look then :-) Thanks! :-D</title><content type='html'>Cool! I&amp;#39;ll take a look then :-) Thanks! :-D</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5294321863550376612/comments/default/6701841239476683514'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5294321863550376612/comments/default/6701841239476683514'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2014/05/typescript-jsdoc-and-intellisense.html?showComment=1403617445410#c6701841239476683514' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5294321863550376612/comments/default/934353930729311404'/><author><name>Unknown</name><uri>https://www.blogger.com/profile/08179680964017621349</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2014/05/typescript-jsdoc-and-intellisense.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-5294321863550376612' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/5294321863550376612' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1902482956'/><gd:extendedProperty name='blogger.displayTime' value='24 June 2014 at 14:44'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-460283606365650391</id><published>2014-06-30T10:20:51.910+01:00</published><updated>2014-06-30T10:20:51.910+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi,
I used XSD.exe to generate class file from XSD...</title><content type='html'>Hi,&lt;br /&gt;I used XSD.exe to generate class file from XSD file, in generated class file has int, decimal and enum data type for certain properties of class, when I&amp;#39;m trying to serialize object to XML from your class XmlConverter the fields related to this data type (int, decimal and enum) doesn&amp;#39;t appear in generated XML.&lt;br /&gt;&lt;br /&gt;Can anybody help me on this problem.&lt;br /&gt;&lt;br /&gt;Thank You.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/7839976006063557799/comments/default/460283606365650391'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/7839976006063557799/comments/default/460283606365650391'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/11/xsdxml-schema-generator-xsdexe-taking.html?showComment=1404120051910#c460283606365650391' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/09995845759080007491</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/11/xsdxml-schema-generator-xsdexe-taking.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-7839976006063557799' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/7839976006063557799' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-224629326'/><gd:extendedProperty name='blogger.displayTime' value='30 June 2014 at 10:20'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-431128072819214434</id><published>2014-07-09T06:58:19.588+01:00</published><updated>2014-07-09T06:58:19.588+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>how did u get autocomplete working in IE? i have d...</title><content type='html'>how did u get autocomplete working in IE? i have data coming from db and it works fine in firefox and chrome but not in IE  9 or IE 10. it does not list down the data from database. I am using dropdown list.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1965872403036778857/comments/default/431128072819214434'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1965872403036778857/comments/default/431128072819214434'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/04/making-ie-10s-clear-field-x-button-and.html?showComment=1404885499588#c431128072819214434' title=''/><author><name>TechWrath TV</name><uri>https://www.blogger.com/profile/11412257683109723348</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/04/making-ie-10s-clear-field-x-button-and.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1965872403036778857' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1965872403036778857' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-650522880'/><gd:extendedProperty name='blogger.displayTime' value='9 July 2014 at 06:58'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5752907035576043852</id><published>2014-07-16T12:44:08.922+01:00</published><updated>2014-07-16T12:44:08.922+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi John,,

I am trying to implement jQuery validat...</title><content type='html'>Hi John,,&lt;br /&gt;&lt;br /&gt;I am trying to implement jQuery validation in my MVC application. Its working perfectly fine.&lt;br /&gt;&lt;br /&gt;Number validation by default is working as follows:&lt;br /&gt;&lt;br /&gt;1500 is valid number&lt;br /&gt;1,500 is valid number&lt;br /&gt;1,5 is invalid number&lt;br /&gt;-1 is valid number&lt;br /&gt;(1) is invalid number&lt;br /&gt;A is invalid number&lt;br /&gt;1, is invalid number&lt;br /&gt;&lt;br /&gt;Note: Default culture is en-US&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;I implemented Globalization by including javascript files in this sequence&lt;br /&gt;globalize.jsscript&amp;gt;&lt;br /&gt;globalize.culture.@(System.Threading.Thread.CurrentThread.CurrentCulture).js&lt;br /&gt;jquery.validate.js&lt;br /&gt;jquery.validate.globalize.js&lt;br /&gt;jquery.validate.unobtrusive.js&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;but now the issue is, for en-US culture it behaving as follows&lt;br /&gt;&lt;br /&gt;1500 is valid number&lt;br /&gt;1,500 is valid number&lt;br /&gt;1,5 is valid number&lt;br /&gt;-1 is valid number&lt;br /&gt;(1) is valid number&lt;br /&gt;A is invalid number&lt;br /&gt;1,5 is valid&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;Please if u can put some light into it.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/5752907035576043852'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/5752907035576043852'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html?showComment=1405511048922#c5752907035576043852' title=''/><author><name>Sukesh Marla</name><uri>https://www.blogger.com/profile/16619059549331221666</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='32' height='30' src='//1.bp.blogspot.com/-kNj7A80TqMw/XnvK_oqRoCI/AAAAAAAAIxQ/c20RZtk44YwqevgOpSeGjJ1zFPFoyCINACK4BGAYYCw/s32/Logo%2B3.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-2414704032922872709' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/2414704032922872709' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1361425199'/><gd:extendedProperty name='blogger.displayTime' value='16 July 2014 at 12:44'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8920315214856473304</id><published>2014-07-16T15:37:09.458+01:00</published><updated>2014-07-16T15:37:09.458+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>I have a problem with different culture.

When I c...</title><content type='html'>I have a problem with different culture.&lt;br /&gt;&lt;br /&gt;When I change CurrentCulture to fa-IR that decimal separator for this culture is (/).When I put for example 55/02 for decimal field got a validation Error The field must be a number</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/8920315214856473304'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/8920315214856473304'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html?showComment=1405521429458#c8920315214856473304' title=''/><author><name> </name><uri>https://www.blogger.com/profile/07576153682486344974</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='32' height='24' src='//4.bp.blogspot.com/_Zr8Wu64ToIU/SnYN7i8FfMI/AAAAAAAAAAs/Xt3y88flYVM/S220-s32/DSC000251.jpg'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-2414704032922872709' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/2414704032922872709' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1839806186'/><gd:extendedProperty name='blogger.displayTime' value='16 July 2014 at 15:37'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2751636276614557379</id><published>2014-07-24T16:13:03.384+01:00</published><updated>2014-07-24T16:13:03.384+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi,

I needed to do this as well but all I did was...</title><content type='html'>Hi,&lt;br /&gt;&lt;br /&gt;I needed to do this as well but all I did was make my own copy of jquery.validate.unobtrusive.js and change where it sets up the remote adaptor to set async:false , see:&lt;br /&gt;&lt;br /&gt;    adapters.add(&amp;quot;remote&amp;quot;, [&amp;quot;url&amp;quot;, &amp;quot;type&amp;quot;, &amp;quot;additionalfields&amp;quot;], function (options) {&lt;br /&gt;        var value = {&lt;br /&gt;            url: options.params.url,&lt;br /&gt;            type: options.params.type || &amp;quot;GET&amp;quot;,&lt;br /&gt;            data: {},&lt;br /&gt;   async: false&lt;br /&gt;        },&lt;br /&gt;&lt;br /&gt;This example is for MVC4.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1825634548402124376/comments/default/2751636276614557379'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1825634548402124376/comments/default/2751636276614557379'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/03/jquery-unobtrusive-remote-validation.html?showComment=1406214783384#c2751636276614557379' title=''/><author><name>Andy</name><uri>https://www.blogger.com/profile/12808184506458283238</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/03/jquery-unobtrusive-remote-validation.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1825634548402124376' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1825634548402124376' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1524597574'/><gd:extendedProperty name='blogger.displayTime' value='24 July 2014 at 16:13'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5519188978045496201</id><published>2014-07-30T08:40:38.026+01:00</published><updated>2014-07-30T08:40:38.026+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Thanks for sharing this. I really appreciated it a...</title><content type='html'>Thanks for sharing this. I really appreciated it and I&amp;#39;ve learned a lot.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/5519188978045496201'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/5519188978045496201'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html?showComment=1406706038026#c5519188978045496201' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/06049614653039111528</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-2414704032922872709' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/2414704032922872709' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-774027627'/><gd:extendedProperty name='blogger.displayTime' value='30 July 2014 at 08:40'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2239933655835200566</id><published>2014-07-30T10:48:39.158+01:00</published><updated>2014-07-30T10:48:39.158+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Happy to help Sophia.  Just so you&amp;#39;re aware - ...</title><content type='html'>Happy to help Sophia.  Just so you&amp;#39;re aware - Globalize is currently in the process of being re-written (the alpha is now available on GitHub).  This code applies to the prior version of Globalize (0.1 I think) which, despite the version number, is actually pretty solid and has handled all of my own use cases.&lt;br /&gt;&lt;br /&gt;All the best,&lt;br /&gt;John</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/2239933655835200566'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/2239933655835200566'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html?showComment=1406713719158#c2239933655835200566' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/5519188978045496201'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-2414704032922872709' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/2414704032922872709' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='30 July 2014 at 10:48'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5829480374240193854</id><published>2014-08-06T08:01:59.197+01:00</published><updated>2014-08-06T08:01:59.197+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>How to add has error to editorfor in mvc 5 through...</title><content type='html'>How to add has error to editorfor in mvc 5 through data annotation..?</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/5829480374240193854'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/5829480374240193854'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html?showComment=1407308519197#c5829480374240193854' title=''/><author><name>KARTHIKEYAN</name><uri>https://www.blogger.com/profile/08656548071932041806</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='32' height='24' src='//4.bp.blogspot.com/_wvY8Vm7DqV4/TUo65ZLyTsI/AAAAAAAAAmY/T4fAeWAVTKo/s32/IMG_1030.JPG'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-5753576792954274953' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/5753576792954274953' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1029559192'/><gd:extendedProperty name='blogger.displayTime' value='6 August 2014 at 08:01'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1408503300931660674</id><published>2014-08-12T09:52:32.257+01:00</published><updated>2014-08-12T09:52:32.257+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>how to validate for password in formate like this ...</title><content type='html'>how to validate for password in formate like this = Abcd123!@# and text filed only for string</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/1408503300931660674'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/1408503300931660674'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html?showComment=1407833552257#c1408503300931660674' title=''/><author><name>milind</name><uri>https://www.blogger.com/profile/15312825931064401843</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-5753576792954274953' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/5753576792954274953' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1163781188'/><gd:extendedProperty name='blogger.displayTime' value='12 August 2014 at 09:52'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3422855529179949834</id><published>2014-08-19T11:50:24.607+01:00</published><updated>2014-08-19T11:50:24.607+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>You can try Expert PDF. Its best software I&amp;#39;ve...</title><content type='html'>You can try Expert PDF. Its best software I&amp;#39;ve ever used. Check details here&lt;br /&gt;http://www.html-to-pdf.net/Support.aspx&lt;br /&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/3422855529179949834'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/3422855529179949834'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html?showComment=1408445424607#c3422855529179949834' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/5172366758729683092'/><author><name>Shalani</name><uri>https://www.blogger.com/profile/02725079808517980582</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-8680133602632737625' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/8680133602632737625' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-273739387'/><gd:extendedProperty name='blogger.displayTime' value='19 August 2014 at 11:50'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2629763075706927867</id><published>2014-08-22T21:24:48.908+01:00</published><updated>2014-08-22T21:24:48.908+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>In test method

 var controller = new Authenticati...</title><content type='html'>In test method&lt;br /&gt;&lt;br /&gt; var controller = new AuthenticationController(new Mock().Object, phoneAuthMoq.Object);&lt;br /&gt; RouteTable.Routes.Clear();&lt;br /&gt; RouteConfig.RegisterRoutes(RouteTable.Routes);&lt;br /&gt; var httpContext = MvcMockHelpers.MockHttpContext(&amp;quot;~/Authentication/Index&amp;quot;);&lt;br /&gt; var routeData = RouteTable.Routes.GetRouteData(httpContext);&lt;br /&gt; controller.SetMockControllerContext(httpContext, routeData, RouteTable.Routes);&lt;br /&gt; controller.PhoneAuth(); // Act&lt;br /&gt;&lt;br /&gt;In action `PhoneAuth`&lt;br /&gt;&lt;br /&gt;&lt;br /&gt; var url = Url.Action(&amp;quot;PhoneAuthResult&amp;quot;, &amp;quot;Authentication&amp;quot;&lt;br /&gt;  , routeValues: new RouteValueDictionary { { &amp;quot;controller&amp;quot;, &amp;quot;Authentication&amp;quot; }, { &amp;quot;action&amp;quot;, &amp;quot;PhoneAuthResult&amp;quot; } }&lt;br /&gt;  , protocol: Request.Url.Scheme // ERROR HERE: Request.Url is NULL!&lt;br /&gt; );&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;Any sugestion?</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1867217689836748667/comments/default/2629763075706927867'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1867217689836748667/comments/default/2629763075706927867'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/02/unit-testing-mvc-controllers-mocking.html?showComment=1408739088908#c2629763075706927867' title=''/><author><name>Riderman</name><uri>https://www.blogger.com/profile/11629013344453914133</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='24' height='32' src='//4.bp.blogspot.com/_bn8zhorNU98/TDvroT8lPUI/AAAAAAAADv0/FvIi-Clrxkk/S220-s32/34648_1433106520456_1616703923_1066210_600600_n.jpg'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/02/unit-testing-mvc-controllers-mocking.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1867217689836748667' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1867217689836748667' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-172532690'/><gd:extendedProperty name='blogger.displayTime' value='22 August 2014 at 21:24'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-981824601844992359</id><published>2014-08-22T21:40:09.342+01:00</published><updated>2014-08-22T21:40:09.342+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>I&amp;#39;m afraid not, no.</title><content type='html'>I&amp;#39;m afraid not, no.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1867217689836748667/comments/default/981824601844992359'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1867217689836748667/comments/default/981824601844992359'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/02/unit-testing-mvc-controllers-mocking.html?showComment=1408740009342#c981824601844992359' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1867217689836748667/comments/default/2629763075706927867'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/02/unit-testing-mvc-controllers-mocking.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1867217689836748667' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1867217689836748667' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='22 August 2014 at 21:40'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6111812148709701144</id><published>2014-08-25T06:39:30.085+01:00</published><updated>2014-08-25T06:39:30.085+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>how the way of remote validation in this manner . </title><content type='html'>how the way of remote validation in this manner . </content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/6111812148709701144'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/6111812148709701144'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html?showComment=1408945170085#c6111812148709701144' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/02164229862824086092</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-5753576792954274953' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/5753576792954274953' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-2060124848'/><gd:extendedProperty name='blogger.displayTime' value='25 August 2014 at 06:39'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-8636198098423189472</id><published>2014-08-26T03:25:59.418+01:00</published><updated>2014-08-26T03:25:59.418+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>great work.i&amp;#39;m also try to do work like this f...</title><content type='html'>great work.i&amp;#39;m also try to do work like this for long time.so i try to your code.but it doesn&amp;#39;t work in my pc.can you tell me the reason for it?&lt;br /&gt;&lt;br /&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/8636198098423189472'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/5753576792954274953/comments/default/8636198098423189472'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html?showComment=1409019959418#c8636198098423189472' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/08108864134235472039</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/08/using-bootstrap-tooltips-to-display.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-5753576792954274953' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/5753576792954274953' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1877840595'/><gd:extendedProperty name='blogger.displayTime' value='26 August 2014 at 03:25'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-14778611966023635</id><published>2014-08-29T04:25:33.556+01:00</published><updated>2014-08-29T04:25:33.556+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Very impressive! 

@Vikas Aggarwal ,Apart from thi...</title><content type='html'>Very impressive! &lt;br /&gt;&lt;br /&gt;@Vikas Aggarwal ,Apart from this ,we can utilize .NET PDF component to convert the HTML page with rich elements, such as HTTPS, CSS3, HTML5, JavaScript, to PDF file ..This knowledge base gives the details - &lt;a href="http://www.e-iceblue.com/Tutorials/Spire.PDF/Spire.PDF-Program-Guide/Convert-HTML-to-PDF-with-New-Plugin.html" rel="nofollow"&gt;convert HTML to PDF in C#&lt;/a&gt; ..Hope it helps</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/14778611966023635'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/14778611966023635'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html?showComment=1409282733556#c14778611966023635' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/03720479288866170988</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-8680133602632737625' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/8680133602632737625' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-2025218283'/><gd:extendedProperty name='blogger.displayTime' value='29 August 2014 at 04:25'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2973000392038110140</id><published>2014-10-12T23:51:48.281+01:00</published><updated>2014-10-12T23:51:48.281+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Nice article John. It was very helpful for me.

Ju...</title><content type='html'>Nice article John. It was very helpful for me.&lt;br /&gt;&lt;br /&gt;Just like to emphasize the importance of add the code below if you download jquery-globalize package from Nuget. I spend few hours to realize that. lol &lt;br /&gt;&lt;br /&gt;$(document).ready(function () {&lt;br /&gt; &lt;br /&gt;    // Set Globalize to the current culture driven by the html lang property&lt;br /&gt;    var currentCulture = $(&amp;quot;html&amp;quot;).prop(&amp;quot;lang&amp;quot;);&lt;br /&gt;    if (currentCulture) {&lt;br /&gt;        Globalize.culture(currentCulture);&lt;br /&gt;    }&lt;br /&gt;});</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/2973000392038110140'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/2973000392038110140'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html?showComment=1413154308281#c2973000392038110140' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/06825073442497871901</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-2414704032922872709' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/2414704032922872709' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1376424363'/><gd:extendedProperty name='blogger.displayTime' value='12 October 2014 at 23:51'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1521091608513097894</id><published>2014-10-22T00:42:19.761+01:00</published><updated>2014-10-22T00:42:19.761+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>This psuedo-selector ::-ms-clear doesn&amp;#39;t work ...</title><content type='html'>This psuedo-selector ::-ms-clear doesn&amp;#39;t work for me in IE 11 (not in compatibility mode, just plain edge/default). Does anyone know if IE 11 respects the ::-ms-clear selector? Doesn&amp;#39;t seem to. I&amp;#39;ve tried display:none; width:0; height:0; - inspecting the field in DOM Explorer it looks like IE 11 isn&amp;#39;t applying the style at all.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1965872403036778857/comments/default/1521091608513097894'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1965872403036778857/comments/default/1521091608513097894'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/04/making-ie-10s-clear-field-x-button-and.html?showComment=1413934939761#c1521091608513097894' title=''/><author><name>Jay</name><uri>https://www.blogger.com/profile/11789403549040586469</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/04/making-ie-10s-clear-field-x-button-and.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1965872403036778857' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1965872403036778857' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-238522709'/><gd:extendedProperty name='blogger.displayTime' value='22 October 2014 at 00:42'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-408950341504223202</id><published>2014-10-22T00:45:24.562+01:00</published><updated>2014-10-22T00:45:24.562+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Actually, I guess there&amp;#39;s no way to inspect th...</title><content type='html'>Actually, I guess there&amp;#39;s no way to inspect the CSS style for the &amp;quot;remove cross&amp;quot; in the DOM Explorer, as it doesn&amp;#39;t appear in the DOM. I was inspecting the input field expecting the ::-ms-clear styles to be applied. Doh! &lt;br /&gt;&lt;br /&gt;Still, I wonder whether the ::-ms-clear psuedo style works in IE 11?</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1965872403036778857/comments/default/408950341504223202'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1965872403036778857/comments/default/408950341504223202'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2013/04/making-ie-10s-clear-field-x-button-and.html?showComment=1413935124562#c408950341504223202' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1965872403036778857/comments/default/1521091608513097894'/><author><name>Jay</name><uri>https://www.blogger.com/profile/11789403549040586469</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2013/04/making-ie-10s-clear-field-x-button-and.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1965872403036778857' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1965872403036778857' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-238522709'/><gd:extendedProperty name='blogger.displayTime' value='22 October 2014 at 00:45'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5072121836043060687</id><published>2014-10-23T11:13:54.407+01:00</published><updated>2014-10-23T11:13:54.407+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hello,

Thank you for showing how this can be done...</title><content type='html'>Hello,&lt;br /&gt;&lt;br /&gt;Thank you for showing how this can be done!&lt;br /&gt;&lt;br /&gt;I am trying to follow a similar process for the ReSharper Command Line tool called dupfinder.&lt;br /&gt;&lt;br /&gt;You can see what I am trying here:&lt;br /&gt;&lt;br /&gt;https://github.com/gep13/ChocolateyGUI/blob/feature/Issue-172/BuildScripts/default.ps1#L125&lt;br /&gt;&lt;br /&gt;While this does indeed result in a failed build, with a number of failed tests:&lt;br /&gt;&lt;br /&gt;https://ci.appveyor.com/project/GaryEwanPark/chocolateygui/build/0.12.0-PullRequest.179+15%20(Build%20133)#L768&lt;br /&gt;&lt;br /&gt;The error message at the end doesn&amp;#39;t seem to match up.  The mention of LigerShark is strange (this is part of the PS-Build Module that I am using to invoke msbuild) but I don&amp;#39;t see why this would be showing up when I fail the build due to a failed duplicate.&lt;br /&gt;&lt;br /&gt;Do you have any ideas about what could be going on here?&lt;br /&gt;&lt;br /&gt;Thanks&lt;br /&gt;&lt;br /&gt;Gary</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1119249749116092462/comments/default/5072121836043060687'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1119249749116092462/comments/default/5072121836043060687'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2014/09/running-javascript-unit-tests-in-appveyor.html?showComment=1414059234407#c5072121836043060687' title=''/><author><name>Gary P</name><uri>https://www.blogger.com/profile/06214796034236409030</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2014/09/running-javascript-unit-tests-in-appveyor.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1119249749116092462' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1119249749116092462' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1777983387'/><gd:extendedProperty name='blogger.displayTime' value='23 October 2014 at 11:13'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2841416691243246417</id><published>2014-10-23T13:12:18.706+01:00</published><updated>2014-10-23T13:12:18.706+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Glad it was helpful!  I&amp;#39;m not too sure why you...</title><content type='html'>Glad it was helpful!  I&amp;#39;m not too sure why you&amp;#39;re build is failing as it is - it seems to be looking for LigerShark and not finding it.  On a related tack I know I had to enable NuGet restore to ensure my packages were installed correctly.  I assume LigerShark is installed?  &lt;br /&gt;&lt;br /&gt;Best of luck!</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1119249749116092462/comments/default/2841416691243246417'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1119249749116092462/comments/default/2841416691243246417'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2014/09/running-javascript-unit-tests-in-appveyor.html?showComment=1414066338706#c2841416691243246417' title=''/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2014/09/running-javascript-unit-tests-in-appveyor.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1119249749116092462' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1119249749116092462' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='23 October 2014 at 13:12'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2748462119255497803</id><published>2014-10-23T21:19:29.679+01:00</published><updated>2014-10-23T21:19:29.679+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Thanks for getting back to me.

Yes, LigerShark is...</title><content type='html'>Thanks for getting back to me.&lt;br /&gt;&lt;br /&gt;Yes, LigerShark is definitely installed.  This error has only started appearing since I introduced this:&lt;br /&gt;&lt;br /&gt;$host.SetShouldExit(1)&lt;br /&gt;&lt;br /&gt;You can see the history that the build was happily passing:&lt;br /&gt;&lt;br /&gt;https://ci.appveyor.com/project/GaryEwanPark/chocolateygui/history&lt;br /&gt;&lt;br /&gt;Gary</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1119249749116092462/comments/default/2748462119255497803'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1119249749116092462/comments/default/2748462119255497803'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2014/09/running-javascript-unit-tests-in-appveyor.html?showComment=1414095569679#c2748462119255497803' title=''/><author><name>Gary P</name><uri>https://www.blogger.com/profile/06214796034236409030</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2014/09/running-javascript-unit-tests-in-appveyor.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1119249749116092462' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1119249749116092462' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1777983387'/><gd:extendedProperty name='blogger.displayTime' value='23 October 2014 at 21:19'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6640928012388586334</id><published>2014-10-24T07:53:14.540+01:00</published><updated>2014-10-24T07:53:14.540+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>For now, I think I am going to switch to using thi...</title><content type='html'>For now, I think I am going to switch to using this:&lt;br /&gt;&lt;br /&gt;https://github.com/gep13/ChocolateyGUI/commit/d88ef37837bdf7f8c627c4cfebe700c629a30df0&lt;br /&gt;&lt;br /&gt;i.e. throw &amp;quot;Duplicates found in code base&amp;quot;&lt;br /&gt;&lt;br /&gt;rather than: $host.SetShouldExit(1);&lt;br /&gt;&lt;br /&gt;Perhaps not as &amp;quot;clean&amp;quot; but at least I will get a sensible final message in my build output, saying what the problem is.&lt;br /&gt;&lt;br /&gt;Gary</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1119249749116092462/comments/default/6640928012388586334'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1119249749116092462/comments/default/6640928012388586334'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2014/09/running-javascript-unit-tests-in-appveyor.html?showComment=1414133594540#c6640928012388586334' title=''/><author><name>Gary P</name><uri>https://www.blogger.com/profile/06214796034236409030</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2014/09/running-javascript-unit-tests-in-appveyor.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1119249749116092462' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1119249749116092462' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1777983387'/><gd:extendedProperty name='blogger.displayTime' value='24 October 2014 at 07:53'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1109924444008690561</id><published>2014-10-24T08:21:37.726+01:00</published><updated>2014-10-24T08:21:37.726+01:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Glad you&amp;#39;ve got something that works. Really s...</title><content type='html'>Glad you&amp;#39;ve got something that works. Really strange that SetShouldExit is causing such problems..</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1119249749116092462/comments/default/1109924444008690561'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1119249749116092462/comments/default/1109924444008690561'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2014/09/running-javascript-unit-tests-in-appveyor.html?showComment=1414135297726#c1109924444008690561' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/1119249749116092462/comments/default/6640928012388586334'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2014/09/running-javascript-unit-tests-in-appveyor.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-1119249749116092462' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/1119249749116092462' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='24 October 2014 at 08:21'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-6623270233140067829</id><published>2014-10-27T14:18:10.923Z</published><updated>2014-10-27T14:18:10.923Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Great article! Thanks!</title><content type='html'>Great article! Thanks!</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/4241616656191588777/comments/default/6623270233140067829'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/4241616656191588777/comments/default/6623270233140067829'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2014/03/caching-and-cache-busting-with-requirejs.html?showComment=1414419490923#c6623270233140067829' title=''/><author><name>Matias</name><uri>https://www.blogger.com/profile/17695583014426786000</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2014/03/caching-and-cache-busting-with-requirejs.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-4241616656191588777' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/4241616656191588777' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-2110683037'/><gd:extendedProperty name='blogger.displayTime' value='27 October 2014 at 14:18'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-5713964367820493404</id><published>2014-10-28T06:32:23.356Z</published><updated>2014-10-28T06:32:23.356Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Thank you!!!!</title><content type='html'>Thank you!!!!</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/5713964367820493404'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/2414704032922872709/comments/default/5713964367820493404'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html?showComment=1414477943356#c5713964367820493404' title=''/><author><name>Sebastin Rojas</name><uri>https://www.blogger.com/profile/06113889541192579265</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/09/globalize-and-jquery-validate.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-2414704032922872709' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/2414704032922872709' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-609979513'/><gd:extendedProperty name='blogger.displayTime' value='28 October 2014 at 06:32'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2880639464773073058</id><published>2014-11-19T15:33:43.190Z</published><updated>2014-11-19T15:33:43.190Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>I can recommend a good .NET library if you are int...</title><content type='html'>I can recommend a good .NET library if you are interested. I have worked a lot with ExpertPdf &lt;a href="http://www.html-to-pdf.net" rel="nofollow"&gt;Html To Pdf Converter&lt;/a&gt;.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/2880639464773073058'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/2880639464773073058'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html?showComment=1416411223190#c2880639464773073058' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/00715328039016762087</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-8680133602632737625' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/8680133602632737625' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-382105656'/><gd:extendedProperty name='blogger.displayTime' value='19 November 2014 at 15:33'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-1891460616692886948</id><published>2014-11-20T15:36:30.581Z</published><updated>2014-11-20T15:36:30.581Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>After being drawn in by the beautiful looking erro...</title><content type='html'>After being drawn in by the beautiful looking error messages on the UI from the picture you have inserted at the top of this post I attempted to use the code to hook up my current web api model validation with angular, but both the &amp;#39;datacontext&amp;#39; and &amp;#39;common&amp;#39; injections both errored due to having unknown providers (naturally) and I am unable to install either of the packages as they require NPM. Also there is no working demo for this code, only a screenshot.. the code itself looks good but the guide should be more explicit as to listing package requirements</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/4107411949171295182/comments/default/1891460616692886948'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/4107411949171295182/comments/default/1891460616692886948'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2014/08/angularjs-meet-aspnet-server-validation.html?showComment=1416497790581#c1891460616692886948' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/03126840463896765554</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2014/08/angularjs-meet-aspnet-server-validation.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-4107411949171295182' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/4107411949171295182' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1147215431'/><gd:extendedProperty name='blogger.displayTime' value='20 November 2014 at 15:36'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3031275655464454478</id><published>2014-11-20T15:42:13.731Z</published><updated>2014-11-20T15:42:13.731Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Thanks for the feedback Alex.  If you&amp;#39;re inter...</title><content type='html'>Thanks for the feedback Alex.  If you&amp;#39;re interested you can see this approach being used in the following project hosted on GitHub: &lt;a href="https://github.com/johnnyreilly/Proverb" rel="nofollow"&gt;https://github.com/johnnyreilly/Proverb&lt;/a&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/4107411949171295182/comments/default/3031275655464454478'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/4107411949171295182/comments/default/3031275655464454478'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2014/08/angularjs-meet-aspnet-server-validation.html?showComment=1416498133731#c3031275655464454478' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/4107411949171295182/comments/default/1891460616692886948'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2014/08/angularjs-meet-aspnet-server-validation.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-4107411949171295182' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/4107411949171295182' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='20 November 2014 at 15:42'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-4590909052765023703</id><published>2014-11-20T15:46:52.253Z</published><updated>2014-11-20T15:46:52.253Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>You should be able to take that code and run it on...</title><content type='html'>You should be able to take that code and run it on your own machine as long as you have SQL Server 2008 R2 installed.  &lt;br /&gt;&lt;br /&gt;It&amp;#39;s been successfully deployed to Azure and I&amp;#39;d be happy to share a link with you if you email me.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/4107411949171295182/comments/default/4590909052765023703'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/4107411949171295182/comments/default/4590909052765023703'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2014/08/angularjs-meet-aspnet-server-validation.html?showComment=1416498412253#c4590909052765023703' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/4107411949171295182/comments/default/1891460616692886948'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2014/08/angularjs-meet-aspnet-server-validation.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-4107411949171295182' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/4107411949171295182' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='20 November 2014 at 15:46'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-7873608736848383417</id><published>2014-11-20T16:30:42.982Z</published><updated>2014-11-20T16:30:42.982Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>thanks for the reply. ill take a look john. I can ...</title><content type='html'>thanks for the reply. ill take a look john. I can see and understand the viewable code in your above example however just don&amp;#39;t understand where the &amp;#39;datacontext&amp;#39; and &amp;#39;common&amp;#39; injections are intended to be sourced from? Yeah ill send you an email too</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/4107411949171295182/comments/default/7873608736848383417'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/4107411949171295182/comments/default/7873608736848383417'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2014/08/angularjs-meet-aspnet-server-validation.html?showComment=1416501042982#c7873608736848383417' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/4107411949171295182/comments/default/1891460616692886948'/><author><name>Unknown</name><uri>https://www.blogger.com/profile/03126840463896765554</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2014/08/angularjs-meet-aspnet-server-validation.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-4107411949171295182' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/4107411949171295182' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1147215431'/><gd:extendedProperty name='blogger.displayTime' value='20 November 2014 at 16:30'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-830701205164739096</id><published>2014-12-01T04:17:17.845Z</published><updated>2014-12-01T04:17:17.845Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi John, get some error about network .Can you hel...</title><content type='html'>Hi John, get some error about network .Can you help me?&lt;br /&gt;&lt;br /&gt;&amp;quot;   Loading pages (1/6)&lt;br /&gt;[&amp;gt;                                                           ] 0%&lt;br /&gt;[======&amp;gt;                                                     ] 10%&lt;br /&gt;Error: Failed loading page https://www.google.co.th/ (sometimes it will work just to ignore this error with --load-error-handling ignore)&lt;br /&gt;Exit with code 1 due to network error: UnknownNetworkError  &amp;quot;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/830701205164739096'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8680133602632737625/comments/default/830701205164739096'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html?showComment=1417407437845#c830701205164739096' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/13912287566251323288</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2012/04/making-pdfs-from-html-in-c-using.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-8680133602632737625' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/8680133602632737625' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-2052492163'/><gd:extendedProperty name='blogger.displayTime' value='1 December 2014 at 04:17'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-2808741618077743288</id><published>2014-12-01T11:31:43.453Z</published><updated>2014-12-01T11:31:43.453Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi John, interesting article. I&amp;#39;m just curious...</title><content type='html'>Hi John, interesting article. I&amp;#39;m just curious - given the limitations of Coded UI, why *aren&amp;#39;t* you using Selenium? (Disclaimer: I use Selenium, but haven&amp;#39;t tried Coded UI.)</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8479406605518565864/comments/default/2808741618077743288'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8479406605518565864/comments/default/2808741618077743288'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2014/11/Coded-UI-IE-11-and-the-runas-problem.html?showComment=1417433503453#c2808741618077743288' title=''/><author><name>lucyconnuk</name><uri>https://www.blogger.com/profile/06298323182081119624</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2014/11/Coded-UI-IE-11-and-the-runas-problem.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-8479406605518565864' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/8479406605518565864' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1907038376'/><gd:extendedProperty name='blogger.displayTime' value='1 December 2014 at 11:31'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-7061097980443197839</id><published>2014-12-01T11:40:11.210Z</published><updated>2014-12-01T11:40:11.210Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi Lucy,

Essentially because the project has a fu...</title><content type='html'>Hi Lucy,&lt;br /&gt;&lt;br /&gt;Essentially because the project has a full suite of tests that were developed with Coded UI.  (It&amp;#39;s worth saying that at one point the project had dedicated testers who were mostly responsible for building this suite up.)  It would be a pretty major exercise to port them from Coded UI to Selenium and there isn&amp;#39;t a significant business justification.&lt;br /&gt;&lt;br /&gt;If I had my time over I&amp;#39;d have used Selenium from the beginning just based on the anecdotal evidence I&amp;#39;ve heard.  Out of curiousity, how would you describe your Selenium experience so far?  Does it inspire the same frustrations I&amp;#39;ve listed or have you found it less painful?</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8479406605518565864/comments/default/7061097980443197839'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8479406605518565864/comments/default/7061097980443197839'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2014/11/Coded-UI-IE-11-and-the-runas-problem.html?showComment=1417434011210#c7061097980443197839' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8479406605518565864/comments/default/2808741618077743288'/><author><name>johnnyreilly</name><uri>https://www.blogger.com/profile/08843967435291485110</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2014/11/Coded-UI-IE-11-and-the-runas-problem.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-8479406605518565864' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/8479406605518565864' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1897137490'/><gd:extendedProperty name='blogger.displayTime' value='1 December 2014 at 11:40'/></entry><entry><id>tag:blogger.com,1999:blog-3759615474523601615.post-3576309938261440217</id><published>2014-12-01T18:16:13.854Z</published><updated>2014-12-01T18:16:13.854Z</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>We&amp;#39;ve had a little bit of pain with Selenium b...</title><content type='html'>We&amp;#39;ve had a little bit of pain with Selenium but nothing like you&amp;#39;ve had with Coded UI, I think. As a team (6 web devs) we&amp;#39;ve developed a suite of helper functions which do things like add in Thread.sleeps to help the tests run more smoothly and wait for certain things to appear on a page before testing them. We use Selenium to test 4 fairly large ASP.Net 4.0/C# websites, and it does take several hours. We have configured the tests to run in IE, Chrome, Firefox and Opera if required but usually just run them in Firefox as that gives the fewest problems.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8479406605518565864/comments/default/3576309938261440217'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8479406605518565864/comments/default/3576309938261440217'/><link rel='alternate' type='text/html' href='http://icanmakethiswork.blogspot.com/2014/11/Coded-UI-IE-11-and-the-runas-problem.html?showComment=1417457773854#c3576309938261440217' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/3759615474523601615/8479406605518565864/comments/default/2808741618077743288'/><author><name>lucyconnuk</name><uri>https://www.blogger.com/profile/06298323182081119624</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='35' height='35' src='//www.blogger.com/img/blogger_logo_round_35.png'/></author><thr:in-reply-to href='https://icanmakethiswork.blogspot.com/2014/11/Coded-UI-IE-11-and-the-runas-problem.html' ref='tag:blogger.com,1999:blog-3759615474523601615.post-8479406605518565864' source='https://www.blogger.com/feeds/3759615474523601615/posts/default/8479406605518565864' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1907038376'/><gd:extendedProperty name='blogger.displayTime' value='1 December 2014 at 18:16'/></entry></feed>