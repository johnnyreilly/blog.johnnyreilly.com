<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.2.0">
<title data-rh="true">Azure App Service, Health checks and zero downtime deployments | johnnyreilly</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://res.cloudinary.com/priou/image/fetch/f_auto,q_auto,w_auto,dpr_auto/https://johnnyreilly.com/img/profile.jpg"><meta data-rh="true" name="twitter:image" content="https://res.cloudinary.com/priou/image/fetch/f_auto,q_auto,w_auto,dpr_auto/https://johnnyreilly.com/img/profile.jpg"><meta data-rh="true" property="og:url" content="https://johnnyreilly.com/azure-app-service-health-checks-and-zero-downtime-deployments"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" name="robots" content="max-image-preview:large"><meta data-rh="true" name="monetization" content="$ilp.uphold.com/LwQQhXdpwxeJ"><meta data-rh="true" property="og:title" content="Azure App Service, Health checks and zero downtime deployments | johnnyreilly"><meta data-rh="true" name="description" content="Azure App Service enables zero downtime deployments using health checks and deployment slots. Automated swapping slots ensure constant service."><meta data-rh="true" property="og:description" content="Azure App Service enables zero downtime deployments using health checks and deployment slots. Automated swapping slots ensure constant service."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2021-02-11T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://johnnyreilly.com/about"><meta data-rh="true" property="article:tag" content="azure"><link data-rh="true" rel="icon" href="/favicon.ico"><link data-rh="true" rel="canonical" href="https://johnnyreilly.com/azure-app-service-health-checks-and-zero-downtime-deployments"><link data-rh="true" rel="alternate" href="https://johnnyreilly.com/azure-app-service-health-checks-and-zero-downtime-deployments" hreflang="en"><link data-rh="true" rel="alternate" href="https://johnnyreilly.com/azure-app-service-health-checks-and-zero-downtime-deployments" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://J3MYR1INLT-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://johnnyreilly.com/azure-app-service-health-checks-and-zero-downtime-deployments","mainEntityOfPage":"https://johnnyreilly.com/azure-app-service-health-checks-and-zero-downtime-deployments","url":"https://johnnyreilly.com/azure-app-service-health-checks-and-zero-downtime-deployments","headline":"Azure App Service, Health checks and zero downtime deployments","name":"Azure App Service, Health checks and zero downtime deployments","description":"Azure App Service enables zero downtime deployments using health checks and deployment slots. Automated swapping slots ensure constant service.","datePublished":"2021-02-11T00:00:00.000Z","author":{"@type":"Person","name":"John Reilly","description":"OSS Engineer - TypeScript, Azure, React, Node.js, .NET","url":"https://johnnyreilly.com/about","image":"https://johnnyreilly.com/img/profile.jpg"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://johnnyreilly.com/","name":"I CAN MAKE THIS WORK"}}</script><link rel="alternate" type="application/rss+xml" href="/rss.xml" title="I CAN MAKE THIS WORK RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="I CAN MAKE THIS WORK Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="johnnyreilly" href="/opensearch.xml">

<link rel="icon" href="/img/profile-64x64.jpg">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#3578e5">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#000">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
<link rel="preload" href="https://johnnyreilly.com/fonts/Poppins-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://johnnyreilly.com/fonts/Poppins-Bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preconnect" href="https://res.cloudinary.com">
<link rel="monetization" href="https://ilp.uphold.com/LwQQhXdpwxeJ">
<script type="application/ld+json">{"@context":"https://schema.org","@graph":[{"@id":"https://johnnyreilly.com","@type":"WebSite","url":"https://johnnyreilly.com","name":"johnnyreilly","description":"This is John Reilly's blog. John is an Open Source Software Engineer working on TypeScript, Azure, React, Node.js, .NET and more.","copyrightHolder":{"@id":"https://johnnyreilly.com/about"},"publisher":{"@id":"https://johnnyreilly.com/about"},"potentialAction":{"@type":"SearchAction","target":{"@type":"EntryPoint","urlTemplate":"https://johnnyreilly.com/search?q={search_term_string}"},"query-input":"required name=search_term_string"},"inLanguage":"en-UK"},{"@id":"https://johnnyreilly.com/about","@type":"Person","name":"John Reilly","alternateName":"Johnny Reilly","image":{"@type":"ImageObject","inLanguage":"en-UK","@id":"https://johnnyreilly.com/about#image","url":"https://johnnyreilly.com/img/profile.jpg","contentUrl":"https://johnnyreilly.com/img/profile.jpg","width":200,"height":200,"caption":"John Reilly"},"description":"John is an Open Source Software Engineer working on TypeScript, Azure, React, Node.js, .NET and more. As well as writing code, John is a speaker at meetups, one of the founders of the TS Congress conference, and the author of the history of Definitely Typed, which he worked on in the early days of TypeScript.","url":"https://johnnyreilly.com","address":{"@type":"PostalAddress","streetAddress":"Twickenham","addressLocality":"London","addressCountry":"United Kingdom"},"email":"johnny_reilly@hotmail.com","birthPlace":"Bristol","sameAs":["https://github.com/johnnyreilly","https://fosstodon.org/@johnny_reilly","https://twitter.com/johnny_reilly","https://dev.to/johnnyreilly","https://app.daily.dev/johnnyreilly","https://stackoverflow.com/users/761388/john-reilly","https://blog.logrocket.com/author/johnreilly/","https://www.reddit.com/user/johnny_reilly","https://uk.linkedin.com/in/johnnyreilly"]},{"@id":"https://johnnyreilly.com/about#organization","@type":["Organization","Brand"],"url":"https://johnnyreilly.com","name":"johnnyreilly","description":"This is John Reilly's blog. John is an Open Source Software Engineer working on TypeScript, Azure, React, Node.js, .NET and more.","logo":{"@type":"ImageObject","inLanguage":"en-UK","@id":"https://johnnyreilly.com/#logo","url":"https://johnnyreilly.com/img/profile.jpg","contentUrl":"https://johnnyreilly.com/img/profile.jpg","width":200,"height":200,"caption":"John Reilly"},"image":{"@id":"https://johnnyreilly.com/#logo"},"sameAs":["https://github.com/johnnyreilly","https://fosstodon.org/@johnny_reilly","https://twitter.com/johnny_reilly","https://dev.to/johnnyreilly","https://app.daily.dev/johnnyreilly","https://stackoverflow.com/users/761388/john-reilly","https://blog.logrocket.com/author/johnreilly/","https://www.reddit.com/user/johnny_reilly","https://uk.linkedin.com/in/johnnyreilly"]}]}</script>
<link rel="webmention" href="https://webmention.io/johnnyreilly.com/webmention"><link rel="stylesheet" href="/assets/css/styles.760c3029.css">
<script src="/assets/js/runtime~main.e25c9e55.js" defer="defer"></script>
<script src="/assets/js/main.266d6f1a.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><script type="application/ld+json">[{"@context":"https://schema.org","@type":"BreadcrumbList","@id":"/azure-app-service-health-checks-and-zero-downtime-deployments#breadcrumb","name":"Blog breadcrumb","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https://johnnyreilly.com"},{"@type":"ListItem","position":2,"name":"Blog","item":"https://johnnyreilly.com/blog"},{"@type":"ListItem","position":3,"name":"Azure App Service, Health checks and zero downtime deployments"}]}]</script><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/profile-64x64.jpg" alt="Profile picture of John Reilly" class="themedComponent_mlkZ themedComponent--light_NVdE" height="32" width="32"><img src="/img/profile-64x64.jpg" alt="Profile picture of John Reilly" class="themedComponent_mlkZ themedComponent--dark_xIcU" height="32" width="32"></div><b class="navbar__title text--truncate">John Reilly</b></a><a class="navbar__item navbar__link" href="/about">About</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/talks">Talks</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/johnnyreilly" target="_blank" rel="me" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://twitter.com/johnny_reilly" target="_blank" rel="me" class="navbar__item navbar__link">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://fosstodon.org/@johnny_reilly" target="_blank" rel="me" class="navbar__item navbar__link">Mastodon<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure-cosmosdb-container-item-generics">Azure Cosmos DB: container items and generics</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/text-first-mui-tabs">Text-first MUI Tabs</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/generate-word-doc-in-asp-net">Generate a Word document in ASP.NET</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/configure-azure-connection-strings-keys-in-azure-bicep">Configure Azure connection strings and keys in Azure Bicep</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/multiline-strings-dot-env-files">Multiline strings in .env files</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/typescript-eslint-no-unused-vars">ESLint no-unused-vars: _ ignore prefix</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/using-bun-in-azure-pipelines">Using Bun in Azure Pipelines</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/bicep-lint-azure-pipelines-github-actions">Bicep lint with Azure Pipelines and GitHub Actions</a></li></ul></nav></aside><main class="col col--7"><article><header><h1 class="title_f1Hy">Azure App Service, Health checks and zero downtime deployments</h1><div class="container_mt6G margin-vert--md"><time datetime="2021-02-11T00:00:00.000Z">February 11, 2021</time> · <!-- -->8 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://johnnyreilly.com/about" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://johnnyreilly.com/img/profile.jpg" alt="John Reilly"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://johnnyreilly.com/about" target="_blank" rel="noopener noreferrer"><span>John Reilly</span></a></div><small class="avatar__subtitle">OSS Engineer - TypeScript, Azure, React, Node.js, .NET</small></div></div></div></div></header><div id="__blog-post-container" class="markdown"><p>I&#x27;ve been working recently on zero downtime deployments using Azure App Service. They&#x27;re facilitated by a combination of <a href="https://docs.microsoft.com/en-us/azure/app-service/monitor-instances-health-check" target="_blank" rel="noopener noreferrer">Health checks</a> and <a href="https://docs.microsoft.com/en-us/azure/app-service/deploy-staging-slots" target="_blank" rel="noopener noreferrer">deployment slots</a>. This post will talk about why this is important and how it works.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="why-zero-downtime-deployments">Why zero downtime deployments?<a href="#why-zero-downtime-deployments" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h2>
<p>Historically (and for many applications, currently) deployment results in downtime. A period of time during the release where an application is not available to users whilst the new version is deployed. There are a number of downsides to releases with downtime:</p>
<ol>
<li>Your users cannot use your application. This will frustrate them and make them sad.</li>
<li>Because you&#x27;re a kind person and you want your users to be happy, you&#x27;ll optimise to make their lives better. You&#x27;ll release when the fewest users are accessing your application. It will likely mean you&#x27;ll end up working late, early or at weekends.</li>
<li>Again because you want to reduce impact on users, you&#x27;ll release less often. This means that every release will bring with it a greater collection of changes. This is turn will often result in a large degree of focus on manually testing each release, to reduce the likelihood of bugs ending up in users hands. This is a noble aim, but it drags the teams focus away from shipping.</li>
</ol>
<p>Put simply: downtime in releases impacts customer happiness and leads to reduced pace for teams. It&#x27;s a vicious circle.</p>
<p>But if we turn it around, what does it look like if releases have <em>no</em> downtime at all?</p>
<ol>
<li>Your users can always use your application. This will please them.</li>
<li>Your team is now safe to release at any time, day or night. They will likely release more often as a consequence.</li>
<li>If your team has sufficient automated testing in place, they&#x27;re now in a position where they can move to <a href="https://www.atlassian.com/continuous-delivery/principles/continuous-integration-vs-delivery-vs-deployment" target="_blank" rel="noopener noreferrer">Continuous Deployment</a>.</li>
<li>Releases become boring. This is good. They &quot;just work™️&quot; and so the team can focus instead on building the cool features that are going to make users lives even better.</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="manual-zero-downtime-releases-with-app-services">Manual zero downtime releases with App Services<a href="#manual-zero-downtime-releases-with-app-services" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h2>
<p>App Services have the ability to scale out. To <a href="https://azure.microsoft.com/en-us/blog/scaling-up-and-scaling-out-in-windows-azure-web-sites/" target="_blank" rel="noopener noreferrer">quote the docs</a>:</p>
<blockquote>
<p>A scale out operation is the equivalent of creating multiple copies of your web site and adding a load balancer to distribute the demand between them. When you scale out ... there is no need to configure load balancing separately since this is already provided by the platform.</p>
</blockquote>
<p>As you can see, scaling out works by having multiple instances of your app. Deployment slots are exactly this, but with an extra twist. If you add a deployment slot to your App Service, then you <strong>no longer deploy to production</strong>. Instead you deploy to your staging slot. Your staging slot is accessible in the same way your production slot is accessible. So whilst your users may go to <a href="https://my-glorious-app.io" target="_blank" rel="noopener noreferrer">https://my-glorious-app.io</a>, your staging slot may live at <a href="https://my-glorious-app-stage.azurewebsites.net" target="_blank" rel="noopener noreferrer">https://my-glorious-app-stage.azurewebsites.net</a> instead. Because this is accessible, this is testable. You are in a position to test the deployed application before making it generally available.</p>
<p><img decoding="async" loading="eager" alt="diagram of network traffic going to various App Service Deployment Slots" src="/assets/images/app-service-with-slots-bdbc420150a05a222ec247beeeda469f.png" width="600" height="487" fetchpriority="high" class="img_ev3q"></p>
<p>Once you&#x27;re happy that everything looks good, you can &quot;swap slots&quot;. What this means, is the version of the app living in the staging slot, gets moved into the production slot. So that which lived at <a href="https://my-glorious-app-stage.azurewebsites.net" target="_blank" rel="noopener noreferrer">https://my-glorious-app-stage.azurewebsites.net</a> moves to <a href="https://my-glorious-app.io" target="_blank" rel="noopener noreferrer">https://my-glorious-app.io</a>. For a more details on what that involves <a href="https://docs.microsoft.com/en-us/azure/app-service/deploy-staging-slots#what-happens-during-a-swap" target="_blank" rel="noopener noreferrer">read this</a>. The significant take home is this: there is no downtime. Traffic stops being routed to the old instance and starts being routed to the new one. It&#x27;s as simple as that.</p>
<p>I should mention at this point that there&#x27;s a <a href="https://opensource.com/article/17/5/colorful-deployments" target="_blank" rel="noopener noreferrer">number of zero downtime strategies out there</a> and slots can help support a number of these. This includes canary deployments, where a subset of traffic is routed to the new version prior to it being opened out more widely. In our case, we&#x27;re looking at rolling deployments, where we replace the currently running instances of our application with the new ones; but it&#x27;s worth being aware that there are other strategies that slots can facilitate.</p>
<p>So what does it look like when slots swap? Well, to test that out, we swapped slots on our two App Service instances. We repeatedly CURLed our apps <a href="/surfacing-azure-pipelines-build-info-in-an-aspnet-react-app"><code>api/build</code></a> endpoint that exposes the build information; to get visibility around which version of our app we were routing traffic to. This is what we saw:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9EFEFF;--prism-background-color:#2D2A55"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#9EFEFF;background-color:#2D2A55"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9EFEFF"><span class="token plain">Thu Jan 21 11:51:51 GMT 2021</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">{&quot;buildNumber&quot;:&quot;20210121.5&quot;,&quot;buildId&quot;:&quot;17992&quot;,&quot;commitHash&quot;:&quot;c2122919df54bfa6a0d20bceb9f06890f822b26e&quot;}</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">Thu Jan 21 11:51:54 GMT 2021</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">{&quot;buildNumber&quot;:&quot;20210121.6&quot;,&quot;buildId&quot;:&quot;18015&quot;,&quot;commitHash&quot;:&quot;062ac1488fcf1737fe1dbab0d05c095786218f30&quot;}</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">Thu Jan 21 11:51:57 GMT 2021</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">{&quot;buildNumber&quot;:&quot;20210121.5&quot;,&quot;buildId&quot;:&quot;17992&quot;,&quot;commitHash&quot;:&quot;c2122919df54bfa6a0d20bceb9f06890f822b26e&quot;}</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">Thu Jan 21 11:52:00 GMT 2021</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">{&quot;buildNumber&quot;:&quot;20210121.6&quot;,&quot;buildId&quot;:&quot;18015&quot;,&quot;commitHash&quot;:&quot;062ac1488fcf1737fe1dbab0d05c095786218f30&quot;}</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">Thu Jan 21 11:52:03 GMT 2021</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">{&quot;buildNumber&quot;:&quot;20210121.6&quot;,&quot;buildId&quot;:&quot;18015&quot;,&quot;commitHash&quot;:&quot;062ac1488fcf1737fe1dbab0d05c095786218f30&quot;}</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">Thu Jan 21 11:52:05 GMT 2021</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">{&quot;buildNumber&quot;:&quot;20210121.6&quot;,&quot;buildId&quot;:&quot;18015&quot;,&quot;commitHash&quot;:&quot;062ac1488fcf1737fe1dbab0d05c095786218f30&quot;}</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">Thu Jan 21 11:52:08 GMT 2021</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">{&quot;buildNumber&quot;:&quot;20210121.5&quot;,&quot;buildId&quot;:&quot;17992&quot;,&quot;commitHash&quot;:&quot;c2122919df54bfa6a0d20bceb9f06890f822b26e&quot;}</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">Thu Jan 21 11:52:10 GMT 2021</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">{&quot;buildNumber&quot;:&quot;20210121.6&quot;,&quot;buildId&quot;:&quot;18015&quot;,&quot;commitHash&quot;:&quot;062ac1488fcf1737fe1dbab0d05c095786218f30&quot;}</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">Thu Jan 21 11:52:12 GMT 2021</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">{&quot;buildNumber&quot;:&quot;20210121.5&quot;,&quot;buildId&quot;:&quot;17992&quot;,&quot;commitHash&quot;:&quot;c2122919df54bfa6a0d20bceb9f06890f822b26e&quot;}</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">Thu Jan 21 11:52:15 GMT 2021</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">{&quot;buildNumber&quot;:&quot;20210121.6&quot;,&quot;buildId&quot;:&quot;18015&quot;,&quot;commitHash&quot;:&quot;062ac1488fcf1737fe1dbab0d05c095786218f30&quot;}</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">Thu Jan 21 11:52:17 GMT 2021</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">{&quot;buildNumber&quot;:&quot;20210121.6&quot;,&quot;buildId&quot;:&quot;18015&quot;,&quot;commitHash&quot;:&quot;062ac1488fcf1737fe1dbab0d05c095786218f30&quot;}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The first new version of our application showed up in a production slot at 11:51:54, and the last old version showed up at 11:52:12. So it took a total of 15 seconds to complete the transition from hitting only instances of the old application to hitting only instances of the new application. During that 15 seconds either old or new versions of the application would be serving traffic. Significantly, there was always a version of the application returning responses.</p>
<p>This is <em>very</em> exciting! We have zero downtime deployments!</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="rollbacks-for-bonus-points">Rollbacks for bonus points<a href="#rollbacks-for-bonus-points" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h2>
<p>We now have the new version of the app (<code>buildNumber: 20210121.6</code>) in the production slot, and the old version of the app (<code>buildNumber: 20210121.5</code>) in the staging slot.</p>
<p>Slots have a tremendous rollback story. If it emerges that there was some uncaught issue in your release and you&#x27;d like to revert to the previous version, you can! Just as we swapped just now to move <code>buildNumber: 20210121.6</code> from the staging slot to the production slot and <code>buildNumber: 20210121.5</code> the other way, we can swap right back and revert our release like so:</p>
<p><img decoding="async" loading="lazy" alt="diagram of network traffic going to various App Service Deployment Slots exposing build number" src="/assets/images/app-service-with-slots-and-build-number-0f5ae4841544e4192ed19075775ba2fa.png" width="600" height="522" class="img_ev3q"></p>
<p>Once again users going to <a href="https://my-glorious-app.io" target="_blank" rel="noopener noreferrer">https://my-glorious-app.io</a> are hitting <code>buildNumber: 20210121.5</code>.</p>
<p>This is also <em>very</em> exciting! We have zero downtime deployments <em>and</em> rollbacks!</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="automated-zero-downtime-releases-with-health-checks">Automated zero downtime releases with Health checks<a href="#automated-zero-downtime-releases-with-health-checks" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h2>
<p>The final piece of the puzzle here automation. You&#x27;re a sophisticated team, you&#x27;ve put a great deal of energy into automating your tests. You don&#x27;t want your release process to be manual for this very reason; you trust your test coverage. You want to move to Continuous Deployment.</p>
<p>Fortunately, automating swapping slots is a breeze with <code>azure-pipelines.yml</code>. Consider the following:</p>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9EFEFF;--prism-background-color:#2D2A55"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#9EFEFF;background-color:#2D2A55"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9EFEFF"><span class="token punctuation" style="color:rgb(255, 255, 255)">-</span><span class="token plain"> </span><span class="token key atrule">job</span><span class="token punctuation" style="color:rgb(255, 255, 255)">:</span><span class="token plain"> DeployApp</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">        </span><span class="token key atrule">displayName</span><span class="token punctuation" style="color:rgb(255, 255, 255)">:</span><span class="token plain"> Deploy app</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">        </span><span class="token key atrule">dependsOn</span><span class="token punctuation" style="color:rgb(255, 255, 255)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(255, 255, 255)">-</span><span class="token plain"> DeployARMTemplates</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">        </span><span class="token key atrule">steps</span><span class="token punctuation" style="color:rgb(255, 255, 255)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(255, 255, 255)">-</span><span class="token plain"> </span><span class="token key atrule">download</span><span class="token punctuation" style="color:rgb(255, 255, 255)">:</span><span class="token plain"> current</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">          </span><span class="token key atrule">artifact</span><span class="token punctuation" style="color:rgb(255, 255, 255)">:</span><span class="token plain"> webapp</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(255, 255, 255)">-</span><span class="token plain"> </span><span class="token key atrule">task</span><span class="token punctuation" style="color:rgb(255, 255, 255)">:</span><span class="token plain"> AzureWebApp@1</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">          </span><span class="token key atrule">displayName</span><span class="token punctuation" style="color:rgb(255, 255, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">&#x27;Deploy Web Application&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">          </span><span class="token key atrule">inputs</span><span class="token punctuation" style="color:rgb(255, 255, 255)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">            </span><span class="token key atrule">azureSubscription</span><span class="token punctuation" style="color:rgb(255, 255, 255)">:</span><span class="token plain"> $(serviceConnection)</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">            </span><span class="token key atrule">resourceGroupName</span><span class="token punctuation" style="color:rgb(255, 255, 255)">:</span><span class="token plain"> $(azureResourceGroup)</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">            </span><span class="token key atrule">appName</span><span class="token punctuation" style="color:rgb(255, 255, 255)">:</span><span class="token plain"> $(appServiceName)</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">            </span><span class="token key atrule">package</span><span class="token punctuation" style="color:rgb(255, 255, 255)">:</span><span class="token plain"> $(Pipeline.Workspace)/webapp/</span><span class="token important">**/*.zip</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">            </span><span class="token key atrule">slotName</span><span class="token punctuation" style="color:rgb(255, 255, 255)">:</span><span class="token plain"> stage</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">            </span><span class="token key atrule">deployToSlotOrASE</span><span class="token punctuation" style="color:rgb(255, 255, 255)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(255, 98, 140)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">            </span><span class="token key atrule">deploymentMethod</span><span class="token punctuation" style="color:rgb(255, 255, 255)">:</span><span class="token plain"> auto</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(255, 255, 255)">-</span><span class="token plain"> </span><span class="token key atrule">job</span><span class="token punctuation" style="color:rgb(255, 255, 255)">:</span><span class="token plain"> SwapSlots</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">        </span><span class="token key atrule">displayName</span><span class="token punctuation" style="color:rgb(255, 255, 255)">:</span><span class="token plain"> Swap Slots</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">        </span><span class="token key atrule">dependsOn</span><span class="token punctuation" style="color:rgb(255, 255, 255)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(255, 255, 255)">-</span><span class="token plain"> DeployApp</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">        </span><span class="token key atrule">steps</span><span class="token punctuation" style="color:rgb(255, 255, 255)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(255, 255, 255)">-</span><span class="token plain"> </span><span class="token key atrule">task</span><span class="token punctuation" style="color:rgb(255, 255, 255)">:</span><span class="token plain"> AzureAppServiceManage@0</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">            </span><span class="token key atrule">displayName</span><span class="token punctuation" style="color:rgb(255, 255, 255)">:</span><span class="token plain"> Swap Slots</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">            </span><span class="token key atrule">inputs</span><span class="token punctuation" style="color:rgb(255, 255, 255)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">              </span><span class="token key atrule">action</span><span class="token punctuation" style="color:rgb(255, 255, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">&#x27;Swap Slots&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">              </span><span class="token key atrule">azureSubscription</span><span class="token punctuation" style="color:rgb(255, 255, 255)">:</span><span class="token plain"> $(serviceConnection)</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">              </span><span class="token key atrule">resourceGroupName</span><span class="token punctuation" style="color:rgb(255, 255, 255)">:</span><span class="token plain"> $(azureResourceGroup)</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">              </span><span class="token key atrule">webAppName</span><span class="token punctuation" style="color:rgb(255, 255, 255)">:</span><span class="token plain"> $(appServiceName)</span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">              </span><span class="token key atrule">SourceSlot</span><span class="token punctuation" style="color:rgb(255, 255, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">&#x27;stage&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The first job here, deploys our previously built <code>webapp</code> to the <code>stage</code> slot. The second job swaps the slot.</p>
<p>When I first considered this, the question rattling around in the back of my mind was this: how does App Service know when it&#x27;s safe to swap? What if we swap before our app has fully woken up and started serving responses?</p>
<p>It so happens that using <a href="https://docs.microsoft.com/en-us/azure/app-service/monitor-instances-health-check" target="_blank" rel="noopener noreferrer">Health checks, App Service caters for this beautifully</a>. A health check endpoint is a URL in your application which, when hit, checks the dependencies of your application. &quot;Is the database accessible?&quot; &quot;Are the APIs I depend upon accessible?&quot; The diagram from the docs expresses it very well:</p>
<p><img decoding="async" loading="lazy" alt="diagram of traffic hitting the health check endpoint" src="/assets/images/health-check-failure-diagram-09ee3a02f74f2d594fbfd235aec3efaa.webp" width="400" height="166" class="img_ev3q"></p>
<p>This approach is very similar to <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/" target="_blank" rel="noopener noreferrer">liveness, readiness and startup probes in Kubernetes</a>. To make use of Health checks, in our ARM template for our App Service we have configured a <code>healthCheckPath</code>:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9EFEFF;--prism-background-color:#2D2A55"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#9EFEFF;background-color:#2D2A55"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9EFEFF"><span class="token property" style="color:rgb(255, 157, 0)">&quot;siteConfig&quot;</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">    </span><span class="token property" style="color:rgb(255, 157, 0)">&quot;linuxFxVersion&quot;</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">&quot;[parameters(&#x27;linuxFxVersion&#x27;)]&quot;</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">    </span><span class="token property" style="color:rgb(255, 157, 0)">&quot;alwaysOn&quot;</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 98, 140)">true</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">    </span><span class="token property" style="color:rgb(255, 157, 0)">&quot;http20Enabled&quot;</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 98, 140)">true</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">    </span><span class="token property" style="color:rgb(255, 157, 0)">&quot;minTlsVersion&quot;</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">&quot;1.2&quot;</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">    </span><span class="token property" style="color:rgb(255, 157, 0)">&quot;healthCheckPath&quot;</span><span class="token operator" style="color:rgb(255, 157, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">&quot;/api/health&quot;</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">    </span><span class="token comment" style="color:rgb(179, 98, 255);font-style:italic">//...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain"></span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This tells App Service where to look to check the health. The health check endpoint itself is provided by the <code>MapHealthChecks</code> in our <code>Startup.cs</code> of our .NET application:</p>
<div class="language-cs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9EFEFF;--prism-background-color:#2D2A55"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cs codeBlock_bY9V thin-scrollbar" style="color:#9EFEFF;background-color:#2D2A55"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9EFEFF"><span class="token plain">app</span><span class="token punctuation" style="color:rgb(255, 255, 255)">.</span><span class="token function" style="color:rgb(250, 208, 0)">UseEndpoints</span><span class="token punctuation" style="color:rgb(255, 255, 255)">(</span><span class="token plain">endpoints </span><span class="token operator" style="color:rgb(255, 157, 0)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(255, 255, 255)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">    endpoints</span><span class="token punctuation" style="color:rgb(255, 255, 255)">.</span><span class="token function" style="color:rgb(250, 208, 0)">MapControllerRoute</span><span class="token punctuation" style="color:rgb(255, 255, 255)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">        </span><span class="token named-parameter punctuation" style="color:rgb(255, 255, 255)">name</span><span class="token punctuation" style="color:rgb(255, 255, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">&quot;default&quot;</span><span class="token punctuation" style="color:rgb(255, 255, 255)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">        </span><span class="token named-parameter punctuation" style="color:rgb(255, 255, 255)">pattern</span><span class="token punctuation" style="color:rgb(255, 255, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(165, 255, 144)">&quot;{controller}/{action=Index}/{id?}&quot;</span><span class="token punctuation" style="color:rgb(255, 255, 255)">)</span><span class="token punctuation" style="color:rgb(255, 255, 255)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain">    endpoints</span><span class="token punctuation" style="color:rgb(255, 255, 255)">.</span><span class="token function" style="color:rgb(250, 208, 0)">MapHealthChecks</span><span class="token punctuation" style="color:rgb(255, 255, 255)">(</span><span class="token string" style="color:rgb(165, 255, 144)">&quot;/api/health&quot;</span><span class="token punctuation" style="color:rgb(255, 255, 255)">)</span><span class="token punctuation" style="color:rgb(255, 255, 255)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9EFEFF"><span class="token plain"></span><span class="token punctuation" style="color:rgb(255, 255, 255)">}</span><span class="token punctuation" style="color:rgb(255, 255, 255)">)</span><span class="token punctuation" style="color:rgb(255, 255, 255)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You read a full list of all the ways App Service uses Health checks <a href="https://docs.microsoft.com/en-us/azure/app-service/monitor-instances-health-check#what-app-service-does-with-health-checks" target="_blank" rel="noopener noreferrer">here</a>. Pertinent for zero downtime deployments is this:</p>
<blockquote>
<p>when scaling up or out, App Service pings the Health check path to ensure new instances are ready.</p>
</blockquote>
<p>This is the magic sauce. App Service doesn&#x27;t route traffic to an instance until it&#x27;s given the thumbs up that it&#x27;s ready in the form of passing health checks. This is excellent; it is this that makes automated zero downtime releases a reality.</p>
<p>Props to the various Azure teams that have made this possible; I&#x27;m very impressed by the way in which the Health checks and slots can be combined together to support some tremendous use cases.</p></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure">azure</a></li></ul></div></div><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><a href="https://github.com/johnnyreilly/blog.johnnyreilly.com/edit/main/blog-website/blog/2021-02-11-azure-app-service-health-checks-and-zero-downtime-deployments/index.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/easy-auth-tokens-survive-releases-on-linux-azure-app-service"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Making Easy Auth tokens survive releases on Linux Azure App Service</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/arm-templates-security-role-assignments"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Azure RBAC: role assignments and ARM templates</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#why-zero-downtime-deployments" class="table-of-contents__link toc-highlight">Why zero downtime deployments?</a></li><li><a href="#manual-zero-downtime-releases-with-app-services" class="table-of-contents__link toc-highlight">Manual zero downtime releases with App Services</a></li><li><a href="#rollbacks-for-bonus-points" class="table-of-contents__link toc-highlight">Rollbacks for bonus points</a></li><li><a href="#automated-zero-downtime-releases-with-health-checks" class="table-of-contents__link toc-highlight">Automated zero downtime releases with Health checks</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item"><div class="footer__title"><a href="/tags/typescript" class="footer__link-item">TypeScript<img src="/img/ts-logo-128.svg" alt="TypeScript icon" class="footer__icon"></a></div>
<ul class="footer__items clean-list">
  <li class="footer__item"><a href="/typescript-vs-jsdoc-javascript" class="footer__link-item">TypeScript vs JSDoc JavaScript</a></li><li class="footer__item"><a href="/type-annotations-strong-types-weakly-held" class="footer__link-item">Type annotations proposal: strong types, weakly held</a></li>
</ul><div class="footer__title"><a href="/tags/azure" class="footer__link-item">Azure<img src="/img/azure-logo.svg" alt="Azure icon" class="footer__icon"></a></div>
<ul class="footer__items clean-list">
  <li class="footer__item"><a href="/azure-container-apps-easy-auth-and-dotnet-authentication" class="footer__link-item">Azure Container Apps: Easy Auth and .NET</a></li><li class="footer__item"><a href="/azure-static-web-apps-dynamic-redirects-azure-functions" class="footer__link-item">Azure Static Web Apps: dynamic redirects with Azure Functions</a></li>
</ul><div class="footer__title"><a href="/tags/asp-net" class="footer__link-item">ASP.NET<img src="/img/dotnet-logo.svg" alt="ASP.NET icon" class="footer__icon"></a></div>
<ul class="footer__items clean-list">
  <li class="footer__item"><a href="/eslint-your-csharp-in-vs-code-with-roslyn-analyzers" class="footer__link-item">ESLint your C# with Roslyn Analyzers</a></li><li class="footer__item"><a href="/aspnet-serilog-and-application-insights" class="footer__link-item">ASP.NET, Serilog and Application Insights</a></li>
</ul><div class="footer__title"><a href="/tags/react" class="footer__link-item">React<img src="/img/react-logo.svg" alt="React icon" class="footer__icon"></a></div>
<ul class="footer__items clean-list">
  <li class="footer__item"><a href="/structured-data-seo-and-react" class="footer__link-item">Structured data and React</a></li><li class="footer__item"><a href="/react-usesearchparamsstate" class="footer__link-item">React: storing state in URL with URLSearchParams</a></li>
</ul></li></ul></div><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item"><div class="footer__title">Notable articles</div>
<ul class="footer__items clean-list">
  <li class="footer__item"><a href="/definitely-typed-the-movie" class="footer__link-item">The history of Definitely Typed<img src="/img/definitely-typed-logo.png" alt="The history of Definitely Typed icon" class="footer__icon"></a></li><li class="footer__item"><a href="/typescript-documentary" class="footer__link-item">TypeScript: the documentary<img src="/img/ts-logo-128.svg" alt="TypeScript: the documentary icon" class="footer__icon"></a></li><li class="footer__item"><a href="/definitive-guide-to-migrating-from-blogger-to-docusaurus" class="footer__link-item">The definitive guide to migrating from Blogger to Docusaurus<img src="/img/docusaurus-logo.svg" alt="The definitive guide to migrating from Blogger to Docusaurus icon" class="footer__icon"></a></li><li class="footer__item"><a href="/how-we-fixed-my-seo" class="footer__link-item">How we fixed my SEO</a></li>
</ul><div class="footer__title">Popular articles</div>
<ul class="footer__items clean-list">
  <li class="footer__item"><a href="/aspnet-serilog-and-application-insights" class="footer__link-item">ASP.NET, Serilog and Application Insights</a></li><li class="footer__item"><a href="/eslint-your-csharp-in-vs-code-with-roslyn-analyzers" class="footer__link-item">ESLint your C# with Roslyn Analyzers</a></li><li class="footer__item"><a href="/prettier-your-csharp-with-dotnet-format-and-lint-staged" class="footer__link-item">dotnet-format: Prettier your C# with lint-staged & husky</a></li>
</ul><div class="footer__title">Recently updated</div>
<ul class="footer__items clean-list">
  <li class="footer__item"><a href="azure-cosmosdb-container-item-generics" class="footer__link-item">Azure Cosmos DB: container items and generics</a></li><li class="footer__item"><a href="adding-lastmod-to-sitemap-git-commit-date" class="footer__link-item">Adding lastmod to sitemap based on git commits</a></li><li class="footer__item"><a href="text-first-mui-tabs" class="footer__link-item">Text-first MUI Tabs</a></li>
</ul></li></ul></div><div class="col footer__col"><div class="footer__title">Learn more / support me</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/johnnyreilly/blog.johnnyreilly.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog source code on GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/tags">Blog categories</a></li><li class="footer__item"><a href="https://johnnyreilly.com/rss.xml" target="_blank" rel="noopener noreferrer" class="footer__link-item">RSS feed<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://johnnyreilly.com/atom.xml" target="_blank" rel="noopener noreferrer" class="footer__link-item">Atom feed<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/privacy-policy">Privacy Policy</a></li><li class="footer__item"><iframe src="https://github.com/sponsors/johnnyreilly/card" title="Sponsor johnnyreilly" style="margin-top: 20px; border: 0; border-radius: 10px; background-color: white; min-height: 400px;"></iframe></li><li class="footer__item"><a href="https://www.buymeacoffee.com/qUBm0Wh" rel="noopener" target="_blank"><img src="https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png" loading="lazy" alt="Buy Me A Coffee" style="height: 60px !important;width: 217px !important;"></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2012 - 2024 John Reilly. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>